(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{1006:function(e,t,n){e.exports={}},1007:function(e,t,n){e.exports={}},1021:function(e,t,n){e.exports={}},1022:function(e,t,n){e.exports={}},1025:function(e,t,n){e.exports={}},106:function(e,t,n){"use strict";n(10),n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),l=(n(28),n(1)),r=n(30),c=n(79);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m={props:{id:{type:String,default:""},type:{type:String|Number,default:""},review:{type:Boolean,default:!1},item:{type:Object,default:function(){}}},data:function(){return{typeOption:[{label:"NSFW-0",value:"sex",sexType:0},{label:"NSFW-3",value:"sex",sexType:3},{label:"NSFW-5",value:"sex",sexType:5},{label:"涉政",value:"politics"},{label:"恋童",value:"pedophile"}],banType:"",recommendType:1}},computed:h(h({},Object(l.e)("user",["userInfo","adminOff"])),{},{showRecommend:function(){return[1,11,"1","11"].includes(this.type)},showHide:function(){return![9,"9",13,"13",14,"14"].includes(this.type)},showTag:function(){return![9,"9",13,"13",14,"14"].includes(this.type)}}),methods:{adminHandle:function(e){var t;if(["reviewer_only","reviewer"].includes(null==this||null===(t=this.userInfo)||void 0===t?void 0:t.role))switch(e){case"PASS":this.reviewArtwork(1);break;case"NOT_PASS":this.reviewArtwork(2);break;case"SET_TAG":this.setTag();break;case"REVIEW":this.reviewPost();break;case"RECOMMEND":this.recommendType=1,this.openDialog();break;case"NOT_RECOMMEND":this.recommendType=2,this.openDialog();break;default:this.banReqFun(e)}},reviewArtwork:function(e){var t=this,n=this.id,o=this.type,l=this.$route.params;Object(c.u)({obj_id:n,obj_type:Number(o),show_in:1,status:e,tag_id:null==l?void 0:l.tag}).then((function(e){t.$message.success(t.$t("OperateSuccess")),t.$emit("change",n)}))},reviewPost:function(){this.$emit("change","REVIEW")},setTag:function(){var e=this.id,t=this.type;t=Number(t),this.$EventBus.$emit("openTagPopup",{id:e,type:t})},banReqFun:function(e){var t,n,o,l,c,d,h=this,m=this.id,v=this.type;v=Number(v);var f="BAN"==e?r.a:r.b,_="string"==typeof(null===(t=this.item)||void 0===t?void 0:t.cover)?null===(n=this.item)||void 0===n?void 0:n.cover:null===(o=this.item)||void 0===o||null===(o=o.cover)||void 0===o?void 0:o.url;_=_||(null===(l=this.item)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.url)||(null===(c=this.item)||void 0===c?void 0:c.url)||(null===(d=this.item)||void 0===d||null===(d=d.cover)||void 0===d?void 0:d.url)||"",f({id:m,obj_type:v,category:this.banType.value,score:"sex"===this.banType.value?this.banType.sexType:void 0,url:_}).then((function(t){var n="BAN"===e?"BanSuccess":"HideSuccess";h.$message.success(h.$t(n)),h.$emit("change",m)})).catch((function(t){console.log("err: ",t);var n="BAN"===e?"BanFailed":"HideFailed";h.$message.error(h.$t(n))}))},handleCommand:function(e){this.banType=e,this.banReqFun("BAN")},openDialog:function(){var e=this.id,t=this.type,n=this.recommendType,o=this.item;t=+t,this.$EventBus.$emit("openRecPopup",{id:e,type:t,recommendType:n,item:o})}}},v=(n(2306),n(0)),component=Object(v.a)(m,(function(){var e,t,n,o,l,r=this,c=r._self._c;return c("div",{directives:[{name:"show",rawName:"v-show",value:1===r.adminOff,expression:"adminOff === 1"}],staticClass:"admin-marking",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),function(){}.apply(null,arguments)}}},[r.review?[1!=r.type?c("span",{on:{click:function(e){return e.stopPropagation(),e.preventDefault(),r.adminHandle("REVIEW")}}},[r._v(r._s(r.$t("review")))]):[c("span",{on:{click:function(e){return e.stopPropagation(),e.preventDefault(),r.adminHandle("PASS")}}},[r._v(r._s(r.$t("Pass")))]),r._v(" "),c("span",{staticClass:"not-btn",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),r.adminHandle("NOT_PASS")}}},[r._v(r._s(r.$t("NOTPass")))])]]:[c("div",{directives:[{name:"show",rawName:"v-show",value:r.showRecommend,expression:"showRecommend"}]},[c("span",{directives:[{name:"show",rawName:"v-show",value:"reviewer"===(null===(e=r.userInfo)||void 0===e?void 0:e.role),expression:"userInfo?.role === 'reviewer'"}],on:{click:function(e){return e.stopPropagation(),e.preventDefault(),r.adminHandle("RECOMMEND")}}},[r._v("\n        "+r._s(r.$t("Recommend"))+"\n      ")]),r._v(" "),c("span",{directives:[{name:"show",rawName:"v-show",value:"reviewer"===(null===(t=r.userInfo)||void 0===t?void 0:t.role),expression:"userInfo?.role === 'reviewer'"}],on:{click:function(e){return e.stopPropagation(),e.preventDefault(),r.adminHandle("NOT_RECOMMEND")}}},[r._v("\n         "+r._s(r.$t("recommendNo"))+"\n      ")])]),r._v(" "),c("div",[c("span",{directives:[{name:"show",rawName:"v-show",value:"reviewer"===(null===(n=r.userInfo)||void 0===n?void 0:n.role)&&r.showHide,expression:"userInfo?.role === 'reviewer' && showHide"}],on:{click:function(e){return e.stopPropagation(),e.preventDefault(),r.adminHandle("HIDE")}}},[r._v(r._s(r.$t("hide"))+"\n    ")]),r._v(" "),11!=r.type?c("span",{directives:[{name:"show",rawName:"v-show",value:["reviewer_only","reviewer"].includes(null===(o=r.userInfo)||void 0===o?void 0:o.role)&&r.showTag,expression:"['reviewer_only', 'reviewer'].includes(userInfo?.role) && showTag"}],on:{click:function(e){return e.stopPropagation(),e.preventDefault(),r.adminHandle("SET_TAG")}}},[r._v(r._s(r.$t("Tags")))]):r._e(),r._v(" "),c("el-dropdown",{directives:[{name:"show",rawName:"v-show",value:"reviewer"===(null===(l=r.userInfo)||void 0===l?void 0:l.role),expression:"userInfo?.role === 'reviewer'"}],attrs:{trigger:"hover"},on:{command:r.handleCommand}},[c("div",{staticClass:"el-dropdown-link selectTime"},[c("div",[c("span",[r._v(r._s(r.$t("Ban")))])])]),r._v(" "),c("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},r._l(r.typeOption,(function(e,t){return c("el-dropdown-item",{key:t,attrs:{command:e}},[c("div",{staticClass:"el-dropdown-item el-dropdown-item-time"},[c("span",[r._v(r._s(e.label))])])])})),1)],1)],1)]],2)}),[],!1,null,"1bd7d0eb",null);t.a=component.exports},1076:function(e,t,n){e.exports={}},1077:function(e,t,n){e.exports={}},1078:function(e,t,n){e.exports={}},1080:function(e,t,n){e.exports={}},1094:function(e,t,n){e.exports={}},1095:function(e,t,n){e.exports={}},1152:function(e,t,n){e.exports={}},1153:function(e,t,n){e.exports={}},1154:function(e,t,n){e.exports={}},1155:function(e,t,n){e.exports={}},116:function(e,t,n){"use strict";var o={props:["value","min","max","label","step","tips","disabled","showTooltip","precision","hideLabel","hideSlider"],data:function(){return{}},methods:{changeConfig:function(e){this.$emit("change",e)}}},l=(n(3006),n(3007),n(0)),component=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"slider-item",class:[e.hideLabel?"easy-slider-item-between":""]},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.hideLabel,expression:"!hideLabel"}],staticClass:"slider-label"},[t("p",[e._v(e._s(e.label)+"\n      "),e.tips?t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:e.tips,placement:"top-start"}},[t("span",{staticClass:"el-icon-warning custom-tips"})]):e._e()],1),e._v(" "),t("el-input-number",{staticClass:"easy-input-number",attrs:{value:e.value,controls:!1,min:e.min,max:e.max,precision:e.precision,step:e.step,disabled:e.disabled},on:{change:e.changeConfig}})],1),e._v(" "),e.hideSlider?e._e():t("el-slider",{staticClass:"easy-slider-item",attrs:{value:e.value,min:e.min,max:e.max,step:e.step,disabled:e.disabled,"show-tooltip":!1},on:{input:e.changeConfig}}),e._v(" "),t("el-input-number",{directives:[{name:"show",rawName:"v-show",value:e.hideLabel,expression:"hideLabel"}],staticClass:"easy-input-number",attrs:{value:e.value,controls:!1,min:e.min,max:e.max,precision:e.precision,step:e.step,disabled:e.disabled},on:{change:e.changeConfig}})],1)}),[],!1,null,"45882de2",null);t.a=component.exports},1176:function(e,t,n){e.exports={}},1192:function(e,t,n){e.exports={}},1230:function(e,t,n){e.exports={}},1246:function(e,t,n){e.exports={}},1267:function(e,t,n){e.exports={}},1275:function(e,t,n){e.exports={}},1299:function(e,t,n){e.exports={}},1315:function(e,t,n){e.exports={}},1324:function(e,t,n){e.exports={}},135:function(e,t,n){"use strict";n(4);var o=n(105),l={props:["item","disabled","base_models","fontSize"],data:function(){return{show:!1,list:[],loading:!1}},computed:{version_name:function(){var e,t,n,o,l;return null!==(e=this.item)&&void 0!==e&&e.child&&null!==(t=this.item)&&void 0!==t&&t.child[0]?(null===(l=this.item)||void 0===l?void 0:l.child[0].title)||"":(null===(n=this.item)||void 0===n?void 0:n.version_name)||(null===(o=this.item)||void 0===o||null===(o=o.art_model)||void 0===o?void 0:o.version_name)||""}},watch:{show:{handler:function(e){var t=this;if(e&&!this.list.length){if(this.loading)return;this.loading=!0;var n={model_id:this.item.id};this.base_models&&(n.base_models=this.base_models),Object(o.f)(n).then((function(e){var n;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&(t.list=e.data.items)})).finally((function(){t.loading=!1}))}}}},methods:{selectItem:function(e){this.$emit("selectItem",e),this.show=!1}}},r=(n(2358),n(0)),component=Object(r.a)(l,(function(){var e=this,t=e._self._c;return t("el-popover",{attrs:{placement:"bottom",trigger:"click","visible-arrow":!1,disabled:e.disabled},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"verList"},e._l(e.list,(function(n,o){return t("div",{key:o,on:{click:function(t){return e.selectItem(n)}}},[e._v(e._s(n.version_no))])})),0),e._v(" "),t("div",{staticClass:"changeVer",attrs:{slot:"reference"},on:{click:function(e){e.stopPropagation()}},slot:"reference"},[t("span",{style:{fontSize:e.fontSize?e.fontSize+"px":"14px"}},[e._v(e._s(e.version_name))]),e._v(" "),t("i",{staticClass:"el-icon-arrow-down"})])])}),[],!1,null,"39bfdfa5",null);t.a=component.exports},1502:function(e,t,n){e.exports={}},151:function(e,t,n){"use strict";n(16),n(10),n(36),n(14),n(18),n(9),n(11),n(12);var o=n(15),l=n(2),r=(n(7),n(32),n(19),n(43),n(8),n(4),n(274),n(6),n(41)),c=n(21),d=n(1),h=n(5),m=n(24),v=n(22),f=n(56),_=n(33),y=n(82),w=n(135),C=n(64),k=n(13),S=n(81),x=n(269),I=void 0;function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $={name:"StyleModal",mixins:[_.a],components:{CollectPopover:f.a,modelPayNum:y.a,changeVer:w.a,SwipeableList:C.a,LenovoInput:x.a},props:{selectList:{type:Array,default:function(){return[]}},modelType:{type:String,default:function(){return"LORA"}},placeholder:{type:String,default:function(){return null==I?void 0:I.$t("TaskStylePlaceHolder")}},isPaintingBoard:{type:Boolean,default:!1},isSDXL:{type:Boolean,default:!1},SDXLmodel:{type:Array,default:function(){return null}},SDmodel:{type:Array,default:function(){return null}},inTask:{type:Boolean,default:!1},isStudioMode:{type:Boolean,default:!1},fluxModelId:{type:String,default:""},studioModelInfo:{type:Object,default:function(){return{}}},menuIndex:{type:String,default:function(){return""}},isSimpleMode:{type:Boolean,default:!1}},data:function(){return{visible:!1,activeTab:"mine",timeName:"All",timeTypeOption:[{name:"All",startTime:null,endTime:null},{name:"days",startTime:this.getTimestamps().startTimestamp,endTime:this.getTimestamps().endTimestamp},{name:"week",startTime:this.getWeekTimeRange().startTimestamp,endTime:this.getWeekTimeRange().endTimestamp},{name:"months",startTime:this.getMonthTimestampRange().startTimestamp,endTime:this.getMonthTimestampRange().endTimestamp}],tagIndex:"hot",typeOption:[{name:"Hot",id:"hot",icon:"hot"},{name:"New",id:"new",icon:"new1"}],tabList:[{label:"我的",type:"mine",id:"mine",order:1,i18nKey:"Mine"}],queryOptionsList:[{label:"综合推荐",value:"comprehensive",order:1,i18nKey:"styleModal1"},{label:"最近使用",value:"recent",order:2,i18nKey:"recentlyUsed"},{label:"我的收藏",value:"collect",order:3,i18nKey:"MyCollection"},{label:"我的模型",value:"bookmarks_choose",order:4,i18nKey:"MyModel"},{label:"更多推荐",value:"recommend",order:5,i18nKey:"FindGoodPictures"}],queryParam:{order_by:"hot",keyword:"",created:"",model_type:"LORA"},list:[],hotRecentUsedList:[],loading:!1,noMore:!1,pageInfo:{page:1,limit:60,total:0},debounceHandleScroll:null,gridNum:5,modalWidth:"1340px",debounceResize:null,showType:"",modelOption:[],itemScroll:null,queryType:"comprehensive",modelTypeSelect:[],baseModelSelect:[],modelTypes:["Checkpoint","LoRA"],tabShowTagEmpty:!1,showTagEmpty:!1,keyWordCopy:""}},computed:T(T(T({},Object(d.e)("user",["collectData","cdnHost","token"])),{},{showEmptyResult:function(){var e=!this.loading,t=!this.renderList.length&&!this.hotRecentUsedList.length,n="mine"===this.activeTab&&!["comprehensive"].includes(this.queryType);return e&&t&&n},lang:function(){return this.$i18n.locale},getTitle:function(){var e={Checkpoint:"Checkpoint",LORA:"LoRA",TextualInversion:this.$t("embedding1")}[this.modelType]||this.modelType;return"".concat(this.$t("selectModels"),"(").concat(e,")")},getModels:function(){var e=k.B.sd,t=k.B.sd3,n=k.B.sdxl,l=k.B.flux,r=k.B.sd35,c=k.B.sa,d=[];return d=["imageToImage","conditionToImage"].includes(this.menuIndex)?[].concat(Object(o.a)(e),Object(o.a)(t),Object(o.a)(n)):[].concat(Object(o.a)(e),Object(o.a)(r),Object(o.a)(t),Object(o.a)(n),Object(o.a)(l),Object(o.a)(c)),{sd:this.SDmodel||e,sd35:r,sd3:t,sdxl:this.SDXLmodel||n,allBaseModels:d,flux:l,sa:c}},getBaseModel:function(){var e,t=this.getModels.sd;(t=this.isSDXL?this.getModels.sdxl:this.isPaintingBoard&&"Checkpoint"===this.modelType?this.getModels.allBaseModels:this.getModels.sd,this.isStudioMode)&&(t="Checkpoint"===this.modelType?[]:this.getModels.sd,t="Checkpoint"===this.modelType?this.getModels.allBaseModels:{SDXL:this.getModels.sdxl,SD:this.getModels.sd,SD3:this.getModels.sd3,FLUX:this.getModels.flux,SA:this.getModels.sa,"SD 3.5":this.getModels.sd35,"SD 3.5L":["SD 3.5L"],"SD 3.5M":["SD 3.5M"]}[this.getCurrentModelType]||this.getModels.sd);return"FLUX"===this.getCurrentModelType||null!==(e=this.getCurrentModelType)&&void 0!==e&&e.includes("SD 3.5")?Object(o.a)(t):"Checkpoint"===this.modelType?[].concat(Object(o.a)(t),Object(o.a)(k.B.other)):Object(o.a)(t)},getCurrentModelType:function(){var e,t=(this.studioModelInfo||{}).base_model_type,n=void 0===t?"":t,o=this.getModels.flux,l=this.getModels.sdxl,r=this.getModels.sd,c=this.getModels.sd35,d=(null===(e=this.getModels)||void 0===e?void 0:e.sa)||[],h=l.includes(n)||(n||"").includes("SDXL"),m=r.includes(n),v=o.includes(n)||(n||"").includes("Flux"),f=c.includes(n)||(n||"").includes("SD 3.5");return d.includes(n)?"SA":v?"FLUX":h?"SDXL":m?"SD":"SD 3"===n?"SD3":f?n:void 0},showRecommendText:function(){return!this.loading&&this.hotUsedList.length&&"mine"===this.activeTab&&"comprehensive"===this.queryType},isNoRecentUsed:function(){return!this.loading&&!this.renderList.length&&"recent"===this.queryType&&this.showRecommendText},nsfwUrl:function(){return"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")},activeTabClass:function(){return function(e){return e&&e===this.activeTab?"tab-active":""}}},Object(d.c)(["isSupportWebp"])),{},{getImageUrl:function(){return function(e){var t="";return e.banner&&!["",null,void 0].includes(e.banner.url)?t=Object(h.x)(e.banner.url,this.$imgL):t}},activeSelectModel:function(){return function(e){return this.selectList.find((function(t){return(e.id||e.model_id)===(t.id||t.model_id)}))?"select-model-active":""}},renderList:function(){return this.list},hotUsedList:function(){return this.hotRecentUsedList},convertTabText:function(){return function(e){var t="LORA"===this.modelType?"MyStyle":"MyModel";return e.title?e.title:"bookmarks_choose"===e.type?this.$t(t):this.$t(e.i18nKey)}}}),beforeDestroy:function(){this.debounceHandleScroll=null},watch:{hotRecentUsedList:{handler:function(e){for(var i=0;i<this.hotRecentUsedList.length;i++)for(var t=0;t<this.selectList.length;t++)if(this.selectList[t].id===this.hotRecentUsedList[i].id&&this.selectList[t].art_model_ver_no_name&&this.hotRecentUsedList[i].version_name){this.hotRecentUsedList[i].version_name=this.selectList[t].art_model_ver_no_name,this.hotRecentUsedList[i].banner.url=this.selectList[t].model_cover;break}}},list:{handler:function(e){for(var i=0;i<this.list.length;i++)for(var t=0;t<this.selectList.length;t++)if(this.selectList[t].id===this.list[i].id&&this.selectList[t].art_model_ver_no_name&&this.list[i].version_name){this.list[i].version_name=this.selectList[t].art_model_ver_no_name,this.list[i].banner.url=this.selectList[t].model_cover;break}}}},mounted:function(){var e=this;this.debounceHandleScroll=Object(m.debounce)(this.handleScroll,600),this.debounceResize=Object(m.debounce)(this.handleResize,500),window.addEventListener("resize",this.debounceResize),this.$nextTick((function(){e.handleResize()}))},methods:{onFilter:function(e,t){var n=this;this.loading||(1===t?this.modelTypeSelect.includes(e)?this.modelTypeSelect.forEach((function(t,o){t==e&&n.modelTypeSelect.splice(o,1)})):this.modelTypeSelect.push(e):this.baseModelSelect.includes(e)?this.baseModelSelect.forEach((function(t,o){t==e&&n.baseModelSelect.splice(o,1)})):this.baseModelSelect.push(e),"recommend"===this.queryType&&(this.tagIndex="hot"),this.checkGetList())},onFilterReset:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loading||(this.modelTypeSelect=[],this.baseModelSelect=[],e||this.checkGetList())},changeQueryType:function(){this.list=[],this.hotRecentUsedList=[],this.pageInfo={page:1,limit:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:"",created:"",model_type:this.modelType||"LORA"},this.checkGetList(),this.$logEvent("log_actions",{operation:"TextualInversion"===this.modelType?"click_tab":"click_choose_model_tab",behavior_info:"TextualInversion"===this.modelType?"on_create_flow_page_embedding_settings":"on_choose_model_page",behavior_info_sub:this.queryType,source:this.getCurrentSource()})},checkGetList:function(){"comprehensive"!==this.queryType?"recent"===this.queryType?this.handleGetRecentUsed():this.handleSearch():this.handleGetComList()},handleGetComList:function(){var e=this;this.pageInfo.page=1,this.loading=!0,this.noMore=!1,Reflect.deleteProperty(this.queryParam,"time_to");var t={};return t.base_models=this.baseModelSelect.length?this.baseModelSelect:this.getBaseModel,t.model_type=this.modelType||"LORA",(this.isStudioMode||this.isSimpleMode)&&(t.mode="lab"),this.isSimpleMode&&(t.scene="st_gen"),this.loading=!0,Object(v.i)(t).then((function(t){var n=t||{},o=n.status.code,code=void 0===o?"":o,l=n.data,data=void 0===l?{}:l;if([1e4,"10000"].includes(code)){var r=Array.isArray(null==data?void 0:data.items)?data.items:[],c=Array.isArray(null==data?void 0:data.hot_used_items)?data.hot_used_items:[];e.noMore=!0;var d={},h=(r||[]).map((function(e){return e.art_model||{}})).reduce((function(e,t){return d[t.id]||(d[t.id]=!0,e.push(t)),e}),[]).filter((function(t){return t.type===e.modelType})).map((function(t){var n=(t.banner||{}).nsfw;[1,"1"].includes(void 0===n?0:n)&&(t.banner=Object.assign(t.banner||{},{url:e.nsfwUrl}));var o=e.findSelectItem(t);return o&&(t=Object.assign(t,o)),t}));e.list=h.length<=10?h:h.slice(0,10),e.hotRecentUsedList=(c||[]).map((function(e){return e.art_model||{}})).reduce((function(e,t){return d[t.id]||(d[t.id]=!0,e.push(t)),e}),[]).filter((function(t){return t.type===e.modelType})).map((function(t){var n,o=(t.banner||{}).nsfw;[1,"1"].includes(void 0===o?0:o)&&(t.banner=Object.assign((null===(n=t)||void 0===n?void 0:n.banner)||{},{url:e.nsfwUrl}));var l=e.findSelectItem(t);return l&&(t=Object.assign(t,l)),t}))}return e.noDataView(),e.list})).finally((function(){e.loading=!1}))},setIcon:function(){var e=this,t="homeIcon1";return this.typeOption.forEach((function(n){e.tagIndex===n.id&&(t=n.icon)})),t},handleCommand:function(e){this.tagIndex=e,this.queryParam.order_by=this.tagIndex,this.handleSearch()},handleTimeCommand:function(e){this.timeName=e.name,this.queryParam.start_at=e.startTime,this.queryParam.end_at=e.endTime,this.handleSearch()},getTimestamps:function(){var e=new Date;return{startTimestamp:e-864e5,endTimestamp:e.getTime()}},getWeekTimeRange:function(){var e=new Date;return{startTimestamp:e-6048e5,endTimestamp:e.getTime()}},getMonthTimestampRange:function(){var e=new Date;e.getFullYear(),e.getMonth();return{startTimestamp:e-2592e6,endTimestamp:e.getTime()}},changeScroll:function(){var e=this;this.$refs.listItem.forEach((function(t,n){t.classList.contains("tab-active")&&(e.itemScroll={value:t.getBoundingClientRect().left,index:n})}))},getTag:function(){var e=this;Object(S.a)({show_area:"model"}).then((function(t){if(1e4===t.status.code){var n=t.data||[];n.length&&n.forEach((function(t){t.title=t[k.l[e.$i18n.locale]]})),e.tabList=[].concat(Object(o.a)(e.tabList),Object(o.a)(n))}}))},collectionBar:function(){var e=this;Object(c.B)({type:2}).then((function(t){1e4===t.status.code&&(e.modelOption=[{label:e.$t("All"),value:""}],t.data.items.forEach((function(t){e.modelOption.push({label:t.name,value:t.id})})))}))},changeType:function(e){this.list=[],this.pageInfo={page:1,limit:60,total:0},this.handleSearch()},handleResize:function(){try{window.innerWidth>1400?(this.modalWidth="1340px",this.gridNum=5):(this.modalWidth="1071px",this.gridNum=4)}catch(e){}},selectItem:function(e,t,n){var o,l;(t.model_ver_no=e.model_ver_id,t.version_name=e.version_no,t.base_model=e.base_model_name,t.modelTags=Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[],null!==(o=e.sample)&&void 0!==o&&null!==(o=o.banner)&&void 0!==o&&o.url)?t.banner.url=null===(l=e.sample)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.url:t.banner.url="";n&&this.$emit("selectModel",t)},openModal:function(){var e=this;if(this.resetData(),this.token&&this.collectionBar(),this.queryParam.model_type=this.modelType||"",this.tabList=[{label:"我的",type:"mine",id:"mine",order:1,i18nKey:"Mine"}],this.activeTab="mine",this.queryType="comprehensive",this.getTag(),!this.token)return this.checkGetList(),void(this.visible=!0);this.$nextTick((function(){e.getRecentUsedModel().finally((function(){e.loading=!1,e.list.length&&e.list.length>=10?(e.activeTab="mine",e.queryType="recent"):(e.activeTab="mine",e.queryType="comprehensive",e.hotRecentUsedList=[],e.checkGetList())})),e.visible=!0}))},handleClose:function(){this.visible=!1,this.resetData()},resetData:function(){this.pageInfo={page:1,limit:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:"",created:"",model_type:this.modelType||"LORA"},this.list=[],this.activeTab="mine",this.queryType="comprehensive",this.loading=!1,this.noMore=!1,this.hotRecentUsedList=[]},handleViewMore:function(){this.activeTab="",this.handleTabClick("mine","recommend")},handleTabClick:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e===this.activeTab||this.loading||(this.activeTab=e,this.queryType="mine"===e?n||"comprehensive":"recommend",this.$nextTick((function(){t.changeScroll()})),this.list=[],this.hotRecentUsedList=[],this.pageInfo={page:1,limit:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:"",created:"",model_type:this.modelType||"LORA"},this.checkGetList(),this.$logEvent("log_actions",{operation:"TextualInversion"===this.modelType?"click_tab":"click_choose_model_tab",behavior_info:"TextualInversion"===this.modelType?"on_create_flow_page_embedding_settings":"on_choose_model_page",behavior_info_sub:e,source:this.getCurrentSource()}))},screenAll:function(){this.activeTab="mine",this.baseModelSelect=[],this.modelTypeSelect=[],this.queryParam.order_by="hot",this.queryParam.created="",this.queryParam.start_at=void 0,this.queryParam.end_at=void 0,this.$logEvent("log_actions",{operation:"click_search_all",behavior_info:"on_choose_model_page",behavior_info_sub:this.activeTab}),this.handleSearch()},handleSearch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.pageInfo.page=1,this.loading=!1,this.noMore=!1,this.list=[],this.hotRecentUsedList=[],Reflect.deleteProperty(this.queryParam,"time_to"),"recent"===this.queryType&&(this.queryType="recommend"),"comprehensive"===this.queryType&&(this.queryType="recommend"),this.getList(),"dot"===e&&this.$logEvent("log_actions",{operation:"TextualInversion"===this.modelType?"click_tab":"click_choose_model_tab",behavior_info:"TextualInversion"===this.modelType?"on_create_flow_page_embedding_settings":"on_choose_model_page",behavior_info_sub:"search_btn",source:this.getCurrentSource()})},handleScroll:function(){var e=this.$refs.scrollWrapper;try{e&&e.scrollTop+e.clientHeight>=e.scrollHeight-30&&"recent"!==this.queryType&&this.getList(!0)}catch(e){}},getList:function(e){var t=this;if(!this.loading&&!this.noMore){this.loading=!0;var n={collect:"bookmarks",recommend:"community",bookmarks_choose:"bookmarks_choose"}[JSON.parse(JSON.stringify(this.queryType))]||"",o={page:this.pageInfo.page,page_size:this.pageInfo.limit,type:n};if((this.isStudioMode||this.isSimpleMode)&&(o.mode="lab"),this.isSimpleMode&&(o.scene="st_gen"),this.inTask&&(o.refer="task"),"bookmarks"===o.type){var l=0;o.folder_no=this.showType;try{var c,d=this.list.length?this.list[this.list.length-1]:null;l=(null==d||null===(c=d.collect)||void 0===c?void 0:c.collect_at)||0,o.after=1===o.page?0:l}catch(e){}}["recent","collect","bookmarks","bookmarks_choose","recommend","comprehensive","mine"].includes(this.activeTab)||(o.tags=[this.activeTab],o.type="community"),o.base_models=this.baseModelSelect.length?this.baseModelSelect:this.getBaseModel,Object.assign(o,this.queryParam),(""!==this.queryParam.keyword&&"recommend"===this.queryType?r.o:r.r)(o).then((function(n){var o=n||{},l=o.status,r=void 0===l?{}:l,c=o.data,data=void 0===c?{}:c,d=r.code;if([1e4,"10000"].includes(void 0===d?"":d)){if(t.noMore=!data.has_more,e){var h=t.list.map((function(e){return e.id})),m=(n.data.items||[]).filter((function(e){return!h.includes(e.id)})).map((function(e){var n=(e.banner||{}).nsfw;[1,"1"].includes(void 0===n?0:n)&&(e.banner=Object.assign(e.banner||{},{url:t.nsfwUrl}));var o=t.findSelectItem(e);return o&&(e=Object.assign(e,o)),e}));t.list=t.list.concat(m)}else t.list=(n.data.items||[]).map((function(e){var n=(e.banner||{}).nsfw;[1,"1"].includes(void 0===n?0:n)&&(e.banner=Object.assign(e.banner||{},{url:t.nsfwUrl}));var o=t.findSelectItem(e);return o&&(e=Object.assign(e,o)),e}));1===t.pageInfo.page&&(t.queryParam.time_to=n.data.time_ms),t.pageInfo.page++,t.loading=!1,t.keyWordCopy=t.queryParam.keyword,t.noDataView()}})).catch((function(e){console.log(e)})).finally((function(){t.loading=!1}))}},noDataView:function(){var e=!this.loading,t=!this.list.length,n="mine"!==this.activeTab,o=""===this.queryParam.keyword,l=e&&t&&n&&o,r=e&&t&&n&&!o;this.tabShowTagEmpty=l,this.showTagEmpty=r},findSelectItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.activeSelectModel(e)){var t=this.selectList.find((function(t){return(e.id||e.model_id)===(t.id||t.model_id)}));return e=t||e}return null},getCurrentSource:function(){return"TextualInversion"===this.modelType?"embedding":this.isSimpleMode?"simple_task":this.isPaintingBoard?"painting_board":"task"},handleSelect:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(["cltpop","use"].includes(null===(e=(arguments.length>2?arguments[2]:void 0).target)||void 0===e?void 0:e.className)){if(n)return void this.$message.warning(this.$t("CannotSelectedRepeatedly"));if(this.isStudioMode&&!this.isStudioFlux&&"Checkpoint"!==this.modelType){var o=(this.studioModelInfo||{}).base_model_type,l=void 0===o?"":o,r=this.getModels.sdxl,c=this.getModels.sd,d=this.getModels.sd3,h=this.getModels.sd35,m=h.includes(l)||(l||"").includes("SD 3.5"),v=((null===k.B||void 0===k.B?void 0:k.B.sa)||[]).includes(l),f=r.includes(l)||(l||"").includes("SDXL"),_=c.includes(l),y=d.includes(l),w=r.includes(null==t?void 0:t.base_model)||((null==t?void 0:t.base_model)||"").includes("SDXL"),C=c.includes(null==t?void 0:t.base_model),S=d.includes(null==t?void 0:t.base_model),x=h.includes(null==t?void 0:t.base_model),I=((null===k.B||void 0===k.B?void 0:k.B.sa)||[]).includes(null==t?void 0:t.base_model);return f&&!w||_&&!C||y&&!S||v&&!I||m&&!x?void this.$message.warning(this.$t("studio25")):(this.$logEvent("log_actions",{operation:"click_choose_model",behavior_info:"on_choose_model_page",behavior_info_sub:null==t?void 0:t.id,source:this.getCurrentSource()}),void this.$emit("selectModel",t))}if(this.isStudioMode&&["imageToImage","conditionToImage"].includes(null==this?void 0:this.menuIndex)&&((null==t?void 0:t.id)===(null==this?void 0:this.fluxModelId)||((null===k.B||void 0===k.B?void 0:k.B.sa)||[]).includes(null==t?void 0:t.base_model)))return void this.$message.warning(this.$t("studioTips1"));if(this.isStudioMode&&null!=t&&t.base_model.includes("Flux")&&["imageToImage","conditionToImage"].includes(this.menuIndex))return void this.$message.warning(this.$t("studioTips1"));this.$logEvent("log_actions",{operation:"click_choose_model",behavior_info:"on_choose_model_page",behavior_info_sub:null==t?void 0:t.id,source:this.getCurrentSource()}),this.$emit("selectModel",t)}},handleGetRecentUsed:function(){this.pageInfo.page=1,this.loading=!0,this.noMore=!1,Reflect.deleteProperty(this.queryParam,"time_to"),this.getRecentUsedModel()},getRecentUsedModel:function(){var e=this,t={};return t.base_models=this.baseModelSelect.length?this.baseModelSelect:this.getBaseModel,"TextualInversion"===this.modelType&&(t.model_type="TextualInversion"),(this.isStudioMode||this.isSimpleMode)&&(t.mode="lab"),this.isSimpleMode&&(t.scene="st_gen"),this.loading=!0,Object(v.l)(t).then((function(t){console.log(t);var n=t||{},o=n.status.code,code=void 0===o?"":o,l=n.data,data=void 0===l?{}:l;if([1e4,"10000"].includes(code)){var r=Array.isArray(data.items)?data.items:[],c={};e.list=(r||[]).map((function(e){return e.art_model||{}})).reduce((function(e,t){return c[t.id]||(c[t.id]=!0,e.push(t)),e}),[]).filter((function(t){return e.isStudioMode||e.isSimpleMode?t.type===e.modelType:t.type===e.modelType&&(null==t?void 0:t.id)!==k.h})).map((function(t){var n=(t.banner||{}).nsfw;[1,"1"].includes(void 0===n?0:n)&&(t.banner=Object.assign(t.banner||{},{url:e.nsfwUrl}));var o=e.findSelectItem(t);return o&&(t=Object.assign(t,o)),t}))}return e.noDataView(),e.list})).finally((function(){e.loading=!1}))},handleDetail:function(e){(null==e?void 0:e.id)&&window.open(this.localePath("/models/detail/".concat(e.id)),"_blank")},convertModelFlag:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getModels.sdxl,n=(this.getModels.sd,this.getModels.sd3),o=this.getModels.flux||[],l=(e.type,e.base_model),r=void 0===l?"":l,c=t.includes(r)||(r||"").includes("SDXL");return n.includes(r)?"SD3":o.includes(r)?"LORA"===this.modelType?"LoRA | F1 ":"Checkpoint | F1 ":c?"SDXL":""}}},L=$,P=(n(2426),n(2427),n(0)),component=Object(P.a)(L,(function(){var e,t,n,o,l=this,r=l._self._c;return r("el-dialog",{ref:"styleModal",attrs:{title:l.getTitle,visible:l.visible,width:l.modalWidth,height:"auto","custom-class":"c-style-modal","modal-append-to-body":!0,"append-to-body":!0,"close-on-click-modal":!1,center:""},on:{"update:visible":function(e){l.visible=e},close:function(e){return l.onFilterReset(!0)}}},[r("div",{staticClass:"style-content-wrapper"},[r("div",{staticClass:"style-content__header"},[r("swipeable-list",{attrs:{scrollChange:l.itemScroll,top:"15px"}},[r("div",{staticClass:"style-content__header-tabs"},l._l(l.tabList,(function(e,t){return r("div",{key:"tab_".concat(null==e?void 0:e.id,"_").concat(t)},[r("div",{ref:"listItem",refInFor:!0,staticClass:"style-content__header-tabs-item",class:[l.activeTabClass(e.id)],on:{click:function(t){return t.stopPropagation(),l.handleTabClick(e.id)}}},[l._v("\n              "+l._s(l.convertTabText(e))+"\n            ")])])})),0)])],1),l._v(" "),r("div",{staticClass:"style-content__search-box"},[r("div",[l._e(),l._v(" "),r("LenovoInput",{attrs:{width:404,screen:{activeTab:l.activeTab,baseModelSelect:l.baseModelSelect.length?l.baseModelSelect:l.getBaseModel,modelType:l.modelType,isStudioMode:l.isStudioMode,isSimpleMode:l.isSimpleMode},isLoca:"creative",clearable:"",placeholder:"LORA"===l.modelType?l.$t("TaskStylePlaceHolder"):l.$t("TaskModelPlaceHolder")},on:{onScreen:function(e){return l.handleSearch("dot")},clear:function(e){return l.handleSearch("dot")}},model:{value:l.queryParam.keyword,callback:function(e){l.$set(l.queryParam,"keyword",e)},expression:"queryParam.keyword"}}),l._v(" "),r("span",{staticClass:"style-content__search-btn style-content__search-btn-gra-border",on:{click:function(){return""!=l.queryParam.keyword&&l.handleSearch("dot")}}},[r("span",[l._v(l._s(l.$t("Search")))])])],1),l._v(" "),r("div",{staticClass:"search-right"},[r("el-popover",{attrs:{placement:"bottom","popper-class":"homeFilter",trigger:"hover"}},[r("div",{staticClass:"filterCnt"},[r("div",{staticClass:"filterTit",staticStyle:{"margin-top":"16px"}},[l._v(l._s(l.$t("BaseModel")))]),l._v(" "),r("div",{staticClass:"filterList"},l._l(l.getBaseModel,(function(e,t){return r("div",{key:t,staticClass:"filterItem",class:{AfilterItem:l.baseModelSelect.includes(e)},on:{click:function(t){return l.onFilter(e,2)}}},[l.baseModelSelect.includes(e)?r("i",{staticClass:"el-icon-check"}):l._e(),l._v(" "),r("span",[l._v(l._s("TextualInversion"===e?l.$t("embedding1"):e))])])})),0),l._v(" "),r("div",{staticClass:"filterReset graBorder",on:{click:function(e){return l.onFilterReset(!1)}}},[l._v("\n              "+l._s(l.$t("resetSelection"))+"\n            ")])]),l._v(" "),r("el-badge",{staticClass:"item",attrs:{slot:"reference",value:(null===(e=l.modelTypeSelect)||void 0===e?void 0:e.length)+(null===(t=l.baseModelSelect)||void 0===t?void 0:t.length),hidden:(null===(n=l.modelTypeSelect)||void 0===n?void 0:n.length)+(null===(o=l.baseModelSelect)||void 0===o?void 0:o.length)==0},slot:"reference"},[r("div",{staticClass:"filterBox"},[r("div",[r("i",{staticClass:"iconfont icon-a-filterIcon"}),l._v(" "),r("span",[l._v(l._s(l.$t("Filter")))])]),l._v(" "),r("i",{staticClass:"el-icon-arrow-down"})])])],1),l._v(" "),"mine"===l.activeTab&&"collect"===l.queryType&&l.modelOption.length>0?r("el-select",{staticClass:"showType custom-select",class:l.$i18n.locale,attrs:{"popper-class":"custom-select"},on:{change:l.changeType},model:{value:l.showType,callback:function(e){l.showType=e},expression:"showType"}},l._l(l.modelOption,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):l._e(),l._v(" "),"mine"===l.activeTab?r("el-select",{staticClass:"showType custom-select",class:l.$i18n.locale,attrs:{"popper-class":"custom-select"},on:{change:l.changeQueryType},model:{value:l.queryType,callback:function(e){l.queryType=e},expression:"queryType"}},l._l(l.queryOptionsList,(function(e){return r("el-option",{key:e.value,attrs:{label:l.$t(e.i18nKey),value:e.value}})})),1):l._e(),l._v(" "),["recent","collect","bookmarks","bookmarks_choose","recommend","mine"].includes(l.activeTab)?l._e():r("div",{staticClass:"Screening"},[r("el-dropdown",{attrs:{trigger:"hover"},on:{command:l.handleTimeCommand}},[r("div",{staticClass:"el-dropdown-link selectTime"},[r("div",[r("i",{staticClass:"el-icon-time"}),l._v(" "),r("span",[l._v(l._s(l.$t(l.timeName)))])]),l._v(" "),r("i",{staticClass:"el-icon-arrow-down"})]),l._v(" "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},l._l(l.timeTypeOption,(function(e,t){return r("el-dropdown-item",{key:t,attrs:{command:e}},[r("div",{staticClass:"el-dropdown-item el-dropdown-item-time"},[r("span",[l._v(l._s(l.$t(e.name)))])])])})),1)],1),l._v(" "),r("el-dropdown",{attrs:{trigger:"hover"},on:{command:l.handleCommand}},[r("div",{staticClass:"el-dropdown-link"},[r("div",[r("i",{staticClass:"iconfont custom-iconfont",class:"icon-".concat(l.setIcon())}),l._v(" "),r("span",[l._v(l._s(l.$t(l.tagIndex.charAt(0).toUpperCase()+l.tagIndex.slice(1))))])]),l._v(" "),r("i",{staticClass:"el-icon-arrow-down"})]),l._v(" "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},l._l(l.typeOption,(function(e,t){return r("el-dropdown-item",{key:t,attrs:{command:e.id}},[r("div",{staticClass:"el-dropdown-item"},[r("i",{staticClass:"iconfont custom-iconfont",class:"icon-".concat(e.icon)}),l._v(" "),r("span",[l._v(l._s(l.$t(e.name)))])])])})),1)],1)],1)],1)]),l._v(" "),r("div",{directives:[{name:"loading",rawName:"v-loading",value:l.loading,expression:"loading"}],ref:"scrollWrapper",staticClass:"style-content__list-wrapper",class:[l.isNoRecentUsed?"style-content__list-wrapper-no-margin":""],style:{gridTemplateColumns:"repeat(".concat(l.gridNum,", 1fr)")},on:{scroll:l.handleScroll}},[l.renderList.length?l._l(l.renderList,(function(e){var t;return r("div",{key:e.id,staticClass:"style-content__list-item",class:[l.activeSelectModel(e)],on:{click:function(t){return t.stopPropagation(),function(t){return l.handleSelect(e,l.activeSelectModel(e),t)}.apply(null,arguments)}}},[r("div",{staticClass:"top-box"},[e.is_agency_fee?r("div",{staticClass:"payNum"},[r("modelPayNum",{attrs:{number:e.agency_fee}})],1):l._e()]),l._v(" "),r("div",{staticClass:"cltpop"},[r("div",{staticClass:"collect-popover-container"},[r("CollectPopover",{attrs:{type:"model",folder:e,from:"waterfall"}})],1),l._v(" "),r("div",{staticClass:"detail-button",on:{click:function(t){return t.stopPropagation(),l.handleDetail(e)}}},[l._v("\n              "+l._s(l.$t("Details"))+"\n            ")])]),l._v(" "),r("div",{staticClass:"list-item-image-wrapper"},[["",null,void 0].includes(null==e||null===(t=e.banner)||void 0===t?void 0:t.url)?r("div",{staticClass:"list-item-image-card-image"},[r("div",{staticClass:"image-empty"},[l._v(l._s(l.$t("EmptyBannerText")))])]):r("el-image",{staticClass:"list-item-image-card-image",attrs:{src:l.getImageUrl(e)}},[r("template",{slot:"error"},[r("img",{directives:[{name:"webp",rawName:"v-webp",value:l.$imgL,expression:"$imgL"}],staticClass:"list-item-image-card-image",attrs:{src:e&&e.banner?e.banner.url:"",alt:""}})])],2)],1),l._v(" "),r("div",{staticClass:"list-item-image-mask"},[r("div",{staticClass:"list-item-image-mask-row"},[r("span",{staticClass:"list-item-image-mask-item__content",attrs:{title:e.name}},[l._v(l._s(e.name))])]),l._v(" "),r("div",{staticClass:"list-item-image-mask-row"},[r("changeVer",{attrs:{from:"styleModal",item:e,base_models:l.getBaseModel},on:{selectItem:function(t){return l.selectItem(t,e,l.activeSelectModel(e))}}}),l._v(" "),r("div",{staticClass:"use",on:{click:function(t){return t.stopPropagation(),function(t){return l.handleSelect(e,l.activeSelectModel(e),t)}.apply(null,arguments)}}},[l._v(l._s(l.$t("workFlow46")))])],1)]),l._v(" "),"Pony"===(null==e?void 0:e.base_model)?[r("span",{staticClass:"model-type-flag"},[l._v("\n              "+l._s("TextualInversion"===l.modelType?l.$t("embedding1"):l.modelType)),r("span",{staticClass:"model-type-flag-line"},[l._v("|")]),r("i",{staticClass:"iconfont icon-icon-horse model-type-flag-icon"})])]:[r("span",{directives:[{name:"show",rawName:"v-show",value:""!==l.convertModelFlag(e),expression:"convertModelFlag(item) !==''"}],staticClass:"model-type-flag"},[l._v(l._s(l.convertModelFlag(e)))])]],2)})):l._e(),l._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:l.showRecommendText,expression:"showRecommendText"}],staticClass:"recommend-text",style:{gridColumn:"span ".concat(l.gridNum)}},[r("div",{staticClass:"recommend-text-line"}),l._v(" "),r("div",{staticClass:"recommend-text-main"},[l._v(l._s(l.$t("styleModalLineText")))]),l._v(" "),r("div",{staticClass:"recommend-text-line"})]),l._v(" "),!l.loading&&l.hotUsedList.length&&"mine"===l.activeTab&&["comprehensive"].includes(l.queryType)?[l._l(l.hotUsedList,(function(e){var t;return r("div",{key:"hot_".concat(e.id),staticClass:"style-content__list-item",class:[l.activeSelectModel(e)],on:{click:function(t){return t.stopPropagation(),function(t){return l.handleSelect(e,l.activeSelectModel(e),t)}.apply(null,arguments)}}},[r("div",{staticClass:"top-box"},[e.is_agency_fee?r("div",{staticClass:"payNum",attrs:{num:""}},[r("modelPayNum",{attrs:{number:e.agency_fee}})],1):l._e()]),l._v(" "),r("div",{staticClass:"cltpop"},[r("div",{staticClass:"collect-popover-container"},[r("CollectPopover",{attrs:{type:"model",folder:e,from:"waterfall"}})],1),l._v(" "),r("div",{staticClass:"detail-button",on:{click:function(t){return t.stopPropagation(),l.handleDetail(e)}}},[l._v("\n              "+l._s(l.$t("Details"))+"\n            ")])]),l._v(" "),r("div",{staticClass:"list-item-image-wrapper"},[["",null,void 0].includes(null==e||null===(t=e.banner)||void 0===t?void 0:t.url)?r("div",{staticClass:"list-item-image-card-image"},[r("div",{staticClass:"image-empty"},[l._v(l._s(l.$t("EmptyBannerText")))])]):r("el-image",{staticClass:"list-item-image-card-image",attrs:{src:l.getImageUrl(e)}},[r("template",{slot:"error"},[r("img",{directives:[{name:"webp",rawName:"v-webp",value:l.$imgL,expression:"$imgL"}],staticClass:"list-item-image-card-image",attrs:{src:e&&e.banner?e.banner.url:"",alt:""}})])],2),l._v(" "),r("div",{staticClass:"list-item-image-mask"},[r("div",{staticClass:"list-item-image-mask-row"},[r("span",{staticClass:"list-item-image-mask-item__content",attrs:{title:e.name}},[l._v(l._s(e.name))])]),l._v(" "),r("div",{staticClass:"list-item-image-mask-row"},[r("changeVer",{attrs:{from:"styleModal",item:e,base_models:l.getBaseModel},on:{selectItem:function(t){return l.selectItem(t,e,l.activeSelectModel(e))}}}),l._v(" "),r("div",{staticClass:"use",on:{click:function(t){return t.stopPropagation(),function(t){return l.handleSelect(e,l.activeSelectModel(e),t)}.apply(null,arguments)}}},[l._v(l._s(l.$t("workFlow46")))])],1)])],1),l._v(" "),"Pony"===(null==e?void 0:e.base_model)?[r("span",{staticClass:"model-type-flag"},[l._v("\n              "+l._s("TextualInversion"===l.modelType?l.$t("embedding1"):l.modelType)),r("span",{staticClass:"model-type-flag-line"},[l._v("|")]),r("i",{staticClass:"iconfont icon-icon-horse model-type-flag-icon"})])]:[r("span",{directives:[{name:"show",rawName:"v-show",value:""!==l.convertModelFlag(e),expression:"convertModelFlag(item) !==''"}],staticClass:"model-type-flag"},[l._v(l._s(l.convertModelFlag(e)))])]],2)})),l._v(" "),r("div",{staticClass:"show-more-item",style:{gridColumn:"span ".concat(l.gridNum)}},[r("span",{staticClass:"show-more-item-btn",on:{click:function(e){return e.stopPropagation(),l.handleViewMore()}}},[r("span",{staticClass:"show-more-item-btn-text"},[l._v(l._s(l.$t("viewMore")))]),l._v(" "),r("i",{staticClass:"iconfont icon-icon-direction-down show-more-item-btn-icon"})])])]:l._e(),l._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:l.showEmptyResult,expression:"showEmptyResult"}],staticClass:"style-content__list-empty"},[r("svg-icon",{staticClass:"style-content__list-empty-icon",attrs:{"icon-class":"style-empty-icon"}}),l._v(" "),"LORA"===l.modelType&&"mine"===l.activeTab&&["recent"].includes(l.queryType)&&["",null,void 0].includes(l.queryParam.keyword)?[l._v("\n          "+l._s(l.$t("styleRecent"))+"\n        ")]:"LORA"===l.modelType&&["collect"].includes(l.queryType)&&"mine"===l.activeTab&&["",null,void 0].includes(l.queryParam.keyword)?[l._v("\n          "+l._s(l.$t("styleCollect"))+"\n        ")]:[l._v(l._s(l.$t("NoResultsFound")))]],2),l._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:l.showTagEmpty,expression:"showTagEmpty"}],staticClass:"tag-empty-box flex_c_m"},[r("div",{staticClass:"item flex_c"},[r("p",[l._v(l._s(l.$t("screenTagNodata",{keyword:l.keyWordCopy?' "'.concat(l.keyWordCopy,'" '):""})))]),l._v(" "),r("div",{staticClass:"btn",on:{click:l.screenAll}},[l._v(l._s(l.$t("screenAll")))])])]),l._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:l.tabShowTagEmpty,expression:"tabShowTagEmpty"}],staticClass:"style-content__list-empty"},[r("svg-icon",{staticClass:"style-content__list-empty-icon",attrs:{"icon-class":"style-empty-icon"}}),l._v(" "),r("p",[l._v(l._s(l.$t("NoResultsFound")))])],1)],2)])])}),[],!1,null,"177e1afe",null);t.a=component.exports},1532:function(e,t,n){e.exports={}},1533:function(e,t,n){e.exports={}},1534:function(e,t,n){e.exports={}},1593:function(e,t,n){e.exports={}},1630:function(e,t,n){e.exports={}},1631:function(e,t,n){e.exports={}},1632:function(e,t,n){e.exports={}},1633:function(e,t,n){e.exports={}},1634:function(e,t,n){e.exports={}},1635:function(e,t,n){e.exports={}},1636:function(e,t,n){e.exports={}},1637:function(e,t,n){e.exports={}},1638:function(e,t,n){e.exports={}},1639:function(e,t,n){e.exports={}},1640:function(e,t,n){e.exports={}},1641:function(e,t,n){e.exports={}},1642:function(e,t,n){e.exports={}},1643:function(e,t,n){e.exports={}},1645:function(e,t,n){e.exports={}},1646:function(e,t,n){e.exports={}},1647:function(e,t,n){e.exports={}},1648:function(e,t,n){e.exports={}},1649:function(e,t,n){e.exports={}},1650:function(e,t,n){e.exports={}},1651:function(e,t,n){e.exports={}},1652:function(e,t,n){e.exports={}},1653:function(e,t,n){e.exports={}},1654:function(e,t,n){e.exports={}},1655:function(e,t,n){e.exports={}},1656:function(e,t,n){e.exports={}},1657:function(e,t,n){e.exports={}},1658:function(e,t,n){e.exports={}},1659:function(e,t,n){e.exports={}},1660:function(e,t,n){e.exports={}},1661:function(e,t,n){e.exports={}},1662:function(e,t,n){e.exports={}},1663:function(e,t,n){e.exports={}},1664:function(e,t,n){e.exports={}},1665:function(e,t,n){e.exports={}},1666:function(e,t,n){e.exports={}},1667:function(e,t,n){e.exports={}},1668:function(e,t,n){e.exports={}},1669:function(e,t,n){e.exports={}},1670:function(e,t,n){e.exports={}},1671:function(e,t,n){e.exports={}},1672:function(e,t,n){e.exports={}},1673:function(e,t,n){e.exports={}},1674:function(e,t,n){e.exports={}},1675:function(e,t,n){e.exports={}},1676:function(e,t,n){e.exports={}},1677:function(e,t,n){e.exports={}},1678:function(e,t,n){e.exports={}},1679:function(e,t,n){e.exports={}},168:function(e,t,n){"use strict";n(16),n(10),n(14),n(9),n(11),n(12);var o=n(3),l=n(2),r=(n(20),n(7),n(70),n(19),n(28),n(89),n(8),n(4),n(441),n(23),n(125),n(18),n(37),n(6),n(215)),c=n(86),d=n(26),h=n(65),m=n(154),v=n(272),f=n(35),_=n.n(f),y=n(1),w=n(22),C=n(5),k=n(207),S=n(13);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O={CONTAIN:{name:"contain",icon:"el-icon-full-screen"},ORIGINAL:{name:"original",icon:"el-icon-c-scale-to-original"}},T=Object(m.a)()?"DOMMouseScroll":"mousewheel",$={components:{ViewImage:k.a,AiChatCreteConfirm:r.a},name:"taskImageViewer",props:{operateNumber:{type:Number,default:function(){return 1}},urlList:{type:Array,default:function(){return[]}},zIndex:{type:Number,default:2e3},onSwitch:{type:Function,default:function(){}},onClose:{type:Function,default:function(){}},initialIndex:{type:Number,default:0},appendToBody:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},showOperateBtn:{type:Boolean,default:function(){return!1}},message:{type:Object,default:function(){return{}}},msgId:{type:String,default:""},loraModels:{type:Object,default:function(){}},hoverBtnRenderList:{type:Array,default:function(){return[]}},nsfw:{type:Number,default:2}},data:function(){return{showMask:!1,index:this.initialIndex,isShow:!1,infinite:!0,loading:!1,mode:O.CONTAIN,transform:{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1},isI18nToggled:!1,intLoraModel:[],getMetaLoading:!1,alreadySave:!1}},computed:I(I(I(I({},Object(y.c)(["isSupportWebp"])),Object(y.c)("user",["accountSettingsData","isCompanyAccount","userInfo"])),Object(y.c)("creation",["studioStyle","lab_styles"])),{},{isMyMsg:function(){var e,t;return(null===(e=this.message)||void 0===e||null===(e=e.messageInfo)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id)===this.userInfo.id||!(null!==(t=this.message)&&void 0!==t&&t.messageInfo)},isShowSaveTo:function(){var e,t=this.message.img_uris,n=void 0===t?[]:t;return!!n.length&&(!(null!==(e=n[this.operateNumber-1])&&void 0!==e&&e.is_saved_personal)&&this.isMyMsg&&!this.alreadySave)},renderBtn:function(){var e=this,map={post:{type:"post",label:"Post",tip:"PostTips"},animGen:{type:"animGen",label:"AnimGen",tip:"AnimTips"},extraUpscale:{type:"extraUpscale",label:"taskTabUpscale",tip:"ExtraUpscale"},upscale:{type:"upscale",label:"OriginalityUpscale",tip:"WorkUpscale"},variations:{type:"variations",label:"Variations",tip:"WorkVariations"},removeBackground:{type:"removeBackground",label:"RemoveBackground"},chat:{type:"chat",label:"gpt_tab_chat",tip:"createChartacterToChat"},aiGenerateVideo:{type:"aiGenerateVideo",label:"ImageToVideo",tip:"ImageToVideoTip"}},t=[],n=["deleteSingleImg","save","post","animGen","chat"],o=null,l=null,r=null;return this.hoverBtnRenderList.forEach((function(c){var d=I(I({},c),map[c.code]);"upscale"===c.code&&e.isStudioMode&&d.tip&&d.tip.replace("2048*2048","3072*3072"),!n.includes(c.code)&&t.push(d),"post"===c.code&&(o=d),"animGen"===c.code&&(l=d),"chat"===c.code&&(r=d)})),l&&t.unshift(l),o&&t.unshift(o),r&&t.push(r),t.push({type:"download",label:"Download",icon:"modelDownload",tip:"SG_DownloadHover"}),t},studioRenderList:function(){var e=this;return(this.lab_styles||[]).map((function(t){var n="labStyle_".concat(t.value.replace(/\s/g,""));return{label:e.$t(n)||t.value,id:t.value}}))},getStudioStyle:function(){var e,t=(null===(e=this.message.meta)||void 0===e||null===(e=e.lab_base)||void 0===e?void 0:e.style_selections)||[];return(this.studioRenderList||[]).filter((function(e){return t.includes(e.id)})).map((function(e){return e.label})).join("、")||""},isSdModel:function(){var e,t;return[5,"5","sdxl"].includes(null==this||null===(e=this.message)||void 0===e?void 0:e.channel)||[5,"5","sdxl"].includes(null==this||null===(t=this.message)||void 0===t?void 0:t.category)},isStudioMode:function(){var e,t;return["studio",7,"7",11].includes(null==this||null===(e=this.message)||void 0===e?void 0:e.channel)||["studio",7,"7",11].includes(null==this||null===(t=this.message)||void 0===t?void 0:t.category)},isStudioFlux:function(){var e,t;return this.isStudioMode&&((null===(e=this.message)||void 0===e?void 0:e.art_model_no)===S.h||[1,"1"].includes(null===(t=this.message)||void 0===t?void 0:t.sub_model_category))},isSingle:function(){return this.urlList.length<=1},isFirst:function(){return 0===this.index},isLast:function(){return this.index===this.urlList.length-1},currentImg:function(){return this.getImageUrl(this.urlList[this.index].url)},currentImgInfo:function(){return this.urlList[this.index]},imgStyle:function(){var e=this.transform,t=e.scale,n=e.deg,o=e.offsetX,l=e.offsetY,r=e.enableTransition,style={transform:"scale(".concat(t,") rotate(").concat(n,"deg)"),transition:r?"transform .3s":"","margin-left":"".concat(o,"px"),"margin-top":"".concat(l,"px")};return this.mode===O.CONTAIN&&(style.maxWidth=style.maxHeight="100%"),style},viewerZIndex:function(){var e=v.a.nextZIndex();return this.zIndex>e?this.zIndex:e},setI18nPrompt:function(){var e=this.message.local_prompt,t=this.message.meta?this.message.meta.prompt:"";return this.isI18nToggled?e:t},convertTaskType:function(){var e={1:"Txt2Img",2:"Upscaling",3:"Variations",4:"taskTabUpscale",5:"RemoveBackground",6:"GetDescriptors",7:"TaskUploadImage",8:"conditionToImage",10:"Preview",11:"Expansion",13:"taskTabUpscale"};return e[this.message.type]?e[this.message.type]:""}}),watch:{accountSettingsData:{handler:function(e){this.isI18nToggled=!e.is_off_localization},deep:!0},index:{handler:function(e){this.reset(),this.onSwitch(e)}},currentImg:function(e){var t=this;this.$nextTick((function(e){t.$refs.img[0].complete||(t.loading=!0)}))}},methods:{init:function(){var e,t=this;if(this.msgId){this.getMetaLoading=!0;var n=this.loraModels&&0===Object.keys(this.loraModels).length,o=["",null,void 0].includes(null===(e=this.message)||void 0===e?void 0:e.art_model_name),l=![this.loraModels&&this.loraModels[this.msgId]];[n,o,l].some((function(e){return e}))?Object(w.h)({id:this.msgId}).then((function(e){var o,l,r;if(1e4===e.status.code){t.intLoraModel=(null===(o=e.data.meta)||void 0===o?void 0:o.lora_models)||[];var c={};c[t.msgId]=t.intLoraModel;var d=(null==e||null===(l=e.data)||void 0===l?void 0:l.art_model_name)||"";t.$emit("uploadMate",null==e?void 0:e.data),["",null,void 0].includes(null===(r=t.message)||void 0===r?void 0:r.art_model_name)&&t.$set(t.message,"art_model_name",d),n&&t.$emit("setLoraModel",c)}})).finally((function(){t.getMetaLoading=!1})):this.getMetaLoading=!1,this.intLoraModel&&!this.intLoraModel.length&&(this.intLoraModel=this.loraModels[this.msgId]||[])}},handleConfirm:function(){this.showMask=!1,this.handleChat()},viewImage:function(e){this.$refs.viewImage.show(e,this.$refs.img[0],2)},isVideoUrl:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[".mp4",".mkv",".webm",".avi",".mov",".flv",".wmv"].some((function(t){return(e||"").toLowerCase().endsWith(t)}))},openLora:function(e){var t=this.localePath("/models/detail/".concat(e.art_model.id));window.open(t,"_blank")},hide:function(){this.deviceSupportUninstall(),this.onClose()},deviceSupportInstall:function(){var e=this;this._keyDownHandler=function(t){switch(t.stopPropagation(),t.keyCode){case 27:e.hide();break;case 32:e.toggleMode();break;case 37:e.prev();break;case 38:e.handleActions("zoomIn");break;case 39:e.next();break;case 40:e.handleActions("zoomOut")}},this._mouseWheelHandler=Object(m.b)((function(t){var n,o=t.wheelDelta?t.wheelDelta:-t.detail;["el-image-viewer__canvas task-image-viewer__canvas","el-image-viewer__img task-image-viewer__img"].includes(null==t||null===(n=t.target)||void 0===n?void 0:n.className)&&(o>0?e.handleActions("zoomIn",{zoomRate:.015,enableTransition:!1}):e.handleActions("zoomOut",{zoomRate:.015,enableTransition:!1}))})),Object(h.e)(document,"keydown",this._keyDownHandler),Object(h.e)(document,T,this._mouseWheelHandler)},deviceSupportUninstall:function(){Object(h.d)(document,"keydown",this._keyDownHandler),Object(h.d)(document,T,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},handleImgLoad:function(e){this.loading=!1},handleImgError:function(e){this.loading=!1,e.target.alt="加载失败"},handleMouseDown:function(e){var t=this;if(!this.loading&&0===e.button){var n=this.transform,o=n.offsetX,l=n.offsetY,r=e.pageX,c=e.pageY;this._dragHandler=Object(m.b)((function(e){t.transform.offsetX=o+e.pageX-r,t.transform.offsetY=l+e.pageY-c})),Object(h.e)(document,"mousemove",this._dragHandler),Object(h.e)(document,"mouseup",(function(e){Object(h.d)(document,"mousemove",t._dragHandler)})),e.preventDefault()}},handleMaskClick:function(){this.maskClosable&&this.hide()},reset:function(){this.transform={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}},toggleMode:function(){if(!this.loading){var e=Object.keys(O),t=(Object.values(O).indexOf(this.mode)+1)%e.length;this.mode=O[e[t]],this.reset()}},prev:function(){if(!this.isFirst||this.infinite){var e=this.urlList.length;this.index=(this.index-1+e)%e}},next:function(){if(!this.isLast||this.infinite){var e=this.urlList.length;this.index=(this.index+1)%e}},handleActions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.loading){var n=I({zoomRate:.2,rotateDeg:90,enableTransition:!0},t),o=n.zoomRate,l=n.rotateDeg,r=n.enableTransition,c=this.transform;switch(e){case"zoomOut":c.scale>.2&&(c.scale=parseFloat((c.scale-o).toFixed(3)));break;case"zoomIn":c.scale=parseFloat((c.scale+o).toFixed(3));break;case"clocelise":c.deg+=l;break;case"anticlocelise":c.deg-=l}c.enableTransition=r}},handleOperateBtnClick:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,h,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=(null===(o=t.urlList)||void 0===o||null===(o=o[t.index||0])||void 0===o?void 0:o.url)||"",n.t0=e.type,n.next="chat"===n.t0?4:"post"===n.t0?10:"animGen"===n.t0?12:"download"===n.t0?14:"aiGenerateVideo"===n.t0?16:20;break;case 4:return n.next=6,Object(d.D)({channel:"task",source_id:null===(l=t.message)||void 0===l?void 0:l.id});case 6:return c=n.sent,h=c.data.character_id,(void 0===h?"":h)?t.handleChat():t.showMask=!0,n.abrupt("break",22);case 10:return t.handlePost(),n.abrupt("break",22);case 12:return t.handleAnimate(),n.abrupt("break",22);case 14:return Object(C.z)(r),n.abrupt("break",22);case 16:return m={cover:r},m=JSON.stringify(m),window.open(t.localePath("/ai-tools/ai-video-generator?info=".concat(m))),n.abrupt("break",22);case 20:return t.$emit("imageOperate",e.type,_()(t.urlList[t.index])),n.abrupt("break",22);case 22:case"end":return n.stop()}}),n)})))()},getImageUrl:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:""},handleChat:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,h,m,v,f,_,y,w;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return v={height:null===(n=e.message)||void 0===n||null===(n=n.banner)||void 0===n?void 0:n.height,width:null===(o=e.message)||void 0===o||null===(o=o.banner)||void 0===o?void 0:o.width,id:null===(l=e.message)||void 0===l?void 0:l.id,url:e.currentImg||(null===(r=e.message)||void 0===r||null===(r=r.banner)||void 0===r?void 0:r.url),source_account_id:(null===(c=e.message)||void 0===c||null===(c=c.messageInfo)||void 0===c||null===(c=c.author)||void 0===c?void 0:c.id)||(null===(h=e.userInfo)||void 0===h?void 0:h.id),channel:"task"},t.next=3,Object(d.D)({channel:"task",source_id:v.id});case 3:if(f=t.sent,_=(null==f?void 0:f.data)||{},y=_.can,2!==(void 0===y?2:y)){t.next=8;break}return e.$message.warning(e.$t("chatFail")),t.abrupt("return");case 8:if(!e.isShowSaveTo||1===e.nsfw){t.next=12;break}return t.next=11,e.handleSave(v);case 11:return t.abrupt("return");case 12:localStorage.setItem("createParams",JSON.stringify(v)),w="/cyberPubPage/".concat(null===(m=e.message)||void 0===m?void 0:m.id,"?quickChat=true&source=work"),window.open(e.localePath(w),"_blank");case 15:case"end":return t.stop()}}),t)})))()},handleSave:function(){var e=arguments,t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,l,r,d,h,m,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=e.length>0&&void 0!==e[0]?e[0]:null,console.log("handleSave"),l=t.message,r=l.id,d=void 0===r?"":r,h=l.img_uris,m=(void 0===h?[]:h)[t.operateNumber-1].index,v=void 0===m?"":m,Object(c.a)({folder_no:"default",id:d,index:v}).then((function(){if(t.$emit("saveSuccess"),o){var e;localStorage.setItem("createParams",JSON.stringify(o));var n="/cyberPubPage/".concat(null===(e=t.message)||void 0===e?void 0:e.id,"?quickChat=true&source=work");window.open(t.localePath(n),"_blank")}})).catch((function(e){console.log("saveFail",e)}));case 5:case"end":return n.stop()}}),n)})))()},handlePost:function(){var e={taskId:this.message.id,url:this.currentImg,index:this.currentImgInfo.index};this.$logEvent("log_actions",{operation:"click_post_picture_button",behavior_info:"on_creative_flow_details",behavior_info_sub:e.url}),this.$EventBus.$emit("openCreativeCenterModal",{list:[e],type:"text",source:"task"}),this.hide()},handleAnimate:function(){this.$emit("handleAnimate"),this.hide()}},mounted:function(){this.init(),this.isI18nToggled=!this.accountSettingsData.is_off_localization,this.deviceSupportInstall(),this.appendToBody&&document.body.appendChild(this.$el),this.$refs["el-image-viewer__wrapper"].focus()},destroyed:function(){this.appendToBody&&this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)}},L=$,P=(n(2339),n(2340),n(0)),component=Object(P.a)(L,(function(){var e,t,n=this,o=n._self._c;return o("transition",{attrs:{name:"viewer-fade"}},[o("div",{ref:"el-image-viewer__wrapper",staticClass:"el-image-viewer__wrapper c-task-image-viewer",style:{"z-index":n.viewerZIndex},attrs:{tabindex:"-1"}},[o("div",{staticClass:"el-image-viewer__mask",on:{click:function(e){return e.target!==e.currentTarget?null:n.handleMaskClick.apply(null,arguments)}}}),n._v(" "),n.showOperateBtn?n._e():o("span",{staticClass:"el-image-viewer__btn el-image-viewer__chat",on:{click:n.handleChat}},[o("i",{staticClass:"iconfont icon-a-home-top-personl1"})]),n._v(" "),n.showOperateBtn?n._e():o("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:n.hide}},[o("i",{staticClass:"el-icon-close"})]),n._v(" "),n.showOperateBtn?n._e():o("span",{staticClass:"el-image-viewer__btn el-image-viewer__download",on:{click:function(e){return n.handleOperateBtnClick({type:"download"})}}},[o("i",{staticClass:"iconfont icon-icon-Download"})]),n._v(" "),n.showOperateBtn?n._e():o("div",{staticClass:"el-image-viewer__btn el-image-viewer__actions"},[o("div",{staticClass:"el-image-viewer__actions__inner"},[o("i",{staticClass:"el-icon-zoom-out",on:{click:function(e){return n.handleActions("zoomOut")}}}),n._v(" "),o("i",{staticClass:"el-icon-zoom-in",on:{click:function(e){return n.handleActions("zoomIn")}}}),n._v(" "),o("i",{staticClass:"el-image-viewer__actions__divider"}),n._v(" "),o("i",{class:n.mode.icon,on:{click:n.toggleMode}}),n._v(" "),o("i",{staticClass:"el-image-viewer__actions__divider"}),n._v(" "),o("i",{staticClass:"el-icon-refresh-left",on:{click:function(e){return n.handleActions("anticlocelise")}}}),n._v(" "),o("i",{staticClass:"el-icon-refresh-right",on:{click:function(e){return n.handleActions("clocelise")}}})])]),n._v(" "),o("div",{staticClass:"el-image-viewer__canvas task-image-viewer__canvas"},[n.isSingle?n._e():[o("span",{staticClass:"el-image-viewer__btn el-image-viewer__prev",class:{"is-disabled":!n.infinite&&n.isFirst},on:{click:n.prev}},[o("i",{staticClass:"el-icon-arrow-left"})]),n._v(" "),o("span",{staticClass:"el-image-viewer__btn el-image-viewer__next",class:{"is-disabled":!n.infinite&&n.isLast},on:{click:n.next}},[o("i",{staticClass:"el-icon-arrow-right"})])],n._v(" "),n._l(n.urlList,(function(e,i){return[i!==n.index||n.isVideoUrl(n.currentImg)?i===n.index?o("video",{key:i,staticClass:"el-image-viewer__img task-image-viewer__img",style:n.imgStyle,attrs:{src:n.currentImg,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0},on:{play:n.handleImgLoad}}):n._e():o("img",{directives:[{name:"webp",rawName:"v-webp",value:n.$imgH,expression:"$imgH"}],key:i,ref:"img",refInFor:!0,staticClass:"el-image-viewer__img task-image-viewer__img",style:n.imgStyle,attrs:{src:n.currentImg,referrerpolicy:"no-referrer"},on:{load:n.handleImgLoad,mousedown:n.handleMouseDown,click:function(e){return n.viewImage(n.currentImg)}}})]})),n._v(" "),n.isVideoUrl(n.currentImg)?n._e():o("i",{staticClass:"iconfont icon-icon-enlarge",on:{click:function(e){return n.viewImage(n.currentImg)}}})],2),n._v(" "),n.showOperateBtn?o("div",{staticClass:"task-image-viewer__side-bar"},[o("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:n.hide}},[o("i",{staticClass:"el-icon-close"})]),n._v(" "),o("div",{staticClass:"btn-box",class:(null===(e=n.renderBtn)||void 0===e?void 0:e.length)%2?"odd":"even"},[n._l(n.renderBtn,(function(e){return[o("el-tooltip",{key:e.type,attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"bottom",disabled:!(null!=e&&e.tip),content:n.$t(null==e?void 0:e.tip)}},[o("div",{staticClass:"button",class:e.type,on:{click:function(t){return t.stopPropagation(),n.handleOperateBtnClick(e)}}},[o("span",{staticClass:"icon"},[o("i",{staticClass:"iconfont",class:"icon-".concat(e.icon)})]),n._v(" "),o("span",{staticClass:"label"},[n._v(" "+n._s(n.$t(e.label)))])])])]}))],2),n._v(" "),[0,"0"].includes(n.currentImgInfo.operateNumber)?n._e():o("div",{staticClass:"message-divider"},[o("span",{staticClass:"message-divider-content"},[n._v(n._s(n.$t("GenerationData")))])]),n._v(" "),o("div",{staticClass:"task-image-viewer__prompt-box",class:[n.currentImgInfo&&[0,"0"].includes(n.currentImgInfo.operateNumber)?"task-image-viewer__prompt-box-margin-top":""]},[o("div",{staticClass:"task-image-viewer__prompt-title"},[o("span",{staticClass:"prompt-title-text"},[n._v(n._s(n.$t("Prompt")))]),n._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:n.convertTaskType,expression:"convertTaskType"}],staticClass:"message__title-task-tag"},[n._v(n._s(n.$t(n.convertTaskType)))])]),n._v(" "),o("div",{staticClass:"task-image-viewer__prompt-content"},[n._v("\n            "+n._s(n.setI18nPrompt)+"\n          ")]),n._v(" "),n.isSdModel||n.isStudioMode?n._e():[o("div",{staticClass:"task-image-viewer__prompt-title"},[o("span",{staticClass:"prompt-title-text"},[n._v(n._s(n.$t("NegativePrompts")))])]),n._v(" "),o("div",{staticClass:"task-image-viewer__prompt-content"},[n._v("\n              "+n._s(n.message.meta.negative_prompt||"")+"\n            ")])],n._v(" "),n.isSdModel||n.isStudioFlux?n._e():o("div",{staticClass:"task-image-viewer__params"},[o("span",{staticClass:"task-image-viewer__params-label"},[n._v(n._s(n.$t("Sampler")))]),n._v(" "),o("span",{staticClass:"task-image-viewer__params-content"},[n._v(n._s(n.message.meta.sampler_name))])]),n._v(" "),n.isStudioMode&&!n.isStudioFlux?o("div",{staticClass:"task-image-viewer__params"},[o("span",{staticClass:"task-image-viewer__params-label"},[n._v(n._s(n.$t("studio20")))]),n._v(" "),o("span",{staticClass:"task-image-viewer__params-content"},[n._v(n._s((null===(t=n.message.meta)||void 0===t||null===(t=t.lab_base)||void 0===t?void 0:t.scheduler)||""))])]):n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!n.isStudioFlux,expression:"!isStudioFlux"}],staticClass:"task-image-viewer__params"},[o("span",{staticClass:"task-image-viewer__params-label"},[n._v(n._s(n.$t("CFGScale")))]),n._v(" "),o("span",{staticClass:"task-image-viewer__params-content2"},[o("span",{staticClass:"task-image-viewer__params-content-3"},[n._v(n._s(n.message.meta.cfg_scale))]),n._v(" "),o("span",[o("span",{staticClass:"task-image-viewer__params-label"},[n._v(n._s(n.$t("Steps")))]),n._v(" "),o("span",{staticClass:"task-image-viewer__params-content-3"},[n._v(n._s(n.message.meta.steps))])])])]),n._v(" "),n.isSdModel||n.isStudioMode&&!n.isStudioFlux?n._e():o("div",{staticClass:"task-image-viewer__params"},[o("span",{staticClass:"task-image-viewer__params-label"},[n._v(n._s(n.$t("Seed")))]),n._v(" "),o("span",{staticClass:"task-image-viewer__params-content"},[n._v(n._s(n.message.meta.seed))])]),n._v(" "),o("div",{staticClass:"task-image-viewer__params"},[o("span",{staticClass:"task-image-viewer__params-label"},[n._v(n._s(n.$t("imageDimensions")))]),n._v(" "),o("span",{staticClass:"task-image-viewer__params-content"},[n._v(n._s("".concat(n.currentImgInfo.width," X ").concat(n.currentImgInfo.height)))])]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!n.getMetaLoading,expression:"!getMetaLoading"}],staticClass:"task-image-viewer__params"},[o("span",{staticClass:"task-image-viewer__params-label"},[n._v(n._s(n.$t("Model")))]),n._v(" "),o("span",{staticClass:"scale-link-class"},[n._v(n._s(n.message.art_model_name||n.message.art_model_no))])]),n._v(" "),n.intLoraModel.length>0?o("div",{staticClass:"task-image-viewer__params",staticStyle:{"flex-wrap":"wrap","justify-content":"flex-start","align-items":"self-start"}},[o("span",{staticClass:"task-image-viewer__params-label"},[n._v("Lora")]),n._v(" "),o("div",{staticClass:"scaleBox"},n._l(n.intLoraModel,(function(e){return o("div",{key:e.id,staticClass:"scale-link-class",on:{click:function(t){return n.openLora(e)}}},[n._v("\n                "+n._s(e.art_model.name)+"\n              ")])})),0)]):n._e()],2)]):n._e(),n._v(" "),o("view-image",{ref:"viewImage"}),n._v(" "),o("AiChatCreteConfirm",{attrs:{"dialog-visible":n.showMask,source:"task"},on:{"update:dialogVisible":function(e){n.showMask=e},"update:dialog-visible":function(e){n.showMask=e},confirm:n.handleConfirm}})],1)])}),[],!1,null,"056f62fc",null);t.a=component.exports},1680:function(e,t,n){e.exports={}},1681:function(e,t,n){e.exports={}},1682:function(e,t,n){e.exports={}},1683:function(e,t,n){e.exports={}},1684:function(e,t,n){e.exports={}},1685:function(e,t,n){e.exports={}},1686:function(e,t,n){e.exports={}},1687:function(e,t,n){e.exports={}},1688:function(e,t,n){e.exports={}},1689:function(e,t,n){e.exports={}},1690:function(e,t,n){e.exports={}},1691:function(e,t,n){e.exports={}},1692:function(e,t,n){e.exports={}},1693:function(e,t,n){e.exports={}},1694:function(e,t,n){e.exports={}},1695:function(e,t,n){e.exports={}},1696:function(e,t,n){e.exports={}},1697:function(e,t,n){e.exports={}},1698:function(e,t,n){e.exports={}},1699:function(e,t,n){e.exports={}},1700:function(e,t,n){e.exports={}},1701:function(e,t,n){e.exports={}},1702:function(e,t,n){e.exports={}},1703:function(e,t,n){e.exports={}},1704:function(e,t,n){e.exports={}},1705:function(e,t,n){e.exports={}},1706:function(e,t,n){e.exports={}},1707:function(e,t,n){e.exports={}},1708:function(e,t,n){e.exports={}},1709:function(e,t,n){e.exports={}},1710:function(e,t,n){e.exports={}},1711:function(e,t,n){e.exports={}},1712:function(e,t,n){e.exports={}},1713:function(e,t,n){e.exports={}},1714:function(e,t,n){e.exports={}},1715:function(e,t,n){e.exports={}},1716:function(e,t,n){e.exports={}},1717:function(e,t,n){e.exports={}},1718:function(e,t,n){e.exports={}},1719:function(e,t,n){e.exports={}},1720:function(e,t,n){e.exports={}},1721:function(e,t,n){e.exports={}},1722:function(e,t,n){e.exports={}},1723:function(e,t,n){e.exports={}},1724:function(e,t,n){e.exports={}},1725:function(e,t,n){e.exports={}},1726:function(e,t,n){e.exports={}},1727:function(e,t,n){e.exports={}},1728:function(e,t,n){e.exports={}},1729:function(e,t,n){e.exports={}},1730:function(e,t,n){e.exports={}},1731:function(e,t,n){e.exports={}},1732:function(e,t,n){e.exports={}},1733:function(e,t,n){e.exports={}},1734:function(e,t,n){e.exports={}},1735:function(e,t,n){e.exports={}},1736:function(e,t,n){e.exports={}},1737:function(e,t,n){e.exports={}},1738:function(e,t,n){e.exports={}},1739:function(e,t,n){e.exports={}},1740:function(e,t,n){e.exports={}},1741:function(e,t,n){e.exports={}},1742:function(e,t,n){e.exports={}},1743:function(e,t,n){e.exports={}},1744:function(e,t,n){e.exports={}},1745:function(e,t,n){e.exports={}},1746:function(e,t,n){e.exports={}},1747:function(e,t,n){e.exports={}},1748:function(e,t,n){e.exports={}},1749:function(e,t,n){e.exports={}},1750:function(e,t,n){e.exports={}},1751:function(e,t,n){e.exports={}},1752:function(e,t,n){e.exports={}},1753:function(e,t,n){e.exports={}},1754:function(e,t,n){e.exports={}},1755:function(e,t,n){e.exports={}},1756:function(e,t,n){e.exports={}},1757:function(e,t,n){e.exports={}},1758:function(e,t,n){e.exports={}},1759:function(e,t,n){e.exports={}},1760:function(e,t,n){e.exports={}},1761:function(e,t,n){e.exports={}},1762:function(e,t,n){e.exports={}},1763:function(e,t,n){e.exports={}},1764:function(e,t,n){e.exports={}},1765:function(e,t,n){e.exports={}},1766:function(e,t,n){e.exports={}},1767:function(e,t,n){e.exports={}},1768:function(e,t,n){e.exports={}},1769:function(e,t,n){e.exports={}},1770:function(e,t,n){e.exports={}},1771:function(e,t,n){e.exports={}},1772:function(e,t,n){e.exports={}},1773:function(e,t,n){e.exports={}},1774:function(e,t,n){e.exports={}},1775:function(e,t,n){e.exports={}},1776:function(e,t,n){e.exports={}},1777:function(e,t,n){e.exports={}},1778:function(e,t,n){e.exports={}},1779:function(e,t,n){e.exports={}},1780:function(e,t,n){e.exports={}},1781:function(e,t,n){e.exports={}},1782:function(e,t,n){e.exports={}},1783:function(e,t,n){e.exports={}},1784:function(e,t,n){e.exports={}},1785:function(e,t,n){e.exports={}},1786:function(e,t,n){e.exports={}},1787:function(e,t,n){e.exports={}},1800:function(e,t,n){e.exports={}},1801:function(e,t,n){e.exports={}},1802:function(e,t,n){e.exports={}},1803:function(e,t,n){e.exports={}},1804:function(e,t,n){e.exports={}},1805:function(e,t,n){e.exports={}},1806:function(e,t,n){e.exports={}},1807:function(e,t,n){e.exports={}},1808:function(e,t,n){e.exports={}},1809:function(e,t,n){e.exports={}},1810:function(e,t,n){e.exports={}},1811:function(e,t,n){e.exports={}},1812:function(e,t,n){e.exports={}},1813:function(e,t,n){e.exports={}},1837:function(e,t,n){e.exports={}},1838:function(e,t,n){e.exports={}},1839:function(e,t,n){"use strict";n(10),n(14),n(18);var o=n(69),l=n(3),r=n(15),c=n(2),d=(n(20),n(16),n(9),n(7),n(32),n(47),n(19),n(36),n(43),n(8),n(11),n(12),n(4),n(50),n(6),n(48),n(142),n(143),n(112),n(1)),h=n(73),m=n(151),v=n(22),f=n(506),_=n(5),y=n(82),w=n(271),C={name:"modelList",props:["list"],components:{modelPayNum:y.a,changeVerNew:w.a},data:function(){return{}},methods:{handleOpenPopup:function(){try{var e;null===(e=this.$refs.versionPanelSelect)||void 0===e||e.openPopup()}catch(e){}},handleChangeModelVersion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$emit("updateModelVersionInfo",e)},changeUrl:function(e){return Object(_.x)(e,"high")},changeWeight:function(e,t){this.$emit("change","WEIGHT",t,e)},deleteModel:function(e){this.$emit("change","DEL",e)},viewLora:function(i){var e=this.list[i],t=this.localePath("/models/detail/".concat(e.art_model_no));window.open(t,"_blank")}}},k=C,S=(n(3004),n(0)),component=Object(S.a)(k,(function(){var e,t=this,n=t._self._c;return n("div",{directives:[{name:"show",rawName:"v-show",value:null===(e=t.list)||void 0===e?void 0:e.length,expression:"list?.length"}],staticClass:"model-list"},t._l(t.list,(function(img,i){return n("div",{key:"selectMode_"+i,staticClass:"lora-item"},[n("div",{staticClass:"image-box",on:{click:function(e){return t.viewLora(i)}}},[img.banner.url?[n("el-image",{attrs:{src:img.banner&&t.changeUrl(img.banner.url)}},[n("template",{slot:"placeholder"},[n("i",{staticClass:"el-icon-loading image-loading"})]),t._v(" "),n("template",{slot:"error"},[n("img",{staticClass:"select-model-image",attrs:{src:img&&img.banner?img.banner.url:"",alt:""}})])],2),t._v(" "),n("div",{staticClass:"version-panel",on:{click:function(e){return e.stopPropagation(),t.handleOpenPopup.apply(null,arguments)}}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:null==img?void 0:img.version_name,placement:"top"}},[n("div",{staticClass:"version-panel-text"},[t._v(t._s(null==img?void 0:img.version_name))])]),t._v(" "),n("div",{staticClass:"version-panel-icon el-icon-caret-bottom"}),t._v(" "),n("change-ver-new",{ref:"versionPanelSelect",refInFor:!0,staticClass:"version-item",staticStyle:{opacity:"0 !important"},attrs:{from:"styleModal",item:img,base_models:[null==img?void 0:img.base_model]},on:{selectItem:t.handleChangeModelVersion}})],1)]:n("p",{staticClass:"empty-img"},[t._v(t._s(t.$t("EmptyBannerText")))])],2),t._v(" "),n("div",{staticClass:"slider slider-item"},[n("p",{staticClass:"lora-name ellipsis",on:{click:function(e){return t.viewLora(i)}}},[t._v(t._s(img.name))])]),t._v(" "),n("span",{staticClass:"select-model-box",on:{click:function(e){return t.deleteModel(i)}}},[n("i",{staticClass:"iconfont icon-select-model-icon delete-icon"}),t._v(" "),n("span",{staticClass:"select-model-box-text"},[t._v(t._s(t.$t("switch")))])])])})),0)}),[],!1,null,"108557be",null),x=component.exports,I={name:"ImagePromptsList",components:{SliderItem:n(107).a},inject:["top"],props:{list:{type:Array,default:function(){return[]}},isStudioFlux:{type:Boolean,default:!1}},data:function(){return{paramTemplate:{image:"",stop_at:1,weight:1,mode:"ImagePrompt"}}},methods:{changeConfig:function(e,t,n){this.$emit("update",e,t,n)},deleteParam:function(i){var e=JSON.parse(JSON.stringify(this.list));try{e[i]&&(e.splice(i,1),this.$emit("deleteParam",i))}catch(e){}}}},O=(n(3005),Object(S.a)(I,(function(){var e,t=this,n=t._self._c;return n("div",{directives:[{name:"show",rawName:"v-show",value:null===(e=t.list)||void 0===e?void 0:e.length,expression:"list?.length"}],staticClass:"c-image-prompts-list"},t._l(t.list,(function(e,i){return n("div",{directives:[{name:"loading",rawName:"v-loading",value:null==e?void 0:e.loading,expression:"item?.loading"}],key:"imagePrompts_"+i,staticClass:"image-prompts-list-item"},[n("div",{staticClass:"image-box"},[e.image?n("el-image",{attrs:{src:e.image}},[n("template",{slot:"placeholder"},[n("i",{staticClass:"el-icon-loading image-loading"})]),t._v(" "),n("template",{slot:"error"},[n("img",{staticClass:"select-model-image",attrs:{src:e.image?e.image:"",alt:""}})])],2):n("p",{staticClass:"empty-img"},[t._v(t._s(t.$t("EmptyBannerText")))]),t._v(" "),n("span",{staticClass:"delete-icon",on:{click:function(e){return e.stopPropagation(),t.deleteParam(i)}}},[n("i",{staticClass:"el-icon-delete"})])],1),t._v(" "),n("div",{staticClass:"right-params-box",class:[t.isStudioFlux?"right-params-box-row":""]},[n("slider-item",{directives:[{name:"show",rawName:"v-show",value:!t.isStudioFlux,expression:"!isStudioFlux"}],attrs:{value:e.stop_at,min:0,max:1,step:.001,label:"Stop At",tips:t.$t("studio3"),"show-tooltip":!1,precision:3},on:{change:function(e){return t.changeConfig(e,i,"stop_at")}}}),t._v(" "),n("slider-item",{attrs:{value:e.weight,min:0,max:t.isStudioFlux?1:2,step:.001,label:"ImagePrompt"===(null==e?void 0:e.mode)?t.$t("newGenerate66"):t.$t("studio4"),"show-tooltip":!1,precision:3},on:{change:function(e){return t.changeConfig(e,i,"weight")}}})],1)])})),0)}),[],!1,null,"3f4880a9",null).exports),T=n(24),$=n(45),L=n(116),P=n(13);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){Object(c.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var D={name:"selectGenerateModelType",components:{StyleModal:m.a,LoraList:f.a,modelList:x,ImagePromptsList:O,SliderItem:L.a},props:["value"],inject:["top"],data:function(){return{modelType:1,selectList:[{code:1,label:"默认",i18nKey:"createModeType1",tips:""},{code:2,label:"海艺V6",i18nKey:"createModeType2",tips:"createModeTips2"},{code:6,label:"海艺2.1",i18nKey:"createModeType6",tips:"createModeTips6"},{code:3,label:"预览版",i18nKey:"createModeType3",tips:"createModeTips3"}],createSettings:[{code:1,i18nKey:"createSetting1",tips:""},{code:2,i18nKey:"createSetting2",tips:"createSettingTips1"}],createSetting:1,loading:!1,visible:!1,selectIds:[],selectModelType:"Checkpoint",extraModelList:[],uploadingIp:!1}},watch:{paymentInfo:{handler:function(){},immediate:!0,deep:!0},accountSettingsData:{handler:function(){this.createSetting=this.accountSettingsData.is_auto_pub_community?1:2},immediate:!0,deep:!0},"value.art_model_no":{handler:function(e,t){if(this.setInitModelList(e),this.isStudioMode&&this.resetStudioQualityType(),this.isStudioMode&&"textToImage"===this.top.menuIndex){var n,o;if(e===(null===(n=this.top)||void 0===n?void 0:n.fluxModelId)&&t!==e){var l;this.resetStudioFluxSize();var code=null===(l=this.queueRenderList[0])||void 0===l?void 0:l.code;this.handleQueueSelectChange(code)}if(e!==t&&t===(null===(o=this.top)||void 0===o?void 0:o.fluxModelId)){var r,c=this.top.getStudioDefaultStyle(null===(r=this.value)||void 0===r?void 0:r.base_model_type),d=JSON.parse(JSON.stringify(this.value));d.studio.width=null==c?void 0:c.width,d.studio.height=null==c?void 0:c.height,d.ipList=[],d.lab_base.conds=(d.lab_base.conds||[]).filter((function(e){return"IpMaintain"!==e.mode})),this.$emit("input",d)}}},immediate:!0},"value.base_model_type":{handler:function(e,t){if(this.isStudioMode&&"textToImage"===this.top.menuIndex&&null!==P.B&&void 0!==P.B&&P.B.sa.includes(e)&&t!==e){var n;this.resetStudioFluxSize();var code=null===(n=this.queueRenderList[0])||void 0===n?void 0:n.code;this.handleQueueSelectChange(code)}},immediate:!0},isStudioMode:{handler:function(e){e&&(this.extraModelList=[])},immediate:!0},isSdMode:{handler:function(e){e&&(this.extraModelList=[])},immediate:!0},getCurrentModelType:{handler:function(e,t){if(this.isStudioMode){var n=JSON.parse(JSON.stringify(this.value));"SD3"===e&&t!==e&&(n.sampler_name="dpmpp_2m",n.lab_base.quality_open=!1,n.lab_base.scheduler="sgm_uniform"),"SD3"===t&&t!==e&&(n.sampler_name="dpmpp_2m_sde_gpu",n.lab_base.quality_open=!1,n.lab_base.scheduler="karras"),this.$emit("input",n)}},immediate:!0}},computed:j(j(j(j({},Object(d.c)("payment",["productLevel","activeState","paymentInfo"])),Object(d.c)("user",["userInfo","accountSettingsData","isCompanyAccount"])),Object(d.c)("creation",["taskBaseModels","sd_xl_base_model","lab_base_model"])),{},{showIpUpload:function(){var e;return!(null!==(e=this.value)&&void 0!==e&&e.ipList.some((function(e){return"IpMaintain"===e.mode})))},isStudioInfinity:function(){var e,t,n=this.top.fluxModelId;return(this.value.art_model_no===n&&!(null!==(e=this.value)&&void 0!==e&&null!==(e=e.lora_models)&&void 0!==e&&e.length)||(null===(t=this.value)||void 0===t||null===(t=t.base_model_type)||void 0===t?void 0:t.includes("Flux")))&&["textToImage"].includes(this.top.menuIndex)&&this.isStudioMode},isStudioFlux:function(){var e,t=this.top.fluxModelId,n=this.value.base_model_type,o=((null===P.B||void 0===P.B?void 0:P.B.sa)||[]).includes(n);return(this.value.art_model_no===t||o||(null===(e=this.value)||void 0===e||null===(e=e.base_model_type)||void 0===e?void 0:e.includes("Flux")))&&["textToImage"].includes(this.top.menuIndex)&&this.isStudioMode},isStudioSD35:function(){return["textToImage"].includes(this.top.menuIndex)&&this.isStudioMode&&"SD 3.5"===this.getCurrentModelType},showImagePromptsUpload:function(){var e,t,n=this.top.config.textToImage,o=4;return this.isStudioFlux&&(o=1),(null==n||null===(e=n.lab_base)||void 0===e||null===(e=e.conds)||void 0===e?void 0:e.length)>=0&&(null==n||null===(t=n.lab_base)||void 0===t||null===(t=t.conds)||void 0===t?void 0:t.length)<o},modelList:function(){var e,t;return[{art_model_no:this.value.art_model_no,art_model_ver_no:this.value.art_model_ver_no,name:this.value.modelName,is_agency_fee:this.value.is_agency_fee||this.value.agency_fee>0,agency_fee:this.value.agency_fee,banner:{url:this.value.model_cover||""},version_name:this.value.art_model_ver_no_name||"",base_model_type:this.value.base_model_type||"",base_model:this.value.base_model_type||"",modelTags:Array.isArray(null===(e=this.value)||void 0===e?void 0:e.modelTags)?null===(t=this.value)||void 0===t?void 0:t.modelTags:[],id:this.value.art_model_no,version_no:this.value.art_model_ver_no}]},isShowModel:function(){return!["faceSwap","preview","promptStudio"].includes(this.top.menuIndex)&&![3,"3",4,"4"].includes(this.value.category)},isSdMode:function(){return[5,"5","sdxl"].includes(this.value.category)},isVipFun:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},isOnlyVipLite:function(){var e,t;return!(null!==(e=this.paymentInfo)&&void 0!==e&&e.activeState)&&!this.isCompanyAccount&&(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)},canUseUnlimitedQueue:function(){var e;return null===(e=this.paymentInfo)||void 0===e?void 0:e.infiniteQueue},isStudioMode:function(){return["textToImage","imageToImage","conditionToImage"].includes(this.top.menuIndex)&&[7,"studio",11].includes(this.value.category)},renderList:function(){return this.selectList.filter((function(e){return![3,"3"].includes(e.code)}))},queueRenderList:function(){return[{code:1,i18nKey:"NormalQueue",tips:"",show:!this.isVipFun},{code:2,i18nKey:"SubsBottomTerms2",tips:"",isVip:!0,show:this.isVipFun},{code:3,i18nKey:"UnlimitedQueue",tips:this.UnlimitedQueueTip,isVip:!0,show:!(this.isStudioMode||this.isCompanyAccount)}].filter((function(e){return e.show}))},UnlimitedQueueTip:function(){return this.isCompanyAccount?"ToBUnlimitedQueueTip":"UnlimitedQueueTip"},modelsList:function(){var e=this,t=this.value,n=t.art_work_no,o=t.art_model_no,l=t.art_model_ver_no,c=void 0===l?"":l;if(this.isSdMode){var d=this.sd_xl_base_model.map((function(e){var t=e.artwork,l=e.name,r=e.id,d=e.model_ver_no,h=void 0===d?"":d,m=t?null==t?void 0:t.id:"";return{workId:n!==m&&o===r?n:m,name:l,id:r,art_model_ver_no:h||c,banner:{url:e.cover||""},version_name:(null==e?void 0:e.model_ver_name)||"",base_model_type:(null==e?void 0:e.base_model)||"",base_model:(null==e?void 0:e.base_model)||"",modelTags:Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[]}}));return[].concat(Object(r.a)(this.extraModelList),Object(r.a)(d))}if(this.isStudioMode){var h,m=this.lab_base_model.map((function(e){e.artwork;var t=e.name,n=e.id,o=e.model_ver_no;return{name:t,id:n,art_model_ver_no:(void 0===o?"":o)||c,banner:{url:e.cover||""},version_name:(null==e?void 0:e.model_ver_name)||"",base_model_type:(null==e?void 0:e.base_model)||"",base_model:(null==e?void 0:e.base_model)||"",modelTags:Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[]}})),v=[].concat(Object(r.a)(this.extraModelList),Object(r.a)(m));return this.isStudioMode&&["imageToImage","conditionToImage"].includes(null==this||null===(h=this.top)||void 0===h?void 0:h.menuIndex)&&(v=v.filter((function(t){var n,o=null==t?void 0:t.base_model.includes("SD 3.5"),l=((null===P.B||void 0===P.B?void 0:P.B.sa)||[]).includes(null==t?void 0:t.base_model),r=(null==t?void 0:t.id)===(null===(n=e.top)||void 0===n?void 0:n.fluxModelId);return!(o||r||l)}))),v}var f=this.taskBaseModels.map((function(e){var t=e.artwork,l=e.name,r=e.id,d=e.model_ver_no,h=void 0===d?"":d,m=t?null==t?void 0:t.id:"";return{workId:n!==m&&o===r?n:m,name:l,id:r,art_model_ver_no:h||c,banner:{url:e.cover||""},version_name:(null==e?void 0:e.model_ver_name)||"",base_model_type:(null==e?void 0:e.base_model)||"",base_model:(null==e?void 0:e.base_model)||"",modelTags:Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[]}}));return[].concat(Object(r.a)(this.extraModelList),Object(r.a)(f))},getCurrentModelType:function(){var e=(this.value||{}).base_model_type,t=void 0===e?"":e,n=null===P.B||void 0===P.B?void 0:P.B.flux,o=(null===P.B||void 0===P.B?void 0:P.B.sa)||[],l=null===P.B||void 0===P.B?void 0:P.B.sd35,r=["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony"].includes(t)||(t||"").includes("SDXL"),c=["SD 1.5","SD 2.0","SD 1.4","SD 2.1 768","SD 2.1","SD 2.0 768","SD 1.5 LCM"].includes(t),d=n.includes(t)||(t||"").includes("Flux"),h=o.includes(t),m=l.includes(t)||(t||"").includes("SD 3.5");return h?"SA":d?"FLUX":r?"SDXL":c?"SD":"SD 3"===t?"SD3":"Other"===t?"Other":m?"SD 3.5":void 0}}),methods:j(j({},Object(d.b)("user",["getAccountInfo"])),{},{handleUpdateModelVersion:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=JSON.parse(JSON.stringify(this.value));n.art_model_ver_no=null==t?void 0:t.model_ver_id,n.model_cover=(null==t||null===(e=t.sample)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.url)||"",n.art_model_ver_no_name=(null==t?void 0:t.version_no)||(null==t?void 0:t.model_ver_id),this.$emit("input",n)},handleUpdateLoraVersion:function(e,t){var n=this.value.lora_models;try{var o,l;if(n[t].version_name=(null==e?void 0:e.version_no)||(null==e?void 0:e.model_ver_id),n[t].model_ver_no=null==e?void 0:e.model_ver_id,null!=e&&null!==(o=e.sample)&&void 0!==o&&null!==(o=o.banner)&&void 0!==o&&o.url)n[t].banner.url=null==e||null===(l=e.sample)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.url;this.changeConfig({lora_models:n})}catch(e){}},resetStudioQualityType:function(){var e,t,n;if(![3,"3"].includes(null===(e=this.value)||void 0===e||null===(e=e.lab_base)||void 0===e?void 0:e.quality_mode)){var o=JSON.parse(JSON.stringify(this.value)),l=null==this||null===(t=this.top)||void 0===t?void 0:t.getStudioModelTagsType(o);l!==(null==o||null===(n=o.lab_base)||void 0===n?void 0:n.quality_type)&&(o.lab_base.quality_type=l||"anime",this.$emit("input",o))}},resetStudioFluxSize:function(){var e,t=JSON.parse(JSON.stringify(this.value));null!==(e=t.studio)&&void 0!==e&&e.keepImageSize?t.studio.keepImageSize=!1:(t.studio.width=688,t.studio.height=1024);try{var n,o,l,r,c;if(null!=t&&null!==(n=t.lab_base)&&void 0!==n&&null!==(n=n.conds)&&void 0!==n&&n.length)t.lab_base.conds=null!=t&&null!==(l=t.lab_base)&&void 0!==l&&null!==(l=l.conds)&&void 0!==l&&l.length?null===(r=t.lab_base)||void 0===r?void 0:r.conds.slice(0,1):[],((null==t||null===(c=t.lab_base)||void 0===c?void 0:c.conds)||[]).forEach((function(e){e.weight=.8}));null!=t&&null!==(o=t.lora_models)&&void 0!==o&&o.length&&(t.lora_models=((null==t?void 0:t.lora_models)||[]).filter((function(e){return((null===P.B||void 0===P.B?void 0:P.B.sa)||[]).includes(null==e?void 0:e.base_model)})))}catch(e){}this.$emit("input",t)},addImagePrompts:function(){var e,t=4;this.isStudioFlux&&(t=1),(null===(e=this.value)||void 0===e||null===(e=e.lab_base)||void 0===e||null===(e=e.conds)||void 0===e?void 0:e.length)>=t||this.$refs.imagePromptsUpload.$el.querySelector(".image-prompts-upload-btn").click()},handleDeleteImagePrompts:function(i){var e,t,n=JSON.parse(JSON.stringify(this.value));null!=n&&null!==(e=n.lab_base)&&void 0!==e&&e.conds[i]&&(null==n||null===(t=n.lab_base)||void 0===t||t.conds.splice(i,1));this.$emit("input",n)},addIpList:function(){var e;(null===(e=this.value)||void 0===e||null===(e=e.ipList)||void 0===e?void 0:e.length)>=1||this.$refs.ipCondsUpload.$el.querySelector(".ip-prompts-upload-btn").click()},handleDeleteIp:function(i){var e,t=this,n=JSON.parse(JSON.stringify(this.value));null!=n&&n.ipList[i]&&(null==n||n.ipList.splice(i,1),((null==n||null===(e=n.lab_base)||void 0===e?void 0:e.conds)||[]).forEach((function(e){"ImagePrompt"===(null==e?void 0:e.mode)&&.35===(null==e?void 0:e.weight)&&t.$set(e,"weight",.8)})));this.$emit("input",n)},changeIpConfig:function(e,t,n){try{var o=JSON.parse(JSON.stringify(this.value));o.ipList[t][n]=e,this.$emit("input",o)}catch(e){}},handleBeforeUploadIp:function(e){var t=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("上传ip"),l=t.top.UPLOAD,["image/jpeg","image/png","image/webp","image/jpg"].includes(e.type)){n.next=6;break}return t.$message.error(t.$t("AllowImageFiles")),n.abrupt("return",!1);case 6:if(!(r=e)||r.size){n.next=9;break}return n.abrupt("return",!1);case 9:if(!((null===(o=t.value)||void 0===o||null===(o=o.ipList)||void 0===o?void 0:o.length)>=1)){n.next=11;break}return n.abrupt("return");case 11:return c=Object(T.uniqueId)("ipPromptList_"),d=URL.createObjectURL(new Blob([t.fileToBlob(e)])),t.updateIpImage(c,d),h=!0,n.prev=15,n.next=18,Object($.a)(e,5242880);case 18:r=n.sent,n.next=25;break;case 21:n.prev=21,n.t0=n.catch(15),console.error("Compression failed:",n.t0),h=!1;case 25:if(h){n.next=28;break}return t.updateIpImage(c,""),n.abrupt("return",!1);case 28:return t.uploadingIp=!0,l.startUpload(r,{category:49}).then((function(e){t.uploadingIp=!1,t.updateIpImage(c,e)})).catch((function(e){t.uploadingIp=!1,t.updateIpImage(c,"")})),n.abrupt("return",!1);case 31:case"end":return n.stop()}}),n,null,[[15,21]])})))()},updateIpImage:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=(this.value.ipList||[]).findIndex((function(e){return(null==e?void 0:e.id)===t}));if(-1===o){var l,r={image:n,stop_at:1,weight:.75,mode:"IpMaintain",loading:!0,id:t};this.value.ipList.push(r);var c=JSON.parse(JSON.stringify(this.value));((null==c||null===(l=c.lab_base)||void 0===l?void 0:l.conds)||[]).forEach((function(t){"ImagePrompt"===(null==t?void 0:t.mode)&&e.$set(t,"weight",.35)})),this.$emit("input",c)}else if(n){var d=JSON.parse(JSON.stringify(this.value));d.ipList[o].image=n,d.ipList[o].loading=!1,this.$emit("input",d)}else{var h=JSON.parse(JSON.stringify(this.value));null!=h&&h.ipList[o]&&(null==h||h.ipList.splice(o,1)),this.$emit("input",h)}},changeImagePromptsConfig:function(e,t,n){try{var o=JSON.parse(JSON.stringify(this.value));o.lab_base.conds[t][n]=e,this.$emit("input",o)}catch(e){}},checkImageSize:function(e){return new Promise((function(t,n){var o=new FileReader;o.onload=function(e){var img=new Image;img.onload=function(){var e=img.naturalWidth,n=img.naturalHeight;t({width:e,height:n})},img.onerror=function(){n(!1)},img.src=e.target.result},o.readAsDataURL(e)}))},handleBeforeUpload:function(e){var t=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l=t.top.UPLOAD,["image/jpeg","image/png","image/webp","image/jpg"].includes(e.type)){n.next=5;break}return t.$message.error(t.$t("AllowImageFiles")),n.abrupt("return",!1);case 5:if(!(r=e)||r.size){n.next=8;break}return n.abrupt("return",!1);case 8:if(!((null===(o=t.value.lab_base)||void 0===o||null===(o=o.conds)||void 0===o?void 0:o.length)>=4)){n.next=10;break}return n.abrupt("return");case 10:return n.next=12,t.checkImageSize(e);case 12:return c=n.sent,d=Object(T.uniqueId)("imagePromptList_"),h=URL.createObjectURL(new Blob([t.fileToBlob(e)])),t.updateImage(d,h),m=!0,n.prev=17,n.next=20,Object($.a)(e,5242880);case 20:r=n.sent,n.next=27;break;case 23:n.prev=23,n.t0=n.catch(17),console.error("Compression failed:",n.t0),m=!1;case 27:if(m){n.next=30;break}return t.updateImage(d,""),n.abrupt("return",!1);case 30:return t.uploading=!0,l.startUpload(r,{category:2}).then((function(e){var n,o,l;t.uploading=!1;var r=t.top.getStudioDefaultStyle(null===(n=t.value)||void 0===n?void 0:n.base_model_type,t.isStudioFlux),h=t.top.convertStudioBaseSize(null==c?void 0:c.width,null==c?void 0:c.height,r),m=JSON.parse(JSON.stringify(t.value));m.studio.width=(null==h?void 0:h.width)||r.width,m.studio.height=(null==h?void 0:h.height)||r.height,console.log("图片宽：".concat(null==c?void 0:c.width," 图片高：").concat(null==c?void 0:c.height),"转换后图片宽:".concat(null===(o=m.studio)||void 0===o?void 0:o.width," 转换后图片高:").concat(null===(l=m.studio)||void 0===l?void 0:l.height),h),t.$set(t.value,"studio",m.studio),t.updateImage(d,e)})).catch((function(e){t.uploading=!1,t.$message.error(t.$t("uploadError")),t.updateImage(d,"")})),n.abrupt("return",!1);case 33:case"end":return n.stop()}}),n,null,[[17,23]])})))()},fileToBlob:function(e){return e.slice(0,e.size,e.type)},updateImage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=(this.value.lab_base.conds||[]).findIndex((function(t){return(null==t?void 0:t.id)===e}));if(-1===n){var o={image:t,stop_at:1,weight:1,mode:"ImagePrompt",loading:!0,id:e};if(this.isStudioFlux){var l,r=!(null===(l=this.value)||void 0===l||null===(l=l.ipList)||void 0===l||!l.length);o.weight=r?.35:.8}this.value.lab_base.conds.push(o)}else{var c=JSON.parse(JSON.stringify(this.value));c.lab_base.conds[n].image=t,c.lab_base.conds[n].loading=!1,this.$emit("input",c),t||this.handleDeleteImagePrompts(n)}},handleIconClick:function(){this.top.resetConfig(!1,"refresh")},hidePopover:function(){},handleCreateSettingSelectChange:function(e){![2,"2"].includes(e)||this.paymentInfo.show_auto_pub_switch?this.saveSettings(e):this.$EventBus.$emit("showBreakDialog","PrivateWorkTipWeb","basic")},saveSettings:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.loading=!0;var n={};n.auto_pub_community=t,Object(h.b)(n).then((function(n){var o=(n||{}).status.code;["10000",1e4].includes(void 0===o?"":o)&&(e.$message.success(e.$t("SaveSuccess")),e.createSetting=t,e.loading=!1,e.getAccountInfo())})).finally((function(){e.loading=!1}))},getSettingsInfo:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.loading){t.next=2;break}return t.abrupt("return");case 2:e.loading=!0,e.getAccountInfo().then((function(t){var n=t||{},o=n.status.code,code=void 0===o?"":o,l=n.data,data=void 0===l?{}:l;if(["10000",1e4].includes(code)){var r=data.is_auto_pub_community,c=void 0===r||r;e.createSetting=c?1:2}})).finally((function(){e.loading=!1}));case 4:case"end":return t.stop()}}),t)})))()},changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));t&&(n[t]=e),n=j(j({},n),e),this.$emit("input",n)},studioChangeConfig:function(e,t){if(this.isStudioMode&&["prompt_magic"].includes(t)){var n=JSON.parse(JSON.stringify(this.value));n.lab_base.prompt_magic=e,this.$emit("input",n)}},changeCategory:function(e,t){var n,o=JSON.parse(JSON.stringify(this.value)),l=o.MJ,r={MJ:{}};if(3!==e&&3!==o.category||(["local_prompt","prompt","art_work_no"].forEach((function(e){r.MJ[e]=o[e]})),r=j(j({},r),l)),r.category=e,"textToImage"===(null==this||null===(n=this.top)||void 0===n?void 0:n.menuIndex)){if([5,"5"].includes(r.category)){r.cfg_scale=5,r.steps=30,r.enablePromptMagic=!0,r.sdxl={prompt_magic:.4,prompt_style:"Fantasy Art"};var c=this.sd_xl_base_model[0];r.art_work_no="",r.art_model_ver_no=(null==c?void 0:c.model_ver_no)||"",r.agency_fee=0,r.art_model_no=c.id,r.modelName=c.name,r.model_cover=c.cover||"",r.art_model_ver_no_name=(null==c?void 0:c.model_ver_name)||"",r.lora_models=[],r.sampler_name="DPM++ 2M Karras"}else r.cfg_scale=7,r.steps=20,r.sampler_name="DPM++ 2M Karras";[5,"5"].includes(t)&&t!==r.category&&this.top.resetTextToImageMode()}localStorage.setItem("defaultCategory",r.category),this.changeConfig(r)},handleSelectChange:function(e){if(!e||![3,"3"].includes(e)||this.activeState||this.isCompanyAccount){var t=this.value.category;this.changeCategory(e,t)}else this.$message.warning(this.$t("error_code_70010"))},handleQueueSelectChange:function(e){if(![3].includes(e)||3!=e||this.isVipFun){if(!([3].includes(e)&&this.isStudioMode&&this.isCompanyAccount))if([3].includes(e)&&this.isOnlyVipLite)this.$EventBus.$emit("showUpgradeDialog","UnlimitedQueueTipWeb","standard");else if(![3].includes(e)||this.canUseUnlimitedQueue)for(var i in localStorage.setItem("speed_type",e),this.top.config)this.top.config[i]=j(j({},this.top.config[i]),{},{speed_type:e});else this.$EventBus.$emit("showUpgradeDialog","UnlimitedQueueTipWeb","standard")}else this.$EventBus.$emit("showBreakDialog","UnlimitedQueueTipWeb","standard")},setInitModelList:function(e){var t=this.value,n=t.art_work_no,o=t.modelName,l=t.art_model_no,r=t.category,c=t.agency_fee,d=void 0===c?0:c,h=t.model_cover,m=void 0===h?"":h,v=t.art_model_ver_no_name,f=void 0===v?"":v,_=t.base_model_type,y=void 0===_?"":_,w=t.modelTags,C=void 0===w?[]:w;this.extraModelList=[];var k=this.taskBaseModels.some((function(e){return e.id===l}));if(this.isSdMode&&(k=this.sd_xl_base_model.some((function(e){return e.id===l}))),this.isStudioMode&&(k=this.lab_base_model.some((function(e){return e.id===l}))),3!==r){if(!e){var S,x,I,O,T,$,L,P,M,j,D,N,E,R,A,B,U,F,z,V;if(this.isSdMode){var W=(null==this?void 0:this.sd_xl_base_model[0])||{},H=W.name,G=W.artwork,J=void 0===G?{}:G,K=W.id,X=W.art_model_ver_no,Q=W.agency_fee,Z=void 0===Q?0:Q,Y=W.cover,ee=void 0===Y?"":Y,te=W.art_model_ver_no_name,ie=void 0===te?"":te,ne=W.model_ver_no,ae=void 0===ne?"":ne,oe=W.model_ver_name,se=void 0===oe?"":oe,le=W.base_model,re=void 0===le?"":le,ce=W.tags,de=void 0===ce?[]:ce;return void this.changeConfig({art_work_no:(null==J?void 0:J.id)||"",modelName:H,art_model_no:K,art_model_ver_no:ae||X,agency_fee:Z||0,model_cover:ee||"",art_model_ver_no_name:se||ie,base_model_type:re||"",modelTags:Array.isArray(de)?de:[]})}return this.isStudioMode?void this.changeConfig({art_work_no:(null===(D=this.lab_base_model[0])||void 0===D||null===(D=D.artwork)||void 0===D?void 0:D.id)||"",modelName:null===(N=this.lab_base_model[0])||void 0===N?void 0:N.name,art_model_no:null===(E=this.lab_base_model[0])||void 0===E?void 0:E.id,art_model_ver_no:null===(R=this.lab_base_model[0])||void 0===R?void 0:R.model_ver_no,agency_fee:(null===(A=this.lab_base_model[0])||void 0===A?void 0:A.agency_fee)||0,model_cover:(null===(B=this.lab_base_model[0])||void 0===B?void 0:B.cover)||"",art_model_ver_no_name:(null===(U=this.lab_base_model[0])||void 0===U?void 0:U.model_ver_name)||"",base_model_type:(null===(F=this.lab_base_model[0])||void 0===F?void 0:F.base_model)||"",modelTags:Array.isArray(null===(z=this.lab_base_model[0])||void 0===z?void 0:z.tags)?null===(V=this.lab_base_model[0])||void 0===V?void 0:V.tags:[]}):void this.changeConfig({art_work_no:(null===(S=this.taskBaseModels[0])||void 0===S||null===(S=S.artwork)||void 0===S?void 0:S.id)||"",modelName:null===(x=this.taskBaseModels[0])||void 0===x?void 0:x.name,art_model_no:null===(I=this.taskBaseModels[0])||void 0===I?void 0:I.id,art_model_ver_no:null===(O=this.taskBaseModels[0])||void 0===O?void 0:O.model_ver_no,agency_fee:(null===(T=this.taskBaseModels[0])||void 0===T?void 0:T.agency_fee)||0,model_cover:(null===($=this.taskBaseModels[0])||void 0===$?void 0:$.cover)||"",art_model_ver_no_name:(null===(L=this.taskBaseModels[0])||void 0===L?void 0:L.model_ver_name)||"",base_model_type:(null===(P=this.taskBaseModels[0])||void 0===P?void 0:P.base_model)||"",modelTags:Array.isArray(null===(M=this.taskBaseModels[0])||void 0===M?void 0:M.tags)?null===(j=this.taskBaseModels[0])||void 0===j?void 0:j.tags:[]})}k||(this.extraModelList=[{id:l,name:o,workId:n,agency_fee:d||0,banner:{url:m||""},version_name:f,base_model_type:y,base_model:y,modelTags:Array.isArray(C)?C:[]}])}},changeLora:function(e,t,n){"DEL"===e?this.deleteModel(t):this.changeWeight(n,t)},changeModel:function(e,t,n){"DEL"===e&&this.showModelPopup("Checkpoint")},changeWeight:function(e,t){var n=this.value.lora_models;n[t].weight=e,this.changeConfig({lora_models:n})},showModelPopup:function(e){var t,n=this;if(this.selectModelType=e,"Checkpoint"===e)this.selectIds=[{id:this.value.art_model_no,art_model_ver_no_name:this.value.art_model_ver_no_name,model_cover:this.value.model_cover}];else if(this.selectIds=this.value.lora_models,(null==this||null===(t=this.value)||void 0===t||null===(t=t.lora_models)||void 0===t?void 0:t.length)>=5)return;this.$nextTick((function(){n.$refs.styleModal.openModal()}))},handleSelectModel:function(e){if(null!=e&&e.base_model&&this.$refs.styleModal){var t,n,o,l=(null==e||null===(t=e.base_model)||void 0===t?void 0:t.toLowerCase().includes("sdxl"))||(null==e||null===(n=e.base_model)||void 0===n?void 0:n.toLowerCase().includes("pony"));if(null!==(o=this.$refs.styleModal)&&void 0!==o&&o.isSDXL){if(!l)return void this.$message.error(this.$t("setModelVererr"))}else if(l&&!this.isStudioMode)return void this.$message.error(this.$t("setModelVererr"))}"LORA"===this.selectModelType?this.selectLoraHandle(e):this.selectModelHandle(e),this.$refs.styleModal.handleClose()},selectModelHandle:function(e){var t=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m,v,f,_;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("选择模型处理--",e),"MoreModel"!==e){n.next=4;break}return t.showModelPopup("Checkpoint"),n.abrupt("return");case 4:return n.next=6,t.getModelInfo(e);case 6:if(v=n.sent,t.modelsList.some((function(e){return e.id===v.id}))||(t.extraModelList=[v]),f=[],Array.isArray(null==v?void 0:v.modelTags)&&null!=v&&null!==(o=v.modelTags)&&void 0!==o&&o.length&&(f=null==v?void 0:v.modelTags),Array.isArray(null==v?void 0:v.tags)&&null!=v&&null!==(l=v.tags)&&void 0!==l&&l.length&&(f=null==v?void 0:v.tags),_=v.id===(null==t||null===(r=t.top)||void 0===r?void 0:r.fluxModelId)||((null===P.B||void 0===P.B?void 0:P.B.sa)||[]).includes(v.base_model),!(t.isStudioMode&&["imageToImage","conditionToImage"].includes(null==t||null===(c=t.top)||void 0===c?void 0:c.menuIndex)&&_)){n.next=16;break}return t.$message.warning(t.$t("studioTips1")),n.abrupt("return");case 16:if(!(t.isStudioMode&&v.base_model.includes("Flux")&&["imageToImage","conditionToImage"].includes(null==t||null===(d=t.top)||void 0===d?void 0:d.menuIndex))){n.next=19;break}return t.$message.warning(t.$t("studioTips1")),n.abrupt("return");case 19:t.changeConfig({art_work_no:v.sample_ids?v.sample_ids[0]:v.workId,modelName:v.name,art_model_no:v.id,art_model_ver_no:e.art_model_ver_no||e.model_ver_no||"",agency_fee:(null==e?void 0:e.agency_fee)||0,model_cover:(null==v||null===(h=v.banner)||void 0===h?void 0:h.url)||(null==e||null===(m=e.banner)||void 0===m?void 0:m.url)||"",art_model_ver_no_name:v.version_name||e.version_name,base_model_type:v.base_model,modelTags:f});case 20:case"end":return n.stop()}}),n)})))()},selectLoraHandle:function(e){var t=this.value.lora_models,n=j({model_id:e.id,weight:1},e);if(!((null==t?void 0:t.length)>=5))if(!this.isVipFun&&(null==t?void 0:t.length)>=3)this.$EventBus.$emit("showBreakDialog","LoRALimit5TipWeb","basic");else{var o=t.findIndex((function(e){return e.id===n.id}));-1!==o?t[o]=n:t.push(n),this.changeConfig({lora_models:t})}},viewImage:function(e){var t=this.value.lora_models[e];this.$refs.loraPopup.show(!0,t)},deleteModel:function(e){var t=JSON.parse(JSON.stringify(this.value));t.lora_models.splice(e,1),this.changeConfig({lora_models:t.lora_models})},getModelInfo:function(e){var t=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var l,r,c,d,h,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!("object"===Object(o.a)(e))){n.next=17;break}if(!e.sample_ids&&2!==e.publish_status){n.next=6;break}return n.abrupt("return",e);case 6:if(1!==e.publish_status||e.sample_ids){n.next=8;break}return n.abrupt("return",e);case 8:return n.next=10,Object(v.o)({art_model_ver_no:e.model_ver_no});case 10:return l=n.sent,r=l.data,c=r.art_model,d=c.id,h=c.name,m=r.art_work_no,n.abrupt("return",{id:d,name:h,workId:m,art_model_ver_no:e.model_ver_no,base_model:e.base_model||"",tags:Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[]});case 17:return n.abrupt("return",t.modelsList.find((function(t){return t.id===e})));case 18:case"end":return n.stop()}}),n)})))()}})},N=D,E=(n(3008),n(3009),Object(S.a)(N,(function(){var e,t,o,l,r,c,d,h=this,m=h._self._c;return m("div",{staticClass:"c-select-generate-model-type model-handle handle-item"},[m("div",{staticClass:"item-head"},[m("label",[m("i",{staticClass:"iconfont icon-moxingicon model-icon title"}),h._v("\n        "+h._s(h.$t("taskCommonConfig"))+"\n      ")]),h._v(" "),m("div",{staticClass:"btn-box"},[m("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"left",enterable:!1,content:h.$t("resetAllConfig")}},[m("div",{staticClass:"item-head-btn item-head-btn-margin",on:{click:function(e){return e.stopPropagation(),h.handleIconClick.apply(null,arguments)}}},[m("span",{staticClass:"el-icon-refresh"})])]),h._v(" "),m("el-popover",{ref:"Popover",attrs:{title:"",trigger:"hover","popper-class":"c-select-generate-model-type-popover","append-to-body":!0,"visible-arrow":!1,offset:20},on:{hide:h.hidePopover},model:{value:h.visible,callback:function(e){h.visible=e},expression:"visible"}},[m("div",{staticClass:"item-content"},[null!==(e=h.top)&&void 0!==e&&e.isShowPopup&&!h.isCompanyAccount?m("div",{directives:[{name:"show",rawName:"v-show",value:"promptStudio"!==h.top.menuIndex,expression:"top.menuIndex !== 'promptStudio'"}],staticClass:"h-item m-item"},[m("div",{staticClass:"item-head"},[m("label",[h._v("\n                  "+h._s(h.$t("workPermissions"))+"\n                ")]),h._v(" "),m("el-select",{attrs:{value:h.createSetting,placeholder:"","popper-class":"custom-select custom-select-top-40",loading:h.loading,disabled:h.loading,"popper-append-to-body":!1},on:{change:h.handleCreateSettingSelectChange}},h._l(h.createSettings,(function(e,i){return m("el-option",{key:"createSetting"+i,attrs:{label:h.$t(e.i18nKey),value:e.code}},[h._v("\n                    "+h._s(h.$t(e.i18nKey))+"\n                    "),e.tips?m("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t(e.tips),placement:"top-start"}},[m("span",{staticClass:"el-icon-warning custom-tips"})]):h._e()],1)})),1)],1)]):h._e()]),h._v(" "),m("div",{directives:[{name:"show",rawName:"v-show",value:!["promptStudio"].includes(h.top.menuIndex),expression:"!['promptStudio'].includes(top.menuIndex)"}],staticClass:"item-head-btn",attrs:{slot:"reference"},slot:"reference"},[m("span",{staticClass:"el-icon-setting"})])])],1)]),h._v(" "),m("div",{staticClass:"item-content"},[this.isCompanyAccount||this.isStudioFlux||"SD 3.5"===h.getCurrentModelType?h._e():m("div",{staticClass:"queue-switch refiner-switch"},[m("label",[h._v(h._s(h.$t("daily_rights_2"))+"\n          "),m("el-tooltip",{attrs:{content:h.$t(this.UnlimitedQueueTip),placement:"top-start",effect:"light"}},[m("img",{staticClass:"vip-icon",attrs:{src:n(162),alt:"vip-icon"}})])],1),h._v(" "),m("el-switch",{attrs:{"active-color":"#3F8CFF",value:h.value.speed_type,"active-value":3,"inactive-value":h.queueRenderList[0].code},on:{change:function(e){return h.handleQueueSelectChange(e)}}})],1),h._v(" "),m("div",{directives:[{name:"show",rawName:"v-show",value:h.isShowModel,expression:"isShowModel"}],staticClass:"h-item m-item"},[m("div",{staticClass:"item-head"},[m("label",[h._v("\n            "+h._s(h.$t("Model"))+"\n          ")]),h._v(" "),m("el-select",{staticClass:"opacity-inner",attrs:{value:h.value.art_model_no,placeholder:"","popper-class":"custom-select generate-model-custom-select","popper-append-to-body":!1},on:{change:h.selectModelHandle}},[h._l(h.modelsList,(function(e,i){return m("el-option",{key:"model_"+i,attrs:{label:e.name,value:e.id}},[m("el-tooltip",{attrs:{content:e.name,placement:"left"}},[m("span",[h._v(h._s(e.name))])])],1)})),h._v(" "),m("el-option",{attrs:{label:h.$t("selectMoreModel"),value:"MoreModel"}})],2)],1),h._v(" "),m("model-list",{attrs:{list:h.modelList},on:{change:h.changeModel,updateModelVersionInfo:h.handleUpdateModelVersion}})],1),h._v(" "),m("div",{directives:[{name:"show",rawName:"v-show",value:h.isShowModel&&!["expansion","characterRepair"].includes(h.top.menuIndex)||(null===(t=h.value)||void 0===t?void 0:t.base_model_type.includes("Flux")),expression:"(isShowModel && !['expansion','characterRepair'].includes(top.menuIndex)) || value?.base_model_type.includes('Flux')"}],staticClass:"h-item l-item"},[m("div",{staticClass:"item-head",on:{click:function(e){return h.showModelPopup("LORA",e)}}},[m("label",[h._v("\n            "+h._s(h.$t("LoRA"))+"\n          ")]),h._v(" "),m("i",{directives:[{name:"show",rawName:"v-show",value:(null===(o=h.value)||void 0===o||null===(o=o.lora_models)||void 0===o?void 0:o.length)<5,expression:"value?.lora_models?.length < 5"}],staticClass:"el-icon-circle-plus"})]),h._v(" "),m("lora-list",{attrs:{list:h.value.lora_models,"is-studio-mode":h.isStudioMode,"studio-model-info":h.modelList[0]},on:{updateLoraInfo:h.handleUpdateLoraVersion,change:h.changeLora}})],1),h._v(" "),m("div",{directives:[{name:"show",rawName:"v-show",value:["textToImage","promptStudio"].includes(h.top.menuIndex)&&!h.isStudioMode&&!h.isSdMode,expression:"\n          ['textToImage', 'promptStudio'].includes(top.menuIndex) &&\n          !isStudioMode &&\n          !isSdMode\n        "}],staticClass:"h-item m-item"},[m("div",{staticClass:"item-head"},[m("label",[h._v("\n            "+h._s(h.$t("createModeTitle"))+"\n          ")]),h._v(" "),m("el-select",{attrs:{value:h.value.category,placeholder:"","popper-class":"custom-select","popper-append-to-body":!1},on:{change:h.handleSelectChange}},h._l(h.renderList,(function(e,i){return m("el-option",{key:"category"+i,attrs:{label:h.$t(e.i18nKey),value:e.code}},[h._v("\n              "+h._s(h.$t(e.i18nKey))+"\n              "),e.isVip?m("img",{staticClass:"vip-icon",attrs:{src:n(162),alt:"vip-icon"}}):h._e(),h._v(" "),e.tips?m("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t(e.tips),placement:"top-start"}},[m("span",{staticClass:"el-icon-warning custom-tips"})]):h._e()],1)})),1)],1)]),h._v(" "),m("div",{directives:[{name:"show",rawName:"v-show",value:"sdxl"===h.top.creativeMode&&h.top.handleModelType,expression:"top.creativeMode === 'sdxl' && top.handleModelType"}],staticClass:"other-style refiner-switch"},[m("label",[h._v(h._s(h.$t("Refiner"))+"\n        ")]),h._v(" "),m("el-switch",{attrs:{"active-color":"#3F8CFF","active-value":1,"inactive-value":0},on:{change:function(e){return h.changeConfig(e,"refiner_mode")}},model:{value:h.value.refiner_mode,callback:function(e){h.$set(h.value,"refiner_mode",e)},expression:"value.refiner_mode"}})],1),h._v(" "),m("slider-item",{directives:[{name:"show",rawName:"v-show",value:h.value.refiner_mode&&"sdxl"===h.top.creativeMode&&h.top.handleModelType,expression:"value.refiner_mode && top.creativeMode === 'sdxl' && top.handleModelType"}],staticClass:"refiner-slider",attrs:{value:h.value.refiner_switch_at,min:.1,max:1,step:.1,"show-tooltip":!1,precision:2,label:"Switch at",tips:h.$t("refiner_tips")},on:{change:function(e){return h.changeConfig(e,"refiner_switch_at")}}}),h._v(" "),m("div",{directives:[{name:"show",rawName:"v-show",value:h.isStudioMode&&["textToImage"].includes(h.top.menuIndex),expression:"isStudioMode && ['textToImage'].includes(top.menuIndex)"}],staticClass:"h-item l-item"},[m("div",{staticClass:"item-head",on:{click:function(e){return e.stopPropagation(),h.addImagePrompts()}}},[m("label",[h._v("\n            "+h._s(h.isStudioFlux||h.isStudioSD35?h.$t("ImgToImg"):h.$t("studio1"))+"\n            "),m("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("studio2"),placement:"top-start"}},[m("span",{staticClass:"el-icon-warning custom-tips custom-tips-show"})])],1),h._v(" "),m("i",{directives:[{name:"show",rawName:"v-show",value:h.showImagePromptsUpload,expression:"showImagePromptsUpload"}],staticClass:"el-icon-circle-plus",on:{click:function(e){return e.stopPropagation(),h.addImagePrompts()}}})]),h._v(" "),null!==(l=h.value.lab_base)&&void 0!==l&&null!==(l=l.conds)&&void 0!==l&&l.length?m("image-prompts-list",{ref:"imagePromptsList",attrs:{list:h.value.lab_base.conds,isStudioFlux:h.isStudioFlux},on:{deleteParam:h.handleDeleteImagePrompts,update:h.changeImagePromptsConfig}}):h._e(),h._v(" "),m("el-upload",{key:"imagePromptsUpload",ref:"imagePromptsUpload",staticClass:"image-upload",staticStyle:{display:"none !important"},attrs:{action:"#",accept:".jpg,.png,.jpeg,.webp","before-upload":h.handleBeforeUpload,"http-request":function(){},"show-file-list":!1}},[m("i",{staticClass:"el-icon-upload image-upload-icon"}),h._v(" "),m("el-button",{staticClass:"image-prompts-upload-btn",attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[h._v(h._s(h.$t("UploadImg")))])],1)],1),h._v(" "),"FLUX"!==h.getCurrentModelType?m("div",{directives:[{name:"show",rawName:"v-show",value:h.isStudioInfinity,expression:"isStudioInfinity"}],staticClass:"h-item l-item"},[m("div",{staticClass:"item-head",on:{click:function(e){return e.stopPropagation(),h.addIpList()}}},[m("label",[h._v("\n            "+h._s(h.$t("studio46"))+"\n            "),m("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("studio47"),placement:"top-start"}},[m("span",{staticClass:"el-icon-warning custom-tips custom-tips-show"})])],1),h._v(" "),m("i",{directives:[{name:"show",rawName:"v-show",value:h.showIpUpload,expression:"showIpUpload"}],staticClass:"el-icon-circle-plus",on:{click:function(e){return e.stopPropagation(),h.addIpList()}}})]),h._v(" "),null!==(r=h.value)&&void 0!==r&&null!==(r=r.ipList)&&void 0!==r&&r.length?m("image-prompts-list",{key:"ipPromptsList",ref:"imagePromptsList",attrs:{list:h.value.ipList,isStudioFlux:h.isStudioFlux},on:{deleteParam:h.handleDeleteIp,update:h.changeIpConfig}}):h._e(),h._v(" "),m("el-upload",{key:"ipCondsUpload",ref:"ipCondsUpload",staticClass:"image-upload",staticStyle:{display:"none !important"},attrs:{action:"#",accept:".jpg,.png,.jpeg,.webp","before-upload":h.handleBeforeUploadIp,"http-request":function(){},"show-file-list":!1}},[m("i",{staticClass:"el-icon-upload image-upload-icon"}),h._v(" "),m("el-button",{staticClass:"ip-prompts-upload-btn",attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[h._v(h._s(h.$t("UploadImg")))])],1)],1):h._e(),h._v(" "),m("div",{directives:[{name:"show",rawName:"v-show",value:h.isStudioFlux||h.isStudioSD35,expression:"isStudioFlux || isStudioSD35"}],staticClass:"other-style refiner-switch"},[m("label",[h._v(h._s(h.$t("studio28"))+"\n          "),m("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("studio45"),placement:"top-start"}},[m("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),m("el-switch",{attrs:{"active-color":"#3F8CFF"},on:{change:function(e){return h.studioChangeConfig(e,"prompt_magic")}},model:{value:h.value.lab_base.prompt_magic,callback:function(e){h.$set(h.value.lab_base,"prompt_magic",e)},expression:"value.lab_base.prompt_magic"}})],1)],1),h._v(" "),m("style-modal",{ref:"styleModal",attrs:{"model-type":h.selectModelType,"select-list":h.selectIds,isSDXL:h.isSdMode,inTask:!0,fluxModelId:null===(c=h.top)||void 0===c?void 0:c.fluxModelId,"menu-index":null===(d=h.top)||void 0===d?void 0:d.menuIndex,"is-studio-mode":h.isStudioMode,"studio-model-info":h.modelList[0]},on:{selectModel:h.handleSelectModel}})],1)}),[],!1,null,"88033432",null));t.a=E.exports},1840:function(e,t,n){"use strict";var o=n(682),l=(n(3029),n(0)),component=Object(l.a)(o.a,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"PromptItem dnd-item",class:["type-".concat(e.item.data.word.type),"subType-".concat(e.item.data.word.subType),{disabled:e.item.data.disabled,isEdit:e.item.state.isEdit}],on:{click:e.onClick,contextmenu:function(t){return t.preventDefault(),e.$emit("contextmenu",{el:e.$el,item:e.item,event:t})},dblclick:function(t){return e.$emit("contextmenu",{el:e.$el,item:e.item,event:t})},mousedown:e.onMousedown}},[t("div",{staticClass:"content"},[t("div",{staticClass:"displayName name"},["text"==e.item.state.isEdit?t("span",{ref:"input",staticClass:"input",attrs:{contenteditable:"true"},on:{keydown:e.onKeydown,blur:e.onBlur}},[e._v(e._s(e.displayName)+"\n                ")]):t("span",[e._v(e._s(e.displayName))]),e._v(" "),e.displayLv?t("div",{staticClass:"lv"},[e._v(e._s(e.displayLv))]):e._e()]),e._v(" "),e.langName||"lang"==e.item.state.isEdit?t("div",{staticClass:"langName name"},["lang"==e.item.state.isEdit?t("span",{ref:"inputLang",staticClass:"input inputLang",attrs:{contenteditable:"true"},on:{keydown:e.onKeydownLang,blur:e.onBlurLang}},[e._v(e._s(e.langName))]):t("span",[e._v(" "+e._s(e.langName))])]):e._e()]),e._v(" "),e._m(0)])}),[function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"dnd-slots"},[t("div",{staticClass:"dnd-slot-pre"}),e._v(" "),t("div",{staticClass:"dnd-slot-next"})])}],!1,null,"6087fcf6",null);t.a=component.exports},188:function(e,t,n){"use strict";n(14),n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),l=(n(16),n(10),n(18),n(1));function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={name:"AuthorInfo",mixins:[n(33).a],props:{activeImg:{type:Object,default:function(){return{}}},type:{type:String,default:"work"}},watch:{appealShow:{handler:function(e){e||(this.appeaData={obj_no:"",obj_type:1,remark:""})}}},computed:c(c(c({},Object(l.e)("user",["userInfo","token"])),Object(l.c)("payment",["paymentInfo"])),{},{inviteCode:function(){return this.userInfo.invite_user_code},determineSelfWork:function(){var e,t;return(null==this||null===(e=this.activeImg)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id)==(null===(t=this.userInfo)||void 0===t?void 0:t.id)},authorName:function(){var e=this.activeImg.author,t=(null==e?void 0:e.name)||(null==e?void 0:e.id);return t?t[0].toUpperCase():"-"}}),data:function(){return{popovervisible:!1,appealShow:!1,appeaData:{obj_no:"",obj_type:1,remark:""}}},mounted:function(){},methods:{getPersonalInfoUrl:function(){var e,t,n=(null===(e=this.activeImg)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id)||"",o=(null===(t=this.userInfo)||void 0===t?void 0:t.id)||"",path="/user/"+encodeURIComponent(n);return o==n&&(path="/personal"),this.localePath(path)},jumpToOtherUser:function(){this.$emit("handleClickAuthorInfo");var path=this.getPersonalInfoUrl();"aiAudio"===this.type?window.open(path,"_blank"):this.$router.push(path)},openAppealShow:function(){this.appeaData.obj_no=this.activeImg.id,this.appealShow=!0,this.popovervisible=!1},share:function(){var e,t,n={work:"/explore/detail/",model:"/models/detail/",imgGather:"/artWorkDetail/",video:"/video/",palette:"/editBoard/detail/"}[this.type]||"/explore/detail/",o=null===(e=this.$route)||void 0===e||null===(e=e.params)||void 0===e?void 0:e.id,l=this.localePath("".concat(n).concat(o,"?u_code=").concat(this.inviteCode)),r="".concat(window.location.origin).concat(l),c=null===(t=this.activeImg)||void 0===t||null===(t=t.banner)||void 0===t?void 0:t.url;this.$refs.inviteDialog.show(r,c)},handleMark:function(){this.token?this.setCollectData(this.activeImg).includes("collect_selected")&&this.setCollect(this.activeImg,"artwork"):this.$EventBus.$emit("openLoginDialog")},hidePopover:function(){this.popovervisible=!1},handleFollow:function(){var e=this;this.token?this.handleFollowStart():this.$EventBus.$emit("openLoginDialog",{callBack:function(){e.handleFollowStart()}})},handleFollowStart:function(){var e;this.$emit("handleFollow");var t=(null===(e=this.activeImg)||void 0===e?void 0:e.type)||this.type,n={WORK:"作品详情页",CHECKPOINT:"模型详情页",MODEL:"模型详情页",LORA:"风格详情页",IMGGATHER:"图集详情页",VIDEO:"视频详情页",PALETTE:"画板详情页",AIAUDIO:"音频详情页"}[t="string"==typeof t?t.toUpperCase():this.type.toUpperCase()]||"作品详情页";this.setFollow(this.activeImg,n)}}},h=(n(2411),n(0)),component=Object(h.a)(d,(function(){var e,t,n,o,l,r,c=this,d=c._self._c;return d("div",{staticClass:"author flex"},[null!==(e=c.activeImg)&&void 0!==e&&e.author?d("div",{staticClass:"left flex"},[d("div",{staticClass:"head",style:{"background-color":null!==(t=c.activeImg)&&void 0!==t&&null!==(t=t.author)&&void 0!==t&&t.head?"transparent":"#ADB8CD"},on:{click:c.jumpToOtherUser}},[null!==(n=c.activeImg)&&void 0!==n&&null!==(n=n.author)&&void 0!==n&&n.head?d("img",{directives:[{name:"webp",rawName:"v-webp",value:c.$imgL,expression:"$imgL"}],staticClass:"avatar",attrs:{src:null===(o=c.activeImg)||void 0===o||null===(o=o.author)||void 0===o?void 0:o.head,alt:"avatar"}}):d("div",{staticClass:"letter"},[c._v("\n          "+c._s(c.authorName)+"\n        ")])]),c._v(" "),d("div",{staticClass:"name",on:{click:c.jumpToOtherUser}},[d("a",{staticClass:"personal-info-a",attrs:{href:c.getPersonalInfoUrl(),rel:"nofollow"},on:{click:function(e){e.preventDefault()}}},[c._v("\n          "+c._s((null===(l=c.activeImg)||void 0===l?void 0:l.author.name)||(null===(r=c.activeImg)||void 0===r?void 0:r.author.id))+"\n        ")])]),c._v(" "),c.determineSelfWork?c._e():d("el-button",{staticClass:"follow",attrs:{loading:c.followLoading},on:{click:c.handleFollow}},[c._v("\n        "+c._s("followed"==c.setFollowData(c.activeImg)?c.$t("Followed"):c.$t("Follow"))+"\n      ")])],1):c._e(),c._v(" "),d("div",{staticClass:"right"},[c._t("default")],2)])}),[],!1,null,"df8e6bbe",null);t.a=component.exports},1899:function(e,t,n){"use strict";n(16),n(10),n(14),n(9),n(7),n(11),n(12),n(8),n(6);var o=n(2),l=(n(32),n(4),n(18),n(29),n(1)),r=n(184);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h={name:"FloatingTools",data:function(){this.getCorporateServicesUrl();return{toolsArr:[{name:"adminOff",icon:"el-icon-s-custom",method:"click",type:"adminOff",show:!0},{name:"customer_service",icon:"a-floating-tools-aihelp1",method:"click",type:"openAIHelp",title:"CustomerService",show:!0,msg:0},{type:"downloadApp",icon:"icon-a-cellphone",title:"downloadApp",show:!0}],showContactUsCard:!1,contactUsIcon:n(620),contactUsBg:n(743)}},computed:d(d(d({},Object(l.e)("user",["downloadUrl","userInfo","token","adminOff","waitTakeNum"])),Object(l.c)("user",["isLoggedIn","isCompanyAccount"])),{},Object(o.a)(Object(o.a)({downloadAppShow:function(){return!this.$isChinaSite},showAdminOff:function(){var e=this;return["ExploreDetail","Explore","Home","StudioIndex","TagInfo","AIModel","recommendPage","homePage","modelPage","postPage","ishowPage","loraTrainPage","designTemplatePage","searchView","searchResult","videoPage","audioPage","cyberBarPage","swiftAppPage","workflowPage"].some((function(t){var n;return((null==e||null===(n=e.$route)||void 0===n?void 0:n.name)||"").includes(t)}))}},"downloadAppShow",(function(){return!this.$isChinaSite})),"getItemToolClass",(function(){return function(e){var img=e.img?"img":"";return[e.icon,img]}}))),watch:{"$route.path":{handler:function(e){this.toolsArr[1].show="/incentiveTask"!=e&&!this.isCompanyAccount},immediate:!0},isCompanyAccount:{handler:function(e){this.toolsArr[1].show=!e},immediate:!0},downloadUrl:{handler:function(e){e&&(this.toolsArr[1].childrenMenu[1].show=!0,this.toolsArr[1].childrenMenu[1].url="/downloadApp")},immediate:!0}},methods:d(d({},Object(l.b)("user",["setAdminOff"])),{},{goDownload:function(){this.$logEvent("log_actions",{operation:"click_go_to_app",behavior_info:"on_homepage_hover"}),window.open("/downloadApp")},generateRandomNumber:function(){return Math.random()<.2?1:2},getRandomNumber:function(){localStorage.getItem("downAPPrandomNumber")||localStorage.setItem("downAPPrandomNumber",this.generateRandomNumber()),localStorage.getItem("downAPPrandomNumber")},setMsgNum:function(){var e=this;setTimeout((function(){if(window.SUHelpSupport){var t=e.toolsArr.find((function(e){return"customer_service"===e.name}));SUHelpSupport.on("setUnreadNum",(function(data){t.msg=data}))}}),3e3)},changeAdminOff:function(){-1!==this.adminOff&&this.setAdminOff(1===this.adminOff?0:1)},getCorporateServicesUrl:function(){return"en"===(["zhCN","en"].includes(this.$i18n.locale)?this.$i18n.locale:"en")?"https://aihelp.net/questionnaire/#/?formId=bab6b3951e72450a908ba0f5cbcc5213":"https://aihelp.net/questionnaire/#/?formId=6d2a14f5bf204522b2a6ea1b45ab6cd3"},handleToolClick:function(e){var t=e.type,n=e.method,o=e.url,l=e.logEventParams;if("click"==n)switch(l&&this.$logEvent(l.event_name,l.params),t){case"goPage":this.$router.push(this.localePath(o));break;case"winOpen":window.open(o);break;case"openAIHelp":this.showHaiyiServices()}},showHaiyiServices:function(){var e=this;window.SUHelpSupport?SUHelpSupport.show():Object(r.a)((function(){setTimeout((function(){SUHelpSupport.show()}),2e3),e.setMsgNum()}))},handleHover:function(e,t){"hover"==t.method&&(t.showSubMenu="enter"===e)},showContactUsCardFun:function(){this.showContactUsCard=!0},closeContactUsCard:function(){this.showContactUsCard=!1}})},m=(n(2134),n(0)),component=Object(m.a)(h,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"floating-box"},[e._l(e.toolsArr,(function(n){return[["adminOff"].includes(n.type)?[n.show&&e.showAdminOff?t("el-tooltip",{key:n.name,attrs:{content:(e.adminOff?"关闭":"打开")+"管理员模式",disabled:n.disabledTooltip,placement:"left"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:-1!==e.adminOff,expression:"adminOff !== -1"}],staticClass:"item-tool admin-off",class:{open:e.adminOff},on:{click:e.changeAdminOff}},[t("i",{staticClass:"el-icon-s-custom iconfont"})])]):e._e()]:["downloadApp"].includes(n.type)?e._e():[n.show&&("taskTabTasks"!=n.title||e.isLoggedIn)?t("el-tooltip",{key:n.name,attrs:{content:e.$t(n.title),disabled:n.disabledTooltip,placement:"left"}},[t("el-badge",{staticClass:"item",attrs:{value:null==n?void 0:n.msg,max:9,hidden:!(null!=n&&n.msg)}},[t("div",{staticClass:"item-tool",class:e.getItemToolClass(n),on:{click:function(t){return e.handleToolClick(n)},mouseenter:function(t){return e.handleHover("enter",n)},mouseleave:function(t){return e.handleHover("leave",n)}}},[n.img?t("img",{directives:[{name:"show",rawName:"v-show",value:0==e.waitTakeNum,expression:"waitTakeNum == 0"}],staticClass:"img-container",attrs:{src:n.img}}):e._e(),e._v(" "),n.img?t("el-badge",{directives:[{name:"show",rawName:"v-show",value:0!=e.waitTakeNum,expression:"waitTakeNum != 0"}],staticClass:"item",attrs:{value:e.waitTakeNum}},[t("img",{staticClass:"img-container",attrs:{src:n.img}})]):t("i",{staticClass:"iconfont",class:"icon-".concat(n.icon)}),e._v(" "),n.childrenMenu?t("div",{staticClass:"sub-menu-container",on:{mouseenter:function(t){return e.handleHover("enter",n)}}},[t("div",{directives:[{name:"show",rawName:"v-show",value:n.showSubMenu,expression:"item.showSubMenu"}],staticClass:"sub-menu"},[e._l(n.childrenMenu,(function(n){return[n.show?t("div",{key:n.name,staticClass:"item-sub-menu",on:{click:function(t){return e.handleToolClick(n)}}},[t("div",{staticClass:"icon-div"},[t("i",{staticClass:"iconfont",class:"icon-".concat(n.icon," ").concat(n.icon)})]),e._v(" "),t("span",{staticClass:"words"},[e._v("\n                  "+e._s(e.$t(n.title))+"\n                ")])]):e._e()]}))],2)]):e._e()],1)])],1):e._e()]]}))],2)}),[],!1,null,null,null);t.a=component.exports},1901:function(e,t,n){"use strict";n(14),n(9),n(7),n(11),n(12),n(8),n(6);var o=n(2),l=(n(16),n(70),n(19),n(4),n(23),n(39)),r=n(131),c=n(1);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var h={props:{type:{type:String,default:"artwork"},id:{type:String,default:""},width:{type:String,default:"1016px"}},data:function(){return{getTimeDiff2:l.d,dialogVisible:!1,commentData:{},commentFromData:{obj_id:"",obj_type:"artwork",page:1,page_size:8},repliesFromData:{comment_id:"",page:1,page_size:10},commentList:[],commentListLoading:!1,commentText:"",isLoading:!1,buttonShow:!1,loadMoreShow:!1,focusBnt:!1,repliesListLoading:!1,repliesList:[],noMoreData:!1,total:0,errTxt:"",errTxtShow:!1}},watch:{dialogVisible:{handler:function(e){var t=this;e?(this.commentData.id&&this.getRepliesList(),this.$nextTick((function(){t.$refs.list.addEventListener("scroll",t.checkLoadMore)}))):(this.commentData={},this.buttonShow=!1,this.commentText="",this.repliesList=[],this.noMoreData=!1,this.errTxtShow=!1,this.errTxt="",this.getCommentList(),this.$refs.list.removeEventListener("scroll",this.checkLoadMore))}}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(c.c)("user",["isLoggedIn"])),created:function(){this.commentFromData.obj_type=this.type,this.commentFromData.obj_id=this.id},mounted:function(){this.getCommentList()},methods:{initials:function(e){return e.split(" ").map((function(e){return e[0]})).join("")},setButtonShow:function(){this.buttonShow=!!this.focusBnt||this.commentText.length>0},onComment:function(){var e=this;if(!this.commentText||/^\s*$/.test(this.commentText))return this.errTxtShow=!0,void(this.errTxt=this.$t("CommentEmpty"));this.errTxtShow=!1,this.errTxt="",this.isLoading=!0;var t={content:this.commentText,obj_id:this.id,obj_type:this.type},n=r.a;this.commentData.id&&(n=r.b,t.comment_id=this.commentData.id,delete t.obj_id,delete t.obj_type),n(t).then((function(t){var n,o;1e4==(null==t||null===(n=t.status)||void 0===n?void 0:n.code)?(e.commentText="",e.commentData.id?(e.$refs.list.scrollTop=0,e.noMoreData=!1,e.getRepliesList()):e.dialogVisible=!1):("40007"==(null==t||null===(o=t.status)||void 0===o?void 0:o.code)?e.errTxt=e.$t("CommentViolates"):e.errTxt=e.$t("ServerError"),e.errTxtShow=!0)})).finally((function(){e.isLoading=!1}))},getCommentList:function(e){var t=this;this.commentListLoading||(e?this.commentFromData.page++:this.commentFromData.page=1,this.commentListLoading=!0,Object(r.f)(this.commentFromData).then((function(n){var o,l;1e4==(null==n||null===(o=n.status)||void 0===o?void 0:o.code)?(t.commentList=e?t.commentList.concat(n.data.list||[]):n.data.list||[],t.total=n.data.total,t.commentFromData.page==Math.ceil(n.data.total/t.commentFromData.page_size)?t.loadMoreShow=!1:t.loadMoreShow=!0):t.$message({message:(null==n||null===(l=n.status)||void 0===l?void 0:l.msg)||t.$t("ServerError"),type:"error"})})).finally((function(){t.commentListLoading=!1})))},checkLoadMore:function(){var e=this.$refs.list,t=e.scrollTop,n=e.scrollHeight;t+e.clientHeight>=n-300&&this.getRepliesList(!0)},getRepliesList:function(e){var t=this;this.repliesListLoading||this.noMoreData||(this.repliesListLoading=!0,this.repliesFromData.comment_id=this.commentData.id,e?this.repliesFromData.page++:this.repliesFromData.page=1,Object(r.h)(this.repliesFromData).then((function(n){var o;if(1e4==(null==n||null===(o=n.status)||void 0===o?void 0:o.code)){if(0==n.data.list.length)return void(t.noMoreData=!0);t.repliesList=e?t.repliesList.concat(n.data.list||[]):n.data.list||[]}else{var l;t.$message({message:(null==n||null===(l=n.status)||void 0===l?void 0:l.msg)||t.$t("ServerError"),type:"error"})}})).finally((function(){t.repliesListLoading=!1})))}}},m=h,v=(n(2409),n(0)),component=Object(v.a)(m,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"img-comment",style:{marginBottom:"model"==e.type?"0":null}},[t("div",{staticClass:"comment-cnt",style:{width:e.width}},[t("div",{staticClass:"comment-title"},[t("span",{staticClass:"tit"},[e._v(e._s(e.$t("comment")+"("+e.total+")"))]),e._v(" "),t("div",{on:{click:function(t){e.isLoggedIn?e.dialogVisible=!0:e.$EventBus.$emit("openLoginDialog")}}},[t("i",{staticClass:"iconfont icon-comment"}),e._v(" "),t("span",[e._v(e._s(e.$t("AddComment")))])])]),e._v(" "),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.commentListLoading,expression:"commentListLoading"}],staticClass:"comment-list"},e._l(e.commentList,(function(n,o){return t("div",{key:o,staticClass:"comment-item"},[t("div",{staticClass:"item-cnt"},[t("div",{staticClass:"item-title"},[n.account_info?t("div",{staticClass:"item-user"},[n.account_info.avatar?t("img",{staticClass:"item-avator",attrs:{decoding:"async",loading:"lazy",src:n.account_info.avatar,alt:""}}):t("div",{staticClass:"item-avator"},[e._v("\n                "+e._s(e.initials(n.account_info.name))+"\n              ")]),e._v(" "),t("div",{staticClass:"item-name"},[e._v(e._s(n.account_info.name))])]):e._e()]),e._v(" "),t("div",{staticClass:"item-text"},[e._v(e._s(n.content))]),e._v(" "),t("div",{staticClass:"item-info"},[t("div",{staticClass:"item-time"},[e._v(e._s(e.getTimeDiff2(n.create_at,Date.now())))]),e._v(" "),t("div",{staticClass:"item-num",on:{click:function(t){e.isLoggedIn?(e.commentData=n,e.dialogVisible=!0):e.$EventBus.$emit("openLoginDialog")}}},[t("i",{staticClass:"iconfont icon-comment"}),e._v(" "),t("span",[e._v(e._s(n.replies_num))])])])])])})),0)]),e._v(" "),e.loadMoreShow&&0!=e.commentList.length?t("div",{staticClass:"more",on:{click:function(t){return e.getCommentList(!0)}}},[t("span",[e._v(e._s(e.$t("loadMore")))])]):e._e(),e._v(" "),t("el-dialog",{attrs:{title:e.$t("comment"),visible:e.dialogVisible,top:"30vh",width:"508px","modal-append-to-body":!1,"close-on-click-modal":!1,"custom-class":"SaDialog"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{staticClass:"addcomment"},[e.commentData.id?t("div",[t("div",{staticClass:"addcmt-title"},[e.commentData.account_info?t("div",{staticClass:"addcmt-user"},[e.commentData.account_info.avatar?t("img",{staticClass:"addcmt-avator",attrs:{decoding:"async",loading:"lazy",src:e.commentData.account_info.avatar,alt:""}}):t("div",{staticClass:"addcmt-avator"},[e._v("\n                "+e._s(e.initials(e.commentData.account_info.name))+"\n              ")]),e._v(" "),t("div",{staticClass:"addcmt-userinfo"},[t("div",[e._v(e._s(e.commentData.account_info.name))]),e._v(" "),t("div",[e._v(e._s(e.getTimeDiff2(e.commentData.create_at,Date.now())))])])]):e._e()]),e._v(" "),t("div",{staticClass:"addcmt-text"},[e._v(e._s(e.commentData.content))]),e._v(" "),t("div",{staticClass:"addcmt-num"},[e._v(e._s(e.repliesList.length)+" "),t("span",[e._v(e._s(e.$t("reply")))])])]):e._e(),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.commentText,expression:"commentText"}],staticClass:"addcmt-input",attrs:{type:"text",placeholder:e.$t("typeComment"),maxlength:"200"},domProps:{value:e.commentText},on:{focus:function(t){e.buttonShow=!0},blur:e.setButtonShow,input:function(t){t.target.composing||(e.commentText=t.target.value)}}}),e._v(" "),e.errTxtShow?t("div",{staticClass:"errTxtBox"},[e._v(e._s(e.errTxt))]):e._e(),e._v(" "),!e.commentData.id||e.buttonShow?t("div",{staticClass:"bntitem",attrs:{slot:"footer"},slot:"footer"},[t("div",{on:{mouseover:function(t){e.focusBnt=!0},mouseout:function(t){e.focusBnt=!1}}},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("el-button",{attrs:{loading:e.isLoading},on:{click:e.onComment}},[e._v(e._s(e.$t("comment")))])],1)]):e._e(),e._v(" "),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.repliesListLoading,expression:"repliesListLoading"}],ref:"list",staticClass:"addcmt-list"},e._l(e.repliesList,(function(n,o){return t("div",{key:o,staticClass:"adcmt-item"},[n.account_info?t("div",[n.account_info.avatar?t("img",{staticClass:"list-avator",attrs:{decoding:"async",loading:"lazy",src:n.account_info.avatar,alt:""}}):t("div",{staticClass:"list-avator"},[e._v("\n              "+e._s(e.initials(n.account_info.name))+"\n            ")])]):e._e(),e._v(" "),t("div",{staticClass:"list-text"},[t("div",{staticClass:"list-name"},[e._v(e._s(n.account_info.name))]),e._v(" "),t("div",{staticClass:"list-cnt"},[e._v(e._s(n.content))])])])})),0)])])],1)}),[],!1,null,"28342f8a",null);t.a=component.exports},1903:function(e,t,n){"use strict";n(14),n(9),n(11),n(12),n(8),n(6);var o=n(2),l=(n(7),n(32),n(10),n(4),n(274),n(18),n(1));function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={props:{top:{type:String,default:"70px"},showTitle:{type:Boolean,default:!0},title:{type:String,default:""},showTabs:{type:Boolean,default:!0},showButtons:{type:Boolean,default:!0},showModelType:{type:Boolean,default:!1},showWorkOrModel:{type:Boolean,default:!1},tabs:{type:Array,default:null},exludeTabs:{type:Array,default:function(){return[]}},buttons:{type:Array,default:null},excludeButtons:{type:Array,default:function(){return[]}},defaultButton:{type:String,default:void 0},isShowHomeTypeSelect:{type:Boolean,default:!1}},computed:c(c({},Object(l.c)("user",["isLoggedIn","userInfo"])),{},{filterName:function(){return this.showTitle&&(this.title||this.$route.name)},renderBtns:function(){var e=this,t=this.buttons||this.defaultButtons;return"work"!=this.showType?t.filter((function(t){return!e.excludeButtons.includes(t.name)&&"following"!==t.value&&"recommend"!==t.value})):this.isLoggedIn?t.filter((function(t){return!e.excludeButtons.includes(t.name)})):t.filter((function(t){return!e.excludeButtons.includes(t.name)&&"following"!==t.value}))},renderTabs:function(){var e=this;return(this.tabs||this.defaultTabs).filter((function(t){return e.isLoggedIn?!e.exludeTabs.includes(t.name):!e.exludeTabs.includes(t.name)&&"bookmarks"!==t.value&&"follows"!==t.value}))}}),watch:{defaultButton:function(e){this.activeButton=this.renderBtns.find((function(t){return t.name===e}))||this.renderBtns[0]}},mounted:function(){var e,t=this,n=(null===(e=this.$route)||void 0===e?void 0:e.query).modelType;n&&(this.showType=n),this.activeButton=this.renderBtns.find((function(e){return e.name===t.defaultButton}))||this.renderBtns[0]},data:function(){return{activeTab:"community",activeButton:{name:this.$t("Hot"),value:"hot",activeColor:"#EF4444"},activeModuleTabs:"-",defaultButtons:[{name:this.$t("Hot"),value:"hot",color:"#8E9CB1",activeColor:"#EF4444"},{name:this.$t("New"),value:"new1",color:"#8E9CB1",activeColor:"#e9b942"},{name:this.$t("Top"),value:"top",color:"#8E9CB1",activeColor:"#fa6929"}],defaultTabs:[{name:this.$t("Stars"),value:"bookmarks"},{name:this.$t("Follows"),value:"follows"},{name:this.$t("Community"),value:"community"}],moduleTabs:[{name:this.$t("All"),value:"-"},{name:this.$t("Checkpoint"),value:"Checkpoint"},{name:this.$t("LoRA"),value:"LORA"}],showType:"work",workOrModel:[{label:this.$t("Work"),value:"work"},{label:this.$t("Checkpoint"),value:"Checkpoint"},{label:this.$t("LoRA"),value:"LORA"}]}},methods:c(c({},Object(l.d)("app",["setHomeType"])),{},{onTabClick:function(){this.$emit("change",{type:this.activeTab,order_by:this.activeButton.value,model_type:"0"==this.activeModuleTabs?"":this.activeModuleTabs})},onButtonClick:function(button){this.activeButton=button;var e={type:this.activeTab,order_by:this.activeButton.value,showType:this.showType,model_type:"work"===this.showType?"":this.showType};!1===this.showWorkOrModel&&Reflect.deleteProperty(e,"showType"),this.$emit("change",e)},changeType:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={type:this.activeTab,order_by:"work"===e?"recommend":"hot",showType:this.showType,model_type:"work"===e?"":e,isFromHomeType:!0};n=Object.assign(n,t||{}),!1===this.showWorkOrModel&&Reflect.deleteProperty(n,"showType"),this.$emit("change",n)}})},h=d,m=(n(2527),n(0)),component=Object(m.a)(h,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"filter-component",style:{top:e.top}},[t("el-row",{staticClass:"top",attrs:{type:"flex"}},[e.showTitle?t("el-col",{staticClass:"filter-title",attrs:{span:14}},[e._v(e._s(e.$t(e.filterName)))]):e._e(),e._v(" "),t("el-col",{staticClass:"filter-tabs",class:{"show-tabs":e.showTabs},attrs:{span:10}},[e.showTabs&&e.isLoggedIn?t("el-tabs",{on:{"tab-click":e.onTabClick},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},e._l(e.renderTabs,(function(n,o){return t("el-tab-pane",{key:"_选项".concat(o),class:{active:e.activeTab===n.value},attrs:{label:n.name,name:n.value}})})),1):e._e()],1)],1),e._v(" "),e.showButtons&&"bookmarks"!=e.activeTab?t("el-row",{staticClass:"filter-buttons",class:{"show-buttons":e.showButtons,"not-login":!e.isLoggedIn},attrs:{type:"flex"}},[e._l(e.renderBtns,(function(button){return t("button",{key:button.value,staticClass:"filter-button",class:{active:e.activeButton.value===button.value},on:{click:function(t){return e.onButtonClick(button)}}},[t("i",{staticClass:"iconfont filter-button-icon",class:"icon-".concat(button.value),style:{color:e.activeButton.value===button.value?button.activeColor:button.color}}),e._v(" "),t("span",{staticStyle:{"margin-left":"5px"}},[e._v(e._s(button.name))])])})),e._v(" "),e.showWorkOrModel&&e.isShowHomeTypeSelect?t("el-select",{staticClass:"showType custom-select",attrs:{"popper-class":"custom-select",placeholder:"请选择"},on:{change:e.changeType},model:{value:e.showType,callback:function(t){e.showType=t},expression:"showType"}},e._l(e.workOrModel,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e()],2):e._e()],1)}),[],!1,null,"632f8952",null);t.a=component.exports},1905:function(e,t,n){"use strict";var o={name:"CTabs",props:{tabs:{type:Array,default:function(){return[]}},currentTab:{type:String,default:""},tabStyle:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{changeTab:function(e){this.$emit("changeTab",e)}}},l=(n(2657),n(0)),component=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-tab",style:e.tabStyle},e._l(e.tabs,(function(n){return t("div",{key:n.value,staticClass:"item-tab",class:{active:e.currentTab==n.value},on:{click:function(t){return e.changeTab(n)}}},[e._v("\n\t\t"+e._s(e.$t(n.label))+"\n\t")])})),0)}),[],!1,null,"a2337098",null);t.a=component.exports},1924:function(e,t,n){"use strict";n(28);var o={name:"CTooltip",props:{content:{type:String,default:""},color:{type:String,default:"rgba(0, 0, 0, 0.7)"},font:{type:Number,default:16}},computed:{getStyle:function(){return{color:this.color,fontSize:"".concat(this.font,"px")}}}},l=n(0),component=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("el-tooltip",{attrs:{effect:"dark",placement:"top","open-delay":0}},[t("span",[t("i",{staticClass:"iconfont icon-help-icon",style:e.getStyle})]),e._v(" "),t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n\t\t"+e._s(e.$t(e.content))+"\n\t")])])}),[],!1,null,null,null);t.a=component.exports},211:function(e,t,n){"use strict";var o={props:{back:{type:[Object,Function],default:function(){return null}}},methods:{backTo:function(){if(this.back)this.back();else if(1!==window.history.length)this.$router.back();else{var e=this.localePath("/");this.$router.push(e)}}}},l=(n(2568),n(0)),component=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"back-btn",on:{click:function(t){return t.stopPropagation(),e.backTo.apply(null,arguments)}}},[t("i",{staticClass:"el-icon-back"})])}),[],!1,null,"3da2ce83",null);t.a=component.exports},213:function(e,t,n){"use strict";n(16),n(7),n(28),n(4),n(6);var o=n(24),l=n(40),r={name:"pickWorkModal",components:{WaterFallVue:n(554).a},props:{maxNum:{type:Number,default:20},type:{type:String,default:"default"}},data:function(){return{visible:!1,loading:!1,list:[],noMore:!1,queryParam:{keyword:"",page:1,page_size:60,time_to:0,after:0},debounceHandleScroll:null,scrollTop:0,selectList:[],debounceHandleSearch:null}},computed:{renderList:function(){return"animGen"==this.type?this.list.filter((function(e){return"sdxl"!=e.channel&&"studio"!=e.channel&&6!=e.type})):this.list}},mounted:function(){this.debounceHandleScroll=Object(o.debounce)(this.handleScroll,200),this.debounceHandleSearch=Object(o.debounce)(this.handleSearch,600)},beforeDestroy:function(){this.debounceHandleScroll=null,this.debounceHandleSearch=null},methods:{openModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.resetData(),this.getList(),this.selectList=e||[],this.visible=!0},handleClose:function(){this.visible=!1},resetData:function(){this.list=[],this.loading=!1,this.queryParam={keyword:"",page:1,page_size:60,time_to:0,after:0},this.scrollTop=0,this.noMore=!1,this.selectList=[]},handleCancel:function(){this.visible=!1},handleSearch:function(){this.loading=!1,this.noMore=!1,this.queryParam.page=1,this.queryParam.time_to=0,this.queryParam.after=0,this.scrollTop=0,this.list=[],this.getList()},handleScroll:function(){var e=this.$refs.handleWorkScroll;this.scrollTop=e.scrollTop||0;try{e&&e.scrollTop+e.clientHeight>=e.scrollHeight-50&&this.getList(!0)}catch(e){}},getList:function(e){var t=this;if(!this.loading&&!this.noMore){this.loading=!0;var n=l.artworkList;this.queryParam.order_by="new",this.queryParam.artwork_types=[1,4,6],"animGen"==this.type&&(this.queryParam.artwork_types=[1,4],this.queryParam.scene="motion"),"character"==this.type&&(this.queryParam.artwork_types=[1,3,4]),"contribute"===this.type&&(this.queryParam.artwork_types=[1,3,4,6],this.queryParam.scene="post"),this.queryParam.type="bookmarks",this.queryParam.category=2;var o=this.queryParam;return new Promise((function(l,r){n(o).then((function(n){if(1e4===n.status.code){var r;if(t.noMore=!n.data.has_more,t.list=e?t.list.concat(n.data.items||[]):n.data.items||[],1===o.page&&n.data.time_ms&&(o.time_to=n.data.time_ms),n.data.items.length>0)t.queryParam.after=null===(r=n.data.items[n.data.items.length-1])||void 0===r||null===(r=r.folder_no)||void 0===r?void 0:r.collect_at;o.page++,l()}})).catch((function(e){r(e)})).finally((function(){t.loading=!1}))}))}},getCheckList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.selectList=[],(t.url||[]).forEach((function(n,o){e.selectList.push({url:n,id:(null==t?void 0:t.ids[o])||"",type:"check",info:null==t?void 0:t.info[o]})}))},handleConfirm:function(){this.selectList.length?(this.$emit("confirm",this.selectList),this.handleClose()):this.$message.warning(this.$t("selectOneWork"))}}},c=r,d=(n(2666),n(0)),component=Object(d.a)(c,(function(){var e=this,t=e._self._c;return e.visible?t("el-dialog",{attrs:{visible:e.visible,"custom-class":"c-pick-work-modal","modal-append-to-body":!0,"append-to-body":!0,"close-on-click-modal":!1,"destroy-on-close":"",center:""},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"pick-work-modal-header"},[t("div",{staticClass:"pick-work-modal-header-item"},[t("span",{staticClass:"header-item-text"},[e._v(e._s(e.$t("personalFeed")))]),e._v(" "),t("el-tooltip",{staticClass:"header-item-text-tip",attrs:{effect:"dark",content:e.$t("handleWorkTips1",{number:20}),placement:"top"}},[t("span",{staticClass:"el-icon-info header-item-text-tip"})]),e._v(" "),t("span",{staticClass:"header-item-desc-text"},[e._v(e._s(e.$t("modelWorkDesc")))]),e._v(" "),t("span",{staticClass:"header-item-desc-text",staticStyle:{"margin-left":"8px"}},[e._v(e._s(e.$t("imageAlbum"))+" ("+e._s(e.selectList.length)+"/"+e._s(e.maxNum)+")")])],1),e._v(" "),t("div",{staticClass:"pick-work-modal-header-item"},[t("div",{staticClass:"header-item-btn",on:{click:function(t){return t.stopPropagation(),e.handleCancel.apply(null,arguments)}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("div",{staticClass:"header-item-btn header-item-btn-gradient",on:{click:function(t){return t.stopPropagation(),e.handleConfirm.apply(null,arguments)}}},[e._v("\n        "+e._s(e.$t("Done"))+"\n      ")])])]),e._v(" "),t("div",{staticClass:"pick-work-modal-body"},[t("div",{staticClass:"search-box"},[t("el-input",{staticClass:"search-box__search-input",attrs:{placeholder:e.$t("Search"),clearable:""},on:{change:e.handleSearch},model:{value:e.queryParam.keyword,callback:function(t){e.$set(e.queryParam,"keyword",t)},expression:"queryParam.keyword"}},[t("template",{slot:"suffix"},[t("i",{staticClass:"iconfont icon-search search-icon",on:{click:e.handleSearch}})])],2)],1),e._v(" "),t("div",{ref:"handleWorkScroll",staticClass:"handle-work-scroll-list",on:{scroll:e.debounceHandleScroll}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"wraper",staticClass:"wraper"},[t("WaterFallVue",{ref:"WaterFallVue",attrs:{showNs:"",type:"artwork",cols:5,container:"wraper",list:e.renderList,lazy:!0,dislikeShow:!0,isCheck:!0,checkMax:e.maxNum,alreadyNoMoreData:e.noMore,scrollContainerClassName:"handle-work-scroll-list",scrollContentTop:e.scrollTop,selectList:e.selectList},on:{load:function(t){return e.getList(!0)},getChecList:e.getCheckList}})],1)])])]):e._e()}),[],!1,null,null,null);t.a=component.exports},2133:function(e,t,n){"use strict";n(928)},2134:function(e,t,n){"use strict";n(929)},214:function(e,t,n){"use strict";n(14),n(9),n(7),n(11),n(12),n(8),n(6);var o=n(2),l=(n(10),n(4),n(49),n(1)),r=n(21),c=n(5);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m={mixins:[n(33).a],props:{value:{type:Boolean,default:!1},width:{type:String,default:"510px"},type:{type:String,default:"artwork"},dataToCollect:{type:Object,default:function(){return{}}},checkList:{type:Object,default:function(){return{ids:[],collectIds:[]}}},editData:{type:Object,default:function(){return{}}},category:{type:Boolean,default:!1},banner:{type:String,default:function(){return""}},fromPage:{type:String,default:function(){return""}},isColorBtn:{type:Boolean,default:!1}},computed:h(h(h({},Object(l.e)("payment",["paymentInfo"])),Object(l.c)("user",["isCompanyAccount","userInfo","accountData"])),{},{getBannerUrl:function(){var e,t,n,o,l="";if(this.dataToCollect&&this.dataToCollect.cover)l="[object Object]"===Object.prototype.toString.call(null==this||null===(t=this.dataToCollect)||void 0===t?void 0:t.cover)?(null==this||null===(n=this.dataToCollect)||void 0===n||null===(n=n.cover)||void 0===n?void 0:n.url)||"":(null==this||null===(o=this.dataToCollect)||void 0===o?void 0:o.cover)||"";else if(this.dataToCollect&&null!==(e=this.dataToCollect)&&void 0!==e&&e.banner){var r,c,d;if("[object Object]"===Object.prototype.toString.call(null==this||null===(r=this.dataToCollect)||void 0===r?void 0:r.banner))l=(null==this||null===(c=this.dataToCollect)||void 0===c||null===(c=c.banner)||void 0===c?void 0:c.url)||"";else l=(null==this||null===(d=this.dataToCollect)||void 0===d?void 0:d.banner)||""}else l=this.banner||"";return l},isGreen:function(){return this.checkGreen(null==this?void 0:this.dataToCollect)},dialogVisible:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},isVip:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount}}),watch:{dialogVisible:{handler:function(e){e?(console.log(this.dataToCollect,"8889"),this.editData.id&&(this.formData.id=this.editData.id,this.formData.name=this.editData.name,this.formData.is_visible=1==this.editData.status||!1,this.secret=!this.formData.is_visible)):(this.formData.id="",this.formData.name="",this.formData.is_visible=!0,this.secret=!1,this.$emit("closeMask"))}}},data:function(){return{isLoading:!1,isDeleteLoading:!1,formData:{id:"",name:"",type:"",is_visible:!0},secret:!1,isInputActive:!1,innerVisible:!1,replaceImageType:c.x}},methods:{checkGreen:function(e){return!(null==e||!e.green||![2,"2"].includes(e.green))&&this.greenMode},greenMode:function(){var e;return 2!==(null==this||null===(e=this.accountData)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.green_mode)},secretChange:function(){!this.isVip&&this.category&&(this.secret=!1,this.$EventBus.$emit("showBreakDialog","PrivacyPortfolioTipWeb","basic"))},onCreate:function(){var e=this;if(["",null,void 0].includes(this.formData.name)){var t=this.category?this.$t("portfolioName"):this.$t("collectBox3");this.$message.warning(this.$t("collectCreate11",{name:t}))}else{this.formData.type={artwork:1,model:2,post:3,gallery:3,palette:4,workflow:5,swtft_app:6,character:7,ai_audio:9}[this.type],this.isLoading=!0,this.formData.is_visible=!this.secret,this.category?this.formData.category=2:delete this.formData.category,Object(r.j)(this.formData).then((function(t){var n=(t||{}).status.code,code=void 0===n?"":n;["20201",20201].includes(code)?e.$message.error(e.category?e.$t("portfoliosOverLimit"):e.$t("boardOverLimit")):["20202",20202].includes(code)?e.$message.error(e.category?e.$t("portfolioOverRepeated"):e.$t("boardOverRepeated")):["20203",20203].includes(code)?e.$message.error(e.category?e.$t("violationPortfolioname"):e.$t("violationBoardname")):(e.dataToCollect&&e.dataToCollect.id&&e.addFavorite(e.dataToCollect,e.type,t.data,(function(t){var n;if(e.dialogVisible=!1,!["",null,void 0].includes(null==e||null===(n=e.formData)||void 0===n?void 0:n.name)){var o="saveModal"===e.fromPage?"collectCreate5":"collectCreate4";e.$message.success(e.$t(o,{name:e.formData.name}))}e.$emit("create")}),null,!0),e.checkList.ids&&e.checkList.ids.length>0?e.moveFavorite(e.checkList,t.data,e.category,(function(t){var n;e.dialogVisible=!1,!["",null,void 0].includes(null==e||null===(n=e.formData)||void 0===n?void 0:n.name)&&e.$message.success(e.$t("collectCreate6",{name:e.formData.name})),e.$emit("create")})):(e.dialogVisible=!1,e.$emit("create",t.data)))})).finally((function(){e.isLoading=!1}))}},onEdit:function(){var e=this;this.isLoading=!0,this.formData.is_visible=!this.secret,this.category?this.formData.category=2:delete this.formData.category,Object(r.l)(this.formData).then((function(t){var n=(t||{}).status.code,code=void 0===n?"":n;["20201",20201].includes(code)?e.$message.error(e.category?e.$t("portfoliosOverLimit"):e.$t("boardOverLimit")):["20202",20202].includes(code)?e.$message.error(e.category?e.$t("portfolioOverRepeated"):e.$t("boardOverRepeated")):["20203",20203].includes(code)?e.$message.error(e.category?e.$t("violationPortfolioname"):e.$t("violationBoardname")):1e4===t.status.code&&(e.dialogVisible=!1,e.$emit("create"))})).finally((function(){e.isLoading=!1}))},onDelete:function(){var e=this;this.isDeleteLoading=!0,this.category?this.formData.category=2:delete this.formData.category,Object(r.k)({id:this.editData.id,category:this.category?2:null}).then((function(t){1e4===t.status.code&&(e.dialogVisible=!1,e.innerVisible=!1,e.$emit("delete"))})).finally((function(){e.isDeleteLoading=!1}))}}},v=(n(2301),n(2302),n(0)),component=Object(v.a)(m,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.editData.id?e.category?e.$t("editPortfolio"):e.$t("collectBox2"):e.category?e.$t("createPortfolio"):e.$t("collectBox1"),visible:e.dialogVisible,top:"30vh","append-to-body":"","modal-append-to-body":"",modal:"","close-on-click-modal":!0,center:"","custom-class":"SaDialog collection-create-dialog"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{staticClass:"main"},[e.getBannerUrl?t("img",{style:{filter:e.isGreen?"blur(19px) saturate(160%)":""},attrs:{decoding:"async",loading:"lazy",src:e.replaceImageType(e.getBannerUrl,"low")}}):e._e(),e._v(" "),t("div",{style:{width:"100%"}},[t("div",{staticClass:"title"},[e._v("\n          "+e._s(e.category?e.$t("portfolioName"):e.$t("collectBox3"))+"\n        ")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.name,expression:"formData.name"}],class:{inputActive:e.isInputActive},attrs:{type:"text",maxlength:"40",placeholder:e.category?e.$t("portfolioName"):e.$t("collectBox3")},domProps:{value:e.formData.name},on:{focus:function(t){e.isInputActive=!0},blur:function(t){e.isInputActive=!1},input:function(t){t.target.composing||e.$set(e.formData,"name",t.target.value)}}}),e._v(" "),t("div",{staticClass:"secret-box",class:[e.isColorBtn&&"secret-box-color"]},[t("div",{staticClass:"secret-text"},[t("span",[e._v(e._s(e.$t(e.category?"MakePortfolioPrivate":"collectBox4")))]),e._v(" "),t("span",[e._v("("+e._s(e.$t("OnlySee"))+")")])]),e._v(" "),t("el-switch",{staticClass:"secret-box-switch",on:{change:e.secretChange},model:{value:e.secret,callback:function(t){e.secret=t},expression:"secret"}})],1),e._v(" "),e.editData.id?t("div",{staticClass:"deleteCollect"},[t("div",{on:{click:function(t){e.innerVisible=!0}}},[e._v("\n            "+e._s(e.category?e.$t("deletePortfolio"):e.$t("collectBox5"))+"\n          ")]),e._v(" "),t("div",[e._v(e._s(e.category?e.$t("deletePortfolioDesc"):e.$t("collectBox6")))])]):e._e()])]),e._v(" "),t("div",{staticClass:"bntitem",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),e.editData.id?t("el-button",{attrs:{loading:e.isLoading},on:{click:e.onEdit}},[e._v(e._s(e.$t("Done")))]):t("el-button",{class:[e.isColorBtn&&"liner-color"],attrs:{loading:e.isLoading},on:{click:e.onCreate}},[e._v(e._s(e.$t("Create")))])],1),e._v(" "),t("el-dialog",{attrs:{visible:e.innerVisible,top:"40vh",width:e.width,"custom-class":"SaDialog","append-to-body":""},on:{"update:visible":function(t){e.innerVisible=t}}},[t("div",{staticClass:"sure"},[e._v("\n        "+e._s(e.category?e.$t("deletePortfolioAndWorks"):e.$t("collectBox7"))+"\n      ")]),e._v(" "),t("div",{staticClass:"sureDesc"},[e._v("\n        "+e._s(e.category?e.$t("newWorksPermanentlyDeleted",{name:e.editData.name}):e.$t("collectBox8",{name:e.editData.name}))+"\n      ")]),e._v(" "),t("div",{staticClass:"bntitem",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.innerVisible=!1}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("el-button",{attrs:{loading:e.isDeleteLoading},on:{click:e.onDelete}},[e._v(e._s(e.$t("Delete")))])],1)])],1)}),[],!1,null,"0e9c8fa9",null);t.a=component.exports},2301:function(e,t,n){"use strict";n(968)},2302:function(e,t,n){"use strict";n(969)},2303:function(e,t,n){"use strict";n(970)},2304:function(e,t,n){"use strict";n(971)},2306:function(e,t,n){"use strict";n(973)},2339:function(e,t,n){"use strict";n(1006)},2340:function(e,t,n){"use strict";n(1007)},2354:function(e,t,n){"use strict";n(1021)},2355:function(e,t,n){"use strict";n(1022)},2358:function(e,t,n){"use strict";n(1025)},2409:function(e,t,n){"use strict";n(1076)},2410:function(e,t,n){"use strict";n(1077)},2411:function(e,t,n){"use strict";n(1078)},2413:function(e,t,n){"use strict";n(1080)},2426:function(e,t,n){"use strict";n(1094)},2427:function(e,t,n){"use strict";n(1095)},2487:function(e,t,n){"use strict";n(1152)},2488:function(e,t,n){"use strict";n(1153)},2489:function(e,t,n){"use strict";n(1154)},2490:function(e,t,n){"use strict";n(1155)},2510:function(e,t,n){"use strict";n(1176)},2527:function(e,t,n){"use strict";n(1192)},2568:function(e,t,n){"use strict";n(1230)},2586:function(e,t,n){"use strict";n(1246)},2608:function(e,t,n){"use strict";n(1267)},2617:function(e,t,n){"use strict";n(1275)},264:function(e,t,n){"use strict";var o={name:"AppealDialog",props:{title:{type:String,default:"appeal"},placeholder:{type:String,default:"enterAppealCnt"},appealData:{type:Object,required:!0,default:function(){return{remark:""}}},isAppealing:{type:Boolean,default:!1},dialogVisible:{type:Boolean,default:!1},cancelText:{type:String,default:"Cancel"},submitText:{type:String,default:"Submit"},submitCallback:{type:Function,required:!0}},watch:{dialogVisible:function(e){this.internalVisible=e},internalVisible:function(e){this.$emit("update:dialogVisible",e)}},data:function(){return{internalVisible:!0}},mounted:function(){},methods:{submitAppeal:function(){console.log("in appeal dialog",this.appealData),this.submitCallback(this.appealData)}}},l=(n(2410),n(0)),component=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.$t(e.title),visible:e.internalVisible,width:"500px","modal-append-to-body":!1,"close-on-click-modal":!1,"custom-class":"SaDialog"},on:{"update:visible":function(t){e.internalVisible=t}}},[t("div",{staticClass:"appealCnt"},[t("el-input",{attrs:{type:"textarea",placeholder:e.$t(e.placeholder),maxlength:"50","show-word-limit":""},model:{value:e.appealData.remark,callback:function(t){e.$set(e.appealData,"remark",t)},expression:"appealData.remark"}})],1),e._v(" "),t("div",{staticClass:"bntitem",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.internalVisible=!1}}},[e._v(e._s(e.$t(e.cancelText)))]),e._v(" "),t("el-button",{attrs:{loading:e.isAppealing},on:{click:e.submitAppeal}},[e._v(e._s(e.$t(e.submitText)))])],1)])}),[],!1,null,null,null);t.a=component.exports},2641:function(e,t,n){"use strict";n(1299)},265:function(e,t,n){"use strict";n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),l=n(1);function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var c={name:"FrameDtl",props:{imgIsHide:{type:Boolean,default:!1},type:{type:String,default:"work"},unableTxt:{type:String,default:"PictureHidden"}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(l.e)("app",["imagePageFromPath"])),data:function(){return{}},mounted:function(){if(history.length<=2){var e="openFirst".concat(this.type,"ID");sessionStorage.setItem(e,this.$route.params.id)}},methods:{backTo:function(){var e="openFirst".concat(this.type,"ID"),t=sessionStorage.getItem(e);!t||t&&t!==this.$route.params.id||"Home"!==this.imagePageFromPath&&"/"!==this.imagePageFromPath&&this.imagePageFromPath?this.$router.back():this.$router.push(this.localePath("/"))}}},d=c,h=(n(2413),n(0)),component=Object(h.a)(d,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"imgpage-image-hold w-full",on:{"~click":function(t){return t.target!==t.currentTarget?null:e.backTo.apply(null,arguments)}}},[e.imgIsHide?t("div",{staticClass:"imgpage-image-info-container no-data"},[t("img",{staticClass:"null-image",attrs:{src:n(327),alt:"null_image"}}),e._v(" "),t("div",{staticClass:"null-tips"},[e._v(e._s(e.$t(e.unableTxt)))])]):t("div",{staticClass:"imgpage-image-info-container",class:{m60:e.$slots.title}},[e._t("title"),e._v(" "),e._t("default")],2)])}),[],!1,null,"15de963a",null);t.a=component.exports},2657:function(e,t,n){"use strict";n(1315)},2666:function(e,t,n){"use strict";n(1324)},271:function(e,t,n){"use strict";n(4);var o=n(105),l={name:"changeVerNew",props:["item","disabled","base_models"],data:function(){return{show:!1,list:[],loading:!1}},watch:{show:{handler:function(e){var t=this,n=!(this.list||[]).some((function(e){var n;return(null==e?void 0:e.id)===(null===(n=t.item)||void 0===n?void 0:n.id)}));if(e&&n){if(this.loading)return;this.loading=!0,this.list=[];var l={model_id:this.item.id};this.base_models&&(l.base_models=this.base_models),Object(o.f)(l).then((function(e){var n,o;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&(t.list=(null==e||null===(o=e.data)||void 0===o?void 0:o.items)||[])})).finally((function(){t.loading=!1}))}}}},methods:{selectItem:function(e){this.$emit("selectItem",e),this.show=!1},openPopup:function(){this.show=!0},closePopup:function(){this.show=!1}}},r=(n(2997),n(0)),component=Object(r.a)(l,(function(){var e=this,t=e._self._c;return t("el-popover",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.closePopup,expression:"closePopup"}],attrs:{placement:"bottom",trigger:"click","visible-arrow":!1,disabled:e.disabled},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"verList"},e._l(e.list,(function(n,o){return t("div",{key:o,on:{click:function(t){return e.selectItem(n)}}},[e._v(e._s(n.version_no))])})),0),e._v(" "),t("div",{staticClass:"change-ver-new",attrs:{slot:"reference"},on:{click:function(e){e.stopPropagation()}},slot:"reference"},[t("span",[e._v(e._s(e.item.version_name))]),e._v(" "),t("i",{staticClass:"el-icon-arrow-down"})])])}),[],!1,null,"141eb81c",null);t.a=component.exports},2851:function(e,t,n){"use strict";n(1502)},2882:function(e,t,n){"use strict";n(1532)},2883:function(e,t,n){"use strict";n(1533)},2884:function(e,t,n){"use strict";n(1534)},2940:function(e,t,n){"use strict";n(1593)},2980:function(e,t,n){"use strict";n(1630)},2981:function(e,t,n){"use strict";n(1631)},2982:function(e,t,n){"use strict";n(1632)},2983:function(e,t,n){"use strict";n(1633)},2984:function(e,t,n){"use strict";n(1634)},2985:function(e,t,n){"use strict";n(1635)},2986:function(e,t,n){"use strict";n(1636)},2987:function(e,t,n){"use strict";n(1637)},2988:function(e,t,n){"use strict";n(1638)},2990:function(e,t,n){"use strict";n(1639)},2991:function(e,t,n){"use strict";n(1640)},2992:function(e,t,n){"use strict";n(1641)},2993:function(e,t,n){"use strict";n(1642)},2994:function(e,t,n){"use strict";n(1643)},2996:function(e,t,n){"use strict";n(1645)},2997:function(e,t,n){"use strict";n(1646)},2998:function(e,t,n){"use strict";n(1647)},2999:function(e,t,n){"use strict";n(1648)},3e3:function(e,t,n){"use strict";n(1649)},3001:function(e,t,n){"use strict";n(1650)},3002:function(e,t,n){"use strict";n(1651)},3003:function(e,t,n){"use strict";n(1652)},3004:function(e,t,n){"use strict";n(1653)},3005:function(e,t,n){"use strict";n(1654)},3006:function(e,t,n){"use strict";n(1655)},3007:function(e,t,n){"use strict";n(1656)},3008:function(e,t,n){"use strict";n(1657)},3009:function(e,t,n){"use strict";n(1658)},3010:function(e,t,n){"use strict";n(1659)},3011:function(e,t,n){"use strict";n(1660)},3012:function(e,t,n){"use strict";n(1661)},3013:function(e,t,n){"use strict";n(1662)},3014:function(e,t,n){"use strict";n(1663)},3015:function(e,t,n){"use strict";n(1664)},3016:function(e,t,n){"use strict";n(1665)},3017:function(e,t,n){"use strict";n(1666)},3018:function(e,t,n){"use strict";n(1667)},3019:function(e,t,n){"use strict";n(1668)},3020:function(e,t,n){"use strict";n(1669)},3021:function(e,t,n){"use strict";n(1670)},3022:function(e,t,n){"use strict";n(1671)},3023:function(e,t,n){"use strict";n(1672)},3025:function(e,t,n){"use strict";n(1673)},3026:function(e,t,n){"use strict";n(1674)},3027:function(e,t,n){"use strict";n(1675)},3028:function(e,t,n){"use strict";n(1676)},3029:function(e,t,n){"use strict";n(1677)},3030:function(e,t,n){"use strict";n(1678)},3031:function(e,t,n){"use strict";n(1679)},3032:function(e,t,n){"use strict";n(1680)},3033:function(e,t,n){"use strict";n(1681)},3035:function(e,t,n){"use strict";n(1682)},3037:function(e,t,n){"use strict";n(1683)},3038:function(e,t,n){"use strict";n(1684)},3039:function(e,t,n){"use strict";n(1685)},3040:function(e,t,n){"use strict";n(1686)},3041:function(e,t,n){"use strict";n(1687)},3042:function(e,t,n){"use strict";n(1688)},3043:function(e,t,n){"use strict";n(1689)},3046:function(e,t,n){"use strict";n(1690)},3047:function(e,t,n){"use strict";n(1691)},3048:function(e,t,n){"use strict";n(1692)},3049:function(e,t,n){"use strict";n(1693)},3051:function(e,t,n){"use strict";n(1694)},3052:function(e,t,n){"use strict";n(1695)},3053:function(e,t,n){"use strict";n(1696)},3054:function(e,t,n){"use strict";n(1697)},3055:function(e,t,n){"use strict";n(1698)},3056:function(e,t,n){"use strict";n(1699)},3057:function(e,t,n){"use strict";n(1700)},3058:function(e,t,n){"use strict";n(1701)},3059:function(e,t,n){"use strict";n(1702)},3060:function(e,t,n){"use strict";n(1703)},3061:function(e,t,n){"use strict";n(1704)},3062:function(e,t,n){"use strict";n(1705)},3063:function(e,t,n){"use strict";n(1706)},3064:function(e,t,n){"use strict";n(1707)},3065:function(e,t,n){"use strict";n(1708)},3066:function(e,t,n){"use strict";n(1709)},3067:function(e,t,n){"use strict";n(1710)},3068:function(e,t,n){"use strict";n(1711)},3069:function(e,t,n){"use strict";n(1712)},3070:function(e,t,n){"use strict";n(1713)},3071:function(e,t,n){"use strict";n(1714)},3072:function(e,t,n){"use strict";n(1715)},3073:function(e,t,n){"use strict";n(1716)},3074:function(e,t,n){"use strict";n(1717)},3075:function(e,t,n){"use strict";n(1718)},3076:function(e,t,n){"use strict";n(1719)},3077:function(e,t,n){"use strict";n(1720)},3078:function(e,t,n){"use strict";n(1721)},3079:function(e,t,n){"use strict";n(1722)},3080:function(e,t,n){"use strict";n(1723)},3081:function(e,t,n){"use strict";n(1724)},3082:function(e,t,n){"use strict";n(1725)},3083:function(e,t,n){"use strict";n(1726)},3084:function(e,t,n){"use strict";n(1727)},3085:function(e,t,n){"use strict";n(1728)},3086:function(e,t,n){"use strict";n(1729)},3087:function(e,t,n){"use strict";n(1730)},3088:function(e,t,n){"use strict";n(1731)},3089:function(e,t,n){"use strict";n(1732)},3091:function(e,t,n){"use strict";n(1733)},3092:function(e,t,n){"use strict";n(1734)},3093:function(e,t,n){"use strict";n(1735)},3094:function(e,t,n){"use strict";n(1736)},3095:function(e,t,n){"use strict";n(1737)},3096:function(e,t,n){"use strict";n(1738)},3097:function(e,t,n){"use strict";n(1739)},3098:function(e,t,n){"use strict";n(1740)},3099:function(e,t,n){"use strict";n(1741)},3100:function(e,t,n){"use strict";n(1742)},3101:function(e,t,n){"use strict";n(1743)},3102:function(e,t,n){"use strict";n(1744)},3103:function(e,t,n){"use strict";n(1745)},3104:function(e,t,n){"use strict";n(1746)},3105:function(e,t,n){"use strict";n(1747)},3106:function(e,t,n){"use strict";n(1748)},3107:function(e,t,n){"use strict";n(1749)},3108:function(e,t,n){"use strict";n(1750)},3109:function(e,t,n){"use strict";n(1751)},3110:function(e,t,n){"use strict";n(1752)},3111:function(e,t,n){"use strict";n(1753)},3112:function(e,t,n){"use strict";n(1754)},3114:function(e,t,n){"use strict";n(1755)},3115:function(e,t,n){"use strict";n(1756)},3116:function(e,t,n){"use strict";n(1757)},3117:function(e,t,n){"use strict";n(1758)},3118:function(e,t,n){"use strict";n(1759)},3119:function(e,t,n){"use strict";n(1760)},3120:function(e,t,n){"use strict";n(1761)},3121:function(e,t,n){"use strict";n(1762)},3122:function(e,t,n){"use strict";n(1763)},3123:function(e,t,n){"use strict";n(1764)},3124:function(e,t,n){"use strict";n(1765)},3125:function(e,t,n){"use strict";n(1766)},3126:function(e,t,n){"use strict";n(1767)},3127:function(e,t,n){"use strict";n(1768)},3128:function(e,t,n){"use strict";n(1769)},3129:function(e,t,n){"use strict";n(1770)},3130:function(e,t,n){"use strict";n(1771)},3131:function(e,t,n){"use strict";n(1772)},3132:function(e,t,n){"use strict";n(1773)},3133:function(e,t,n){"use strict";n(1774)},3134:function(e,t,n){"use strict";n(1775)},3135:function(e,t,n){"use strict";n(1776)},3136:function(e,t,n){"use strict";n(1777)},3137:function(e,t,n){"use strict";n(1778)},3138:function(e,t,n){"use strict";n(1779)},3139:function(e,t,n){"use strict";n(1780)},3140:function(e,t,n){"use strict";n(1781)},3141:function(e,t,n){"use strict";n(1782)},3142:function(e,t,n){"use strict";n(1783)},3143:function(e,t,n){"use strict";n(1784)},3144:function(e,t,n){"use strict";n(1785)},3145:function(e,t,n){"use strict";n(1786)},3146:function(e,t,n){"use strict";n(1787)},3162:function(e,t,n){"use strict";n(1800)},3163:function(e,t,n){"use strict";n(1801)},3164:function(e,t,n){"use strict";n(1802)},3165:function(e,t,n){"use strict";n(1803)},3166:function(e,t,n){"use strict";n(1804)},3167:function(e,t,n){"use strict";n(1805)},3168:function(e,t,n){"use strict";n(1806)},3169:function(e,t,n){"use strict";n(1807)},3170:function(e,t,n){"use strict";n(1808)},3171:function(e,t,n){"use strict";n(1809)},3173:function(e,t,n){"use strict";n(1810)},3174:function(e,t,n){"use strict";n(1811)},3175:function(e,t,n){"use strict";n(1812)},3176:function(e,t,n){"use strict";n(1813)},3201:function(e,t,n){"use strict";n(1837)},3202:function(e,t,n){"use strict";n(1838)},3206:function(e,t,n){"use strict";n.r(t);n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),l=(n(28),n(13));function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={props:{type:{type:String,default:""},options:{type:[Object,Array,String,Number,Boolean,Function],default:function(){return{}}},confirm:{type:Function,default:function(){}},close:{type:Function,default:function(){}},destroy:{type:Function,default:function(){}}},data:function(){return{component:"",value:!0,popupParam:l.L}},watch:{type:function(e){var t=this;this.component=function(e){return Promise.all([n.e(0),n.e(6),n.e(1),n.e(5),n.e(2),n.e(4),n.e(3),n.e(110)]).then(function(){var o=[n(4283)("".concat(t.type,".vue"))];e.apply(null,o)}.bind(this)).catch(n.oe)}}},methods:{onConfirm:function(e){"function"==typeof this.confirm&&this.confirm(e)},onClose:function(e){this.value=!1,"function"==typeof this.close&&this.close(e)}},render:function(e){var t;return e("div",{},[e("div",{class:"popup_parent",style:c(c({},(null===(t=this.options)||void 0===t?void 0:t.style)||{}),{},{display:this.value?"block":"none",zIndex:this.popupParam.patface.z})},[e(this.component,{directives:[{name:this.value?"popupFixed":null}],props:c({},this.$props)})])])}},h=(n(2851),n(0)),component=Object(h.a)(d,undefined,undefined,!1,null,"82b1f0c4",null);t.default=component.exports},3233:function(e,t,n){"use strict";n(16),n(19),n(71),n(3230),n(29);var o=n(1926),l=(n(14),n(685)),r=(n(3033),n(0)),component=Object(r.a)(l.a,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"PromptWork active",class:{isPNGExporting:e.isPNGExporting},on:{click:e.onWorkClick}},[t("div",{staticClass:"AddArea Area"},[t("div",{staticClass:"cover-area"},[t("div",{staticClass:"WorkInfoArea Area"},[t("div",{staticClass:"WorkName"},[t("input",{attrs:{type:"text",disabled:""},domProps:{value:e.$t("Input")}})])]),e._v(" "),t("el-input",{staticClass:"input",attrs:{type:"textarea",placeholder:e.$t("OPS_pls_input"),rows:"13",spellcheck:"false",maxlength:"1000","show-word-limit":""},on:{paste:e.onUserInputDebounce,input:e.onUserInputDebounce,keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onUserInputDebounce.apply(null,arguments)},change:e.onUserInputDebounce},model:{value:e.inputText,callback:function(t){e.inputText=t},expression:"inputText"}})],1),e._v(" "),t("div",{staticClass:"cover-area"},[t("div",{staticClass:"WorkInfoArea Area"},[t("div",{staticClass:"WorkName"},[t("input",{attrs:{type:"text",disabled:""},domProps:{value:e.$t("Output")}})])]),e._v(" "),t("div",{staticClass:"output"},[[e._v(" "+e._s(e.outputText))]],2),e._v(" "),t("div",{staticClass:"options"},[t("div",{staticClass:"line"},[t("button",{attrs:{title:"copy"},on:{click:function(t){return e.copy(e.outputText)}}},[t("i",{staticClass:"iconfont icon-copy-ops"}),e._v("\n              "+e._s(e.$t("OPS_copy"))+"\n            ")]),e._v(" "),t("button",{attrs:{title:"clear"},on:{click:function(t){return e.doClear()}}},[t("i",{staticClass:"iconfont icon-clear-ops"}),e._v("\n              "+e._s(e.$t("OPS_clear_input"))+"\n            ")])]),e._v(" "),t("div",{staticClass:"line line-spacial"},[t("button",{staticClass:"line-generate-btn",attrs:{title:e.$t("Generate")},on:{click:function(t){return e.handleGenerate(e.outputText)}}},[e._v("\n              "+e._s(e.$t("Generate"))+"\n            ")])])])])]),e._v(" "),t("div",{ref:"main",staticClass:"main"},[t("div",{staticClass:"PromptListArea Area",class:[e.promptWork.groups.length<=1?"noGroup":"hasGroup"],on:{contextmenu:function(e){e.preventDefault()}}},e._l(e.promptWork.groups,(function(n,o){return t("div",{key:o,staticClass:"PromptGroup"},[e.promptWork.groups.length>1?t("div",{staticClass:"PromptGroupTitle"},[t("div",{staticClass:"name"},[t("input",{attrs:{value:"权重组"}}),e._v(" "),n.name?t("span",[e._v(e._s(n.name))]):e._e(),e._v(" "),n.groupLv&&1!=n.groupLv?t("span",{staticClass:"groupLv"},[e._v(e._s(n.groupLv))]):e._e()])]):e._e(),e._v(" "),e._l(n.lists,(function(o){return t("PromptList",{key:o.data.id,class:["promptList-type-".concat(o.data.id)],attrs:{list:o},on:{update:function(t){return e.doExportPrompt()}}},[t("div",{staticClass:"name-bar"},[t("div",{staticClass:"name",class:["type-".concat(o.data.id)],attrs:{title:o.data.name}},[t("span",{staticClass:"content"},[e._v(e._s(o.data.name||o.data.id))])])]),e._v(" "),t("div",{staticClass:"list PromptList-list"},[e._l(o.items,(function(n){return t("PromptItem",{key:n.data.word.id,attrs:{item:n,list:o},on:{click:function(t){return e.onItemClick(n)},update:function(t){return e.onItemUpdate(n)},contextmenu:function(t){return e.doOpenItemMenu(t,o)}}})})),e._v(" "),t("div",{staticClass:"add-btn flex items-center justify-center",on:{click:function(t){return e.onPromptListClick(t,o,{group:n.id,lv:n.groupLv,subType:o.data.id})}}},[t("i",{staticClass:"iconfont icon-add-icon add-btn-icon"})])],2)])}))],2)})),0)]),e._v(" "),t("PromptMenu",{ref:"menu"})],1)}),[],!1,null,null,null),c=component.exports,d=n(3034),h=n(5).d,m={props:["initPrompts"],data:function(){Object(d.a)();var e=new o.b({initPrompts:this.initPrompts});return{LocalTrasnslateServer:o.a,promptEditor:e,adDelay:!1}},inject:["top"],components:{PromptWork:c},provide:function(){var e=this;return setTimeout((function(){return e.adDelay=!0}),500),{PromptEditor:this}},watch:{"promptEditor.data.server":{immediate:!0,handler:function(e){globalThis.__OPS_SERVER=e}}},methods:{doAddWorkspace:function(){var e=this;this.promptEditor.addWorkspace(),setTimeout((function(){e.$refs["operate-tool"].scrollIntoView({behavior:"smooth"})}),100)},doCopyWorkspaceUrl:function(){var e=this.promptEditor.works.map((function(e){return e.exportPrompts()})),q=encodeURIComponent(JSON.stringify(e)),t="".concat(location.origin+location.pathname,"?prompts=").concat(q);h(t)},doDeletePromptWork:function(e){this.promptEditor.removeWorkspace(e)}},computed:{needShowAd:function(){var e;if(this.adDelay&&null!==(e=this.promptEditor.data.server)&&void 0!==e&&e.startsWith("https://indexfs.moonvy.com"))return!0}}},v=(n(3035),Object(r.a)(m,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"PromptEditor"},[t("div",{staticClass:"workspace"},e._l(e.promptEditor.works,(function(n){return t("PromptWork",{key:"work-".concat((new Date).getTime(),"-").concat(Math.floor(1e3*Math.random())),attrs:{"prompt-work":n},on:{delete:e.doDeletePromptWork}})})),1),e._v(" "),e._e()])}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"PromptList"},[e._v("\n                普通：\n                "),t("div",{staticClass:"list"},[t("div",{staticClass:"PromptItem"},[t("div",{staticClass:"displayName name"},[t("div",{staticClass:"lv"},[e._v("2")]),e._v("\n                            Apple\n                        ")])]),e._v(" "),t("div",{staticClass:"PromptItem"},[t("div",{staticClass:"displayName name"},[t("div",{staticClass:"lv"},[e._v("1.2")]),e._v("\n                            List Name\n                        ")]),e._v(" "),t("div",{staticClass:"descName name"},[e._v("模型版本 4")])]),e._v(" "),t("div",{staticClass:"PromptItem"},[t("div",{staticClass:"displayName name"},[e._v("--style 4a")]),e._v(" "),t("div",{staticClass:"descName name"},[e._v("样式 4a")])])])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"PromptList"},[e._v("\n                风格：\n                "),t("div",{staticClass:"list"},[t("div",{staticClass:"PromptItem subType-style"},[t("div",{staticClass:"displayName name"},[e._v("3D")])]),e._v(" "),t("div",{staticClass:"PromptItem subType-style"},[t("div",{staticClass:"displayName name"},[e._v("Oil")]),e._v(" "),t("div",{staticClass:"descName name"},[e._v("油画风格")])]),e._v(" "),t("div",{staticClass:"PromptItem subType-style"},[t("div",{staticClass:"displayName name"},[t("div",{staticClass:"lv"},[e._v("2.5")]),e._v("\n                            Oil\n                        ")]),e._v(" "),t("div",{staticClass:"descName name"},[e._v("油画风格")])]),e._v(" "),t("div",{staticClass:"PromptItem subType-style"},[t("div",{staticClass:"displayName name"},[e._v("Bubble Mart")]),e._v(" "),t("div",{staticClass:"descName name"},[e._v("泡泡玛特模型")])])])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"PromptList"},[e._v("\n                质量：\n                "),t("div",{staticClass:"list"},[t("div",{staticClass:"PromptItem subType-quality"},[t("div",{staticClass:"displayName name"},[e._v("4K")])]),e._v(" "),t("div",{staticClass:"PromptItem subType-quality"},[t("div",{staticClass:"displayName name"},[t("div",{staticClass:"lv"},[e._v("2")]),e._v("\n                            high quality\n                        ")]),e._v(" "),t("div",{staticClass:"descName name"},[e._v("高质量")])])])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"PromptList"},[e._v("\n                命令：\n                "),t("div",{staticClass:"list"},[t("div",{staticClass:"PromptItem subType-command"},[t("div",{staticClass:"displayName name"},[e._v("--only")])]),e._v(" "),t("div",{staticClass:"PromptItem subType-command"},[t("div",{staticClass:"displayName name"},[e._v("--v 4")]),e._v(" "),t("div",{staticClass:"descName name"},[e._v("模型版本 4")])]),e._v(" "),t("div",{staticClass:"PromptItem subType-command"},[t("div",{staticClass:"displayName name"},[e._v("--style 4a")]),e._v(" "),t("div",{staticClass:"descName name"},[e._v("样式 4a")])])])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"PromptList"},[e._v("\n                负面：\n                "),t("div",{staticClass:"list"},[t("div",{staticClass:"PromptItem subType-eg"},[t("div",{staticClass:"displayName name"},[e._v("bad")])]),e._v(" "),t("div",{staticClass:"PromptItem subType-eg"},[t("div",{staticClass:"displayName name"},[e._v("bad finger")]),e._v(" "),t("div",{staticClass:"descName name"},[e._v("坏手指")])]),e._v(" "),t("div",{staticClass:"PromptItem subType-eg"},[t("div",{staticClass:"displayName name"},[e._v("low")]),e._v(" "),t("div",{staticClass:"descName name"},[e._v("低质量")])])])])}],!1,null,null,null));t.a=v.exports},3234:function(e,t,n){"use strict";n.r(t);n(14);var o=n(2),l=(n(9),n(7),n(19),n(8),n(11),n(12),n(4),n(6),n(54)),r=n(5),c=n(13),d=n(81);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v={name:"PublishPop",data:function(){return{formData:{name:"",category:"",intro:"",publish_type:"",type:2,cover:{width:720,height:720,uri:""}},categoryList:[],tpl_id:"",flag:!0,agree:!0,loading:!1,rules:{name:[{required:!0,message:this.$ti("pleaseEnte"),trigger:"change"}],category:[{required:!0,message:this.$ti("PleaseEnterModelCategoryTags"),trigger:"change"}]}}},props:{options:{type:Object,default:function(){return{}}}},mounted:function(){this.getTagType()},methods:{getTagType:function(){var e,t=this,n=localStorage.getItem("userInfo")?null===(e=JSON.parse(localStorage.getItem("userInfo")).settings)||void 0===e?void 0:e.lang_code:"en";Object(d.a)({show_area:"design_template"}).then((function(e){t.categoryList=e.data.length?e.data.map((function(e){return{label:e[c.l[n]],value:e.id}})):[]}))},cancel:function(){this.$parent.onClose(),this.reset()},closePop:function(){this.$parent.destroy()},copyLink:function(){var path=window.location.href+"/detail/"+this.tpl_id;Object(r.d)(path),this.options.copySuccess()},reset:function(){this.formData={name:"",category:"",intro:"",publish_type:"",type:1,cover:{width:720,height:720,uri:""}},this.$refs.formData.resetFields()},$ti:function(text){return this.options.$t(text)},goPage:function(){var path="/editBoard/detail/"+this.tpl_id;window.open(path,"_blank")},submit:function(){var e=this;this.$refs.formData.validate((function(t){t&&(e.loading=!0,e.formData.cover={width:parseInt(e.options.width),height:parseInt(e.options.height),uri:e.options.url},Object(l.F)(m(m({},e.formData),{},{id:e.options.id,task_id:e.options.task_id,publish_type:e.agree?2:1})).then((function(t){e.flag=!1,e.tpl_id=t.data.tpl_id,e.$message.success(e.$ti("PulishSuccess"))})).finally((function(){e.loading=!1})))}))}}},f=(n(3202),n(0)),component=Object(f.a)(v,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"PublishPop"},[e.flag?t("div",{staticClass:"before"},[t("img",{staticClass:"pic",attrs:{src:e.options.url}}),e._v(" "),t("el-form",{ref:"formData",staticClass:"custom-form",attrs:{model:e.formData,rules:e.rules}},[t("div",{staticClass:"flex"},[t("el-form-item",{attrs:{label:e.$ti("trainName"),prop:"name"}},[t("el-input",{staticClass:"inp",attrs:{maxlength:"100",placeholder:e.$ti("pleaseEnte")},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:e.$ti("categoryTags"),prop:"category"}},[t("el-select",{staticClass:"inp",attrs:{"popper-class":"custom-select",placeholder:e.$ti("PleaseEnterModelCategoryTags"),"popper-append-to-body":!1},model:{value:e.formData.category,callback:function(t){e.$set(e.formData,"category",t)},expression:"formData.category"}},e._l(e.categoryList,(function(e,n){return t("el-option",{key:n,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),t("el-form-item",{attrs:{label:e.$ti("Desc"),props:"name"}},[t("el-input",{attrs:{placeholder:e.$ti("pleaseEnte")},model:{value:e.formData.intro,callback:function(t){e.$set(e.formData,"intro",t)},expression:"formData.intro"}})],1)],1),e._v(" "),t("div",{staticClass:"footer"},[t("div",{staticClass:"agree"}),e._v(" "),t("div",{staticClass:"button"},[t("div",{staticClass:"cancel btn pointer",on:{click:e.cancel}},[e._v(e._s(e.$ti("Cancel")))]),e._v(" "),t("div",{staticClass:"publish btn pointer",on:{click:e.submit}},[e._v(e._s(e.$ti("Publish")))])])])],1):t("div",{staticClass:"after"},[t("i",{staticClass:"el-icon-close close_publish",on:{click:e.closePop}}),e._v(" "),t("i",{staticClass:"iconfont icon-Group Group"}),e._v(" "),t("p",{staticClass:"line_1"},[e._v(e._s(e.$ti("tempSuccess")))]),e._v(" "),t("div",{staticClass:"foot"},[t("span",{staticClass:"share",on:{click:e.copyLink}},[t("i",{staticClass:"iconfont icon-a-copylink"}),e._v(" "),t("span",[e._v(e._s(e.$ti("CopyLink")))])]),e._v(" "),t("span",{staticClass:"view",on:{click:e.goPage}},[t("i",{staticClass:"iconfont icon-a-Vector206Stroke",staticStyle:{"font-size":"14px"}}),e._v(" "),t("span",[e._v(e._s(e.$ti("viewTem")))])])])])])}),[],!1,null,"62f2a06f",null);t.default=component.exports},3235:function(e,t,n){"use strict";n(14);var o=n(15),l=n(3),r=(n(20),n(16),n(10),n(23),n(71),n(3036)),c=n(1840),d=n(1931),h=n(5),m=n(24),v=Object(h.n)("ops-notion-apiKey",""),f=Object(h.n)("ops-notion-databaseId",""),_=Object(h.n)("ops-notion-onlyMyNotion",!1),y=Object(h.n)("ops-notion-enableMyNotion",!0),w={data:function(){return{dict:null,activeDir:null,apiKey:v,databaseId:f,input_databaseId:f.value,onlyMyNotion:_,enableMyNotion:y,notionName:null,notionUrl:null,loading:!1,isHoverButton:!1}},inject:["top"],watch:{input_databaseId:{handler:function(e){if(e.startsWith("https://")){var t,n=/\/([0-9a-f]{32})/.exec(e);if(32==(null==n||null===(t=n[1])||void 0===t?void 0:t.length)){var o=null==n?void 0:n[1];this.input_databaseId=o}else this.input_databaseId=""}else e&&32!=e.length&&(this.input_databaseId="");this.databaseId=e}},"$i18n.locale":function(e){this.loadData(!0)}},mounted:function(){this.loadData(),this.notioConfigActive&&this.reloadData()},methods:{loadData:function(e){var t=this;Object(r.a)(_.value,e).then((function(e){t.dict=e,t.activeDir=e[0]}))},reloadData:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!y.value){t.next=3;break}return t.next=3,e.fetchNotion();case 3:e.loadData();case 4:case"end":return t.stop()}}),t)})))()},fetchNotion:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var n,o,l,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,e.notionName=null,e.notionUrl=null,l=Object(d.a)(),t.next=7,l.fetchNotion({apiKey:v.value,databaseId:f.value});case 7:r=t.sent,e.notionName=null==r||null===(n=r.me)||void 0===n?void 0:n.name,e.notionUrl=null==r||null===(o=r.me)||void 0===o?void 0:o.url,t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("[Notion]",t.t0),/Make sure the relevant pages and databases are shared with your integration/.test(t.t0.message)?alert("Notion 连接错误："+t.t0):alert("Notion 连接错误：没有 Notion 数据库的访问权限。请在此 Notion 数据库页面菜单的 'Connections' 中添加你的集成应用");case 16:return t.prev=16,e.loading=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[0,12,16,19]])})))()},doApplyWord:function(e){return Object(l.a)(regeneratorRuntime.mark((function t(){var n,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=document.body.querySelector(".PromptWork.active"))||(n=document.body.querySelector(".PromptWork")),!n){t.next=8;break}return o=e.data.word.rawText||e.data.word.text,l=n.__vue__,t.next=7,l.promptWork.reflowPrompts(o);case 7:l.doExportPrompt();case 8:case"end":return t.stop()}}),t)})))()},doChangeActiveDir:function(e){this.activeDir=e},doGotoNotionMe:function(){this.notionUrl&&window.open(this.notionUrl)},setNotionHover:Object(m.debounce)((function(e){this.isHoverButton=e}),400)},components:{PromptItem:c.a},computed:{currentMode:function(){var e;return null==this||null===(e=this.top)||void 0===e||null===(e=e.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.category},showCommandTab:function(){return function(e){var t=!0;return[1,2,"1","2"].includes(this.currentMode)&&"OPS_command"!==e.langKey?t:(![1,2,"1","2"].includes(this.currentMode)||"OPS_command"!==e.langKey)&&([3,"3"].includes(this.currentMode)?t:void 0)}},activeSubDirs:function(){if(this.activeDir)return[this.activeDir].concat(Object(o.a)(this.activeDir.children))},notioConfigActive:function(){return!(!this.databaseId||!this.apiKey)},isOpenDir:function(){return function(e){var t=e.name;return["质量","绘画","风格","画面效果"].includes(t)&&e.words.length>3}}}},C=(n(3037),n(0)),component=Object(C.a)(w,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"PromptDict"},[e.dict?t("div",{staticClass:"dir-buttons"},[e._l(e.dict,(function(n,i){return[t("button",{key:"dir_".concat(i),class:{active:n==e.activeDir},on:{click:function(t){return e.doChangeActiveDir(n)}}},[e._v("\n                "+e._s(e.$t(n.langKey)||n.name)+"\n              ")])]}))],2):e._e(),e._v(" "),e.activeDir?t("div",{staticClass:"active-dir"},e._l(e.activeSubDirs,(function(n){return t("details",{key:n.name,staticClass:"sub-dir",attrs:{open:e.isOpenDir(n)}},[t("summary",{directives:[{name:"show",rawName:"v-show",value:n.name!=e.activeDir.name,expression:"subDir.name != activeDir.name"}],staticClass:"name"},[t("span",{staticClass:"title"},[e._v(e._s(e.$t(n.langKey)||n.name))]),e._v(" "),t("span",{staticClass:"len"},[e._v(e._s(n.words.length))])]),e._v(" "),t("div",{staticClass:"list"},e._l(n.words,(function(n){return t("div",{staticClass:"item"},[t("PromptItem",{staticClass:"dict-word",attrs:{item:n},on:{click:function(t){return e.doApplyWord(n)}}})],1)})),0)])})),0):e._e()])}),[],!1,null,null,null);t.a=component.exports},3236:function(e,t,n){"use strict";var o={},l=(n(3030),n(0)),component=Object(l.a)(o,(function(){var e=this;return(0,e._self._c)("button",{staticClass:"AddButton",on:{click:function(t){return e.$emit("click",t)}}})}),[],!1,null,"e91cf4fc",null);t.a=component.exports},3237:function(e,t,n){"use strict";var o=n(5).d,l={mounted:function(){var e=this;this.$nextTick((function(){})),document.addEventListener("mousedown",(function(t){e.show&&(e.$el.contains(t.target)||e.close())}))},data:function(){return{show:!1,bindEl:null,clickW:0,promptList:null,item:null}},methods:{doCopy:function(){this.close(),o(this.item.data.word.rawText)},doEdit:function(){this.close(),this.item.state.isEdit="text",this.bindEl.__vue__.doFoucs()},doEditLang:function(){this.close(),this.item.state.isEdit="lang",this.bindEl.__vue__.doFoucs()},doDelete:function(){this.close(),this.promptList.removePrompt(this.item),this.bindEl.__vue__.$emit("update")},open:function(e){var t=e.item,n=e.el,o=e.event,l=e.promptList;this.bindEl=n,this.clickW=o.clientX,this.show=!0,this.item=t,this.promptList=l,this.updatePosition()},close:function(){this.show=!1},updatePosition:function(){if(this.bindEl){var e=this.$refs.menu;if(e){var t=e.getBoundingClientRect().width,rect=this.bindEl.getBoundingClientRect();e.style.left="".concat(this.clickW-t/2,"px"),e.style.top="".concat(rect.y+rect.height,"px")}}}},computed:{},beforeDestroy:function(){}},r=(n(3032),n(0)),component=Object(r.a)(l,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],ref:"menu",staticClass:"PromptMenu"},[t("button",{staticClass:"prompt-menu-btn",on:{click:e.doCopy}},[t("i",{staticClass:"iconfont icon-copy"}),e._v("\n      "+e._s(e.$t("OPS_copy")))]),e._v(" "),t("button",{staticClass:"prompt-menu-btn",on:{click:e.doEdit}},[t("i",{staticClass:"iconfont icon-edit1"}),e._v(" "+e._s(e.$t("Edit")))]),e._v(" "),t("button",{staticClass:"prompt-menu-btn",on:{click:e.doDelete}},[t("i",{staticClass:"iconfont icon-work-delete"}),e._v("\n      "+e._s(e.$t("Delete"))+"\n    ")])])}),[],!1,null,null,null);t.a=component.exports},3238:function(e,t,n){"use strict";n.r(t);n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(3200),l=n.n(o),r=n(2),c=(n(19),n(28),n(113),n(40)),d=n(77),h=n(1),m=n(68);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _={data:function(){return{banners:[],currenIdnex:0,column:{}}},props:{options:{type:[Object,Array,String,Number,Boolean,Function],default:function(){return{}}}},created:function(){this.banners=this.options.data.page,this.column=this.banners[0]},methods:f(f({},Object(h.b)("user",["recordCurrentGenerateModeVersion"])),{},{handleSwiper:function(e){this.$refs.carousel.setActiveItem(e),this.currenIdnex=e,this.column=this.banners[e]},goPage:function(){if("https://aiart-openresty.dev.seaart.dev/image-generation"===this.column.link)try{this.close();Object(m.e)({type:3}),localStorage.setItem("hasConfirmGenerateNotice",!0),localStorage.setItem("generateMode",2),window.$EventBus.$emit("openGenerate",{action:1,data:""}),window.$EventBus=null}catch(e){}else window.open(this.column.link,"_blank");Object(d.f)("log_actions",{operation:"click_try_now",behavior_info:"on_tap_face_pop"})},handleLeft:function(){Object(d.f)("log_actions",{operation:"click_change_page_left",behavior_info:"on_tap_face_pop",behavior_info_sub:this.currenIdnex});var e=this.currenIdnex-1<0?this.banners.length-1:this.currenIdnex-1;this.$refs.carousel.setActiveItem(e)},handleRight:function(){Object(d.f)("log_actions",{operation:"click_change_page_right",behavior_info:"on_tap_face_pop",behavior_info_sub:this.currenIdnex});var e=this.currenIdnex+1===this.banners.length?0:this.currenIdnex+1;this.$refs.carousel.setActiveItem(e)},close:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?(Object(d.f)("log_actions",{operation:"click_maybe_later",behavior_info:"on_tap_face_pop"}),Object(c.noPatFacePop)({plat:"web"})):Object(d.f)("log_actions",{operation:"click_close",behavior_info:"on_tap_face_pop"}),this.$parent.destroy()},header:function(){var e=this,t=this.$createElement;return t("div",{class:"header"},[this.options.headerHtml&&this.options.headerHtml(this.column),t("span",{class:"close-btn",on:{click:function(){e.close(!1)}}},["×"])])},main:function(e){var t=this.$createElement;return t("div",{class:"main"},[t("div",{class:"swiperItem"},[1===e.inside_type?t("img",{attrs:{src:e.inside_link},class:"banner"}):t("video",{attrs:{autoplay:!0,loop:!0,controls:!1,src:e.inside_link},domProps:{muted:!0},class:"banner video"}),t("div",{class:"mask"})]),this.options.mainHtml?this.options.mainHtml(e):t("div",{class:"main_con"},[t("div",l()([{class:"title ellipsis"},{domProps:{innerHTML:e.title}}])),t("div",{class:"con"},[e.intro])])])},footer:function(){var e,t,n,o,l=this,r=this.$createElement;return r("div",{class:"footer"},[this.options.footerHtml?this.options.footerHtml(this.column):r("div",{class:"button"},[null!==(e=this.column)&&void 0!==e&&e.buttons[1]?r("div",{class:"btn btn_1 ellipsis",on:{click:this.close}},[null===(t=this.column)||void 0===t?void 0:t.buttons[1]]):null,null!==(n=this.column)&&void 0!==n&&n.buttons[0]?r("div",{class:"btn btn_2 ellipsis",on:{click:this.goPage}},[null===(o=this.column)||void 0===o?void 0:o.buttons[0]]):null]),r("div",{class:"indicator"},[this.banners.map((function(e,t){return r("span",{class:"tips  ".concat(l.currenIdnex===t?"selectTip":""),on:{click:function(){l.handleSwiper(t)}}})}))])])}}),render:function(){var e,t=this,n=arguments[0];return n("div",{class:"content_face"},[this.header(),n("el-carousel",{class:"swiper",attrs:{interval:1e3*(null===(e=this.column)||void 0===e||null===(e=e.page_set)||void 0===e?void 0:e.duration),height:"100%",trigger:"click",arrow:"never","indicator-position":"none","initial-index":this.currenIdnex,loop:!0},ref:"carousel",on:{change:this.handleSwiper}},[this.banners.map((function(e){return n("el-carousel-item",[t.main(e)])})),n("div",{class:"left icon",on:{click:this.handleLeft}},[n("i",{class:"el-icon-arrow-left"})]),n("div",{class:"right icon",on:{click:this.handleRight}},[n("i",{class:"el-icon-arrow-right"})])]),this.footer()])}},y=_,w=(n(3201),n(0)),component=Object(w.a)(y,undefined,undefined,!1,null,"05fb37a8",null);t.default=component.exports},3239:function(e,t,n){"use strict";var o=n(686),l=(n(3031),n(0)),component=Object(l.a)(o.a,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"PromptList"},[e._t("default")],2)}),[],!1,null,"feeb6e82",null);t.a=component.exports},3242:function(e,t,n){"use strict";n.r(t);n(10),n(14),n(47),n(19),n(43),n(23);var o=n(2),l=(n(667),n(44),n(428)),r=n.n(l),c=(n(668),n(429)),d=n.n(c),h=(n(2978),n(2979)),m=n.n(h);n(32),n(9),n(7),n(11),n(12),n(8),n(6),n(4),n(16),n(18),n(29);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var f={data:function(){var e=this;return{isShow:!1,type:"CREATE",loading:!1,channelForm:{name:"",about:"",type:1},rules:{name:[{required:!0,message:this.$t("PleaseEnterChannelName")},{validator:function(t,n,o){/^\s*$/.test(n)&&o(new Error(e.$t("PleaseEnterChannelName"))),o()}}]}}},computed:{title:function(){return this.$t("CREATE"===this.type?"AddChannelTitle":"EditChannelTitle")}},methods:{show:function(e,t){this.type=t?"EDIT":"CREATE",t&&(this.channelForm=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t)),this.loading=!1,this.isShow=e},submit:function(){var e=this;this.$refs.channelForm.validate((function(t){t&&(e.loading=!0,e.$emit("submit",e.channelForm))}))},close:function(){this.channelForm={name:"",about:"",type:1},this.loading=!1,this.$refs.channelForm.resetFields(),this.show(!1)}}},_=f,y=n(0),w=Object(y.a)(_,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"custom-dialog created-popup",attrs:{visible:e.isShow,"append-to-body":!0,"before-close":e.close,title:e.title},on:{"update:visible":function(t){e.isShow=t}}},[t("div",{staticClass:"create-body"},[t("el-form",{ref:"channelForm",staticClass:"custom-form",attrs:{model:e.channelForm,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$t("ChannelName"),required:"",prop:"name"}},[t("el-input",{attrs:{placeholder:"",maxlength:15},model:{value:e.channelForm.name,callback:function(t){e.$set(e.channelForm,"name",t)},expression:"channelForm.name"}})],1)],1)],1),e._v(" "),t("div",{staticClass:"dialog-btn",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.close}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.submit}},[e._v(e._s(e.$t("Confirm")))])],1)])}),[],!1,null,null,null).exports,C=n(218),k=n(5),S=n(1);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O={components:{ChannelEditPopup:w},inject:["top"],props:{tooltipDisabled:{type:Boolean,default:!1},addBtnPosition:{type:String,default:"top"}},data:function(){return{loading:!1,timer:null,channelList:[{name:"PRIVATE",channel_id:"PRIVATE",owner_id:"",about:"OnlySee",num:0,isNew:!1}]}},computed:I({},Object(S.e)("user",["userInfo"])),mounted:function(){this.init()},methods:{init:function(){var e=localStorage.getItem("channelInviteCode");if(this.$EventBus.$on("chatMessage",this.handleMessage),e)return this.joinChannel(e),void localStorage.removeItem("channelInviteCode");this.channelList.length<2&&this.getChannelList()},handleMessage:function(e){var t=e.type,n=e.channel_id;switch(t){case 1:this.channelListSort(n);break;case 2:this.joinMessage(e);break;case 3:this.quitMessage(e);break;case 6:this.kickOutChannel(e)}},channelListSort:function(e){var t=this.getChannelIndex(e);-1!==t&&(this.channelList[t].isNew=!0,this.channelList[t]=this.channelList.splice(1,1,this.channelList[t])[0])},kickOutChannel:function(e){var t=e.member_kick_outs,n=e.channel_id,o=this.getChannelIndex(n),l=this.channelList[o].name;if(t.includes(this.userInfo.id)){if(this.channelList.splice(o,1),this.top.channelId===n){var r=this.channelList[0];this.top.changeHandle({channelId:r.channel_id,channelInfo:r})}this.$message.warning(this.$t("KickChannelMsg")+": "+l)}else this.updateChannelInfo(this.channelList[o])},joinMessage:function(e){var t=e.channel_id,n=this.getChannelIndex(t);this.updateChannelInfo(this.channelList[n])},quitMessage:function(e){var t=e.member_leaves,n=e.channel_id,o=this.getChannelIndex(n);t.includes(this.userInfo.id)||this.updateChannelInfo(this.channelList[o])},getChannelIndex:function(e){return this.channelList.findIndex((function(t){return t.channel_id===e}))},updateChannelInfo:function(e){e.channel_id===this.top.channelId&&this.getChannelInfo({channel_id:e.channel_id})},getChannelList:function(e){var t=this;this.loading=!0,this.channelList.splice(1,this.channelList.length-1),Object(C.e)().then((function(n){var o=n.data.items,l=t.channelList.concat(o.map((function(e){return I(I({},e),{},{num:1,isNew:!1})})));t.$set(t,"channelList",l),t.loading=!1,e&&t.changeChannel(e)})).catch((function(e){t.loading=!1}))},joinChannel:function(e){var t=this;Object(C.g)({channel_id:e}).then((function(e){var n=e.data.channel_id;t.$message.success(t.$t("JoinChannelSuccess")),t.getChannelList(n)})).catch((function(e){t.getChannelInfo({invite_code:invite_code})}))},addChannel:function(){this.$refs.createChannelPopup.show(!0)},changeChannel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PRIVATE",n=this.channelList.find((function(e){return e.channel_id===t}));n.isNew=!1,this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((function(){e.top.changeHandle({channelId:t,channelInfo:n}),"PRIVATE"!==t&&e.getChannelInfo({channel_id:n.channel_id}),clearTimeout(e.timer),e.timer=null}),300)},getChannelInfo:function(e){var t=this;Object(C.d)(e).then((function(e){var n=e.data,o=n.member_count,l=n.channel_id,r=t.getChannelIndex(l);r>-1?(t.channelList[r].num=o,t.top.channelId===t.channelList[r].channel_id&&t.top.changeHandle({channelInfo:t.channelList[r]})):t.getChannelList(l)}))},submitChannel:function(e){var t=this;(e.channel_id?C.c:C.a)(e).then((function(n){t.getChannelList(),t.$message.success(t.$t(e.channel_id?"editSuccess":"CreateSuccess")),t.$refs.createChannelPopup.close()})).catch((function(e){t.$refs.createChannelPopup.show(!0)}))},editChannel:function(e){this.$refs.createChannelPopup.show(!0,e)},handleMore:function(e,t){switch(e){case"INVITE":this.invitePerson(t);break;case"EDIT":this.editChannel(t);break;case"Disband":this.disbandChannel(t);break;default:this.quitChannel(t)}},invitePerson:function(e){var t=e.channel_id,n=(e.name,this.userInfo),o=n.name,l=n.id,r=this.channelList.find((function(e){return e.channel_id===t})),c=(null==r?void 0:r.invite_url)||"";Object(k.d)((o||l)+" "+this.$t("ChannelInviteLink")+"\n"+c),this.$message.success(this.$t("CopiedURLToClipboard"))},quitChannel:function(e){var t=this,n=e.channel_id,o=this.channelList.findIndex((function(e){return e.channel_id===n}));this.$confirm(this.$t("QuitChannelWarn"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){Object(C.i)({channel_id:n}).then((function(e){t.$message.success(t.$t("QuitSuccess")),t.channelList.splice(o,1),t.changeChannel()})).catch((function(){t.$message.warning(t.$t("QuitFail"))}))}))},disbandChannel:function(e){var t=this,n=e.channel_id,o=void 0===n?"":n,l=this.channelList.findIndex((function(e){return e.channel_id===o}));this.$confirm(this.$t("disbandChannelWarn"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){Object(C.b)({channel_id:o}).then((function(e){t.$message.success(t.$t("OperateSuccess")),t.channelList.splice(l,1),t.changeChannel()})).catch((function(){t.$message.warning(t.$t("taskOperateFailed"))}))}))}}},T=O,$=(n(2980),Object(y.a)(T,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"handle-panel channel-panel"},[["top"].includes(e.addBtnPosition)?t("div",{staticClass:"panel-head"},[t("span",{staticClass:"panel-title"},[e._v(e._s(e.$t("Channel")))]),e._v(" "),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",disabled:e.tooltipDisabled,content:e.$t("AddChannelTitle"),placement:"top-end"}},[t("i",{staticClass:"iconfont icon-add",on:{click:e.addChannel}})])],1):e._e(),e._v(" "),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"channel-list"},[["bottom"].includes(e.addBtnPosition)?t("div",{staticClass:"channel-item channel-item-add",on:{click:function(t){return t.stopPropagation(),e.addChannel.apply(null,arguments)}}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",disabled:e.tooltipDisabled,content:e.$t("AddChannelTitle"),placement:"top-end"}},[t("span",{staticClass:"el-icon-circle-plus-outline channel-item-add-icon"})]),e._v(" "),t("span",{staticClass:"panel-title"},[e._v(e._s(e.$t("Channel")))])],1):e._e(),e._v(" "),e._l(e.channelList,(function(n,i){return t("div",{key:"channel_"+i,staticClass:"channel-item",class:{active:e.top.channelId===n.channel_id,new:n.isNew}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",disabled:e.tooltipDisabled,content:e.$t("Owenr"),placement:"top-end"}},[t("i",{directives:[{name:"show",rawName:"v-show",value:n.owner_id===e.userInfo.id||!n.owner_id,expression:"channel.owner_id === userInfo.id || !channel.owner_id"}],staticClass:"iconfont icon-user2 owner-icon"})]),e._v(" "),t("div",{staticClass:"channel-info",on:{click:function(t){return e.changeChannel(n.channel_id)}}},[t("p",{staticClass:"name"},[e._v(e._s("PRIVATE"===n.name?e.$t("PRIVATE"):n.name))])]),e._v(" "),t("el-dropdown",{directives:[{name:"show",rawName:"v-show",value:"PRIVATE"!==n.channel_id,expression:"channel.channel_id !== 'PRIVATE'"}],staticClass:"more-btn",attrs:{trigger:"click"},on:{command:function(t){return e.handleMore(t,n)}}},[t("i",{staticClass:"el-icon-more more-icon"}),e._v(" "),t("el-dropdown-menu",{staticClass:"custom-dropdown",attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:n.owner_id===e.userInfo.id,expression:"channel.owner_id === userInfo.id"}],attrs:{icon:"el-icon-user",command:"INVITE"}},[e._v(e._s(e.$t("Invite")))]),e._v(" "),t("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:n.owner_id===e.userInfo.id,expression:"channel.owner_id === userInfo.id"}],attrs:{icon:"el-icon-edit",command:"EDIT"}},[e._v(e._s(e.$t("Edit")))]),e._v(" "),t("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:n.owner_id===e.userInfo.id,expression:"channel.owner_id === userInfo.id"}],attrs:{icon:"el-icon-circle-close",command:"Disband"}},[e._v(e._s(e.$t("disband")))]),e._v(" "),t("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:n.owner_id!==e.userInfo.id,expression:"channel.owner_id !== userInfo.id"}],attrs:{icon:"el-icon-switch-button",command:"QUIT"}},[e._v(e._s(e.$t("Quit")))])],1)],1)],1)}))],2),e._v(" "),t("channel-edit-popup",{ref:"createChannelPopup",on:{submit:e.submitChannel}})],1)}),[],!1,null,"50c0e503",null)),L=$.exports;function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j={props:["menuIndex"],components:{HandleChannel:L,ElSubmenu:m.a,ElMenu:d.a,ElMenuItem:r.a},inject:["top"],data:function(){var e=localStorage.getItem("GenetateMenuZoom");return e=e?JSON.parse(e):[],{formatNumberForeign:k.i,zoomMenu:["toolIndex","menuIndex","swiftAiIndex"],coins:[{name:"credit",icon:n(121),type:"calculateCoins",desc:"new_credit_desc"},{name:"stamina",icon:n(226),type:"tempCoins",desc:"new_stamina_desc",default:this.top.token?0:150}],swiftAIList:[{code:"editBoard",path:"/editBoard",label:"高级画板",logType:"editBoard"},{code:"swift_filter",path:"/ai-filter",label:"AI滤镜",logType:"ai-filter"},{code:"swift_faceChange",path:"/ai-face-swap",label:"AI换脸",logType:"ai-face-swap"},{code:"swift_upscale",path:"/image-upscaler",label:"AI图像增强器",logType:"image-upscaler"},{code:"swift_modelFitting",path:"/ai-model-fitting",label:"AI模特试衣",logType:"ai-model-fitting"},{code:"swift_erase",path:"/ai_erase",label:"智能消除",logType:"ai_erase"},{code:"swift_removeBackground",path:"/remove-background",label:"去除背景",logType:"remove-background"},{code:"swift_makeUp",path:"/ai-makeup",label:"AI美妆",logType:"ai-makeup"},{code:"swift_draftDesign",path:"/scribble2img",label:"草稿成图",logType:"scribble2img"},{code:"swift_photography",path:"/ai-portrait",label:"AI写真",logType:"ai-portrait"},{code:"swiftAiMore",path:"/ai-tools",label:"查看更多",logType:"ai-tools"},{code:"ai_generate_video",path:"/ai-video-generator",label:"AI生成视频",logType:"ai-generate-video"}]}},computed:M(M(M({},Object(S.e)("payment",["paymentInfo","activeState","liteActiveState"])),Object(S.c)("user",["isCompanyAccount","isLoggedIn"])),{},{showCoinBtn:function(){return!this.activeState&&!this.liteActiveState},getCoinTitle:function(){var e=this;return function(t){return e.$t(t.type)+"："+e.$t("balance")+" "+(e.paymentInfo[t.type]||0)+", "+e.$t(t.desc)}}}),methods:{changeMenu:function(e){var t=this.swiftAIList.find((function(t){return(null==t?void 0:t.code)===e}));if(t){try{this.$logEvent("log_actions",{operation:"click_".concat(t.logType),behavior_info:"on_creative_flow_sidebar"})}catch(e){}var n=this.localePath("/ai-tools".concat(t.path));return["swiftAiMore","editBoard"].includes(t.code)&&(n=this.localePath("".concat(t.path))),void(window&&window.open(n,"_blank"))}try{var o;null!=this&&null!==(o=this.top)&&void 0!==o&&o.token||"SIMPLE"===e||(this.$refs.generateMenu.activeIndex="SIMPLE")}catch(e){}this.$emit("changeMenu",e)},closePopup:function(){this.$emit("close")},changeZoom:function(e,t){},toMall:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.top.token){this.$logEvent("log_actions",{operation:"subscription_page_show",behavior_info:null!=t&&t.name?t.name:location.href});var n=this.localePath("/mall?openTab=Credit");window.open(n,"_blank")}else this.$EventBus.$emit("openLoginDialog",{callBack:function(){var t=e.localePath("/mall?openTab=Credit");window.open(t,"_blank")}})}}},D=j,N=(n(2981),Object(y.a)(D,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"generate-menu"},[t("div",{staticClass:"head"},[t("img",{staticClass:"logo",attrs:{src:n(124),alt:"Avatar"}}),e._v("\n      "+e._s(e.$t("SeaArt"))+"\n      "),t("i",{staticClass:"iconfont icon-goBack",on:{click:e.closePopup}})]),e._v(" "),t("div",{staticClass:"menu-panel"},[e.isCompanyAccount?e._e():t("div",{staticClass:"menu-panel-top"},[e._l(e.coins,(function(n){return[t("div",{key:n.name,staticClass:"item-coin",class:n.name,attrs:{title:e.getCoinTitle(n)},on:{click:function(t){return e.toMall(n)}}},[t("img",{staticClass:"icon",attrs:{src:n.icon,alt:n.name}}),e._v(" "),t("div",{staticClass:"number"},[e._v("\n              "+e._s(e.formatNumberForeign(e.paymentInfo[n.type])||e.isLoggedIn&&n.default||0)+"\n            ")])])]})),e._v(" "),t("div",{staticClass:"item-coin-btn",on:{click:function(t){return e.toMall()}}},[e._v(e._s(e.$t("Recharge")))])],2),e._v(" "),t("el-menu",{ref:"generateMenu",attrs:{"default-active":e.menuIndex,"default-openeds":e.zoomMenu},on:{select:e.changeMenu,open:function(t){return e.changeZoom(t,"open")},close:function(t){return e.changeZoom(t,"close")}}},[t("el-menu-item",{attrs:{index:"SIMPLE"}},[t("template",{slot:"title"},[t("i",{staticClass:"iconfont icon-simple_icon"}),e._v("\n            "+e._s(e.$t("S_Simple")))])],2),e._v(" "),t("el-menu-item",{attrs:{index:"textToImage"}},[t("template",{slot:"title"},[t("i",{staticClass:"iconfont icon-play"}),e._v(e._s(e.$t("GenerateTextMenu")))])],2),e._v(" "),t("el-menu-item",{staticClass:"edit-board-menu-item",attrs:{index:"editBoard"}},[t("template",{slot:"title"},[t("span",{staticClass:"iconfont icon-icon_huabanmoshi menu-item-icon"}),e._v(e._s(e.$t("sketchboard_mode"))+"\n          ")])],2),e._v(" "),t("el-submenu",{directives:[{name:"show",rawName:"v-show",value:"SIMPLE"!==e.menuIndex,expression:"menuIndex !== 'SIMPLE'"}],attrs:{index:"menuIndex"}},[t("template",{slot:"title"},[e._v(e._s(e.$t("GenerateAdvancedMenu")))]),e._v(" "),t("el-menu-item",{attrs:{index:"imageToImage"}},[t("template",{slot:"title"},[t("i",{staticClass:"iconfont icon-icon_imageToImage"}),e._v("\n              "+e._s(e.$t("TaskUploadImage"))+"\n            ")])],2),e._v(" "),t("el-menu-item",{attrs:{index:"conditionToImage"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("conditionToImage"),placement:"top-start"}},[t("span",[t("i",{staticClass:"iconfont icon-icon_conditionToImage"}),e._v(e._s(e.$t("conditionToImage")))])])],1)],2),e._v(" "),t("el-submenu",{directives:[{name:"show",rawName:"v-show",value:"SIMPLE"!==e.menuIndex,expression:"menuIndex !== 'SIMPLE'"}],attrs:{index:"toolIndex"}},[t("template",{slot:"title"},[e._v(e._s(e.$t("Tools")))]),e._v(" "),t("el-menu-item",{attrs:{index:"animGen"}},[t("template",{slot:"title"},[t("i",{staticClass:"iconfont icon-AnimGenIcon"}),e._v(e._s(e.$t("AnimGen")))])],2),e._v(" "),t("el-menu-item",{attrs:{index:"expansion"}},[t("template",{slot:"title"},[t("i",{staticClass:"iconfont icon-icon_Expansion"}),e._v(e._s(e.$t("Expansion")))])],2),e._v(" "),t("el-menu-item",{attrs:{index:"extraUpscale"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("taskTabUpscale"),placement:"top-start"}},[t("span",[t("i",{staticClass:"iconfont icon-icon_extraUpscale"}),e._v(e._s(e.$t("taskTabUpscale")))])])],1),e._v(" "),t("el-menu-item",{attrs:{index:"characterRepair"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("characterRepair"),placement:"top-start"}},[t("span",[t("i",{staticClass:"iconfont icon-character-repair-icon1"}),e._v("\n                "+e._s(e.$t("characterRepair")))])])],1),e._v(" "),t("el-menu-item",{attrs:{index:"descriptors"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("GetDescriptors"),placement:"top-start"}},[t("span",[t("i",{staticClass:"iconfont icon-icon_descriptors"}),e._v(e._s(e.$t("GetDescriptors")))])])],1),e._v(" "),t("el-menu-item",{attrs:{index:"preview"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("Preview"),placement:"top-start"}},[t("span",[t("i",{staticClass:"iconfont icon-icon_Preview"}),e._v(e._s(e.$t("Preview")))])])],1),e._v(" "),t("el-menu-item",{attrs:{index:"promptStudio"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("PromptStudio"),placement:"top-start"}},[t("span",[t("i",{staticClass:"iconfont icon-icon_PromptStudio"}),e._v(e._s(e.$t("PromptStudio")))])])],1)],2),e._v(" "),t("el-submenu",{directives:[{name:"show",rawName:"v-show",value:"SIMPLE"!==e.menuIndex,expression:"menuIndex !== 'SIMPLE'"}],attrs:{index:"swiftAiIndex"}},[t("template",{slot:"title"},[e._v(e._s(e.$t("swiftAI")))]),e._v(" "),t("el-menu-item",{attrs:{index:"ai_generate_video"}},[t("template",{slot:"title"},[t("span",{staticClass:"iconfont icon-a-icon-VideoGeneration menu-item-icon"}),e._v(e._s(e.$t("ai_video_generation")))])],2),e._v(" "),t("el-menu-item",{staticClass:"swift-menu-item",attrs:{index:"swift_faceChange"}},[t("template",{slot:"title"},[t("span",{staticClass:"iconfont icon-icon_AIhuanlian menu-item-icon"}),e._v(e._s(e.$t("ai_face_changing")))])],2),e._v(" "),t("el-menu-item",{staticClass:"swift-menu-item",attrs:{index:"swift_filter"}},[t("template",{slot:"title"},[t("span",{staticClass:"iconfont icon-ai_filter menu-item-icon"}),e._v(e._s(e.$t("ai_tools_4")))])],2),e._v(" "),t("el-menu-item",{staticClass:"swift-menu-item",attrs:{index:"swift_upscale"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("upsacler_3_H1"),placement:"top-start"}},[t("span",[t("span",{staticClass:"iconfont icon-icon_gaoqingxiufu menu-item-icon"}),e._v(e._s(e.$t("upsacler_3_H1")))])])],1),e._v(" "),t("el-menu-item",{staticClass:"swift-menu-item",attrs:{index:"swift_modelFitting"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("ModelFitting"),placement:"top-start"}},[t("span",[t("span",{staticClass:"iconfont icon-icon_moteshiyi menu-item-icon"}),e._v(e._s(e.$t("ModelFitting")))])])],1),e._v(" "),t("el-menu-item",{staticClass:"swift-menu-item",attrs:{index:"swift_erase"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("ai_erase"),placement:"top-start"}},[t("span",[t("span",{staticClass:"iconfont icon-icon_zidongcachu1 menu-item-icon"}),e._v(e._s(e.$t("ai_erase")))])])],1),e._v(" "),t("el-menu-item",{staticClass:"swift-menu-item",attrs:{index:"swift_removeBackground"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("ai_tools_2"),placement:"top-start"}},[t("span",[t("span",{staticClass:"iconfont icon-icon_qubeijing1 menu-item-icon"}),e._v(e._s(e.$t("ai_tools_2")))])])],1),e._v(" "),t("el-menu-item",{staticClass:"swift-menu-item",attrs:{index:"swift_makeUp"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("ai_makeup"),placement:"top-start"}},[t("span",[t("span",{staticClass:"iconfont icon-meizhuang menu-item-icon"}),e._v(e._s(e.$t("ai_makeup")))])])],1),e._v(" "),t("el-menu-item",{staticClass:"swift-menu-item",attrs:{index:"swift_draftDesign"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("ai_tools_3"),placement:"top-start"}},[t("span",[t("span",{staticClass:"iconfont icon-caogaochengtu menu-item-icon"}),e._v(e._s(e.$t("ai_tools_3")))])])],1),e._v(" "),t("el-menu-item",{staticClass:"swift-menu-item",attrs:{index:"swift_photography"}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.$t("ai_tools_10"),placement:"top-start"}},[t("span",[t("span",{staticClass:"iconfont icon-icon_AIxiezhen menu-item-icon"}),e._v(e._s(e.$t("ai_tools_10")))])])],1),e._v(" "),t("el-menu-item",{staticClass:"swift-menu-item",attrs:{index:"swiftAiMore"}},[t("div",{staticClass:"view-more-btn"},[e._v(e._s(e.$t("ShowALL"))),t("i",{staticClass:"el-icon-arrow-right"})])])],2)],1)],1)])}),[],!1,null,"03b400cc",null).exports),E=n(3),R=n(15),A=(n(20),n(36),n(165),n(37),n(22)),B=n(53),U=(n(232),n(88)),F=n.n(U),z=(n(49),n(76),n(28),n(215)),V=n(86),W=n(26),H=n(168),G=n(35),J=n.n(G),K=n(152),X=n(24),Q=n(73),Z=n(136);function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var te={name:"MessageImg",components:{taskImageViewer:H.a,SaveTo:K.a,AiChatCreteConfirm:z.a,auditDialog:Z.a},inject:["top"],props:{src:{type:String,required:!0,default:function(){return""}},nsfw:{type:Number,default:2},width:{type:Number,default:100},height:{type:Number,default:100},message:{type:Object,default:function(){return{}}},gridBanner:{type:Object,default:function(){return{}}},operateNumber:{type:Number,default:function(){return 1}},viewStatus:{type:Object,default:function(){return{0:!0,1:!0,2:!0,3:!0,4:!0}}},msgId:{type:String,default:""},loraModels:{type:Object,default:function(){}}},data:function(){return{flag:!0,showMask:!1,loading:!0,loaded:!0,error:!1,dialogVisible:!1,retryCount:0,isShowImage:!0,baseImageWidth:200,imageURLValid:!0,imageUrl:"",canViewNsfw:!1,checked:!1,alreadySave:!1,hoverBtnList:[{code:"chat",icon:"a-home-top-personl1",useText:!1,order:0,tips:"createChartacterToChat",show:!0,showTypeOptions:[]},{code:"animGen",icon:"AnimGenIcon",useText:!1,order:1,tips:"AnimGen",show:!0,showTypeOptions:[]},{code:"upscale",icon:"task-upscale-icon",useText:!0,text:"U",order:2,tips:"WorkUpscale",show:!0,showTypeOptions:[]},{code:"variations",icon:"task-variations-icon",useText:!0,text:"V",order:3,tips:"WorkVariations",show:!0,showTypeOptions:[]},{code:"extraUpscale",icon:"upload-image-icon",useText:!1,order:1,tips:"ExtraUpscale",show:!0,showTypeOptions:[]},{code:"post",icon:"post-icon2",useText:!1,order:5,tips:"GraphicSubmission",show:!0,showTypeOptions:[]},{code:"removeBackground",icon:"work-remove-background",useText:!1,order:4,tips:"RemoveBackground",show:!0,showTypeOptions:[]},{code:"save",icon:"save",useText:!1,order:5,tips:"Save",show:!0,showTypeOptions:[]},{code:"deleteSingleImg",icon:"moveDeleteTask",useText:!1,order:5,tips:"Delete",show:!0,showTypeOptions:[]},{code:"aiGenerateVideo",icon:"a-icon-VideoGeneration",useText:!1,order:6,tips:"ImageToVideoTip",show:!0,showTypeOptions:[]}],isShowHoverMask:!1,hide:!1}},computed:ee(ee(ee(ee({},Object(S.c)(["isSupportWebp"])),Object(S.c)("user",["userInfo","isCompanyAccount"])),Object(S.e)("user",["cdnHost"])),{},{getImageRenderAspectRatio:function(){var e,t={},n=(null==this||null===(e=this.message)||void 0===e?void 0:e.img_uris[0])||{},o=n.width,l=n.height,r=(this.message.banner,this.isAspectRatioExtreme(o,l));return o&&l&&o!==l&&(o<384||l<384||r)&&(t.aspectRatio="1/1"),o<=200&&(t=Object.assign(t,{minWidth:"".concat(150,"px"),maxWidth:"".concat(150,"px")})),t},showHoverMask:function(){return this.renderList.length&&this.isShowHoverMask},isStudioFlux:function(){var e,t;return this.isStudioMode&&((null===(e=this.message)||void 0===e?void 0:e.art_model_no)===this.top.fluxModelId||[1,"1"].includes(null===(t=this.message)||void 0===t?void 0:t.sub_mode_category))},isShowChat:function(){return!this.hide&&1!==this.nsfw&&!this.isCompanyAccount&&!this.$isChinaSite&&[1,2,7,8,3,13,11,25,4,"1","2","7","8","3","13","11","25","4"].includes(this.message.type)&&[1,5,"1","5",11,"11"].includes(this.message.category)},renderList:function(){var e=JSON.parse(JSON.stringify(this.hoverBtnRenderList)),t=null,n=null,o=null,l=Object(X.chunk)(e,2),r=[],c=[];if(l.length>3){if(r=e.filter((function(e){return"animGen"===e.code?(t=e,!1):"deleteSingleImg"===e.code?(n=e,!1):"chat"!==e.code||(o=e,!1)})),c=Object(X.chunk)(r,2),o&&c[0].unshift(o),n){var d=c.length-1;d<2?(c[2]=[],c[2].push(n)):c[d]&&c[d].push(n)}if(t){var h=1;c.forEach((function(e,i){1==e.length&&(h=c.length<2?i:1)})),c[h]&&c[h].unshift(t)}}else r=e,c=Object(X.chunk)(r,2);return c},getChunkRenderList:function(){var e=this;return function(t){return e.renderList.length&&t<=e.renderList.length-1?e.renderList[t]:[]}},showAnimGen:function(){return![24,"24",25,"25"].includes(this.message.type)&&!this.isSdModel&&!this.isStudioMode},showExtraUpscale:function(){return[1,3,"1","3",7,"7",8,"8",11,23,"23",2,"2",13,"13","25",25].includes(this.message.type)&&!this.isStudioFlux},showUpscale:function(){return[1,3,5,7,8,11,23,25].includes(Number(this.message.type))},showVariations:function(){return[2,13,1,3,7,8,11,23,25,5].includes(this.message.type)},showRemoveBackground:function(){return[2,"2",13,"13"].includes(this.message.type)&&!this.isStudioFlux},isShowBtn:function(){var e,t=4===(null===(e=this.message)||void 0===e?void 0:e.type)?{chat:[!0],aiGenerateVideo:[!0]}:{extraUpscale:[this.showExtraUpscale&&1!==this.nsfw],upscale:[this.showUpscale&&1!==this.nsfw],variations:[this.showVariations&&1!==this.nsfw],removeBackground:[this.showRemoveBackground&&1!==this.nsfw],post:[this.showPostBtn&&1!==this.nsfw],save:[this.isShowSaveTo&&1!==this.nsfw],deleteSingleImg:[this.isMyMsg],animGen:[this.showAnimGen&&1!==this.nsfw],chat:[this.isShowChat],aiGenerateVideo:[this.isShowChat]};return function(e){return!!Object.keys(t).includes(e)&&t[e].every((function(e){return!!e}))}},covertI18n:function(){var e=this;return function(t){return"upscale"===(null==t?void 0:t.code)?e.isStudioMode?"".concat(e.$t("WorkUpscale")).replace("2048*2048","3072*3072"):e.$t("WorkUpscale"):e.$t(null==t?void 0:t.tips)}},hoverBtnRenderList:function(){var e=this;return this.hoverBtnList.map((function(t){return t.show=e.isShowBtn(t.code),t})).filter((function(e){return e.show}))},isShowNsfwIcon:function(){return this.checkIsShowViewNsfw&&this.isNsfwPlus&&this.isMyMsg},isShowSaveTo:function(){var e,t=this.message.img_uris,n=void 0===t?[]:t;return!!n.length&&(!(null!==(e=n[this.operateNumber-1])&&void 0!==e&&e.is_saved_personal)&&this.isMyMsg&&!this.alreadySave)},isEnableSubmit:function(){return this.top.enableSubmit&&!this.isShowNsfwBg&&!this.error&&!this.loading},isShowNotSelectBox:function(){var e;return!(null!==(e=this.message)&&void 0!==e&&null!==(e=e.banner)&&void 0!==e&&e.is_submit)},selectPostList:function(){var e;return(null==this||null===(e=this.top)||void 0===e?void 0:e.postSelectList)||[]},enableSubmit:function(){var e;return null==this||null===(e=this.top)||void 0===e?void 0:e.enableSubmit},showPostBtn:function(){var e,t;return(null===(e=this.message)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.is_submit)&&!this.isShowNsfwBg&&this.isMyMsg&&!this.isCompanyAccount&&3!==(null===(t=this.message)||void 0===t?void 0:t.sub_model_category)},renderUrl:function(){return"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")},getRenderUrl:function(){var e,t=((null===(e=this.message)||void 0===e?void 0:e.img_uris)||[]).findIndex((function(e){return 1!==e.nsfw}));if(-1!==t){var n,o=null===(n=this.message)||void 0===n||null===(n=n.img_uris[t])||void 0===n?void 0:n.url;return(o=o?Object(k.x)(o,"high"):"")||"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")}return"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")},isShowNsfwBg:function(){var e="";return 1===this.nsfw||(e=this.checkIsShowViewNsfw&&this.isMyMsg?this.handleShowNsfwImageUrl():this.isShowImage?this.imageUrl:"",this.renderUrl===e)},isMyMsg:function(){var e,t;return(null===(e=this.message)||void 0===e||null===(e=e.messageInfo)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id)===this.userInfo.id||!(null!==(t=this.message)&&void 0!==t&&t.messageInfo)},isSdModel:function(){var e,t;return[5,"5","sdxl"].includes(null==this||null===(e=this.message)||void 0===e?void 0:e.channel)||[5,"5","sdxl"].includes(null==this||null===(t=this.message)||void 0===t?void 0:t.category)},isStudioMode:function(){var e,t;return["studio",7,"7",11].includes(null==this||null===(e=this.message)||void 0===e?void 0:e.channel)||["studio",7,"7",11].includes(null==this||null===(t=this.message)||void 0===t?void 0:t.category)},isBlur:function(){return 1===this.nsfw||(this.checkIsShowViewNsfw&&this.isMyMsg?(null==this||null===(e=this.message)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.is_nsfw_plus)&&!this.canViewNsfw:1===this.nsfw);var e},isShowHover:function(){var e;return!(!this.checkIsShowViewNsfw||!this.isMyMsg)&&((null==this||null===(e=this.message)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.is_nsfw_plus)&&!this.canViewNsfw)},isNsfwPlus:function(){var e;return(null==this||null===(e=this.message)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.is_nsfw_plus)&&1!==this.nsfw},isShowOperateBtn:function(){return[1,3,"1","3",7,"7",11,8,"8",2,"2",11,"13",13,24,"24","25",25,"4",4].includes(this.message.type)&&!this.isBlur&&!this.error},convertPictureWidthAndHeight:function(){var e=this.message.banner,t=(void 0===e?{}:e)||{},n=t.width,o=void 0===n?200:n,l=t.height,r=void 0===l?200:l,c=Object(B.f)(o,r,this.baseImageWidth);return isNaN(c.height)?{}:{width:"".concat(c.width,"px"),height:"".concat(c.height,"px")}},covertSmallWidth:function(){var e=this.message.banner,t=(void 0===e?{}:e).width;return(void 0===t?0:t)<=200?{minWidth:"".concat(150,"px"),maxWidth:"".concat(150,"px")}:{}},viewImageList:function(){var e=this,t=this.message,n=t.banner,o=void 0===n?{}:n,l=t.img_uris,r=void 0===l?[]:l,c=t.preprocess_images,d=void 0===c?[]:c,h=t.type,m=void 0===h?"":h;return Array.isArray(d)&&[10,"10"].includes(m)?(J()(this.message.preprocess_images||[])||[]).map((function(e,t){return e.operateNumber=t+1,e})).filter((function(t){return e.checkIsShowViewNsfw&&e.isMyMsg&&e.enableNsfwMode?![1,"1"].includes(t.nsfw)&&e.viewStatus[t.operateNumber]:![1,"1"].includes(t.nsfw)})):Array.isArray(r)&&r.length?(J()(this.message.img_uris||[])||[]).map((function(e,t){return e.operateNumber=t+1,e})).filter((function(t){return e.checkIsShowViewNsfw&&e.isMyMsg&&e.enableNsfwMode?![1,"1"].includes(t.nsfw)&&e.viewStatus[t.operateNumber]:![1,"1"].includes(t.nsfw)})):[Object.assign({},J()(o),{operateNumber:1})]},currentImageIndex:function(){var e,t=this;return-1===(e=this.viewImageList.findIndex((function(e){return e.operateNumber===t.operateNumber})))?0:e},getImageUrl:function(){return this.isShowImage?this.imageUrl:""},checkIsShowViewNsfw:function(){var e;return null==this||null===(e=this.userInfo)||void 0===e?void 0:e.enable_nsfw_plus},enableNsfwMode:function(){var e;return![2,"2"].includes(null==this||null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.nsfw_plus)}}),mounted:function(){this.canViewNsfw=this.checkIsShowViewNsfw&&this.enableNsfwMode},watch:{src:{handler:function(e){e&&"string"==typeof e&&(this.imageUrl=this.isSupportWebp?Object(k.x)(e,"high"):this.src)},immediate:!0},enableNsfwMode:{handler:function(e,t){t&&t!==e&&(this.flag=!0),this.isMyMsg&&this.flag&&(this.canViewNsfw=this.checkIsShowViewNsfw&&this.enableNsfwMode)},deep:!0,immediate:!0},canViewNsfw:{handler:function(e){this.$emit("viewNsfwStatus",{index:this.operateNumber,canViewNsfw:!this.isMyMsg||this.canViewNsfw,isGrid:!!Object.keys(this.gridBanner||{}).length})},deep:!0,immediate:!0},enableSubmit:{handler:function(e){e||(this.checked=!1)},immediate:!0,deep:!0}},methods:ee(ee(ee({},Object(S.b)("user",["getAccountInfo"])),Object(S.d)("user",["SET_USER_INFO"])),{},{isAspectRatioExtreme:function(e,t){try{return e/t>=2||t/e>=2}catch(e){return!1}},handleConfirm:function(){this.showMask=!1,this.handleChat()},handleSaveSuccess:function(){this.$logEvent("log_actions",{operation:"creative_flow_single_picture",behavior_info:"save"}),this.alreadySave=!0,this.$emit("saveSuccess")},handleClickCheck:function(e){if(!["span","input"].includes(e.target.localName)){var t=this.checkInList();this.selectPostList.length>=20&&-1===t&&!this.checked?this.$message.warning("至多选择20个哦"):(this.checked=!this.checked,this.updateDataToPostSelectList(this.checked))}},checkInList:function(){this.message.id,null==this||null===(e=this.message)||void 0===e||null===(e=e.banner)||void 0===e||e.index;var e,t=this.viewImageList[this.currentImageIndex].url;return(this.top.postSelectList||[]).findIndex((function(e){return t===e.url}))},updateDataToPostSelectList:function(e){var t,n={taskId:this.message.id,index:null==this||null===(t=this.message)||void 0===t||null===(t=t.banner)||void 0===t?void 0:t.index,url:this.viewImageList[this.currentImageIndex].url};this.top.updatePostSelectList(n)},deleteSingleImg:function(){var e=this;this.$confirm(this.$t("deleteConfirm"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){e.$emit("deleteSingleImg",e.operateNumber)})).catch((function(e){console.log("err",e)}))},handleCheckChange:function(e){var t=this.checkInList();if(this.selectPostList.length>=20&&-1===t&&e)return this.$message.warning("至多选择20个哦"),void(this.checked=!1);this.updateDataToPostSelectList(this.checked)},handleSinglePost:function(){var e,t={taskId:this.message.id,index:null==this||null===(e=this.message)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.index,url:this.viewImageList[this.currentImageIndex].url};this.$logEvent("log_actions",{operation:"click_post_picture_button",behavior_info:"on_creative_flow_hover",behavior_info_sub:t.url}),this.$EventBus.$emit("openCreativeCenterModal",{list:[t],type:"text",source:"task"})},settingViewNsfw:function(){var e;this.$logEvent("log_actions",{operation:"click_NSFW_on_task"}),this.isMyMsg&&(this.enableNsfwMode||1===(null===(e=this.userInfo)||void 0===e?void 0:e.is_audit)?this.applyNsfw(!1):this.$refs.auditDialog.showDialog())},applyNsfw:function(){var e=this;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){var t={};t.nsfw_plus=this.enableNsfwMode?2:1,t.mode=1,t.age_confirm=!0,Object(Q.b)(t).then((function(t){var n=(t||{}).status.code;["10000",1e4].includes(void 0===n?"":n)&&e.$message.success(e.$t(e.enableNsfwMode?"ClosedSuccessfully":"OpenedSuccessfully"))})).finally((function(){e.flag=!1;var data=J()(e.userInfo);data.is_audit=1,e.SET_USER_INFO(data),e.canViewNsfw=!e.canViewNsfw}))}else this.canViewNsfw=!this.canViewNsfw},handleShowNsfwImageUrl:function(){var e;return null!=this&&null!==(e=this.message)&&void 0!==e&&null!==(e=e.banner)&&void 0!==e&&e.is_nsfw_plus&&!this.canViewNsfw?this.renderUrl:this.isShowImage?this.imageUrl:""},onLoad:function(e){this.loading=!1,this.loaded=!0,this.error=!1,this.$EventBus.$emit("needScrollBottom",J()(this.message))},onError:function(){this.loading=!1,this.imageUrl&&(this.imageUrl.includes("_high.webp")||this.imageUrl.includes("_low.webp"))&&(this.imageUrl=this.src),this.reLoadImage(),this.error=!0},reLoadImage:function(){var e=this;this.retryCount>=1||(this.isShowImage=!1,this.retryCount++,this.loading=!0,this.$nextTick((function(){e.isShowImage=!0})))},clickReloadImage:function(){this.retryCount=0,this.error=!1,this.imageUrl=this.isSupportWebp?Object(k.x)(this.src,"high"):this.src,this.reLoadImage()},viewBigImage:function(){1!==this.nsfw&&(this.isShowHover||(this.dialogVisible=!0))},closeViewBigImage:function(){this.dialogVisible=!1},handleContextMenu:function(e){1===this.nsfw&&e.preventDefault()},handleChat:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,d,h,m,v,f,_,y,w,C;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return f={height:(null===(n=e.message)||void 0===n||null===(n=n.banner)||void 0===n?void 0:n.height)||(null===(o=e.message)||void 0===o||null===(o=o.meta)||void 0===o?void 0:o.height),width:(null===(l=e.message)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.width)||(null===(r=e.message)||void 0===r||null===(r=r.meta)||void 0===r?void 0:r.width),id:null===(c=e.message)||void 0===c?void 0:c.id,url:e.imageUrl||(null===(d=e.message)||void 0===d||null===(d=d.banner)||void 0===d?void 0:d.url),source_account_id:(null===(h=e.message)||void 0===h||null===(h=h.messageInfo)||void 0===h||null===(h=h.author)||void 0===h?void 0:h.id)||(null===(m=e.userInfo)||void 0===m?void 0:m.id),channel:"task"},t.next=3,Object(W.D)({channel:"task",source_id:f.id});case 3:if(_=t.sent,y=(null==_?void 0:_.data)||{},w=y.can,2!==(void 0===w?2:w)){t.next=8;break}return e.$message.warning(e.$t("chatFail")),t.abrupt("return");case 8:if(!e.isShowSaveTo||1===e.nsfw){t.next=12;break}return t.next=11,e.handleSave(f);case 11:return t.abrupt("return");case 12:localStorage.setItem("createParams",JSON.stringify(f)),C="/cyberPubPage/".concat(null===(v=e.message)||void 0===v?void 0:v.id,"?quickChat=true&source=work"),window.open(e.localePath(C),"_blank");case 15:case"end":return t.stop()}}),t)})))()},handleSave:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=e.length>0&&void 0!==e[0]?e[0]:null,l=t.message,r=l.id,c=void 0===r?"":r,d=l.img_uris,h=(void 0===d?[]:d)[t.operateNumber-1].index,m=void 0===h?"":h,Object(V.a)({folder_no:"default",id:c,index:m}).then((function(){if(t.handleSaveSuccess(),o){var e;localStorage.setItem("createParams",JSON.stringify(o));var n="/cyberPubPage/".concat(null===(e=t.message)||void 0===e?void 0:e.id,"?quickChat=true&source=work");window.open(t.localePath(n),"_blank")}})).catch((function(e){console.log("saveFail",e)}));case 4:case"end":return n.stop()}}),n)})))()},handleClick:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!["deleteSingleImg"].includes(l=e.length>0&&void 0!==e[0]?e[0]:"")){n.next=4;break}return t.deleteSingleImg(),n.abrupt("return");case 4:if(!["post"].includes(l)){n.next=7;break}return t.handleSinglePost(),n.abrupt("return");case 7:if(!["save"].includes(l)){n.next=10;break}return t.$refs.saveToPopover.doShow(),n.abrupt("return");case 10:if(!["chat"].includes(l)){n.next=16;break}return n.next=13,Object(W.D)({channel:"task",source_id:null===(r=t.message)||void 0===r?void 0:r.id});case 13:c=n.sent,d=c.data.character_id,(void 0===d?"":d)?t.handleChat():t.showMask=!0;case 16:["aiGenerateVideo"].includes(l)&&(h={cover:t.getImageUrl},h=JSON.stringify(h),window.open(t.localePath("/ai-tools/ai-video-generator?info=".concat(h)))),t.$emit("imageOperate",l,t.operateNumber,null===(o=t.message)||void 0===o||null===(o=o.banner)||void 0===o?void 0:o.url);case 18:case"end":return n.stop()}}),n)})))()},handleImageOperate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.$emit("imageOperate",e,t.operateNumber,t.url),this.closeViewBigImage()}})},ie=te,ne=(n(2982),n(2983),Object(y.a)(ie,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-media-attachments-container"},[t("div",{staticClass:"attachments-wrap",class:[e.checked?"attachments-wrap-checked":""]},[t("div",{staticClass:"message-attachment-media"},[t("div",{staticClass:"image-content"},[t("div",{staticClass:"image-content-wrap",class:[1===e.nsfw?"image-content-wrap-background":""],style:{"max-width":"".concat(e.baseImageWidth,"px"),"min-width":"".concat(150,"px")}},[t("div",{staticClass:"image-render-box"},[1===e.nsfw?[t("img",{staticClass:"media-attachments-img image-opacity-0",style:e.loading?e.convertPictureWidthAndHeight:e.getImageRenderAspectRatio,attrs:{src:e.getRenderUrl,alt:"",decoding:"async",loading:"lazy"},on:{load:e.onLoad,error:e.onError,contextmenu:function(t){return e.handleContextMenu(t)}}})]:[24!=e.message.type?t("img",{staticClass:"media-attachments-img",class:[e.loading?"":"media-attachments-img-show",e.loading?"image-opacity-0":"",e.isShowNsfwBg?"blurBackground":""],style:e.loading?e.convertPictureWidthAndHeight:e.getImageRenderAspectRatio,attrs:{src:e.getImageUrl,alt:"",decoding:"async",loading:"lazy"},on:{load:e.onLoad,error:e.onError,click:e.viewBigImage,contextmenu:function(t){return e.handleContextMenu(t)}}}):e.getImageUrl?t("video",{class:[e.loading?"image-opacity-0":"",e.isShowNsfwBg?"blurBackground":""],style:{borderRadius:"8px",width:"".concat(e.baseImageWidth,"px"),height:"".concat(parseInt(e.height*e.baseImageWidth/e.width),"px")},attrs:{src:e.getImageUrl,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0},on:{play:function(t){e.loading=!1}}}):e._e()],e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.loading&&1!==e.nsfw,expression:"loading && nsfw !== 1"}],staticClass:"loading-wrapper"},[t("div",{staticClass:"loading-wrapper-inner"},[t("span",{staticClass:"spinner",attrs:{role:"img","aria-label":e.$t("Loading")}},[e._m(0)])])]),e._v(" "),e.isShowNsfwIcon?t("div",{staticClass:"generate-view-nsfw-plus",on:{click:function(t){return t.stopPropagation(),e.settingViewNsfw.apply(null,arguments)}}},[t("i",{staticClass:"iconfont",class:e.canViewNsfw?"icon-work-hide":"icon-work-show"})]):e._e(),e._v(" "),e.isEnableSubmit?[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isShowNotSelectBox,expression:"!isShowNotSelectBox"}],staticClass:"image-post-check-mask",on:{click:function(t){return t.stopPropagation(),e.handleClickCheck(t)}}},[t("el-checkbox",{staticClass:"image-post-check-box",on:{change:e.handleCheckChange},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}})],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowNotSelectBox,expression:"isShowNotSelectBox"}],staticClass:"image-post-check-mask-hover"},[e._v("\n                  "+e._s(e.$t("notAllowSelect"))+"\n                ")])]:e._e(),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isEnableSubmit&&e.isShowOperateBtn&&e.isShowImage&&e.src&&!e.loading&&![0,"0"].includes(this.operateNumber)||1===e.nsfw,expression:"\n                  (!isEnableSubmit &&\n                    isShowOperateBtn &&\n                    isShowImage &&\n                    src &&\n                    !loading &&\n                    ![0, '0'].includes(this.operateNumber)) ||\n                  nsfw === 1\n                "}],staticClass:"image-hover-mask",on:{click:e.viewBigImage}},[t("div",{staticClass:"image-hover-mask-btn-box"},[[e.getChunkRenderList(0).length?[e.getChunkRenderList(0).length>1?t("div",{staticClass:"image-hover-item"},[t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:e.covertI18n(e.getChunkRenderList(0)[0])}},["save"===e.getChunkRenderList(0)[0].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(0)[0].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(0)[0].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(0)[0].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(0)[0].code)}}},[e.getChunkRenderList(0)[0].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(0)[0].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(0)[0].icon)})],2)]],2),e._v(" "),e.getChunkRenderList(0)[1]?t("div",{staticClass:"line-item"}):e._e(),e._v(" "),e.getChunkRenderList(0)[1]?t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"bottom",content:e.covertI18n(e.getChunkRenderList(0)[1])}},["save"===e.getChunkRenderList(0)[1].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(0)[1].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(0)[1].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(0)[1].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(0)[1].code)}}},[e.getChunkRenderList(0)[1].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(0)[1].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(0)[1].icon)})],2)]],2):e._e(),e._v(" "),e.getChunkRenderList(0)[2]?t("div",{staticClass:"line-item"}):e._e(),e._v(" "),e.getChunkRenderList(0)[2]?t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"bottom",content:e.covertI18n(e.getChunkRenderList(0)[2])}},["save"===e.getChunkRenderList(0)[2].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(0)[2].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(0)[2].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(0)[2].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(0)[2].code)}}},[e.getChunkRenderList(0)[2].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(0)[2].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(0)[2].icon)})],2)]],2):e._e()],1):[t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:e.covertI18n(e.getChunkRenderList(0)[0])}},["save"===e.getChunkRenderList(0)[0].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(0)[0].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(0)[0].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(0)[0].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(0)[0].code)}}},[e.getChunkRenderList(0)[0].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(0)[0].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(0)[0].icon)})],2)]],2)]]:e._e(),e._v(" "),e.getChunkRenderList(1).length?[e.getChunkRenderList(1).length>1?t("div",{staticClass:"image-hover-item"},[t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:e.covertI18n(e.getChunkRenderList(1)[0])}},["save"===e.getChunkRenderList(1)[0].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(1)[0].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(1)[0].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(1)[0].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(1)[0].code)}}},[e.getChunkRenderList(1)[0].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(1)[0].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(1)[0].icon)})],2)]],2),e._v(" "),e.getChunkRenderList(1)[1]?t("div",{staticClass:"line-item"}):e._e(),e._v(" "),e.getChunkRenderList(1)[1]?t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"bottom",content:e.covertI18n(e.getChunkRenderList(1)[1])}},["save"===e.getChunkRenderList(1)[1].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(1)[1].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(1)[1].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(1)[1].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(1)[1].code)}}},[e.getChunkRenderList(1)[1].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(1)[1].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(1)[1].icon)})],2)]],2):e._e(),e._v(" "),e.getChunkRenderList(1)[2]?t("div",{staticClass:"line-item"}):e._e(),e._v(" "),e.getChunkRenderList(1)[2]?t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"bottom",content:e.covertI18n(e.getChunkRenderList(1)[2])}},["save"===e.getChunkRenderList(1)[2].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(1)[2].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(1)[2].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(1)[2].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(1)[2].code)}}},[e.getChunkRenderList(1)[2].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(1)[2].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(1)[2].icon)})],2)]],2):e._e()],1):[t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:e.covertI18n(e.getChunkRenderList(1)[0])}},["save"===e.getChunkRenderList(1)[0].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(1)[0].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(1)[0].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(1)[0].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(1)[0].code)}}},[e.getChunkRenderList(1)[0].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(1)[0].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(1)[0].icon)})],2)]],2)]]:e._e(),e._v(" "),e.getChunkRenderList(2).length?[e.getChunkRenderList(2).length>1?t("div",{staticClass:"image-hover-item"},[t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:e.covertI18n(e.getChunkRenderList(2)[0])}},["save"===e.getChunkRenderList(2)[0].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(2)[0].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(2)[0].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(2)[0].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(2)[0].code)}}},[e.getChunkRenderList(2)[0].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(2)[0].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(2)[0].icon)})],2)]],2),e._v(" "),e.getChunkRenderList(2)[1]?t("div",{staticClass:"line-item"}):e._e(),e._v(" "),e.getChunkRenderList(2)[1]?t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:e.covertI18n(e.getChunkRenderList(2)[1])}},["save"===e.getChunkRenderList(2)[1].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(2)[1].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(2)[1].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(2)[1].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(2)[1].code)}}},[e.getChunkRenderList(2)[1].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(2)[1].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(2)[1].icon)})],2)]],2):e._e(),e._v(" "),e.getChunkRenderList(2)[2]?t("div",{staticClass:"line-item"}):e._e(),e._v(" "),e.getChunkRenderList(2)[2]?t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:e.covertI18n(e.getChunkRenderList(2)[2])}},["save"===e.getChunkRenderList(2)[2].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(2)[2].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(2)[2].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(2)[2].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(2)[2].code)}}},[e.getChunkRenderList(2)[2].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(2)[2].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(2)[2].icon)})],2)]],2):e._e(),e._v(" "),e.getChunkRenderList(2)[3]?t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:e.covertI18n(e.getChunkRenderList(2)[3])}},["save"===e.getChunkRenderList(2)[3].code?[t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(2)[3].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(2)[3].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(2)[3].icon)})],2)])]:[t("span",{staticClass:"image-hover-mask-btn",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(2)[3].code)}}},[e.getChunkRenderList(2)[3].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(2)[3].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(2)[3].icon)})],2)]],2):e._e()],1):[t("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:e.covertI18n(e.getChunkRenderList(2)[0])}},["save"===e.getChunkRenderList(2)[0].code?[e.isShowSaveTo?t("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:e.$t("Save"),message:e.message,operateNumber:e.operateNumber,showArrowIcon:!1},on:{saveSuccess:e.handleSaveSuccess}},[t("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(t){return t.stopPropagation(),e.handleClick("save")}}},[e.getChunkRenderList(2)[0].useText?[e._v("\n                                  "+e._s(e.getChunkRenderList(2)[0].text)+"\n                                ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(2)[0].icon)})],2)]):e._e()]:[t("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(t){t.stopPropagation(),e.handleClick(e.getChunkRenderList(2)[0].code)}}},[e.getChunkRenderList(2)[0].useText?[e._v("\n                                "+e._s(e.getChunkRenderList(2)[0].text)+"\n                              ")]:t("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.getChunkRenderList(2)[0].icon)})],2)]],2)]]:e._e()]],2)])],2)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.error&&!e.loading,expression:"error && !loading"}],staticClass:"image-load-error"},[t("i",{staticClass:"iconfont icon-image-load-error image-load-error-icon"}),e._v(" "),t("span",{staticClass:"image-load-error-text",on:{click:function(t){return t.stopPropagation(),e.clickReloadImage.apply(null,arguments)}}},[e._v(e._s(e.$t("reloadImage")))])])])]),e._v(" "),e.dialogVisible?t("task-image-viewer",{staticClass:"message-img-viewer",staticStyle:{"z-index":"9999"},attrs:{operateNumber:e.operateNumber,nsfw:e.nsfw,"on-close":e.closeViewBigImage,"initial-index":e.currentImageIndex,"show-operate-btn":e.isShowOperateBtn,message:e.message,hoverBtnRenderList:e.hoverBtnRenderList,"url-list":e.viewImageList,msgId:e.message.id,loraModels:e.loraModels},on:{imageOperate:e.handleImageOperate,handleAnimate:function(t){return e.handleClick("animGen")},saveSuccess:e.handleSaveSuccess,setLoraModel:function(t){return e.$emit("setLoraModel",t)}}}):e._e()],1),e._v(" "),t("AiChatCreteConfirm",{attrs:{"dialog-visible":e.showMask,source:"task"},on:{"update:dialogVisible":function(t){e.showMask=t},"update:dialog-visible":function(t){e.showMask=t},confirm:e.handleConfirm}}),e._v(" "),t("auditDialog",{ref:"auditDialog",on:{confirm:e.applyNsfw}})],1)}),[function(){var e=this._self._c;return e("span",{staticClass:"inner-MGEKwh wanderingCubes-2A046F"},[e("span",{staticClass:"item-2VgEex"}),e("span",{staticClass:"item-2VgEex"})])}],!1,null,"595f87f0",null)),ae=ne.exports,oe={name:"MessageOperateBtn",props:{loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},clicked:{type:Boolean,default:!1},disableClickStatus:{type:Boolean,default:!1}},watch:{loading:{handler:function(e){this.isLoading=e},immediate:!0,deep:!0},disabled:{handler:function(e){this.isDisabled=e},immediate:!0},clicked:{handler:function(e){this.isClicked=e},immediate:!0}},data:function(){return{isClicked:!1,isLoading:!1,isDisabled:!1}},methods:{handleClick:function(){this.isLoading||this.isDisabled||(this.disableClickStatus,this.$emit("click"))},handleKeydown:function(e){32===e.keyCode&&e.preventDefault()}}},se=(n(2984),Object(y.a)(oe,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-message-operate-btn"},[t("button",e._b({staticClass:"message-operate-btn look-filled color-primary size-small grow",class:{"color-brand":e.isClicked&&!e.isLoading,"operate-btn-disable":e.isDisabled},attrs:{role:"button",type:"button",disabled:e.isDisabled},on:{click:function(t){return t.stopPropagation(),e.handleClick.apply(null,arguments)},keydown:e.handleKeydown}},"button",e.$attrs,!1),[t("div",{staticClass:"contents-wrapper"},[t("div",{staticClass:"content",style:{opacity:e.isLoading?0:1},attrs:{"aria-hidden":"false"}},[e._t("default")],2),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}],staticClass:"content-loading"},[t("svg",{staticClass:"content-loading-dots",attrs:{width:"24.5",height:"7"}},[t("g",{staticStyle:{opacity:"1"}},[t("circle",{attrs:{cx:"3.5",cy:"3.5",r:"3.5",fill:"currentColor"}}),e._v(" "),t("circle",{attrs:{cx:"12.25",cy:"3.5",r:"3.5",fill:"currentColor"}}),e._v(" "),t("circle",{attrs:{cx:"21",cy:"3.5",r:"3.5",fill:"currentColor"}})])])])])])])}),[],!1,null,"897541d4",null)),le=se.exports,re=n(187),ce=n(33),de=n(30),ue=n(21),he=n(356);function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ve=n(124),ge={name:"MsgItem",mixins:[ce.a],inject:["top"],props:{message:{type:Object,default:function(){return{}},required:!0},taskFrom:{type:String,default:function(){return""}}},components:{MessageImg:ae,MessageOperateBtn:le,MetaTooltipVue:re.a,SwipeList:he.a},filters:{formatDateTime:function(e){var t=new Date(e),n=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),r=t.getHours().toString().padStart(2,"0"),c=t.getMinutes().toString().padStart(2,"0"),d=t.getSeconds().toString().padStart(2,"0");return Object(k.u)(t,new Date)?"".concat(r,":").concat(c,":").concat(d):"".concat(n,"/").concat(o,"/").concat(l," ").concat(r,":").concat(c,":").concat(d)}},computed:me(me(me(me({},Object(S.c)(["isSupportWebp"])),Object(S.c)("user",["accountSettingsData","userInfo","isCompanyAccount"])),Object(S.e)("payment",["paymentInfo"])),{},{isVip:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},isShowExpireTime:function(){var e=this.message.expiration_time;return!this.alreadySave&&e&&e>0},getExpireTime:function(){var e=this.message.expiration_time,t=(new Date).getTime();if(e&&e>t){var n=e-t,o=Math.floor(n/864e5);return o?this.$t("TaskExpireTime",{param:o}):this.$t("ExpiresSoon")}return this.$t("TaskExpireTime",{param:0})},isStudioMode:function(){return[7,"7","studio",11,"11"].includes(this.message.category)},showTaskMode:function(){return[1,2,3,4,5,7,8,13].includes(this.message.type)},convertTaskMode:function(){var e={1:"createModeType1",2:"createModeType2",6:"createModeType6",4:"createModeType4",5:"createModeType5",7:"studio",11:"studio"};return e[this.message.category]?e[this.message.category]:""},moreActionsShow:function(){return[!["",null,void 0].includes(this.message.pub_artwork_no),!["",null,void 0].includes(this.message.pub_artwork_no)&&![4,"4"].includes(this.message.type),this.checkPermission||this.checkIsChannelOwner].some((function(e){return!!e}))},setI18nPrompt:function(){var e=this.message.local_prompt,t=this.message.meta?this.message.meta.prompt:"";return this.isI18nToggled?e:t},computedPercentage:function(){return function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).process;return void 0===e?0:e}},convertStatusText:function(){var e={userCancelDesc:this.$t("userCancel"),sysCancelDesc:this.$t("systemCancel"),sysTimeoutDesc:this.$t("systemTimeoutCancel")};return this.message.status_desc?e[this.message.status_desc]:""},checkBtnStatus:function(){var e=this;return function(t){var n={disabled:!1,loading:!1};return e.currentClickBtn===t?(n.loading=!0,n.disabled=!1,n):(e.currentClickBtn&&e.currentClickBtn!==t&&(n.loading=!1,n.disabled=!0),n)}},checkBtnIsNSFW:function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!1;try{var o,l,r=this.message.type||1;if([2,"2"].includes(r))n=!(null===(o=this.message)||void 0===o||null===(o=o.img_uris)||void 0===o||!o.length)&&[1,"1"].includes(null===(l=this.message)||void 0===l?void 0:l.img_uris[0].nsfw);if([1,"1",3,"3"].includes(r)){var c=!(!this.message.img_uris||!this.message.img_uris.length)&&this.message.img_uris[t-1];n=c&&[1,"1"].includes(c.nsfw)}}catch(e){}return n}},getImageUrl:function(){var e,t,n,o;return null!==(e=this.message)&&void 0!==e&&null!==(e=e.img_uris)&&void 0!==e&&e.length&&!["",null,void 0].includes(null===(t=this.message)||void 0===t||null===(t=t.img_uris[0])||void 0===t?void 0:t.url)?this.isSupportWebp&&![6,"6"].includes(this.message.type)?Object(k.x)(null===(n=this.message)||void 0===n?void 0:n.img_uris[0].url,"high"):null===(o=this.message)||void 0===o?void 0:o.img_uris[0].url:!![10,"10"].includes(this.message.type)||(!(![24,"24"].includes(this.message.type)||!this.message.img_uris.length)||(this.message.base_64_banner_url?this.message.base_64_banner_url:""))},getGridImageUrl:function(){return function(e){var t="";return e&&!["",null,void 0].includes(e.url)?t=e.url:t}},moreActionShow:function(){return[2,4,13].includes(this.message.type)},convertTaskType:function(){var e={1:"Txt2Img",2:"Upscaling",3:"Variations",4:"ai_tools_1",5:"RemoveBackground",6:"GetDescriptors",7:"TaskUploadImage",8:"conditionToImage",10:"Preview",11:"Expansion",13:"ai_tools_1",23:"RoopLabel",24:"AnimGen",25:"characterRepair"};return e[this.message.type]?e[this.message.type]:""},checkBtnClicked:function(){return function(e,t){var n=this.message.operation,o=void 0===n?[]:n;if(!o||!o.length)return!1;var l=(o||[]).filter((function(e){return[2,"2"].includes(e.action)})).map((function(e){return e.number})),r=(o||[]).filter((function(e){return[3,"3"].includes(e.action)})).map((function(e){return e.number})),c=(o||[]).filter((function(e){return[4,"4"].includes(e.action)})).map((function(e){return e.number})),d=!1;switch(e){case"U":d=-1!==l.indexOf(t);break;case"V":d=-1!==r.indexOf(t);break;case"reStart":d=!!c.length}return d}},imagePromptList:function(){return this.isI18nToggled?Array.isArray(this.message.reverse_local_prompts)?this.message.reverse_local_prompts:[]:Array.isArray(this.message.reverse_prompts)?this.message.reverse_prompts:[]},getImageInfo:function(){return function(e){return Object.assign(J()(this.message),{banner:e})}},checkPermission:function(){var e=!1;this.message.type;return this.message.sender_id&&this.message.sender_id===this.userInfo.id?e=!0:(this.isPrivateChannel&&(e=!0),e)},checkIsChannelOwner:function(){var e;return this.message.sender_id&&(null==this||null===(e=this.top)||void 0===e||null===(e=e.channelInfo)||void 0===e?void 0:e.owner_id)===this.userInfo.id},isPrivateChannel:function(){return["PRIVATE"].includes(this.top.channelId)},getAuthorName:function(){var e,t="",n=null===(e=this.message)||void 0===e||null===(e=e.messageInfo)||void 0===e?void 0:e.author;return t=n?n.name||n.id:"",t=["",null,void 0].includes(t)?"":"@".concat(t)},isMyMsg:function(){var e,t;return(null===(e=this.message)||void 0===e||null===(e=e.messageInfo)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id)===this.userInfo.id||!(null!==(t=this.message)&&void 0!==t&&t.messageInfo)},isShowCancel:function(){var e=this.message,t=e.status,n=e.category,o=e.type,l=![4,"4"].includes(t),r=![4,5,6,10,11,13,23,"23"].includes(o);return l&&![3,"3"].includes(n)&&this.checkPermission&&r},isShowFaster:function(){var e=this.message,t=e.status,n=e.speed_type;return 1==t&&1===n&&!this.hasAccelerated}}),watch:{accountSettingsData:{handler:function(e){this.isI18nToggled=!e.is_off_localization},deep:!0},message:{handler:function(e){var t=this;this.$nextTick((function(){t.isLoading=!!e.isLoading,t.currentClickBtn=e.loadingBtn||""}))},deep:!0,immediate:!0}},data:function(){return{defaultAvatar:ve,customColor:"#2E9E60",isLoading:!1,isPosting:!1,currentClickBtn:"",isI18nToggled:!1,morePopoverVisible:!1,reportLoading:!1,mapObj:{0:!0,1:!0,2:!0,3:!0,4:!0},trailBtnLoading:!1,hasAccelerated:!1,alreadySave:!1,metaTooltipShow:!1,loraModeObj:{},checkpoiontNameObj:{}}},mounted:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.isI18nToggled=!e.accountSettingsData.is_off_localization;case 1:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.mapObj={}},methods:{expireClick:function(){var e=(this.paymentInfo||{}).vipType,t=["svip_1","svip_2","svip_1_trial","svip_2_trial","vip_lite"].includes(e)||e.includes("vip_day");this.isVip?t&&this.$EventBus.$emit("showUpgradeDialog","NoExpireTimeTipWeb","professional"):this.$EventBus.$emit("showBreakDialog","ExpireTimeTipWeb","basic")},handleUpdateModelName:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";["",null,void 0].includes(this.modelName)&&this.$set(this.message,"art_model_name",e)},setLoraModel:function(e){this.loraModeObj=Object.assign(this.loraModeObj,e)},deleteSingleImg:function(e){var t=this,n=this.message,o=n.id,l=void 0===o?"":o,r=n.img_uris,c=(void 0===r?[]:r)[e-1].index,d=void 0===c?"":c;Object(V.b)({id:l,index:d}).then((function(){t.$logEvent("log_actions",{operation:"creative_flow_single_picture",behavior_info:"delete"}),t.$message({message:t.$t("deleteSuccess"),type:"success"}),t.message.img_uris=t.message.img_uris.filter((function(e){return e.index!=d})),t.message.img_uris.length||t.$emit("operate",{type:"deleteTask",info:t.message})}))},handleNsfwStatus:function(e){var t=e.index,n=e.canViewNsfw;this.$set(this.mapObj,t,n)},autoResizeScrollBtn:function(){var e=this;this.$nextTick((function(){try{var t;null==e||null===(t=e.$refs)||void 0===t||t.swipeList.setMoveBtnShow()}catch(e){}}))},toUserPage:function(e){var t,n=null===(t=this.message)||void 0===t||null===(t=t.messageInfo)||void 0===t?void 0:t.author;e=n?n.id:"",["",null,void 0].includes(e)||this.$router.push("/user/"+e)},moreActions:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""){case"report":this.reportArtwork();break;case"collect":this.message&&this.message.collect?this.unFavorite():this.handleCollect();break;case"shareLink":this.handleShareLink();break;case"delete":this.isPrivateChannel?this.handleDeleteTask():this.handleDeleteMessage()}},handleDeleteTask:function(){var e=this;this.$confirm(this.$t("deleteTaskConfirm"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){var t={ids:[e.message.id]};e.globalLoading=!0,Object(A.f)(t).then((function(t){var n,o;["10000",1e4].includes(null==t||null===(n=t.status)||void 0===n?void 0:n.code)?(e.$emit("operate",{type:"deleteTask",info:e.message}),e.$message({message:e.$t("deleteSuccess"),type:"success"})):e.$message({message:(null==t||null===(o=t.status)||void 0===o?void 0:o.msg)||e.$t("ServerError"),type:"error"})})).finally((function(){e.globalLoading=!1}))})).catch((function(e){}))},handleDeleteMessage:function(){var e=this;this.$confirm(this.$t("deleteTaskConfirm"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){var t={channel_id:e.top.channelId,message_ids:[e.message.message_id]};e.globalLoading=!0,Object(A.e)(t).then((function(t){var n,o;["10000",1e4].includes(null==t||null===(n=t.status)||void 0===n?void 0:n.code)?(e.$emit("operate",{type:"deleteTask",info:e.message}),e.$message({message:e.$t("deleteSuccess"),type:"success"})):e.$message({message:(null==t||null===(o=t.status)||void 0===o?void 0:o.msg)||e.$t("ServerError"),type:"error"})})).finally((function(){e.globalLoading=!1}))})).catch((function(e){}))},handleCollect:function(){var e=this,t={id:this.message.pub_artwork_no};this.addFavorite(t,"artwork",null,(function(data){e.$emit("updateData",e.message.id,{collect:data})}))},unFavorite:function(){var e=this;if(!this.isCollecting){var t={id:this.message.pub_artwork_no,collect:{id:this.message.collect.id}};this.isCollecting=!0,Object(ue.h)({id:t.collect.id}).then((function(n){var o={id:t.id,collect:null};e.$logEvent("log_actions",{operation:"cancel_collect_image",behavior_info:t.id}),e.$emit("updateData",e.message.id,{collect:null}),e.changeCollectData(o)})).finally((function(){e.isCollecting=!1}))}},handleShareLink:function(){var e=this.message,t=e.pub_artwork_no,n=void 0===t?"":t,o=e.pub_artwork_nos,l=void 0===o?[]:o,r=n;if(l&&l.length&&(r=l[0]),!["",null,void 0].includes(r)){var c="".concat(window.location.origin,"/")+"explore/detail/".concat(r);this.$message.success(this.$t("CopiedURLToClipboard")),Object(k.d)(c)}},reportArtwork:function(){var e=this,t=this.message.pub_artwork_no,n=void 0===t?"":t;this.reportLoading||["",null,void 0].includes(n)||(this.reportLoading=!0,Object(de.o)({id:n}).then((function(t){var code=t&&t.status?t.status.code:"";[1e4,"10000"].includes(code)&&F()({message:e.$t("ReportSuccess"),type:"success",duration:5e3})})).finally((function(){e.reportLoading=!1})))},handleReStart:function(){this.closeMetaPopover(),this.$emit("operate",{info:this.message,type:"reStart"})},handleImageOperate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";switch(e){case"extraUpscale":this.$EventBus.$emit("openGenerate",{action:6,data:{imageUrl:n,art_work_no:this.message.pub_artwork_no,meta:Object.assign({},J()(this.message.meta),{channel:this.message.category})}});break;case"upscale":this.$emit("operate",{info:this.message,type:"U",btnInfo:{btnType:"U",id:t}});break;case"variations":this.$emit("operate",{info:this.message,type:"V",btnInfo:{btnType:"V",id:t}});break;case"removeBackground":this.$emit("operate",{info:this.message,type:"removeBackground",imageUrl:n});break;case"animGen":this.$emit("operate",{info:this.message,type:"A",btnInfo:{btnType:"A",id:t}})}},handlePromptSearch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$emit("operate",{info:this.message,type:"promptSearch",prompt:e})},handleTaskReStart:function(){this.$emit("operate",{info:this.message,type:"taskReStart"})},handleOperate:function(e,t){this.$emit("operate",{info:this.message,type:t,btnInfo:e})},handleCancelTask:function(){this.isLoading||this.$emit("operate",{info:this.message,type:"cancelTask"})},handleTrialFastQueue:function(){var e=this;this.$logEvent("log_actions",{operation:"try_quick_queue",behavior_info:"click_try"});var t=this.message.id,n=void 0===t?"":t;this.trailBtnLoading=!0,Object(V.c)({id:n}).then((function(t){var n,code=null==t||null===(n=t.status)||void 0===n?void 0:n.code;70010===code?(e.$EventBus.$emit("showBreakDialog","FastQueueTipWeb","basic"),e.$logEvent("log_actions",{operation:"try_quick_queue",behavior_info:"vip_pop_show"})):1e4===code&&(e.hasAccelerated=!0,e.$message.success(e.$t("AccelerateSuccess"))),e.trailBtnLoading=!1}))},handleCopyGenerationData:function(){var e={action:"task",obj_no:this.message.id,obj_type:1,view_domain:"",category:"default",batch_id:"",negative_ids:[]};Object(de.g)({items:[e]}),this.closeMetaPopover(),this.$emit("copyGenerationData",this.message)},closeMetaPopover:function(){try{this.$refs&&this.$refs.metaPopover&&this.$refs.metaPopover.doClose()}catch(e){}}}},fe=ge,_e=(n(2985),n(2986),n(2987),Object(y.a)(fe,(function(){var e,t,n,o,l,r,c,d=this,h=d._self._c;return h("div",{staticClass:"c-msg-item"},[h("div",{staticClass:"chat-message-header"},[h("img",{staticClass:"chat-message__avatar",attrs:{src:d.defaultAvatar,alt:"Avatar"}}),d._v(" "),h("h3",{staticClass:"chat-message__title"},[h("span",{staticClass:"chat-message__title-user"},[d._v(d._s(d.$t("SeaArtBot")))]),d._v(" "),h("span",{directives:[{name:"show",rawName:"v-show",value:d.convertTaskType,expression:"convertTaskType"}],staticClass:"chat-message__title-task-tag"},[d._v(d._s(d.$t(d.convertTaskType)))]),d._v(" "),h("span",{directives:[{name:"show",rawName:"v-show",value:d.showTaskMode,expression:"showTaskMode"}],staticClass:"chat-message__title-task-tag-2"},[d._v(d._s(d.$t(d.convertTaskMode)))]),d._v(" "),d.message.create_at?h("span",{staticClass:"chat-message__title-time"},[d._v(d._s(d._f("formatDateTime")(d.message.create_at)))]):d._e(),d._v(" "),d.isMyMsg?h("el-popover",{attrs:{trigger:"click","popper-class":"custom-popver"}},[h("div",{staticClass:"task-info-tips"},[h("p",[h("span",[d._v(d._s(d.$t("TaskID")))]),h("span",[d._v(d._s(d.message.id))])]),d._v(" "),3!==d.message.status||d.isCompanyAccount?d._e():[[1,2,"1","2"].includes(null===(e=d.message)||void 0===e?void 0:e.pub_community)?h("p",[h("span",{staticClass:"task-info-tips-label"},[d._v(d._s(d.$t("status")))]),d._v(" "),h("span",{staticClass:"task-pub-status"},[d._v(d._s([2,"2"].includes(null===(t=d.message)||void 0===t?void 0:t.pub_community)?d.$t("createSetting1"):d.$t("createSetting2")))])]):d._e(),d._v(" "),h("p",[h("span",{staticClass:"task-info-tips-label"},[d._v(d._s(d.$t("expend")))]),d._v(" "),h("span",{staticClass:"task-info-tips-content"},[h("span",[d._v(d._s(d.$t("tempCoins"))+" : "+d._s(null===(n=d.message)||void 0===n||null===(n=n.deduction_detail)||void 0===n?void 0:n.temp_hashrate))]),d._v(" "),h("span",[d._v(d._s(d.$t("calculateCoins"))+" : "+d._s(null===(o=d.message)||void 0===o||null===(o=o.deduction_detail)||void 0===o?void 0:o.hashrate))])])]),d._v(" "),null!==(l=d.message)&&void 0!==l&&null!==(l=l.deduction_detail)&&void 0!==l&&l.history_hashrate?h("p",[h("span",{staticClass:"task-info-tips-label"},[d._v(d._s(d.$t("currentBalance")))]),d._v(" "),h("span",{staticClass:"task-info-tips-content"},[h("span",[d._v(d._s(d.$t("tempCoins"))+" : "+d._s(null===(r=d.message)||void 0===r||null===(r=r.deduction_detail)||void 0===r?void 0:r.after_temp_hashrate))]),d._v(" "),h("span",[d._v(d._s(d.$t("calculateCoins"))+" : "+d._s(null===(c=d.message)||void 0===c||null===(c=c.deduction_detail)||void 0===c?void 0:c.after_hashrate))])])]):d._e()]],2),d._v(" "),h("i",{staticClass:"iconfont icon-task_tips task-info-icon",attrs:{slot:"reference"},slot:"reference"})]):d._e(),d._v(" "),d.isShowExpireTime?h("el-tooltip",{attrs:{placement:"top",effect:"light","popper-class":"custom-tips-popper",content:d.$t("ExpirationTimeTip")}},[h("span",{staticClass:"chat-message__title-task-tag-expire-time",on:{click:d.expireClick}},[h("span",[d._v(d._s(d.getExpireTime))])])]):d._e()],1)]),d._v(" "),[3,"3",4,"4"].includes(d.message.status)?h("div",{staticClass:"msg-item-more-panel",class:[d.morePopoverVisible?"msg-item-more-panel-show":""]},[d.moreActionsShow?h("el-popover",{ref:"myPopover",attrs:{placement:"bottom-end","popper-class":"msg-item-more-popover","visible-arrow":!1,width:"100",trigger:"click"},model:{value:d.morePopoverVisible,callback:function(e){d.morePopoverVisible=e},expression:"morePopoverVisible"}},[h("div",{staticClass:"pop-btns flex"},[["",null,void 0].includes(d.message.pub_artwork_no)||!d.moreActionShow||d.isStudioMode?d._e():h("button",{on:{click:function(e){return d.moreActions("report")}}},[h("span",{staticClass:"pop-btns-text"},[d._v(d._s(d.$t("Report")))]),d._v(" "),h("span",{staticClass:"pop-btns-icon"},[h("i",{staticClass:"iconfont icon-task-report-icon"})])]),d._v(" "),["",null,void 0].includes(d.message.pub_artwork_no)||!d.moreActionShow||d.isStudioMode?d._e():h("button",{on:{click:function(e){return d.moreActions("collect")}}},[h("span",{staticClass:"pop-btns-text"},[d._v(d._s(d.message.collect&&d.message.collect.id?"".concat(d.$t("cancelFavorite")):d.$t("Collect")))]),d._v(" "),h("span",{staticClass:"pop-btns-icon"},[h("i",{staticClass:"iconfont icon-collect"})])]),d._v(" "),(!["",null,void 0].includes(d.message.pub_artwork_no)&&d.moreActionShow||d.isStudioMode)&&![4,"4"].includes(d.message.type)?h("button",{directives:[{name:"show",rawName:"v-show",value:!d.isCompanyAccount,expression:"!isCompanyAccount"}],on:{click:function(e){return d.moreActions("shareLink")}}},[h("span",{staticClass:"pop-btns-text"},[d._v(d._s(d.$t("ShareLink")))]),d._v(" "),h("span",{staticClass:"pop-btns-icon"},[h("i",{staticClass:"iconfont icon-share-icon"})])]):d._e(),d._v(" "),d.checkPermission||d.checkIsChannelOwner?h("button",{on:{click:function(e){return d.moreActions("delete")}}},[h("span",{staticClass:"pop-btns-text"},[d._v(d._s(d.$t("Delete")))]),d._v(" "),h("span",{staticClass:"pop-btns-icon"},[h("i",{staticClass:"iconfont icon-shanchu"})])]):d._e()]),d._v(" "),h("div",{staticClass:"msg-item-more-icon",attrs:{slot:"reference"},slot:"reference"},[h("i",{staticClass:"iconfont icon-more msg-item-more-icon-20"})])]):d._e(),d._v(" "),[4,"4",10,"10",23,"23",25,"25"].includes(d.message.type)||[4,"4"].includes(d.message.status)?d._e():h("div",{staticClass:"msg-item-more-icon",style:{marginRight:[6,"6"].includes(d.message.type)?"":"6px"},on:{click:function(e){e.stopPropagation(),d.isI18nToggled=!d.isI18nToggled}}},[h("i",{staticClass:"iconfont icon-i18n_prompt msg-item-more-icon-24"})]),d._v(" "),[4,"4",6,"6",10,"10",23,"23",25,"25"].includes(d.message.type)||[4,"4"].includes(d.message.status)?d._e():h("el-popover",{ref:"metaPopover",staticStyle:{padding:"0"},attrs:{"popper-class":"metaPoper",placement:"right","visible-arrow":!1,trigger:"click"},model:{value:d.metaTooltipShow,callback:function(e){d.metaTooltipShow=e},expression:"metaTooltipShow"}},[d.metaTooltipShow?h("MetaTooltipVue",{attrs:{meta:d.message.meta,msgId:d.message.id,loraModels:d.loraModeObj,model:d.message.art_model_no,category:d.message.category,"model-name":d.message.art_model_name},on:{updateModelName:d.handleUpdateModelName,copyGenerationData:d.handleCopyGenerationData,close:d.closeMetaPopover,setLoraModel:d.setLoraModel}}):d._e(),d._v(" "),h("div",{staticClass:"msg-item-more-icon",attrs:{slot:"reference"},slot:"reference"},[h("span",{staticClass:"el-icon-warning-outline svg-icon msg-item-more-icon-20"})])],1),d._v(" "),[4,"4","5",5,6,"6",10,"10",2,"2",23,"23",25,"25"].includes(d.message.type)||[4,"4"].includes(d.message.status)?d._e():h("div",{staticClass:"msg-item-more-icon",on:{click:function(e){return e.stopPropagation(),d.handleReStart.apply(null,arguments)}}},[h("i",{staticClass:"iconfont icon-refresh-icon2 msg-item-more-icon-18"})])],1):d._e(),d._v(" "),h("div",{staticClass:"message-text-content"},[h("div",{staticClass:"message-text-content-text"},[d._v(d._s(d.setI18nPrompt)),d.isPrivateChannel||["",null,void 0].includes(d.getAuthorName)?d._e():h("span",{staticClass:"message-author-text",on:{click:function(e){return e.stopPropagation(),d.toUserPage.apply(null,arguments)}}},[d._v(d._s(d.getAuthorName))])])]),d._v(" "),[6,"6"].includes(d.message.type)?[h("div",{staticClass:"message-text-list"},d._l(d.imagePromptList,(function(e,t){return h("div",{key:t,staticClass:"message-text-list-item"},[h("span",{staticClass:"message-text-list-item-order"},[d._v(d._s(t+1))]),d._v(" "),h("span",{staticClass:"message-text-list-item-text"},[d._v(d._s(e))])])})),0),d._v(" "),h("div",{staticClass:"operating-options-text"},d._l(d.imagePromptList,(function(e,t){return h("message-operate-btn",{key:"".concat(t,"_prompt_text"),on:{click:function(t){return d.handlePromptSearch(e)}}},[d._v("\n        "+d._s(t+1)+"\n      ")])})),1)]:d._e(),d._v(" "),[2,"2",3,"3"].includes(d.message.status)&&(d.getImageUrl||d.isStudioMode&&d.message.img_uris.length)?h("div",{staticClass:"message-accessories",on:{mouseenter:d.autoResizeScrollBtn}},[h("swipe-list",{ref:"swipeList",attrs:{"move-leng":200}},[h("div",{staticClass:"media-attachments-container"},[d.message&&[10,"10"].includes(d.message.type)?d._l(d.message.preprocess_images,(function(e,t){return h("message-img",{key:t,attrs:{src:d.getGridImageUrl(e),msgId:d.message.id,loraModels:d.loraModeObj,nsfw:e.nsfw,message:d.getImageInfo(e),"operate-number":t+1,"view-status":d.mapObj},on:{setLoraModel:d.setLoraModel,imageOperate:d.handleImageOperate,viewNsfwStatus:d.handleNsfwStatus}})})):d.message&&Array.isArray(d.message.img_uris)&&d.message.img_uris.length?d._l(d.message.img_uris,(function(e,t){return h("message-img",{key:t,attrs:{src:d.getGridImageUrl(e),msgId:d.message.id,loraModels:d.loraModeObj,nsfw:e.nsfw,width:e.width,height:e.height,message:d.getImageInfo(e),"operate-number":t+1,"view-status":d.mapObj},on:{setLoraModel:d.setLoraModel,imageOperate:d.handleImageOperate,viewNsfwStatus:d.handleNsfwStatus,deleteSingleImg:d.deleteSingleImg,saveSuccess:function(e){d.alreadySave=!0}}})})):h("message-img",{attrs:{src:d.getImageUrl,nsfw:d.message.nsfw,message:d.message,msgId:d.message.id,loraModels:d.loraModeObj,"view-status":d.mapObj},on:{setLoraModel:d.setLoraModel,imageOperate:d.handleImageOperate,viewNsfwStatus:d.handleNsfwStatus}})],2)])],1):d._e(),d._v(" "),[1,"1",2,"2",4,"4"].includes(d.message.status)?h("div",{staticClass:"message-process-container"},[[2,"2"].includes(d.message.status)&&d.computedPercentage(d.message)?h("div",{staticClass:"message-process-panel"},[h("el-progress",{attrs:{percentage:d.computedPercentage(d.message),color:d.customColor,"show-text":!1,"stroke-width":7}})],1):d._e(),d._v(" "),h("div",{staticClass:"message-process-operate-box"},[[1,"1"].includes(d.message.status)?[h("span",{staticClass:"process-operate-box-text"},[d._v(d._s(d.$t("TaskStatusWaitingToStart"))+" "),h("span",{staticClass:"message-process-loading-span"})])]:[2,"2"].includes(d.message.status)&&!d.computedPercentage(d.message)?[h("span",{staticClass:"process-operate-box-text"},[d._v(d._s(d.$t("TaskStatusPreparing"))+" "),h("span",{staticClass:"message-process-loading-span"})])]:[4,"4"].includes(d.message.status)?h("span",{staticClass:"process-operate-box-text",staticStyle:{color:"#DA373D"}},[d._v(d._s(d.convertStatusText))]):h("span",{staticClass:"process-operate-box-text"},[d._v(d._s(d.$t("youHaveCompleted"))),h("span",{staticClass:"process-operate-box-text-strong",staticStyle:{"margin-left":"5px"}},[d._v(d._s(d.computedPercentage(d.message))+"%")]),d._v(" "),h("span",{staticClass:"message-process-loading-span"})]),d._v(" "),d.isShowFaster?h("el-button",{staticClass:"message-process-operate-box-btn fast-queue",attrs:{size:"mini",loading:d.trailBtnLoading},on:{click:d.handleTrialFastQueue}},[h("i",{staticClass:"iconfont icon-trail-fast-queue"}),d._v(" "),h("span",{staticClass:"words"},[d._v(d._s(d.$t("TrialFastQueue")))])]):d._e(),d._v(" "),d.isShowCancel?h("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:d.$t("CancelJobTips"),placement:"top-start"}},[h("el-button",{staticClass:"message-process-operate-box-btn",class:{isLoading:d.isLoading},attrs:{type:"danger",size:"mini"},on:{click:d.handleCancelTask}},[d._v("\n          "+d._s(d.isLoading?"Canceling…":d.$t("CancelJob"))+"\n        ")])],1):d._e(),d._v(" "),[4,"4"].includes(d.message.status)&&d.checkPermission?h("message-operate-btn",{key:"reStart",attrs:{loading:d.checkBtnStatus("reStart").loading,disabled:d.checkBtnStatus("reStart").disabled},on:{click:d.handleTaskReStart}},[h("i",{staticClass:"iconfont icon-refresh-icon2",staticStyle:{"font-size":"18px"}})]):d._e()],2)]):d._e()],2)}),[],!1,null,"48eb6249",null)),be=_e.exports,ye=n(42),we=n(219),Ce=n(707),ke=n(77),Se=n(430),xe=n(13);function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Te={name:"TaskView",components:{MsgItem:be,auditDialog:Z.a},mixins:[Ce.a],inject:["top"],data:function(){return{list:[],debounceHandleScroll:"",loading:!1,showBackTopBtn:!1,last1:0,last2:0,timer:null,showScroll:!1,showNoDataContent:!1,keyword:"",btnLoading:!1}},watch:{collectData:{handler:function(){var e=this;if(this.collectData&&this.collectData.id){var t=this.list.find((function(t){return t.pub_artwork_no&&t.pub_artwork_no===e.collectData.id})),n=t?t.id:"";!["",null,void 0].includes(n)&&this.handleUpdateData(n,{collect:this.collectData.collect||null})}},deep:!0,immediate:!0},"top.channelId":{handler:function(e){this.handleChannelChange(e)},deep:!0,immediate:!0}},created:function(){this.addEmitEvent()},mounted:function(){Object(ye.l)()&&this.init(),this.initScrollBar(),this.debounceHandleScroll=Object(X.debounce)(this.handleScroll,600),this.$EventBus.$on("needScrollBottom",this.checkNeedScrollToBottom),this.addPageShowEvent(),window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline)},beforeDestroy:function(){this.debounceHandleScroll=null,this.timer&&window.clearTimeout(this.timer),this.timer=null,this.$EventBus.$off("needScrollBottom"),window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),document.removeEventListener("visibilitychange",this.showPageEvent),this.closeWebsocket()},computed:Oe(Oe(Oe(Oe({},Object(S.e)("user",["collectData","userInfo"])),Object(S.c)("payment",["activeState"])),Object(S.c)("user",["isLoggedIn"])),{},{checkIsShowBackTopBtn:function(){return this.showBackTopBtn&&this.list.length},showMessage:function(){return function(e){var t;return![8,"8"].includes(null==e||null===(t=e.messageInfo)||void 0===t?void 0:t.type)}},checkIsShowViewNsfw:function(){var e;return null==this||null===(e=this.userInfo)||void 0===e?void 0:e.enable_nsfw_plus},enableNsfwMode:function(){var e;return![2,"2"].includes(null==this||null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.nsfw_plus)}}),methods:Oe(Oe({},Object(S.b)("user",["getAccountInfo"])),{},{addEmitEvent:function(){var e=this;this.$EventBus.$on("TaskListHandle",(function(t){e.handleTaskOperate(t)}))},addPageShowEvent:function(){document.addEventListener("visibilitychange",this.showPageEvent)},showPageEvent:function(){"visible"===document.visibilityState&&this.handleOnline()},settingViewNsfw:function(){var e;this.btnLoading||(this.enableNsfwMode||1===(null===(e=this.userInfo)||void 0===e?void 0:e.is_audit)?this.applyNsfw():this.$refs.auditDialog.showDialog())},applyNsfw:function(){var e=this;this.btnLoading=!0;var t={};t.nsfw_plus=this.enableNsfwMode?2:1,t.mode=1,t.age_confirm=!0,Object(Q.b)(t).then((function(t){var n=(t||{}).status.code;["10000",1e4].includes(void 0===n?"":n)&&(e.$message.success(e.$t(e.enableNsfwMode?"ClosedSuccessfully":"OpenedSuccessfully")),e.btnLoading=!1,e.getAccountInfo())})).finally((function(){e.btnLoading=!1}))},handleSearch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.keyword=e,this.list=[],this.getHistoryMessage()},handleOnline:function(){try{var e;null===(e=this.webSocketService)||void 0===e||e.reconnectWebSocket(!0)}catch(e){}},handleOffline:function(){},init:function(){var e=this;this.showNoDataContent=!1,this.$store.dispatch("creation/getTaskOptionsInfo"),this.last1=0,this.last2=0,this.initWebSocketService(),"PRIVATE"===this.top.channelId?this.getHistoryMessage().finally((function(){e.showNoDataContent=!0})):this.getHistoryChatMessage().finally((function(){e.showNoDataContent=!0})),this.pollingMiddleware=new we.a(3e3,(function(){e.fetchTaskData()}))},handleTaskError:function(code){var e={7e4:this.$t("taskOperateFailed"),70001:this.$t("taskExceededDailyGenerationLimit"),70002:this.$t("taskQueueFull"),70003:this.$t("taskModelVersionNotSupportVariations"),70009:this.$t("taskModelForbidden"),70008:this.$t("taskArtWorkForbidden"),70024:this.$t("error_code_70024"),80008:this.$t("InsufficientBalance"),70010:this.$t("error_code_70010"),70011:this.$t("error_code_70011"),70013:this.$t("error_code_70013"),70014:this.$t("error_code_70014"),70015:this.$t("error_code_70015"),70016:this.$t("error_code_70016"),70019:this.$t("error_code_70019"),70023:this.$t("HttpErrorCode_70023")};code&&e[code]?this.$message.error(e[code]):this.$message.error(this.$t("ServerError"))},checkNeedScrollToBottom:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t=this.list.findIndex((function(t){return t.id===e.id})),n=this.$refs.scrollWrapper;-1===t||t!==this.list.length-1||this.showScroll||n.scrollHeight-n.scrollTop<n.clientHeight+e.banner.height&&this.scrollToTop()}catch(e){}},checkUpdateMessageNeedScrollToBottom:function(){try{var e=this.$refs.scrollWrapper;e.scrollHeight-e.scrollTop<=2*e.clientHeight&&this.scrollToTop()}catch(e){}},initScrollBar:function(){var e=this;try{this.$refs.scrollWrapper.addEventListener("scroll",this.initScrollBarStatus),this.$once("hook:beforeDestroy",(function(){e.$refs.scrollWrapper.removeEventListener("scroll",e.initScrollBarStatus)}))}catch(e){}},initScrollBarStatus:function(){this.showScroll=!0},getHistoryMessage:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.loading||!this.isLoggedIn)return Promise.resolve();var n={limit:50};return["",null,void 0].includes(t)||(n.after_id=t),n.keyword=this.keyword,this.loading=!0,Object(A.q)(n).then((function(t){if("PRIVATE"!==e.top.channelId)return t;var o=t.data,data=void 0===o?{}:o;if(n.after_id){var l,r,c=Object(B.e)(e.list,(null==data?void 0:data.items)||[]);c=e.sortByField(c,"create_at",!0);var d=null===(l=e.$refs)||void 0===l||null===(l=l.scrollWrapper)||void 0===l?void 0:l.scrollHeight;c=c.map((function(e){return e.img_uris=((null==e?void 0:e.img_uris)||[]).filter((function(e){return null==e?void 0:e.url})),e})),(r=e.list).unshift.apply(r,Object(R.a)(c)),d&&c.length&&e.scrollToTop(d,"instant")}else e.list=((null==data?void 0:data.items)||[]).reverse().map((function(e){return e.img_uris=(e.img_uris||[]).filter((function(e){return null==e?void 0:e.url})),e})),e.scrollToTop(0,"instant")})).finally((function(){e.loading=!1}))},sortByField:function(e,t){var n=function(a,b){var e=a[t],n=b[t];return e<n?-1:e>n?1:0};return!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?e.sort(n):e.sort((function(a,b){return n(b,a)}))},handleScroll:function(){try{var e=this.$refs.scrollWrapper;try{if(0===e.scrollTop&&0===e.scrollHeight)return;this.showBackTopBtn=e.scrollHeight-e.scrollTop>e.clientHeight+50,window.clearTimeout(this.timer),this.timer=setTimeout(this.isScrollEnd,1500),this.last1=null==e?void 0:e.scrollTop}catch(e){}e&&e.scrollTop<=10&&this.handleLoadMore()}catch(e){}},isScrollEnd:function(){try{var e=this.$refs.scrollWrapper;this.last2=null==e?void 0:e.scrollTop,this.last2===this.last1&&(this.showScroll=!1),0===this.last2&&(this.showBackTopBtn=!1)}catch(e){}},handleLoadMore:function(){var e=this.list.length?this.list[0]:"",t=e?e.id:"",n=e?e.timestamp:"";this.top.channelId&&"PRIVATE"===this.top.channelId?this.getHistoryMessage(t):this.getHistoryChatMessage(n)},scrollToTop:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"smooth";this.$nextTick((function(){try{var o=e.$refs.scrollWrapper;if(o){var l=t?Math.abs(o.scrollHeight-t)+100:o.scrollHeight;o.scrollTo({top:l,behavior:n})}}catch(e){}}))},handleUpdateData:function(e,data){this.list.forEach((function(t){e===t.id&&Object.assign(t,data)}))},handleUpscale:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=J()(source),n={id:(t||{}).info.id};Object(A.h)(n).then((function(n){var o=n||{},l=o.status.code,code=void 0===l?"":l,r=o.data,data=void 0===r?{}:r;return[1e4,"10000"].includes(code)&&(t.info.meta=data.meta,t.info.pub_artwork_no=(null==data?void 0:data.art_work_no)||"",t.info.art_model_no=(null==data?void 0:data.art_model_no)||"",t.info.art_model_ver_no=(null==data?void 0:data.art_model_ver_no)||"",t.info.meta.prompt=t.info.local_prompt||t.info.meta.prompt,e.handleOtherOperate(t)),[1e4,"10000"].includes(code)||e.handleTaskError(code),n}))},handleTaskOperate:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.info,o=void 0===n?{}:n,l=t.type,r=void 0===l?"":l,c=t.callback;switch(r){case"taskReStart":this.handleReStartTask(o);break;case"cancelTask":this.handleCancelTask(o,c);break;case"reStart":this.handleTaskRestart(o);break;case"extraUpscale":this.handleExtraUpscale(t);break;case"U":this.handleUpscale(t);break;case"V":case"A":this.handleOtherOperate(t);break;case"advanced":this.handleAdvancedOperate(t);break;case"promptSearch":null==this||null===(e=this.top)||void 0===e||e.setTextToImagePrompt(t.prompt);break;case"deleteTask":this.handleDeleteTask(o.id);break;case"removeBackground":this.handleRemoveBackground(t)}},handleExtraUpscale:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=J()(source),n=t.info,o=void 0===n?{}:n,l=t.data,data=void 0===l?{}:l;try{o.meta.prompt=o.local_prompt||o.meta.prompt}catch(e){}var r=["mask","mask_blur","inpainting_fill","inpainting_mask_invert","inpaint_full_res","inpaint_full_res_padding","hi_res_arg","ad_units"];Object.keys(o.meta).forEach((function(e){r.includes(e)&&delete o.meta[e]}));var c=this.groupTaskOperateParams({operate_number:data.number,action:2,info:o});c.category=o.category||1,c.channel_id="PRIVATE"===this.top.channelId?"":this.top.channelId,c.meta.hi_res_arg={image:data.imageUrl,upscaler_1:"4x-UltraSharp",upscaling_resize:2},c.operate_number=data.number||1,Object(A.d)(c).then((function(t){var n=t||{},o=n.data,data=void 0===o?{}:o,l=n.status,r=(void 0===l?{}:l).code;if([1e4,"10000"].includes(void 0===r?"":r)){var c=Oe({},data);c.sender_id=e.userInfo.id,c.messageInfo={},c.messageInfo.author={id:c.sender_id,name:e.userInfo.name},e.list.push(c),e.checkNeedClearSearch(),e.$message.success(e.$t("CreateSuccess")),e.checkUpdateMessageNeedScrollToBottom();try{Object(ke.h)()}catch(e){}}else;})).finally((function(){}))},handleTaskRestart:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(console.log("处理任务重新生成--",e),[5,"5"].includes(e.type))this.$EventBus.$emit("taskUserUpscale",{action:9,url:e.banner.url});else{var t,n=e.type||1;if([13,"13"].includes(n))return n=6,void this.$EventBus.$emit("openGenerate",{action:6,data:{imageUrl:null==e||null===(t=e.banner)||void 0===t?void 0:t.url,art_work_no:e.pub_artwork_no,meta:J()(e.meta),local_prompt:(null==e?void 0:e.local_prompt)||""}});if([8,"8"].includes(n)&&(n=10),[7,"7"].includes(n)&&(n=9),[11].includes(n)&&(n=13),e&&([7,"7","studio",11].includes(e.category)||24===e.type)){var o,l=(null==e?void 0:e.pub_artwork_no)||"";return Array.isArray(null==e?void 0:e.pub_artwork_nos)&&null!=e&&null!==(o=e.pub_artwork_nos)&&void 0!==o&&o.length&&(l=null==e?void 0:e.pub_artwork_nos[0]),void this.$emit("reload",{action:n,data:{parent_task_id:e.id,id:l,local_prompt:(null==e?void 0:e.local_prompt)||""}})}this.$emit("reload",{action:n,data:{parent_task_id:e.id,id:e.pub_artwork_no,local_prompt:(null==e?void 0:e.local_prompt)||"",meta:J()(e.meta),category:e.category}})}},handleRemoveBackground:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=source.info,n=void 0===t?{}:t,o=source.imageUrl,l=void 0===o?"":o,r={action:7,art_work_no:n.pub_artwork_no,parent_task_id:n.id,category:n.category||1};r.meta=J()(n.meta);try{r.meta.prompt=n.local_prompt||n.meta.prompt}catch(e){}return r.meta.hi_res_arg&&delete r.meta.hi_res_arg,r.meta.remove_background={uri:l},r.channel_id="PRIVATE"===this.top.channelId?"":this.top.channelId,r.category=n.category||1,Object(A.d)(r).then((function(t){var n=t||{},o=n.data,data=void 0===o?{}:o,l=n.status.code;if([1e4,"10000"].includes(void 0===l?"":l)){e.list.push(data),e.$message.success(e.$t("CreateSuccess")),e.checkNeedClearSearch(),e.checkUpdateMessageNeedScrollToBottom();try{Object(ke.h)()}catch(e){}}}))},handleDeleteTask:function(e){var t=this.list.findIndex((function(t){return t.id===e}));-1!==t&&this.list.splice(t,1)},handleCopyTask:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=11===e.type?13:24==e.type?24:1;if(e&&[7,"7","studio"].includes(null==e?void 0:e.category)){var n,o=(null==e?void 0:e.pub_artwork_no)||"";return Array.isArray(null==e?void 0:e.pub_artwork_nos)&&null!=e&&null!==(n=e.pub_artwork_nos)&&void 0!==n&&n.length&&(o=null==e?void 0:e.pub_artwork_nos[0]),void this.$emit("reload",{action:t,data:{parent_task_id:e.id,id:o}})}this.$emit("reload",{action:t,data:{parent_task_id:e.id,id:e.pub_artwork_no}})},handleAdvancedOperate:function(){var source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=source.info,t=void 0===e?{}:e,n=source.btnInfo,o=void 0===n?{}:n;o&&"Make Variations"===o.btnType?this.handleOtherOperate(source):o&&"Web"===o.btnType&&(this.$router.push("/explore/detail/"+t.pub_artwork_no),this.$emit("closePopup"))},handleOtherOperate:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,source,r,c,d,h,m,v,f,_,y,w,C,k,S,x,I,O,code,T,data,$,L,P,M,j;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(source=e.length>0&&void 0!==e[0]?e[0]:{},console.log("处理超分操作,变体操作",source),r=J()(source),c=r.info,d=void 0===c?{}:c,h=r.btnInfo,m=void 0===h?{}:h,v=r.callback,d.meta.prompt=d.local_prompt||d.meta.prompt,f=-1!==m.btnType.indexOf("U")?2:-1!==m.btnType.indexOf("A")?24:3,_=["mask","mask_blur","inpainting_fill","inpainting_mask_invert","inpaint_full_res","inpaint_full_res_padding"],2===f&&_.push("hi_res_arg"),Object.keys(d.meta).forEach((function(e){_.includes(e)&&delete d.meta[e]})),null!=d&&null!==(o=d.meta)&&void 0!==o&&null!==(o=o.ad_units)&&void 0!==o&&o.length||delete d.meta.ad_units,2===f)try{d.meta.enable_hr=!1,delete d.meta.ad_units,delete d.meta.hr_upscaler,delete d.meta.hr_scale}catch(e){}if(y={action:f,parent_task_id:d.id,operate_number:m.id,meta:d.meta,art_work_no:d.pub_artwork_no,task_id:d.id,number:m.id},(w=t.groupTaskOperateParams({operate_number:m.id,action:f,info:d})).category=d.category||1,3!==f||![7,11].includes(d.category)){n.next=29;break}return S=J()(w),console.log("来啦flux！"),n.next=18,Object(A.h)({id:d.id});case 18:if(x=n.sent,O=(I=x||{}).status.code,code=void 0===O?"":O,T=I.data,data=void 0===T?{}:T,![1e4,"10000"].includes(code)||!(null!=data&&null!==(C=data.base_model_name)&&void 0!==C&&C.includes("Flux")||null!=data&&null!==(k=data.base_model_name)&&void 0!==k&&k.includes("SD 3.5"))){n.next=29;break}return S.meta=null==data?void 0:data.meta,S.pub_artwork_no=(null==data?void 0:data.art_work_no)||"",S.art_model_no=(null==data?void 0:data.art_model_no)||"",S.art_model_ver_no=(null==data?void 0:data.art_model_ver_no)||"",S.meta.prompt=S.local_prompt||S.meta.prompt,S.meta.init_images=null===($=w.meta)||void 0===$?void 0:$.init_images,t.handleStudioVariationsTask(S,d,v),n.abrupt("return");case 29:if(((null==d?void 0:d.art_model_no)===t.top.fluxModelId||[1,"1"].includes(null==d?void 0:d.sub_mode_category))&&[7,11,"studio"].includes(d.category)||3!==y.action&&24!==y.action||[3,"3"].includes(d.category)){n.next=36;break}return L={action:y.action,parent_task_id:d.id,operate_number:m.id,art_work_no:d.pub_artwork_no,meta:d.meta},24===(null==y?void 0:y.action)&&(P=d.img_uris,j=(M=void 0===P?[]:P).length?M[m.id-1].url:"",L.meta.init_images=[j]),console.log({data:L,action:y.action},"动画生成的快捷操作"),t.$emit("reload",{data:L,action:y.action}),n.abrupt("return");case 36:if(w.category=d.category||1,w.speed_type=(null===(l=t.top)||void 0===l||null===(l=l.config)||void 0===l||null===(l=l.extraUpscale)||void 0===l?void 0:l.speed_type)||(t.activeState?2:1),t.handleUpdateBtnStatus(y.task_id,m.btnType),w.channel_id="PRIVATE"===t.top.channelId?"":t.top.channelId,w.meta.prompt=w.meta.local_prompt||w.meta.prompt,2!==f||![7,11].includes(w.category)){n.next=44;break}return t.handleStudioUpscaleTask(w,d,v),n.abrupt("return");case 44:if(3!==f||![7,11].includes(w.category)){n.next=47;break}return t.handleStudioVariationsTask(w,d,v),n.abrupt("return");case 47:Object(A.d)(w).then((function(e){var n=e||{},o=n.data,data=void 0===o?{}:o,l=n.status,r=(void 0===l?{}:l).code;if([1e4,"10000"].includes(void 0===r?"":r)){v&&v(data);var c=Oe({},data);c.sender_id=t.userInfo.id,c.messageInfo={},c.messageInfo.author={id:c.sender_id,name:t.userInfo.name},t.list.push(c),t.checkNeedClearSearch(),t.updateBtnClickStatus(y),t.$message.success(t.$t("CreateSuccess")),t.checkUpdateMessageNeedScrollToBottom();try{Object(ke.h)()}catch(e){}}else;})).finally((function(){t.handleUpdateBtnStatus(y.task_id,"")}));case 48:case"end":return n.stop()}}),n)})))()},handleStudioUpscaleTask:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>2?arguments[2]:void 0,n={};["art_model_no","art_model_ver_no","channel_id","parent_task_id","meta","speed_type","source"].forEach((function(e){n[e]=source[e]})),Object(A.v)(n).then((function(o){var l=o||{},r=l.data,data=void 0===r?{}:r,c=l.status,d=(void 0===c?{}:c).code;if([1e4,"10000"].includes(void 0===d?"":d)){t&&t(data);var h=Oe({},data);h.sender_id=e.userInfo.id,h.messageInfo={},h.messageInfo.author={id:h.sender_id,name:e.userInfo.name},h.art_model_no=n.art_model_no||"",h.status=1,h.type=2,h.category=11,h.banner=null,h.img_uris=[],e.list.push(h),e.checkNeedClearSearch(),e.updateBtnClickStatus(n),e.$message.success(e.$t("CreateSuccess")),e.checkUpdateMessageNeedScrollToBottom();try{Object(ke.h)()}catch(e){}}else;})).catch((function(e){}))},handleStudioVariationsTask:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>2?arguments[2]:void 0,n={};["art_model_no","art_model_ver_no","channel_id","parent_task_id","meta","speed_type","source"].forEach((function(e){n[e]=source[e]})),Object(A.w)(n).then((function(o){var l=o||{},r=l.data,data=void 0===r?{}:r,c=l.status,d=(void 0===c?{}:c).code;if([1e4,"10000"].includes(void 0===d?"":d)){t&&t(data);var h=Oe({},data);h.sender_id=e.userInfo.id,h.messageInfo={},h.messageInfo.author={id:h.sender_id,name:e.userInfo.name},h.art_model_no=n.art_model_no||"",h.status=1,h.type=3,h.category=11,h.banner=null,h.img_uris=[],e.list.push(h),e.checkNeedClearSearch(),e.updateBtnClickStatus(n),e.$message.success(e.$t("CreateSuccess")),e.checkUpdateMessageNeedScrollToBottom();try{Object(ke.h)()}catch(e){}}else;})).catch((function(e){}))},groupTaskOperateParams:function(){var e,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=source.operate_number,n=void 0===t?1:t,o=source.action,l=void 0===o?1:o,r=source.info,c=void 0===r?{}:r,d={};d.action=l,d.operate_number=n,d.art_work_no=c.pub_artwork_no,d.art_model_no=(null==c?void 0:c.art_model_no)||"",d.art_model_ver_no=(null==c?void 0:c.art_model_ver_no)||"",d.parent_task_id=c.id,d.meta=c.meta;var h=c.img_uris,m=void 0===h?[]:h,v=(null==c||null===(e=c.banner)||void 0===e?void 0:e.url)||"",f=m.length?m[n-1].url:"";if(3===l){var _=d.meta.controlnet_units&&d.meta.controlnet_units.length?J()(d.meta.controlnet_units[0]):{},y={input_image:f||"",model:"canny",module:"control_sd15_canny [fef5e48e]"};_&&(_.model||_.module)?(y=Object.assign({},_,y),d.meta.controlnet_units=[y],d.meta.init_images=[],d.meta.script_args=[],d.meta.script_name="",d.meta.denoising_strength=0):(d.meta.init_images=[f],d.meta.controlnet_units=[])}return 2===l&&(d.meta.init_images=m.length?[f]:[v],d.meta.controlnet_units=[]),d},handleReStartTask:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id,n={action:4,task_id:void 0===t?"":t};this.handleUpdateBtnStatus(n.task_id,"reStart"),Object(A.r)(n).then((function(t){var n=(t||{}).status,o=(void 0===n?{}:n).code,code=void 0===o?"":o;if([1e4,"10000"].includes(code)){var l=(t.data||{}).new_task,r=void 0===l?null:l;return-1!==e.list.findIndex((function(e){return e.id===r.id}))?e.list.forEach((function(e){r&&e.id===r.id&&Object.assign(e,r)})):e.list.unshift(r),void e.checkNeedClearSearch()}[1e4,"10000"].includes(code)||e.handleTaskError(code)})).finally((function(){e.handleUpdateBtnStatus(n.task_id,"")}))},handleCancelTask:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;console.log("取消任务");var o=t.id,l=void 0===o?"":o,r={action:5,task_id:l};this.handleUpdateCancelBtnStatus(l,!0),Object(A.r)(r).then((function(t){e.$message.warning(e.$t("cancelJobSuccess"));var o=(t||{}).status,r=(void 0===o?{}:o).code,code=void 0===r?"":r;if(n&&n(),[1e4,"10000"].includes(code)){var c=e.list.findIndex((function(e){return e.id===l}));-1!==c&&e.list.splice(c,1)}else[1e4,"10000"].includes(code)||e.handleTaskError(code)})).finally((function(){e.handleUpdateCancelBtnStatus(l,!1)}))},handleUpdateBtnStatus:function(e,t){var n=this;this.list.forEach((function(o){o.id===e&&n.$set(o,"loadingBtn",t)}))},handleUpdateCancelBtnStatus:function(e,t){var n=this;this.list.forEach((function(o){o.id===e&&n.$set(o,"isLoading",t)}))},updateBtnClickStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.action,n=e.task_id,o=e.number;this.list.forEach((function(e){if(e.id===n){var l={action:t,number:o};-1===(e.operation||[]).findIndex((function(e){return e.action===t&&o===e.number}))&&(!Array.isArray(e.operation)||e.operation.push(l))}}))},updateMessageList:function(e){this.checkNeedClearSearch();var t=this.list.findIndex((function(t){return e.id===t.id})),n=Oe({},e);n.sender_id=this.userInfo.id,n.messageInfo={},n.messageInfo.author={id:n.sender_id,name:this.userInfo.name},-1===t&&this.list.push(n),this.checkUpdateMessageNeedScrollToBottom()},checkNeedClearSearch:function(){"PRIVATE"!==this.top.channelId||["",null,void 0].includes(this.keyword)||this.$EventBus.$emit("clearTaskSearch")},initWebSocketService:function(){var e=this;if(Object(ye.l)()){var t=Object(xe.t)();this.webSocketService=new Se.a(t,(function(){e.list.length&&e.getLastChatMessage()}),this.handleWebsocketMessage)}},handleWebsocketMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$EventBus.$emit("chatMessage",e),this.checkNeedDropMessage(),e&&[5,"5"].includes(e.type)?this.handleMessageError(e):e&&[8,"8"].includes(e.type)?this.handleDeleteTaskMessage(e):this.top.channelId==e.channel_id&&this.handleChannelMessage(e)},checkNeedDropMessage:function(){try{this.list.length>=2e3&&(this.list=this.list.slice(Math.ceil(this.list.length/2)))}catch(e){}},checkHasDeleteMessage:function(){var e=this;this.list.forEach((function(t){var n,o=null==t||null===(n=t.messageInfo)||void 0===n?void 0:n.type;t&&[8,"8"].includes(o)&&e.handleDeleteTaskMessage(t.messageInfo)}))},handleMessageError:function(){var e=this;[20002,20003,20004,"20002","20003","20004"].includes((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).error_code)?this.$store.dispatch("user/logout").then((function(){e.$router.replace({path:"/home",query:{openLoginDialog:"1"}})})):this.webSocketService.reconnectWebSocket(!0)},handleDeleteTaskMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.message_id,e.channel_id),n=void 0===t?"":t,o=(e.components,e.related_message_id),l=void 0===o?"":o;if(n===this.top.channelId){var r=this.list.findIndex((function(e){return e.message_id===l}));-1!==r&&this.list.splice(r,1)}},handleChannelMessage:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("PRIVATE"!==this.top.channelId){var n=t.components,o=void 0===n?[]:n,l=t.message_id,r=t.sender_id,c=t.timestamp,d=o.filter((function(e){return[1,"1"].includes(e.type)})).map((function(e){return e.custom_id}));d.length&&Object(A.b)({ids:d}).then((function(n){(n.data.items||[]).map((function(e){var n=Oe({},e);return n.message_id=l,n.timestamp=c,n.sender_id=r,n.messageInfo=t,n})).forEach((function(t){var n=e.list.find((function(e){return e.id===t.id||e.message_id===t.message_id}));n?Object.assign(n,t):e.list.push(t)}))})).finally((function(){}))}},closeWebsocket:function(){this.webSocketService.close(),this.webSocketService.destroy(),this.webSocketService=null},getHistoryChatMessage:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.loading)return Promise.resolve();var n={page_size:50};return t&&(n.time_from=t),n.channel_id=this.top.channelId,this.loading=!0,Object(A.g)(n).then((function(t){if(n.channel_id!==e.top.channelId)return t;var o=t&&t.data?t.data:{},l=o.items,r=void 0===l?[]:l;o.has_more;if(n.time_from){var c,d,h=Object(B.e)(e.list,r||[],"message_id");h=(h=(h=e.sortByField(h,"timestamp",!0)).map((function(e){var t,n={};if(e&&null!=e&&null!==(t=e.components)&&void 0!==t&&t.length){var o=e.components.find((function(e){return 1===e.type}));n=o?Oe({},o.task_resource):{}}return n.message_id=e.message_id,n.timestamp=e.timestamp,n.sender_id=e.sender_id,n.messageInfo=e,n})).filter((function(e){return!["userCancelDesc"].includes(e.status_desc)}))).map((function(e){return e.img_uris=(e.img_uris||[]).filter((function(e){return null==e?void 0:e.url})),e}));var m=null===(c=e.$refs)||void 0===c||null===(c=c.scrollWrapper)||void 0===c?void 0:c.scrollHeight;(d=e.list).unshift.apply(d,Object(R.a)(h)),m&&h.filter((function(e){return e.id})).length&&e.scrollToTop(m,"instant")}else e.list=(r||[]).map((function(e){var t,n={};if(e&&null!=e&&null!==(t=e.components)&&void 0!==t&&t.length){var o=e.components.find((function(e){return 1===e.type}));n=o?Oe({},o.task_resource):{}}return n.img_uris=(n.img_uris||[]).filter((function(e){return null==e?void 0:e.url})),n.message_id=e.message_id,n.timestamp=e.timestamp,n.sender_id=e.sender_id,n.messageInfo=e,n})).filter((function(e){return!["userCancelDesc"].includes(e.status_desc)})).reverse(),e.scrollToTop(0,"instant");e.checkHasDeleteMessage()})).finally((function(){e.loading=!1}))},handleChannelChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.list=[],this.keyword="";try{this.webSocketService.reconnectWebSocket()}catch(e){}e&&"PRIVATE"===e?this.getHistoryMessage():this.getHistoryChatMessage()},getLastChatMessage:function(){var e=this;if("PRIVATE"!==this.top.channelId){var t={page_size:100},n=this.list.length?this.list[this.list.length-1]:"",o=n?n.timestamp:"";return o&&(t.time_from=o),t.channel_id=this.top.channelId,t.order_by="asc",this.loading=!0,Object(A.g)(t).then((function(n){if(t.channel_id!==e.top.channelId)return n;var o=n&&n.data?n.data:{},l=o.items,r=void 0===l?[]:l,c=o.has_more,d=void 0!==c&&c;if(t.time_from){var h,m=Object(B.e)(e.list,r||[],"message_id");(m=(m=e.sortByField(m,"timestamp",!0)).map((function(e){var t,n={};if(e&&null!=e&&null!==(t=e.components)&&void 0!==t&&t.length){var o=e.components.find((function(e){return 1===e.type}));n=o?Oe({},o.task_resource):{}}return n.message_id=e.message_id,n.timestamp=e.timestamp,n.sender_id=e.sender_id,n.messageInfo=e,n})).filter((function(e){return!["userCancelDesc"].includes(e.status_desc)}))).length&&(h=e.list).push.apply(h,Object(R.a)(m)),e.checkHasDeleteMessage(),d&&m.length&&e.getLastChatMessage()}})).finally((function(){e.loading=!1}))}}})},$e=Te,Le=(n(2988),Object(y.a)($e,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"c-task-view"},[t("div",{ref:"scrollContainer",staticClass:"message-list"},[t("div",{staticClass:"messages-wrapper"},[t("div",{ref:"scrollWrapper",staticClass:"scroll-wrapper",class:[e.showScroll?"":"show-scroll-bar"],on:{scroll:e.debounceHandleScroll}},[e._l(e.list,(function(n){return[n.id&&e.showMessage(n)?t("msg-item",{key:n.id||n.message_id,attrs:{message:n,"task-from":""},on:{operate:e.handleTaskOperate,copyGenerationData:e.handleCopyTask,updateData:e.handleUpdateData}}):e._e()]})),e._v(" "),e.keyword||!e.showNoDataContent||e.loading||e.list.length?e._e():[t("div",{staticClass:"no-data-content"},[t("div",{staticClass:"no-data-content-normal"},[e._v(e._s(e.$t("Hello")))]),e._v(" "),t("div",{staticClass:"no-data-content-normal"},[e._v(e._s(e.$t("GoMakeFirstPicture")))]),e._v(" "),t("div",{staticClass:"no-data-content-text"},[e._m(0),e._v(" "),t("span",[e._v(e._s(e.$t("ClickIt"))+" !")])])])]],2)])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.checkIsShowBackTopBtn,expression:"checkIsShowBackTopBtn"}],staticClass:"generate-view-back-top",class:[e.checkIsShowViewNsfw?"":"generate-view-back-top-only"],on:{click:function(t){return e.scrollToTop(0)}}},[t("i",{staticClass:"el-icon-caret-bottom"})]),e._v(" "),e.checkIsShowViewNsfw?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.enableNsfwMode?e.$t("hideAdultContent"):e.$t("showAdultContent"),placement:"left"}},[t("div",{staticClass:"generate-view-nsfw-plus",on:{click:e.settingViewNsfw}},[t("i",{staticClass:"iconfont",class:e.enableNsfwMode?"icon-work-hide":"icon-work-show"})])]):e._e(),e._v(" "),t("auditDialog",{ref:"auditDialog",on:{confirm:e.applyNsfw}})],1)}),[function(){var e=this._self._c;return e("span",[e("i",{staticClass:"iconfont icon-hand-down-icon"})])}],!1,null,"13dc676a",null).exports),Pe=(n(50),n(48),n(112),n(2989));function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var De={inject:["top"],props:["value"],data:function(){return{inputSize:{minRows:1,maxRows:8},hidePromptMenu:["extraUpscale","descriptors"],isRequest:!1,EventSourceServer:null,isLoading:!1}},watch:{"top.menuIndex":function(e){this.isRequest&&this.disConnectEventSourceServer()}},computed:je(je(je(je(je({},Object(S.e)("payment",["paymentInfo"])),Object(S.c)("creation",["size_billing_rule"])),Object(S.e)("user",["userInfo"])),Object(S.c)("user",["isCompanyAccount"])),{},{isStudioMode:function(){var e;return["textToImage","imageToImage","conditionToImage"].includes(this.top.menuIndex)&&[7,"studio",11].includes(null===(e=this.top.config[this.top.menuIndex])||void 0===e?void 0:e.category)},isStudioFlux:function(){var e,t,n=null===(e=this.top)||void 0===e?void 0:e.fluxModelId,o=this.value.base_model_type,l=((null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[]).includes(o);return(this.value.art_model_no===n||l||(null===(t=this.value)||void 0===t||null===(t=t.base_model_type)||void 0===t?void 0:t.includes("Flux")))&&["textToImage"].includes(this.top.menuIndex)&&this.isStudioMode},computedPhysicalExertion:function(){var e,t,n,o,l,r=this,c=this.size_billing_rule.baselines||[],d=this.size_billing_rule.extra_rule||[],h=this.size_billing_rule.face_restoration||[],m=(null===(e=this.size_billing_rule)||void 0===e?void 0:e.imt_to_img_baselines)||[],v=(null===(t=this.size_billing_rule)||void 0===t?void 0:t.lab_billing_rule)||{},f=1,_=Math.max(this.value.width,this.value.height);this.isStudioMode&&(_=Math.max(this.value.studio.width,this.value.studio.height)),(c||[]).forEach((function(e){_>e.min&&_<=e.max&&(f=e.value)})),["conditionToImage","imageToImage"].includes(this.top.menuIndex)&&(m||[]).forEach((function(e){_>e.min&&_<=e.max&&(f=e.value)}));var y=1,w=this.isStudioMode?7:this.value.category;(d||[]).forEach((function(e){e.task_action===r.value.action&&e.task_category===w&&(y=e.value||1)}));var C=0,k=(null===(n=this.value)||void 0===n?void 0:n.agency_fee)||0;(this.value.lora_models||[]).forEach((function(e){e&&e.agency_fee>0&&(C+=e.agency_fee)}));var S=null;S=5===w?6*(this.value.n_iter||1):f*y*(this.value.n_iter||1),1===this.value.lcm_mode&&(S*=.5);var x,I=S;if([4,5,7].includes(w)||(I=S+C+k),this.value.enable_hr&&""!==this.value.hr_upscaler&&"textToImage"==this.top.menuIndex&&[1,"1"].includes(w)){var O,T=this.value.hr_scale||6,$=this.value.width*T,L=this.value.height*T,P=1,M=(null===(O=this.size_billing_rule)||void 0===O?void 0:O.hd)||[],j=Math.max($,L);(M||[]).forEach((function(e){j>e.min&&j<=e.max&&(P=e.value)}));var D=1;(d||[]).forEach((function(e){2===e.task_action&&e.task_category===w&&(D=e.value||1)})),I+=P*D*(this.value.n_iter||1)}if(!["",null,void 0].includes(this.value.ad_model)&&["textToImage","imageToImage"].includes(this.top.menuIndex)&&![7,"7",5,"5","sdxl","studio"].includes(w)){var N=0;(h||[]).forEach((function(e){_>e.min&&_<=e.max&&(N=e.value||0)})),I+=N*(this.value.n_iter||1)}"expansion"===this.top.menuIndex&&(I=null!==(x=this.value)&&void 0!==x&&x.imageUrl[0]?this.setExpansionExpend:0);if(7===w){var E,R,A,B={conditionToImage:"contrlnet_to_img",textToImage:"text_to_img",imageToImage:"img_to_img"}[this.top.menuIndex]||"",U=B&&v[B]||6,F=0;if([1,2].includes(null===(E=this.value)||void 0===E||null===(E=E.lab_base)||void 0===E?void 0:E.quality_mode)&&"textToImage"===this.top.menuIndex){var z,V=this.calculateQuantity(this.value.n_iter||1);[2].includes(null===(z=this.value)||void 0===z||null===(z=z.lab_base)||void 0===z?void 0:z.quality_mode)&&(V=this.value.n_iter||1),F=((this.value.lab_base.intelligence_open?1:0)+2)*V}if(I=U*(this.value.n_iter||1)+F,this.isStudioFlux)I=(U=!(null===(R=this.value)||void 0===R||null===(R=R.ipList)||void 0===R||!R.length||null!==(A=this.value)&&void 0!==A&&null!==(A=A.lora_models)&&void 0!==A&&A.length)?18:6)*(this.value.n_iter||1)}return 3===this.value.speed_type&&(I=0),7===w&&(null!==(o=this.value)&&void 0!==o&&o.base_model_type.includes("SD 3.5")||null!==(l=this.value)&&void 0!==l&&l.base_model_type.includes("Flux"))&&(I=8*this.value.n_iter),I},setExpansionExpend:function(){var e=6,t=Math.max(this.value.width,this.value.height);return[{min:0,max:512,value:6},{min:512,max:768,value:8},{min:768,max:1024,value:10},{min:1024,max:1280,value:14},{min:1280,max:1480,value:18},{min:1480,max:1536,value:24}].forEach((function(n){t>n.min&&t<=n.max&&(e=n.value||6)})),e*{1:1,2:1.5,3:2,4:2.5}[this.value.n_iter]},isShowBeautify:function(){var e=this.value.prompt;return e&&e.length<200},showPlaceholder:function(){var e,t="WhatDoUWantToCreate",n=this.value,mask=n.mask,o=n.controlnet_units,l=n.category;[5,"5","sdxl"].includes(l);"imageToImage"!==this.top.menuIndex||["",null,void 0].includes(mask)||/^(http|https):\/\//.test(mask)||0!==o.length||(t="TaskImage2ImagePlaceholder"),"expansion"===this.top.menuIndex&&this.value.isDrag&&(t="ExpansionPromptPlaceholder");var r=((null===(e=this.value)||void 0===e||null===(e=e.lab_base)||void 0===e?void 0:e.conds)||[]).map((function(e){return e.mode})).filter((function(e){return["ImagePrompt"].includes(e)}));return!this.isStudioFlux&&"textToImage"===this.top.menuIndex&&[7,11,"studio"].includes(l)&&r.length&&(t="studio22"),t},localText:function(){var e=this.top.randomPrompt;return e.length?e:""}}),methods:{calculateQuantity:function(e){return 1===e?0:e%2==0&&0!==e?e/2:e>1&&e%2!=0?Math.floor(e/2):0},goTutorial:function(){var link="https://docs.seaart.ai/guide-1";"ja"===this.$i18n.locale&&(link="https://docs.seaart.ai/guide-1/ri-ben-yu"),this.$logEvent("log_actions",{operation:"click_video_course",behavior_info:link}),window.open(link,"_blank")},setPrompt:function(){var e=JSON.parse(JSON.stringify(this.value)),text=this.top.randomPrompt;if(text.length){text=text.replace(/--V6|--v6/g,""),e.prompt=text,this.setConfig(e)}},changeRandom:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.$logEvent("log_actions",{operation:"click_dice_to_text",behavior_info:"task"}),e.isLoading=!0,t.prev=2,t.next=5,e.top.getRandomPrompt();case 5:e.isLoading=!1,t.next=12;break;case 8:t.prev=8,t.t0=t.catch(2),e.isLoading=!1,console.log("error",t.t0);case 12:case"end":return t.stop()}}),t,null,[[2,8]])})))()},changePrompt:function(){var e=this.value,t=e.prompt,n=e.local_prompt,o=JSON.parse(JSON.stringify(this.value)),l=t;o.prompt=n,o.local_prompt=l,this.setConfig(o)},setConfig:function(e){this.$emit("input",e)},changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));n[t]=e,this.value.isTranslate&&(n.isTranslate=!1),this.$emit("input",n)},generate:function(){var e,t,n,o=null===(e=this.value)||void 0===e?void 0:e.lora_models.length,l=(null===(t=this.value)||void 0===t||null===(t=t.lora_models)||void 0===t?void 0:t.some((function(e){var t;return null===(t=e.base_model)||void 0===t?void 0:t.includes("Flux")})))||!1,r=(null===(n=this.value)||void 0===n||null===(n=n.base_model_type)||void 0===n?void 0:n.includes("Flux"))||!1;if(o){if(l&&!r)return void this.$message.warning(this.$t("modelMismatchingTip"));if(r&&!l)return void this.$message.warning(this.$t("modelMismatchingTip"))}this.top.generate()},handleKeyCode:function(e){if(13==e.keyCode)if(e.metaKey||e.altKey){var t=this.value.prompt,n=document.querySelector("#generateInput"),o=n.selectionStart,l=n.selectionEnd,r=t.slice(0,o)+"\n"+t.slice(l);n.focus(),setTimeout((function(){n.setSelectionRange(o+1,o+1),n.focus()}),10),this.changeConfig(r,"prompt")}else e.preventDefault(),this.generate()},wordOptimization:function(){var e=this.value.prompt,t={prompt:e};this.isRequest||""===e||(this.isRequest=!0,this.openConnectServer(t))},openConnectServer:function(e){var t=this,n=window.location.origin+"/api/v1/task/prompt-render",o=new URLSearchParams(e).toString(),l="".concat(n,"?").concat(o),r=this.$cookies.get("lang")||navigator.language||navigator.browserLanguage,c={headers:{token:Object(ye.l)(),"Accept-Language":r}};this.EventSourceServer=new Pe.EventSourcePolyfill(l,c),this.EventSourceServer.addEventListener("message",this.handleMessage),this.EventSourceServer.addEventListener("error",this.handleMessageError),this.EventSourceServer.addEventListener("open",(function(){t.isRequest=!0}))},handleMessage:function(e){var t,n,o=JSON.parse(e.data),code=null==o||null===(t=o.status)||void 0===t?void 0:t.code,l=null==o||null===(n=o.data)||void 0===n?void 0:n.prompt;[1e4,"10000"].includes(code)?this.disConnectEventSourceServer():[70005,"70005"].includes(code)?this.changeConfig(l,"prompt"):(this.handlePromptErrorMessage(code),this.disConnectEventSourceServer())},handleMessageError:function(e){e.eventPhase===EventSource.CLOSED&&(this.isRequest=!1),this.disConnectEventSourceServer()},disConnectEventSourceServer:function(){this.EventSourceServer&&(this.EventSourceServer.close(),this.EventSourceServer=null),this.isRequest=!1},handlePromptErrorMessage:function(){var code=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e={70006:this.$t("taskPromptGenerateExecuting"),70017:this.$t("taskPromptGenerateLimit"),70020:this.$t("taskPromptGenerateViolate")};e[code]&&this.$message.error(e[code])}},beforeDestroy:function(){this.disConnectEventSourceServer()}},Ne=De,Ee=(n(2990),Object(y.a)(Ne,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.value.generateing||e.isRequest,expression:"value.generateing || isRequest"}],staticClass:"generate-prompt custom-form"},[t("el-input",{attrs:{type:"textarea",value:e.value.prompt,placeholder:e.$t(e.showPlaceholder),autosize:e.inputSize,resize:"none",maxlength:"2000",id:"generateInput"},on:{input:function(t){return e.changeConfig(t,"prompt")}},nativeOn:{keydown:function(t){return e.handleKeyCode(t)}}}),e._v(" "),e.isCompanyAccount?e._e():t("div",{staticClass:"physical-exertion-text",class:[e.isShowBeautify||e.value.isTranslate?"physical-exertion-text-2":""]},[e._v("\n    "+e._s(e.$t("PhysicalExertion"))+" : "+e._s(e.computedPhysicalExertion)+"\n  ")]),e._v(" "),t("svg-icon",{directives:[{name:"show",rawName:"v-show",value:e.isShowBeautify,expression:"isShowBeautify"}],staticClass:"tools-svg custom-iconfont-box",attrs:{"icon-class":"mofabang"},on:{click:e.wordOptimization}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.value.isTranslate,expression:"value.isTranslate"}],staticClass:"custom-iconfont-box"},[t("i",{staticClass:"iconfont icon-i18n_prompt tools-translate",on:{click:e.changePrompt}})]),e._v(" "),t("div",{staticClass:"custom-iconfont-box"},[t("i",{staticClass:"iconfont icon-send1 generate-btn",on:{click:e.generate}})]),e._v(" "),t("div",{staticClass:"random-prompt"},[t("i",{staticClass:"iconfont icon-dice-square",class:{loading:e.isLoading},on:{click:e.changeRandom}}),e._v(" "),t("span",{on:{click:e.setPrompt}},[e._v(e._s(e.isLoading?e.$t("Loading")+"...":e.localText))])]),e._v(" "),t("el-tooltip",{attrs:{effect:"dark",content:e.$t("newTutorial"),placement:"left"}},[t("div",{staticClass:"tutorial",on:{click:e.goTutorial}},[t("i",{staticClass:"iconfont icon-tutorial"})])])],1)}),[],!1,null,"97d4cf34",null).exports),Re=(n(70),n(237),n(238),n(239),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(107)),Ae=n(151),Be=n(41),Ue=n(128);function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ve={props:["value"],components:{SliderItem:Re.a,StyleModal:Ae.a},inject:["top"],data:function(){return{autosize:{minRows:5,maxRows:10},selectIds:[],selectModelType:"TextualInversion",modelDetailTrainedWords:[]}},computed:ze(ze({},Object(S.c)("creation",["taskSamplerMethods","taskVae","sd_xl_sampler_name","lab_scheduler","lab_sampler_name"])),{},{isShowSteps:function(){var e;return"expansion"!==this.top.menuIndex&&!this.isStudioFlux||(null===(e=this.value)||void 0===e?void 0:e.base_model_type.includes("Flux"))},seedOptions:function(){var e={max:4294967294};return this.isStudioFlux&&(e.max=2147483643),e},enableEmbedding:function(){return[1,"1",5,"sdxl"].includes(this.value.category)},showEmbeddings:function(){var e;return(null===(e=this.value)||void 0===e||null===(e=e.embeddings)||void 0===e?void 0:e.length)<8},getTriggerWords:function(){var e,t=((null===(e=this.value)||void 0===e?void 0:e.embeddings)||[]).reduce((function(pre,e){return pre.push.apply(pre,Object(R.a)((null==e?void 0:e.trained_words)||[])),pre}),[]);return Object(R.a)(new Set(t))},isSD3:function(){var e;return"SD 3"===(null===(e=this.value)||void 0===e?void 0:e.base_model_type)},schedulerDisabled:function(){var e,t=["textToImage"].includes(this.top.menuIndex)&&[1,2].includes(null===(e=this.value)||void 0===e||null===(e=e.lab_base)||void 0===e?void 0:e.quality_mode),n=this.isStudioMode&&this.isSD3;return t||n},isSdModel:function(){return!["5",5].includes(this.value.category)},isStudioMode:function(){return["textToImage","imageToImage","conditionToImage"].includes(this.top.menuIndex)&&[7,"studio",11].includes(this.value.category)},isStudioFlux:function(){var e,t,n=this.top.fluxModelId,o=((null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[]).includes(null===(e=this.value)||void 0===e?void 0:e.base_model_type);return(this.value.art_model_no===n||o||(null===(t=this.value)||void 0===t||null===(t=t.base_model_type)||void 0===t?void 0:t.includes("Flux")))&&["textToImage"].includes(this.top.menuIndex)&&this.isStudioMode},renderTaskSamplerMethods:function(){return["5",5].includes(this.value.category)?this.sd_xl_sampler_name:this.taskSamplerMethods},renderTaskScheduler:function(){return this.lab_scheduler},renderStudioSampler:function(){return this.lab_sampler_name},handleVaeList:function(){return 5!==this.value.category?this.taskVae.filter((function(e){return"sdxl_vae"!==e})):this.taskVae.filter((function(e){return"None"===e||"sdxl_vae"===e}))},renderStepsOptions:function(){var e,t,n={min:10,max:40};return this.value.lcm_mode&&(n.min=4,n.max=8),["5",5].includes(this.value.category)&&!this.value.lcm_mode&&(n.min=20),[7,"7"].includes(this.value.category)&&(n.min=25,n.max=50),null!==(e=this.value)&&void 0!==e&&e.base_model_type.includes("Flux")&&(n.min=4,n.max=25),null!==(t=this.value)&&void 0!==t&&t.base_model_type.includes("SD 3.5")&&(n.min=6,n.max=25),n},renderCFGScale:function(){var e={min:3,max:15};return this.value.lcm_mode&&(e.min=1,e.max=3),[7,"7"].includes(this.value.category)&&(e.min=2,e.max=15),e},showCustomSeed:function(){var e,t,n;return!!["imageToImage","conditionToImage"].includes(null===(e=this.top)||void 0===e?void 0:e.menuIndex)||("textToImage"===(null===(t=this.top)||void 0===t?void 0:t.menuIndex)?["normal","sdxl","studio"].includes(null===(n=this.top)||void 0===n?void 0:n.creativeMode):void 0)},seedPlsHd:function(){var e;return this.showCustomSeed&&"custom"===(null===(e=this.value)||void 0===e?void 0:e.seedMode)?this.$t("customSeed"):this.$t("RandomSeed")},showImgSeed:function(){return this.value.seedTemp&&this.value.seed!==this.value.seedTemp},showImgSeedsdxl:function(){return this.value.seedTempsdxl&&this.value.seedsdxl!==this.value.seedTempsdxl},notSdxl:function(){var e,t;return"textToImage"!==(null===(e=this.top)||void 0===e?void 0:e.menuIndex)||"sdxl"!==(null===(t=this.top)||void 0===t?void 0:t.creativeMode)}}),methods:{openModelModal:function(){var e;this.selectIds=this.value.embeddings,(null==this||null===(e=this.selectIds)||void 0===e?void 0:e.length)>=8?this.$message.warning(this.$t("embedding6",{num:8})):this.$refs.styleModal.openModal()},handleSelectModel:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=JSON.parse(JSON.stringify(t.value)),((null==o?void 0:o.embeddings)||[]).some((function(t){return t&&(null==t?void 0:t.id)===(null==e?void 0:e.id)&&(null==t?void 0:t.model_ver_no)===(null==e?void 0:e.model_ver_no)}))){n.next=6;break}return n.next=5,t.getModelDetail(null==e?void 0:e.id,null==e?void 0:e.model_ver_no);case 5:t.value.embeddings.push(ze(ze({},e),{},{trained_words:Object(R.a)(t.modelDetailTrainedWords)}));case 6:t.$refs.styleModal.handleClose();case 7:case"end":return n.stop()}}),n)})))()},getModelDetail:function(){var e=this,t={id:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",version_id:arguments.length>1&&void 0!==arguments[1]?arguments[1]:""};return Object(Be.F)(t).then((function(t){var n;if(!t||1e4===(null==t||null===(n=t.status)||void 0===n?void 0:n.code)){var o=(t&&null!=t&&t.data?null==t?void 0:t.data:{}).trained_words,l=void 0===o?[]:o;e.modelDetailTrainedWords=Array.isArray(l)?l:[]}})).finally((function(){}))},handleDeleteModel:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=((null===(e=this.value)||void 0===e?void 0:e.embeddings)||[]).findIndex((function(e){return e.id===(null==n?void 0:n.id)&&(null==n?void 0:n.model_ver_no)===(null==e?void 0:e.model_ver_no)}));-1!==o&&(null===(t=this.value)||void 0===t||null===(t=t.embeddings)||void 0===t||t.splice(o,1))},handleCopyAll:function(){var content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,text=this.getTriggerWords.join(", ");2===e&&(text=content),Object(k.d)(text),this.$message.success(this.$t("CopySuccess"))},changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));["auto_adjust_open","auto_adjust_strength","semantics_open","sharpness","scheduler","film_turbo"].includes(t)?n.lab_base[t]=e:n[t]=e,this.$emit("input",n)},checkNotAllowClick:function(){var e;this.isStudioMode&&[1,2].includes(null===(e=this.value)||void 0===e||null===(e=e.lab_base)||void 0===e?void 0:e.quality_mode)&&this.$message.warning(this.$t("studio44"))},changeConfigs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e);if(null!=t&&t.length){var n=JSON.parse(JSON.stringify(this.value));t.forEach((function(t){n[t]=e[t]})),this.$emit("input",n)}},changeLCM:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.$logEvent("log_actions",{operation:"click_lcm",behavior_info:"on_create_work"});var t=["5",5].includes(this.value.category);if(e){console.log("isSdMode",t);var n=t?8:4,o=t?2:1.5;this.changeConfigs({steps:n,cfg_scale:o,sampler_name:"LCM",lcm_mode:1})}else{var l=t?30:20;this.changeConfigs({steps:l,cfg_scale:7,sampler_name:"DPM++2M Karras",lcm_mode:0})}},changeSamplerName:function(e){if("LCM"===e)this.changeLCM(1);else{var t=["5",5].includes(this.value.category)?30:20;this.changeConfigs({steps:t,cfg_scale:7,sampler_name:e,lcm_mode:0})}},changeSeed:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"custom",t=arguments.length>1?arguments[1]:void 0,n=JSON.parse(JSON.stringify(this.value)),o=this.notSdxl?"seed":"seedsdxl",l=this.notSdxl?"seedMode":"seedModesdxl";this.value[l]&&this.value[l]!==e&&(n[o]="custom"===e?Object(B.c)(this.isStudioFlux):-1),t&&(n[o]=t),n[l]=e,this.$emit("input",n)},useSeed:function(e){-1!==e&&this.changeSeed("custom",e)}}},We=Ve,He=(n(2991),n(2992),Object(y.a)(We,(function(){var e,t,n,o,l,r,c,d,h,m,v,f,_=this,y=_._self._c;return y("div",{staticClass:"generate-advanced handle-item"},[y("div",{staticClass:"item-head",on:{click:function(e){return _.changeConfig(!_.value.advancedZoom,"advancedZoom")}}},[y("label",[y("i",{staticClass:"iconfont icon-gaojishezhi"}),_._v("\n        "+_._s(_.$t("AdvancedConfig"))+"\n      ")]),_._v(" "),y("i",{staticClass:"el-icon-caret-bottom",class:{zoom:_.value.advancedZoom}})]),_._v(" "),y("div",{directives:[{name:"show",rawName:"v-show",value:_.value.advancedZoom,expression:"value.advancedZoom"}],staticClass:"item-content"},[y("div",{directives:[{name:"show",rawName:"v-show",value:!(_.isStudioFlux||null!==(e=this.top)&&void 0!==e&&e.isStudioSD35Mode),expression:"!isStudioFlux && !this.top?.isStudioSD35Mode"}],staticClass:"h-item"},[y("label",[_._v(_._s(_.$t("NegativePrompts")))]),_._v(" "),y("el-input",{attrs:{type:"textarea",value:5===_.value.category?_.value.negative_prompt_sdxl:_.value.negative_prompt,placeholder:"",autosize:_.autosize,resize:"none",maxlength:"2000"},on:{input:function(e){return _.changeConfig(e,5===_.value.category?"negative_prompt_sdxl":"negative_prompt")}}})],1),_._v(" "),_.enableEmbedding?[y("div",{staticClass:"h-item h-item-embeding"},[y("div",{staticClass:"item-head",on:{click:function(e){return e.stopPropagation(),_.openModelModal()}}},[y("label",[_._v("\n              "+_._s(_.$t("embedding1"))+"\n              "),y("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:_.$t("embedding2"),placement:"top-start"}},[y("span",{staticClass:"el-icon-warning custom-tips custom-tips-show"})])],1),_._v(" "),y("i",{directives:[{name:"show",rawName:"v-show",value:_.showEmbeddings,expression:"showEmbeddings"}],staticClass:"el-icon-circle-plus",on:{click:function(e){return e.stopPropagation(),_.openModelModal()}}})]),_._v(" "),y("div",{directives:[{name:"show",rawName:"v-show",value:null===(t=_.value)||void 0===t||null===(t=t.embeddings)||void 0===t?void 0:t.length,expression:"value?.embeddings?.length"}],staticClass:"embeding-box"},_._l(_.value.embeddings,(function(e){return y("div",{staticClass:"embeding-box-item"},[y("div",{staticClass:"embeding-box-item-title",attrs:{title:null==e?void 0:e.name}},[_._v(_._s(null==e?void 0:e.name))]),_._v(" "),y("div",{staticClass:"embeding-box-info"},[y("span",{staticClass:"embeding-box-info-vesion",attrs:{title:null==e?void 0:e.version_name}},[_._v(_._s(null==e?void 0:e.version_name))]),_._v(" "),y("i",{staticClass:"el-icon-delete",on:{click:function(t){return t.stopPropagation(),_.handleDeleteModel(e)}}})])])})),0)]),_._v(" "),null!==(n=_.getTriggerWords)&&void 0!==n&&n.length?y("div",{staticClass:"h-item h-item-embeding"},[y("div",{staticClass:"item-head"},[y("label",[_._v(_._s(_.$t("TriggerWords")))]),_._v(" "),y("span",{staticClass:"item-head-icon",on:{click:function(e){return _.handleCopyAll()}}},[_._v(_._s(_.$t("embedding4"))),y("i",{staticClass:"iconfont icon-copy-ops"})])]),_._v(" "),y("div",{staticClass:"trigger-words"},_._l(_.getTriggerWords,(function(e){return y("div",{staticClass:"trigger-words-item"},[y("span",{staticClass:"trigger-words-item-text",attrs:{title:e}},[_._v(_._s(e))]),_._v(" "),y("i",{staticClass:"iconfont icon-copy-ops trigger-words-item-icon",on:{click:function(t){return _.handleCopyAll(e,2)}}})])})),0)]):_._e()]:_._e(),_._v(" "),y("div",{directives:[{name:"show",rawName:"v-show",value:"expansion"!==_.top.menuIndex&&!_.isStudioMode,expression:"top.menuIndex !== 'expansion' && !isStudioMode"}],staticClass:"h-item select-item h-item-no-padding-top"},[y("label",[_._v(_._s(_.$t("VAE"))+"\n          "),y("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:_.$t("vaeTips"),placement:"top-start"}},[y("span",{staticClass:"el-icon-warning custom-tips"})])],1),_._v(" "),y("el-select",{attrs:{value:_.value.vae,"popper-append-to-body":!0,"popper-class":"custom-select vae-custom-select"},on:{change:function(e){return _.changeConfig(e,"vae")}}},_._l(_.handleVaeList,(function(e,i){return y("el-option",{key:"method_"+i,attrs:{label:e,value:e}},[y("el-tooltip",{attrs:{content:e,placement:"left"}},[y("span",[_._v(_._s(e))])])],1)})),1)],1),_._v(" "),y("div",{directives:[{name:"show",rawName:"v-show",value:"expansion"!==_.top.menuIndex&&!_.isStudioMode,expression:"top.menuIndex !== 'expansion' && !isStudioMode"}],staticClass:"h-item switch-item h-item-no-padding-top"},[y("label",[_._v(_._s(_.$t("LCM")))]),_._v(" "),y("el-switch",{attrs:{"active-color":"#3F8CFF","active-value":1,"inactive-value":0},on:{change:function(e){return _.changeLCM(e,"lcm_mode")}},model:{value:_.value.lcm_mode,callback:function(e){_.$set(_.value,"lcm_mode",e)},expression:"value.lcm_mode"}})],1),_._v(" "),y("div",{directives:[{name:"show",rawName:"v-show",value:"expansion"!==_.top.menuIndex&&!_.isStudioMode,expression:"top.menuIndex !== 'expansion' && !isStudioMode"}],staticClass:"h-item select-item h-item-no-padding-top"},[y("label",[_._v(_._s(_.$t("SamplingMethod"))+"\n          "),y("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:_.$t("WhichATUTPTI"),placement:"top-start"}},[y("span",{staticClass:"el-icon-warning custom-tips"})])],1),_._v(" "),y("el-select",{attrs:{value:_.value.sampler_name,"popper-append-to-body":!0,"popper-class":"custom-select sampler-custom-select"},on:{change:function(e){return _.changeSamplerName(e,"sampler_name")}}},_._l(_.renderTaskSamplerMethods,(function(e,i){return y("el-option",{key:"method_"+i,attrs:{label:e,value:e}},[y("el-tooltip",{attrs:{content:e,placement:"left"}},[y("span",[_._v(_._s(e))])])],1)})),1)],1),_._v(" "),y("slider-item",{directives:[{name:"show",rawName:"v-show",value:_.isShowSteps,expression:"isShowSteps"}],attrs:{value:_.value.steps,min:_.renderStepsOptions.min,max:_.renderStepsOptions.max,label:_.$t("SamplingSteps"),tips:_.$t("HowMTTITGII")},on:{change:function(e){return _.changeConfig(e,"steps")}}}),_._v(" "),y("slider-item",{directives:[{name:"show",rawName:"v-show",value:!("expansion"===_.top.menuIndex||_.isStudioFlux||null!==(o=this.top)&&void 0!==o&&o.isStudioSD35Mode),expression:"top.menuIndex !== 'expansion' && !isStudioFlux && !this.top?.isStudioSD35Mode"}],attrs:{value:_.value.cfg_scale,min:_.renderCFGScale.min,max:_.renderCFGScale.max,step:.5,precision:1,label:_.$t("CFGScale"),tips:_.$t("ClassifierFGSHSTI")},on:{change:function(e){return _.changeConfig(e,"cfg_scale")}}}),_._v(" "),y("div",{directives:[{name:"show",rawName:"v-show",value:"expansion"!==_.top.menuIndex,expression:"top.menuIndex !== 'expansion'"}],staticClass:"h-item seed-item h-item-no-padding-top"},[y("div",{staticClass:"flex justify-between items-center"},[y("label",[_._v(_._s(_.$t("Seed"))+"\n            "),y("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:_.$t("ASendCTOOARNG"),placement:"top-start"}},[y("span",{staticClass:"el-icon-warning custom-tips"})])],1),_._v(" "),_.notSdxl?y("div",{directives:[{name:"show",rawName:"v-show",value:_.showCustomSeed,expression:"showCustomSeed"}],staticClass:"switch-seed flex"},[y("button",{staticClass:"switch-btn",class:{active:"random"===(null===(l=_.value)||void 0===l?void 0:l.seedMode)},on:{click:function(e){return _.changeSeed("random")}}},[_._v("\n              "+_._s(_.$t("Random"))+"\n            ")]),_._v(" "),y("button",{staticClass:"switch-btn",class:{active:"custom"===(null===(r=_.value)||void 0===r?void 0:r.seedMode)},on:{click:function(e){return _.changeSeed("custom")}}},[_._v("\n              "+_._s(_.$t("Customization"))+"\n            ")])]):y("div",{directives:[{name:"show",rawName:"v-show",value:_.showCustomSeed,expression:"showCustomSeed"}],staticClass:"switch-seed flex"},[y("button",{staticClass:"switch-btn",class:{active:"random"===(null===(c=_.value)||void 0===c?void 0:c.seedModesdxl)},on:{click:function(e){return _.changeSeed("random")}}},[_._v("\n              "+_._s(_.$t("Random"))+"\n            ")]),_._v(" "),y("button",{staticClass:"switch-btn",class:{active:"custom"===(null===(d=_.value)||void 0===d?void 0:d.seedModesdxl)},on:{click:function(e){return _.changeSeed("custom")}}},[_._v("\n              "+_._s(_.$t("Customization"))+"\n            ")])])]),_._v(" "),_.notSdxl?y("el-input-number",{attrs:{placeholder:_.seedPlsHd,value:_.value.seed,precision:0,controls:!1,min:-1,max:_.seedOptions.max},on:{input:function(e){return _.useSeed(e)}}}):y("el-input-number",{attrs:{placeholder:_.seedPlsHd,value:_.value.seedsdxl,precision:0,controls:!1,min:-1},on:{input:function(e){return _.useSeed(e)}}}),_._v(" "),_.showImgSeed?y("div",{directives:[{name:"show",rawName:"v-show",value:_.notSdxl,expression:"notSdxl"}],staticClass:"seed-temp",on:{click:function(e){return _.useSeed(_.value.seedTemp)}}},[_._v("\n          "+_._s(_.$t("useImgSeed",{seed:_.value.seedTemp}))+"\n        ")]):_._e(),_._v(" "),_.showImgSeedsdxl?y("div",{directives:[{name:"show",rawName:"v-show",value:!_.notSdxl,expression:"!notSdxl"}],staticClass:"seed-temp",on:{click:function(e){return _.useSeed(_.value.seedTempsdxl)}}},[_._v("\n          "+_._s(_.$t("useImgSeed",{seed:_.value.seedTempsdxl}))+"\n        ")]):_._e()],1),_._v(" "),y("slider-item",{directives:[{name:"show",rawName:"v-show",value:"expansion"!==_.top.menuIndex&&!_.isStudioMode,expression:"top.menuIndex !== 'expansion' && !isStudioMode"}],attrs:{value:_.value.clip_skip,min:1,max:5,label:_.$t("clipSkip"),tips:_.$t("clipSkipTips")},on:{change:function(e){return _.changeConfig(e,"clip_skip")}}}),_._v(" "),y("div",{directives:[{name:"show",rawName:"v-show",value:_.isStudioMode&&!_.isStudioFlux&&!(null!==(h=this.top)&&void 0!==h&&h.isStudioSD35Mode),expression:"isStudioMode && !isStudioFlux && !this.top?.isStudioSD35Mode"}],staticClass:"h-item select-item h-item-no-padding-top",on:{click:function(e){return _.checkNotAllowClick()}}},[y("label",[_._v(_._s(_.$t("studio21"))+"\n          "),_.schedulerDisabled?[y("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:_.isSD3?_.$t("studio34"):_.$t("studio44"),placement:"top-start"}},[y("span",{staticClass:"iconfont icon-warn custom-tips"})])]:_._e()],2),_._v(" "),y("el-select",{attrs:{value:_.value.sampler_name,"popper-append-to-body":!0,"popper-class":"custom-select sampler-custom-select",disabled:_.schedulerDisabled},on:{change:function(e){return _.changeConfig(e,"sampler_name")}}},_._l(_.renderStudioSampler,(function(e,i){return y("el-option",{key:"sampler_name_method_"+i,attrs:{label:e,value:e}},[y("el-tooltip",{attrs:{content:e,placement:"left"}},[y("span",[_._v(_._s(e))])])],1)})),1)],1),_._v(" "),y("div",{directives:[{name:"show",rawName:"v-show",value:_.isStudioMode&&!_.isStudioFlux&&!(null!==(m=this.top)&&void 0!==m&&m.isStudioSD35Mode),expression:"isStudioMode && !isStudioFlux && !this.top?.isStudioSD35Mode"}],staticClass:"h-item select-item h-item-no-padding-top",on:{click:function(e){return _.checkNotAllowClick()}}},[y("label",[_._v(_._s(_.$t("studio20"))+"\n          "),_.schedulerDisabled?[y("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:_.isSD3?_.$t("studio34"):_.$t("studio44"),placement:"top-start"}},[y("span",{staticClass:"iconfont icon-warn custom-tips"})])]:_._e()],2),_._v(" "),y("el-select",{attrs:{value:_.value.lab_base.scheduler,"popper-append-to-body":!0,"popper-class":"custom-select sampler-custom-select",disabled:_.schedulerDisabled},on:{change:function(e){return _.changeConfig(e,"scheduler")}}},_._l(_.renderTaskScheduler,(function(e,i){return y("el-option",{key:"scheduler_method_"+i,attrs:{label:e,value:e}},[y("el-tooltip",{attrs:{content:e,placement:"left"}},[y("span",[_._v(_._s(e))])])],1)})),1)],1),_._v(" "),y("slider-item",{directives:[{name:"show",rawName:"v-show",value:_.isStudioMode&&!_.isStudioFlux&&!(null!==(v=this.top)&&void 0!==v&&v.isStudioSD35Mode),expression:"isStudioMode && !isStudioFlux && !this.top?.isStudioSD35Mode"}],attrs:{value:_.value.lab_base.sharpness,min:0,max:30,step:.1,precision:1,label:_.$t("studio12"),tips:_.$t("studio13"),"show-tooltip":!1},on:{change:function(e){return _.changeConfig(e,"sharpness")}}}),_._v(" "),y("div",{directives:[{name:"show",rawName:"v-show",value:_.isStudioMode&&!_.isStudioFlux&&!(null!==(f=this.top)&&void 0!==f&&f.isStudioSD35Mode),expression:"isStudioMode && !isStudioFlux && !this.top?.isStudioSD35Mode"}],staticClass:"other-style"},[y("label",[_._v(_._s(_.$t("studio16"))+"\n          "),y("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:_.$t("studio17"),placement:"top-start"}},[y("span",{staticClass:"el-icon-warning custom-tips"})])],1),_._v(" "),y("el-switch",{attrs:{"active-value":!0,"inactive-value":!1,"active-color":"#3F8CFF"},on:{change:function(e){return _.changeConfig(e,"auto_adjust_open")}},model:{value:_.value.lab_base.auto_adjust_open,callback:function(e){_.$set(_.value.lab_base,"auto_adjust_open",e)},expression:"value.lab_base.auto_adjust_open"}})],1),_._v(" "),y("slider-item",{directives:[{name:"show",rawName:"v-show",value:_.isStudioMode&&_.value.lab_base.auto_adjust_open&&!_.isStudioFlux,expression:"isStudioMode && value.lab_base.auto_adjust_open && !isStudioFlux"}],attrs:{value:_.value.lab_base.auto_adjust_strength,min:0,max:100,step:1,label:_.$t("studio9"),"show-tooltip":!1},on:{change:function(e){return _.changeConfig(e,"auto_adjust_strength")}}})],2),_._v(" "),y("style-modal",{ref:"styleModal",attrs:{"model-type":_.selectModelType,"select-list":_.selectIds,isSDXL:!_.isSdModel,inTask:!0,"is-studio-mode":_.isStudioMode},on:{selectModel:_.handleSelectModel}})],1)}),[],!1,null,"39bc686c",null).exports);function qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Je={props:["value"],components:{SliderItem:Re.a},data:function(){return{isZoom:!0,controlNetOff:!1,controlMode:["Balance","Prompt","Controlnet"]}},inject:["top"],computed:Ge(Ge({},Object(S.c)("creation",["taskUnits","taskSdxlUnits"])),{},{taskModules:function(){return this.isSdxl?this.taskSdxlUnits:this.taskUnits},isSdxl:function(){return["5",5,"sdxl","SDXL"].includes(this.value.category)},isStudioMode:function(){return["7",7,"studio",11].includes(this.value.category)},isShowStyleFidelity:function(){var e,t="preview"===this.top.menuIndex;return(null===(e=this.finder)||void 0===e?void 0:e.has_style_fidelity)&&"0"===this.controlnet_item.control_mode&&!t&&!this.isStudioMode},controlnet_item:function(){var e=this.value,t=e.workIndex;return e.controlnet_units[t]},finder:function(){var e=this;return this.taskModules.find((function(t){return e.controlnet_item.type==t.type}))||{}},isShowResolution:function(){var e;return(null===(e=this.finder)||void 0===e?void 0:e.has_processor_res)&&this.controlnet_item.isHandle},control_modules:function(){var e;return null===(e=this.finder)||void 0===e?void 0:e.modules},control_models:function(){var e;return null===(e=this.finder)||void 0===e?void 0:e.models}}),methods:{changeConfig:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=JSON.parse(JSON.stringify(this.value)),l=o.workIndex,r=o.controlnet_units;o.lab_base;"studio"===n&&this.isStudioMode&&["stop_at","weight"].includes(t)?this.top.updateStudioControlNet(e,t,l):("controlnet_processor_res"===t?o[t]=e:r[l][t]=e,this.$emit("input",o))}}},Ke=Je,Xe=(n(2993),Object(y.a)(Ke,(function(){var e,t,n=this,o=n._self._c;return o("div",{staticClass:"generate-controlnet handle-item"},[o("div",{staticClass:"item-head",on:{click:function(e){n.isZoom=!n.isZoom}}},[o("label",[o("i",{staticClass:"iconfont icon-kongzhiwang"}),n._v(n._s(n.$t("ControlNet"))+"\n      ")]),n._v(" "),o("i",{staticClass:"el-icon-caret-bottom",class:{zoom:n.isZoom}})]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.isZoom,expression:"isZoom"}],staticClass:"item-content"},[o("div",{staticClass:"h-item select-item"},[o("label",[n._v(n._s(n.$t("Type")))]),n._v(" "),o("div",{staticClass:"el-selects",on:{click:function(e){return e.stopPropagation(),n.top.showControlnetPopup(!0)}}},[n._v(n._s(n.$t(n.controlnet_item.type))+"\n          "),o("i",{staticClass:"el-icon-arrow-right"})])]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:"preview"!==n.top.menuIndex&&!n.isStudioMode,expression:"top.menuIndex !== 'preview' && !isStudioMode"}],staticClass:"h-item radio-item"},[o("label",[n._v(n._s(n.$t("TaskUploadImageMoreSettingPreprocessor")))]),n._v(" "),o("div",{staticClass:"radio-group"},[o("el-radio",{attrs:{value:n.controlnet_item.isHandle,label:!0},on:{input:function(e){return n.changeConfig(e,"isHandle")}}},[n._v(n._s(n.$t("Yes")))]),n._v(" "),o("el-radio",{attrs:{value:n.controlnet_item.isHandle,label:!1},on:{input:function(e){return n.changeConfig(e,"isHandle")}}},[n._v(n._s(n.$t("No")))])],1)]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.controlnet_item.isHandle&&!n.isStudioMode,expression:"controlnet_item.isHandle && !isStudioMode"}],staticClass:"h-item select-item"},[o("label",[n._v(n._s(n.$t("ControlPreprocessor")))]),n._v(" "),o("el-select",{attrs:{value:n.controlnet_item.module,"popper-class":"custom-select","popper-append-to-body":!0},on:{change:function(e){return n.changeConfig(e,"module")}}},n._l(n.control_modules,(function(e,i){return o("el-option",{key:"ControlMode_"+i,attrs:{value:e,label:e}},[n._v(" "+n._s(e)+"\n          ")])})),1)],1),n._v(" "),"None"==n.controlnet_item.model||"preview"===n.top.menuIndex||n.isStudioMode?n._e():o("div",{staticClass:"h-item select-item"},[o("label",[n._v(n._s(n.$t("ControlPreprocessingModel")))]),n._v(" "),o("el-select",{attrs:{value:n.controlnet_item.model,"popper-class":"custom-select sampler-custom-select","popper-append-to-body":!0},on:{change:function(e){return n.changeConfig(e,"model")}}},n._l(n.control_models,(function(e,i){return o("el-option",{key:"ControlMode_"+i,attrs:{value:e,label:e}},[o("el-tooltip",{attrs:{content:e,placement:"left"}},[o("span",[n._v(n._s(e))])])],1)})),1)],1),n._v(" "),o("slider-item",{directives:[{name:"show",rawName:"v-show",value:"preview"!=n.top.menuIndex&&n.isShowResolution&&!n.isStudioMode,expression:"top.menuIndex != 'preview' && isShowResolution && !isStudioMode"}],attrs:{value:n.controlnet_item.processor_res,min:0,max:2048,step:1,label:n.$t("ControlPreprocessorResolution"),tips:n.$t("StyleFidelityTips")},on:{change:function(e){return n.changeConfig(e,"processor_res")}}}),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:"preview"!==n.top.menuIndex&&!n.isStudioMode,expression:"top.menuIndex !== 'preview' && !isStudioMode"}],staticClass:"h-item select-item"},[o("label",[n._v(n._s(n.$t("ControlMode")))]),n._v(" "),o("el-select",{attrs:{value:n.controlnet_item.control_mode,"popper-class":"custom-select","popper-append-to-body":!1},on:{change:function(e){return n.changeConfig(e,"control_mode")}}},n._l(n.controlMode,(function(e,i){return o("el-option",{key:"ControlMode_"+i,attrs:{value:String(i),label:n.$t("ControlMode"+e)}},[n._v(" "+n._s(n.$t("ControlMode"+e))+"\n          ")])})),1)],1),n._v(" "),o("slider-item",{directives:[{name:"show",rawName:"v-show",value:n.isShowStyleFidelity,expression:"isShowStyleFidelity"}],attrs:{value:n.controlnet_item.threshold_a,min:.1,max:1,step:.1,label:n.$t("StyleFidelity"),tips:n.$t("StyleFidelityTips")},on:{change:function(e){return n.changeConfig(e,"threshold_a")}}}),n._v(" "),o("slider-item",{directives:[{name:"show",rawName:"v-show",value:"preview"!==n.top.menuIndex&&!n.isStudioMode,expression:"top.menuIndex !== 'preview' && !isStudioMode"}],attrs:{value:n.controlnet_item.weight,min:0,max:2,step:.1,label:n.$t("ControlWeight"),tips:n.$t("ControlWeightTips")},on:{change:function(e){return n.changeConfig(e,"weight")}}}),n._v(" "),o("slider-item",{directives:[{name:"show",rawName:"v-show",value:"preview"===n.top.menuIndex&&!n.isStudioMode,expression:"top.menuIndex === 'preview' && !isStudioMode"}],attrs:{value:n.value.controlnet_processor_res,min:512,max:1024,step:1,label:n.$t("ControlPreprocessorResolution"),tips:n.$t("StyleFidelityTips")},on:{change:function(e){return n.changeConfig(e,"controlnet_processor_res")}}}),n._v(" "),n.isStudioMode&&null!==(e=n.value.lab_base)&&void 0!==e&&null!==(e=e.conds)&&void 0!==e&&e.length?o("slider-item",{directives:[{name:"show",rawName:"v-show",value:n.isStudioMode,expression:"isStudioMode"}],attrs:{value:n.value.lab_base.conds[n.value.workIndex].stop_at,min:0,max:1,step:.001,precision:3,label:"Stop At",tips:n.$t("studio3"),"show-tooltip":!1},on:{change:function(e){return n.changeConfig(e,"stop_at","studio")}}}):n._e(),n._v(" "),n.isStudioMode&&null!==(t=n.value.lab_base)&&void 0!==t&&null!==(t=t.conds)&&void 0!==t&&t.length?o("slider-item",{directives:[{name:"show",rawName:"v-show",value:n.isStudioMode,expression:"isStudioMode"}],attrs:{value:n.value.lab_base.conds[n.value.workIndex].weight,min:0,max:2,step:.001,precision:3,label:n.$t("studio4"),"show-tooltip":!1,tips:n.$t("ControlWeightTips")},on:{change:function(e){return n.changeConfig(e,"weight","studio")}}}):n._e()],1)])}),[],!1,null,"62549633",null).exports),Qe={props:["value"],data:function(){return{}},computed:{renderOptions:function(){var e={min:.01,max:1,step:.05};return this.isStudioMode&&(e.min=0),e},isStudioMode:function(){return[7,"7",11].includes(this.value.category)}},methods:{changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));n[t]=e,this.$emit("input",n)}}},Ze=(n(2994),Object(y.a)(Qe,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"generate-image handle-item"},[t("div",{staticClass:"item-head"},[t("label",[t("i",{staticClass:"iconfont icon-shuashua"}),e._v(e._s(e.$t("DenoisingStrength")))])]),e._v(" "),t("div",{staticClass:"item-content slider-item"},[t("el-slider",{attrs:{value:e.value.denoising_strength,min:e.renderOptions.min,max:e.renderOptions.max,step:e.renderOptions.step,"show-input":!0,"show-input-controls":!1},on:{input:function(t){return e.changeConfig(t,"denoising_strength")}}})],1)])}),[],!1,null,"929aa638",null).exports),Ye=n(69),et=n(506);function tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function it(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tt(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nt={components:{StyleModal:Ae.a,LoraList:et.a},props:["value"],inject:["top"],data:function(){return{selectIds:[],modelType:"Checkpoint",extraModelList:[]}},watch:{"value.art_model_no":{handler:function(e){this.setInitModelList(e)},immediate:!0}},computed:it(it({},Object(S.c)("creation",["taskBaseModels","sd_xl_base_model"])),{},{isSdModel:function(){return["5",5].includes(this.value.category)},modelsList:function(){var e=this.value,t=e.art_work_no,n=e.art_model_no,o=e.art_model_ver_no;if(this.isSdModel){var l=this.sd_xl_base_model.map((function(e){var l=e.artwork,r=e.name,c=e.id;return{workId:t!==l.id&&n===c?t:l.id,name:r,id:c,art_model_ver_no:o}}));return[].concat(Object(R.a)(this.extraModelList),Object(R.a)(l))}var r=this.taskBaseModels.map((function(e){var l=e.artwork,r=e.name,c=e.id;return{workId:t!==l.id&&n===c?t:l.id,name:r,id:c,art_model_ver_no:o}}));return[].concat(Object(R.a)(this.extraModelList),Object(R.a)(r))}}),methods:{setInitModelList:function(e){var t=this.value,n=t.art_work_no,o=t.modelName,l=t.art_model_no,r=t.category,c=t.agency_fee,d=void 0===c?0:c;this.extraModelList=[];var h=this.taskBaseModels.some((function(e){return e.id===l}));if(this.isSdModel&&(h=this.sd_xl_base_model.some((function(e){return e.id===l}))),3!==r)if(e)h||(this.extraModelList=[{id:l,name:o,workId:n,agency_fee:d||0}]);else{if(this.isSdModel){var m=(null==this?void 0:this.sd_xl_base_model[0])||{},v=m.name,f=m.artwork,_=void 0===f?{}:f,y=m.id,w=m.art_model_ver_no,C=m.agency_fee,k=void 0===C?0:C;return void this.changeConfig({art_work_no:null==_?void 0:_.id,modelName:v,art_model_no:y,art_model_ver_no:w,agency_fee:k||0})}this.changeConfig({art_work_no:this.taskBaseModels[0].artwork.id,modelName:this.taskBaseModels[0].name,art_model_no:this.taskBaseModels[0].id,art_model_ver_no:this.taskBaseModels[0].art_model_ver_no,agency_fee:this.taskBaseModels[0].agency_fee||0})}},changeLora:function(e,t,n){"DEL"===e?this.deleteModel(t):this.changeWeight(n,t)},changeWeight:function(e,t){var n=this.value.lora_models;n[t].weight=e,this.changeConfig({lora_models:n})},changeConfig:function(e){var t=JSON.parse(JSON.stringify(this.value));t=it(it({},t),e),console.log(e),this.$emit("input",t)},showModelPopup:function(e){var t=this;if(this.modelType=e,"Checkpoint"===e)this.selectIds=[{id:this.value.art_model_no}];else if(this.selectIds=this.value.lora_models,this.value.lora_models.length>=3)return;this.$nextTick((function(){t.$refs.styleModal.openModal()}))},handleSelectModel:function(e){"LORA"===this.modelType?this.selectLoraHandle(e):this.selectModelHandle(e),this.$refs.styleModal.handleClose()},selectModelHandle:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("MoreModel"!==e){n.next=3;break}return t.showModelPopup("Checkpoint"),n.abrupt("return");case 3:return n.next=5,t.getModelInfo(e);case 5:o=n.sent,t.modelsList.some((function(e){return e.id===o.id}))||(t.extraModelList=[o]),t.changeConfig({art_work_no:o.sample_ids?o.sample_ids[0]:o.workId,modelName:o.name,art_model_no:o.id,art_model_ver_no:e.art_model_ver_no||e.model_ver_no||"",agency_fee:(null==e?void 0:e.agency_fee)||0});case 9:case"end":return n.stop()}}),n)})))()},selectLoraHandle:function(e){var t=this.value.lora_models,n=it({model_id:e.id,weight:1},e);t.length>2||(t.push(n),this.changeConfig({lora_models:t}))},viewImage:function(e){var t=this.value.lora_models[e];this.$refs.loraPopup.show(!0,t)},deleteModel:function(e){var t=JSON.parse(JSON.stringify(this.value));t.lora_models.splice(e,1),this.changeConfig({lora_models:t.lora_models})},getModelInfo:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!("object"===Object(Ye.a)(e))){n.next=17;break}if(!e.sample_ids&&2!==e.publish_status){n.next=6;break}return n.abrupt("return",e);case 6:if(1!==e.publish_status||e.sample_ids){n.next=8;break}return n.abrupt("return",e);case 8:return n.next=10,Object(A.o)({art_model_ver_no:e.model_ver_no});case 10:return o=n.sent,l=o.data,r=l.art_model,c=r.id,d=r.name,h=l.art_work_no,n.abrupt("return",{id:c,name:d,workId:h,art_model_ver_no:e.model_ver_no});case 17:return n.abrupt("return",t.modelsList.find((function(t){return t.id===e})));case 18:case"end":return n.stop()}}),n)})))()}}},at=(n(2999),Object(y.a)(nt,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"model-handle handle-item"},[t("style-modal",{ref:"styleModal",attrs:{"model-type":e.modelType,"select-list":e.selectIds,isSDXL:e.isSdModel},on:{selectModel:e.handleSelectModel}}),e._v(" "),t("div",{staticClass:"item-head"},[t("label",[t("i",{staticClass:"iconfont icon-moxingicon model-icon title"}),e._v(e._s(e.$t("ModelSetting"))+"\n\t\t")])]),e._v(" "),t("div",{staticClass:"item-content"},[t("div",{staticClass:"h-item m-item"},[t("div",{staticClass:"item-head"},[t("label",[e._v("\n\t\t\t\t\t"+e._s(e.$t("Model"))+"\n\t\t\t\t")]),e._v(" "),t("el-select",{attrs:{value:e.value.art_model_no,placeholder:"","popper-class":"custom-select","popper-append-to-body":!1},on:{change:e.selectModelHandle}},[e._l(e.modelsList,(function(e,i){return t("el-option",{key:"model_"+i,attrs:{label:e.name,value:e.id}})})),e._v(" "),t("el-option",{attrs:{label:e.$t("selectMoreModel"),value:"MoreModel"}})],2)],1)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"expansion"!==e.top.menuIndex,expression:"top.menuIndex !== 'expansion'"}],staticClass:"h-item l-item"},[t("div",{staticClass:"item-head",on:{click:function(t){return e.showModelPopup("LORA",t)}}},[t("label",[e._v("\n\t\t\t\t\t"+e._s(e.$t("LoRA"))+"\n\t\t\t\t")]),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:e.value.lora_models.length<3,expression:"value.lora_models.length < 3"}],staticClass:"el-icon-circle-plus"})]),e._v(" "),t("lora-list",{attrs:{list:e.value.lora_models},on:{change:e.changeLora}})],1)])],1)}),[],!1,null,"ef5edf42",null).exports);function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function st(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var lt={props:["value"],inject:["top"],components:{SliderItem:Re.a},watch:{"value.width":{handler:function(e,t){if(e!==t){var n=5===this.value.category;this.autoFastSelectActive(n?"sdxl":"")}},deep:!0,immediate:!0},"value.sdxl.width":{handler:function(e,t){if(e!==t){var n=5===this.value.category;this.autoFastSelectActive(n?"sdxl":"")}},deep:!0,immediate:!0},"value.studio":{handler:function(e,t){var n=this;this.isStudioMode&&this.$nextTick((function(){n.autoFastSelectStudioActive()}))},deep:!0,immediate:!0},"value.category":function(e){var t=5===this.value.category;this.autoFastSelectActive(t?"sdxl":""),7===e&&3===this.value.imageMode&&this.applyImageMode(2)},currentModelType:{handler:function(e,t){if(e&&e!==t&&this.isStudioMode){var n;if(8===this.studioSelectSize){var o,l=JSON.parse(JSON.stringify(this.value)),r=this.top.updateStudioSize(null===(o=this.value)||void 0===o?void 0:o.base_model_type,l.studio.width,l.studio.height,!0);return Object.assign(l.studio,r),void this.$emit("input",l)}"SD"===this.currentModelType&&(this.studioSelectSize=28),["SDXL","SD3"].includes(this.currentModelType)&&(this.studioSelectSize=41),!this.isStudioFlux&&!this.isStudioSD35||null!==(n=this.value)&&void 0!==n&&n.parent_task_id||(this.studioSelectSize=3),this.applyStudioStyleSize(this.studioSelectSize)}},deep:!0,immediate:!0}},data:function(){return{fastSizeSelectList:xe.c,selectSize:1,studioSelectSize:13,sdSelectSize:20,imageModeSelectList:xe.j,imageNumsOptions:[{code:1,label:1},{code:2,label:2},{code:3,label:3},{code:4,label:4}],sdxlSizeList:xe.d,studioSdList:xe.e,studioSdxlList:xe.f,studioFluxList:xe.g,enhanceMagicSelectList:[{code:1,label:"自动",i18nKey:"studio41"},{code:2,label:"开启",i18nKey:"studio42"},{code:3,label:"关闭",i18nKey:"studio43"}],qualityTypeSelectList:[{code:"anime",label:"动漫",i18nKey:"sdxl_Anime"},{code:"realistic",label:"写实",i18nKey:"realistic"}]}},mounted:function(){"SD"===this.currentModelType&&(this.studioSelectSize=31),["SDXL","SD3"].includes(this.currentModelType)&&(this.studioSelectSize=41)},computed:{getCurrentModelType:function(){var e=(this.value||{}).base_model_type,t=void 0===e?"":e,n=xe.B.flux,o=xe.B.sd35,l=["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony"].includes(t)||(t||"").includes("SDXL"),r=["SD 1.5","SD 2.0","SD 1.4","SD 2.1 768","SD 2.1","SD 2.0 768","SD 1.5 LCM"].includes(t),c=n.includes(t)||(t||"").includes("Flux"),d=o.includes(t)||(t||"").includes("SD 3.5");return c?"FLUX":l?"SDXL":r?"SD":"SD 3"===t?"SD3":"Other"===t?"Other":d?"SD 3.5":void 0},isStudioSD35:function(){return["textToImage"].includes(this.top.menuIndex)&&this.isStudioMode&&"SD 3.5"===this.getCurrentModelType},isStudioFlux:function(){var e,t,n,o=null===(e=this.top)||void 0===e?void 0:e.fluxModelId,l=((null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[]).includes(null===(t=this.value)||void 0===t?void 0:t.base_model_type);return(this.value.art_model_no===o||l||(null===(n=this.value)||void 0===n||null===(n=n.base_model_type)||void 0===n?void 0:n.includes("Flux")))&&["textToImage"].includes(this.top.menuIndex)&&this.isStudioMode},isSD3:function(){return"SD3"===this.currentModelType},studioRenderOptions:function(){var e={min:512,max:1024};return this.isStudioFlux?{min:384,max:1024}:"SD"===this.currentModelType?e:["SDXL","SD3"].includes(this.currentModelType)?{min:768,max:1536}:e},currentModelType:function(){var e=xe.B.sd35,t=this.value.base_model_type,n=void 0===t?"":t,o=["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony"].includes(n)||(n||"").includes("SDXL"),l=["SD 1.5","SD 2.0","SD 1.4","SD 2.1 768","SD 2.1","SD 2.0 768","SD 1.5 LCM"].includes(n),r=["Flux.1 S","Flux.1 D"].includes(n)||(n||"").includes("Flux"),c=e.includes(n)||(n||"").includes("SD 3.5");return r?"FLUX":o?"SDXL":l?"SD":"SD 3"===n?"SD3":c?"SD 3.5":void 0},fastStudioSize:function(){return this.isStudioMode&&this.isStudioFlux||this.isStudioSD35?this.studioFluxList:this.isStudioMode&&"SD"===this.currentModelType?this.studioSdList:this.isStudioMode&&["SDXL","SD3"].includes(this.currentModelType)?this.studioSdxlList:[]},isStudioMode:function(){return["textToImage","imageToImage","conditionToImage"].includes(this.top.menuIndex)&&[7,"studio",11].includes(this.value.category)},isShowQuantityOfImages:function(){return["textToImage","imageToImage","conditionToImage","expansion"].includes(this.top.menuIndex)},renderImageModeSelectList:function(){return["textToImage"].includes(this.top.menuIndex)?this.imageModeSelectList.filter((function(e){return e.code<=3})):this.imageModeSelectList},imageSizeLabel:function(){return function(e){return 8===e.code?this.$t(e.label):"".concat(e.width,"X").concat(e.height,"   [").concat(this.$t(e.label),"]")}},isSdModel:function(){return!["5",5].includes(this.value.category)},imageMaxSize:function(){if("expansion"===this.top.menuIndex)return 1536;if(this.top.handleModelType&&"sdxl"===this.top.creativeMode)return 1536;var e=this.value.imageMode;return["textToImage"].includes(this.top.menuIndex)&&Number(this.value.imageMode)>=4&&(e=3),this.getMaxSize(e)},autoSetFastSelectList:function(){var e=this,t=this.imageMaxSize;return Object(X.cloneDeep)(this.fastSizeSelectList).map((function(n){if(8===n.code)return n;var o=Object(B.g)(n.width,n.height,t);return"expansion"!==e.top.menuIndex&&(o=JSON.parse(JSON.stringify(null==n?void 0:n.sizeMap[t]))),n.width=o.width,n.height=o.height,n}))},isShowWH:function(){return"expansion"===this.top.menuIndex||8===this.selectSize||!this.isStudioMode&&!this.isSdModel},isSdxlWH:function(){return 8===this.sdSelectSize&&5===this.value.category},isStudioWH:function(){return 8===this.studioSelectSize&&[7,11,"studio"].includes(this.value.category)}},methods:{changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));if("styleZoom"===t)return n[t]=e,void this.$emit("input",n);if(this.isSdModel&&!this.isStudioMode&&(n[t]=e),this.isStudioMode&&(["quality_open","quality_detail_offset","quality_mode","quality_type","intelligence_open"].includes(t)?(n.lab_base[t]=e,"quality_mode"===t&&[1,2].includes(e)&&(n.lab_base.scheduler="karras",n.sampler_name="dpmpp_2m_sde_gpu",[2].includes(e)&&(n.lab_base.intelligence_open=!0)),"quality_mode"===t&&[1,3].includes(e)&&([3].includes(e)&&(n.lab_base.intelligence_open=!1),n.lab_base.quality_detail_offset=.45)):n.studio[t]=e),this.isSdModel||(n.sdxl[t]=e),"n_iter"===t)for(var i in localStorage.setItem("imageNums",e),this.top.config)this.top.config[i]=st(st({},this.top.config[i]),{},{n_iter:e});else this.$emit("input",n)},applyStyleSize:function(){var code=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.autoSetFastSelectList.find((function(e){return e.code===code}));if(!["",null,void 0].includes(e)&&8!==code){var t=JSON.parse(JSON.stringify(this.value));t.width=e.width,t.height=e.height,this.$emit("input",t)}},applyStudioStyleSize:function(){var code=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.fastStudioSize.find((function(e){return e.code===code}));if(!["",null,void 0].includes(e)&&8!==code){var t=JSON.parse(JSON.stringify(this.value));t.studio.width=e.width,t.studio.height=e.height,this.$emit("input",t)}},applySdStyleSize:function(){var code=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.sdxlSizeList.find((function(e){return e.code===code}));if(!["",null,void 0].includes(e)&&8!==code){var t=JSON.parse(JSON.stringify(this.value));t.sdxl.width=e.width,t.sdxl.height=e.height,this.$emit("input",t)}},applyImageMode:function(){var e=this,code=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";localStorage.setItem("imageMode",code);var t=this.imageModeSelectList.find((function(e){return e.code===code}));if(!["",null,void 0].includes(t)){var n=JSON.parse(JSON.stringify(this.value));n.realWidth=n.width,n.realHeight=n.height;var o=this.top.handleSize(st(st({},n),{},{imageMode:code})),l=o.width,r=o.height,c=this.getMaxSize(code),d=this.fastSizeSelectList.find((function(t){return t.code===e.selectSize}))||{};if(d=Object(X.cloneDeep)(d),8===this.selectSize)d={width:n.width,height:n.height},d=Object(B.g)(d.width,d.height,c);else{var h,m=(null===(h=d)||void 0===h?void 0:h.sizeMap[c])||{},v=m.width,f=m.height;d.width=v,d.height=f}l=d.width,r=d.height,n.width=l||t.width,n.height=r||t.height,n.imageMode=code,this.$emit("input",n)}},getMaxSize:function(e){return"textToImage"===this.top.menuIndex&&e>3&&(e=3),{1:512,2:768,3:1024,4:1536}[e]||768},autoFastSelectActive:function(e){var t="sdxl"===e?this.sdxlSizeList:this.autoSetFastSelectList,n="sdxl"===e?this.value.sdxl.width:this.value.width,o="sdxl"===e?this.value.sdxl.height:this.value.height,l=t.find((function(e){return e.height===o&&e.width===n}));"sdxl"===e?this.sdSelectSize=(null==l?void 0:l.code)||8:this.selectSize=(null==l?void 0:l.code)||8},autoFastSelectStudioActive:function(){var e=this,t=this.fastStudioSize.find((function(t){return t.height===e.value.studio.height&&t.width===e.value.studio.width}));if(t&&null!=t&&t.code)this.studioSelectSize=null==t?void 0:t.code;else{var n;if("FLUX"===this.currentModelType&&(null===(n=this.value)||void 0===n||!n.parent_task_id))return void(this.studioSelectSize=3);this.studioSelectSize=8}}}},ct=lt,ut=(n(3e3),n(3001),Object(y.a)(ct,(function(){var e,t=this,n=t._self._c;return n("div",{staticClass:"generate-style handle-item"},[n("div",{staticClass:"item-head",on:{click:function(e){return t.changeConfig(!t.value.styleZoom,"styleZoom")}}},[n("label",[n("i",{staticClass:"iconfont icon-setting1"}),t._v(t._s(t.$t("BasicSettings"))+"\n      ")]),t._v(" "),n("i",{staticClass:"el-icon-caret-bottom",class:{zoom:t.value.styleZoom}})]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.value.styleZoom,expression:"value.styleZoom"}],staticClass:"item-content"},[!t.isStudioMode||t.isStudioFlux||"textToImage"!==t.top.menuIndex||t.isStudioSD35?t._e():[n("div",{staticClass:"select-item"},[n("label",[t._v(t._s(t.$t("studio36"))+"\n            "),n("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:t.$t("studio37"),placement:"top-start"}},[n("span",{staticClass:"el-tooltip el-icon-warning custom-tips"})])],1),t._v(" "),n("el-select",{attrs:{placeholder:t.$t("Pls_select"),"popper-class":"custom-select","popper-append-to-body":!0},on:{change:function(e){return t.changeConfig(e,"quality_mode")}},model:{value:t.value.lab_base.quality_mode,callback:function(e){t.$set(t.value.lab_base,"quality_mode",e)},expression:"value.lab_base.quality_mode"}},t._l(t.enhanceMagicSelectList,(function(e){return n("el-option",{key:"size-select"+e.code,attrs:{label:t.$t(e.i18nKey),value:e.code}})})),1)],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:[2].includes(t.value.lab_base.quality_mode),expression:"[2].includes(value.lab_base.quality_mode)"}],staticClass:"select-item"},[n("label",[t._v(t._s(t.$t("studio38")))]),t._v(" "),n("el-select",{attrs:{placeholder:t.$t("Pls_select"),"popper-class":"custom-select","popper-append-to-body":!0},on:{change:function(e){return t.changeConfig(e,"quality_type")}},model:{value:t.value.lab_base.quality_type,callback:function(e){t.$set(t.value.lab_base,"quality_type",e)},expression:"value.lab_base.quality_type"}},t._l(t.qualityTypeSelectList,(function(e){return n("el-option",{key:"size-select"+e.code,attrs:{label:t.$t(e.i18nKey),value:e.code}})})),1)],1),t._v(" "),n("slider-item",{directives:[{name:"show",rawName:"v-show",value:[2].includes(t.value.lab_base.quality_mode),expression:"[2].includes(value.lab_base.quality_mode)"}],attrs:{value:t.value.lab_base.quality_detail_offset,min:-1,max:1,step:.01,precision:2,label:t.$t("studio39"),"show-tooltip":!1},on:{change:function(e){return t.changeConfig(e,"quality_detail_offset")}}}),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:[2].includes(t.value.lab_base.quality_mode),expression:"[2].includes(value.lab_base.quality_mode)"}],staticClass:"other-style"},[n("label",[t._v(t._s(t.$t("studio18"))+"\n            "),n("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:t.$t("studio40"),placement:"top-start"}},[n("span",{staticClass:"el-icon-warning custom-tips"})])],1),t._v(" "),n("el-switch",{attrs:{"active-value":!0,"inactive-value":!1,"active-color":"#3F8CFF"},on:{change:function(e){return t.changeConfig(e,"intelligence_open")}},model:{value:t.value.lab_base.intelligence_open,callback:function(e){t.$set(t.value.lab_base,"intelligence_open",e)},expression:"value.lab_base.intelligence_open"}})],1)],t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowQuantityOfImages,expression:"isShowQuantityOfImages"}],staticClass:"fast-size-select select-item"},[n("label",[t._v(t._s(t.$t("QuantityOfImages")))]),t._v(" "),n("el-select",{attrs:{value:t.value.n_iter,placeholder:t.$t("QuantityOfImages"),"popper-class":"custom-select","popper-append-to-body":!0},on:{change:function(e){return t.changeConfig(e,"n_iter")}}},t._l(t.imageNumsOptions,(function(e){return n("el-option",{key:"quantity-of-images"+e.code,attrs:{label:e.label,value:e.code}})})),1)],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.isStudioMode&&t.isSdModel,expression:"!isStudioMode && isSdModel"}],staticClass:"fast-size-select select-item"},[n("label",[t._v(t._s(t.$t("imageMode"))+"\n")]),t._v(" "),n("el-select",{attrs:{value:t.value.imageMode,placeholder:t.$t("imageMode"),disabled:"expansion"===t.top.menuIndex,"popper-class":"custom-select","popper-append-to-body":!0},on:{change:t.applyImageMode}},t._l(t.renderImageModeSelectList,(function(e){return n("el-option",{directives:[{name:"show",rawName:"v-show",value:3===e.code&&7!=t.value.category||3!=e.code,expression:"(item.code === 3 && value.category != 7) || item.code != 3"}],key:"image-mode"+e.code,attrs:{label:t.$t(e.label),value:e.code}})})),1)],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.isStudioMode&&t.isSdModel||(null===(e=t.top)||void 0===e?void 0:e.isStudioSD35),expression:"(!isStudioMode && isSdModel ) || top?.isStudioSD35"}],staticClass:"fast-size-select select-item"},[n("label",[t._v(t._s(t.$t("imageDimensions")))]),t._v(" "),n("el-select",{attrs:{placeholder:t.$t("AspectRatio"),disabled:"expansion"===t.top.menuIndex,"popper-class":"custom-select","popper-append-to-body":!0},on:{change:t.applyStyleSize},model:{value:t.selectSize,callback:function(e){t.selectSize=e},expression:"selectSize"}},t._l(t.autoSetFastSelectList,(function(e){return n("el-option",{key:"size-select"+e.code,attrs:{label:t.imageSizeLabel(e),value:e.code}})})),1)],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isStudioMode,expression:"isStudioMode"}],staticClass:"fast-size-select select-item"},[n("label",[t._v(t._s(t.$t("imageDimensions")))]),t._v(" "),n("el-select",{attrs:{placeholder:t.$t("AspectRatio"),disabled:"expansion"===t.top.menuIndex,"popper-class":"custom-select","popper-append-to-body":!0},on:{change:t.applyStudioStyleSize},model:{value:t.studioSelectSize,callback:function(e){t.studioSelectSize=e},expression:"studioSelectSize"}},t._l(t.fastStudioSize,(function(e){return n("el-option",{key:"size-select"+e.code,attrs:{label:t.imageSizeLabel(e),value:e.code}})})),1)],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.isSdModel&&!t.isStudioMode,expression:"!isSdModel && !isStudioMode"}],staticClass:"fast-size-select select-item select-item-sd"},[n("label",[t._v(t._s(t.$t("imageDimensions")))]),t._v(" "),n("el-select",{attrs:{placeholder:t.$t("AspectRatio"),disabled:"expansion"===t.top.menuIndex,"popper-class":"custom-select","popper-append-to-body":!1},on:{change:t.applySdStyleSize},model:{value:t.sdSelectSize,callback:function(e){t.sdSelectSize=e},expression:"sdSelectSize"}},t._l(t.sdxlSizeList,(function(e){return n("el-option",{key:"size-select"+e.code,attrs:{label:t.imageSizeLabel(e),value:e.code}})})),1)],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isSdxlWH||t.isShowWH&&!t.isStudioMode&&t.isSdModel,expression:"isSdxlWH || isShowWH && !isStudioMode && isSdModel"}],staticClass:"size-item"},[n("div",{staticClass:"size-item-label"},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("width"),placement:"top"}},[n("span",{staticClass:"size-item-label-text"},[t._v(t._s(t.$t("width")))])]),t._v(" "),n("el-input-number",{attrs:{size:"mini",value:t.isSdModel?t.value.width:t.value.sdxl.width,controls:!1,min:128,max:t.imageMaxSize,step:1,disabled:"expansion"===t.top.menuIndex},on:{change:function(e){return t.changeConfig(e,"width")}}})],1),t._v(" "),n("div",{staticClass:"size-item-label"},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("height"),placement:"top"}},[n("span",{staticClass:"size-item-label-text"},[t._v(t._s(t.$t("height")))])]),t._v(" "),n("el-input-number",{attrs:{size:"mini",value:t.isSdModel?t.value.height:t.value.sdxl.height,controls:!1,min:128,max:t.imageMaxSize,step:1,disabled:"expansion"===t.top.menuIndex},on:{change:function(e){return t.changeConfig(e,"height")}}})],1)]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isStudioWH&&t.isStudioMode,expression:"isStudioWH && isStudioMode"}],staticClass:"size-item"},[n("div",{staticClass:"size-item-label"},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("width"),placement:"top"}},[n("span",{staticClass:"size-item-label-text"},[t._v(t._s(t.$t("width")))])]),t._v(" "),n("el-input-number",{attrs:{size:"mini",value:t.value.studio.width,controls:!1,min:t.studioRenderOptions.min,max:t.studioRenderOptions.max,step:1},on:{change:function(e){return t.changeConfig(e,"width")}}})],1),t._v(" "),n("div",{staticClass:"size-item-label"},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("height"),placement:"top"}},[n("span",{staticClass:"size-item-label-text"},[t._v(t._s(t.$t("height")))])]),t._v(" "),n("el-input-number",{attrs:{size:"mini",value:t.value.studio.height,controls:!1,min:t.studioRenderOptions.min,max:t.studioRenderOptions.max,step:1},on:{change:function(e){return t.changeConfig(e,"height")}}})],1)])],2)])}),[],!1,null,"697a1a68",null).exports);function ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var mt={components:{SliderItem:Re.a},props:["value"],name:"HandExtraUpscale",data:function(){return{}},computed:pt(pt({},Object(S.c)("creation",["taskUpscaler"])),{},{renderUpscaleOptions:function(){return(this.taskUpscaler||[]).map((function(e){return{id:e,name:e}}))}}),methods:{changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));n[t]=e,this.$emit("input",n)}}},vt=(n(3002),Object(y.a)(mt,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"handle-extra-upscale handle-item"},[t("div",{staticClass:"item-head"},[t("label",[t("i",{staticClass:"iconfont icon-tupian"}),e._v("\n      "+e._s(e.$t("Upscale"))+"\n    ")])]),e._v(" "),t("div",{staticClass:"item-content"},[t("div",{staticClass:"h-item select-item"},[t("label",[e._v(e._s(e.$t("taskUpscaler")))]),e._v(" "),t("el-select",{attrs:{value:e.value.up_scaler,placeholder:"","popper-class":"custom-select","popper-append-to-body":!1},on:{change:function(t){return e.changeConfig(t,"up_scaler")}}},e._l(e.renderUpscaleOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),t("slider-item",{attrs:{"show-tooltip":!1,value:e.value.scaling_ratio,min:1,max:4,step:.05,label:e.$t("taskScalingRatio")},on:{change:function(t){return e.changeConfig(t,"scaling_ratio")}}})],1)])}),[],!1,null,"545640f3",null).exports),gt={inject:["top"],data:function(){return{}},computed:{isShow:function(){return["imageToImage","conditionToImage","textToImage"].includes(this.top.menuIndex)&&!this.top.isStudioFlux}},methods:{sendParams:function(e){this.$emit("change",e)}}},ft=(n(3003),Object(y.a)(gt,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],staticClass:"sendParams"},["textToImage"!==e.top.menuIndex?t("span",{staticClass:"send-text",on:{click:function(t){return e.sendParams("textToImage")}}},[t("i",{staticClass:"iconfont icon-sendTextBtnIcon"}),e._v(" "),t("span",[e._v(e._s(e.$t("sendTextBtn")))])]):e._e(),e._v(" "),"imageToImage"!==e.top.menuIndex?t("span",{staticClass:"send-image",on:{click:function(t){return e.sendParams("imageToImage")}}},[t("i",{staticClass:"iconfont icon-sendImageBtnIcon"}),e._v(" "),t("span",[e._v(e._s(e.$t("sendImageBtn")))])]):e._e(),e._v(" "),"conditionToImage"!==e.top.menuIndex?t("span",{staticClass:"send-controlnet",on:{click:function(t){return e.sendParams("conditionToImage")}}},[t("i",{staticClass:"iconfont icon-sendControlNetBtnIcon"}),e._v(" "),t("span",[e._v(e._s(e.$t("sendControlNetBtn")))])]):e._e()])}),[],!1,null,"e529aae4",null).exports),_t=n(1839),bt={name:"handleJumpToOps",inject:["top"],data:function(){return{}},methods:{jumpToOps:function(){var e;null==this||null===(e=this.top)||void 0===e||e.changeMenu("promptStudio")}}},yt=(n(3010),Object(y.a)(bt,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-handle-jump-to-ops handle-item"},[t("div",{staticClass:"h-item l-item"},[t("div",{staticClass:"item-head",on:{click:e.jumpToOps}},[t("label",[t("i",{staticClass:"iconfont icon-book"}),e._v("\n\t\t\t"+e._s(e.$t("OPS_dictionary")))]),e._v(" "),t("i",{staticClass:"el-icon-circle-plus"})])])])}),[],!1,null,"76ef24d2",null).exports),wt={name:"HandleCharacterRepair",components:{SliderItem:Re.a},props:["value"],inject:["top"],data:function(){return{selectList:[{code:"",i18nKey:"none"},{code:"face",i18nKey:"repairType1"},{code:"hand",i18nKey:"repairType2"},{code:"body",i18nKey:"repairType3"}]}},methods:{changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));["ad_denoising_strength","prompt","negative_prompt"].includes(t)?n.ad_units[t]=e:n[t]=e,this.$emit("input",n)}}},Ct=(n(3011),Object(y.a)(wt,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"generate-character-repair handle-item"},[t("div",{staticClass:"item-head",on:{click:function(t){return e.changeConfig(!e.value.characterRepairZoom,"characterRepairZoom")}}},[t("label",[t("i",{staticClass:"iconfont icon-character-repair-icon1"}),e._v("\n      "+e._s(e.$t("characterRepair"))+"\n    ")]),e._v(" "),t("i",{staticClass:"el-icon-caret-bottom",class:{zoom:e.value.characterRepairZoom}})]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.value.characterRepairZoom,expression:"value.characterRepairZoom"}],staticClass:"item-content"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"expansion"!==e.top.menuIndex,expression:"top.menuIndex !== 'expansion'"}],staticClass:"h-item select-item"},[t("label",[e._v(e._s(e.$t("repairType"))+"\n        "),t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:e.$t("characterRepairTips"),placement:"top-start"}},[t("span",{staticClass:"el-icon-warning custom-tips"})])],1),e._v(" "),t("el-select",{attrs:{value:e.value.ad_model,"popper-append-to-body":!1,"popper-class":"custom-select vae-custom-select"},on:{change:function(t){return e.changeConfig(t,"ad_model")}}},e._l(e.selectList,(function(n,i){return t("el-option",{key:"method_"+i,attrs:{label:e.$t(n.i18nKey),value:n.code}},[t("el-tooltip",{attrs:{content:e.$t(n.i18nKey),placement:"top"}},[t("span",[e._v(e._s(e.$t(n.i18nKey)))])])],1)})),1)],1),e._v(" "),t("slider-item",{directives:[{name:"show",rawName:"v-show",value:""!==e.value.ad_model,expression:"value.ad_model !== ''"}],attrs:{value:e.value.ad_units.ad_denoising_strength,min:0,max:.5,step:.05,label:e.$t("redrawingNoiseIntensity"),"show-tooltip":!1},on:{change:function(t){return e.changeConfig(t,"ad_denoising_strength")}}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.value.ad_model,expression:"value.ad_model !== ''"}],staticClass:"h-item input-item"},[t("label",[e._v(e._s(e.$t("Prompt")))]),e._v(" "),t("el-input",{staticClass:"custom-input",attrs:{value:e.value.ad_units.prompt,type:"textarea",autosize:{minRows:1.5,maxRows:3},max:1e3},on:{input:function(t){return e.changeConfig(t,"prompt")}}})],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.value.ad_model,expression:"value.ad_model !== ''"}],staticClass:"h-item input-item"},[t("label",[e._v(e._s(e.$t("NegativePrompts")))]),e._v(" "),t("el-input",{staticClass:"custom-input",attrs:{value:e.value.ad_units.negative_prompt,type:"textarea",autosize:{minRows:1.5,maxRows:3},max:1e3},on:{input:function(t){return e.changeConfig(t,"negative_prompt")}}})],1)],1)])}),[],!1,null,"b5571656",null).exports),kt={name:"HandleRoop",components:{SliderItem:Re.a},props:["value"],inject:["top"],data:function(){return{isShowLink:!1,linkInput:"",uploading:!1,loadingImage:!1,dialogVisible:!1}},methods:{changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));["face_restorer_visibility","image"].includes(t)?n.roop_arg[t]=e:n[t]=e,["image"].includes(t)&&!["",null,void 0].includes(e)&&(n.restore_faces=!1),this.$emit("input",n)},changeImage:function(e){this.changeConfig(e,"image")},viewBigImage:function(){var e;["",null,void 0].includes(null==this||null===(e=this.value)||void 0===e||null===(e=e.roop_arg)||void 0===e?void 0:e.image)||(this.dialogVisible=!0)},closeViewBigImage:function(){this.dialogVisible=!1},removeImage:function(){this.changeConfig("","image"),this.closeViewBigImage()},handleBeforeUpload:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.top.UPLOAD,["image/jpeg","image/png","image/webp","image/jpg"].includes(e.type)){n.next=5;break}return t.$message.error(t.$t("AllowImageFiles")),n.abrupt("return",!1);case 5:if(!(l=e)||l.size){n.next=8;break}return n.abrupt("return",!1);case 8:if(l.size/1024/1024<=5){n.next=12;break}return t.$message.error(t.$t("UploadImageExceed5MB")),n.abrupt("return",!1);case 12:if(!t.uploading){n.next=14;break}return n.abrupt("return");case 14:return t.uploading=!0,o.startUpload(l).then((function(e){t.uploading=!1,t.changeImage(e)})).catch((function(e){console.log(e),t.uploading=!1,t.$message.error(t.$t("uploadError"))})),n.abrupt("return",!1);case 17:case"end":return n.stop()}}),n)})))()},handleLinkUpload:function(){this.checkIsImageURL(this.linkInput)?this.uploadImageByLink(this.linkInput):this.$message.warning(this.$t("InputNotAnImageLink"))},closeLinkUploadModal:function(){this.$refs.linkUploadModal&&this.$refs.linkUploadModal.doClose(),this.linkInput=""},uploadImageByLink:function(){var e=this,t={url:arguments.length>0&&void 0!==arguments[0]?arguments[0]:""};this.uploading||(this.uploading=!0,Object(A.x)(t,"link").then((function(t){var n=(t||{data:{}}).status.code,code=void 0===n?"":n;if([1e4,"10000"].includes(code)){var o=t.data.access_url;e.$emit("imageChange",o),e.closeLinkUploadModal()}else 30003===code?e.$message.error(e.$t("UploadImageExceed5MB")):e.$message.error(e.$t("GainFail"))})).finally((function(t){e.uploading=!1})))},checkIsImageURL:function(e){return/^https?:\/\/.*\.(jpg|jpeg|png|webp)$/i.test(e)},handleBeforeUploadEmpty:function(){}}},St=kt,xt=(n(3012),Object(y.a)(St,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"handle-roop handle-item"},[t("div",{staticClass:"item-head",on:{click:function(t){return e.changeConfig(!e.value.roopZoom,"roopZoom")}}},[t("label",[t("i",{staticClass:"iconfont icon-face-replace-icon"}),e._v("\n      "+e._s(e.$t("RoopLabel"))+"\n    ")]),e._v(" "),t("i",{staticClass:"el-icon-caret-bottom",class:{zoom:e.value.roopZoom}})]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.value.roopZoom,expression:"value.roopZoom"}],staticClass:"item-content"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingImage,expression:"loadingImage"}],staticClass:"item-content-image-container"},[e.value.roop_arg.image?[t("img",{staticClass:"roop-target-image",attrs:{src:e.value.roop_arg.image,alt:""}}),e._v(" "),t("div",{staticClass:"image-operate-btn-box"},[t("span",{staticClass:"el-icon-zoom-in image-operate-btn-box-icon",on:{click:function(t){return t.stopPropagation(),e.viewBigImage.apply(null,arguments)}}}),e._v(" "),t("span",{staticClass:"el-icon-delete image-operate-btn-box-icon",on:{click:function(t){return t.stopPropagation(),e.removeImage.apply(null,arguments)}}})])]:[t("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],staticClass:"image-upload",attrs:{action:"#",drag:"","before-upload":e.handleBeforeUpload,"http-request":e.handleBeforeUploadEmpty,"show-file-list":!1}},[t("i",{staticClass:"el-icon-upload image-upload-icon"}),e._v(" "),t("div",{staticClass:"el-upload__text"},[e._v("\n            "+e._s(e.$t("TaskUploadImageDragTips"))),t("em",[e._v(e._s(e.$t("TaskUploadImageClickUploadTips")))])])])]],2),e._v(" "),t("slider-item",{attrs:{value:e.value.roop_arg.face_restorer_visibility,tips:e.$t("RestoreVisibilityTips"),min:.1,max:1,step:.1,label:"Restore Visibility",disabled:"expansion"===e.top.menuIndex},on:{change:function(t){return e.changeConfig(t,"face_restorer_visibility")}}})],1),e._v(" "),e.dialogVisible?t("el-image-viewer",{staticClass:"message-img-viewer",staticStyle:{"z-index":"9999"},attrs:{"on-close":e.closeViewBigImage,"url-list":[e.value.roop_arg.image]}}):e._e()],1)}),[],!1,null,null,null)),It=xt.exports;function Ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $t={name:"HandlePromptMagic",components:{SliderItem:Re.a},props:["value"],inject:["top"],data:function(){return{isShowLink:!1,linkInput:"",uploading:!1,loadingImage:!1,dialogVisible:!1}},computed:Tt(Tt({},Object(S.c)("creation",["promptStyles","studioStyle","lab_styles"])),{},{renderList:function(){var e=this;return(this.promptStyles||[]).map((function(t){var n="sdxl_".concat(t.replace(/\s/g,""));return{label:e.$t(n)||t,id:t}}))},studioRenderList:function(){var e=this;return(this.lab_styles||[]).map((function(t){var n="labStyle_".concat(t.value.replace(/\s/g,""));return{label:e.$t(n)||t.value,id:t.value}}))},isStudioMode:function(){var e;return["textToImage","imageToImage","conditionToImage"].includes(this.top.menuIndex)&&[7,"studio",11].includes(null===(e=this.top.config[this.top.menuIndex])||void 0===e?void 0:e.category)}}),methods:{changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));["prompt_magic","prompt_style"].includes(t)?n.sdxl[t]=e:["expand_token_length","hdr_enabled","hdr_intensity","auto_brightness_open","auto_brightness_strength"].includes(t)?n.lab_base[t]=e:n[t]=e,this.$emit("input",n)},handleStyleSelectChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=JSON.parse(JSON.stringify(this.value));t.lab_base.style_selections=e,this.$emit("input",t)},changeStudioConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));["style"].includes(t)?n.studio[t]=e:n[t]=e,this.$emit("input",n)},changeImage:function(e){this.changeConfig(e,"image")},viewBigImage:function(){var e;["",null,void 0].includes(null==this||null===(e=this.value)||void 0===e||null===(e=e.roop_arg)||void 0===e?void 0:e.image)||(this.dialogVisible=!0)},closeViewBigImage:function(){this.dialogVisible=!1},removeImage:function(){this.changeConfig("","image"),this.closeViewBigImage()},handleBeforeUpload:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.top.UPLOAD,["image/jpeg","image/png","image/webp","image/jpg"].includes(e.type)){n.next=5;break}return t.$message.error(t.$t("AllowImageFiles")),n.abrupt("return",!1);case 5:if(!(l=e)||l.size){n.next=8;break}return n.abrupt("return",!1);case 8:if(l.size/1024/1024<=5){n.next=12;break}return t.$message.error(t.$t("UploadImageExceed5MB")),n.abrupt("return",!1);case 12:if(!t.uploading){n.next=14;break}return n.abrupt("return");case 14:return t.uploading=!0,o.startUpload(l).then((function(e){t.uploading=!1,t.changeImage(e)})).catch((function(e){console.log(e),t.uploading=!1,t.$message.error(t.$t("uploadError"))})),n.abrupt("return",!1);case 17:case"end":return n.stop()}}),n)})))()},handleLinkUpload:function(){this.checkIsImageURL(this.linkInput)?this.uploadImageByLink(this.linkInput):this.$message.warning(this.$t("InputNotAnImageLink"))},closeLinkUploadModal:function(){this.$refs.linkUploadModal&&this.$refs.linkUploadModal.doClose(),this.linkInput=""},uploadImageByLink:function(){var e=this,t={url:arguments.length>0&&void 0!==arguments[0]?arguments[0]:""};this.uploading||(this.uploading=!0,Object(A.x)(t,"link").then((function(t){var n=(t||{data:{}}).status.code,code=void 0===n?"":n;if([1e4,"10000"].includes(code)){var o=t.data.access_url;e.$emit("imageChange",o),e.closeLinkUploadModal()}else 30003===code?e.$message.error(e.$t("UploadImageExceed5MB")):e.$message.error(e.$t("GainFail"))})).finally((function(t){e.uploading=!1})))},checkIsImageURL:function(e){return/^https?:\/\/.*\.(jpg|jpeg|png|webp)$/i.test(e)},handleBeforeUploadEmpty:function(){}}},Lt=$t,Pt=(n(3013),n(3014),Object(y.a)(Lt,(function(){var e,t=this,n=t._self._c;return n("div",{staticClass:"handle-prompt-magic handle-item"},[n("div",{staticClass:"item-head",on:{click:function(e){return t.changeConfig(!t.value.promptMagicZoom,"promptMagicZoom")}}},[n("label",[n("i",{staticClass:"iconfont icon-home_icon_lora"}),t._v(t._s(t.$t("RelatedSettings"))+"\n      ")]),t._v(" "),n("i",{staticClass:"el-icon-caret-bottom",class:{zoom:t.value.promptMagicZoom}})]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.value.promptMagicZoom,expression:"value.promptMagicZoom"}],staticClass:"item-content"},[n("slider-item",{directives:[{name:"show",rawName:"v-show",value:null===(e=t.value.lab_base)||void 0===e||null===(e=e.style_selections)||void 0===e?void 0:e.includes("Studio Expand"),expression:"value.lab_base?.style_selections?.includes('Studio Expand')"}],attrs:{value:t.value.lab_base.expand_token_length,min:0,max:100,step:1,precision:0,"show-tooltip":!1,tips:t.$t("studio32"),label:t.$t("studio28")},on:{change:function(e){return t.changeConfig(e,"expand_token_length")}}}),t._v(" "),n("div",{staticClass:"other-style"},[n("label",[t._v("HDR\n          "),n("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:t.$t("studio11"),placement:"top-start"}},[n("span",{staticClass:"el-icon-warning custom-tips"})])],1),t._v(" "),n("el-switch",{attrs:{"active-value":!0,"inactive-value":!1,"active-color":"#3F8CFF"},on:{change:function(e){return t.changeConfig(e,"hdr_enabled")}},model:{value:t.value.lab_base.hdr_enabled,callback:function(e){t.$set(t.value.lab_base,"hdr_enabled",e)},expression:"value.lab_base.hdr_enabled"}})],1),t._v(" "),n("slider-item",{directives:[{name:"show",rawName:"v-show",value:t.value.lab_base.hdr_enabled,expression:"value.lab_base.hdr_enabled"}],attrs:{value:t.value.lab_base.hdr_intensity,min:0,max:2,step:.01,"show-tooltip":!1,precision:2,label:t.$t("studio7")},on:{change:function(e){return t.changeConfig(e,"hdr_intensity")}}}),t._v(" "),n("div",{staticClass:"other-style"},[n("label",[t._v(t._s(t.$t("studio8"))+"\n          "),n("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:t.$t("studio10"),placement:"top-start"}},[n("span",{staticClass:"el-icon-warning custom-tips"})])],1),t._v(" "),n("el-switch",{attrs:{"active-value":!0,"inactive-value":!1,"active-color":"#3F8CFF"},on:{change:function(e){return t.changeConfig(e,"auto_brightness_open")}},model:{value:t.value.lab_base.auto_brightness_open,callback:function(e){t.$set(t.value.lab_base,"auto_brightness_open",e)},expression:"value.lab_base.auto_brightness_open"}})],1),t._v(" "),n("slider-item",{directives:[{name:"show",rawName:"v-show",value:t.value.lab_base.auto_brightness_open,expression:"value.lab_base.auto_brightness_open"}],attrs:{value:t.value.lab_base.auto_brightness_strength,min:0,max:100,step:1,precision:0,"show-tooltip":!1,label:t.$t("studio27")},on:{change:function(e){return t.changeConfig(e,"auto_brightness_strength")}}})],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.value.promptMagicZoom,expression:"value.promptMagicZoom"}],staticClass:"item-content"},[n("slider-item",{directives:[{name:"show",rawName:"v-show",value:!t.isStudioMode,expression:"!isStudioMode"}],attrs:{value:t.value.base_ratio,min:.5,max:1,step:.1,"show-tooltip":!1,precision:1,label:t.$t("baseSamplingRatio"),disabled:"expansion"===t.top.menuIndex},on:{change:function(e){return t.changeConfig(e,"base_ratio")}}}),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.isStudioMode,expression:"!isStudioMode"}],staticClass:"other-style"},[n("label",[t._v(t._s(t.$t("predictMode")))]),t._v(" "),n("el-switch",{attrs:{"active-value":"gaussian","inactive-value":"none","active-color":"#3F8CFF"},on:{change:function(e){return t.changeConfig(e,"predict_mode")}},model:{value:t.value.predict_mode,callback:function(e){t.$set(t.value,"predict_mode",e)},expression:"value.predict_mode"}})],1),t._v(" "),n("slider-item",{directives:[{name:"show",rawName:"v-show",value:!t.isStudioMode&&"none"!==t.value.predict_mode,expression:"!isStudioMode && value.predict_mode !== 'none'"}],attrs:{value:t.value.predict_strength,min:.1,max:1,step:.01,"show-tooltip":!1,precision:2,label:t.$t("predictStrength"),disabled:"expansion"===t.top.menuIndex},on:{change:function(e){return t.changeConfig(e,"predict_strength")}}})],1)])}),[],!1,null,null,null).exports);function Mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mt(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Dt={name:"HandleHRepair",props:["value"],inject:["top"],data:function(){return{selectList:[{code:1,label:"1x"},{code:1.5,label:"1.5x"},{code:2,label:"2x"},{code:2.5,label:"2.5x"}]}},computed:jt(jt({},Object(S.c)("creation",["hr_upscaler"])),{},{isFastSelectActive:function(){return function(e){return e.code===this.value.hr_scale}},computedScaleSize:function(){var e=this.value.hr_scale||2;return"".concat(this.value.width*e,"x").concat(this.value.height*e)},renderList:function(){var e=(this.hr_upscaler||[]).map((function(e){return{label:e,code:e}}));return[{code:"",label:this.$t("none")}].concat(Object(R.a)(e))}}),methods:{changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));n[t]=e,this.$emit("input",n)},applyStyleSize:function(e){var t=e.code;[t*this.value.width,t*this.value.height].some((function(e){return e&&e>2048}))&&(t=2);var n=JSON.parse(JSON.stringify(this.value));n.hr_scale=t,this.$emit("input",n)}}},Nt=(n(3015),Object(y.a)(Dt,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"handle-h-repair handle-item"},[t("div",{staticClass:"item-head",on:{click:function(t){return e.changeConfig(!e.value.enable_hr,"enable_hr")}}},[t("label",[t("i",{staticClass:"iconfont icon-icon_h_d_repair"}),e._v(e._s(e.$t("ai_tools_1"))+"\n    ")]),e._v(" "),t("i",{staticClass:"el-icon-caret-bottom",class:{zoom:e.value.enable_hr}})]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.value.enable_hr,expression:"value.enable_hr"}],staticClass:"item-content"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"expansion"!==e.top.menuIndex,expression:"top.menuIndex !== 'expansion'"}],staticClass:"h-item select-item"},[t("label",[e._v(e._s(e.$t("taskRepairMethod")))]),e._v(" "),t("el-select",{attrs:{value:e.value.hr_upscaler,"popper-append-to-body":!1,"popper-class":"custom-select vae-custom-select"},on:{change:function(t){return e.changeConfig(t,"hr_upscaler")}}},e._l(e.renderList,(function(n,i){return t("el-option",{key:"method_"+i,attrs:{label:n.label,value:n.code}},[t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:n.label,placement:"top-start"}},[t("span",[e._v(e._s(n.label))])])],1)})),1)],1)])])}),[],!1,null,"7afd043b",null).exports);function Et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var At={name:"HandleAdvanceRepair",props:["value"],inject:["top"],components:{HandleHRepair:Nt,HandleCharacterRepair:Ct,SliderItem:Re.a,StyleModal:Ae.a},data:function(){return{selectList:[{code:1,label:"1x"},{code:1.5,label:"1.5x"},{code:2,label:"2x"},{code:2.5,label:"2.5x"}],characterRepairSelectList:[{code:"",i18nKey:"none"},{code:"face",i18nKey:"repairType1"},{code:"hand",i18nKey:"repairType2"},{code:"body",i18nKey:"repairType3"}]}},computed:Rt(Rt({},Object(S.c)("creation",["hr_upscaler"])),{},{isOpenUpscale:function(){return""!==this.value.hr_upscaler},isOpenCharacterRepair:function(){return""!==this.value.ad_model},isShowLora:function(){var e;return null===(e=Object.keys(this.selectLora))||void 0===e?void 0:e.length},selectLora:function(){return this.value.ad_units.lora||{}},isSdModel:function(){return[5,"5","sdxl"].includes(this.value.category)},isShowCharacterRepair:function(){var e=this.top.menuIndex;return["imageToImage","textToImage","characterRepair"].includes(e)&&!this.isStudioMode&&!this.isSdModel},isStudioMode:function(){var e;return["textToImage","imageToImage","conditionToImage"].includes(this.top.menuIndex)&&[7,"studio",11].includes(null===(e=this.top.config[this.top.menuIndex])||void 0===e?void 0:e.category)},isShowHRepair:function(){return["textToImage"].includes(this.top.menuIndex)&&[1,"1"].includes(this.value.category)&&!this.isStudioMode},isFastSelectActive:function(){return function(e){return e.code===this.value.hr_scale}},computedScaleSize:function(){var e=this.value.hr_scale||2;return"".concat(this.value.width*e,"x").concat(this.value.height*e)},renderList:function(){var e=(this.hr_upscaler||[]).map((function(e){return{label:e,code:e}}));return[{code:"",label:this.$t("none")}].concat(Object(R.a)(e))}}),methods:{showLoraPopup:function(){this.$refs.styleModal.openModal()},handleSelectLora:function(e){this.changeConfig(Rt(Rt({},e),{},{weights:.5}),"lora"),this.$refs.styleModal.handleClose()},changeWeights:function(e){this.changeConfig(Rt(Rt({},this.value.ad_units.lora),{},{weights:e}),"lora")},deleteSelectedLora:function(){this.changeConfig({},"lora")},changeUrl:function(e){return Object(k.x)(e,"high")},changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));["lora","ad_denoising_strength","ad_confidence","prompt","negative_prompt"].includes(t)?n.ad_units[t]=e:("hr_upscaler"===t&&(n.enable_hr=""!==e),n[t]=e),this.$emit("input",n)},applyStyleSize:function(e){var t=e.code;[t*this.value.width,t*this.value.height].some((function(e){return e&&e>2048}))&&(t=2);var n=JSON.parse(JSON.stringify(this.value));n.hr_scale=t,this.$emit("input",n)}}},Bt=(n(3016),Object(y.a)(At,(function(){var e,t,n=this,o=n._self._c;return o("div",{staticClass:"handle-advance-repair handle-item"},[o("div",{staticClass:"item-head",on:{click:function(e){return n.changeConfig(!n.value.advanceRepairZoom,"advanceRepairZoom")}}},[o("label",[o("i",{staticClass:"iconfont icon-character-repair-icon1"}),n._v("\n      "+n._s(n.$t("AdvancedRepair"))+"\n    ")]),n._v(" "),o("i",{staticClass:"el-icon-caret-bottom",class:{zoom:n.value.advanceRepairZoom}})]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.value.advanceRepairZoom&&n.isShowHRepair,expression:"value.advanceRepairZoom && isShowHRepair"}],staticClass:"item-content",class:[n.isOpenUpscale?"item-content-spacial":""]},[o("div",{directives:[{name:"show",rawName:"v-show",value:"expansion"!==n.top.menuIndex,expression:"top.menuIndex !== 'expansion'"}],staticClass:"h-item select-item"},[o("label",[n._v(n._s(n.$t("taskTabUpscale")))]),n._v(" "),o("el-select",{attrs:{value:n.value.hr_upscaler,"popper-append-to-body":!0,"popper-class":"custom-select vae-custom-select"},on:{change:function(e){return n.changeConfig(e,"hr_upscaler")}}},n._l(n.renderList,(function(e,i){return o("el-option",{key:"method_"+i,attrs:{label:e.label,value:e.code}},[o("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.label,placement:"top-start"}},[o("span",[n._v(n._s(e.label))])])],1)})),1)],1),n._v(" "),o("slider-item",{directives:[{name:"show",rawName:"v-show",value:n.isOpenUpscale,expression:"isOpenUpscale"}],attrs:{value:n.value.hr_second_pass_steps,min:1,max:60,step:1,label:n.$t("UpscaleSamplingTimes"),"show-tooltip":!1},on:{change:function(e){return n.changeConfig(e,"hr_second_pass_steps")}}}),n._v(" "),o("slider-item",{directives:[{name:"show",rawName:"v-show",value:n.isOpenUpscale,expression:"isOpenUpscale"}],attrs:{value:n.value.hr_upscaler_redraw,min:0,max:1,step:.1,label:n.$t("RedrawNoiseIntensity"),"show-tooltip":!1},on:{change:function(e){return n.changeConfig(e,"hr_upscaler_redraw")}}})],1),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.value.advanceRepairZoom&&n.isShowCharacterRepair,expression:"value.advanceRepairZoom && isShowCharacterRepair"}],staticClass:"item-content",class:[n.isOpenCharacterRepair?"item-content-spacial":""]},[o("div",{directives:[{name:"show",rawName:"v-show",value:"expansion"!==n.top.menuIndex,expression:"top.menuIndex !== 'expansion'"}],staticClass:"h-item select-item",class:[""!==n.value.ad_model?"h-item-spacial-border":""]},[o("label",[n._v("\n        "+n._s(n.$t("characterRepair"))+"\n        "),o("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:n.$t("characterRepairTips"),placement:"top-start"}},[o("span",{staticClass:"el-icon-warning custom-tips"})])],1),n._v(" "),o("el-select",{attrs:{value:n.value.ad_model,"popper-append-to-body":!0,"popper-class":"custom-select vae-custom-select"},on:{change:function(e){return n.changeConfig(e,"ad_model")}}},n._l(n.characterRepairSelectList,(function(e,i){return o("el-option",{key:"method_"+i,attrs:{label:n.$t(e.i18nKey),value:e.code}},[o("el-tooltip",{attrs:{content:n.$t(e.i18nKey),placement:"top"}},[o("span",[n._v(n._s(n.$t(e.i18nKey)))])])],1)})),1)],1),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.isOpenCharacterRepair,expression:"isOpenCharacterRepair"}],staticClass:"h-item l-item"},[o("div",{staticClass:"item-head",on:{click:function(e){return n.showLoraPopup()}}},[o("label",[n._v("\n          "+n._s(n.$t("LoRA"))+"\n        ")]),n._v(" "),n.isShowLora?n._e():o("i",{staticClass:"el-icon-circle-plus"})]),n._v(" "),n.isShowLora?o("div",{staticClass:"item-lora"},[null!==(e=n.selectLora)&&void 0!==e&&null!==(e=e.banner)&&void 0!==e&&e.url?o("el-image",{attrs:{src:n.changeUrl(n.selectLora.banner.url)}},[o("template",{slot:"placeholder"},[o("i",{staticClass:"el-icon-loading image-loading"})])],2):o("p",{staticClass:"empty-img"},[n._v(n._s(n.$t("EmptyBannerText")))]),n._v(" "),o("div",{staticClass:"right"},[o("div",{staticClass:"top"},[o("div",{staticClass:"name",attrs:{title:n.selectLora.name}},[n._v(n._s(n.selectLora.name))]),n._v(" "),o("i",{staticClass:"el-icon-delete",on:{click:function(e){return n.deleteSelectedLora()}}})]),n._v(" "),o("div",{staticClass:"bottom"},[o("el-slider",{staticClass:"slider-item",attrs:{value:n.selectLora.weights,min:-2,max:2,step:.1,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(e){return n.changeWeights(e)}}})],1)])],1):n._e()]),n._v(" "),o("slider-item",{directives:[{name:"show",rawName:"v-show",value:n.isOpenCharacterRepair,expression:"isOpenCharacterRepair"}],attrs:{value:n.value.ad_units.ad_denoising_strength,min:0,max:.5,step:.05,label:n.$t("redrawingNoiseIntensity"),"show-tooltip":!1},on:{change:function(e){return n.changeConfig(e,"ad_denoising_strength")}}}),n._v(" "),o("slider-item",{directives:[{name:"show",rawName:"v-show",value:n.isOpenCharacterRepair,expression:"isOpenCharacterRepair"}],attrs:{value:n.value.ad_units.ad_confidence,min:0,max:1,step:.1,label:n.$t("Confidence"),"show-tooltip":!1},on:{change:function(e){return n.changeConfig(e,"ad_confidence")}}}),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.isOpenCharacterRepair,expression:"isOpenCharacterRepair"}],staticClass:"h-item input-item h-item-spacial"},[o("label",[n._v(n._s(n.$t("Prompt")))]),n._v(" "),o("el-input",{staticClass:"custom-input",attrs:{value:n.value.ad_units.prompt,type:"textarea",autosize:{minRows:1.5,maxRows:3},max:1e3},on:{input:function(e){return n.changeConfig(e,"prompt")}}})],1),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.isOpenCharacterRepair,expression:"isOpenCharacterRepair"}],staticClass:"h-item input-item h-item-spacial"},[o("label",[n._v(n._s(n.$t("NegativePrompts")))]),n._v(" "),o("el-input",{staticClass:"custom-input",attrs:{value:n.value.ad_units.negative_prompt,type:"textarea",autosize:{minRows:1.5,maxRows:3},max:1e3},on:{input:function(e){return n.changeConfig(e,"negative_prompt")}}})],1)],1),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.value.advanceRepairZoom&&!["expansion","characterRepair"].includes(n.top.menuIndex)&&!n.isSdModel&&!n.isStudioMode,expression:"value.advanceRepairZoom && !['expansion','characterRepair'].includes(top.menuIndex) && !isSdModel && !isStudioMode"}],staticClass:"item-content"},[o("div",{staticClass:"other-style"},[o("label",[n._v(n._s(n.$t("RestoreFaces")))]),n._v(" "),o("el-switch",{attrs:{"active-color":"#3F8CFF"},on:{change:function(e){return n.changeConfig(e,"restore_faces")}},model:{value:n.value.restore_faces,callback:function(e){n.$set(n.value,"restore_faces",e)},expression:"value.restore_faces"}})],1)]),n._v(" "),o("style-modal",{ref:"styleModal",attrs:{"model-type":"LORA","select-list":null!==(t=n.selectLora)&&void 0!==t&&t.id?[n.selectLora.id]:[],isSDXL:n.isSdModel,inTask:!0},on:{selectModel:n.handleSelectLora}})],1)}),[],!1,null,"5329f147",null).exports),Ut=n(45),Ft={name:"HandleFaceSwap",components:{SliderItem:Re.a},props:["value"],inject:["top"],data:function(){return{isShowLink:!1,linkInput:"",uploading:!1,loadingImage:!1,dialogVisible:!1}},methods:{changeConfig:function(e,t){var n=JSON.parse(JSON.stringify(this.value));["face_distance","source_uri"].includes(t)?n.exchange_face[t]=e:n[t]=e,["source_uri"].includes(t)&&!["",null,void 0].includes(e)&&(n.restore_faces=!1),this.$emit("input",n)},changeImage:function(e){this.changeConfig(e,"source_uri")},viewBigImage:function(){var e;["",null,void 0].includes(null==this||null===(e=this.value)||void 0===e||null===(e=e.exchange_face)||void 0===e?void 0:e.source_uri)||(this.dialogVisible=!0)},closeViewBigImage:function(){this.dialogVisible=!1},removeImage:function(){this.changeConfig("","source_uri"),this.closeViewBigImage()},handleBeforeUpload:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.top.UPLOAD,["image/jpeg","image/png","image/webp","image/jpg"].includes(e.type)){n.next=5;break}return t.$message.error(t.$t("AllowImageFiles")),n.abrupt("return",!1);case 5:if(!(l=e)||l.size){n.next=8;break}return n.abrupt("return",!1);case 8:if(!(l.size/1024/1024>10)){n.next=19;break}return n.prev=9,n.next=12,Object(Ut.a)(l,10485760);case 12:l=n.sent,n.next=19;break;case 15:return n.prev=15,n.t0=n.catch(9),console.error("Compression failed:",n.t0),n.abrupt("return",!1);case 19:if(!t.uploading){n.next=21;break}return n.abrupt("return");case 21:return t.uploading=!0,o.startUpload(l,{category:16}).then((function(e){t.uploading=!1,t.changeImage(e)})).catch((function(e){console.log(e),t.uploading=!1,t.$message.error(t.$t("uploadError"))})),n.abrupt("return",!1);case 24:case"end":return n.stop()}}),n,null,[[9,15]])})))()},preprocessingImages:function(e){return new Promise((function(t,n){var o=new FileReader;o.addEventListener("load",(function(){var image=new Image;image.addEventListener("load",(function(){var canvas=document.createElement("canvas");canvas.width=image.width,canvas.height=image.height,canvas.getContext("2d").drawImage(image,0,0,canvas.width,canvas.height);var n=canvas.toDataURL("image/png",1),o=Object(B.a)(n),l=new File([o],e.name.replace(/\.\w+$/,".png"),{type:"image/png"});t(l)})),image.src=o.result})),o.addEventListener("error",(function(){console.log("Failed to read the file."),n(new Error("Failed to read the file."))})),o.readAsDataURL(e)})).catch((function(e){return Promise.reject(new Error("Failed to convert the image to PNG format."))}))},handleLinkUpload:function(){this.checkIsImageURL(this.linkInput)?this.uploadImageByLink(this.linkInput):this.$message.warning(this.$t("InputNotAnImageLink"))},closeLinkUploadModal:function(){this.$refs.linkUploadModal&&this.$refs.linkUploadModal.doClose(),this.linkInput=""},uploadImageByLink:function(){var e=this,t={url:arguments.length>0&&void 0!==arguments[0]?arguments[0]:""};this.uploading||(this.uploading=!0,Object(A.x)(t,"link").then((function(t){var n=(t||{data:{}}).status.code,code=void 0===n?"":n;if([1e4,"10000"].includes(code)){var o=t.data.access_url;e.$emit("imageChange",o),e.closeLinkUploadModal()}else 30003===code?e.$message.error(e.$t("UploadImageExceed5MB")):e.$message.error(e.$t("GainFail"))})).finally((function(t){e.uploading=!1})))},checkIsImageURL:function(e){return/^https?:\/\/.*\.(jpg|jpeg|png|webp)$/i.test(e)},handleBeforeUploadEmpty:function(){}}},zt=Ft,Vt=(n(3017),Object(y.a)(zt,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"handle-face-swap handle-item"},[t("div",{staticClass:"item-head",on:{click:function(t){return e.changeConfig(!e.value.faceSwapZoom,"faceSwapZoom")}}},[t("label",[t("i",{staticClass:"iconfont icon-face-replace-icon"}),e._v("\n      "+e._s(e.$t("RoopLabel"))+"\n    ")]),e._v(" "),t("i",{staticClass:"el-icon-caret-bottom",class:{zoom:e.value.faceSwapZoom}})]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.value.faceSwapZoom,expression:"value.faceSwapZoom"}],staticClass:"item-content"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingImage,expression:"loadingImage"}],staticClass:"item-content-image-container"},[e.value.exchange_face.source_uri?[t("img",{staticClass:"roop-target-image",attrs:{src:e.value.exchange_face.source_uri,alt:""}}),e._v(" "),t("div",{staticClass:"image-operate-btn-box"},[t("span",{staticClass:"el-icon-zoom-in image-operate-btn-box-icon",on:{click:function(t){return t.stopPropagation(),e.viewBigImage.apply(null,arguments)}}}),e._v(" "),t("span",{staticClass:"el-icon-delete image-operate-btn-box-icon",on:{click:function(t){return t.stopPropagation(),e.removeImage.apply(null,arguments)}}})])]:[t("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],staticClass:"image-upload",attrs:{action:"#",drag:"","before-upload":e.handleBeforeUpload,"http-request":e.handleBeforeUploadEmpty,"show-file-list":!1}},[t("i",{staticClass:"el-icon-upload image-upload-icon"}),e._v(" "),t("div",{staticClass:"el-upload__text"},[e._v("\n            "+e._s(e.$t("TaskUploadImageDragTips"))),t("em",[e._v(e._s(e.$t("TaskUploadImageClickUploadTips")))])])])]],2)]),e._v(" "),e.dialogVisible?t("el-image-viewer",{staticClass:"message-img-viewer",staticStyle:{"z-index":"9999"},attrs:{"on-close":e.closeViewBigImage,"url-list":[e.value.exchange_face.image]}}):e._e()],1)}),[],!1,null,null,null)),Wt=Vt.exports;function Ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var qt={props:["value"],components:{SliderItem:Re.a},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(S.c)("creation",["animationLoraRecommends"])),data:function(){return{visible:!1,cover:"",timeList:[{label:this.$t("shortVersion"),value:0},{label:this.$t("longVersion"),value:1}]}},methods:{sliderChange:function(e){var t=JSON.parse(JSON.stringify(this.value));t.animatediff.weight=e,this.$emit("input",t)},timeChange:function(e){var t=JSON.parse(JSON.stringify(this.value));t.animatediff.category=e,this.$emit("input",t)},setModel:function(e){this.cover=e.url;var t=JSON.parse(JSON.stringify(this.value));t.animatediff.weight=1,t.animatediff.lora=e.value,this.$emit("input",t),this.visible=!1},deleteModel:function(){var e=JSON.parse(JSON.stringify(this.value));e.animatediff.lora="",this.$emit("input",e)}}},Gt=qt,Jt=(n(3018),n(3019),Object(y.a)(Gt,(function(){var e,t,n,o=this,l=o._self._c;return l("div",{staticClass:"HandleAnimGen"},[l("div",{staticClass:"title"},[l("i",{staticClass:"iconfont icon-AnimGenIcon"}),o._v(" "),l("span",[o._v(o._s(o.$t("AnimGen")))])]),o._v(" "),l("div",{staticClass:"modelBox"},[l("div",{staticClass:"modelTit",on:{click:function(e){o.visible=!0}}},[l("span",{staticClass:"titTxt"},[o._v("MotionLoRA")]),o._v(" "),null!==(e=o.value.animatediff)&&void 0!==e&&e.lora?l("div",[l("i",{staticClass:"iconfont icon-select-model-icon"}),o._v(" "),l("span",[o._v(o._s(o.$t("switch")))])]):l("i",{staticClass:"el-icon-circle-plus"})]),o._v(" "),null!==(t=o.value.animatediff)&&void 0!==t&&t.lora?l("div",{staticClass:"modelInfo"},[l("video",{attrs:{src:this.cover,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0}}),o._v(" "),l("div",[l("div",{staticClass:"indModelName"},[l("span",[o._v(o._s(null===(n=o.value.animatediff)||void 0===n?void 0:n.lora))]),o._v(" "),l("i",{staticClass:"el-icon-delete",on:{click:o.deleteModel}})]),o._v(" "),l("div",{staticClass:"item-content slider-item"},[l("el-slider",{attrs:{min:-1,max:2,step:.05,"show-input":!0,"show-input-controls":!1},on:{change:o.sliderChange},model:{value:o.value.animatediff.weight,callback:function(e){o.$set(o.value.animatediff,"weight",e)},expression:"value.animatediff.weight"}})],1)])]):o._e()]),o._v(" "),l("div",{staticClass:"select-item"},[l("label",[o._v(o._s(o.$t("animDur")))]),o._v(" "),l("el-select",{attrs:{"popper-class":"custom-select","popper-append-to-body":!1},on:{change:o.timeChange},model:{value:o.value.animatediff.category,callback:function(e){o.$set(o.value.animatediff,"category",e)},expression:"value.animatediff.category"}},o._l(o.timeList,(function(e){return l("el-option",{key:e.item,attrs:{label:e.label,value:e.value}})})),1)],1),o._v(" "),l("el-dialog",{attrs:{visible:o.visible,"custom-class":"styleModal",width:"1376px",title:"MotionLoRA","modal-append-to-body":!0,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){o.visible=e}}},[l("div",{staticClass:"modelList"},o._l(o.animationLoraRecommends,(function(e){var t,n;return l("div",{key:e.value,staticClass:"modelItem",class:{modelItemA:(null===(t=o.value.animatediff)||void 0===t?void 0:t.lora)==e.value},on:{click:function(t){return o.setModel(e)}}},[l("video",{style:{transform:(null===(n=o.value.animatediff)||void 0===n?void 0:n.lora)==e.value?"scale(0.8)":""},attrs:{src:e.url,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0}}),o._v(" "),l("div",{staticClass:"modelName"},[o._v(o._s(e.value))])])})),0)])],1)}),[],!1,null,"10d75640",null).exports);function Kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kt(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qt={components:{HandleModel:at,HandleStyle:ut,HandleAdvanced:He,HandleControlNet:Xe,HandExtraUpscale:vt,HandleImage:Ze,HandleSend:ft,selectGenerateModelType:_t.a,handleJumpToOps:yt,HandleCharacterRepair:Ct,HandleRoop:It,HandlePromptMagic:Pt,HandleHRepair:Nt,HandleFaceSwap:Wt,HandleAdvanceRepair:Bt,HandleAnimGen:Jt},props:["value"],inject:["top"],data:function(){return{oldTabIndex:"SET"}},computed:Xt(Xt({},Object(S.e)("user",["userInfo"])),{},{isShowSetting:function(){var e=!["promptStudio","extraUpscale","descriptors","preview","faceSwap"].includes(this.top.menuIndex),t=this.isShowModel,n=e||t;return["promptStudio","extraUpscale","descriptors","preview","faceSwap"].includes(this.top.menuIndex)&&(n=!1),n},isShowHRepair:function(){return["textToImage"].includes(this.top.menuIndex)&&[1,"1"].includes(this.value.category)&&!this.isStudioMode},checkEnableStudio:function(){return!0},activeHeadItem:function(){return function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(null==this||null===(e=this.top)||void 0===e?void 0:e.creativeMode)===t?"head-item-active":""}},isStudioMode:function(){var e;return["textToImage","imageToImage","conditionToImage"].includes(this.top.menuIndex)&&[7,"studio",11].includes(null===(e=this.top.config[this.top.menuIndex])||void 0===e?void 0:e.category)},isShowModel:function(){return!["faceSwap","preview"].includes(this.top.menuIndex)&&![3,"3",4,"4",7].includes(this.value.category)&&!this.isStudioMode},isShowFaceSwap:function(){return"faceSwap"===this.top.menuIndex},isShowJump:function(){return"textToImage"===this.top.menuIndex&&[3,"3"].includes(this.value.category)&&!this.isStudioMode},isShowStyle:function(){return!["faceSwap","preview","characterRepair"].includes(this.top.menuIndex)&&![3,"3"].includes(this.value.category)},isShowAdvanced:function(){var e=this.value.category;return!["faceSwap","preview","characterRepair"].includes(this.top.menuIndex)&&![3,"3",4,"4"].includes(e)},isSdModel:function(){return["5",5].includes(this.value.category)},isShowCharacterRepair:function(){var e=this.top.menuIndex;return["imageToImage","textToImage","characterRepair"].includes(e)&&!this.isStudioMode&&!this.isSdModel},isShowControlNet:function(){var e=this.top.menuIndex,t=this.value.workIndex;return["preview","conditionToImage"].includes(e)||t<3&&"imageToImage"===e&&!this.isStudioMode},isShowRedraw:function(){var e=this.value.workIndex;return"imageToImage"===this.top.menuIndex&&3===e},handleModelType:function(){return["textToImage","imageToImage","conditionToImage"].includes(this.top.menuIndex)}}),methods:{changeConfig:function(e){this.$emit("input",e)},sendParams:function(e){this.$emit("sendParams",e)},changeTab:function(e){this.top.changeHandle({handleType:e})},handleChangeMode:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e&&"studio"===e&&!this.checkEnableStudio)return this.$message.warning(this.$t("studioTips")),void this.top.changeHandle({creativeMode:"normal"});this.top.changeHandle({creativeMode:e})}}},Zt=Qt,Yt=(n(3020),Object(y.a)(Zt,(function(){var e,t,n=this,o=n._self._c;return o("div",{staticClass:"generate-handle custom-form"},[o("div",{staticClass:"head",class:[n.handleModelType?"head-flex":""]},[o("div",{directives:[{name:"show",rawName:"v-show",value:n.handleModelType,expression:"handleModelType"}],staticClass:"head-tab-box"},[o("div",{staticClass:"head-item",class:[n.activeHeadItem("normal")],on:{click:function(e){return e.stopPropagation(),n.handleChangeMode("normal")}}},[n._v("\n        "+n._s(n.$t("createModeType1"))+"\n      ")]),n._v(" "),o("div",{staticClass:"head-item",class:[n.activeHeadItem("sdxl")],on:{click:function(e){return e.stopPropagation(),n.handleChangeMode("sdxl")}}},[n._v("\n        "+n._s(n.$t("createModeType5"))+"\n      ")]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:["textToImage","imageToImage","conditionToImage"].includes(n.top.menuIndex),expression:"['textToImage','imageToImage','conditionToImage'].includes(top.menuIndex)"}],staticClass:"head-item head-item-studio",class:[n.activeHeadItem("studio")],on:{click:function(e){return e.stopPropagation(),n.handleChangeMode("studio")}}},[n._v("\n        "+n._s(n.$t("studio"))+"\n      ")])])]),n._v(" "),o("div",{staticClass:"handle-list"},[o("div",{directives:[{name:"show",rawName:"v-show",value:"animGen"!=n.top.menuIndex,expression:"top.menuIndex != 'animGen'"}],staticClass:"handle-panel"},[o("select-generate-model-type",{directives:[{name:"show",rawName:"v-show",value:n.isShowSetting,expression:"isShowSetting"}],attrs:{value:n.value},on:{input:n.changeConfig}}),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!["extraUpscale","descriptors"].includes(n.top.menuIndex),expression:"!['extraUpscale', 'descriptors'].includes(top.menuIndex)"}],staticClass:"handle-common"},[o("handle-jump-to-ops",{directives:[{name:"show",rawName:"v-show",value:n.isShowJump,expression:"isShowJump"}]}),n._v(" "),o("handle-style",{directives:[{name:"show",rawName:"v-show",value:n.isShowStyle,expression:"isShowStyle"}],attrs:{value:n.value},on:{input:n.changeConfig}}),n._v(" "),o("handle-image",{directives:[{name:"show",rawName:"v-show",value:n.isShowRedraw,expression:"isShowRedraw"}],attrs:{value:n.value},on:{input:n.changeConfig}}),n._v(" "),n.isShowControlNet?o("handle-control-net",{attrs:{value:n.value},on:{input:n.changeConfig}}):n._e(),n._v(" "),o("handle-prompt-magic",{directives:[{name:"show",rawName:"v-show",value:n.isStudioMode&&!(null!==(e=n.top)&&void 0!==e&&e.isStudioFlux)&&!(null!==(t=n.top)&&void 0!==t&&t.isStudioSD35Mode),expression:"isStudioMode && !top?.isStudioFlux && !top?.isStudioSD35Mode"}],attrs:{value:n.value},on:{input:n.changeConfig}}),n._v(" "),o("handle-advanced",{directives:[{name:"show",rawName:"v-show",value:n.isShowAdvanced,expression:"isShowAdvanced"}],attrs:{value:n.value},on:{input:n.changeConfig}}),n._v(" "),o("handle-face-swap",{directives:[{name:"show",rawName:"v-show",value:n.isShowFaceSwap,expression:"isShowFaceSwap"}],attrs:{value:n.value},on:{input:n.changeConfig}}),n._v(" "),o("handle-advance-repair",{directives:[{name:"show",rawName:"v-show",value:n.isShowCharacterRepair||n.isShowHRepair,expression:"isShowCharacterRepair || isShowHRepair"}],attrs:{value:n.value},on:{input:n.changeConfig}})],1),n._v(" "),o("hand-extra-upscale",{directives:[{name:"show",rawName:"v-show",value:"extraUpscale"===n.top.menuIndex,expression:"top.menuIndex === 'extraUpscale'"}],attrs:{value:n.value},on:{input:n.changeConfig}}),n._v(" "),[3,"3","7",7].includes(n.value.category)?n._e():o("handle-send",{on:{change:n.sendParams}})],1),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:"animGen"==n.top.menuIndex,expression:"top.menuIndex == 'animGen'"}],staticClass:"handle-panel"},[o("handle-anim-gen",{attrs:{value:n.value},on:{input:n.changeConfig}})],1)])])}),[],!1,null,"21455d3e",null).exports),ei=(n(142),n(143),{imageToImage:36,conditionToImage:37,animGen:38,expansion:39,extraUpscale:40,characterRepair:41,descriptors:42,preview:43}),ti={inject:["top"],data:function(){return{isShowLink:!1,linkInput:"",uploading:!1}},computed:{baseSize:function(){return["characterRepair","extraUpscale","faceSwap"].includes(this.top.menuIndex)?10:5}},watch:{"top.isShowPopup":function(e){this.isShowLink=!1}},methods:{handleBeforeUpload:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m,v,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.top,l=o.menuIndex,r=o.config,c=o.UPLOAD,["image/jpeg","image/png","image/webp","image/jpg"].includes(e.type)){n.next=5;break}return t.$message.error(t.$t("AllowImageFiles")),n.abrupt("return",!1);case 5:if(!(d=e)||d.size){n.next=8;break}return n.abrupt("return",!1);case 8:if(h=["faceSwap"].includes(t.top.menuIndex),m={category:2},h&&(m.category=16),ei[l]&&(m.category=ei[l]),d.size/1024/1024<=t.baseSize){n.next=24;break}return n.prev=14,n.next=17,Object(Ut.a)(d,1024*t.baseSize*1024);case 17:d=n.sent,n.next=24;break;case 20:return n.prev=20,n.t0=n.catch(14),console.error("Compression failed:",n.t0),n.abrupt("return",!1);case 24:if(!t.uploading){n.next=26;break}return n.abrupt("return");case 26:return t.uploading=!0,v=URL.createObjectURL(new Blob([t.fileToBlob(e)])),f=r[l].workIndex,t.top.setUploadImageStatus(l,!0),t.$emit("imageChange",{file:v,uploading:!0},f),c.startUpload(d,m).then((function(e){t.uploading=!1,t.$emit("imageChange",{url:e,file:v,uploading:!1},f),t.closeLinkUploadModal(),t.top.setUploadImageStatus(l,!0)})).catch((function(e){t.uploading=!1,t.$emit("imageChange",{uploading:!1,url:"",file:""},f),t.top.setUploadImageStatus(l,!1),t.$message.error(t.$t("uploadError"))})).finally((function(){t.uploading=!1})),n.abrupt("return",!1);case 33:case"end":return n.stop()}}),n,null,[[14,20]])})))()},handleLinkUpload:function(){this.checkIsImageURL(this.linkInput)?this.uploadImageByLink(this.linkInput):this.$message.warning(this.$t("InputNotAnImageLink"))},closeLinkUploadModal:function(){this.$refs.linkUploadModal&&this.$refs.linkUploadModal.doClose(),this.linkInput=""},uploadImageByLink:function(){var e=this,link=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this.top,n=t.menuIndex,o=t.config[n].workIndex,l={url:link};this.uploading||(this.uploading=!0,this.$emit("imageChange",{file:link,uploading:!0},o),Object(A.x)(l,"link").then((function(t){e.uploading=!1;var n=(t||{data:{}}).status.code,code=void 0===n?"":n;if([1e4,"10000"].includes(code)){var l=t.data.access_url;e.$emit("imageChange",{url:l,file:link,uploading:!1},o),e.top.setUploadImageStatus(e.top.menuIndex,!0),e.closeLinkUploadModal()}else 30003===code?(e.$message.error(e.$t("UploadImageExceed5MB")),e.top.setUploadImageStatus(e.top.menuIndex,!1),e.$emit("imageChange",{uploading:!1,url:"",file:""},o)):(e.$message.error(e.$t("GainFail")),e.top.setUploadImageStatus(e.top.menuIndex,!1),e.$emit("imageChange",{uploading:!1,url:"",file:""},o))})).finally((function(t){e.uploading=!1})))},checkIsImageURL:function(e){return/^https?:\/\/.*\.(jpg|jpeg|png|webp)$/i.test(e)},handleBeforeUploadEmpty:function(){},fileToBlob:function(e){return e.slice(0,e.size,e.type)}}},ii=ti,ni=(n(3021),Object(y.a)(ii,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"upload-panel"},[t("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],staticClass:"image-upload",attrs:{action:"#",drag:"","before-upload":e.handleBeforeUpload,accept:".jpg,.png,.jpeg,.webp","http-request":e.handleBeforeUploadEmpty,"show-file-list":!1}},[t("i",{staticClass:"el-icon-upload image-upload-icon"}),e._v(" "),t("div",{staticClass:"el-upload__text"},[e._v("\n      "+e._s(e.$t("TaskUploadImageDragTips"))),t("em",[e._v(e._s(e.$t("TaskUploadImageClickUploadTips")))]),e._v(" "),["faceSwap"].includes(e.top.menuIndex)?[t("p",{staticClass:"el-upload__text2"},[e._v(e._s(e.$t("faceSwapStep1",{number:10})))]),e._v(" "),t("p",{staticClass:"el-upload__text2"},[e._v(e._s(e.$t("faceSwapStep2")))])]:e._e()],2)]),e._v(" "),t("span",{staticClass:"upload-link"},[t("span",{staticClass:"link-btn",on:{click:function(t){e.isShowLink=!e.isShowLink}}},[t("i",{staticClass:"iconfont icon-url-line-icon"}),e._v("\n      "+e._s(e.$t("TaskUploadImageFromUrl"))+"\n    ")]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowLink,expression:"isShowLink"}],staticClass:"link-input"},[t("el-input",{attrs:{placeholder:""},model:{value:e.linkInput,callback:function(t){e.linkInput=t},expression:"linkInput"}},[t("el-button",{staticClass:"custom-btn",attrs:{slot:"append",type:"primary",loading:e.uploading},on:{click:e.handleLinkUpload},slot:"append"},[e._v("\n          "+e._s(e.$t("TaskUploadImageGoGotIt"))+"\n        ")])],1)],1)])],1)}),[],!1,null,"71973d7a",null).exports),ai=(n(85),n(101),n(75),n(89),{name:"GImageDraw",inject:["top"],props:{autoStyle:{type:Object,default:function(){return{}}},brushSize:{type:Number,default:function(){return 20}},eraserSize:{type:Number,default:function(){return 20}},toolsType:{type:String,default:function(){return""}},maskUrl:{type:String,default:function(){return""}}},watch:{toolsType:{handler:function(){this.setDrawType(),this.setCanvasStyle()}},eraserSize:{handler:function(){this.setCanvasStyle()},immediate:!0,deep:!0},brushSize:{handler:function(){this.setCanvasStyle()},immediate:!0,deep:!0},"top.config.imageToImage.tempMask":{handler:function(e,t){e&&e.includes("data:image/png;base64")&&["",null,void 0].includes(t)&&this.displayMaskToCanvas(e)},immediate:!0,deep:!0}},data:function(){return{canvasWidth:400,canvasHeight:300,brushColor:"white",isDrawing:!1,lastX:0,lastY:0,canvasStyle:{},blankCanvas:"",blankBgCanvas:"",imageData:null}},mounted:function(){this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),this.initBgCanvas(),this.ctx.strokeStyle=this.brushColor,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.lineWidth="ERASER"===this.toolsType?4*this.eraserSize:4*this.brushSize,document.addEventListener("mouseup",this.stopDrawing),this.canvas.addEventListener("mousedown",this.startDrawing),this.canvas.addEventListener("mousemove",this.draw),this.canvas.addEventListener("mouseup",this.stopDrawing),this.blankCanvas=this.canvas.toDataURL(),this.saveBackgroundCanvas()},beforeDestroy:function(){this.canvas.removeEventListener("mousedown",this.startDrawing),this.canvas.removeEventListener("mousemove",this.draw),this.canvas.removeEventListener("mouseup",this.stopDrawing),window.removeEventListener("mouseup",this.stopDrawing)},methods:{saveCurrentDraw:function(){this.imageData=this.canvas.toDataURL()},displaySaveDraw:function(){var e=this;this.$nextTick((function(){e.displayMaskToCanvas(e.imageData,!1),e.imageData=null}))},displayMaskToCanvas:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],img=new Image;img.onload=function(){e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.ctx.drawImage(img,0,0,e.canvas.width,e.canvas.height),e.saveDrawingToBase64(n)},img.onerror=function(e){console.log(e,"888")},img.src=t},setCanvasStyle:function(){var e="ERASER"===this.toolsType?4*this.eraserSize:4*this.brushSize,t='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="'.concat(e,'" height="').concat(e,'" viewBox="0 0 32 32">\n  <path fill="none" stroke="#fff" stroke-linejoin="miter" stroke-linecap="butt" stroke-miterlimit="4" stroke-width="1.9048" d="M31.048 16c0 8.311-6.737 15.048-15.048 15.048s-15.048-6.737-15.048-15.048c0-8.311 6.737-15.048 15.048-15.048s15.048 6.737 15.048 15.048z"></path>\n  </svg>'),n=btoa(t),o="data:image/svg+xml;base64,".concat(n);this.canvasStyle={cursor:"url(".concat(o,") ").concat(e/2," ").concat(e/2,", auto")}},initBgCanvas:function(){this.canvas2=this.$refs.canvas2,this.bgCtx=this.canvas2.getContext("2d"),this.bgCtx.fillStyle="black",this.bgCtx.fillRect(0,0,this.canvas2.width,this.canvas2.height)},saveBackgroundCanvas:function(){try{this.bgCtx.clearRect(0,0,this.canvas2.width,this.canvas2.height),this.bgCtx.fillStyle="black",this.bgCtx.fillRect(0,0,this.canvas2.width,this.canvas2.height),this.bgCtx.drawImage(this.canvas,0,0,this.canvas2.width,this.canvas2.height),this.blankBgCanvas=this.canvas2.toDataURL("image/png",.05)}catch(e){}},setDrawType:function(){this.ctx&&(this.ctx.strokeStyle=this.brushColor,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.globalCompositeOperation="ERASER"===this.toolsType?"destination-out":"source-over")},startDrawing:function(e){this.isDrawing=!0,this.setDrawType();var t=[e.offsetX,e.offsetY];this.lastX=t[0],this.lastY=t[1],this.ctx.beginPath(),this.ctx.moveTo(e.offsetX,e.offsetY)},draw:function(e){if(this.isDrawing){this.ctx.lineWidth="ERASER"===this.toolsType?4*this.eraserSize:4*this.brushSize,this.ctx.strokeStyle=this.brushColor,this.ctx.lineTo(e.offsetX,e.offsetY),this.ctx.stroke();var t=[e.offsetX,e.offsetY];this.lastX=t[0],this.lastY=t[1]}},stopDrawing:function(){this.isDrawing=!1,this.ctx.closePath();try{this.saveDrawingToBase64()}catch(e){}},clearCanvas:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},saveDrawing:function(){var img=new Image;img.src=this.canvas2.toDataURL("image/png",.05);var link=document.createElement("a");link.download="drawing.png",link.href=img.src,link.click()},saveDrawingToBase64:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e.length>0&&void 0!==e[0]&&e[0],n.prev=1,t.bgCtx.clearRect(0,0,t.canvas2.width,t.canvas2.height),t.bgCtx.fillStyle="black",t.bgCtx.fillRect(0,0,t.canvas2.width,t.canvas2.height),t.bgCtx.drawImage(t.canvas,0,0,t.canvas2.width,t.canvas2.height),l=t.canvas2.toDataURL("image/png",.05),t.canvas.toDataURL()!==t.blankCanvas){n.next=10;break}return t.$emit("updateMask",""),n.abrupt("return");case 10:if(l!==t.blankBgCanvas){n.next=13;break}return t.$emit("updateMask",""),n.abrupt("return");case 13:if(o)try{null==t||null===(r=t.top)||void 0===r||r.updateDisplayMask(l.slice(l.indexOf(",")+1))}catch(e){}return n.next=16,t.checkIsSameImage(l);case 16:if(!n.sent){n.next=19;break}return n.abrupt("return");case 19:t.$emit("updateMask",l.slice(l.indexOf(",")+1)),n.next=24;break;case 22:n.prev=22,n.t0=n.catch(1);case 24:case"end":return n.stop()}}),n,null,[[1,22]])})))()},checkIsSameImage:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l=!1,(o=e.length>0&&void 0!==e[0]?e[0]:"").slice(o.indexOf(",")+1)!==t.maskUrl){n.next=5;break}return n.abrupt("return",!0);case 5:return n.abrupt("return",l);case 6:case"end":return n.stop()}}),n)})))()}}}),oi=ai,si=(n(3022),Object(y.a)(oi,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-g-image-draw"},[t("canvas",{ref:"canvas",style:e.canvasStyle,attrs:{width:e.autoStyle.width,height:e.autoStyle.height}}),e._v(" "),t("canvas",{ref:"canvas2",staticStyle:{display:"none"},attrs:{width:e.autoStyle.rawWidth,height:e.autoStyle.rawHeight}})])}),[],!1,null,"2f45ba4c",null).exports);function ri(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ci(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ri(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ri(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var di={props:["imageUrl"],inject:["top"],data:function(){return{borderList:["left","top","right","bottom"],boxStyle:{top:0,bottom:0,left:0,right:0},imgStyle:{width:0,height:0,rawWidth:0,rawHeight:0},limit:{minWidth:0,minHeight:0,maxWidth:0,maxHeight:0},scale:1,boxElm:null,dragElm:null,imgElm:null,borderWidth:5}},computed:ci(ci({},Object(S.e)("user",["cdnHost"])),{},{isDragHeight:function(){return this.imgStyle.rawHeight<1536},isDragWidth:function(){return this.imgStyle.rawWidth<1536}}),watch:{imageUrl:function(e){e&&(this.initConfig(),this.getImageSize({url:e,needImgOnload:!0}))}},mounted:function(){this.getImageSize({needImgOnload:!0}),window.addEventListener("resize",this.handleResize)},beforeDestroy:function(){window.removeEventListener("resize",this.handleResize)},methods:{handleResize:function(){this.initConfig(),this.getImageSize({needImgOnload:!1,windowChange:!0})},getImageSize:function(e){var t=e.url,n=void 0===t?this.imageUrl:t,o=e.needImgOnload,l=e.windowChange,r=void 0!==l&&l,img=new Image;img.src=n;var c=this;o?img.onload=function(){var e=this.width,t=this.height;e>=1536&&t>=1536&&c.$message.warning(c.$t("expansion_over_limit_tips")),(1436<e&&e<1536||1436<t&&t<1536)&&c.$message({message:c.$t("ImgNameIs")+" "+e+"x"+t+". "+c.$t("ExpantionTip"),type:"warning",duration:3e3}),c.imgStyle={rawHeight:t,rawWidth:e},c.initELm(r)}:this.initELm(r)},initELm:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.boxElm=document.querySelector("#expansion"),this.dragElm=document.querySelector("#dragBox"),this.imgElm=document.querySelector("#dragBox img"),this.limit=ci(ci({},this.limit),{},{maxWidth:parseInt(this.boxElm.offsetWidth-2),maxHeight:parseInt(this.boxElm.offsetHeight-2)}),this.initDragBox(e),this.addMousemoveEvent()},initDragBox:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.limit,o=n.maxWidth,l=n.maxHeight,r=this.imgStyle,c=r.rawHeight,d=r.rawWidth,h=this.formateSize(d/c,5);this.scale=this.formateSize(o/1536,5);var m=d,v=c;d>=1536&&h>=1&&(m=o,v=this.scaleSize(o,!0,h)),c>=1536&&h<=1&&(v=l,m=this.scaleSize(l,!1,h)),d<1536&&c<1536&&(m=this.scaleSize(d),v=this.scaleSize(c)),this.limit=ci(ci({},this.limit),{},{minWidth:m,minHeight:v}),this.imgStyle=ci(ci({},this.imgStyle),{},{width:m,height:v}),this.getInitPadding(),this.$nextTick((function(){e.setResize(!1,t)}))},getInitPadding:function(){var e=this.top.config.expansion,t=e.width,n=e.height,o=e.up_margin,l=e.left_margin,r=this.imgStyle,c=r.rawWidth,d=r.rawHeight,h=2*this.borderWidth;if(-1!==o&&-1!==l){var m=this.scaleSize(o);m=m>2?m-2:m;var v=this.scaleSize(t-c-l)-h,f=this.scaleSize(n-d-o)-h;this.boxStyle={left:this.scaleSize(l),top:m,right:v<0?0:v,bottom:f<0?0:f}}},formateSize:function(e,t){var n=e.toFixed(t||0);return t?parseFloat(n):parseInt(n)},initConfig:function(){this.boxStyle={top:0,bottom:0,left:0,right:0}},getDragShow:function(e){return["left","right"].includes(e)?this.isDragWidth:!["top","bottom"].includes(e)||this.isDragHeight},resize:function(e,t){var n=0,o=0,l=this;e.onmousedown=function(r){(r=r||event).preventDefault();var c=e.getBoundingClientRect(),d=c.left,h=c.top;n=parseInt(d),o=parseInt(h);var m=JSON.parse(JSON.stringify(l.boxStyle));document.onmousemove=function(e){var r=(e=e||event).clientX-n,c=e.clientY-o;if(l.setPadding(t,r,c,m),!l.isStopMove(t))return!1},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,l.setResize()}}},isStopMove:function(e){var t=this.limit,n=t.minWidth,o=t.minHeight,l=t.maxWidth,r=t.maxHeight,c=this.boxStyle,d=c.left,h=c.right,m=c.bottom,v=c.top,f=o+m+v;r-=10;var _=n+h+d>=(l-=10)&&["left","right"].includes(e),y=f>=r&&["top","bottom"].includes(e);return _||y?(this.setPadLimit(e),!0):(h<0||v<0||d<0||m<0)&&(this.setPadLimit(e,!0),!0)},setPadLimit:function(e,t){var n=this.limit,o=n.minWidth,l=n.minHeight,r=n.maxWidth,c=n.maxHeight,d=["left","right"].includes(e),h=d?r:c,m=d?o:l,v=this.boxStyle[{left:"right",right:"left",top:"bottom",bottom:"top"}[e]],f=2*this.borderWidth;this.boxStyle[e]=t?0:h-v-m-f},setPadding:function(e,t,n,o){var l=o[e],r=["left","right"].includes(e)?t:n;r*=2,this.boxStyle[e]=l+(["left","top"].includes(e)?-r:r)},addMousemoveEvent:function(){var e=this;this.borderList.forEach((function(t,i){var n=document.querySelector(".drag-"+t);e.resize(n,t)}))},scaleSize:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.scale;return t?this.formateSize(e/n):this.formateSize(e*n)},setResize:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.boxStyle,o=n.left,l=n.right,r=n.top,c=n.bottom,d=this.dragElm,h=2*this.borderWidth,m=this.isDragWidth&&(o>0||l>0),v=this.isDragHeight&&(r>0||c>0),f=d.offsetWidth+(m?h:0),_=d.offsetHeight+(v?h:0),y=this.scaleSize(o,!0),w=this.scaleSize(r,!0);f=this.scaleSize(f,!0),_=this.scaleSize(_,!0),t||this.top.setResizeInfo({left_margin:y,up_margin:w,width:f,height:_,isDrag:e})}}},ui=di,hi=(n(3023),Object(y.a)(ui,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"drag-box",style:{padding:e.boxStyle.top+"px "+e.boxStyle.right+"px "+e.boxStyle.bottom+"px "+e.boxStyle.left+"px",minWidth:e.limit.minWidth+"px",minHeight:e.limit.minHeight+"px",backgroundImage:"url(https://".concat(e.cdnHost,"/static/upload/20230602/50b806a8-3d7a-4bad-9cfc-bbae659c9638.png)")},attrs:{id:"dragBox"}},[t("img",{style:{width:e.imgStyle.width+"px",height:e.imgStyle.height+"px"},attrs:{src:e.imageUrl,alt:""}}),e._v(" "),e._l(e.borderList,(function(n,i){return t("div",{directives:[{name:"show",rawName:"v-show",value:e.imgStyle.rawWidth&&e.getDragShow(n),expression:"imgStyle.rawWidth && getDragShow(v)"}],key:"border_"+i,staticClass:"border",class:["drag-"+n]},[t("span",{staticClass:"center-btn"})])}))],2)}),[],!1,null,"eab8b7e8",null).exports),pi=(n(221),n(38)),mi=n(74),vi=n(352),gi=n(94),fi=n.n(gi),_i=n(3024);function bi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function yi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bi(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wi={name:"generateRedrawModal",props:{mask:{type:String,default:function(){return""}},needMixedMask:{type:Boolean,default:!1}},mixins:[_i.a],data:function(){return{dialogVisible:!1,intLoading:!0,intImg:{url:"",width:0,height:0,size:50},MasterDrawing:"",intHeight:0,intWidth:0,mouseX:0,mouseY:0,isMousedown:!1,sizeList:[{name:"400%",value:400},{name:"200%",value:200},{name:"125%",value:125},{name:"100%",value:100},{name:"75%",value:75},{name:"50%",value:50},{name:"30%",value:30},{name:"20%",value:20},{name:"10%",value:10},{name:"fitToScreen",value:50},{name:"ai_erase3",value:100}],toolType:"smear",toolList:[{name:this.$t("erasePage1"),icon:"iconfont icon-tumo",value:"smear"},{name:this.$t("fastToolsEraser"),icon:"iconfont icon-icon_zidongcachu",value:"eraser"},{name:this.$t("addMaticSelection"),icon:"iconfont icon-jianyiban",value:"quick"},{name:this.$t("cancelMaticSelection"),icon:"iconfont icon-jianyiban",value:"cancelQuick"}],brushSize:40,canvas:null,context:null,startX:0,startY:0,blankCanvas:"",currentStep:-1,historyList:[],isDrawing:!1,uploading:!1,UPLOAD:new pi.a({type:2}),drewPoints:[],rectList:[],imgSegmentUrlList:[],hoverMaskUrl:"",hasHover:!0,debounceHandleMouseMove:null,imagesList:[],loading:!1,inTimes:!1,retryCount:0,jsonUrl:"",imgUrl:"",imgShow:!0,lengthOfLongSide:0,consumption:1,minScaleSize:10,maxScaleSize:400,mixedMaskUrl:""}},watch:{dialogVisible:{handler:function(e){e||(this.intImg={url:"",width:0,height:0,size:100},this.toolType="smear",this.historyList=[],this.imagesList=[],this.imgSegmentUrlList=[],this.debounceHandleMouseMove=null,this.currentStep=-1,this.imgUrl="",this.imgShow=!0,this.MasterDrawing="")}}},components:{generateRectItem:vi.a},computed:yi(yi({},Object(S.c)("user",["isLoggedIn","accountSettingsData","cdnHostFun"])),{},{setCanvasStyle:function(){var e="";if(["smear","eraser"].includes(this.toolType)){var t=this.brushSize;t<10&&(t=10);var n='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="'.concat(t,'" height="').concat(t,'" viewBox="0 0 ').concat(t," ").concat(t,'">\n    <circle cx="').concat(t/2,'" cy="').concat(t/2,'" r="').concat(t/2,'" fill="purple" fill-opacity="0.5" />\n  </svg>'),o=btoa(n),l="data:image/svg+xml;base64,".concat(o);e="url(".concat(l,") ").concat(t/2," ").concat(t/2,", auto")}return"rectangle"==this.toolType&&(e="url(https://".concat(this.cdnHostFun(),"/20240312/cb26a6cd-7ca5-4e32-a633-df7094cb570d.cur) 8 8, auto")),"noose"==this.toolType&&(e="url(https://".concat(this.cdnHostFun(),"/20240307/3b553f30-1a01-4287-85b9-b1840754b717.cur) 8 8, auto")),"drag"==this.toolType&&(e="grab"),e}}),created:function(){this.debounceHandleMouseMove=Object(mi.throttle)(this.handleMouseMove,300)},mounted:function(){document.addEventListener("keydown",this.shortcutKey)},beforeDestroy:function(){document.removeEventListener("keydown",this.shortcutKey)},methods:{setImageZoomIn:function(){this.intImg.size+10>=this.maxScaleSize?this.intImg.size=this.maxScaleSize:this.intImg.size+=10},setImageZoomOut:function(){this.intImg.size-10<=this.minScaleSize?this.intImg.size=this.minScaleSize:this.intImg.size-=10},resetData:function(){this.intImg={url:"",width:0,height:0,size:100},this.toolType="smear",this.historyList=[],this.imagesList=[],this.imgSegmentUrlList=[],this.debounceHandleMouseMove=null,this.currentStep=-1,this.imgUrl="",this.imgShow=!0,this.MasterDrawing=""},reupload:function(){this.$emit("reupload")},shortcutKey:function(e){(e.ctrlKey||e.metaKey)&&e.shiftKey&&"z"===e.key.toLowerCase()?this.handleNext():(e.ctrlKey||e.metaKey)&&"z"===e.key.toLowerCase()&&this.handlePre()},dwn:function(){Object(k.z)(this.imgUrl)},changeTool:function(e){this.toolType=e.value,this.setDrawType(),["cancelQuick","quick"].includes(this.toolType)&&!this.imgSegmentUrlList.length&&this.getSegmentMaskData()},handleMouseMove:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.checkCoordinate(e.offsetX,e.offsetY,t.imagesList);case 2:(o=n.sent)>=0&&t.hasHover&&t.setHoverMask(o);case 4:case"end":return n.stop()}}),n)})))()},getCacheSegmentMaskData:function(){var e=arguments;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!["",null,void 0].includes(n=e.length>0&&void 0!==e[0]?e[0]:"")){t.next=3;break}return t.abrupt("return",null);case 3:return t.next=5,fi.a.getItem(n);case 5:return o=t.sent,t.abrupt("return",o||null);case 7:case"end":return t.stop()}}),t)})))()},setHoverMask:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!["",null,void 0,-1].includes(e)){n.next=3;break}return t.hoverMaskUrl="",n.abrupt("return");case 3:(o=new Image).src=t.imgSegmentUrlList[e],o.onload=Object(E.a)(regeneratorRuntime.mark((function e(){var n,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=document.createElement("canvas")).width=t.intImg.width,n.height=t.intImg.height,(l=n.getContext("2d")).clearRect(0,0,t.intImg.width,t.intImg.height),l.globalCompositeOperation="source-in",l.fillStyle="#fff",l.fillRect(0,0,t.intImg.width,t.intImg.height),l.globalCompositeOperation="source-over",l.drawImage(o,0,0,t.intImg.width,t.intImg.height),t.hoverMaskUrl=n.toDataURL();case 11:case"end":return e.stop()}}),e)})));case 6:case"end":return n.stop()}}),n)})))()},selectRegion:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(["cancelQuick","quick"].includes(t.toolType)){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,t.checkCoordinate(e.offsetX,e.offsetY,t.imagesList);case 4:(o=n.sent)>=0&&t.selectSegmentMask(o);case 6:case"end":return n.stop()}}),n)})))()},cancelSelectSegmentMask:function(e){var t=document.createElement("canvas"),n=this.intImg,o=n.width,l=n.height;t.width=o,t.height=l;var r=t.getContext("2d"),c=new Image;c.src=this.imgSegmentUrlList[e],c.onload=function(){for(var e=[-1,-1,0,-1,1,-1,-1,0,1,0,-1,1,0,1,1,1],i=0;i<e.length;i+=2)r.drawImage(c,4*e[i],4*e[i+1],o,l);r.drawImage(c,0,0,o,l);for(var t=r.getImageData(0,0,o,l).data,n=this.context.getImageData(0,0,o,l),d=n.data,h=0;h<l;h++)for(var m=0;m<o;m++){var v=4*(h*o+m);t[v+3]>0&&(d[v]=0,d[v+1]=0,d[v+2]=0,d[v+3]=0)}this.context.putImageData(n,0,0)}},selectSegmentMask:function(e){var t=this,n=new Image,o=this.$refs.canvas.getContext("2d"),l=this.intImg,r=l.width,c=l.height;n.src=this.imgSegmentUrlList[e],n.onload=function(){o.globalCompositeOperation=["cancelQuick"].includes(t.toolType)?"destination-out":"source-over";for(var e=[-1,-1,0,-1,1,-1,-1,0,1,0,-1,1,0,1,1,1],i=0;i<e.length;i+=2)o.drawImage(n,4*e[i],4*e[i+1],r,c);o.drawImage(n,0,0,r,c),t.saveToHistory()}},checkCoordinate:function(e,t,n){var o=this;return Object(E.a)(regeneratorRuntime.mark((function l(){return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",o.detectClickedImage(e,t,n));case 1:case"end":return l.stop()}}),l)})))()},detectClickedImage:function(e,t,n){for(var o=this.canvas.width/this.canvas.offsetWidth,i=n.length-1;i>=0;i--){var l=n[i],r=parseInt(e*o),c=parseInt(t*o);if(this.checkPixelTransparency(l,r,c))return i}},checkPixelTransparency:function(e,t,n){return 0!==e.data[4*(t+n*e.width)+3]},getSegmentMaskData:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,d,h,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.loading||e.imgSegmentUrlList.length||e.uploading)){t.next=2;break}return t.abrupt("return");case 2:return e.loading=!0,t.next=5,e.getCacheSegmentMaskData(null===(n=e.intImg)||void 0===n?void 0:n.url);case 5:if(!(o=t.sent)||!o.imgSegmentUrlList.length){t.next=12;break}return r=(l=o||{}).imgSegmentUrlList,c=void 0===r?[]:r,d=l.imagesList,h=void 0===d?[]:d,e.imgSegmentUrlList=c,e.imagesList=h,e.loading=!1,t.abrupt("return");case 12:m={action:14,meta:{smart_edit:{uri:e.intImg.url}}},Object(A.d)(m).then((function(t){1e4==t.status.code&&e.getTaskInfo([t.data.id])})).catch((function(t){e.loading=!1}));case 14:case"end":return t.stop()}}),t)})))()},getTaskInfo:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o={};if(o.task_ids=e,o.scene=1,!["cancelQuick","quick"].includes(this.toolType))return this.inTimes&&clearTimeout(this.inTimes),this.loading=!1,this.uploading=!1,void(this.intLoading=!1);Object(A.a)(o).then((function(o){var l,r,c,d,h;if(1e4==o.status.code)if(null!==(l=o.data)&&void 0!==l&&l.items[0]&&3==(null===(r=o.data)||void 0===r||null===(r=r.items[0])||void 0===r?void 0:r.status))if(clearTimeout(t.inTimes),t.jsonUrl=null===(h=o.data)||void 0===h?void 0:h.items[0].segment,1==n)t.loadJsonFile(t.jsonUrl);else{var m,v;t.imgUrl=null===(m=o.data)||void 0===m||null===(m=m.items[0])||void 0===m||null===(m=m.img_uris[0])||void 0===m?void 0:m.url;var img=new Image;img.src=null===(v=o.data)||void 0===v||null===(v=v.items[0])||void 0===v||null===(v=v.img_uris[0])||void 0===v?void 0:v.url,img.onload=function(){t.intImg.url=img.src,t.uploading=!1,t.loading=!1,t.intLoading=!1,t.rectList=[],t.context.clearRect(0,0,t.canvas.width,t.canvas.height),t.saveToHistory()},img.onerror=function(){t.intImg.url=img.src,t.uploading=!1,t.loading=!1,t.intLoading=!1,t.rectList=[],t.context.clearRect(0,0,t.canvas.width,t.canvas.height),t.saveToHistory()}}else null!==(c=o.data)&&void 0!==c&&c.items[0]&&4==(null===(d=o.data)||void 0===d||null===(d=d.items[0])||void 0===d?void 0:d.status)?(clearTimeout(t.inTimes),t.loading=!1,t.intLoading=!1,t.uploading=!1):(clearTimeout(t.inTimes),t.inTimes=setTimeout((function(){t.getTaskInfo(e,n)}),1e3))})).catch((function(e){t.loading=!1,t.uploading=!1,t.intLoading=!1}))},loadJsonFile:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return fetch(t).then((function(t){return t.ok||e.$message.error(e.$t("ServerError")),t.json()})).then(function(){var t=Object(E.a)(regeneratorRuntime.mark((function t(data){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.initCanvas(null==data?void 0:data.result);case 2:e.loading=!1;case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(n){0===e.retryCount?(e.loadJsonFile(t).finally((function(){e.loading=!1})),e.retryCount++):e.$message.error(e.$t("ServerError"))}))},initCanvas:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var data,o,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return data=e.length>0&&void 0!==e[0]?e[0]:[],t.imgSegmentUrlList=data.map((function(e){return"data:image/png;base64,".concat(e.mask_png)})),n.next=4,t.loadAllMask(t.imgSegmentUrlList);case 4:if(t.imagesList=n.sent,!t.imagesList.length){n.next=10;break}return{},l={imgSegmentUrlList:t.imgSegmentUrlList,imagesList:t.imagesList},n.next=10,fi.a.setItem(null===(o=t.intImg)||void 0===o?void 0:o.url,l);case 10:case"end":return n.stop()}}),n)})))()},loadAllMask:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.intImg||{},n=t.width,o=t.height,l=(source||[]).map((function(e){return new Promise((function(t,n){var img=new Image;img.onload=function(){return t(img)},img.onerror=function(e){return n(e)},img.src=e}))}));return Promise.all(l).then((function(t){for(var l=[],i=0;i<t.length;i++){var img=t[i],r=document.createElement("canvas");r.width=n,r.height=o;var c=r.getContext("2d");c.drawImage(img,0,0,e.intImg.width,e.intImg.height);var d=c.getImageData(0,0,e.intImg.width,e.intImg.height);d.data;c.putImageData(d,0,0);var h=r.toDataURL();e.$set(e.imgSegmentUrlList,i,h);var m=c.getImageData(0,0,e.intImg.width,e.intImg.height);l.push(m),r=null,c=null}return l}))},show:function(e){var t=this;this.currentStep=-1,this.historyList=[],this.rectList=[],this.toolType="smear",this.context&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.intImg.url="",this.imgUrl="",this.mixedMaskUrl="",this.maskImageSourceUrl="",this.MasterDrawing="",this.imagesList=[],this.debounceHandleMouseMove=Object(mi.throttle)(this.handleMouseMove,300),this.intLoading=!0,this.$nextTick((function(){t.intImg.url=e,t.MasterDrawing=e,t.dialogVisible=!0,t.imgLoad()}))},intSize:function(){var e=window.innerHeight-240,t=this.intImg.height;this.intImg.width>2*this.intImg.height&&(e=window.innerWidth-100,t=window.innerWidth),this.intImg.size=parseInt(e/t*100)},changeSize:function(e){var t=this;if("fitToScreen"===e.name){var n=this.$refs.draggable;return n.style.left=null,n.style.top=null,void this.$nextTick((function(){t.intSize()}))}this.intImg.size=e.value},setConsumption:function(){this.consumption=1,this.lengthOfLongSide>=1024&&this.lengthOfLongSide<=2048?this.consumption=1.5:this.lengthOfLongSide>=2048&&this.lengthOfLongSide<=4096&&(this.consumption=4)},setDrawType:function(){this.context&&(this.context.globalCompositeOperation="eraser"===this.toolType?"destination-out":"source-over")},imgLoad:function(){this.intLoading=!0;var img=new Image;img.src=this.intImg.url;var e=this;img.onload=function(){e.lengthOfLongSide=Math.max(this.width,this.height),e.setConsumption(),e.intImg.width=this.width,e.intImg.height=this.height,e.intSize(),e.intLoading=!1,e.$nextTick(Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.canvas=e.$refs.canvas,e.context=e.canvas.getContext("2d"),e.context.fillStyle="rgba(255, 255, 255, 1)",e.context.lineJoin="round",e.context.lineCap="round",e.rectCanvas=e.$refs.rectCanvas,e.rectText=e.rectCanvas.getContext("2d"),e.rectText.strokeStyle="rgba(0,0,0,1)",e.rectText.fillStyle="rgba(255, 255, 255, 1)",e.rectText.lineJoin="round",e.rectText.lineCap="round",e.blankCanvas=e.canvas.toDataURL(),!e.mask){t.next=15;break}return t.next=15,e.displayMaskToCanvas(e.mask);case 15:e.saveToHistory();case 16:case"end":return t.stop()}}),t)}))))},img.onerror=function(){e.$message.error(e.$t("ai_erase4")),e.intLoading=!1}},displayMaskToCanvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this;return new Promise((function(n,o){var img=new Image;img.onload=function(){t.context.clearRect(0,0,t.canvas.width,t.canvas.height),t.context.drawImage(img,0,0,t.canvas.width,t.canvas.height),n()},img.onerror=function(e){console.log(e,"局部重绘图片回填失败"),n()},img.src=e}))},downElement:function(e){if("drag"===this.toolType){this.isMousedown=!0;var t=this.$refs.draggable;this.mouseX=e.clientX-t.offsetLeft,this.mouseY=e.clientY-t.offsetTop}},moveElement:function(e){if(this.isMousedown&&"drag"===this.toolType){var t=this.$refs.draggable;t.style.left=e.clientX-this.mouseX+"px",t.style.top=e.clientY-this.mouseY+"px"}},seupElement:function(){"drag"===this.toolType&&(this.isMousedown=!1)},startDrawing:function(e){if(["smear","eraser","noose"].includes(this.toolType))if(this.isDrawing=!0,this.startX=e.offsetX,this.startY=e.offsetY,["smear","eraser"].includes(this.toolType))this.context.strokeStyle="#fff",this.context.lineWidth=this.brushSize<10?10:this.brushSize,this.context.setLineDash([]);else if("noose"==this.toolType){var t=this.$refs.draggable;this.context.strokeStyle="rgba(0,0,0,1)";var n=t.getBoundingClientRect();this.drewPoints.push([{x:e.clientX-n.left,y:e.clientY-n.top}]),this.context.setLineDash([10,5]),this.context.lineWidth=2}},draw:function(e){if(this.isDrawing){var t,n,o=this.canvas.width/this.canvas.offsetWidth;if(this.context.scale(o,o),["smear","eraser"].includes(this.toolType)){var l=e.offsetX,r=e.offsetY;this.context.beginPath(),this.context.moveTo(this.startX,this.startY),this.context.lineTo(l,r),this.context.stroke(),this.startX=l,this.startY=r}else if("noose"==this.toolType){var c,d,h=this.$refs.draggable.getBoundingClientRect();c=e.clientX,d=e.clientY;var m=this.drewPoints[this.drewPoints.length-1];m.push({x:c-h.left,y:d-h.top});var v=m[0],f=m[1],_=m.length;this.context.beginPath(),this.context.moveTo(v.x,v.y);for(var i=1;i<_;i++){var y=(n=f,{x:(t=v).x+(n.x-t.x)/2,y:t.y+(n.y-t.y)/2});this.context.quadraticCurveTo(v.x,v.y,y.x,y.y),v=m[i],f=m[i+1]}this.context.lineTo(v.x,v.y),this.context.stroke()}this.context.scale(1/o,1/o)}},stopDrawing:function(){["smear","noose","eraser"].includes(this.toolType)&&this.isDrawing&&(this.isDrawing=!1,"noose"===this.toolType&&(this.context.closePath(),this.context.stroke(),this.context.fill()),this.saveToHistory())},startRectDrawing:function(e){"rectangle"===this.toolType&&(this.isDrawing=!0,this.startX=e.offsetX,this.startY=e.offsetY)},rectDraw:function(e){var t=this;if(this.isDrawing){var n=e.offsetX,o=e.offsetY;this.rectText.clearRect(0,0,this.rectCanvas.width,this.rectCanvas.height),this.$nextTick((function(){var e=t.rectCanvas.width/t.rectCanvas.offsetWidth;t.rectText.scale(e,e),t.rectText.beginPath(),t.rectText.rect(t.startX,t.startY,n-t.startX,o-t.startY),t.rectText.fill(),t.rectText.stroke(),t.rectText.scale(1/e,1/e)})),this.rectCanvas.style.zIndex=9999}},stopRectDrawing:function(e){if("rectangle"===this.toolType&&this.isDrawing){this.isDrawing=!1,this.rectText.clearRect(0,0,this.rectCanvas.width,this.rectCanvas.height);var t=e.offsetX,n=e.offsetY;this.rectList.push({left:t-this.startX>0?this.startX:t,top:n-this.startY>0?this.startY:n,width:Math.abs(t-this.startX),height:Math.abs(n-this.startY)}),this.saveToHistory(),this.rectCanvas.style.zIndex=2}},rectDelete:function(e){this.rectList.splice(e,1)},rectChange:function(e){this.rectList[e.index].top=e.top,this.rectList[e.index].left=e.left,this.rectList[e.index].width=e.width,this.rectList[e.index].height=e.height},saveToHistory:function(){var e=JSON.parse(JSON.stringify(this.rectList)),t=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),img=JSON.parse(JSON.stringify(this.intImg.url));this.currentStep++,1===this.currentStep&&this.historyList.splice(1,this.historyList.length-1),this.historyList.push({currentImageData:t,rects:e,img:img}),this.currentStep=this.historyList.length-1},handlePre:function(){this.historyList.length>0&&this.currentStep>0&&(this.currentStep--,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.putImageData(this.historyList[this.currentStep].currentImageData,0,0),this.rectList=JSON.parse(JSON.stringify(this.historyList[this.currentStep].rects)),this.intImg.url=JSON.parse(JSON.stringify(this.historyList[this.currentStep].img)))},handleNext:function(){this.currentStep<this.historyList.length-1&&(this.currentStep++,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.putImageData(this.historyList[this.currentStep].currentImageData,0,0),this.rectList=JSON.parse(JSON.stringify(this.historyList[this.currentStep].rects)),this.intImg.url=JSON.parse(JSON.stringify(this.historyList[this.currentStep].img)))},handleReset:function(){this.historyList.length>1&&(this.currentStep=-1,this.historyList=[],this.rectList=[],this.toolType="smear",this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.intImg.url=this.MasterDrawing,this.imgUrl="",this.imgLoad())},checkImageSize:function(e){var t=this;return new Promise((function(n,o){var l=new FileReader;l.onload=function(e){var img=new Image;img.onload=function(){var e=img.width,o=img.height;t.$set(t,"style",{width:e,height:o});var l=[e,o].every((function(e){return e<=4096}));n(l)},img.onerror=function(){o(!1)},img.src=e.target.result},l.readAsDataURL(e)}))},uploadMaskImage:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,i,r,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoggedIn){t.next=3;break}return e.$EventBus.$emit("openLoginDialog"),t.abrupt("return");case 3:if(e.intImg.width){t.next=5;break}return t.abrupt("return");case 5:if(!e.uploading&&!e.loading){t.next=7;break}return t.abrupt("return");case 7:for(e.uploading=!0,e.loading=!0,(n=document.createElement("canvas")).width=e.intImg.width,n.height=e.intImg.height,(o=n.getContext("2d")).clearRect(0,0,n.width,n.height),l=e.context.getImageData(0,0,e.canvas.width,e.canvas.height),i=0;i<l.data.length;i+=4)255===l.data[i]&&255===l.data[i+1]&&255===l.data[i+2]||(l.data[i]=255,l.data[i+1]=255,l.data[i+2]=255);if(o.putImageData(l,0,0),r=e.canvas.width/e.canvas.offsetWidth,e.rectList.length>0&&e.rectList.forEach((function(e){o.fillStyle="rgba(255, 255, 255, 1)",o.beginPath(),o.rect(e.left*r,e.top*r,e.width*r,e.height*r),o.fill()})),(c=n.toDataURL("image/png",.1))!==e.blankCanvas){t.next=28;break}return e.uploading=!1,e.loading=!1,e.$emit("updateMask",""),e.uploading=!1,e.loading=!1,e.handleClose(),t.abrupt("return");case 28:e.uploading=!1,e.loading=!1,e.$emit("updateMask",c),e.handleClose();case 32:case"end":return t.stop()}}),t)})))()},uploadMixedMaskImage:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!t)return this.mixedMaskUrl="",Promise.resolve();var n=Object(B.a)(t);return this.UPLOAD.startUpload(n,{name:"img2img-mask".concat(Date.now(),".png"),type:"png",isRedirection:!0,category:46}).then((function(t){e.mixedMaskUrl=t}))},handleClose:function(){this.resetData(),this.dialogVisible=!1}}},Ci=wi,ki=(n(3025),n(3026),Object(y.a)(Ci,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.dialogVisible,"custom-class":"c-generate-redraw-modal",fullscreen:!0,"append-to-body":"",modal:!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.intLoading,expression:"intLoading"}],staticClass:"main"},[t("div",{staticClass:"top"},[t("div",{staticClass:"topItem"},[t("div",{staticClass:"back",on:{click:function(t){e.dialogVisible=!1}}},[t("i",{staticClass:"el-icon-back"})])]),e._v(" "),t("div",{staticClass:"topItem",class:{disabledStyle:e.intLoading}},[t("div",{staticClass:"bntBox"},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("fastToolsUndo"),placement:"bottom"}},[t("div",{staticClass:"bnt",class:{disabledStyle:!e.historyList.length||1==e.historyList.length||0==e.currentStep},on:{click:function(t){return e.handlePre()}}},[t("i",{staticClass:"iconfont icon-draw-board-icon3"})])]),e._v(" "),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("fastToolsRedo"),placement:"bottom"}},[t("div",{staticClass:"bnt",class:{disabledStyle:e.currentStep==e.historyList.length-1},on:{click:function(t){return e.handleNext()}}},[t("i",{staticClass:"iconfont icon-draw-board-icon2"})])]),e._v(" "),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("S_ResetPrompt"),placement:"bottom"}},[t("div",{staticClass:"bnt",class:{disabledStyle:e.historyList.length<2},on:{click:function(t){return e.handleReset()}}},[t("i",{staticClass:"el-icon-refresh"})])])],1)]),e._v(" "),t("div",{staticClass:"topItem",staticStyle:{visibility:"hidden"}})]),e._v(" "),t("div",{staticClass:"right",class:{disabledStyle:e.intLoading}},[t("div",{staticClass:"dragIcon",on:{click:function(t){"drag"==e.toolType?e.toolType="smear":e.toolType="drag"}}},[t("i",{staticClass:"iconfont icon-zhuashou-copy",style:{color:"drag"==e.toolType?"#4784FF":null}})]),e._v(" "),t("div",{staticClass:"sizeBox"},[t("div",{staticClass:"sizeBnt",class:{disabledStyle:e.intImg.size<=e.minScaleSize},on:{click:e.setImageZoomOut}},[t("i",{staticClass:"el-icon-minus"})]),e._v(" "),t("el-popover",{attrs:{placement:"top",trigger:"hover","visible-arrow":!1,"popper-class":"sizeListBox"}},[t("div",{staticClass:"sizeList"},e._l(e.sizeList,(function(n,o){return t("div",{key:o,staticClass:"sizeItem",on:{click:function(t){return e.changeSize(n)}}},[e._v(e._s(e.$t(n.name)))])})),0),e._v(" "),t("div",{staticClass:"sizeNum",attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(e.intImg.size)+"%")])]),e._v(" "),t("div",{staticClass:"sizeBnt",class:{disabledStyle:e.intImg.size>=e.maxScaleSize},on:{click:e.setImageZoomIn}},[t("i",{staticClass:"el-icon-plus"})])],1)]),e._v(" "),t("div",{staticClass:"left",class:{disabledStyle:e.intLoading}},e._l(e.toolList,(function(n,o){return t("div",{key:o,staticClass:"toolItem",class:{activateToolItem:e.toolType==n.value},on:{click:function(t){return e.changeTool(n)}}},[t("i",{class:n.icon}),e._v(" "),t("span",[e._v(e._s(e.$t(n.name)))]),e._v(" "),"smear"==n.value&&"smear"==e.toolType||"eraser"==n.value&&"eraser"==e.toolType?t("div",{staticClass:"lineSize"},[t("span",[e._v(e._s(e.$t("Size")))]),e._v(" "),t("el-slider",{attrs:{"show-input":"","show-input-controls":!1,min:10},model:{value:e.brushSize,callback:function(t){e.brushSize=t},expression:"brushSize"}})],1):e._e()])})),0),e._v(" "),e.intLoading?e._e():t("div",{ref:"draggable",staticClass:"draggable",style:{width:e.intImg.width*e.intImg.size/100+"px",height:e.intImg.height*e.intImg.size/100+"px",cursor:e.setCanvasStyle},attrs:{id:"draggable"},on:{mousedown:function(t){return t.preventDefault(),e.downElement.apply(null,arguments)},mousemove:function(t){return t.preventDefault(),e.moveElement.apply(null,arguments)},mouseup:function(t){return t.preventDefault(),e.seupElement.apply(null,arguments)}}},[e.loading?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"laodMsk"}):e._e(),e._v(" "),e.intImg.url?t("img",{directives:[{name:"show",rawName:"v-show",value:e.imgShow,expression:"imgShow"}],attrs:{src:e.intImg.url,alt:""}}):e._e(),e._v(" "),e.MasterDrawing?t("img",{directives:[{name:"show",rawName:"v-show",value:!e.imgShow,expression:"!imgShow"}],attrs:{src:e.MasterDrawing,alt:""}}):e._e(),e._v(" "),t("canvas",{ref:"canvas",attrs:{width:e.intImg.width,height:e.intImg.height},on:{"&mousedown":function(t){return e.startDrawing.apply(null,arguments)},"&mousemove":function(t){["cancelQuick","quick"].includes(e.toolType)?e.debounceHandleMouseMove(t):e.draw(t)},"&mouseup":function(t){return e.stopDrawing.apply(null,arguments)},mouseenter:function(t){e.hasHover=!0},mouseleave:function(t){e.hasHover=!1,e.hoverMaskUrl="",e.stopDrawing()},mousedown:e.selectRegion}}),e._v(" "),e.hoverMaskUrl?t("img",{staticClass:"segment-image-draw-img-hover-mask",style:{width:e.intImg.width*e.intImg.size/100+"px",height:e.intImg.height*e.intImg.size/100+"px"},attrs:{src:e.hoverMaskUrl,alt:""}}):e._e(),e._v(" "),t("canvas",{directives:[{name:"show",rawName:"v-show",value:"rectangle"==e.toolType,expression:"toolType == 'rectangle'"}],ref:"rectCanvas",staticClass:"rectCanvas",attrs:{width:e.intImg.width,height:e.intImg.height},on:{"&mousedown":function(t){return e.startRectDrawing.apply(null,arguments)},"&mousemove":function(t){return e.rectDraw.apply(null,arguments)},"&mouseup":function(t){return e.stopRectDrawing.apply(null,arguments)}}}),e._v(" "),e._l(e.rectList,(function(n,o){return t("generate-rect-item",{key:"rect"+o,attrs:{item:n,index:o,size:e.intImg.size},on:{delete:e.rectDelete,change:e.rectChange}})}))],2),e._v(" "),t("el-button",{staticClass:"start",class:{disabledStyle:e.intLoading||e.loading},attrs:{disabled:e.intLoading||e.loading,loading:e.uploading},on:{click:e.uploadMaskImage}},[t("span",[e._v(e._s(e.$t("Done")))])])],1)])}),[],!1,null,"41f5a3cc",null)),Si=ki.exports;function xi(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,a){if(e){if("string"==typeof e)return Ii(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Ii(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,l=function(){};return{s:l,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw r}}}}function Ii(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,n=Array(a);t<a;t++)n[t]=e[t];return n}var Oi={props:["imageUrl","imgFile","maskUrl","menuIndex","workIndex"],components:{CImageDraw:si,DragBox:hi,generateRedrawModal:Si},inject:["top"],data:function(){return{penSize:5,eraserSize:5,toolsType:"",imgLoading:!1,imageInfo:{width:0,height:0,rawWidth:0,rawHeight:0},backfillMaskUrl:"",rawImgLoading:!0}},mounted:function(){this.init(),this.initObserver()},computed:{isShowTools:function(){var e=this.top.config.imageToImage.controlnet_units;return"imageToImage"===this.menuIndex&&!e.length},getMaskUrl:function(){return this.maskUrl},isSdModel:function(){var e;return[5,"5","sdxl"].includes(null===(e=this.top)||void 0===e||null===(e=e.config)||void 0===e||null===(e=e.imageToImage)||void 0===e?void 0:e.category)},isShowDraw:function(){var e=this.top.config.imageToImage.controlnet_units;return this.imageUrl&&!this.imgLoading&&!e.length}},watch:{imageUrl:function(e,t){e!=t&&(this.getImageSize(e),!e&&(this.toolsType=""))},"top.config.imageToImage":{handler:function(e,t){var n,o;e&&null!=e&&null!==(n=e.tempMask)&&void 0!==n&&n.includes("data:image/png;base64")&&!["PEN","ERASER"].includes(this.toolsType)||null!=e&&null!==(o=e.controlnet_units)&&void 0!==o&&o.length&&(this.toolsType=""),e&&!["",null,void 0].includes(e.ad_model)&&t&&["",null,void 0].includes(t.ad_model)&&(this.updateImageMask(""),this.toolsType="")},deep:!0,immediate:!0},"top.isShowPopup":function(e){this.toolsType=""},toolsType:{handler:function(e,t){var n=["AI_EDIT"].includes(e)&&["PEN","ERASER"].includes(t),o=["PEN","ERASER"].includes(e)&&["AI_EDIT"].includes(t);e!==t&&(n||o)&&this.updateImageMask("")},deep:!0,immediate:!0}},methods:{init:function(){this.getImageSize(this.imageUrl)},initObserver:function(){var e=this;new ResizeObserver((function(t){var n,o=xi(t);try{for(o.s();!(n=o.n()).done;){var l,r,c=n.value.contentRect,d=c.width,h=c.height;if(console.log("宽度:",d,"高度:",h),0===d||0===h)return;if(!e.isShowDraw)return;null==e||null===(l=e.$refs)||void 0===l||null===(l=l.imageDraw)||void 0===l||l.saveCurrentDraw(),e.updateImageInfo(),null==e||null===(r=e.$refs)||void 0===r||null===(r=r.imageDraw)||void 0===r||r.displaySaveDraw()}}catch(e){o.e(e)}finally{o.f()}})).observe(this.$refs.viewBox)},updateImageInfo:function(){var e=this.$refs.uploadView,t=this.imageInfo.rawWidth,n=this.imageInfo.rawHeight,o=e.clientWidth,l=e.clientHeight,r=this.getContainedSize({width:o,height:l,naturalWidth:t,naturalHeight:n});this.imageInfo={width:r.width,height:r.height,rawWidth:t,rawHeight:n}},getContainedSize:function(img){try{var e=img.naturalWidth/img.naturalHeight,t=img.height*e,n=img.height;return t>img.width&&(t=img.width,n=img.width/e),{width:t,height:n}}catch(e){}},getImageSize:function(e){this.imgLoading=!0;var img=new Image;img.src=e;var t=this;this.imageInfo={width:0,height:0,rawWidth:0,rawHeight:0},img.onload=function(){var e=this.width,n=this.height;t.setFullSize(e,n),t.imageLoad(e,n)}},setFullSize:function(e,t){var n=Number((e/t).toFixed(2)),o=document.querySelector("#"+this.menuIndex).offsetWidth,l=e/t;this.setImageSize(e,t,n)},setImageSize:function(e,t,n){var o=e,l=t,r=this.top,c=r.creativeMode,d=5===r.config[r.menuIndex].category,h="sdxl"===c&&d?1536:1080,m=h,v=h,f=1;n>1&&o<m&&d?(f=m/o,o=Math.ceil(o*f),l=Math.ceil(l*f)):l<v&&(f=v/l,o=Math.ceil(o*f),l=Math.ceil(l*f)),n>=1&&o>m&&(o=m,l=parseInt(o/n)),n<1&&l>v&&(l=v,o=parseInt(l*n));var _=["imageToImage","characterRepair"].includes(this.menuIndex)&&3===this.workIndex||"conditionToImage"===this.menuIndex&&0===this.workIndex;"expansion"===this.menuIndex||!_&&"extraUpscale"!==this.menuIndex||this.$emit("toolEvent","SET_SIZE",{width:o,height:l,realWidth:e,realHeight:t})},imageLoad:function(e,t){var n=this.$refs.uploadView,o=n.clientWidth,l=n.clientHeight,r=this.getContainedSize({width:o,height:l,naturalWidth:e,naturalHeight:t});this.imageInfo={width:r.width,height:r.height,rawWidth:e,rawHeight:t},this.imgLoading=!1},toolEvent:function(e){var t,n=this.top;return null!==(t=n.config[n.menuIndex].imgFiles[this.workIndex])&&void 0!==t&&t.uploading?(this.$message.warning(this.$t("uploadingWaitTip")),!1):["PEN","ERASER","AI_EDIT"].includes(e)?(this.$refs.generateRedrawModal.show(this.imageUrl),this.$emit("toolEvent",e),!1):(this.$emit("toolEvent",e),void(this.toolsType="DELETE"!==e?e:""))},updateImageMask:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$emit("updateMask",e)}}},Ti=Oi,$i=(n(3027),Object(y.a)(Ti,(function(){var e=this,t=e._self._c;return t("div",{ref:"uploadView",staticClass:"upload-view"},[t("div",{ref:"viewBox",staticClass:"view-box",attrs:{id:e.menuIndex}},["expansion"===e.menuIndex?t("drag-box",{ref:"dragBox",attrs:{imageUrl:e.imageUrl}}):[t("img",{directives:[{name:"show",rawName:"v-show",value:!["AI_EDIT"].includes(e.toolsType),expression:"!['AI_EDIT'].includes(toolsType)"}],attrs:{src:e.imgFile||e.imageUrl,alt:""},on:{load:function(t){e.rawImgLoading=!1},error:function(t){e.rawImgLoading=!1}}}),e._v(" "),e.getMaskUrl&&!e.rawImgLoading?t("img",{staticClass:"redraw-mask-image",attrs:{src:e.getMaskUrl,alt:""}}):e._e()]],2),e._v(" "),t("div",{staticClass:"image-tool",class:""===e.toolsType||e.isSdModel?"":"image-tool-active"},[t("i",{staticClass:"iconfont icon-shanchu delete-icon",on:{click:function(t){return e.toolEvent("DELETE")}}}),e._v(" "),e.isShowTools?[t("div",{directives:[{name:"show",rawName:"v-show",value:"imageToImage"===e.top.menuIndex,expression:"top.menuIndex === 'imageToImage'"}],staticClass:"image-tool-panel"},[t("div",{on:{click:function(t){return e.toolEvent("PEN")}}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("PartialRepainting"),placement:"top-start",enterable:!1}},[t("i",{staticClass:"iconfont icon-huabi",class:{active:"PEN"===e.toolsType}})])],1)])]:e._e()],2),e._v(" "),t("generate-redraw-modal",{ref:"generateRedrawModal",attrs:{mask:e.getMaskUrl||""},on:{updateMask:e.updateImageMask}})],1)}),[],!1,null,"39c546a6",null).exports),Li={props:["value"],components:{pickWorkModal:n(213).a},data:function(){return{}},methods:{handleSelectArtWork:function(e){this.$emit("setWork",e[0].info)},onDelete:function(){this.$emit("onDelete")}}},Pi=(n(3028),Object(y.a)(Li,(function(){var e,t,n,o,l,r,c=this,d=c._self._c;return d("div",{staticClass:"CAnimView"},[null!==(e=c.value)&&void 0!==e&&e.imageUrl[null===(t=c.value)||void 0===t?void 0:t.workIndex]?d("div",{staticClass:"deleteBox",on:{click:c.onDelete}},[d("i",{staticClass:"iconfont icon-shanchu"})]):c._e(),c._v(" "),null!==(n=c.value)&&void 0!==n&&n.imageUrl[null===(o=c.value)||void 0===o?void 0:o.workIndex]?d("div",{staticClass:"imgBox"},[d("img",{attrs:{src:null===(l=c.value)||void 0===l?void 0:l.imageUrl[null===(r=c.value)||void 0===r?void 0:r.workIndex],alt:""}})]):d("div",{staticClass:"cnt",on:{click:function(e){return c.$refs.pickWorkModal.openModal()}}},[d("i",{staticClass:"el-icon-plus"}),c._v(" "),d("span",[c._v(c._s(c.$t("animGenTip")))])]),c._v(" "),d("pick-work-modal",{ref:"pickWorkModal",attrs:{maxNum:1,type:"animGen"},on:{confirm:c.handleSelectArtWork}})],1)}),[],!1,null,"4c586e2a",null).exports),Mi=n(684),ji=(n(3038),Object(y.a)(Mi.a,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"OPSIndexPage"},[t("nav",[t("div",{staticClass:"dict-button-box",on:{click:function(t){return e.toggleDictPad()}}},[t("el-tooltip",{staticClass:"dict-tooltip",attrs:{placement:"top",content:e.$t("OPS_dictionary")}},[t("button",{staticClass:"dict-button"},[t("i",{staticClass:"iconfont icon-book"})])])],1)]),e._v(" "),t("PromptEditor",{ref:"PromptEditor",attrs:{"init-prompts":e.initPrompts}}),e._v(" "),e.needDictPad?t("section",{directives:[{name:"show",rawName:"v-show",value:e.showDictPad,expression:"showDictPad"}],staticClass:"PromptDictPad"},[t("div",{staticClass:"title"},[t("button",{staticClass:"icon close-button",on:{click:function(t){return e.toggleDictPad(!1)}}},[t("i",{staticClass:"el-icon-close"})])]),e._v(" "),t("PromptDict")],1):e._e()],1)}),[],!1,null,null,null).exports),Di={inject:["top"],data:function(){return{}},computed:{controlNetList:function(){var e=this.top;return e.config[e.menuIndex].controlnet_units},controlIndex:function(){var e=this.top;return e.config[e.menuIndex].workIndex},showStudioControlNet:function(){var e;return"imageToImage"===this.top.menuIndex&&["7",7,11].includes(null===(e=this.top.config)||void 0===e||null===(e=e.imageToImage)||void 0===e?void 0:e.category)}},methods:{addControlNet:function(){var e=this.top,t=e.config[e.menuIndex],n=t.imageUrl,o=t.controlnet_units;if(t.generateing)this.$message.warning(this.$t("uploadingWaitTip"));else{var l=o.every((function(e,i){return n[i]}));if(this.controlNetList.length>=3)return!1;if(n[3]||0!==this.controlNetList.length||(l=!1),!l)return this.$message.warning(this.$t("pleaseUoloadImage")),!1;this.top.addControlNet(this.controlNetList.length),this.top.clearMask()}},changeWorkTab:function(e){this.top.changeWorkTab(e)},deleteWork:function(i){this.top.changeWorkTab(i,"DEL")}}};n(3039);function Ni(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ei(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ni(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ni(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ri={components:{CUploadBox:ni,CUploadView:$i,PromptStudio:ji,CWorkTab:Object(y.a)(Di,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"change-work-tab"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"imageToImage"===e.top.menuIndex,expression:"top.menuIndex === 'imageToImage'"}],staticClass:"tab-item",class:{active:3===e.controlIndex},on:{click:function(t){return e.changeWorkTab(3)}}},[e._v("\n    "+e._s(e.$t("TaskUploadImage"))+"\n  ")]),e._v(" "),e._l(e.controlNetList,(function(n,i){return t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showStudioControlNet,expression:"!showStudioControlNet"}],key:"controlNet_"+i,staticClass:"tab-item",class:{active:e.controlIndex===i},on:{click:function(t){return e.changeWorkTab(i)}}},[e._v("\n    ControlNet "+e._s(i+1)+"\n    "),e.controlNetList.length>1||"imageToImage"===e.top.menuIndex?t("span",{staticClass:"close-icon",on:{click:function(t){return t.stopPropagation(),e.deleteWork(i)}}},[e._v("+")]):e._e()])})),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.controlNetList.length<3&&!e.showStudioControlNet,expression:"controlNetList.length < 3 && !showStudioControlNet"}],staticClass:"tab-item created-item",on:{click:e.addControlNet}},[t("i",{staticClass:"el-icon-plus"})])],2)}),[],!1,null,"232979e4",null).exports,CAnimView:Pi},props:["value","menuIndex"],inject:["top"],data:function(){return{pollingTimer:null}},computed:Ei(Ei(Ei({},Object(S.c)("user",["accountSettingsData","isCompanyAccount"])),Object(S.e)("payment",["paymentInfo"])),{},{showGenerateBtn:function(){return["animGen","extraUpscale","descriptors","preview","faceSwap","characterRepair"].includes(this.menuIndex)},showPromptStudio:function(){return"promptStudio"===this.menuIndex},imageUrl:function(){var e=this.value,t=e.imageUrl;return t[e.workIndex]},isShowTab:function(){return["conditionToImage","imageToImage"].includes(this.menuIndex)},controlNetList:function(){var e=this.top;return e.config[e.menuIndex].controlnet_units},isVip:function(){var e=this.paymentInfo,t=e.activeState,n=e.liteActiveState,o=e.isCompanyAccount;return t||n||o}}),watch:{"value.imageUrl":function(e,t){var n=this.value.workIndex;e[n]&&e[n]!==t[n]?this.imageReadInfo():this.$refs.cUploadView&&(this.$refs.cUploadView.backfillMaskUrl="")}},methods:{setExpend:function(){var e=1,t=Math.max(this.value.realWidth,this.value.realHeight);"extraUpscale"===this.top.menuIndex&&(t*=this.value.scaling_ratio);var n,o;([{min:1024,max:1536,value:1},{min:1536,max:2048,value:3},{min:2048,max:2560,value:4},{min:2560,max:3072,value:6},{min:3072,max:3584,value:8},{min:3584,max:4096,value:10}].forEach((function(n){t>n.min&&t<=n.max&&(e=n.value||2)})),t>4096&&(e=10),"faceSwap"===this.top.menuIndex&&(e=3),"descriptors"===this.top.menuIndex&&(e=1),"preview"===this.top.menuIndex&&(e=1),"animGen"===this.top.menuIndex)&&(e=30,1==(null===(n=this.value.animatediff)||void 0===n?void 0:n.category)&&(e=50));"characterRepair"===this.top.menuIndex&&(e=null!==(o=this.value)&&void 0!==o&&null!==(o=o.imgFiles[3])&&void 0!==o&&o.file?this.characterRepairToolCost():2,3===this.value.speed_type&&(e=0));return e},characterRepairToolCost:function(){var e,t,n=2,o=Math.max((null==this||null===(e=this.value)||void 0===e?void 0:e.realWidth)||0,(null==this||null===(t=this.value)||void 0===t?void 0:t.realHeight)||0);return[{min:0,max:512,value:1},{min:512,max:768,value:2},{min:768,max:1024,value:4}].forEach((function(e){o>e.min&&o<=e.max&&(n=e.value)})),o>1024&&(n=4),0===o&&(n=2),n},changeImage:function(img,e){var t=this.value,n=t.imageUrl,o=t.imgFiles,l=t.workIndex;console.log(n,o,l,e);var r=void 0===e?l:e,c=JSON.parse(JSON.stringify(n)),d=JSON.parse(JSON.stringify(o)),h={left_margin:-1,up_margin:-1};c[r]=null==img?void 0:img.url,h.imageUrl=c,d[r]||(d[r]={}),d[r].file=null==img?void 0:img.file,d[r].uploading=null==img?void 0:img.uploading,h.imgFiles=d,this.showGenerateBtn?h.generateing=Boolean(null==img?void 0:img.uploading):h.generateing=!0,null!=img&&img.url||null!=img&&img.file||(h.mask="",h.tempMask="",h.copyMask="",h.keepDenoisingStrength=!1,h.generateing=!1);var m=JSON.parse(JSON.stringify(this.value));5===this.value.category&&h.width?(m.sdxl.width=h.width,m.sdxl.height=h.height,m.realWidth=h.realWidth,m.realHeight=h.realHeight):m=Ei(Ei({},m),h),this.$emit("input",m)},toolEvent:function(e,t){switch(e){case"DELETE":this.deleteImage();break;case"SET_SIZE":this.saveImageInfo(this.value.isCopy?{isCopy:!1,realWidth:t.realWidth,realHeight:t.realHeight}:t)}},clearExtraInfo:function(){var e;["extraUpscale"].includes(this.top.menuIndex)&&(null==this||null===(e=this.top)||void 0===e||e.clearExtraImageMeta())},deleteImage:function(){var e,t=this.value;if(null!==(e=t.imgFiles[t.workIndex])&&void 0!==e&&e.uploading)return this.$message.warning(this.$t("pleaseUoloadImage")),!1;this.clearExtraInfo(),this.$refs.cUploadView&&(this.$refs.cUploadView.backfillMaskUrl=""),this.changeImage({url:"",file:"",uploading:!1}),3===this.value.action&&this.top.resetCurrentAction(),this.top.setUploadImageStatus(this.menuIndex,!1)},animSetWork:function(e){if(e){var t={action:24,art_work_no:e.id,meta:e.meta};this.$emit("animSetWork",t)}else{JSON.parse(JSON.stringify(this.value)).prompt=""}},saveImageInfo:function(e){var t=JSON.parse(JSON.stringify(this.value));if(t.isUploadImage||null==e||!e.width||"extraUpscale"===this.menuIndex){if(5===this.value.category&&e.width)t.sdxl.width=e.width,t.sdxl.height=e.height,t.realWidth=e.realWidth,t.realHeight=e.realHeight;else if([7,11,"studio"].includes(this.value.category)&&e.width){var n;t.realWidth=e.realWidth,t.realHeight=e.realHeight;var o=this.top.updateStudioSize(null===(n=t)||void 0===n?void 0:n.base_model_type,e.realWidth,e.realHeight,!0);Object.assign(t.studio,o)}else t=Ei(Ei({},t),e);this.$emit("input",t),e&&(e.height||e.realHeight)&&this.$emit("updateImageSize",e)}},generate:function(){this.$emit("generate")},updateMask:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=JSON.parse(JSON.stringify(this.value));t.mask=e,this.$emit("input",t)},imageReadInfo:function(){var e,t=this,n=this.menuIndex,o=this.value,l=o.imageUrl,r=o.workIndex,c=o.action,d=o.imgFiles,h=l[r],m=!["extraUpscale","descriptors","preview","faceSwap","characterRepair"].includes(n),v=this.isFirstImg(l,r,n),f=this.isUploadImg(l,r,d),_=this.isCost();if(console.log("是否有钱： ",_,"是否是会员："+this.isVip),!_&&!this.isCompanyAccount)return this.$EventBus.$emit(this.isVip?"showVipComputingDialog":"showNotVipComputingDialog"),this.changeLoading(!1);if(this.top.readOff&&m&&v&&3!==c&&f){"imageToImage"===this.menuIndex&&(null==this||null===(e=this.top)||void 0===e||e.checkCharacterRepair("")),clearTimeout(this.pollingTimer),this.pollingTimer=null,this.readImagePrompt(h,this.pollingTask);var y=this.top.config;[7,11,"studio"].includes(this.value.category)||Object(A.o)({img_url:h,action:2,base_model_name:5===y[this.menuIndex].category?"SDXL":void 0}).then((function(e){t.$emit("imgReadInfo",e.data,n)}))}else this.changeLoading(!1)},isFirstImg:function(e,t,n){return"imageToImage"===n?3===t:"conditionToImage"!==n||0===t},isCost:function(){var e=this.paymentInfo,t=e.calculateCoins,n=e.tempCoins;return console.log(t,n),t>1||n>1},isUploadImg:function(e,t,n){var o;return null===(o=n[t])||void 0===o?void 0:o.file},changeLoading:function(e){this.saveImageInfo({generateing:e})},readImagePrompt:function(e,t){Object(A.d)({action:11,speed_type:this.top.config[this.menuIndex].speed_type,meta:{img_2_text:{uri:e}}}).then((function(e){t&&t(e.data.id)})).catch((function(e){}))},pollingTask:function(e){var t=this;this.pollingTimer=setTimeout((function(){Object(A.a)({task_ids:[e]}).then((function(n){var o=n.data.items;if(3===o[0].status){var l=o[0],r=l.reverse_local_prompts,c=l.reverse_prompts;t.saveImageInfo({prompt:r[0],local_prompt:c[0],generateing:!1}),clearTimeout(t.pollingTimer),t.pollingTimer=null}else t.pollingTask(e)})).catch((function(e){t.changeLoading(!1)}))}),1e3)},changeReadOff:function(e){var t=this,n=this.value,o=n.imageUrl[n.workIndex];this.top.changeReadOff(e);var l={insight:e?1:2,auto_pub_community:this.accountSettingsData.is_auto_pub_community?1:2};Object(Q.b)(l).then((function(e){var n=(e||{}).status.code;1e4==(void 0===n?"":n)?t.$message.success(t.$t("SaveSuccess")):(t.changeLoading(!1),t.$message.success(t.$t("SaveFailed")))})).catch((function(e){t.$message.success(t.$t("SaveFailed")),t.changeLoading(!1)})),e&&o&&(this.changeLoading(!0),this.imageReadInfo())}}},Ai=Ri,Bi=(n(3040),Object(y.a)(Ai,(function(){var e,t=this,n=t._self._c;return n("div",{staticClass:"work-body"},[t.showPromptStudio?t._e():[n("c-work-tab",{directives:[{name:"show",rawName:"v-show",value:t.isShowTab,expression:"isShowTab"}]}),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:"animGen"!==t.menuIndex,expression:"menuIndex !== 'animGen'"}]},[n("c-upload-box",{directives:[{name:"show",rawName:"v-show",value:!(null!==(e=t.value.imgFiles[t.value.workIndex])&&void 0!==e&&e.file||t.imageUrl),expression:"!(value.imgFiles[value.workIndex]?.file || imageUrl)"}],on:{imageChange:t.changeImage}}),t._v(" "),t._l(t.value.imageUrl,(function(img,i){var e,o;return n("c-upload-view",{directives:[{name:"show",rawName:"v-show",value:t.value.workIndex===i&&((null===(e=t.value.imgFiles[i])||void 0===e?void 0:e.file)||img),expression:"value.workIndex === i && (value.imgFiles[i]?.file || img)"}],key:"showImg_"+i,ref:"cUploadView",refInFor:!0,attrs:{imgFile:null===(o=t.value.imgFiles[i])||void 0===o?void 0:o.file,imageUrl:img,menuIndex:t.menuIndex,"mask-url":t.value.mask,workIndex:i},on:{updateMask:t.updateMask,toolEvent:t.toolEvent}})}))],2),t._v(" "),"animGen"===t.menuIndex?n("div",[n("c-anim-view",{on:{setWork:t.animSetWork,onDelete:t.deleteImage},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1):t._e(),t._v(" "),n("div",{staticClass:"btn-container"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.showGenerateBtn,expression:"!showGenerateBtn"},{name:"loading",rawName:"v-loading",value:t.value.generateing,expression:"value.generateing"}],staticClass:"read-btn"},[t._v("\n        "+t._s(t.$t("IntelligentAnalysis"))),n("el-switch",{attrs:{value:t.top.readOff,"active-color":"#3F8CFF"},on:{change:t.changeReadOff}})],1),t._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:t.showGenerateBtn,expression:"showGenerateBtn"}],staticClass:"generate-btn",attrs:{loading:t.value.generateing},on:{click:t.generate}},[t._v("\n        "+t._s(t.$t("Generate"))+"\n        "),n("span",[t._v(t._s("( ".concat(t.$t("PhysicalExertion"),"：").concat(t.setExpend()," )")))])])],1)],t._v(" "),[t.showPromptStudio?n("PromptStudio"):t._e()]],2)}),[],!1,null,"5039c37b",null).exports),Ui=n(500);function Fi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function zi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fi(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vi={props:["value"],inject:["top"],data:function(){return{isShow:!1,modelCover:xe.n,menuIndex:""}},computed:zi(zi(zi({},Object(S.c)("creation",["taskUnits","taskSdxlUnits","lab_ctr_units"])),Object(S.e)("user",["cdnHost"])),{},{taskModules:function(){var e=this.taskUnits||[];return this.isSdxl&&(e=this.taskSdxlUnits||[]),this.isStudioMode&&(e=this.lab_ctr_units||[]),e},isSdxl:function(){return["5",5,"sdxl","SDXL"].includes(this.value.category)},isStudioMode:function(){return["7",7,"studio",11].includes(this.value.category)},hideModel:function(){return"preview"===this.menuIndex?["none","reference_only"]:["none"]},module:function(){var e,t=this.value,n=t.workIndex;return null===(e=t.controlnet_units[n])||void 0===e?void 0:e.type}}),methods:{show:function(e,t){this.isShow=e,this.menuIndex=t},close:function(){this.show(!1)},changeModel:function(e){var t=JSON.parse(JSON.stringify(this.value)),n=t.workIndex,o=t.controlnet_units,l=t.lab_base;if(o[n].type=e.type,this.isStudioMode){var r=(this.lab_ctr_units||[]).find((function(t){return(null==e?void 0:e.type)===t.type})),c={PyraCanny:{stop_at:.5,weight:1},CPDS:{stop_at:.5,weight:1},FaceSwap:{stop_at:.9,weight:.75}}[null==r?void 0:r.default_model];l.conds[n].mode=null==r?void 0:r.default_model,l.conds[n].stop_at=c.stop_at,l.conds[n].weight=c.weight}var d=this.taskModules.find((function(i){return e.type==i.type}))||{};o[n].model=(null==d?void 0:d.default_model)||"None",o[n].module=(null==d?void 0:d.default_module)||"none",this.$emit("input",t),this.close()}}},Wi=(n(3041),n(3042),Object(y.a)(Vi,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"controlnet-popup custom-dialog big-body-dialog",attrs:{visible:e.isShow,"append-to-body":!0},on:{"update:visible":function(t){e.isShow=t}}},[t("div",{staticClass:"controlnet-body"},[t("i",{staticClass:"el-icon-close",on:{click:e.close}}),e._v(" "),t("div",{staticClass:"controlnet-grid"},e._l(e.taskModules,(function(n,i){return t("div",{directives:[{name:"show",rawName:"v-show",value:!e.hideModel.includes(n.type),expression:"!hideModel.includes(item.type)"}],key:"model_"+i,staticClass:"grid-item",class:{active:e.module===n.type,studioGridItem:e.isStudioMode},on:{click:function(t){return e.changeModel(n)}}},[t("div",{staticClass:"cover zoom-box",style:{"background-image":"url(".concat(n.cover,")")}},[t("span",{staticClass:"name"},[e._v(e._s(e.$t(n.type)))])]),e._v(" "),t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper controlnet",effect:"dark",content:e.$t(n.type+"_Tips"),placement:"top-start"}},[t("p",{staticClass:"tips-info ellipsis-text"},[e._v(e._s(e.$t(n.type+"_Tips")))])])],1)})),0)])])}),[],!1,null,"0d9a5647",null).exports);function Hi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function qi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hi(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Gi={inject:["top"],data:function(){return{isShow:!1,loading:!1,isEnd:!1,channel:{name:""},personList:[]}},computed:qi(qi({},Object(S.e)("user",["userInfo"])),{},{title:function(){return this.channel.name+"("+this.channel.num+")"},disabled:function(){return this.loading||this.isEnd}}),methods:{getNameFirst:function(e){var t=e.name,n=e.id;return t||n?(t?t[0]:n[0]).toUpperCase():""},getPersonList:function(){var e=this,t=this.channel.channel_id;this.loading=!0;var n={channel_id:t,page_size:100};Object(C.f)(this.getTimeForm(n)).then((function(t){e.loading=!1;var n=t.data,o=n.items,l=n.has_more;e.personList=[].concat(Object(R.a)(e.personList),Object(R.a)(o)),e.isEnd=!l})).catch((function(t){e.loading=!1}))},getTimeForm:function(e){var t=this.personList;return t.length?qi(qi({},e),{},{time_from:t[t.length-1].join_time}):e},show:function(e,t){this.initParams(),t&&(this.channel=t,this.getPersonList()),this.isShow=e},initParams:function(){this.personList=[],this.loading=!1,this.isEnd=!1},deletePerson:function(e){var t=this,n=this.personList[e];this.$confirm(this.$t("KickOutChannelTitle")+n.name,this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){Object(C.h)({channel_id:t.channel.channel_id,member_ids:[n.id]}).then((function(n){t.$message.success(t.$t("OperateSuccess")),t.personList.splice(e,1)})).catch((function(){t.$message.warning(t.$t("QuitFail"))}))}))},close:function(){this.show(!1)},toUserPage:function(e){this.isShow=!1;var path=e===this.userInfo.id?"/personal":"/user/"+e;this.$router.push(path),this.top.closePopup()},handleScroll:function(e){var t=e.target;this.loading||this.isEnd||t.scrollHeight-(t.scrollTop+t.clientHeight)<10&&this.getPersonList()}}},Ji=(n(3043),Object(y.a)(Gi,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"custom-dialog channel-person-popup",attrs:{visible:e.isShow,"destroy-on-close":"","append-to-body":!0,title:e.title,"before-close":e.close},on:{"update:visible":function(t){e.isShow=t}}},[t("div",{staticClass:"person-list",on:{scroll:e.handleScroll}},[e._l(e.personList,(function(n,i){return t("div",{key:"person_"+i,staticClass:"person-item"},[t("span",{staticClass:"head-img",style:{backgroundImage:"url("+n.head+")"}},[e._v("\n          "+e._s(n.head?"":e.getNameFirst(n))+"\n        ")]),e._v(" "),t("p",{on:{click:function(t){return e.toUserPage(n.id)}}},[e._v(e._s(n.name))]),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:e.channel.owner_id===n.id,expression:"channel.owner_id === person.id"}],staticClass:"el-icon-user owner-icon"}),e._v(" "),e.userInfo.id!==n.id&&e.channel.owner_id===e.userInfo.id?t("i",{staticClass:"el-icon-remove-outline delete-icon",on:{click:function(t){return e.deletePerson(i)}}}):e._e()])})),e._v(" "),e.loading?t("p",{staticClass:"loading-info"},[t("i",{staticClass:"el-icon-loading"}),e._v(e._s(e.$t("Loading"))+"...\n      ")]):e._e(),e._v(" "),e.isEnd&&e.personList.length>100?t("p",{staticClass:"end-info"},[e._v("别拉了，已经到底啦~")]):e._e()],2)])}),[],!1,null,"af912dfc",null).exports),Ki=n(3044),Xi=n(3045),Qi={name:"ChannelSearch",inject:["top"],"top.channelId":{handler:function(){this.keyword=""},deep:!0,immediate:!0},data:function(){return{keyword:""}},mounted:function(){var e=this;this.$EventBus.$on("clearTaskSearch",(function(){e.keyword="",e.$emit("channelSearch",e.keyword)}))},beforeDestroy:function(){this.$EventBus.$emit("clearTaskSearch")},methods:{handleSearch:function(){this.$emit("channelSearch",this.keyword)},handleChange:function(e){this.$emit("channelSearch",this.keyword)}}},Zi=(n(3046),Object(y.a)(Qi,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-channel-search"},[t("el-input",{staticClass:"channel-search--input",attrs:{placeholder:e.$t("Search"),clearable:""},on:{change:e.handleChange},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[t("template",{slot:"prefix"},[t("i",{staticClass:"iconfont icon-search search-icon"})])],2)],1)}),[],!1,null,null,null)),Yi=Zi.exports,en={name:"ChannelSelectMenu",components:{HandleChannel:L},inject:["top"],computed:{channelInfo:function(){return this.top.channelInfo}},data:function(){return{visible:!1}}},tn=(n(3047),Object(y.a)(en,(function(){var e=this,t=e._self._c;return t("el-popover",{attrs:{placement:"bottom-right",trigger:"click",width:"206","popper-class":"c-channel-select-menu"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("handle-channel",{attrs:{"add-btn-position":"bottom"}}),e._v(" "),t("div",{staticClass:"channel-select-menu-btn",attrs:{slot:"reference"},slot:"reference"},[e._v("\n    "+e._s("PRIVATE"===e.channelInfo.name?e.$t("PRIVATE"):e.channelInfo.name)+"\n    "),t("span",{class:[e.visible?"el-icon-arrow-up":"el-icon-arrow-down"],staticStyle:{"margin-left":"8px"}})])],1)}),[],!1,null,"7911c7aa",null).exports),nn=n(351),an=(n(274),n(110),n(56)),on=n(82),sn=n(135),ln=n(64),rn=n(81),cn=n(269),dn=n(68),un=n(91),hn=void 0;function pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pn(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var vn={name:"EasyStyleModal",mixins:[ce.a],inject:["easyTop"],components:{CollectPopover:an.a,modelPayNum:on.a,changeVer:sn.a,SwipeableList:ln.a,LenovoInput:cn.a,commonConfirmModal:un.a},props:{selectList:{type:Array,default:function(){return[]}},hideEmbedding:{type:Boolean,default:!1},placeholder:{type:String,default:function(){return null==hn?void 0:hn.$t("TaskStylePlaceHolder")}},isPaintingBoard:{type:Boolean,default:!1},isSDXL:{type:Boolean,default:!1},SDXLmodel:{type:Array,default:function(){return null}},SDmodel:{type:Array,default:function(){return null}},inTask:{type:Boolean,default:!1},isStudioMode:{type:Boolean,default:!1},fluxModelId:{type:String,default:""},studioModelInfo:{type:Object,default:function(){return{}}},menuIndex:{type:String,default:function(){return""}},isSimpleMode:{type:Boolean,default:!1}},data:function(){return{visible:!1,topTabConfig:{checkpoint:[{code:"presetsModel",i18nKey:"presetsModel"},{code:"communityMode",i18nKey:"communityModel"},{code:"workflowApp",i18nKey:"Swtft_App"},{code:"character",i18nKey:"digitalHuman"}],other:[{code:"presetsLora",i18nKey:"newGenerate62"},{code:"LORA",i18nKey:"communityModel"}]},activeTopTab:"presetsModel",presetsModelList:[],activeTab:"mine",timeName:"All",timeTypeOption:[{name:"All",startTime:null,endTime:null},{name:"days",startTime:this.getTimestamps().startTimestamp,endTime:this.getTimestamps().endTimestamp},{name:"week",startTime:this.getWeekTimeRange().startTimestamp,endTime:this.getWeekTimeRange().endTimestamp},{name:"months",startTime:this.getMonthTimestampRange().startTimestamp,endTime:this.getMonthTimestampRange().endTimestamp}],tagIndex:"hot",typeOption:[{name:"Hot",id:"hot",icon:"hot"},{name:"New",id:"new",icon:"new1"}],tabList:[{label:"我的",type:"mine",id:"mine",order:1,i18nKey:"Mine"}],queryOptionsList:[{label:"综合推荐",value:"comprehensive",order:1,i18nKey:"styleModal1"},{label:"最近使用",value:"recent",order:2,i18nKey:"recentlyUsed"},{label:"我的收藏",value:"collect",order:3,i18nKey:"MyCollection"},{label:"我的模型",value:"bookmarks_choose",order:4,i18nKey:"MyModel"},{label:"更多推荐",value:"recommend",order:5,i18nKey:"FindGoodPictures"}],queryParam:{order_by:"hot",keyword:"",created:"",model_type:"LORA"},list:[],hotRecentUsedList:[],loading:!1,noMore:!1,pageInfo:{page:1,limit:60,total:0},debounceHandleScroll:null,gridNum:5,modalWidth:"1340px",debounceResize:null,showType:"",modelOption:[],itemScroll:null,queryType:"comprehensive",modelTypeSelect:[],baseModelSelect:[],modelTypes:["LORA","TextualInversion"],tabShowTagEmpty:!1,showTagEmpty:!1,keyWordCopy:"",selectModel:null,modelType:"LORA",enableUsePresetConfig:!0,debounceChangeHandle:function(){}}},computed:mn(mn(mn(mn({},Object(S.e)("user",["collectData","cdnHost","token"])),Object(S.c)("user",["userInfo","isLoggedIn","accountData"])),{},{isSD35Model:function(){var e;return(null===(e=this.getCurrentModelType)||void 0===e?void 0:e.includes("SD 3.5"))||!1},getCurrentTabConfig:function(){var e=this.topTabConfig.other;return this.hideEmbedding&&(e=e.filter((function(e){return"TextualInversion"!==e.code}))),"Checkpoint"===this.modelType?this.topTabConfig.checkpoint:e},showEmptyResult:function(){var e,t=!this.loading,n=!this.renderList.length&&!this.hotRecentUsedList.length,o="mine"===this.activeTab&&!["comprehensive"].includes(this.queryType),l="TextualInversion"===this.modelType&&"TextualInversion"===this.activeTopTab&&!(null!==(e=this.list)&&void 0!==e&&e.length);return t&&n&&(o||l)},lang:function(){return this.$i18n.locale},getTitle:function(){var e={Checkpoint:"Checkpoint",LORA:"LoRA",TextualInversion:this.$t("embedding1")}[this.modelType]||this.modelType;return"".concat(this.$t("selectModels"),"(").concat(e,")")},getModels:function(){var e=xe.B.sd,t=xe.B.sdxl,n=xe.B.flux,o=xe.B.sd35,l=xe.B.pony,r=void 0===l?[]:l,c=xe.B.other,d=void 0===c?[]:c,h=xe.B.sa,m=void 0===h?[]:h,v=[].concat(Object(R.a)(e),Object(R.a)(o),Object(R.a)(t),Object(R.a)(n),Object(R.a)(m),Object(R.a)(d));return{sd:this.SDmodel||[].concat(Object(R.a)(e),Object(R.a)(d)),sdxl:this.SDXLmodel||t,sd35:o,flux:n,allBaseModels:v,pony:r,sa:m}},getBaseModel:function(){null==this||null===(e=this.easyTop)||void 0===e||null===(e=e.config)||void 0===e||null===(e=e.textToImage)||void 0===e||e.base_model_type;var e,t,n,o=this.getModels.sd;(o=this.isSDXL?this.getModels.sdxl:this.isPaintingBoard&&"Checkpoint"===this.modelType?this.getModels.allBaseModels:this.getModels.sd,this.isStudioMode||null!==(t=this.getCurrentModelType)&&void 0!==t&&t.includes("SD 3.5"))&&(o="Checkpoint"===this.modelType?[]:this.getModels.sd,o="Checkpoint"===this.modelType?this.getModels.allBaseModels:{sdxl:this.getModels.sdxl,sd:this.getModels.sd,flux:this.getModels.flux,sa:this.getModels.sa,"SD 3.5":this.getModels.sd35,"SD 3.5L":["SD 3.5L"],"SD 3.5M":["SD 3.5M"]}[this.getCurrentModelType]||this.getModels.sd);return"flux"===this.getCurrentModelType&&(null===(n=this.easyTop)||void 0===n?void 0:n.isCommunityFlux)?Object(R.a)(xe.B.flux):Object(R.a)(o)},getCurrentModelType:function(){var e=(this.studioModelInfo||{}).base_model_type,t=void 0===e?"":e,n=this.getModels.sdxl,o=this.getModels.sd,l=this.getModels.flux,r=this.getModels.sa,c=this.getModels.sd35,d=n.includes(t)||(t||"").includes("SDXL"),h=o.includes(t),m=l.includes(t)||(t||"").includes("Flux"),v=r.includes(t),f=c.includes(t)||(t||"").includes("SD 3.5");return v?"sa":m?"flux":d?"sdxl":h||"SD 3"===t?"sd":f?t:void 0},showRecommendText:function(){var e;return!this.loading&&this.hotUsedList.length&&(null===(e=this.renderList)||void 0===e?void 0:e.length)&&"mine"===this.activeTab&&"comprehensive"===this.queryType},isNoRecentUsed:function(){return!this.loading&&!this.renderList.length&&"recent"===this.queryType&&this.showRecommendText},nsfwUrl:function(){return"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")},activeTabClass:function(){return function(e){return e&&e===this.activeTab?"tab-active":""}}},Object(S.c)(["isSupportWebp"])),{},{getImageUrl:function(){return function(e){var t="";return e.banner&&!["",null,void 0].includes(e.banner.url)?t=Object(k.x)(e.banner.url,this.$imgL):t}},activeSelectModel:function(){return function(e){var t=this.selectList.find((function(t){return(e.id||e.model_id)===(t.id||t.model_id)})),n=this.selectModel&&this.selectModel.id===(null==e?void 0:e.id);return t||n?"select-model-active":""}},renderList:function(){return this.list},hotUsedList:function(){return this.hotRecentUsedList},convertTabText:function(){return function(e){var t="LORA"===this.modelType?"MyStyle":"MyModel";return e.title?e.title:"bookmarks_choose"===e.type?this.$t(t):this.$t(e.i18nKey)}}}),beforeDestroy:function(){this.debounceHandleScroll=null,this.debounceResize=null,this.debounceChangeHandle=null},watch:{hotRecentUsedList:{handler:function(e){for(var i=0;i<this.hotRecentUsedList.length;i++)for(var t=0;t<this.selectList.length;t++)if(this.selectList[t].id===this.hotRecentUsedList[i].id&&this.selectList[t].art_model_ver_no_name&&this.hotRecentUsedList[i].version_name){this.hotRecentUsedList[i].version_name=this.selectList[t].art_model_ver_no_name,this.hotRecentUsedList[i].banner.url=this.selectList[t].model_cover;break}}},list:{handler:function(e){for(var i=0;i<this.list.length;i++)for(var t=0;t<this.selectList.length;t++)if(this.selectList[t].id===this.list[i].id&&this.selectList[t].art_model_ver_no_name&&this.list[i].version_name){this.list[i].version_name=this.selectList[t].art_model_ver_no_name,this.list[i].banner.url=this.selectList[t].model_cover;break}}},userInfo:{handler:function(e){var t;if(null!==(t=Object.keys(e))&&void 0!==t&&t.length){var n=e.settings,o=(void 0===n?{}:n).use_model_preset_meta_mode,l=void 0===o?1:o;this.enableUsePresetConfig=1===l}},deep:!0,immediate:!0}},mounted:function(){var e=this;this.initUsePresetConfigStatus(),this.debounceHandleScroll=Object(X.debounce)(this.handleScroll,600),this.debounceResize=Object(X.debounce)(this.handleResize,500),this.debounceChangeHandle=Object(X.debounce)(this.handleChangeUsePresetConfig,500),window.addEventListener("resize",this.debounceResize),this.$nextTick((function(){e.handleResize()}))},methods:mn(mn({},Object(S.b)("user",["recordEnableUsePresetConfig"])),{},{initUsePresetConfigStatus:function(){var e,t=localStorage.getItem("enableUsePresetConfig");this.isLoggedIn?(this.enableUsePresetConfig=[1,"1"].includes(null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.use_model_preset_meta_mode),localStorage.setItem("enableUsePresetConfig",this.enableUsePresetConfig?1:2)):this.enableUsePresetConfig=!!["",null,void 0].includes(t)||[1,"1"].includes(t)},handleConfirm:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.selectModel)if(t&&this.enableUsePresetConfig){var n,o,l=!0;if(this.isLoggedIn)l=null===(n=this.accountData)||void 0===n?void 0:n.shot_task_v2_preset_meta_popup,null!==(o=this.accountData)&&void 0!==o&&o.shot_task_v2_preset_meta_popup||localStorage.setItem("presetModelNotTips",1);else l=!localStorage.getItem("presetModelNotTips");if(l)this.$refs.commonConfirmModal.show({subTitle:"newGenerate60",fromPage:"modelPreset"}).then((function(){e.$emit("selectModel",e.selectModel,e.queryParam.model_type,t,!0),e.selectModel=null,e.$logEvent("log_actions",{operation:"click_try_it_now",behavior_info:"on_model_config_popup"})})).catch((function(){e.$emit("selectModel",e.selectModel,e.queryParam.model_type,t),e.selectModel=null}));else this.$emit("selectModel",this.selectModel,this.queryParam.model_type,t,!0),this.selectModel=null}else this.$emit("selectModel",this.selectModel,this.queryParam.model_type,t),this.selectModel=null;else this.handleClose()},handleChangeTopTab:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.activeTopTab!==e&&!this.loading){var t;if(["character","workflowApp"].includes(e))null==this||null===(t=this.easyTop)||void 0===t||t.switchCategory(e),this.handleClose();switch(this.activeTopTab=e,e){case"presetsModel":case"presetsLora":this.getPresetModels();break;case"communityMode":this.pageInfo.page=1,this.loading=!0,this.noMore=!1,this.modelTypeSelect=[],this.baseModelSelect=[],Reflect.deleteProperty(this.queryParam,"time_to"),this.checkGetList();break;case"LORA":case"TextualInversion":this.modelType=e,this.queryParam.model_type=this.modelType||"",this.pageInfo.page=1,this.loading=!0,this.noMore=!1,this.modelTypeSelect=[],this.baseModelSelect=[],this.list=[],this.hotRecentUsedList=[],Reflect.deleteProperty(this.queryParam,"time_to"),"LORA"===e?this.checkGetList():this.getPresetModels();break;default:this.checkGetList()}}},handleChangeUsePresetConfig:function(e){this.recordEnableUsePresetConfig(e?1:2),this.$logEvent("log_actions",{operation:"use_recommend_params",behavior_info:"on_choose_model_page",behavior_info_sub:e?"open":"close"})},onFilter:function(e,t){var n=this;this.loading||(1===t?this.modelTypeSelect.includes(e)?this.modelTypeSelect.forEach((function(t,o){t==e&&n.modelTypeSelect.splice(o,1)})):this.modelTypeSelect.push(e):this.baseModelSelect.includes(e)?this.baseModelSelect.forEach((function(t,o){t==e&&n.baseModelSelect.splice(o,1)})):this.baseModelSelect.push(e),"recommend"===this.queryType&&(this.tagIndex="hot"),this.checkGetList())},onFilterReset:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loading||(this.modelTypeSelect=[],this.baseModelSelect=[],e||this.checkGetList())},changeQueryType:function(){this.list=[],this.hotRecentUsedList=[],this.pageInfo={page:1,limit:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:"",created:"",model_type:this.modelType||"LORA"},this.checkGetList(),this.$logEvent("log_actions",{operation:"TextualInversion"===this.modelType?"click_tab":"click_choose_model_tab",behavior_info:"TextualInversion"===this.modelType?"on_create_flow_page_embedding_settings":"on_choose_model_page",behavior_info_sub:this.queryType,source:this.getCurrentSource()})},checkGetList:function(){"comprehensive"!==this.queryType?"recent"===this.queryType?this.handleGetRecentUsed():this.handleSearch():this.handleGetComList()},handleGetComList:function(){var e=this;this.pageInfo.page=1,this.loading=!0,this.noMore=!1,Reflect.deleteProperty(this.queryParam,"time_to");var t={};return t.base_models=this.baseModelSelect.length?this.baseModelSelect:this.getBaseModel,t.model_type=this.modelType||"LORA",t.scene="tf_v2","Checkpoint"!==this.modelType&&(t.model_types=this.modelTypeSelect||[],this.hideEmbedding&&(t.model_types=["LORA"])),(this.isStudioMode||this.isSimpleMode)&&(t.mode="lab"),this.loading=!0,Object(A.i)(t).then((function(t){var n=t||{},o=n.status.code,code=void 0===o?"":o,l=n.data,data=void 0===l?{}:l;if([1e4,"10000"].includes(code)){var r=Array.isArray(null==data?void 0:data.items)?data.items:[],c=Array.isArray(null==data?void 0:data.hot_used_items)?data.hot_used_items:[];e.noMore=!0;var d={},h=(r||[]).map((function(e){return e.art_model||{}})).reduce((function(e,t){return d[t.id]||(d[t.id]=!0,e.push(t)),e}),[]).map((function(t){var n=(t.banner||{}).nsfw;[1,"1"].includes(void 0===n?0:n)&&(t.banner=Object.assign(t.banner||{},{url:e.nsfwUrl}));var o=e.findSelectItem(t);return o&&(t=Object.assign(t,o)),t}));e.list=h.length<=10?h:h.slice(0,10),e.hotRecentUsedList=(c||[]).map((function(e){return e.art_model||{}})).reduce((function(e,t){return d[t.id]||(d[t.id]=!0,e.push(t)),e}),[]).map((function(t){var n,o=(t.banner||{}).nsfw;[1,"1"].includes(void 0===o?0:o)&&(t.banner=Object.assign((null===(n=t)||void 0===n?void 0:n.banner)||{},{url:e.nsfwUrl}));var l=e.findSelectItem(t);return l&&(t=Object.assign(t,l)),t}))}return e.noDataView(),e.list})).finally((function(){e.loading=!1}))},setIcon:function(){var e=this,t="homeIcon1";return this.typeOption.forEach((function(n){e.tagIndex===n.id&&(t=n.icon)})),t},handleCommand:function(e){this.tagIndex=e,this.queryParam.order_by=this.tagIndex,this.handleSearch()},handleTimeCommand:function(e){this.timeName=e.name,this.queryParam.start_at=e.startTime,this.queryParam.end_at=e.endTime,this.handleSearch()},getTimestamps:function(){var e=new Date;return{startTimestamp:e-864e5,endTimestamp:e.getTime()}},getWeekTimeRange:function(){var e=new Date;return{startTimestamp:e-6048e5,endTimestamp:e.getTime()}},getMonthTimestampRange:function(){var e=new Date;e.getFullYear(),e.getMonth();return{startTimestamp:e-2592e6,endTimestamp:e.getTime()}},changeScroll:function(){var e=this;this.$refs.listItem.forEach((function(t,n){t.classList.contains("tab-active")&&(e.itemScroll={value:t.getBoundingClientRect().left,index:n})}))},getTag:function(){var e=this;Object(rn.a)({show_area:"model"}).then((function(t){if(1e4===t.status.code){var n=t.data||[];n.length&&n.forEach((function(t){t.title=t[xe.l[e.$i18n.locale]]})),e.tabList=[].concat(Object(R.a)(e.tabList),Object(R.a)(n))}}))},collectionBar:function(){var e=this;Object(ue.B)({type:2}).then((function(t){1e4===t.status.code&&(e.modelOption=[{label:e.$t("All"),value:""}],t.data.items.forEach((function(t){e.modelOption.push({label:t.name,value:t.id})})))}))},changeType:function(e){this.list=[],this.pageInfo={page:1,limit:60,total:0},this.handleSearch()},handleResize:function(){try{window.innerWidth>1400?(this.modalWidth="1340px",this.gridNum=5):(this.modalWidth="1071px",this.gridNum=4)}catch(e){}},selectItem:function(e,t,n){var o,l;(t.model_ver_no=e.model_ver_id,t.version_name=e.version_no,t.base_model=e.base_model_name,t.modelTags=Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[],t.trained_words=Array.isArray(null==e?void 0:e.trained_words)?null==e?void 0:e.trained_words:[],null!==(o=e.sample)&&void 0!==o&&null!==(o=o.banner)&&void 0!==o&&o.url)?t.banner.url=null===(l=e.sample)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.url:t.banner.url="";n&&(this.selectModel=t,this.handleConfirm())},openModal:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.resetData(),this.modelType=t,this.token&&this.collectionBar(),this.queryParam.model_type=this.modelType||"",this.activeTopTab="";var n="LORA"===this.modelType?"presetsLora":"presetsModel";if(this.tabList=[{label:"我的",type:"mine",id:"mine",order:1,i18nKey:"Mine"}],this.activeTab="mine",this.queryType="comprehensive",this.getTag(),!this.token)return this.handleChangeTopTab(n),void(this.visible=!0);this.$nextTick((function(){"Checkpoint"===e.modelType?e.getRecentUsedModel().finally((function(){e.loading=!1,e.list.length&&e.list.length>=5?(n="communityMode",e.handleChangeTopTab(n)):(e.list=[],e.hotRecentUsedList=[],e.handleChangeTopTab(n))})):e.getRecentUsedModel().finally((function(){e.loading=!1,e.list.length&&e.list.length>=5?(n="LORA",e.handleChangeTopTab(n)):(e.list=[],e.hotRecentUsedList=[],e.handleChangeTopTab(n))})),e.visible=!0}))},getPresetModels:function(){var e=this;this.pageInfo.page=1,this.loading=!0,this.noMore=!1,Reflect.deleteProperty(this.queryParam,"time_to");var t,n={};(n.scene="LORA"===this.modelType?"lora_select_popup":"model","lora_select_popup"===n.scene)&&(n.main_use_base_model=null===(t=this.easyTop)||void 0===t||null===(t=t.config)||void 0===t||null===(t=t.textToImage)||void 0===t?void 0:t.base_model_type,this.hotRecentUsedList=[],this.hideEmbedding&&(n.model_types=["LORA"]));return this.loading=!0,Object(dn.k)(n).then((function(t){var o=t||{},l=o.status.code,code=void 0===l?"":l,r=o.data,data=void 0===r?{}:r;if([1e4,"10000"].includes(code)){var c=Array.isArray(null==data?void 0:data.items)?data.items:[];e.noMore=!0;var d={},h=(c||[]).map((function(e){return e.art_model||{}})).reduce((function(e,t){return d[t.id]||(d[t.id]=!0,e.push(t)),e}),[]).filter((function(t){return"Checkpoint"===e.modelType?t.type===e.modelType:t})).map((function(t){var n,o=(t.banner||{}).nsfw;[1,"1"].includes(void 0===o?0:o)&&(t.banner=Object.assign((null===(n=t)||void 0===n?void 0:n.banner)||{},{url:e.nsfwUrl}));var l=e.findSelectItem(t);return l&&(t=Object.assign(t,l)),t}));"lora_select_popup"===n.scene?(e.presetsModelList=[],e.list=h):(e.presetsModelList=h,e.list=h)}e.noDataView()})).finally((function(){e.loading=!1}))},handleClose:function(){this.visible=!1,this.resetData()},resetData:function(){this.modelType="LORA",this.pageInfo={page:1,limit:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:"",created:"",model_type:this.modelType||"LORA"},this.list=[],this.activeTab="mine",this.queryType="comprehensive",this.loading=!1,this.noMore=!1,this.hotRecentUsedList=[],this.selectModel=null},handleViewMore:function(){this.activeTab="",this.handleTabClick("mine","recommend")},handleTabClick:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e===this.activeTab||this.loading||(this.activeTab=e,this.queryType="mine"===e?n||"comprehensive":"recommend",this.$nextTick((function(){t.changeScroll()})),this.list=[],this.hotRecentUsedList=[],this.pageInfo={page:1,limit:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:"",created:"",model_type:this.modelType||"LORA"},this.checkGetList(),this.$logEvent("log_actions",{operation:"TextualInversion"===this.modelType?"click_tab":"click_choose_model_tab",behavior_info:"TextualInversion"===this.modelType?"on_create_flow_page_embedding_settings":"on_choose_model_page",behavior_info_sub:e,source:this.getCurrentSource()}))},screenAll:function(){this.activeTab="mine",this.baseModelSelect=[],this.modelTypeSelect=[],this.queryParam.order_by="hot",this.queryParam.created="",this.queryParam.start_at=void 0,this.queryParam.end_at=void 0,this.$logEvent("log_actions",{operation:"click_search_all",behavior_info:"on_choose_model_page",behavior_info_sub:this.activeTab}),this.handleSearch()},handleSearch:function(){this.pageInfo.page=1,this.loading=!1,this.noMore=!1,this.list=[],this.hotRecentUsedList=[],Reflect.deleteProperty(this.queryParam,"time_to"),"recent"===this.queryType&&(this.queryType="recommend"),"comprehensive"===this.queryType&&(this.queryType="recommend"),this.getList(),this.$logEvent("log_actions",{operation:"TextualInversion"===this.modelType?"click_tab":"click_choose_model_tab",behavior_info:"TextualInversion"===this.modelType?"on_create_flow_page_embedding_settings":"on_choose_model_page",behavior_info_sub:"search_btn",source:this.getCurrentSource()})},handleScroll:function(){var e=this.$refs.scrollWrapper;try{e&&e.scrollTop+e.clientHeight>=e.scrollHeight-30&&"recent"!==this.queryType&&this.getList(!0)}catch(e){}},getList:function(e){var t=this;if(!this.loading&&!this.noMore){this.loading=!0;var n={collect:"bookmarks",recommend:"community",bookmarks_choose:"bookmarks_choose"}[JSON.parse(JSON.stringify(this.queryType))]||"",o={page:this.pageInfo.page,page_size:this.pageInfo.limit,type:n,scene:"tf_v2"};if((this.isStudioMode||this.isSimpleMode)&&(o.mode="lab"),this.inTask&&(o.refer="task"),"bookmarks"===o.type){var l=0;o.folder_no=this.showType;try{var r,c=this.list.length?this.list[this.list.length-1]:null;l=(null==c||null===(r=c.collect)||void 0===r?void 0:r.collect_at)||0,o.after=1===o.page?0:l}catch(e){}}["recent","collect","bookmarks","bookmarks_choose","recommend","comprehensive","mine"].includes(this.activeTab)||(o.tags=[this.activeTab],o.type="community"),o.base_models=this.baseModelSelect.length?this.baseModelSelect:this.getBaseModel,"Checkpoint"!==this.modelType&&(o.model_types=this.modelTypeSelect||[],this.hideEmbedding&&(o.model_types=["LORA"])),Object.assign(o,this.queryParam),(""!==this.queryParam.keyword&&"recommend"===this.queryType?Be.o:Be.r)(o).then((function(n){var o=n||{},l=o.status,r=void 0===l?{}:l,c=o.data,data=void 0===c?{}:c,d=r.code;if([1e4,"10000"].includes(void 0===d?"":d)){if(t.noMore=!data.has_more,e){var h=t.list.map((function(e){return e.id})),m=(n.data.items||[]).filter((function(e){return!h.includes(e.id)})).map((function(e){var n=(e.banner||{}).nsfw;[1,"1"].includes(void 0===n?0:n)&&(e.banner=Object.assign(e.banner||{},{url:t.nsfwUrl}));var o=t.findSelectItem(e);return o&&(e=Object.assign(e,o)),e}));t.list=t.list.concat(m)}else{var v,f=((null==n||null===(v=n.data)||void 0===v?void 0:v.items)||[]).reduce((function(e,t){return e.some((function(e){return e.id===t.id}))||e.push(t),e}),[]);t.list=(f||[]).map((function(e){var n=(e.banner||{}).nsfw;[1,"1"].includes(void 0===n?0:n)&&(e.banner=Object.assign(e.banner||{},{url:t.nsfwUrl}));var o=t.findSelectItem(e);return o&&(e=Object.assign(e,o)),e}))}1===t.pageInfo.page&&(t.queryParam.time_to=n.data.time_ms),t.pageInfo.page++,t.loading=!1,t.keyWordCopy=t.queryParam.keyword,t.noDataView()}})).catch((function(e){console.log(e)})).finally((function(){t.loading=!1}))}},noDataView:function(){var e=!this.loading,t=!this.list.length,n="mine"!==this.activeTab,o=""===this.queryParam.keyword,l=e&&t&&n&&o,r=e&&t&&n&&!o;this.tabShowTagEmpty=l,this.showTagEmpty=r},findSelectItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.activeSelectModel(e)){var t=this.selectList.find((function(t){return(e.id||e.model_id)===(t.id||t.model_id)}));return e=t||e}return null},getCurrentSource:function(){return"TextualInversion"===this.modelType?"embedding":this.isSimpleMode?"simple_task":this.isPaintingBoard?"painting_board":"task"},handleSelectPresetModel:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];["","el-icon-arrow-down"].includes(null===(t=e.target)||void 0===t?void 0:t.className)||(o?this.$message.warning(this.$t("CannotSelectedRepeatedly")):(this.selectModel=n,this.handleConfirm("Checkpoint"!==this.modelType?"":"preset")))},handleSelect:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(["cltpop","use"].includes(null===(e=(arguments.length>2?arguments[2]:void 0).target)||void 0===e?void 0:e.className)){if(n)return void this.$message.warning(this.$t("CannotSelectedRepeatedly"));if(this.isStudioMode&&!this.isStudioFlux&&"Checkpoint"!==this.modelType){var o=(this.studioModelInfo||{}).base_model_type,l=void 0===o?"":o,r=this.getModels.sdxl,c=this.getModels.sd,d=(this.getModels.sd3,this.getModels.sd35),h=r.includes(l)||(l||"").includes("SDXL"),m=c.includes(l),v=d.includes(l)||(l||"").includes("SD 3.5"),f=((null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[]).includes(l),_=r.includes(null==t?void 0:t.base_model)||((null==t?void 0:t.base_model)||"").includes("SDXL"),y=c.includes(null==t?void 0:t.base_model),w=d.includes(null==t?void 0:t.base_model)||((null==t?void 0:t.base_model)||"").includes("SD 3.5"),C=((null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[]).includes(null==t?void 0:t.base_model);return h&&!_||m&&!y||f&&!C||v&&!w?void this.$message.warning(this.$t("studio25")):(this.$logEvent("log_actions",{operation:"click_choose_model",behavior_info:"on_choose_model_page",behavior_info_sub:null==t?void 0:t.id,source:this.getCurrentSource()}),this.selectModel=t,void this.handleConfirm())}if(this.isStudioMode&&["imageToImage","conditionToImage"].includes(null==this?void 0:this.menuIndex)&&(null==t?void 0:t.id)===(null==this?void 0:this.fluxModelId))return void this.$message.warning(this.$t("studioTips1"));this.$logEvent("log_actions",{operation:"click_choose_model",behavior_info:"on_choose_model_page",behavior_info_sub:null==t?void 0:t.id,source:this.getCurrentSource()}),this.selectModel=t,this.handleConfirm()}},handleGetRecentUsed:function(){this.pageInfo.page=1,this.loading=!0,this.noMore=!1,Reflect.deleteProperty(this.queryParam,"time_to"),this.getRecentUsedModel()},getRecentUsedModel:function(){var e=this,t={};return t.base_models=this.baseModelSelect.length?this.baseModelSelect:this.getBaseModel,"TextualInversion"===this.modelType&&(t.model_type="TextualInversion"),(this.isStudioMode||this.isSimpleMode)&&(t.mode="lab"),t.scene="tf_v2","Checkpoint"!==this.modelType&&(t.model_types=this.modelTypeSelect||[],this.hideEmbedding&&(t.model_types=["LORA"])),this.loading=!0,Object(A.l)(t).then((function(t){console.log(t);var n=t||{},o=n.status.code,code=void 0===o?"":o,l=n.data,data=void 0===l?{}:l;if([1e4,"10000"].includes(code)){var r=Array.isArray(data.items)?data.items:[],c={};e.list=(r||[]).map((function(e){return e.art_model||{}})).reduce((function(e,t){return c[t.id]||(c[t.id]=!0,e.push(t)),e}),[]).filter((function(t){return e.isStudioMode||e.isSimpleMode?t.type===e.modelType:t.type===e.modelType&&(null==t?void 0:t.id)!==xe.h})).map((function(t){var n=(t.banner||{}).nsfw;[1,"1"].includes(void 0===n?0:n)&&(t.banner=Object.assign(t.banner||{},{url:e.nsfwUrl}));var o=e.findSelectItem(t);return o&&(t=Object.assign(t,o)),t}))}return e.noDataView(),e.list})).finally((function(){e.loading=!1}))},handleDetail:function(e){(null==e?void 0:e.id)&&window.open("/models/detail/".concat(e.id))},convertModelFlag:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getModels.sdxl,n=(this.getModels.sd,this.getModels.flux||[]),o=e.type,l=void 0===o?"":o,r=e.base_model,c=void 0===r?"":r,d=t.includes(c)||(c||"").includes("SDXL");if(["LORA","TextualInversion"].includes(l)){var h=["TextualInversion"].includes(l)?this.$t("embedding1"):"LORA";return n.includes(c)?h+=" | F1 ":d&&(h=(["TextualInversion"].includes(l)?this.$t("embedding1"):"LORA")+(d?" | SDXL":"")),h}return n.includes(c)?"LORA"===this.modelType?"LoRA | F1 ":"Checkpoint | F1 ":d?"SDXL":""}})},gn=vn,fn=(n(3048),n(3049),Object(y.a)(gn,(function(){var e,t,n,o,l,r=this,c=r._self._c;return c("el-dialog",{ref:"styleModal",attrs:{title:r.getTitle,visible:r.visible,width:r.modalWidth,height:"auto","custom-class":"easy-style-modal","modal-append-to-body":!0,"append-to-body":!0,"close-on-click-modal":!0,center:""},on:{"update:visible":function(e){r.visible=e},close:function(e){return r.onFilterReset(!0)}}},[c("template",{slot:"title"},[c("div",{staticClass:"easy-style-modal-header"},[c("div",{staticClass:"easy-style-modal-header-tabs"},r._l(r.getCurrentTabConfig,(function(e){return c("div",{key:"top_tab_".concat(e.code),staticClass:"header-tabs-item",class:[r.activeTopTab===(null==e?void 0:e.code)&&"header-tabs-item-active"],on:{click:function(t){return t.stopPropagation(),r.handleChangeTopTab(e.code)}}},[r._v("\n            "+r._s(r.$t(e.i18nKey))+"\n          ")])})),0),r._v(" "),c("div",{staticClass:"header-close-btn",on:{click:function(e){return e.stopPropagation(),r.handleClose()}}},[c("i",{staticClass:"el-icon-close"})])])]),r._v(" "),c("div",{staticClass:"style-content-wrapper"},[["presetsModel","TextualInversion","presetsLora"].includes(r.activeTopTab)?r._e():c("div",{staticClass:"style-content__header"},[c("swipeable-list",{attrs:{scrollChange:r.itemScroll,top:"15px"}},[c("div",{staticClass:"style-content__header-tabs"},r._l(r.tabList,(function(e,t){return c("div",{key:"tab_".concat(null==e?void 0:e.id,"_").concat(t)},[c("div",{ref:"listItem",refInFor:!0,staticClass:"style-content__header-tabs-item",class:[r.activeTabClass(e.id)],on:{click:function(t){return t.stopPropagation(),r.handleTabClick(e.id)}}},[r._v("\n                "+r._s(r.convertTabText(e))+"\n              ")])])})),0)])],1),r._v(" "),["presetsModel","TextualInversion","presetsLora"].includes(r.activeTopTab)?r._e():c("div",{staticClass:"style-content__search-box"},[c("div",[r._e(),r._v(" "),c("LenovoInput",{attrs:{width:404,screen:{activeTab:r.activeTab,baseModelSelect:r.baseModelSelect.length?r.baseModelSelect:r.getBaseModel,modelType:r.modelType,isStudioMode:r.isStudioMode,isSimpleMode:r.isSimpleMode},isLoca:"creative",clearable:"",placeholder:"LORA"===r.modelType?r.$t("TaskStylePlaceHolder"):r.$t("TaskModelPlaceHolder")},on:{onScreen:r.handleSearch,clear:r.handleSearch},model:{value:r.queryParam.keyword,callback:function(e){r.$set(r.queryParam,"keyword",e)},expression:"queryParam.keyword"}}),r._v(" "),c("span",{staticClass:"style-content__search-btn style-content__search-btn-gra-border",on:{click:function(){return""!=r.queryParam.keyword&&r.handleSearch()}}},[c("span",[r._v(r._s(r.$t("Search")))])])],1),r._v(" "),c("div",{staticClass:"search-right"},[c("el-popover",{attrs:{placement:"bottom","popper-class":"homeFilter",trigger:"hover"}},[c("div",{staticClass:"filterCnt"},["Checkpoint"===r.modelType||r.isSD35Model||r.hideEmbedding?r._e():c("div",[c("div",{staticClass:"filterTit"},[r._v("\n                  "+r._s(r.$t("BaseModel"))+"\n                ")]),r._v(" "),c("div",{staticClass:"filterList"},r._l(r.modelTypes,(function(e,t){return c("div",{key:t,staticClass:"filterItem",class:{AfilterItem:r.modelTypeSelect.includes(e)},on:{click:function(t){return r.onFilter(e,1)}}},[r.modelTypeSelect.includes(e)?c("i",{staticClass:"el-icon-check"}):r._e(),r._v(" "),c("span",[r._v(r._s("TextualInversion"===e?r.$t("embedding1"):e))])])})),0)]),r._v(" "),c("div",{staticClass:"filterTit",staticStyle:{"margin-top":"16px"}},[r._v(r._s(r.$t("BaseModel")))]),r._v(" "),c("div",{staticClass:"filterList"},r._l(r.getBaseModel,(function(e,t){return c("div",{key:t,staticClass:"filterItem",class:{AfilterItem:r.baseModelSelect.includes(e)},on:{click:function(t){return r.onFilter(e,2)}}},[r.baseModelSelect.includes(e)?c("i",{staticClass:"el-icon-check"}):r._e(),r._v(" "),c("span",[r._v(r._s("TextualInversion"===e?r.$t("embedding1"):e))])])})),0),r._v(" "),c("div",{staticClass:"filterReset graBorder",on:{click:function(e){return r.onFilterReset(!1)}}},[r._v("\n                "+r._s(r.$t("resetSelection"))+"\n              ")])]),r._v(" "),c("el-badge",{staticClass:"item",attrs:{slot:"reference",value:(null===(e=r.modelTypeSelect)||void 0===e?void 0:e.length)+(null===(t=r.baseModelSelect)||void 0===t?void 0:t.length),hidden:(null===(n=r.modelTypeSelect)||void 0===n?void 0:n.length)+(null===(o=r.baseModelSelect)||void 0===o?void 0:o.length)==0},slot:"reference"},[c("div",{staticClass:"filterBox"},[c("div",[c("i",{staticClass:"iconfont icon-a-filterIcon"}),r._v(" "),c("span",[r._v(r._s(r.$t("Filter")))])]),r._v(" "),c("i",{staticClass:"el-icon-arrow-down"})])])],1),r._v(" "),"mine"===r.activeTab&&"collect"===r.queryType&&r.modelOption.length>0?c("el-select",{staticClass:"showType custom-select",class:r.$i18n.locale,attrs:{"popper-class":"custom-select"},on:{change:r.changeType},model:{value:r.showType,callback:function(e){r.showType=e},expression:"showType"}},r._l(r.modelOption,(function(e){return c("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):r._e(),r._v(" "),"mine"===r.activeTab?c("el-select",{staticClass:"showType custom-select",class:r.$i18n.locale,attrs:{"popper-class":"custom-select"},on:{change:r.changeQueryType},model:{value:r.queryType,callback:function(e){r.queryType=e},expression:"queryType"}},r._l(r.queryOptionsList,(function(e){return c("el-option",{key:e.value,attrs:{label:r.$t(e.i18nKey),value:e.value}})})),1):r._e(),r._v(" "),["recent","collect","bookmarks","bookmarks_choose","recommend","mine"].includes(r.activeTab)?r._e():c("div",{staticClass:"Screening"},[c("el-dropdown",{attrs:{trigger:"hover"},on:{command:r.handleTimeCommand}},[c("div",{staticClass:"el-dropdown-link selectTime"},[c("div",[c("i",{staticClass:"el-icon-time"}),r._v(" "),c("span",[r._v(r._s(r.$t(r.timeName)))])]),r._v(" "),c("i",{staticClass:"el-icon-arrow-down"})]),r._v(" "),c("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},r._l(r.timeTypeOption,(function(e,t){return c("el-dropdown-item",{key:t,attrs:{command:e}},[c("div",{staticClass:"el-dropdown-item el-dropdown-item-time"},[c("span",[r._v(r._s(r.$t(e.name)))])])])})),1)],1),r._v(" "),c("el-dropdown",{attrs:{trigger:"hover"},on:{command:r.handleCommand}},[c("div",{staticClass:"el-dropdown-link"},[c("div",[c("i",{staticClass:"iconfont custom-iconfont",class:"icon-".concat(r.setIcon())}),r._v(" "),c("span",[r._v(r._s(r.$t(r.tagIndex.charAt(0).toUpperCase()+r.tagIndex.slice(1))))])]),r._v(" "),c("i",{staticClass:"el-icon-arrow-down"})]),r._v(" "),c("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},r._l(r.typeOption,(function(e,t){return c("el-dropdown-item",{key:t,attrs:{command:e.id}},[c("div",{staticClass:"el-dropdown-item"},[c("i",{staticClass:"iconfont custom-iconfont",class:"icon-".concat(e.icon)}),r._v(" "),c("span",[r._v(r._s(r.$t(e.name)))])])])})),1)],1)],1)],1)]),r._v(" "),["presetsModel"].includes(r.activeTopTab)&&"Checkpoint"===r.modelType?c("div",{directives:[{name:"show",rawName:"v-show",value:!r.loading&&(null===(l=r.presetsModelList)||void 0===l?void 0:l.length),expression:"!loading && presetsModelList?.length"}],staticClass:"presets-model-option-btn"},[c("el-checkbox",{staticClass:"presets-model-option-checkbox",on:{change:r.debounceChangeHandle},model:{value:r.enableUsePresetConfig,callback:function(e){r.enableUsePresetConfig=e},expression:"enableUsePresetConfig"}},[r._v("\n          "+r._s(r.$t("newGenerate59"))+"\n        ")])],1):r._e(),r._v(" "),c("div",{directives:[{name:"loading",rawName:"v-loading",value:r.loading,expression:"loading"}],ref:"scrollWrapper",staticClass:"style-content__list-wrapper",class:[r.isNoRecentUsed?"style-content__list-wrapper-no-margin":"",!["presetsModel","presetsLora"].includes(r.activeTopTab)&&"style-content__list-wrapper-box",["presetsModel"].includes(r.activeTopTab)&&"style-content__list-wrapper-presetModel"],style:{gridTemplateColumns:"repeat(".concat(r.gridNum,", 1fr)")},on:{scroll:r.handleScroll}},[["presetsModel"].includes(r.activeTopTab)?r._l(r.presetsModelList,(function(e){var t;return c("div",{key:"preset_mode_".concat(e.id),staticClass:"style-content__list-item style-content__list-item-preset-model",class:[r.activeSelectModel(e)],on:{click:function(t){t.stopPropagation(),r.handleSelectPresetModel(t,e,r.activeSelectModel(e))}}},[c("div",{staticClass:"preset-model-cltpop"},[c("div",{staticClass:"collect-popover-container"},[c("CollectPopover",{attrs:{type:"model",folder:e,from:"waterfall"}})],1),r._v(" "),c("div",{staticClass:"detail-button",on:{click:function(t){return t.stopPropagation(),r.handleDetail(e)}}},[r._v("\n                "+r._s(r.$t("Details"))+"\n              ")])]),r._v(" "),c("div",{staticClass:"list-item-image-wrapper"},[["",null,void 0].includes(null==e||null===(t=e.banner)||void 0===t?void 0:t.url)?c("div",{staticClass:"list-item-image-card-image"},[c("div",{staticClass:"image-empty"},[r._v(r._s(r.$t("EmptyBannerText")))])]):c("el-image",{staticClass:"list-item-image-card-image",attrs:{src:r.getImageUrl(e)}},[c("template",{slot:"error"},[c("img",{directives:[{name:"webp",rawName:"v-webp",value:r.$imgL,expression:"$imgL"}],staticClass:"list-item-image-card-image",attrs:{src:e&&e.banner?e.banner.url:"",alt:""}})])],2)],1),r._v(" "),c("div",{staticClass:"image-describe-box"},[c("div",{staticClass:"image-describe-box-main-title"},[r._v(r._s(e.name))]),r._v(" "),c("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:(null==e?void 0:e.desc)||"",placement:"bottom"}},[c("div",{staticClass:"image-describe-box-describe-text"},[r._v(r._s((null==e?void 0:e.desc)||""))])])],1)])})):[r.renderList.length?r._l(r.renderList,(function(e){var t;return c("div",{key:e.id,staticClass:"style-content__list-item",class:[r.activeSelectModel(e)],on:{click:function(t){return t.stopPropagation(),function(t){return r.handleSelect(e,r.activeSelectModel(e),t)}.apply(null,arguments)}}},[c("div",{staticClass:"top-box"},[e.is_agency_fee?c("div",{staticClass:"payNum"},[c("modelPayNum",{attrs:{number:e.agency_fee}})],1):r._e()]),r._v(" "),c("div",{staticClass:"cltpop"},[c("div",{staticClass:"collect-popover-container"},[c("CollectPopover",{attrs:{type:"model",folder:e,from:"waterfall"}})],1),r._v(" "),c("div",{staticClass:"detail-button",on:{click:function(t){return t.stopPropagation(),r.handleDetail(e)}}},[r._v("\n                "+r._s(r.$t("Details"))+"\n              ")])]),r._v(" "),c("div",{staticClass:"list-item-image-wrapper"},[["",null,void 0].includes(null==e||null===(t=e.banner)||void 0===t?void 0:t.url)?c("div",{staticClass:"list-item-image-card-image"},[c("div",{staticClass:"image-empty"},[r._v(r._s(r.$t("EmptyBannerText")))])]):c("el-image",{staticClass:"list-item-image-card-image",attrs:{src:r.getImageUrl(e)}},[c("template",{slot:"error"},[c("img",{directives:[{name:"webp",rawName:"v-webp",value:r.$imgL,expression:"$imgL"}],staticClass:"list-item-image-card-image",attrs:{src:e&&e.banner?e.banner.url:"",alt:""}})])],2)],1),r._v(" "),c("div",{staticClass:"list-item-image-mask"},[c("div",{staticClass:"list-item-image-mask-row"},[c("span",{staticClass:"list-item-image-mask-item__content",attrs:{title:e.name}},[r._v(r._s(e.name))])]),r._v(" "),c("div",{staticClass:"list-item-image-mask-row"},[c("changeVer",{attrs:{from:"styleModal",item:e,base_models:r.getBaseModel},on:{selectItem:function(t){return r.selectItem(t,e,r.activeSelectModel(e))}}}),r._v(" "),c("div",{staticClass:"use",on:{click:function(t){return t.stopPropagation(),function(t){return r.handleSelect(e,r.activeSelectModel(e),t)}.apply(null,arguments)}}},[r._v(r._s(r.$t("workFlow46")))])],1)]),r._v(" "),"Pony"===(null==e?void 0:e.base_model)?[c("span",{staticClass:"model-type-flag"},[r._v("\n                "+r._s("TextualInversion"===r.modelType?r.$t("embedding1"):r.modelType)),c("span",{staticClass:"model-type-flag-line"},[r._v("|")]),c("i",{staticClass:"iconfont icon-icon-horse model-type-flag-icon"})])]:[c("span",{directives:[{name:"show",rawName:"v-show",value:""!==r.convertModelFlag(e),expression:"convertModelFlag(item) !==''"}],staticClass:"model-type-flag"},[r._v(r._s(r.convertModelFlag(e)))])]],2)})):r._e(),r._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:r.showRecommendText,expression:"showRecommendText"}],staticClass:"recommend-text",style:{gridColumn:"span ".concat(r.gridNum)},attrs:{renderList:""}},[c("div",{staticClass:"recommend-text-line"}),r._v(" "),c("div",{staticClass:"recommend-text-main"},[r._v(r._s(r.$t("styleModalLineText")))]),r._v(" "),c("div",{staticClass:"recommend-text-line"})]),r._v(" "),!r.loading&&r.hotUsedList.length&&"mine"===r.activeTab&&["comprehensive"].includes(r.queryType)?[r._l(r.hotUsedList,(function(e){var t;return c("div",{key:"hot_".concat(e.id),staticClass:"style-content__list-item",class:[r.activeSelectModel(e)],on:{click:function(t){return t.stopPropagation(),function(t){return r.handleSelect(e,r.activeSelectModel(e),t)}.apply(null,arguments)}}},[c("div",{staticClass:"top-box"},[e.is_agency_fee?c("div",{staticClass:"payNum"},[c("modelPayNum",{attrs:{number:e.agency_fee}})],1):r._e()]),r._v(" "),c("div",{staticClass:"cltpop"},[c("div",{staticClass:"collect-popover-container"},[c("CollectPopover",{attrs:{type:"model",folder:e,from:"waterfall"}})],1),r._v(" "),c("div",{staticClass:"detail-button",on:{click:function(t){return t.stopPropagation(),r.handleDetail(e)}}},[r._v("\n                "+r._s(r.$t("Details"))+"\n              ")])]),r._v(" "),c("div",{staticClass:"list-item-image-wrapper"},[["",null,void 0].includes(null==e||null===(t=e.banner)||void 0===t?void 0:t.url)?c("div",{staticClass:"list-item-image-card-image"},[c("div",{staticClass:"image-empty"},[r._v(r._s(r.$t("EmptyBannerText")))])]):c("el-image",{staticClass:"list-item-image-card-image",attrs:{src:r.getImageUrl(e)}},[c("template",{slot:"error"},[c("img",{directives:[{name:"webp",rawName:"v-webp",value:r.$imgL,expression:"$imgL"}],staticClass:"list-item-image-card-image",attrs:{src:e&&e.banner?e.banner.url:"",alt:""}})])],2),r._v(" "),c("div",{staticClass:"list-item-image-mask"},[c("div",{staticClass:"list-item-image-mask-row"},[c("span",{staticClass:"list-item-image-mask-item__content",attrs:{title:e.name}},[r._v(r._s(e.name))])]),r._v(" "),c("div",{staticClass:"list-item-image-mask-row"},[c("changeVer",{attrs:{from:"styleModal",item:e,base_models:r.getBaseModel},on:{selectItem:function(t){return r.selectItem(t,e,r.activeSelectModel(e))}}}),r._v(" "),c("div",{staticClass:"use",on:{click:function(t){return t.stopPropagation(),function(t){return r.handleSelect(e,r.activeSelectModel(e),t)}.apply(null,arguments)}}},[r._v(r._s(r.$t("workFlow46")))])],1)])],1),r._v(" "),"Pony"===(null==e?void 0:e.base_model)?[c("span",{staticClass:"model-type-flag"},[r._v("\n                "+r._s("TextualInversion"===(null==e?void 0:e.type)?r.$t("embedding1"):r.modelType)),c("span",{staticClass:"model-type-flag-line"},[r._v("|")]),c("i",{staticClass:"iconfont icon-icon-horse model-type-flag-icon"})])]:[c("span",{directives:[{name:"show",rawName:"v-show",value:""!==r.convertModelFlag(e),expression:"convertModelFlag(item) !==''"}],staticClass:"model-type-flag"},[r._v(r._s(r.convertModelFlag(e)))])]],2)})),r._v(" "),c("div",{staticClass:"show-more-item",style:{gridColumn:"span ".concat(r.gridNum)}},[c("span",{staticClass:"show-more-item-btn",on:{click:function(e){return e.stopPropagation(),r.handleViewMore()}}},[c("span",{staticClass:"show-more-item-btn-text"},[r._v(r._s(r.$t("viewMore")))]),r._v(" "),c("i",{staticClass:"iconfont icon-icon-direction-down show-more-item-btn-icon"})])])]:r._e(),r._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:r.showEmptyResult,expression:"showEmptyResult"}],staticClass:"style-content__list-empty"},[c("svg-icon",{staticClass:"style-content__list-empty-icon",attrs:{"icon-class":"style-empty-icon"}}),r._v(" "),"LORA"===r.modelType&&"mine"===r.activeTab&&["recent"].includes(r.queryType)&&["",null,void 0].includes(r.queryParam.keyword)?[r._v("\n            "+r._s(r.$t("styleRecent"))+"\n          ")]:"LORA"===r.modelType&&["collect"].includes(r.queryType)&&"mine"===r.activeTab&&["",null,void 0].includes(r.queryParam.keyword)?[r._v("\n            "+r._s(r.$t("styleCollect"))+"\n          ")]:[r._v(r._s(r.$t("NoResultsFound")))]],2),r._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:r.showTagEmpty,expression:"showTagEmpty"}],staticClass:"tag-empty-box flex_c_m"},[c("div",{staticClass:"item flex_c"},[c("p",[r._v(r._s(r.$t("screenTagNodata",{keyword:r.keyWordCopy?' "'.concat(r.keyWordCopy,'" '):""})))]),r._v(" "),c("div",{staticClass:"btn",on:{click:r.screenAll}},[r._v(r._s(r.$t("screenAll")))])])]),r._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:r.tabShowTagEmpty,expression:"tabShowTagEmpty"}],staticClass:"style-content__list-empty"},[c("svg-icon",{staticClass:"style-content__list-empty-icon",attrs:{"icon-class":"style-empty-icon"}}),r._v(" "),c("p",[r._v(r._s(r.$t("NoResultsFound")))])],1)]],2)]),r._v(" "),c("common-confirm-modal",{ref:"commonConfirmModal"})],2)}),[],!1,null,"6e544e6e",null)),_n=fn.exports,bn=n(3050),yn={name:"SelectModelConfirmModal",data:function(){return{visible:!1,options:null,list:[],resolve:null,reject:null}},methods:{show:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.resetData(),this.options=n,this.list=t,this.visible=!0,new Promise((function(t,n){e.resolve=t,e.reject=n}))},resetData:function(){this.list=[],this.options=null,this.resolve=null,this.reject=null},handleClose:function(){if(this.visible=!1,this.reject)return this.reject(!1)},handleConfirm:function(){if(this.visible=!1,this.resolve)return this.resolve(!0)}}},wn=yn,Cn=(n(3051),Object(y.a)(wn,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,"custom-class":"easy-select-model-confirm-modal custom-dialog","destroy-on-close":!1,"close-on-press-escape":!0,modal:!1,"modal-append-to-body":"","append-to-body":"",width:"407px"},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"easy-select-model-confirm-modal-header"},[t("div",{staticClass:"modal-header-title"},[e._v(e._s(e.$t("Tip")))]),e._v(" "),t("span",{staticClass:"modal-header-close",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[t("i",{staticClass:"el-icon-close"})])]),e._v(" "),t("div",{staticClass:"easy-select-model-confirm-modal-content"},[t("div",{staticClass:"modal-content-left"},[t("div",{staticClass:"warning-icon-box"},[t("i",{staticClass:"iconfont icon-warn"})])]),e._v(" "),t("div",{staticClass:"modal-content-right"},[t("div",{staticClass:"modal-content-right-title"},[e._v(e._s(e.$t("newGenerate22")))]),e._v(" "),t("div",{staticClass:"modal-content-right-tag-box"},e._l(e.list,(function(n,o){return t("span",{key:"tag_item_".concat(o),staticClass:"modal-content-right-tag-item"},[e._v(e._s(e.$t(n))+"\n        ")])})),0),e._v(" "),t("div",{staticClass:"modal-content-right-sub-title"},[e._v(e._s(e.$t("newGenerate23")))])])]),e._v(" "),t("div",{staticClass:"easy-select-model-confirm-modal-footer"},[t("span",{staticClass:"modal-footer-btn",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("span",{staticClass:"modal-footer-btn modal-footer-btn-confirm",on:{click:function(t){return t.stopPropagation(),e.handleConfirm()}}},[e._v(e._s(e.$t("Confirm")))])])])}),[],!1,null,null,null).exports),kn=n(271);function Sn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function xn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sn(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var In={name:"EasyModelPanel",props:["value"],inject:["easyTop"],components:{EasyStyleModal:_n,SelectModelConfirmModal:Cn,commonConfirmModal:un.a,changeVerNew:kn.a},data:function(){return{extraModelList:[],selectModelType:"Checkpoint",selectIds:[]}},mounted:function(){var e=this;this.$EventBus.$on("selectModel",(function(t){return e.handleSelectModel2(t)}))},beforeDestroy:function(){this.$EventBus.$off("selectModel")},computed:xn(xn({},Object(S.c)("creation",["taskBaseModels","v2_sd_xl_ctr_units","v2_ctr_units"])),{},{taskModules:function(){var e;return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isSDXLModel?this.v2_sd_xl_ctr_units:this.v2_ctr_units},getTaskUnitsDiffList:function(){var e=this.v2_sd_xl_ctr_units.map((function(e){return null==e?void 0:e.type})),t=this.v2_ctr_units.map((function(e){return null==e?void 0:e.type}));return Object(bn.difference)(e,t)},hideModel:function(){return"preview"===(null==this?void 0:this.menuIndex)?["none","reference_only"]:["none"]},modelsList:function(){var e=this.value,t=e.art_work_no,n=e.art_model_no,o=e.art_model_ver_no,l=void 0===o?"":o,r=this.taskBaseModels.map((function(e){var o=e.artwork,r=e.name,c=e.id,d=e.model_ver_no,h=void 0===d?"":d,m=o?null==o?void 0:o.id:"";return{workId:t!==m&&n===c?t:m,name:r,id:c,art_model_ver_no:h||l,banner:{url:e.cover||""},version_name:(null==e?void 0:e.model_ver_name)||"",base_model_type:(null==e?void 0:e.base_model)||"",base_model:(null==e?void 0:e.base_model)||"",modelTags:Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[]}}));return[].concat(Object(R.a)(this.extraModelList),Object(R.a)(r))},modelInfo:function(){var e,t;return{art_model_no:this.value.art_model_no,art_model_ver_no:this.value.art_model_ver_no,name:this.value.modelName,is_agency_fee:this.value.is_agency_fee||this.value.agency_fee>0,agency_fee:this.value.agency_fee,banner:{url:this.value.model_cover||""},version_name:this.value.art_model_ver_no_name||"",base_model_type:this.value.base_model_type||"",base_model:this.value.base_model_type||"",modelTags:Array.isArray(null===(e=this.value)||void 0===e?void 0:e.modelTags)?null===(t=this.value)||void 0===t?void 0:t.modelTags:[],id:this.value.art_model_no,version_no:this.value.art_model_ver_no}}}),methods:{handleChangeModelVersion:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log(n);var o=JSON.parse(JSON.stringify(this.value));o.art_model_ver_no=null==n?void 0:n.model_ver_id,o.model_cover=(null==n||null===(e=n.sample)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.url)||"",o.art_model_ver_no_name=(null==n?void 0:n.version_no)||(null==n?void 0:n.model_ver_id),null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig(o)},openStyleModal:function(){this.selectIds=[{id:this.value.art_model_no,art_model_ver_no_name:this.value.art_model_ver_no_name,model_cover:this.value.model_cover}],"Checkpoint"===this.selectModelType?this.$EventBus.$emit("openCombinedSelectDialog"):this.$refs.easyStyleModal.openModal(this.selectModelType)},updateModelPresetParams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},source=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return console.log("更新预设模型的预设参数",source),e.cfg_scale=source.cfg_scale||7,e.clip_skip=source.clip_skip||1,e.negative_prompt=source.negative_prompt||"",e.prompt=(null==source?void 0:source.positive_prompt)||(null==source?void 0:source.prompt)||"",e.sampler_name=source.sampler_name||"DPM++ 2M Karras",e.vae=source.vae||"vae-ft-mse-840000-ema-pruned",e.steps=source.steps||20,e.lcm_mode="LCM"===e.sampler_name?1:0,e},resetModelBaseParams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return console.log("resetModelBaseParams--",t),"FLUX"===t?(e.cfg_scale=6,e.steps=30,e.clip_skip=1,e.sampler_name="dpmpp_2m_sde_gpu",e.denoising_strength=.5):(e.cfg_scale=7,e.clip_skip=1,e.sampler_name="DPM++ 2M Karras",e.vae="SDXL"===t?"None":"vae-ft-mse-840000-ema-pruned",e.steps=t.includes("SD 3.5")?25:20),e.lcm_mode="LCM"===(null==e?void 0:e.sampler_name)?1:0,e},handleSelectModel:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m,v,f,_,y,w,C,k,S,x,I,O,T,$,L,P,M,j,D,N,E,R;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return f=e.length>0&&void 0!==e[0]?e[0]:{},_=e.length>2&&void 0!==e[2]?e[2]:"",y=e.length>3&&void 0!==e[3]&&e[3],console.log("handleSelectModel",f),n.next=7,t.getModelInfo(f);case 7:if(w=n.sent,t.modelsList.some((function(e){return e.id===w.id}))||(t.extraModelList=[w]),C=[],Array.isArray(null==w?void 0:w.modelTags)&&null!=w&&null!==(o=w.modelTags)&&void 0!==o&&o.length&&(C=null==w?void 0:w.modelTags),Array.isArray(null==w?void 0:w.tags)&&null!=w&&null!==(l=w.tags)&&void 0!==l&&l.length&&(C=null==w?void 0:w.tags),k={art_work_no:w.sample_ids?w.sample_ids[0]:w.workId,modelName:w.name,art_model_no:w.id,art_model_ver_no:f.art_model_ver_no||f.model_ver_no||"",agency_fee:(null==f?void 0:f.agency_fee)||0,model_cover:(null==w||null===(r=w.banner)||void 0===r?void 0:r.url)||(null==f||null===(c=f.banner)||void 0===c?void 0:c.url)||"",art_model_ver_no_name:w.version_name||f.version_name,base_model_type:w.base_model,modelTags:C},S=!1,!t.checkShowIpMainTips(k)){n.next=19;break}return n.next=19,null===(x=t.$refs)||void 0===x||null===(x=x.customConfirmModal)||void 0===x?void 0:x.show({subTitle:"newGenerate65"}).then((function(e){k.ipList=[],S=!1})).catch((function(e){S=!0}));case 19:if(!S){n.next=21;break}return n.abrupt("return");case 21:if("preset"===_&&y&&(k=t.updateModelPresetParams(k,f),t.$EventBus.$emit("resetInputPackUpStatus")),I=null===(d=t.easyTop)||void 0===d?void 0:d.getCurrentModelType(w.base_model),O=w.id===(null==t||null===(h=t.easyTop)||void 0===h?void 0:h.fluxModelId)||"SA"===I,T=(null==t||null===(m=t.easyTop)||void 0===m?void 0:m.isSd35Model)||xe.B.sd35.includes(f.base_model)||(f.base_model||"").includes("SD 3.5")||!1,$="FLUX"===I,L="SDXL"===I,P="SD"===I,M=null===(v=t.easyTop)||void 0===v?void 0:v.getCurrentModelType(t.value.base_model_type),"preset"!==_&&M!==I&&t.resetModelBaseParams(k,I),!(O||$||T)){n.next=44;break}if(D=(D=JSON.parse(JSON.stringify(t.value.controlnet_units))).map((function(e){return e.type})),null!==(j=D)&&void 0!==j&&j.length){n.next=41;break}return t.$refs.easyStyleModal.handleClose(),k.controlnet_units=[],k.enableNegativePrompts=!1,k.negative_prompt="",[3,"3"].includes(null==t||null===(N=t.value)||void 0===N?void 0:N.speed_type)&&(null==t||null===(E=t.easyTop)||void 0===E||E.updateSpeedType(2)),t.changeConfig(k),n.abrupt("return");case 41:return t.$logEvent("log_actions",{operation:"model_incompatibility_popup_show",behavior_info:"on_new_create_flow_page",behavior_info_sub:D||[]}),t.$refs.confirmModal.show().then((function(){var e,n;(t.$refs.easyStyleModal.handleClose(),k.controlnet_units=[],k.enableNegativePrompts=!1,k.negative_prompt="",[3,"3"].includes(null==t||null===(e=t.value)||void 0===e?void 0:e.speed_type))&&(null==t||null===(n=t.easyTop)||void 0===n||n.updateSpeedType(2));t.changeConfig(k)})),n.abrupt("return");case 44:if(M===I||!L&&!P){n.next=53;break}if((R=t.checkNeedTips(w)).length){n.next=50;break}return t.$refs.easyStyleModal.handleClose(),t.changeConfig(k),n.abrupt("return");case 50:return t.$logEvent("log_actions",{operation:"model_incompatibility_popup_show",behavior_info:"on_new_create_flow_page",behavior_info_sub:R||[]}),t.$refs.confirmModal.show(R).then((function(){t.$refs.easyStyleModal.handleClose();var e=JSON.parse(JSON.stringify(t.value));e.controlnet_units=(e.controlnet_units||[]).filter((function(e){return!R.includes(null==e?void 0:e.type)})),k.controlnet_units=e.controlnet_units,t.changeConfig(k)})),n.abrupt("return");case 53:t.$refs.easyStyleModal.handleClose(),t.changeConfig(k);case 55:case"end":return n.stop()}}),n)})))()},handleSelectModel2:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m,v,f,_,y,w,C,k,S,x,I,O,T,$,L,P,M,j,D,N,E,R,A,B,U,F,z;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return f=e.model,_=void 0===f?{}:f,y=e.model_type,w=void 0===y?"":y,C=e.isPreset,k=void 0===C?"":C,S=e.usePreset,x=void 0!==S&&S,console.log("选择模型-model",_),console.log("选择模型-model_type",w),console.log("选择模型-isPreset",k),console.log("选择模型-usePreset",x),n.next=7,t.getModelInfo(_,"preset"===k);case 7:if(I=n.sent,console.log("_model",I,"preset"===k),t.modelsList.some((function(e){return e.id===I.id}))||(t.extraModelList=[I]),O=[],Array.isArray(null==I?void 0:I.modelTags)&&null!=I&&null!==(o=I.modelTags)&&void 0!==o&&o.length&&(O=null==I?void 0:I.modelTags),Array.isArray(null==I?void 0:I.tags)&&null!=I&&null!==(l=I.tags)&&void 0!==l&&l.length&&(O=null==I?void 0:I.tags),T={art_work_no:I.sample_ids?I.sample_ids[0]:I.workId,modelName:I.name,art_model_no:I.id,art_model_ver_no:_.art_model_ver_no||_.model_ver_no||"",agency_fee:(null==_?void 0:_.agency_fee)||0,model_cover:(null==I||null===(r=I.banner)||void 0===r?void 0:r.url)||(null==_||null===(c=_.banner)||void 0===c?void 0:c.url)||"",art_model_ver_no_name:I.version_name||_.version_name,base_model_type:I.base_model||_.base_model||"",modelTags:O},$=!1,!t.checkShowIpMainTips(T)){n.next=20;break}return n.next=20,null===(L=t.$refs)||void 0===L||null===(L=L.customConfirmModal)||void 0===L?void 0:L.show({subTitle:"newGenerate65"}).then((function(e){T.ipList=[],$=!1})).catch((function(e){$=!0}));case 20:if(!$){n.next=22;break}return n.abrupt("return");case 22:if("preset"===k&&x&&(T=t.updateModelPresetParams(T,I),t.$EventBus.$emit("resetInputPackUpStatus")),P=null===(d=t.easyTop)||void 0===d?void 0:d.getCurrentModelType(I.base_model),M=I.id===(null==t||null===(h=t.easyTop)||void 0===h?void 0:h.fluxModelId)||"SA"===P,j=(null==t||null===(m=t.easyTop)||void 0===m?void 0:m.isSd35Model)||xe.B.sd35.includes(_.base_model)||(_.base_model||"").includes("SD 3.5")||!1,D="FLUX"===P,N="SDXL"===P,E="SD"===P,R=null===(v=t.easyTop)||void 0===v?void 0:v.getCurrentModelType(t.value.base_model_type),"preset"!==k&&R!==P&&t.resetModelBaseParams(T,P),!(M||D||j)){n.next=45;break}if(B=(B=JSON.parse(JSON.stringify(t.value.controlnet_units))).map((function(e){return e.type})),null!==(A=B)&&void 0!==A&&A.length){n.next=42;break}return t.$refs.easyStyleModal.handleClose(),T.controlnet_units=[],T.enableNegativePrompts=!1,T.negative_prompt="",[3,"3"].includes(null==t||null===(U=t.value)||void 0===U?void 0:U.speed_type)&&(null==t||null===(F=t.easyTop)||void 0===F||F.updateSpeedType(2)),t.changeConfig(T),n.abrupt("return");case 42:return t.$logEvent("log_actions",{operation:"model_incompatibility_popup_show",behavior_info:"on_new_create_flow_page",behavior_info_sub:B||[]}),t.$refs.confirmModal.show(B).then((function(){var e,n;(t.$refs.easyStyleModal.handleClose(),T.controlnet_units=[],T.enableNegativePrompts=!1,T.negative_prompt="",[3,"3"].includes(null==t||null===(e=t.value)||void 0===e?void 0:e.speed_type))&&(null==t||null===(n=t.easyTop)||void 0===n||n.updateSpeedType(2));t.changeConfig(T)})),n.abrupt("return");case 45:if(R===P||!N&&!E){n.next=54;break}if((z=t.checkNeedTips(I)).length){n.next=51;break}return t.$refs.easyStyleModal.handleClose(),t.changeConfig(T),n.abrupt("return");case 51:return t.$logEvent("log_actions",{operation:"model_incompatibility_popup_show",behavior_info:"on_new_create_flow_page",behavior_info_sub:z||[]}),t.$refs.confirmModal.show(z).then((function(){t.$refs.easyStyleModal.handleClose();var e=JSON.parse(JSON.stringify(t.value));e.controlnet_units=(e.controlnet_units||[]).filter((function(e){return!z.includes(null==e?void 0:e.type)})),T.controlnet_units=e.controlnet_units,t.changeConfig(T)})),n.abrupt("return");case 54:t.$refs.easyStyleModal.handleClose(),t.changeConfig(T);case 56:case"end":return n.stop()}}),n)})))()},checkNeedTips:function(e){var t,n=this,o="SDXL"===(null===(t=this.easyTop)||void 0===t?void 0:t.getCurrentModelType(e.base_model)),l=JSON.parse(JSON.stringify(this.value.controlnet_units));l=l.map((function(e){return e.type}));var r=[],c=this.v2_sd_xl_ctr_units.map((function(e){return null==e?void 0:e.type})),d=this.v2_ctr_units.map((function(e){return null==e?void 0:e.type}));return r=(o?c:d).filter((function(e){return!n.hideModel.includes(e)&&l.includes(e)})),l.filter((function(e){return!r.includes(e)}))},checkShowIpMainTips:function(e){var t,n,o,l,r=(null==this||null===(t=this.easyTop)||void 0===t||null===(t=t.config)||void 0===t||null===(t=t.textToImage)||void 0===t?void 0:t.art_model_no)===(null==this||null===(n=this.easyTop)||void 0===n?void 0:n.fluxModelId),c=null==this||null===(o=this.easyTop)||void 0===o?void 0:o.hasIpMaintain,d=(null==e?void 0:e.art_model_no)!==(null==this||null===(l=this.easyTop)||void 0===l?void 0:l.fluxModelId);return r&&c&&d},getModelInfo:function(e){var t=arguments,n=this;return Object(E.a)(regeneratorRuntime.mark((function o(){var l,r,c,d,h,m,v,f,_,y,w,meta,C,k;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(l=t.length>1&&void 0!==t[1]&&t[1],!("object"===Object(Ye.a)(e))){o.next=30;break}if(!(null!=e&&e.sample_ids||2===(null==e?void 0:e.publish_status))){o.next=7;break}return o.abrupt("return",e);case 7:if(1!==(null==e?void 0:e.publish_status)||null!=e&&e.sample_ids||l){o.next=9;break}return o.abrupt("return",e);case 9:return r={art_model_ver_no:e.model_ver_no,task_flow_version:"v2"},l&&(r.source=6),o.next=13,Object(A.o)(r);case 13:if(c=o.sent,d=c.data,m=(h=void 0===d?{}:d).art_model,v=m.id,f=m.name,_=m.version_name,y=h.art_work_no,w=h.meta,meta=void 0===w?{}:w,C=h.local_prompt,k=void 0===C?"":C,!l||!meta){o.next=29;break}return o.abrupt("return",xn(xn({id:v,name:f,version_name:_,workId:y,art_model_ver_no:e.model_ver_no,base_model:e.base_model||"",tags:Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[]},meta),{},{prompt:k||meta.prompt||""}));case 29:return o.abrupt("return",{id:v,name:f,version_name:_,workId:y,art_model_ver_no:e.model_ver_no,base_model:e.base_model||"",tags:Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[]});case 30:return o.abrupt("return",n.modelsList.find((function(t){return t.id===e})));case 31:case"end":return o.stop()}}),o)})))()},changeConfig:function(e,t){var n,o=JSON.parse(JSON.stringify(this.value));t&&(o[t]=e),o=xn(xn({},o),e),null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)}}},On=In,Tn=(n(3052),Object(y.a)(On,(function(){var e,t,n,o,l=this,r=l._self._c;return r("div",{staticClass:"c-easy-model-panel",style:{backgroundImage:"url(".concat(null===(e=l.modelInfo)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.url,")")},on:{click:function(e){return e.stopPropagation(),l.openStyleModal.apply(null,arguments)}}},[r("div",{staticClass:"model-panel-card"},[r("div",{staticClass:"model-panel-card-left"},[r("div",{staticClass:"model-panel-card-left-box"},[r("span",{staticClass:"model-panel-card-left-tag"},[l._v(l._s(l.$t("Model")))])]),l._v(" "),r("span",{staticClass:"model-panel-card-left-text"},[l._v(l._s(null===(t=l.modelInfo)||void 0===t?void 0:t.name))]),l._v(" "),r("change-ver-new",{directives:[{name:"show",rawName:"v-show",value:null===(n=l.modelInfo)||void 0===n?void 0:n.art_model_ver_no,expression:"modelInfo?.art_model_ver_no"}],attrs:{from:"styleModal",item:l.modelInfo,base_models:[null===(o=l.modelInfo)||void 0===o?void 0:o.base_model]},on:{selectItem:l.handleChangeModelVersion}})],1),l._v(" "),l._m(0)]),l._v(" "),r("easy-style-modal",{ref:"easyStyleModal",attrs:{"model-type":l.selectModelType,inTask:!0,"is-studio-mode":!0,"select-list":l.selectIds},on:{selectModel:l.handleSelectModel}}),l._v(" "),r("select-model-confirm-modal",{ref:"confirmModal"}),l._v(" "),r("common-confirm-modal",{ref:"customConfirmModal"})],1)}),[function(){var e=this._self._c;return e("div",{staticClass:"model-panel-card-right"},[e("span",{staticClass:"el-icon-caret-bottom"})])}],!1,null,"fc5de54a",null)),$n=Tn.exports,Ln=n(116),Pn={name:"AdditionalPanelCardItem",inject:["easyTop"],components:{SliderItem:Ln.a,changeVerNew:kn.a},props:{modelInfo:{type:Object,default:function(){return{}}},type:{type:String,default:""},showWarning:{type:Boolean,default:!0}},computed:{checkStudioLoraType:function(){var e,t=this.modelInfo.base_model,n=null===(e=this.easyTop)||void 0===e||null===(e=e.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.base_model_type,o=["SD 3"],l=["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony"],r=["SD 1.5","SD 2.0","SD 1.4","SD 2.1 768","SD 2.1","SD 2.0 768","SD 1.5 LCM"].concat(Object(R.a)(xe.B.other)),c=(null===xe.B||void 0===xe.B?void 0:xe.B.sd35)||[],d=(null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[],h=l.includes(n)||(n||"").includes("SDXL"),m=r.includes(n),v=o.includes(n),f=((null===xe.B||void 0===xe.B?void 0:xe.B.flux)||[]).includes(n),_=d.includes(n),y=c.includes(n),w=l.includes(t)||(t||"").includes("SDXL"),C=r.includes(t),k=o.includes(t),S=((null===xe.B||void 0===xe.B?void 0:xe.B.flux)||[]).includes(t),x=d.includes(t),I=c.includes(t)&&n===t;return h&&!w||m&&!C||v&&!k||f&&!S||y&&!I||_&&!x},getTriggerWords:function(){var e;return((null===(e=this.modelInfo)||void 0===e?void 0:e.trained_words)||[]).join(",")}},data:function(){return{}},methods:{handleUpdateVersion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log(e,"6666"),this.$emit("updateVersion",e)},handleOpenPopup:function(){try{var e;null===(e=this.$refs.versionPanelSelect)||void 0===e||e.openPopup()}catch(e){}},handleCopyAll:function(){var content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(k.d)(content),this.$message.success(this.$t("CopySuccess"))},changeConfig:function(e,t){this.$emit("changeWeight",e)},handleDelete:function(){this.$emit("deleteItem",this.modelInfo)},changeUrl:function(e){return Object(k.x)(e,"high")},viewModel:function(){var e;if(null!==(e=this.modelInfo)&&void 0!==e&&e.id){var t=this.localePath("/models/detail/".concat(this.modelInfo.id));window.open(t,"_blank")}}}},Mn=Pn,jn=(n(3053),Object(y.a)(Mn,(function(){var e,t,n,o,l,r,c,d=this,h=d._self._c;return h("div",{staticClass:"c-additional-panel-card-item"},[h("div",{staticClass:"card-item-close-btn",on:{click:function(e){return e.stopPropagation(),d.handleDelete.apply(null,arguments)}}},[h("i",{staticClass:"el-icon-close"})]),d._v(" "),h("div",{staticClass:"additional-panel-card-item-cover",on:{click:function(e){return e.stopPropagation(),d.viewModel()}}},[null!==(e=d.modelInfo)&&void 0!==e&&null!==(e=e.banner)&&void 0!==e&&e.url?h("el-image",{attrs:{src:d.modelInfo.banner&&d.changeUrl(d.modelInfo.banner.url)}},[h("template",{slot:"placeholder"},[h("i",{staticClass:"el-icon-loading image-loading"})]),d._v(" "),h("template",{slot:"error"},[h("img",{staticClass:"select-model-image",attrs:{src:d.modelInfo&&d.modelInfo.banner?d.modelInfo.banner.url:"",alt:""}})])],2):h("p",{staticClass:"empty-img"},[d._v(d._s(d.$t("EmptyBannerText")))]),d._v(" "),h("div",{staticClass:"version-panel",on:{click:function(e){return e.stopPropagation(),d.handleOpenPopup.apply(null,arguments)}}},[h("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:null===(t=d.modelInfo)||void 0===t?void 0:t.version_name,placement:"top"}},[h("div",{staticClass:"version-panel-text"},[d._v(d._s(null===(n=d.modelInfo)||void 0===n?void 0:n.version_name))])]),d._v(" "),h("div",{staticClass:"version-panel-icon el-icon-caret-bottom"}),d._v(" "),h("change-ver-new",{directives:[{name:"show",rawName:"v-show",value:null===(o=d.modelInfo)||void 0===o?void 0:o.version_name,expression:"modelInfo?.version_name"}],ref:"versionPanelSelect",staticClass:"version-panel-select",staticStyle:{opacity:"0 !important"},attrs:{from:"styleModal",item:d.modelInfo,base_models:[null===(l=d.modelInfo)||void 0===l?void 0:l.base_model]},on:{selectItem:d.handleUpdateVersion}})],1),d._v(" "),d.showWarning?h("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"embedding"===d.type?d.$t("newGenerate63"):d.$t("studio25"),placement:"top-start"}},[h("div",{directives:[{name:"show",rawName:"v-show",value:d.checkStudioLoraType,expression:"checkStudioLoraType"}],staticClass:"lora-type-not-match"},[h("span",{staticClass:"iconfont icon-warn"})])]):d._e()],1),d._v(" "),h("div",{staticClass:"additional-panel-card-item-content"},[h("div",{staticClass:"card-item-content-title",attrs:{title:(null===(r=d.modelInfo)||void 0===r?void 0:r.name)||""},on:{click:function(e){return e.stopPropagation(),d.viewModel()}}},[d._v(d._s(null===(c=d.modelInfo)||void 0===c?void 0:c.name))]),d._v(" "),h("slider-item",{directives:[{name:"show",rawName:"v-show",value:"embedding"!==d.type,expression:"type !== 'embedding'"}],attrs:{value:d.modelInfo.weight,min:-1,max:2,step:.05,hideSlider:"embedding"===d.type,label:"embedding"===d.type?d.$t("embedding3"):"Strength"},on:{change:function(e){return d.changeConfig(e,"weight")}}}),d._v(" "),"embedding"===d.type?h("div",{staticClass:"card-item-content-sub-title"},[h("div",{staticClass:"trigger-word-item",attrs:{title:d.getTriggerWords}},[d._v(d._s(d.getTriggerWords))]),d._v(" "),h("span",{directives:[{name:"show",rawName:"v-show",value:d.getTriggerWords,expression:"getTriggerWords"}],staticClass:"trigger-word-item-copy iconfont icon-codeCopy1",on:{click:function(e){return d.handleCopyAll(d.getTriggerWords)}}})]):d._e()],1)])}),[],!1,null,"24849644",null)),Dn=jn.exports;function Nn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function En(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nn(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Rn={name:"EasyAdditionalPanel",props:["value"],inject:["easyTop"],components:{AdditionalPanelCardItem:Dn,EasyStyleModal:_n},data:function(){return{isCollapse:!1,selectIds:[],modelDetailTrainedWords:[]}},computed:En(En(En({},Object(S.c)("payment",["paymentInfo"])),Object(S.c)("user",["isCompanyAccount","isLoggedIn"])),{},{modelInfo:function(){var e,t;return{art_model_no:this.value.art_model_no,art_model_ver_no:this.value.art_model_ver_no,name:this.value.modelName,is_agency_fee:this.value.is_agency_fee||this.value.agency_fee>0,agency_fee:this.value.agency_fee,banner:{url:this.value.model_cover||""},version_name:this.value.art_model_ver_no_name||"",base_model_type:this.value.base_model_type||"",base_model:this.value.base_model_type||"",modelTags:Array.isArray(null===(e=this.value)||void 0===e?void 0:e.modelTags)?null===(t=this.value)||void 0===t?void 0:t.modelTags:[]}},showAdd:function(){var e,t;return!(null!==(e=this.value)&&void 0!==e&&null!==(e=e.lora_models)&&void 0!==e&&e.length||null!==(t=this.value)&&void 0!==t&&null!==(t=t.embeddings)&&void 0!==t&&t.length)},isVipFun:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount}}),methods:{handleUpdateLoraVersion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var n=JSON.parse(JSON.stringify(this.value)).lora_models;(n||[]).forEach((function(n){var o,l;(null==n?void 0:n.id)===(null==t?void 0:t.id)&&(n.version_name=(null==e?void 0:e.version_no)||(null==e?void 0:e.model_ver_id),n.model_ver_no=null==e?void 0:e.model_ver_id,null!=e&&null!==(o=e.sample)&&void 0!==o&&null!==(o=o.banner)&&void 0!==o&&o.url&&(n.banner.url=(null==e||null===(l=e.sample)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.url)||""))})),this.changeConfig({lora_models:n})}catch(e){}},handleUpdateEmbeddingVersion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var n=JSON.parse(JSON.stringify(this.value)).embeddings;(n||[]).forEach((function(n){if((null==n?void 0:n.id)===(null==t?void 0:t.id)){var o,l;if(n.version_name=(null==e?void 0:e.version_no)||(null==e?void 0:e.model_ver_id),n.model_ver_no=null==e?void 0:e.model_ver_id,null!=e&&null!==(o=e.sample)&&void 0!==o&&null!==(o=o.banner)&&void 0!==o&&o.url)n.banner.url=(null==e||null===(l=e.sample)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.url)||"";n.trained_words=Array.isArray(null==e?void 0:e.trained_words)?null==e?void 0:e.trained_words:[]}})),this.changeConfig({embeddings:n})}catch(e){}},toggleFoldStatus:function(){this.isCollapse=!this.isCollapse},openSelectModal:function(){this.selectIds=[].concat(Object(R.a)(this.value.lora_models),Object(R.a)(this.value.embeddings)),this.$refs.easyStyleModal.openModal("LORA")},handleSelectModel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e||{}).type,n=void 0===t?"":t;"TextualInversion"===n&&this.selectEmbeddingHandle(e),"LORA"===n&&this.selectLoraHandle(e),this.$refs.easyStyleModal.handleClose()},selectEmbeddingHandle:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.value.embeddings,l=void 0===o?[]:o,r=En({model_id:e.id,weight:1},e),!((null==l?void 0:l.length)>=8)){n.next=5;break}return t.$message.warning(t.$t("embedding6",{num:8})),n.abrupt("return");case 5:if(-1===(c=l.findIndex((function(e){return e.id===r.id&&(null==e?void 0:e.model_ver_no)===(null==r?void 0:r.model_ver_no)})))){n.next=12;break}return n.next=9,t.getModelDetail(null==r?void 0:r.model_id,null==r?void 0:r.model_ver_no);case 9:l[c]=En(En({},r),{},{trained_words:Object(R.a)(t.modelDetailTrainedWords)}),n.next=15;break;case 12:return n.next=14,t.getModelDetail(null==r?void 0:r.model_id,null==r?void 0:r.model_ver_no);case 14:l.push(En(En({},r),{},{trained_words:Object(R.a)(t.modelDetailTrainedWords)}));case 15:t.changeConfig({embeddings:l});case 16:case"end":return n.stop()}}),n)})))()},getModelDetail:function(){var e=this,t={id:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",version_id:arguments.length>1&&void 0!==arguments[1]?arguments[1]:""};return Object(Be.F)(t).then((function(t){var n;if(!t||1e4===(null==t||null===(n=t.status)||void 0===n?void 0:n.code)){var o=(t&&null!=t&&t.data?null==t?void 0:t.data:{}).trained_words,l=void 0===o?[]:o;e.modelDetailTrainedWords=Array.isArray(l)?l:[]}})).finally((function(){}))},selectLoraHandle:function(e){var t=this.value.lora_models,n=En({model_id:e.id,weight:1},e);if((null==t?void 0:t.length)>=5)this.$message.warning(this.$t("newGenerate50"));else if(!this.isLoggedIn&&(null==t?void 0:t.length)>=3)this.$EventBus.$emit("openLoginDialog");else if(!this.isVipFun&&(null==t?void 0:t.length)>=3)this.$EventBus.$emit("showBreakDialog","LoRALimit5TipWeb","basic");else{var o=t.findIndex((function(e){return e.id===n.id}));-1!==o?t[o]=n:t.push(n),this.changeConfig({lora_models:t})}},changeWeight:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=this.value,l=o.lora_models,r=o.embeddings,c=void 0===r?[]:r,d=l.findIndex((function(e){return(null==t?void 0:t.id)===e.id}));if("Embedding"===n&&(d=c.findIndex((function(e){return(null==t?void 0:t.id)===e.id}))),"LORA"===n&&-1!==d)return l[d].weight=e,void this.changeConfig({lora_models:l});"Embedding"===n&&-1!==d&&(c[d].weight=e,this.changeConfig({embeddings:c}))},deleteModel:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=JSON.parse(JSON.stringify(this.value));if("LORA"===t){var o=n.lora_models.findIndex((function(t){return(null==e?void 0:e.id)===t.id}));return-1!==o&&n.lora_models.splice(o,1),void(-1!==o&&this.changeConfig({lora_models:n.lora_models}))}if("Embedding"===t){var l=n.embeddings.findIndex((function(t){return(null==e?void 0:e.id)===t.id&&(null==e?void 0:e.model_ver_no)===(null==t?void 0:t.model_ver_no)}));-1!==l&&n.embeddings.splice(l,1),-1!==l&&this.changeConfig({embeddings:n.embeddings})}},changeConfig:function(e,t){var n,o=JSON.parse(JSON.stringify(this.value));t&&(o[t]=e),o=En(En({},o),e),null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)}}},An=Rn,Bn=(n(3054),Object(y.a)(An,(function(){var e,t,n,o,l,r,c,d,h,m=this,v=m._self._c;return v("div",{staticClass:"c-easy-additional-panel"},[v("div",{staticClass:"additional-panel-title",on:{click:function(e){e.stopPropagation(),m.showAdd?m.openSelectModal():m.toggleFoldStatus()}}},[v("span",{staticClass:"additional-panel-title-text"},[m._v(m._s(m.$t("newGenerate48")))]),m._v(" "),v("span",{staticClass:"additional-panel-title-icon",class:m.showAdd?"el-icon-circle-plus-outline":(m.isCollapse,"el-icon-caret-bottom"),on:{click:function(e){e.stopPropagation(),m.showAdd?m.openSelectModal():m.toggleFoldStatus()}}})]),m._v(" "),v("div",{directives:[{name:"show",rawName:"v-show",value:!m.isCollapse&&(null===(e=m.value)||void 0===e||null===(e=e.lora_models)||void 0===e?void 0:e.length),expression:"!isCollapse && value?.lora_models?.length"}],staticClass:"lora-list"},[v("div",{staticClass:"lora-list-label"},[m._v(m._s(m.$t("LoRA")))]),m._v(" "),v("div",{staticClass:"lora-list-content"},[m._l((null===(t=m.value)||void 0===t?void 0:t.lora_models)||[],(function(e,t){return[v("additional-panel-card-item",{key:"lora_".concat(t),attrs:{modelInfo:e},on:{deleteItem:function(t){return m.deleteModel(e,"LORA")},updateVersion:function(t){return m.handleUpdateLoraVersion(t,e)},changeWeight:function(t){return m.changeWeight(t,e,"LORA")}}})]}))],2)]),m._v(" "),v("div",{directives:[{name:"show",rawName:"v-show",value:!m.isCollapse&&(null===(n=m.value)||void 0===n||null===(n=n.embeddings)||void 0===n?void 0:n.length),expression:"!isCollapse && value?.embeddings?.length"}],staticClass:"lora-list"},[v("div",{staticClass:"lora-list-label"},[m._v(m._s(m.$t("embedding1")))]),m._v(" "),v("div",{staticClass:"lora-list-content"},[m._l((null===(o=m.value)||void 0===o?void 0:o.embeddings)||[],(function(e,t){return[v("additional-panel-card-item",{key:"embedding_".concat(t),attrs:{modelInfo:e,type:"embedding"},on:{deleteItem:function(t){return m.deleteModel(e,"Embedding")},updateVersion:function(t){return m.handleUpdateEmbeddingVersion(t,e)},changeWeight:function(t){return m.changeWeight(t,e,"Embedding")}}})]}))],2)]),m._v(" "),v("div",{directives:[{name:"show",rawName:"v-show",value:!m.isCollapse&&((null===(l=m.value)||void 0===l||null===(l=l.embeddings)||void 0===l?void 0:l.length)||(null===(r=m.value)||void 0===r||null===(r=r.lora_models)||void 0===r?void 0:r.length)),expression:"!isCollapse && (value?.embeddings?.length || value?.lora_models?.length)"}],staticClass:"tools-popup-view-more-btn",on:{click:function(e){return e.stopPropagation(),m.openSelectModal()}}},[v("span",{staticClass:"tools-popup-view-more-btn-text"},[m._v(m._s(m.$t("viewMore")))]),m._v(" "),v("span",{staticClass:"tools-popup-view-more-btn-icon el-icon-right"})]),m._v(" "),v("easy-style-modal",{ref:"easyStyleModal",attrs:{"model-type":"LORA",inTask:!0,isSD35:null===(c=m.easyTop)||void 0===c?void 0:c.isSd35Model,isSDXL:null===(d=m.easyTop)||void 0===d?void 0:d.isSDXLModel,"is-studio-mode":null===(h=m.easyTop)||void 0===h?void 0:h.isStudioFlux,studioModelInfo:m.modelInfo,"select-list":m.selectIds},on:{selectModel:m.handleSelectModel}})],1)}),[],!1,null,"f71c9610",null).exports),Un=n(716),Fn={name:"ImageSizeOptionsPopup",data:function(){return{visible:!1,imageOptions:Ue.a}},props:{currentImageSize:{type:[String,Number],default:""}},computed:{verticalList:function(){return this.imageOptions.filter((function(e){return"vertical"===(null==e?void 0:e.type)}))},horizontalList:function(){return this.imageOptions.filter((function(e){return"horizontal"===(null==e?void 0:e.type)})).reverse()}},methods:{handleClose:function(){this.visible=!1},handleClick:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$emit("applySize",e)}}},zn=Fn,Vn=(n(3055),Object(y.a)(zn,(function(){var e=this,t=e._self._c;return t("el-popover",{ref:"imageSizeOptionsPopup",attrs:{title:"",trigger:"click","popper-class":"image-size-options-popup","append-to-body":!0,"visible-arrow":!1,placement:"right-start"},scopedSlots:e._u([{key:"reference",fn:function(){return[e._t("default")]},proxy:!0}],null,!0),model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{staticClass:"image-size-options-popup-header"},[t("div",{staticClass:"image-size-options-popup-header-title"},[e._v(e._s(e.$t("newGenerate6")))]),e._v(" "),t("span",{staticClass:"modal-header-close",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[t("i",{staticClass:"el-icon-close"})])]),e._v(" "),t("div",{staticClass:"image-size-options-popup-content"},[t("div",{staticClass:"image-size-options-popup-content-top"},[t("div",{staticClass:"content-top-item"},[t("div",{staticClass:"iconfont icon-a-2_3"}),e._v(" "),t("div",{staticClass:"content-top-item-label"},[e._v(e._s(e.$t("newGenerate71")))])]),e._v(" "),t("div",{staticClass:"content-top-item"},[t("div",{staticClass:"iconfont icon-a-4_31"}),e._v(" "),t("div",{staticClass:"content-top-item-label"},[e._v(e._s(e.$t("newGenerate72")))])])]),e._v(" "),t("div",{staticClass:"image-size-options-popup-content-main"},[t("div",{staticClass:"main-content-box"},e._l(e.verticalList,(function(n){return t("span",{key:"v_".concat(null==n?void 0:n.code),staticClass:"main-content-box-item",class:[(null==n?void 0:n.code)===e.currentImageSize&&"active-item"],on:{click:function(t){return e.handleClick(n)}}},[e._v("\n            "+e._s(null==n?void 0:n.label)+"\n          ")])})),0),e._v(" "),t("div",{staticClass:"main-content-box"},e._l(e.horizontalList,(function(n){return t("span",{key:"h_".concat(null==n?void 0:n.code),staticClass:"main-content-box-item",class:[(null==n?void 0:n.code)===e.currentImageSize&&"active-item"],on:{click:function(t){return e.handleClick(n)}}},[e._v("\n          "+e._s(null==n?void 0:n.label)+"\n        ")])})),0)]),e._v(" "),t("div",{staticClass:"image-size-options-content-item",class:[2===e.currentImageSize&&"active-item"],on:{click:function(t){return e.handleClick({code:2})}}},[e._v("\n      1:1\n    ")]),e._v(" "),t("div",{staticClass:"image-size-options-content-item",class:[5===e.currentImageSize&&"active-item"],on:{click:function(t){return e.handleClick({code:5})}}},[e._v("\n      "+e._s(e.$t("newGenerate43"))+"\n    ")])])])}),[],!1,null,null,null).exports);function Wn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Hn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wn(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var qn={name:"EasyGenerateModePanel",props:["value"],inject:["easyTop"],components:{commonConfirmModal:un.a,ImageSizeOptionsPopup:Vn},data:function(){return{createSetting:1,imageSizeOptions:[{code:1,label:"2:3",icon:"icon-a-2_3",sd:{standard:{width:512,height:768}},sdxl:{standard:{width:768,height:1152}},flux:{standard:{width:688,height:1024},quality:{width:1024,height:1536}}},{code:2,label:"1:1",icon:"icon-a-1_11",sd:{standard:{width:768,height:768}},sdxl:{standard:{width:1024,height:1024}},flux:{standard:{width:1024,height:1024},quality:{width:1536,height:1536}}},{code:3,label:"9:16",icon:"icon-a-9_161",sd:{standard:{width:432,height:768}},sdxl:{standard:{width:810,height:1440}},flux:{standard:{width:592,height:1024},quality:{width:864,height:1536}}},{code:4,label:"4:3",icon:"icon-a-4_31",sd:{standard:{width:768,height:576}},sdxl:{standard:{width:1024,height:768}},flux:{standard:{width:1024,height:768},quality:{width:1536,height:1152}}},{code:5,label:"more",icon:"icon-icon-Custom",sd:{},sdxl:{},flux:{}}],imageSizeOptionsMore:Ue.a,currentImageSize:1,isLockSize:!1,lockSize:{width:1,height:1,aspectRatio:1},showAspectRatio:"1:1",debounceComputedAspectRatio:function(){},debounceCheckActiveSizeMode:function(){}}},created:function(){this.debounceComputedAspectRatio=Object(X.debounce)(this.getSizeAspectRatio,500),this.debounceCheckActiveSizeMode=Object(X.debounce)(this.checkAutoActiveSizeMode,500),this.$EventBus.$on("closeAllGeneratePopup",this.closeImageSizeOptionPopup)},beforeDestroy:function(){this.debounceComputedAspectRatio=null,this.debounceCheckActiveSizeMode=null,this.$EventBus.$off("closeAllGeneratePopup",this.closeImageSizeOptionPopup)},computed:Hn(Hn(Hn({},Object(S.c)("payment",["paymentInfo"])),Object(S.c)("user",["accountSettingsData","isCompanyAccount","isLoggedIn"])),{},{isShowFree:function(){var e,t,n;return!(null!==(e=this.easyTop)&&void 0!==e&&e.isStudioFlux||null!==(t=this.easyTop)&&void 0!==t&&t.isCommunityFlux||null!==(n=this.easyTop)&&void 0!==n&&n.isSd35Model)},UnlimitedQueueTip:function(){return this.isCompanyAccount?"ToBUnlimitedQueueTip":"UnlimitedQueueTip"},queueRenderList:function(){return[{code:1,i18nKey:"NormalQueue",tips:"",show:!this.isVipFun},{code:2,i18nKey:"SubsBottomTerms2",tips:"",isVip:!0,show:this.isVipFun},{code:3,i18nKey:"UnlimitedQueue",tips:this.UnlimitedQueueTip,isVip:!0,show:!0}].filter((function(e){return e.show}))},isOnlyVipLite:function(){var e,t;return!(null!==(e=this.paymentInfo)&&void 0!==e&&e.activeState)&&!this.isCompanyAccount&&(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)},canUseUnlimitedQueue:function(){var e;return null===(e=this.paymentInfo)||void 0===e?void 0:e.infiniteQueue},isVipFun:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},isStudioFlux:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isStudioFlux},isShowPromptMagic:function(){var e,t,n;return(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isStudioFlux)||(null==this||null===(t=this.easyTop)||void 0===t?void 0:t.isCommunityFlux)||(null==this||null===(n=this.getCurrentModelType)||void 0===n?void 0:n.includes("SD 3.5"))},isSDXLModel:function(){var e=this.value.base_model_type;return["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony","SDXL Hyper"].includes(e)||(e||"").includes("SDXL")},showAnimeStrong:function(){var e,t=null==this||null===(e=this.easyTop)||void 0===e?void 0:e.getStudioModelTagsType(this.value);return this.isSDXLModel&&"anime"===t},getCustomSizeOptions:function(){var e,t={min:128,max:1024},n={min:384,max:1024};return this.isStudioFlux||null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isCommunityFlux?n:"sd"===this.getCurrentModelType?t:["sdxl"].includes(this.getCurrentModelType)?{min:128,max:1536}:"SD 3.5"===this.getCurrentModelType?n:t},isCurrentImageNum:function(){return function(i){return this.value.n_iter===i}},getCurrentModelType:function(){var e=this.value.base_model_type||"",t=Object(Ue.c)(e);return this.isStudioFlux?"flux":t||"sd"}}),watch:{accountSettingsData:{handler:function(){var e;this.isLoggedIn?this.createSetting=null!==(e=this.accountSettingsData)&&void 0!==e&&e.is_auto_pub_community?1:2:this.createSetting=1},immediate:!0,deep:!0},isLoggedIn:{handler:function(e){!e&&(this.createSetting=1)},immediate:!0,deep:!0},"value.generate":{handler:function(e,t){(null==e?void 0:e.gen_mode)!==(null==t?void 0:t.gen_mode)&&this.checkNeedUpdateSize()},immediate:!0,deep:!0},"value.width":{handler:function(e){this.lockSize||(this.lockSize.width=e,this.lockSize.height=this.value.height),this.debounceComputedAspectRatio&&this.debounceComputedAspectRatio(),this.debounceCheckActiveSizeMode&&this.debounceCheckActiveSizeMode()},immediate:!0,deep:!0},"value.height":{handler:function(e){this.lockSize||(this.lockSize.height=e,this.lockSize.width=this.value.width),this.debounceComputedAspectRatio&&this.debounceComputedAspectRatio(),this.debounceCheckActiveSizeMode&&this.debounceCheckActiveSizeMode()},immediate:!0,deep:!0},"easyTop.currentModelType":{handler:function(e,t){try{e&&e!==t&&this.checkNeedUpdateSize()}catch(e){}},immediate:!0,deep:!0},"value.imageToImageList":{handler:function(e,t){null!=e&&e.length&&this.checkAutoActiveSizeMode()},immediate:!0,deep:!0},"value.art_model_no":{handler:function(e,t){e&&["",null,void 0].includes(t)&&this.checkNeedUpdateSize()},immediate:!0}},methods:Hn(Hn({},Object(S.b)("user",["getAccountInfo"])),{},{handleQueueSelectChange:function(e){var t;this.$logEvent("log_actions",{operation:"click_free_create",behavior_info:"on_new_create_flow_page",behavior_info_sub:3===e?"open":"close"}),3!==e||this.isLoggedIn?![3].includes(e)||3!==e||this.isVipFun?[3].includes(e)&&this.isStudioMode&&this.isCompanyAccount||([3].includes(e)&&this.isOnlyVipLite?this.$EventBus.$emit("showUpgradeDialog","UnlimitedQueueTipWeb","standard"):![3].includes(e)||this.canUseUnlimitedQueue?(localStorage.setItem("speed_type",e),null==this||null===(t=this.easyTop)||void 0===t||t.updateSpeedType(e)):this.$EventBus.$emit("showUpgradeDialog","UnlimitedQueueTipWeb","standard")):this.$EventBus.$emit("showBreakDialog","UnlimitedQueueTipWeb","standard"):this.$EventBus.$emit("openLoginDialog")},closeImageSizeOptionPopup:function(){try{var e;null===(e=this.$refs)||void 0===e||null===(e=e.ImageSizeOptionsPopup)||void 0===e||e.handleClose()}catch(e){}},resetData:function(){this.isLockSize=!1,this.lockSize={width:1,height:1,aspectRatio:1},this.showAspectRatio="1:1",this.currentImageSize=1,this.createSetting=1},getSizeAspectRatio:function(){var e=this.isLockSize?this.lockSize.width:this.value.width,t=this.isLockSize?this.lockSize.height:this.value.height,n=(Un.a||[]).find((function(n){return n.width===e&&n.height===t}));this.showAspectRatio=n?null==n?void 0:n.showAspectRatio:Object(Ue.b)(e,t)},changeLockStatus:function(){this.lockSize.width=this.value.width,this.lockSize.height=this.value.height,this.isLockSize=!this.isLockSize},checkAutoActiveSizeMode:function(){var e=this.value,t=e.width,n=e.height,o=(Un.a||[]).find((function(e){return e.width===t&&e.height===n}));this.currentImageSize=o?o.code:5},checkNeedUpdateSize:function(){var e=this;console.log("如何改变图片的尺寸---");var t=this.value,n=t.width,o=t.height,l={width:n,height:o},r=(Un.a||[]).find((function(e){return e.width===n&&e.height===o}));if(this.currentImageSize=r?r.code:5,5!==this.currentImageSize)this.imageSizeOptions.forEach((function(t){if((null==t?void 0:t.code)===e.currentImageSize){var n="SD 3.5"===e.getCurrentModelType?"flux":e.getCurrentModelType;["sd","sdxl"].includes(n)&&(l=t[n].standard),["flux"].includes(n)&&(l=t[n].standard)}})),this.updateImageSize(l);else{var c=this.convertStudioBaseSize(n,o,this.getCustomSizeOptions);null!=c&&c.isCustom&&(this.currentImageSize=5),this.updateImageSize({width:null==c?void 0:c.width,height:null==c?void 0:c.height})}},convertStudioBaseSize:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=(this.imageSizeOptions||[]).filter((function(e){return 5!==e.code})).map((function(e){return e.width=e.sd.standard.width,e.height=e.sd.standard.height,e})),l={},r=parseFloat((e/t).toFixed(2)),c=o.find((function(e){var t=parseFloat((e.width/e.height).toFixed(2));return r===t})),d=n;if(c){var h=this.getCurrentModelType;["sd","sdxl"].includes(h)&&(l=c[h].standard),["flux"].includes(h)&&(l=c[h].standard)}else{var m=Object(B.g)(e,t,d.max);l.width=m.width,l.height=m.height,l.isCustom=!0}return l},handleSwitchAnimeEnhance:function(e,t){var n,o,l,r=this;if((null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isShowAnimeEnhance)&&((null==this||null===(o=this.value)||void 0===o||null===(o=o.imageToImageList)||void 0===o?void 0:o.length)||(null===(l=this.value)||void 0===l||null===(l=l.controlnet_units)||void 0===l?void 0:l.length))&&1===e)try{var c;null===(c=this.$refs)||void 0===c||null===(c=c.commonConfirmModal)||void 0===c||c.show({subTitle:"newGenerate1"}).then((function(){r.clearAnimeEnhanceParams(e,t)}))}catch(e){}else this.changeConfig(e,t)},clearAnimeEnhanceParams:function(e,t){var n,o=JSON.parse(JSON.stringify(this.value));o.sampler_name=1===e?"dpmpp_2m_sde_gpu":"DPM++ 2M Karras",o.imageToImageList=[],o.controlnet_units=[],o.generate[t]=e,1===e&&(o.generate.gen_mode=0),null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)},changeConfig:function(e,t){var n,o;this.handleLogEvent(t,e);var l=JSON.parse(JSON.stringify(this.value));if("gen_mode"!==t||1!==e||this.isLoggedIn)if(this.isVipFun||"gen_mode"!==t||1!==e)if("gen_mode"===t&&1===e&&null!==(n=this.easyTop)&&void 0!==n&&n.isAnimeEnhanceEnable)this.$message.warning(this.$t("newGenerate56"));else if("n_iter"!==t||this.isLoggedIn||![3,4].includes(e)){t&&!["anime_enhance","prompt_magic_mode","gen_mode"].includes(t)?(l[t]=e,"n_iter"===t&&localStorage.setItem("imageNums",e)):(l.generate[t]=e,"anime_enhance"===t&&(l.sampler_name=1===e?"dpmpp_2m_sde_gpu":"DPM++ 2M Karras",1===e&&(l.generate.gen_mode=0))),null==this||null===(o=this.easyTop)||void 0===o||o.updateConfig(l)}else this.$EventBus.$emit("openLoginDialog");else this.$EventBus.$emit("showBreakDialog","newGenerate51","basic");else this.$EventBus.$emit("openLoginDialog")},handleLogEvent:function(e,t){var n="",o="";switch(e){case"gen_mode":n="click_generate_model",o=1===t?"quality":"standard";break;case"prompt_magic_mode":n="click_prompt_magic";o={0:"auto",1:"open",2:"close"}[t]||"";break;case"click_image_setting":n="click_image_setting",o=t;break;case"n_iter":n="click_image_numbers",o=t;break;case"createSetting":n="click_private_model",o=t}if(n){var l={operation:n,behavior_info:"on_new_create_flow_page"};l.behavior_info_sub=o,this.$logEvent("log_actions",l)}},customSizeChange:function(e,t){if(this.isLockSize){var n=this.calculateDimensions(t,e),o=this.getCustomSizeOptions.max,l=this.getCustomSizeOptions.min;[null==n?void 0:n.width,null==n?void 0:n.height].every((function(e){return e>=l&&e<=o}))&&this.updateImageSize({width:null==n?void 0:n.width,height:null==n?void 0:n.height})}else{var r,c=JSON.parse(JSON.stringify(this.value));c[t]=e,null===(r=this.easyTop)||void 0===r||r.updateConfig(c)}},calculateDimensions:function(e,t){var n,o,l=this.lockSize.width,r=this.lockSize.height,c=this.getCustomSizeOptions.max,d=this.getCustomSizeOptions.min;return"width"===e?o=(n=t)/l*r:n=(o=t)/r*l,n>c?o=(n=c)/l*r:n<d&&(o=(n=d)/l*r),o>c?n=(o=c)/r*l:o<d&&(n=(o=d)/r*l),{width:Math.round(n),height:Math.round(o)}},handleCreateSettingSelectChange:function(e){return this.handleLogEvent("createSetting",[2,"2"].includes(e)?"open":"colse"),console.log(this.isLoggedIn,"登录状态"),this.isLoggedIn?[2,"2"].includes(e)&&!this.paymentInfo.show_auto_pub_switch?(this.$EventBus.$emit("showBreakDialog","PrivateWorkTipWeb","basic"),void(this.createSetting=1)):void(this.isLoggedIn&&this.saveSettings(e)):(this.$EventBus.$emit("openLoginDialog"),void(this.createSetting=1))},saveSettings:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.loading=!0;var n={};n.auto_pub_community=t,n.mode=1,Object(Q.b)(n).then((function(n){var o=(n||{}).status.code;["10000",1e4].includes(void 0===o?"":o)&&(e.$message.success(e.$t("SaveSuccess")),e.createSetting=t,e.loading=!1,e.getAccountInfo())})).finally((function(){e.loading=!1}))},handleUpdateSize:function(){var e,t,n,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.currentImageSize=o.code;var l=Object(R.a)(this.imageSizeOptionsMore).find((function(e){return(null==e?void 0:e.code)===(null==o?void 0:o.code)}));if(5===(null==o?void 0:o.code)&&(l={code:5,label:"newGenerate43",icon:"icon-icon-Custom",sd:{},sdxl:{},flux:{}}),this.isLockSize=!1,this.handleLogEvent("click_image_setting",5===(null===(e=l)||void 0===e?void 0:e.code)?"custom":null===(t=l)||void 0===t?void 0:t.label),5!==(null===(n=l)||void 0===n?void 0:n.code)){var r="SD 3.5"===this.getCurrentModelType?"flux":this.getCurrentModelType;["sd","sdxl","flux"].includes(r)&&this.updateImageSize(l[r].standard)}},updateImageSize:function(e){var t,n=e.width,o=e.height,l=JSON.parse(JSON.stringify(this.value));n&&(l.width=n||(null==l?void 0:l.width),l.height=o||(null==l?void 0:l.height)),o&&(l.height=o||(null==l?void 0:l.height)),null===(t=this.easyTop)||void 0===t||t.updateConfig(l)}})},Gn=qn,Jn=(n(3056),Object(y.a)(Gn,(function(){var e,t,o,l,r,c,d,h,m=this,v=m._self._c;return v("div",{staticClass:"c-easy-generate-mode-panel"},[v("div",{staticClass:"generate-mode-panel-item"},[v("div",{staticClass:"panel-item-label"},[v("span",{staticClass:"generate-mode-panel-label-text"},[m._v(m._s(m.$t("newGenerate5")))]),m._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:m.$t("newGenerate47"),placement:"top-start"}},[v("i",{staticClass:"custom-tips el-icon-warning"})])],1),m._v(" "),v("div",{staticClass:"panel-item-content"},[v("div",{staticClass:"panel-item",class:[0===(null===(e=m.value)||void 0===e||null===(e=e.generate)||void 0===e?void 0:e.gen_mode)?"active-btn":""],on:{click:function(e){return e.stopPropagation(),m.changeConfig(0,"gen_mode")}}},[m._v(m._s(m.$t("newGenerate44")))]),m._v(" "),v("div",{staticClass:"panel-item",class:[1===(null===(t=m.value)||void 0===t||null===(t=t.generate)||void 0===t?void 0:t.gen_mode)?"active-btn":"",(null===(o=m.easyTop)||void 0===o?void 0:o.isAnimeEnhanceEnable)&&"panel-item-disable"],on:{click:function(e){return e.stopPropagation(),m.changeConfig(1,"gen_mode")}}},[m.isCompanyAccount?m._e():v("img",{staticClass:"vip-icon",attrs:{src:n(162),alt:"vip-icon"}}),m._v("\n        "+m._s(m.$t("newGenerate45"))+"\n      ")])])]),m._v(" "),m.isShowPromptMagic?v("div",{staticClass:"generate-mode-panel-item"},[v("div",{staticClass:"panel-item-label"},[v("span",{staticClass:"generate-mode-panel-label-text"},[m._v(m._s(m.$t("studio28")))]),m._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:m.$t("studio45"),placement:"top-start"}},[v("i",{staticClass:"custom-tips el-icon-warning"})])],1),m._v(" "),v("div",{staticClass:"panel-item-content panel-item-content-2"},[v("div",{staticClass:"panel-item",class:[2===(null===(l=m.value)||void 0===l||null===(l=l.generate)||void 0===l?void 0:l.prompt_magic_mode)?"active-btn":""],on:{click:function(e){return e.stopPropagation(),m.changeConfig(2,"prompt_magic_mode")}}},[m._v("\n        "+m._s(m.$t("studio41"))+"\n      ")]),m._v(" "),v("div",{staticClass:"panel-item",class:[1===(null===(r=m.value)||void 0===r||null===(r=r.generate)||void 0===r?void 0:r.prompt_magic_mode)?"active-btn":""],on:{click:function(e){return e.stopPropagation(),m.changeConfig(1,"prompt_magic_mode")}}},[m._v("\n        "+m._s(m.$t("newGenerate18"))+"\n      ")]),m._v(" "),v("div",{staticClass:"panel-item",class:[0===(null===(c=m.value)||void 0===c||null===(c=c.generate)||void 0===c?void 0:c.prompt_magic_mode)?"active-btn":""],on:{click:function(e){return e.stopPropagation(),m.changeConfig(0,"prompt_magic_mode")}}},[m._v("\n        "+m._s(m.$t("newGenerate17"))+"\n      ")])])]):m._e(),m._v(" "),v("div",{staticClass:"generate-mode-panel-item"},[v("div",{staticClass:"generate-mode-panel-item-title"},[v("div",{staticClass:"panel-item-label"},[v("span",{staticClass:"generate-mode-panel-label-text"},[m._v(m._s(m.$t("newGenerate6")))])]),m._v(" "),v("div",{staticClass:"current-size"},[m._v(m._s(m.value.width)+" x "+m._s(m.value.height))])]),m._v(" "),v("div",{staticClass:"panel-item-content panel-item-content-5 column-gap-4"},[m._l(m.imageSizeOptions,(function(e){return[5===e.code?[v("image-size-options-popup",{ref:"ImageSizeOptionsPopup",refInFor:!0,attrs:{currentImageSize:m.currentImageSize},on:{applySize:m.handleUpdateSize}},[v("div",{key:e.code,staticClass:"panel-item",class:["panel-item-custom",![1,2,3,4].includes(m.currentImageSize)&&"panel-item-active"]},[v("span",{staticClass:"iconfont panel-item-icon",class:["".concat(e.icon)]}),m._v(" "),v("span",{staticClass:"panel-item-label panel-item-label-overflow",attrs:{title:m.$t(null==e?void 0:e.label)}},[m._v(m._s(m.$t(null==e?void 0:e.label)))])])])]:[v("div",{key:e.code,staticClass:"panel-item",class:[5===e.code&&"panel-item-custom",e.code===m.currentImageSize&&"panel-item-active"],on:{click:function(t){return t.stopPropagation(),m.handleUpdateSize(e)}}},[v("span",{staticClass:"iconfont panel-item-icon",class:["".concat(e.icon)]}),m._v(" "),5===e.code?[v("span",{staticClass:"panel-item-label panel-item-label-overflow",attrs:{title:m.$t(null==e?void 0:e.label)}},[m._v(m._s(m.$t(null==e?void 0:e.label)))])]:v("span",{staticClass:"panel-item-label"},[m._v(m._s(e.label))])],2)]]}))],2),m._v(" "),v("div",{directives:[{name:"show",rawName:"v-show",value:5===m.currentImageSize,expression:"currentImageSize === 5"}],staticClass:"custom-size-box"},[v("div",{staticClass:"custom-size-box-item"},[v("span",{staticClass:"custom-size-box-item-text-before"},[m._v("Width")]),m._v(" "),v("el-input-number",{key:"custom_width_input",staticClass:"easy-input-number custom-size-box-item-input-number",attrs:{value:m.value.width,controls:!1,min:m.getCustomSizeOptions.min,max:m.getCustomSizeOptions.max,step:1,disabled:5!==m.currentImageSize||m.isLockSize},on:{change:function(e){return m.customSizeChange(e,"width")}}}),m._v(" "),v("span",{staticClass:"custom-size-box-item-text-after"},[m._v("px")])],1),m._v(" "),v("div",{staticClass:"custom-size-box-item-lock",class:[m.isLockSize&&"active-btn"],on:{click:function(e){return e.stopPropagation(),m.changeLockStatus.apply(null,arguments)}}},[v("i",{staticClass:"iconfont",class:[m.isLockSize?"icon-collectLock":"icon-lock-open-variant-outline"]})]),m._v(" "),v("div",{staticClass:"custom-size-box-item"},[v("span",{staticClass:"custom-size-box-item-text-before"},[m._v("Height")]),m._v(" "),v("el-input-number",{key:"custom_height_input",staticClass:"easy-input-number custom-size-box-item-input-number",attrs:{value:m.value.height,controls:!1,min:m.getCustomSizeOptions.min,max:m.getCustomSizeOptions.max,step:1,disabled:5!==m.currentImageSize||m.isLockSize},on:{change:function(e){return m.customSizeChange(e,"height")}}}),m._v(" "),v("span",{staticClass:"custom-size-box-item-text-after"},[m._v("px")])],1)]),m._v(" "),v("div",{directives:[{name:"show",rawName:"v-show",value:5===m.currentImageSize,expression:"currentImageSize === 5"}],staticClass:"custom-size-box"},[v("div",{staticClass:"custom-size-box-slider-item"},[v("el-slider",{staticClass:"easy-slider-item",attrs:{value:m.value.width,min:m.getCustomSizeOptions.min,max:m.getCustomSizeOptions.max,step:1,disabled:5!==m.currentImageSize,"show-tooltip":!1},on:{input:function(e){return m.customSizeChange(e,"width")}}})],1),m._v(" "),v("div",{staticClass:"custom-size-box-slider-item-ratio"},[m._v("\n        "+m._s(m.showAspectRatio)+"\n      ")]),m._v(" "),v("div",{staticClass:"custom-size-box-slider-item"},[v("el-slider",{staticClass:"easy-slider-item",attrs:{value:m.value.height,min:m.getCustomSizeOptions.min,max:m.getCustomSizeOptions.max,step:1,disabled:5!==m.currentImageSize,"show-tooltip":!1},on:{input:function(e){return m.customSizeChange(e,"height")}}})],1)])]),m._v(" "),v("div",{staticClass:"generate-mode-panel-item"},[v("div",{staticClass:"panel-item-label"},[v("span",{staticClass:"generate-mode-panel-label-text"},[m._v(m._s(m.$t("QuantityOfImages")))])]),m._v(" "),v("div",{staticClass:"panel-item-content panel-item-content-4"},m._l(4,(function(i){return v("div",{key:"numberImages_".concat(i),staticClass:"panel-item",class:[m.isCurrentImageNum(i)?"active-btn":""],on:{click:function(e){return e.stopPropagation(),m.changeConfig(i,"n_iter")}}},[m._v(m._s(i)+"\n      ")])})),0)]),m._v(" "),m.showAnimeStrong?v("div",{directives:[{name:"show",rawName:"v-show",value:!(null!==(d=m.easyTop)&&void 0!==d&&d.isStudioFlux||null!==(h=m.easyTop)&&void 0!==h&&h.isCommunityFlux),expression:"!easyTop?.isStudioFlux && !easyTop?.isCommunityFlux"}],staticClass:"generate-mode-panel-item"},[v("div",{staticClass:"panel-item-label panel-item-label-flex"},[v("div",[v("span",{staticClass:"generate-mode-panel-label-text"},[m._v(m._s(m.$t("studio26")))]),m._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:m.$t("newGenerate2"),placement:"top-start"}},[v("i",{staticClass:"custom-tips el-icon-warning"})])],1),m._v(" "),v("el-switch",{attrs:{"active-color":"#3F8CFF",value:m.value.generate.anime_enhance,"active-value":1,"inactive-value":2},on:{change:function(e){return m.handleSwitchAnimeEnhance(e,"anime_enhance")}}})],1)]):m._e(),m._v(" "),m.isCompanyAccount?m._e():v("div",{staticClass:"generate-mode-panel-item"},[v("div",{staticClass:"panel-item-label panel-item-label-flex"},[v("div",{staticClass:"panel-item-label-box"},[v("span",{staticClass:"generate-mode-panel-label-text"},[m._v(m._s(m.$t("newGenerate12")))]),m._v(" "),m.isCompanyAccount?m._e():v("img",{staticClass:"vip-icon",attrs:{src:n(162),alt:"vip-icon"}})]),m._v(" "),v("el-switch",{attrs:{"active-color":"#3F8CFF","active-value":2,"inactive-value":1},on:{change:m.handleCreateSettingSelectChange},model:{value:m.createSetting,callback:function(e){m.createSetting=e},expression:"createSetting"}})],1)]),m._v(" "),m.isCompanyAccount?m._e():v("div",{directives:[{name:"show",rawName:"v-show",value:m.isShowFree,expression:"isShowFree"}],staticClass:"generate-mode-panel-item"},[v("div",{staticClass:"panel-item-label panel-item-label-flex"},[v("div",{staticClass:"panel-item-label-box"},[v("span",{staticClass:"generate-mode-panel-label-text"},[m._v(m._s(m.$t("daily_rights_2")))]),m._v(" "),v("el-tooltip",{attrs:{content:m.$t(this.UnlimitedQueueTip),placement:"top-start",effect:"light"}},[m.isCompanyAccount?m._e():v("img",{staticClass:"vip-icon",attrs:{src:n(162),alt:"vip-icon"}})])],1),m._v(" "),v("el-switch",{attrs:{"active-color":"#3F8CFF",value:m.value.speed_type,"active-value":3,"inactive-value":m.queueRenderList[0].code},on:{change:function(e){return m.handleQueueSelectChange(e)}}})],1)]),m._v(" "),v("common-confirm-modal",{ref:"commonConfirmModal"})],1)}),[],!1,null,"34c27a44",null)),Kn=Jn.exports;function Xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Qn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xn(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Zn={name:"EasyAdvanceRepairModal",props:{value:{type:Object,default:function(){return{}}},isShowUpscale:{type:Boolean,default:!0}},components:{AdditionalPanelCardItem:Dn,SliderItem:Ln.a,EasyStyleModal:_n},data:function(){return{visible:!1,enableAdModel:!1,config:{hr_upscaler:"",ad_model:"",ad_units:{lora:{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""},restore_faces:!1},characterRepairSelectList:[{code:"face",i18nKey:"repairType1"},{code:"hand",i18nKey:"repairType2"},{code:"body",i18nKey:"repairType3"}],showLora:!1,showPrompt:!1,showNegativePrompt:!1}},computed:Qn(Qn({},Object(S.c)("creation",["hr_upscaler"])),{},{renderList:function(){var e=(this.hr_upscaler||[]).map((function(e){return{label:e,code:e}}));return[{code:"",label:this.$t("none")}].concat(Object(R.a)(e))}}),methods:{handleSelectModel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"LORA"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")&&(this.config.ad_units.lora=Qn({model_id:e.id,weight:1},e),this.showLora=!0),this.$refs.easyStyleModal.handleClose()},handleDeleteLora:function(){this.config.ad_units.lora={},this.showLora=!1},openLoraPick:function(){this.$refs.easyStyleModal.openModal("LORA")},changeConfig:function(e,t){["ad_confidence","ad_denoising_strength"].includes(t)?this.$set(this.config.ad_units,t,e):this.$set(this.config,t,e)},handleChangeWeight:function(e){try{this.config.ad_units.lora.weight=e}catch(e){}},handleDeleteModel:function(){this.config.ad_units.lora={}},handleSelectRepairChange:function(e){this.config.ad_model=e?"face":""},changeShowLoraStatus:function(){this.showLora=!this.showLora},changeShowPromptStatus:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";["el-textarea__inner"].includes(null==e||null===(t=e.target)||void 0===t?void 0:t.className)||("negative_prompt"!==n?this.showPrompt=!this.showPrompt:this.showNegativePrompt=!this.showNegativePrompt)},show:function(){this.resetData(),this.initData(),this.visible=!0},resetData:function(){this.enableAdModel=!1,this.config={hr_upscaler:"",ad_model:"",ad_units:{lora:{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""},restore_faces:!1},this.showLora=!1,this.showPrompt=!1,this.showNegativePrompt=!1},initData:function(){this.config.hr_upscaler=this.value.hr_upscaler,this.config.ad_model=this.value.ad_model,this.enableAdModel=""!==this.value.ad_model,this.config.ad_units=JSON.parse(JSON.stringify(this.value.ad_units)),this.config.restore_faces=this.value.restore_faces},handleClose:function(){this.visible=!1},handleConfirm:function(){this.$emit("updateData",this.config),this.handleClose()},selectRepair:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config.ad_model=null==e?void 0:e.code}}},Yn=Zn,ea=(n(3057),Object(y.a)(Yn,(function(){var e,t,n=this,o=n._self._c;return o("el-dialog",{attrs:{visible:n.visible,"custom-class":"easy-advance-repair-modal custom-dialog",title:n.$t("AdvancedRepair"),"destroy-on-close":!1,"close-on-press-escape":!0,modal:!1,"modal-append-to-body":"",width:"320px"},on:{"update:visible":function(e){n.visible=e}}},[o("div",{staticClass:"modal-header"},[o("div",{staticClass:"modal-header-title"}),n._v(" "),o("span",{staticClass:"modal-header-close",on:{click:function(e){return e.stopPropagation(),n.handleClose()}}},[o("i",{staticClass:"el-icon-close"})])]),n._v(" "),o("div",{staticClass:"modal-content"},[n.isShowUpscale?o("div",{staticClass:"modal-content-item"},[o("div",{staticClass:"modal-content-item-label"},[n._v(n._s(n.$t("taskTabUpscale")))]),n._v(" "),o("div",{staticClass:"modal-content-item-content"},[o("el-select",{staticClass:"easy-custom-select",attrs:{"popper-append-to-body":!0,"popper-class":"custom-select"},model:{value:n.config.hr_upscaler,callback:function(e){n.$set(n.config,"hr_upscaler",e)},expression:"config.hr_upscaler"}},n._l(n.renderList,(function(e,i){return o("el-option",{key:"method_"+i,attrs:{label:e.label,value:e.code}},[o("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:e.label,placement:"top-start"}},[o("span",[n._v(n._s(e.label))])])],1)})),1)],1)]):n._e(),n._v(" "),o("div",{staticClass:"modal-content-item"},[o("div",{staticClass:"modal-content-item-label modal-content-item-label-flex"},[o("span",{staticClass:"content-item-label-text"},[n._v(n._s(n.$t("RestoreFaces")))]),n._v(" "),o("el-switch",{attrs:{"active-color":"#3F8CFF"},model:{value:n.config.restore_faces,callback:function(e){n.$set(n.config,"restore_faces",e)},expression:"config.restore_faces"}})],1)]),n._v(" "),o("div",{staticClass:"modal-content-item"},[o("div",{staticClass:"modal-content-item-label modal-content-item-label-flex"},[o("span",{staticClass:"content-item-label-text"},[n._v(n._s(n.$t("characterRepair")))]),n._v(" "),o("el-switch",{attrs:{"active-color":"#3F8CFF"},on:{change:n.handleSelectRepairChange},model:{value:n.enableAdModel,callback:function(e){n.enableAdModel=e},expression:"enableAdModel"}})],1)]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:""!==n.config.ad_model,expression:"config.ad_model !== ''"}],staticClass:"modal-content-item"},[o("div",{staticClass:"modal-content-item-content"},n._l(n.characterRepairSelectList,(function(e,t){return o("div",{key:"method_".concat(t,"_").concat(e.code),staticClass:"panel-item",class:[e.code===n.config.ad_model?"active-btn":""],on:{click:function(t){return t.stopPropagation(),n.selectRepair(e)}}},[n._v(n._s(n.$t(e.i18nKey))+"\n        ")])})),0)]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:""!==n.config.ad_model,expression:"config.ad_model !== ''"}],staticClass:"modal-content-item-card"},[o("div",{staticClass:"lora-panel-title",class:[n.showLora&&"lora-panel-title-no-margin"],on:{click:function(e){var t;e.stopPropagation(),null!==(t=n.config)&&void 0!==t&&null!==(t=t.ad_units)&&void 0!==t&&null!==(t=t.lora)&&void 0!==t&&t.id?n.changeShowLoraStatus():n.openLoraPick()}}},[o("span",{staticClass:"lora-panel-title-text"},[n._v(n._s(n.$t("LoRA")))]),n._v(" "),o("span",{staticClass:"lora-panel-title-icon",class:null!==(e=n.config)&&void 0!==e&&null!==(e=e.ad_units)&&void 0!==e&&null!==(e=e.lora)&&void 0!==e&&e.id?n.showLora?"el-icon-arrow-up":"el-icon-arrow-down":"el-icon-circle-plus-outline"})]),n._v(" "),null!==(t=n.config)&&void 0!==t&&null!==(t=t.ad_units)&&void 0!==t&&null!==(t=t.lora)&&void 0!==t&&t.id?o("additional-panel-card-item",{directives:[{name:"show",rawName:"v-show",value:n.showLora,expression:"showLora"}],staticStyle:{"margin-top":"8px"},attrs:{showWarning:!1,modelInfo:n.config.ad_units.lora},on:{deleteItem:n.handleDeleteLora,changeWeight:n.handleChangeWeight}}):n._e()],1),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:""!==n.config.ad_model,expression:"config.ad_model !== ''"}],staticClass:"modal-content-item"},[o("div",{staticClass:"modal-content-item-label"},[n._v(n._s(n.$t("redrawingNoiseIntensity")))]),n._v(" "),o("div",{staticClass:"modal-content-item-content"},[o("slider-item",{attrs:{"hide-label":!0,value:n.config.ad_units.ad_denoising_strength,min:0,max:.5,step:.05},on:{change:function(e){return n.changeConfig(e,"ad_denoising_strength")}}})],1)]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:""!==n.config.ad_model,expression:"config.ad_model !== ''"}],staticClass:"modal-content-item"},[o("div",{staticClass:"modal-content-item-label"},[n._v(n._s(n.$t("Confidence")))]),n._v(" "),o("div",{staticClass:"modal-content-item-content"},[o("slider-item",{attrs:{"hide-label":!0,value:n.config.ad_units.ad_confidence,min:0,max:1,step:.1},on:{change:function(e){return n.changeConfig(e,"ad_confidence")}}})],1)]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:""!==n.config.ad_model,expression:"config.ad_model !== ''"}],staticClass:"modal-content-item-card",on:{click:function(e){return e.stopPropagation(),n.changeShowPromptStatus(e,"prompt")}}},[o("div",{staticClass:"lora-panel-title",class:[n.showPrompt&&"lora-panel-title-no-margin"]},[o("span",{staticClass:"lora-panel-title-text"},[n._v(n._s(n.$t("Prompt")))]),n._v(" "),o("span",{staticClass:"lora-panel-title-icon",class:n.showPrompt?"el-icon-arrow-up":"el-icon-arrow-down"})]),n._v(" "),o("el-input",{directives:[{name:"show",rawName:"v-show",value:n.showPrompt,expression:"showPrompt"}],staticClass:"custom-input modal-content-item-card-input",attrs:{type:"textarea",autosize:{minRows:1.5,maxRows:3},max:1e3},model:{value:n.config.ad_units.prompt,callback:function(e){n.$set(n.config.ad_units,"prompt",e)},expression:"config.ad_units.prompt"}})],1),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:""!==n.config.ad_model,expression:"config.ad_model !== ''"}],staticClass:"modal-content-item-card",on:{click:function(e){return e.stopPropagation(),n.changeShowPromptStatus(e,"negative_prompt")}}},[o("div",{staticClass:"lora-panel-title",class:[n.showNegativePrompt&&"lora-panel-title-no-margin"]},[o("span",{staticClass:"lora-panel-title-text"},[n._v(n._s(n.$t("NegativePrompts")))]),n._v(" "),o("span",{staticClass:"lora-panel-title-icon",class:n.showNegativePrompt?"el-icon-arrow-up":"el-icon-arrow-down"})]),n._v(" "),o("el-input",{directives:[{name:"show",rawName:"v-show",value:n.showNegativePrompt,expression:"showNegativePrompt"}],staticClass:"custom-input modal-content-item-card-input",attrs:{type:"textarea",autosize:{minRows:1.5,maxRows:3},max:1e3},model:{value:n.config.ad_units.negative_prompt,callback:function(e){n.$set(n.config.ad_units,"negative_prompt",e)},expression:"config.ad_units.negative_prompt"}})],1)]),n._v(" "),o("div",{staticClass:"modal-footer"},[o("span",{staticClass:"modal-footer-btn",on:{click:function(e){return e.stopPropagation(),n.handleClose()}}},[n._v(n._s(n.$t("Cancel")))]),n._v(" "),o("span",{staticClass:"modal-footer-btn modal-footer-btn-confirm",on:{click:function(e){return e.stopPropagation(),n.handleConfirm()}}},[n._v(n._s(n.$t("Confirm")))])]),n._v(" "),o("easy-style-modal",{ref:"easyStyleModal",attrs:{"model-type":"LORA",inTask:!0,"hide-embedding":!0,"is-studio-mode":!0},on:{selectModel:n.handleSelectModel,deleteItem:n.handleDeleteModel}})],1)}),[],!1,null,null,null).exports);function ta(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ia(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ta(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ta(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var na={name:"EasyModeModal",inject:["easyTop"],props:{value:{type:Object,default:function(){return{}}},isAnimeEnhanceEnable:{type:Boolean,default:!1},isShowEngineMode:{type:Boolean,default:!0}},components:{SliderItem:Ln.a},data:function(){return{visible:!1,config:{vae:"vae-ft-mse-840000-ema-pruned",clip_skip:1,category:1,mode:1},modeList:[{code:1,value:0,label:"默认",i18nKey:"createModeType1",tips:"",logEvent:"default"},{code:2,value:1,label:"海艺V6",i18nKey:"createModeType2",tips:"createModeTips2",isVip:!0,logEvent:"seaArt_2.0"},{code:3,value:2,label:"海艺2.1",i18nKey:"createModeType6",tips:"createModeTips6",isVip:!0,logEvent:"seaArt_2.1"}],loading:!1}},computed:ia(ia(ia({},Object(S.c)("creation",["taskVae"])),Object(S.c)("user",["accountSettingsData","isCompanyAccount"])),{},{handleVaeList:function(){var e;return null!==(e=this.easyTop)&&void 0!==e&&e.isSDXLModel?this.taskVae.filter((function(e){return"None"===e||"sdxl_vae"===e})):this.taskVae.filter((function(e){return"sdxl_vae"!==e}))},isVipFun:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},isOnlyVipLite:function(){var e,t;return!(null!==(e=this.paymentInfo)&&void 0!==e&&e.activeState)&&!this.isCompanyAccount&&(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)},canUseUnlimitedQueue:function(){var e;return null===(e=this.paymentInfo)||void 0===e?void 0:e.infiniteQueue},queueRenderList:function(){return[{code:1,i18nKey:"NormalQueue",tips:"",show:!this.isVipFun},{code:2,i18nKey:"SubsBottomTerms2",tips:"",isVip:!0,show:this.isVipFun},{code:3,i18nKey:"UnlimitedQueue",tips:this.UnlimitedQueueTip,isVip:!0,show:!0}].filter((function(e){return e.show}))},UnlimitedQueueTip:function(){return this.isCompanyAccount?"ToBUnlimitedQueueTip":"UnlimitedQueueTip"},isStudioMode:function(){return!1}}),methods:ia(ia(ia({},Object(S.b)("user",["getAccountInfo"])),Object(S.c)("payment",["paymentInfo"])),{},{show:function(){this.initData(),this.visible=!0},initData:function(){var e=this,t=this.modeList.find((function(t){var n;return t.value===(null===(n=e.value)||void 0===n||null===(n=n.generate)||void 0===n?void 0:n.mode)}));this.config.mode=t?null==t?void 0:t.code:1,this.config.vae=this.value.vae,this.config.clip_skip=this.value.clip_skip},handleClose:function(){this.visible=!1},handleConfirm:function(){var e=JSON.parse(JSON.stringify(this.config)),t=this.modeList.find((function(t){return t.code===(null==e?void 0:e.mode)}));e.mode=t?null==t?void 0:t.value:0,this.$logEvent("log_actions",{operation:"click_engine_select",behavior_info:"on_new_create_flow_page",behavior_info_sub:null==t?void 0:t.logEvent}),this.$emit("updateData",e),this.handleClose()},changeConfig:function(e,t){this.$set(this.config,t,e)}})},aa=(n(3058),Object(y.a)(na,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,"custom-class":"easy-mode-modal-modal custom-dialog",title:e.$t("VAE"),"destroy-on-close":!1,"close-on-press-escape":!0,modal:!1,"modal-append-to-body":"",width:"320px"},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"modal-header"},[t("div",{staticClass:"modal-header-title"}),e._v(" "),t("span",{staticClass:"modal-header-close",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[t("i",{staticClass:"el-icon-close"})])]),e._v(" "),t("div",{staticClass:"modal-content"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isAnimeEnhanceEnable,expression:"!isAnimeEnhanceEnable"}],staticClass:"modal-content-item"},[t("div",{staticClass:"modal-content-item-label"},[e._v(e._s(e.$t("VAE"))+"\n          "),t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:e.$t("vaeTips"),placement:"top-start"}},[t("i",{staticClass:"custom-tips el-icon-warning"})])],1),e._v(" "),t("div",{staticClass:"modal-content-item-content"},[t("el-select",{staticClass:"easy-custom-select",attrs:{"popper-append-to-body":!0,"popper-class":"custom-select vae-custom-select"},model:{value:e.config.vae,callback:function(t){e.$set(e.config,"vae",t)},expression:"config.vae"}},e._l(e.handleVaeList,(function(n,i){return t("el-option",{key:"method_"+i,attrs:{label:n,value:n}},[t("el-tooltip",{attrs:{content:n,placement:"left"}},[t("span",[e._v(e._s(n))])])],1)})),1)],1)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isAnimeEnhanceEnable,expression:"!isAnimeEnhanceEnable"}],staticClass:"modal-content-item"},[t("div",{staticClass:"modal-content-item-label"},[e._v(e._s(e.$t("clipSkip"))+"\n        "),t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:e.$t("clipSkipTips"),placement:"top-start"}},[t("i",{staticClass:"custom-tips el-icon-warning"})])],1),e._v(" "),t("div",{staticClass:"modal-content-item-content"},[t("slider-item",{attrs:{"hide-label":!0,"show-tooltip":!1,value:e.config.clip_skip,min:1,max:5},on:{change:function(t){return e.changeConfig(t,"clip_skip")}}})],1)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isAnimeEnhanceEnable&&e.isShowEngineMode,expression:"!isAnimeEnhanceEnable && isShowEngineMode"}],staticClass:"modal-content-item"},[t("div",{staticClass:"modal-content-item-label"},[e._v(e._s(e.$t("newGenerate7"))+"\n        "),t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:e.$t("newGenerate8"),placement:"top-start"}},[t("i",{staticClass:"custom-tips el-icon-warning"})])],1),e._v(" "),t("div",{staticClass:"modal-content-item-content"},[t("el-select",{staticClass:"easy-custom-select",attrs:{"popper-append-to-body":!0,"popper-class":"custom-select vae-custom-select"},model:{value:e.config.mode,callback:function(t){e.$set(e.config,"mode",t)},expression:"config.mode"}},e._l(e.modeList,(function(n,i){return t("el-option",{key:"mode_"+i,attrs:{label:e.$t(n.i18nKey),value:n.code}})})),1)],1)])]),e._v(" "),t("div",{staticClass:"modal-footer"},[t("span",{staticClass:"modal-footer-btn",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("span",{staticClass:"modal-footer-btn modal-footer-btn-confirm",on:{click:function(t){return t.stopPropagation(),e.handleConfirm()}}},[e._v(e._s(e.$t("Confirm")))])])])}),[],!1,null,null,null).exports);function oa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function sa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oa(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var la={name:"EasyAdvanceSettingPanel",props:["value"],inject:["easyTop"],data:function(){return{createSetting:1,loading:!1,cardConfigList:[{code:"vae",i18nKey:"VAE",tips:"vaeTips"},{code:"clip_skip",i18nKey:"clipSkip",tips:"clipSkipTips"},{code:"mode",i18nKey:"newGenerate7",tips:"",mapOptions:[{code:0,label:"默认",i18nKey:"createModeType1",tips:""},{code:1,label:"海艺V6",i18nKey:"createModeType2",tips:"createModeTips2",isVip:!0},{code:2,label:"海艺2.1",i18nKey:"createModeType6",tips:"createModeTips6",isVip:!0}]}],repairConfigList:[{code:"hr_upscaler",i18nKey:"taskTabUpscale",mapOptions:this.renderList,tips:""},{code:"hr_second_pass_steps",i18nKey:"UpscaleSamplingTimes",tips:""},{code:"hr_upscaler_redraw",i18nKey:"RedrawNoiseIntensity",tips:""},{code:"ad_model",i18nKey:"characterRepair",tips:"",mapOptions:[{code:"",i18nKey:"none"},{code:"face",i18nKey:"repairType1"},{code:"hand",i18nKey:"repairType2"},{code:"body",i18nKey:"repairType3"}]},{code:"ad_units.lora",i18nKey:"LoRA",tips:""},{code:"ad_units.ad_denoising_strength",i18nKey:"redrawingNoiseIntensity",tips:""},{code:"ad_units.ad_confidence",i18nKey:"Confidence",tips:""},{code:"ad_units.prompt",i18nKey:"Prompt",tips:""},{code:"ad_units.negative_prompt",i18nKey:"NegativePrompts",tips:""},{code:"restore_faces",i18nKey:"RestoreFaces",tips:""}],isCollapse:!0}},components:{SliderItem:Ln.a,EasyAdvanceRepairModal:ea,EasyModeModal:aa},computed:sa(sa(sa(sa({},Object(S.c)("payment",["paymentInfo"])),Object(S.c)("user",["accountSettingsData","isCompanyAccount","isLoggedIn"])),Object(S.c)("creation",["taskSamplerMethods","taskVae","sd_xl_sampler_name","lab_scheduler","lab_sampler_name","hr_upscaler"])),{},{showImgSeed:function(){return this.value.seedTemp&&this.value.seed!==this.value.seedTemp},isVipFun:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},isOnlyVipLite:function(){var e,t;return!(null!==(e=this.paymentInfo)&&void 0!==e&&e.activeState)&&!this.isCompanyAccount&&(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)},canUseUnlimitedQueue:function(){var e;return null===(e=this.paymentInfo)||void 0===e?void 0:e.infiniteQueue},queueRenderList:function(){return[{code:1,i18nKey:"NormalQueue",tips:"",show:!this.isVipFun},{code:2,i18nKey:"SubsBottomTerms2",tips:"",isVip:!0,show:this.isVipFun},{code:3,i18nKey:"UnlimitedQueue",tips:this.UnlimitedQueueTip,isVip:!0,show:!0}].filter((function(e){return e.show}))},UnlimitedQueueTip:function(){return this.isCompanyAccount?"ToBUnlimitedQueueTip":"UnlimitedQueueTip"},isShowUpscale:function(){var e,t,n,o,l=!(null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isStudioFlux||null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isCommunityFlux),r=null==this||null===(n=this.easyTop)||void 0===n?void 0:n.hasEnableImageToImage,c=null==this||null===(o=this.easyTop)||void 0===o?void 0:o.hasEnableControlNetToImage;return l&&(!r&&!c)},isShowAdvancedRepair:function(){var e,t,n,o,l,r,c,d,h,m=!(this.isCollapse||null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isStudioFlux||null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isCommunityFlux||null!=this&&null!==(n=this.easyTop)&&void 0!==n&&n.isAnimeEnhanceEnable||null!=this&&null!==(o=this.easyTop)&&void 0!==o&&o.isSd35Model),v=!(null!==(l=this.value)&&void 0!==l&&null!==(l=l.controlnet_units)&&void 0!==l&&l.length&&(null===(r=this.value)||void 0===r||null===(r=r.imageToImageList)||void 0===r||!r.length)&&(null==this||null===(c=this.easyTop)||void 0===c||!c.isStudioFlux)&&(null==this||null===(d=this.easyTop)||void 0===d||!d.isCommunityFlux)&&(null==this||null===(h=this.easyTop)||void 0===h||!h.isAnimeEnhanceEnable));return m&&v},schedulerDisabled:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isAnimeEnhanceEnable},isShowEngineMode:function(){var e,t,n,o,l,r=(null==this||null===(e=this.easyTop)||void 0===e||null===(e=e.config)||void 0===e?void 0:e.textToImage)||{},c=null==this||null===(t=this.easyTop)||void 0===t?void 0:t.isSdModel,d=null==r||null===(n=r.imageToImageList)||void 0===n?void 0:n.length,h=null==r||null===(o=r.controlnet_units)||void 0===o?void 0:o.length,m=this.isOpenUpscale,v=null==this||null===(l=this.easyTop)||void 0===l?void 0:l.isEnableQuality;return c&&[!d,!h,!m,!v].every((function(e){return e}))},renderCardConfigList:function(){var e,t=["vae","clip_skip","mode"];return null!==(e=this.easyTop)&&void 0!==e&&e.isAnimeEnhanceEnable?this.cardConfigList.filter((function(e){return!t.includes(null==e?void 0:e.code)})):this.isShowEngineMode?this.cardConfigList:(t=["mode"],this.cardConfigList.filter((function(e){return!t.includes(null==e?void 0:e.code)})))},renderStepsOptions:function(){var e,t,n,o,l,r,c,d={min:10,max:40};return null!=this&&null!==(e=this.value)&&void 0!==e&&e.lcm_mode&&(d.min=4,d.max=8),null===(t=this.easyTop)||void 0===t||!t.isSDXLModel||null!=this&&null!==(n=this.value)&&void 0!==n&&n.lcm_mode||(d.min=20),(null!==(o=this.easyTop)&&void 0!==o&&o.isStudioFlux||null!==(l=this.easyTop)&&void 0!==l&&l.isAnimeEnhanceEnable)&&(d.min=25,d.max=50),null!==(r=this.easyTop)&&void 0!==r&&r.isCommunityFlux&&(d.min=4,d.max=25),null!==(c=this.easyTop)&&void 0!==c&&c.isSd35Model&&(d.min=6,d.max=25),d},renderCFGScale:function(){var e,t,n={min:3,max:15};return null!=this&&null!==(e=this.value)&&void 0!==e&&e.lcm_mode&&(n.min=1,n.max=3),null!==(t=this.easyTop)&&void 0!==t&&t.isAnimeEnhanceEnable&&(n.min=2,n.max=15),n},getCharacterRepairName:function(){var e=this,t=[{code:"",i18nKey:"none"},{code:"face",i18nKey:"repairType1"},{code:"hand",i18nKey:"repairType2"},{code:"body",i18nKey:"repairType3"}].find((function(t){return t.code===e.value.ad_model}));return t?this.$t(null==t?void 0:t.i18nKey):""},seedOptions:function(){var e,t,n={max:4294967294};return(null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isStudioFlux||null!==(t=this.easyTop)&&void 0!==t&&t.isCommunityFlux)&&(n.max=2147483643),n},isOpenUpscale:function(){return""!==this.value.hr_upscaler},isOpenCharacterRepair:function(){return""!==this.value.ad_model},selectLora:function(){var e;return(null===(e=this.value.ad_units)||void 0===e?void 0:e.lora)||{}},isShowLora:function(){var e;return null===(e=Object.keys(this.selectLora))||void 0===e?void 0:e.length},renderList:function(){var e=(this.hr_upscaler||[]).map((function(e){return{label:e,code:e}}));return[{code:"",label:this.$t("none")}].concat(Object(R.a)(e))},getCardRenderInfo:function(){var e=this;return function(){var t=arguments.length>1?arguments[1]:void 0,n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).mapOptions,o=(void 0===n?[]:n).find((function(e){return e.code===t}));return o?e.$t(null==o?void 0:o.i18nKey):t}},isCurrentImageNum:function(){return function(i){return this.value.n_iter===i}},renderTaskSamplerMethods:function(){return this.taskSamplerMethods},isShowSteps:function(){var e;return!(this.isCollapse||null!==(e=this.easyTop)&&void 0!==e&&e.isStudioFlux)},isShowFree:function(){var e,t,n;return!(this.isCollapse||null!==(e=this.easyTop)&&void 0!==e&&e.isStudioFlux||null!==(t=this.easyTop)&&void 0!==t&&t.isCommunityFlux||null!==(n=this.easyTop)&&void 0!==n&&n.isSd35Model)}}),watch:{accountSettingsData:{handler:function(){this.createSetting=this.accountSettingsData.is_auto_pub_community?1:2},immediate:!0,deep:!0},isShowEngineMode:{handler:function(e){if(!e)try{var t,n=JSON.parse(JSON.stringify(this.value));n.generate.mode=0,null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig(n)}catch(e){}},immediate:!0}},methods:sa(sa({},Object(S.b)("user",["getAccountInfo"])),{},{useSeed:function(e){var t,n=["",null,void 0,-1].includes(e)?-1:e,o=JSON.parse(JSON.stringify(this.value));o.seed=n,o.lockSeed||(o.lockSeed=!0),null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig(o)},handleQueueSelectChange:function(e){var t;this.$logEvent("log_actions",{operation:"click_free_create",behavior_info:"on_new_create_flow_page",behavior_info_sub:3===e?"open":"close"}),3!==e||this.isLoggedIn?![3].includes(e)||3!==e||this.isVipFun?[3].includes(e)&&this.isStudioMode&&this.isCompanyAccount||([3].includes(e)&&this.isOnlyVipLite?this.$EventBus.$emit("showUpgradeDialog","UnlimitedQueueTipWeb","standard"):![3].includes(e)||this.canUseUnlimitedQueue?(localStorage.setItem("speed_type",e),null==this||null===(t=this.easyTop)||void 0===t||t.updateSpeedType(e)):this.$EventBus.$emit("showUpgradeDialog","UnlimitedQueueTipWeb","standard")):this.$EventBus.$emit("showBreakDialog","UnlimitedQueueTipWeb","standard"):this.$EventBus.$emit("openLoginDialog")},toggleFoldStatus:function(){this.isCollapse=!this.isCollapse},changeConfig:function(e,t){var n,o,l;"enableNegativePrompts"===t&&(this.$logEvent("log_actions",{operation:"click_negative_prompt",behavior_info:"on_new_create_flow_page",behavior_info_sub:e?"open":"close"}),this.$EventBus.$emit("resetInputPackUpStatus"));var r=JSON.parse(JSON.stringify(this.value)),c=(null===(n=this.easyTop)||void 0===n?void 0:n.isStudioFlux)||(null===(o=this.easyTop)||void 0===o?void 0:o.isCommunityFlux);t&&("sampler_name"!==t&&(r[t]=e),"lockSeed"===t&&(this.$logEvent("log_actions",{operation:"click_fixed_seed",behavior_info:"on_new_create_flow_page",behavior_info_sub:e?"open":"close"}),r.seed=e?Object(B.c)(c):-1),"sampler_name"===t&&(r=this.handleLCMConfig(r,e))),null==this||null===(l=this.easyTop)||void 0===l||l.updateConfig(r)},handleLCMConfig:function(e,t){var n,o,l,r=null===(n=this.easyTop)||void 0===n?void 0:n.isSDXLModel,c=20,d=7;if(!(null!==(o=this.easyTop)&&void 0!==o&&o.isStudioFlux||null!==(l=this.easyTop)&&void 0!==l&&l.isCommunityFlux)){if("LCM"===t)return c=r?8:4,d=r?2:1.5,e.steps=c,e.cfg_scale=d,e.sampler_name="LCM",e.lcm_mode=1,e;"LCM"===(null==e?void 0:e.sampler_name)&&"LCM"!==t?(e.steps=c,e.cfg_scale=d,e.sampler_name=t,e.lcm_mode=0):(e.sampler_name=t,e.lcm_mode=0)}return e},handleUpdateConfig:function(e){var t,n=JSON.parse(JSON.stringify(this.value));e&&e.hasOwnProperty("mode")&&(n.generate.mode=(null==e?void 0:e.mode)||0,delete e.mode),n=sa(sa({},n),e),null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig(n)},handleCreateSettingSelectChange:function(e){if([2,"2"].includes(e)&&!this.paymentInfo.show_auto_pub_switch)return this.$EventBus.$emit("showBreakDialog","PrivateWorkTipWeb","basic"),void(this.createSetting=1);this.saveSettings(e)},saveSettings:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.loading=!0;var n={};n.auto_pub_community=t,n.mode=1,Object(Q.b)(n).then((function(n){var o=(n||{}).status.code;["10000",1e4].includes(void 0===o?"":o)&&(e.$message.success(e.$t("SaveSuccess")),e.createSetting=t,e.loading=!1,e.getAccountInfo())})).finally((function(){e.loading=!1}))},openRepairModal:function(){this.$refs.repairModal.show()},openModeModal:function(){this.$refs.modeModal.show()}})},ra=la,ca=(n(3059),n(3060),{name:"ParamsPanel",components:{EasyModelPanel:$n,EasyAdditionalPanel:Bn,EasyGenerateModePanel:Kn,EasyAdvanceSettingPanel:Object(y.a)(ra,(function(){var e,t,n,o,l,r,c,d,h,m,v,f,_,y,w,C,k,S,x,I,O,T,$=this,L=$._self._c;return L("div",{staticClass:"c-easy-advance-setting-panel"},[L("div",{staticClass:"additional-panel-title additional-panel-title-height",on:{click:function(e){return e.stopPropagation(),$.toggleFoldStatus()}}},[L("span",{staticClass:"additional-panel-title-text"},[$._v($._s($.$t("AdvancedConfig")))]),$._v(" "),L("span",{staticClass:"additional-panel-title-icon",class:[$.isCollapse?"el-icon-caret-bottom":"el-icon-caret-top"]})]),$._v(" "),L("div",{directives:[{name:"show",rawName:"v-show",value:!($.isCollapse||null!==(e=$.easyTop)&&void 0!==e&&e.isStudioFlux||null!==(t=$.easyTop)&&void 0!==t&&t.isCommunityFlux||null!==(n=$.easyTop)&&void 0!==n&&n.isSd35Model),expression:"!isCollapse && !easyTop?.isStudioFlux && !easyTop?.isCommunityFlux && !easyTop?.isSd35Model"}],staticClass:"advance-setting-panel-item"},[L("div",{staticClass:"panel-item-label"},[L("span",{staticClass:"generate-mode-panel-label-text"},[$._v($._s($.$t("SamplingMethod")))]),$._v(" "),L("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:$.schedulerDisabled?$.$t("studio44"):$.$t("WhichATUTPTI"),placement:"top-start"}},[L("i",{staticClass:"custom-tips",class:[$.schedulerDisabled?"iconfont icon-warn ":"el-icon-warning"]})])],1),$._v(" "),L("div",{staticClass:"panel-item-content"},[L("el-select",{staticClass:"easy-custom-select",attrs:{value:$.value.sampler_name,"popper-append-to-body":!0,disabled:$.schedulerDisabled,"popper-class":"custom-select"},on:{change:function(e){return $.changeConfig(e,"sampler_name")}}},$._l($.renderTaskSamplerMethods,(function(e,i){return L("el-option",{key:"method_"+i,attrs:{label:e,value:e}},[L("el-tooltip",{attrs:{content:e,placement:"left"}},[L("span",[$._v($._s(e))])])],1)})),1)],1)]),$._v(" "),L("div",{directives:[{name:"show",rawName:"v-show",value:$.isShowSteps,expression:"isShowSteps"}],staticClass:"advance-setting-panel-item"},[L("div",{staticClass:"panel-item-label"},[L("span",{staticClass:"generate-mode-panel-label-text"},[$._v($._s($.$t("SamplingSteps")))]),$._v(" "),L("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:$.$t("HowMTTITGII"),placement:"top-start"}},[L("i",{staticClass:"custom-tips el-icon-warning"})])],1),$._v(" "),L("div",{staticClass:"panel-item-content panel-item-content-2"},[L("slider-item",{attrs:{"hide-label":!0,value:$.value.steps,min:$.renderStepsOptions.min,max:$.renderStepsOptions.max,label:"Strength"},on:{change:function(e){return $.changeConfig(e,"steps")}}})],1)]),$._v(" "),L("div",{directives:[{name:"show",rawName:"v-show",value:!($.isCollapse||null!==(o=$.easyTop)&&void 0!==o&&o.isStudioFlux||null!==(l=$.easyTop)&&void 0!==l&&l.isCommunityFlux||null!==(r=$.easyTop)&&void 0!==r&&r.isSd35Model),expression:"!isCollapse && !easyTop?.isStudioFlux && !easyTop?.isCommunityFlux  && !easyTop?.isSd35Model"}],staticClass:"advance-setting-panel-item"},[L("div",{staticClass:"panel-item-label"},[L("span",{staticClass:"generate-mode-panel-label-text"},[$._v($._s($.$t("CFGScale")))]),$._v(" "),L("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:$.$t("newGenerate49"),placement:"top-start"}},[L("i",{staticClass:"custom-tips el-icon-warning"})])],1),$._v(" "),L("div",{staticClass:"panel-item-content panel-item-content-2"},[L("slider-item",{attrs:{"hide-label":!0,value:$.value.cfg_scale,min:$.renderCFGScale.min,max:$.renderCFGScale.max,step:.5,precision:1},on:{change:function(e){return $.changeConfig(e,"cfg_scale")}}})],1)]),$._v(" "),L("div",{directives:[{name:"show",rawName:"v-show",value:(null===(c=$.renderCardConfigList)||void 0===c?void 0:c.length)&&!$.isCollapse&&!(null!==(d=$.easyTop)&&void 0!==d&&d.isStudioFlux)&&!(null!==(h=$.easyTop)&&void 0!==h&&h.isCommunityFlux)&&!(null!==(m=$.easyTop)&&void 0!==m&&m.isSd35Model),expression:"renderCardConfigList?.length && !isCollapse && !easyTop?.isStudioFlux && !easyTop?.isCommunityFlux && !easyTop?.isSd35Model"}],staticClass:"panel-item-card",on:{click:$.openModeModal}},[L("div",{staticClass:"panel-item-content-card"},$._l($.renderCardConfigList,(function(e){var t;return L("div",{key:e.code,staticClass:"panel-item-content-card-item"},[L("div",{staticClass:"card-item-label"},[$._v($._s($.$t(e.i18nKey)))]),$._v(" "),L("div",{staticClass:"card-item-value"},[e.mapOptions&&e.mapOptions.length?[$._v("\n                "+$._s($.getCardRenderInfo(e,"mode"===e.code?null===(t=$.value)||void 0===t||null===(t=t.generate)||void 0===t?void 0:t.mode:$.value[e.code]))+"\n              ")]:[$._v($._s($.value[e.code]||""))]],2)])})),0)]),$._v(" "),L("div",{directives:[{name:"show",rawName:"v-show",value:$.isShowAdvancedRepair,expression:"isShowAdvancedRepair"}],staticClass:"advance-setting-panel-item"},[L("div",{staticClass:"panel-item-label"},[L("span",{staticClass:"generate-mode-panel-label-text"},[$._v($._s($.$t("AdvancedRepair")))]),$._v(" "),L("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:$.$t("ClassifierFGSHSTI"),placement:"top-start"}},[L("i",{staticClass:"custom-tips el-icon-warning"})])],1),$._v(" "),L("div",{staticClass:"panel-item-card",on:{click:$.openRepairModal}},[L("div",{staticClass:"panel-item-content-card"},[L("div",{directives:[{name:"show",rawName:"v-show",value:$.isShowUpscale,expression:"isShowUpscale"}],staticClass:"panel-item-content-card-item"},[L("div",{staticClass:"card-item-label"},[$._v($._s($.$t("taskTabUpscale")))]),$._v(" "),L("div",{staticClass:"card-item-value"},[$.isOpenUpscale?[$._v("\n                "+$._s($.value.hr_upscaler)+"\n              ")]:[$._v($._s($.$t("none")))]],2)]),$._v(" "),L("div",{staticClass:"panel-item-content-card-item"},[L("div",{staticClass:"card-item-label"},[$._v($._s($.$t("RestoreFaces")))]),$._v(" "),L("div",{staticClass:"card-item-value"},[$._v("\n              "+$._s($.value.restore_faces?$.$t("newGenerate18"):$.$t("newGenerate17"))+"\n            ")])]),$._v(" "),L("div",{staticClass:"panel-item-content-card-item"},[L("div",{staticClass:"card-item-label"},[$._v($._s($.$t("characterRepair")))]),$._v(" "),L("div",{staticClass:"card-item-value"},[$.isOpenCharacterRepair?[$._v("\n                "+$._s($.getCharacterRepairName)+"\n              ")]:[$._v($._s($.$t("newGenerate17")))]],2)]),$._v(" "),$.isOpenCharacterRepair?[$.isShowLora?L("div",{staticClass:"panel-item-content-card-item"},[L("div",{staticClass:"card-item-label"},[$._v($._s($.$t("LoRA")))]),$._v(" "),L("div",{staticClass:"card-item-value"},[$._v("\n                "+$._s(null===(v=$.selectLora)||void 0===v?void 0:v.name)+":"+$._s(null===(f=$.selectLora)||void 0===f?void 0:f.version_name)+"\n              ")])]):$._e(),$._v(" "),L("div",{staticClass:"panel-item-content-card-item"},[L("div",{staticClass:"card-item-label"},[$._v($._s($.$t("redrawingNoiseIntensity")))]),$._v(" "),L("div",{staticClass:"card-item-value"},[$._v("\n               "+$._s(null===(_=$.value)||void 0===_||null===(_=_.ad_units)||void 0===_?void 0:_.ad_denoising_strength)+"\n              ")])]),$._v(" "),L("div",{staticClass:"panel-item-content-card-item"},[L("div",{staticClass:"card-item-label"},[$._v($._s($.$t("Confidence")))]),$._v(" "),L("div",{staticClass:"card-item-value"},[$._v("\n                "+$._s(null===(y=$.value)||void 0===y||null===(y=y.ad_units)||void 0===y?void 0:y.ad_confidence)+"\n              ")])]),$._v(" "),null!==(w=$.value)&&void 0!==w&&null!==(w=w.ad_units)&&void 0!==w&&w.prompt?L("div",{staticClass:"panel-item-content-card-item"},[L("div",{staticClass:"card-item-label"},[$._v($._s($.$t("Prompt")))]),$._v(" "),L("div",{staticClass:"card-item-value"},[$._v("\n                "+$._s(null===(C=$.value)||void 0===C||null===(C=C.ad_units)||void 0===C?void 0:C.prompt)+"\n              ")])]):$._e(),$._v(" "),null!==(k=$.value)&&void 0!==k&&null!==(k=k.ad_units)&&void 0!==k&&k.negative_prompt?L("div",{staticClass:"panel-item-content-card-item"},[L("div",{staticClass:"card-item-label"},[$._v($._s($.$t("NegativePrompts")))]),$._v(" "),L("div",{staticClass:"card-item-value"},[$._v("\n                "+$._s(null===(S=$.value)||void 0===S||null===(S=S.ad_units)||void 0===S?void 0:S.negative_prompt)+"\n              ")])]):$._e()]:$._e()],2)])]),$._v(" "),L("div",{directives:[{name:"show",rawName:"v-show",value:!($.isCollapse||null!==(x=$.easyTop)&&void 0!==x&&x.isStudioFlux||null!==(I=$.easyTop)&&void 0!==I&&I.isCommunityFlux||null!==(O=$.easyTop)&&void 0!==O&&O.isSd35Model),expression:"!isCollapse && !easyTop?.isStudioFlux && !easyTop?.isCommunityFlux  && !easyTop?.isSd35Model"}],staticClass:"advance-setting-panel-item advance-setting-panel-item-flex"},[L("div",{staticClass:"panel-item-label"},[L("span",{staticClass:"generate-mode-panel-label-text"},[$._v($._s($.$t("NegativePrompts")))]),$._v(" "),L("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:$.$t("newGenerate53"),placement:"top-start"}},[L("i",{staticClass:"custom-tips el-icon-warning"})])],1),$._v(" "),L("el-switch",{attrs:{"active-color":"#3F8CFF"},on:{change:function(e){return $.changeConfig(e,"enableNegativePrompts")}},model:{value:$.value.enableNegativePrompts,callback:function(e){$.$set($.value,"enableNegativePrompts",e)},expression:"value.enableNegativePrompts"}})],1),$._v(" "),L("div",{directives:[{name:"show",rawName:"v-show",value:!$.isCollapse,expression:"!isCollapse"}],staticClass:"advance-setting-panel-item advance-setting-panel-item-flex"},[L("div",{staticClass:"panel-item-label"},[L("span",{staticClass:"generate-mode-panel-label-text"},[$._v($._s($.$t("newGenerate21")))]),$._v(" "),L("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:$.$t("newGenerate42"),placement:"top-start"}},[L("i",{staticClass:"custom-tips el-icon-warning"})])],1),$._v(" "),L("el-switch",{attrs:{"active-color":"#3F8CFF"},on:{change:function(e){return $.changeConfig(e,"lockSeed")}},model:{value:$.value.lockSeed,callback:function(e){$.$set($.value,"lockSeed",e)},expression:"value.lockSeed"}})],1),$._v(" "),L("div",{directives:[{name:"show",rawName:"v-show",value:!$.isCollapse,expression:"!isCollapse"}],staticClass:"advance-setting-panel-item margin-bottom-20"},[L("el-input-number",{directives:[{name:"show",rawName:"v-show",value:$.value.lockSeed,expression:"value.lockSeed"}],attrs:{placeholder:$.$t("customSeed"),value:$.value.seed,precision:0,controls:!1,min:-1,max:$.seedOptions.max},on:{change:function(e){return $.changeConfig(e,"seed")}}}),$._v(" "),$.showImgSeed?L("div",{staticClass:"seed-temp",on:{click:function(e){return $.useSeed($.value.seedTemp)}}},[$._v("\n        "+$._s($.$t("useImgSeed",{seed:$.value.seedTemp}))+"\n      ")]):$._e()],1),$._v(" "),L("easy-advance-repair-modal",{ref:"repairModal",attrs:{isShowUpscale:$.isShowUpscale,value:$.value},on:{updateData:$.handleUpdateConfig}}),$._v(" "),L("easy-mode-modal",{ref:"modeModal",attrs:{isShowEngineMode:$.isShowEngineMode,value:$.value,isAnimeEnhanceEnable:null===(T=$.easyTop)||void 0===T?void 0:T.isAnimeEnhanceEnable},on:{updateData:$.handleUpdateConfig}})],1)}),[],!1,null,"68f0ae43",null).exports},props:["value"],inject:["easyTop"],data:function(){return{}},mounted:function(){},computed:{showAdditionalPanel:function(){var e,t,n;return!(null!==(e=this.value)&&void 0!==e&&null!==(e=e.ipList)&&void 0!==e&&e.length&&(null===(t=this.value)||void 0===t?void 0:t.art_model_no)===(null==this||null===(n=this.easyTop)||void 0===n?void 0:n.fluxModelId))}},methods:{handleScroll:function(){var e;null!==(e=this.value)&&void 0!==e&&e.prompt&&this.$EventBus.$emit("needCheckInputPackUp")},handleResetParams:function(){var e;this.$logEvent("log_actions",{operation:"click_reset_params",behavior_info:"on_new_create_flow_page"}),null==this||null===(e=this.easyTop)||void 0===e||e.resetConfig(!1,!0);try{this.$refs.generateModePanel.resetData(),this.$EventBus.$emit("resetInputPackUpStatus")}catch(e){}}}}),da=(n(3061),Object(y.a)(ca,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-params-panel",on:{scroll:e.handleScroll}},[t("div",{staticClass:"params-panel-main"},[t("easy-model-panel",e._b({attrs:{value:e.value}},"easy-model-panel",e.$attrs,!1)),e._v(" "),t("easy-additional-panel",{directives:[{name:"show",rawName:"v-show",value:e.showAdditionalPanel,expression:"showAdditionalPanel"}],attrs:{value:e.value}}),e._v(" "),t("easy-generate-mode-panel",{ref:"generateModePanel",model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),e._v(" "),t("easy-advance-setting-panel",{attrs:{value:e.value}})],1),e._v(" "),t("div",{staticClass:"reset-params-box"},[t("div",{staticClass:"reset-params-btn",on:{click:function(t){return t.stopPropagation(),e.handleResetParams.apply(null,arguments)}}},[t("span",{staticClass:"reset-params-btn-icon el-icon-refresh-left"}),e._v(" "),t("span",{staticClass:"reset-params-btn-text"},[e._v(e._s(e.$t("resetAllConfig")))])])])])}),[],!1,null,"5412c5fe",null)),ua=da.exports;function ha(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function pa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ha(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ha(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ma={name:"ToolsPopup",data:function(){return{visible:!1}},computed:pa(pa(pa({},Object(S.c)("user",["cdnHostFun"])),Object(S.c)("user",["isCompanyAccount","isLoggedIn"])),{},{cardList:function(){var e=[{cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("ai-video-generator")),title:"ai_video_generation",subTitle:"ai_video_generation_desc",type:"ai_video_generation",dataLoggingName:"ai_video_generation",path:"ai-video-generator",logType:"ai-video-generator"},{cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("ai-face-swap")),title:"ai_face_changing",subTitle:"ai_face_changing_desc",type:"ai_face_changing",dataLoggingName:"ai_face_changing",path:"ai-face-swap",logType:"ai-face-swap"},{cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("ai-filter")),title:"ai_tools_4",subTitle:"ai_tools_8",type:"ai_filter",dataLoggingName:"ai_filters",path:"ai-filter",logType:"ai-filter"},{cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("ai-dance")),title:"ai_dance_fitting_title",subTitle:"ai_dance_fitting_desc",type:"aiDance",path:"ai-dance",logType:"ai-dance"},{cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("ai-model-fitting")),title:"ai_model_fitting_title",subTitle:"ai_model_fitting_desc",type:"aiModelFitting",path:"ai-model-fitting",logType:"ai-model-fitting"},{cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("remove-background")),title:"ai_tools_2",subTitle:"ai_tools_6",type:"remove_background",dataLoggingName:"remove_background",path:"remove-background",logType:"remove-background"},{source1:"",cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("ai_erase")),title:"ai_erase",subTitle:"ai_erase_tip",type:"ai_erase",dataLoggingName:"",path:"ai_erase",logType:"ai_erase"},{cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("image-upscaler")),title:"upsacler_3_H1",subTitle:"upsacler_4_H1_value",type:"hd_restoration",dataLoggingName:"hd_restoration",path:"image-upscaler",logType:"image-upscaler"},{cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("ai-makeup")),title:"ai_makeup",subTitle:"ai_makeup_desc",type:"ai-makeup",dataLoggingName:"ai-makeup",path:"ai-makeup",logType:"ai-makeup"},{cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("ai-portrait")),title:"ai_tools_10",subTitle:"ai_tools_11",type:"ai_photography",dataLoggingName:"ai_photography",path:"ai-portrait",logType:"ai-portrait"},{cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("scribble2img")),title:"ai_tools_3",subTitle:"ai_tools_7",type:"character_fixes",dataLoggingName:"from_sketch_to_artwork",path:"scribble2img",logType:"scribble2img"},{cover:"https://".concat(this.cdnHostFun()).concat(Object(xe.D)("ai-comic")),title:"ai_comic_fitting_title",subTitle:"ai_comic_fitting_desc",type:"aiComic",path:"ai-comic",logType:"ai-comic"}];return this.isCompanyAccount?e.filter((function(e){return!["ai_photography"].includes(e.type)})):e}}),methods:{jumpUrl:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&null!=e&&e.logType&&this.$logEvent("log_actions",{operation:"click_ai_tools",behavior_info:"on_new_create_flow_page",behavior_info_sub:null==e?void 0:e.logType});var t=this.localePath("/ai-tools/".concat(e.path));["swiftAiMore"].includes(e.code)&&(t=this.localePath("".concat(e.path))),window&&window.open(t,"_blank")},openToolsModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.isLoggedIn)switch(e){case"AnimGen":this.$EventBus.$emit("openEasyAnimeToolsModal");break;case"Upscale":this.$EventBus.$emit("openEasyUpscaleToolsModal")}else this.$EventBus.$emit("openLoginDialog")}}},va=ma,ga=(n(3062),Object(y.a)(va,(function(){var e=this,t=e._self._c;return t("el-popover",{ref:"topBarPopover",attrs:{title:"",trigger:"hover","popper-class":"easy-generate-tools-popup","append-to-body":!0,"visible-arrow":!1},scopedSlots:e._u([{key:"reference",fn:function(){return[e._t("default")]},proxy:!0}],null,!0),model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{staticClass:"tools-popup-title"},[e._v(e._s(e.$t("AI_Tools")))]),e._v(" "),t("div",{staticClass:"tools-popup-menus"},[t("div",{staticClass:"tools-popup-menu-item",on:{click:function(t){return t.stopPropagation(),e.openToolsModal("AnimGen")}}},[t("i",{staticClass:"iconfont icon-AnimGenIcon tools-popup-menu-item-icon"}),e._v("\n      "+e._s(e.$t("AnimGen"))+"\n    ")]),e._v(" "),t("div",{staticClass:"tools-popup-menu-item",on:{click:function(t){return t.stopPropagation(),e.openToolsModal("Upscale")}}},[t("i",{staticClass:"iconfont icon-icon_extraUpscale tools-popup-menu-item-icon"}),e._v("\n      "+e._s(e.$t("taskTabUpscale"))+"\n    ")])]),e._v(" "),t("div",{staticClass:"tools-popup-title"},[e._v(e._s(e.$t("swiftAI")))]),e._v(" "),t("div",{staticClass:"tools-popup-card-list"},e._l(e.cardList,(function(n){return t("div",{key:n.type,staticClass:"tools-popup-card-item",style:"background-image: url(".concat(n.cover,")"),on:{click:function(t){return t.stopPropagation(),e.jumpUrl(n)}}},[t("div",{staticClass:"tools-popup-card-item-info"},[t("div",{staticClass:"card-item-info-title"},[t("span",{staticClass:"card-title-text"},[e._v(e._s(e.$t(n.title)))]),e._v(" "),t("span",{staticClass:"card-title-icon"},[t("i",{staticClass:"el-icon-arrow-right"})])]),e._v(" "),t("div",{staticClass:"card-item-info-sub-title"},[e._v(e._s(e.$t(n.subTitle)))])])])})),0),e._v(" "),t("div",{staticClass:"tools-popup-view-more-btn",on:{click:function(t){return t.stopPropagation(),e.jumpUrl({code:"swiftAiMore",path:"/ai-tools"})}}},[t("span",{staticClass:"tools-popup-view-more-btn-text"},[e._v(e._s(e.$t("viewMore")))]),e._v(" "),t("span",{staticClass:"tools-popup-view-more-btn-icon el-icon-right"})])])}),[],!1,null,null,null).exports),fa={name:"EasyChannelSearch",inject:["easyTop"],"easyTop.channelId":{handler:function(){this.keyword=""},deep:!0,immediate:!0},data:function(){return{keyword:""}},mounted:function(){var e=this;this.$EventBus.$on("clearEasyTaskSearch",(function(){e.keyword="",e.$emit("channelSearch",e.keyword)}))},beforeDestroy:function(){this.$EventBus.$emit("clearEasyTaskSearch")},methods:{handleSearch:function(){this.$emit("channelSearch",this.keyword)},handleChange:function(e){this.$emit("channelSearch",this.keyword)}}},_a=(n(3063),Object(y.a)(fa,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-easy-channel-search"},[t("el-input",{staticClass:"easy-channel-search--input",attrs:{placeholder:e.$t("Search"),clearable:""},on:{change:e.handleChange},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[t("template",{slot:"prefix"},[t("i",{staticClass:"iconfont icon-search search-icon"})])],2)],1)}),[],!1,null,null,null));function ba(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ya(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ba(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ba(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wa={name:"EasyGenerateTopBar",inject:["easyTop"],components:{ToolsPopup:ga,EasyChannelSearch:_a.exports},data:function(){return{formatNumberForeign:k.i,coins:[{name:"credit",icon:n(121),type:"calculateCoins",desc:"new_credit_desc"},{name:"stamina",icon:n(226),type:"tempCoins",desc:"new_stamina_desc",default:this.isLoggedIn?0:150}],enableClassicMode:!1,options:[{code:"generate",label:"创作流"},{code:"workflowApp",label:"快应用"},{code:"character",label:"数字人"}]}},computed:ya(ya(ya(ya({},Object(S.e)("payment",["paymentInfo","activeState","liteActiveState"])),Object(S.c)("user",["isCompanyAccount","isLoggedIn"])),Object(S.e)("user",["token"])),{},{getCoinTitle:function(){var e=this;return function(t){return e.$t(t.type)+"："+e.$t("balance")+" "+(e.paymentInfo[t.type]||0)+", "+e.$t(t.desc)}},isCharacter:function(){var e;return"character"===(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.activeCategory)},isFastApp:function(){var e;return"fast_app"===(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.activeCategory)},isShowSearch:function(){var e;return["model"].includes(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.activeCategory)}}),methods:{handleClick:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.easyTop.switchCategory(null==e?void 0:e.code)},handleChannelSearch:function(e){this.$emit("channelSearch",e)},goTutorial:function(){var link="https://docs.seaart.ai/guide-1";"ja"===this.$i18n.locale&&(link="https://docs.seaart.ai/guide-1/ri-ben-yu"),window.open(link,"_blank")},closePopup:function(){this.$emit("close")},toMall:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.token){this.$logEvent("log_actions",{operation:"subscription_page_show",behavior_info:null!=e&&e.name?e.name:location.href});var t="".concat(location.origin,"/mall?openTab=Credit");window.open(t,"_blank")}else this.$EventBus.$emit("openLoginDialog",{callBack:function(){var e="".concat(location.origin,"/mall?openTab=Credit");window.open(e,"_blank")}})},handleEnableClassicMode:function(e){if(!this.isLoggedIn)return this.$EventBus.$emit("openLoginDialog"),void(this.enableClassicMode=!1);this.$logEvent("log_actions",{operation:"click_switch_model",behavior_info:"on_new_create_flow_page",behavior_info_sub:"open"}),this.$emit("backOld"),this.enableClassicMode=!1}}},Ca=wa,ka=(n(3064),Object(y.a)(Ca,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-easy-generate-top-bar"},[t("div",{staticClass:"top-bar-left"},[t("span",{staticClass:"iconfont icon-goBack top-bar-left-icon",on:{click:function(t){return t.stopPropagation(),e.closePopup()}}}),e._v(" "),t("img",{staticClass:"logo",attrs:{src:n(124),alt:"Avatar"}}),e._v(" "),e._m(0)]),e._v(" "),t("div",{staticClass:"top-bar-main"},[e.isShowSearch?t("div",{staticClass:"top-bar-search"},[t("easy-channel-search",{on:{channelSearch:e.handleChannelSearch}})],1):e._e(),e._v(" "),e.isCharacter||e.isFastApp?e._e():t("tools-popup",[t("div",{staticClass:"tool-btn"},[t("span",{staticClass:"tool-btn-text"},[e._v(e._s(e.$t("AI_Tools")))]),e._v(" "),t("span",{staticClass:"tool-btn-icon el-icon-caret-bottom"})])]),e._v(" "),e.isCompanyAccount?e._e():t("div",{staticClass:"coin-btn"},[e._l(e.coins,(function(n){return[t("el-tooltip",{key:"".concat(n.name,"_coin"),attrs:{"popper-class":"custom-tips-popper",effect:"light",content:e.getCoinTitle(n),placement:"bottom"}},[t("div",{key:n.name,staticClass:"item-coin",class:n.name,on:{click:function(t){return e.toMall(n)}}},[t("img",{staticClass:"icon",attrs:{src:n.icon,alt:n.name}}),e._v(" "),t("div",{staticClass:"number"},[e._v("\n                "+e._s(e.formatNumberForeign(e.paymentInfo[n.type])||0)+"\n              ")])])])]}))],2),e._v(" "),t("div",{staticClass:"guide-btn",on:{click:function(t){return t.stopPropagation(),e.goTutorial()}}},[e._m(1)])],1),e._v(" "),t("div",{staticClass:"top-bar-right"},[t("span",{staticClass:"switch-btn-label"},[e._v(e._s(e.$t("newGenerate36")))]),e._v(" "),t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:e.$t("newGenerate35"),placement:"top-start"}},[t("span",{staticClass:"switch-btn-icon el-icon-question"})]),e._v(" "),t("el-switch",{attrs:{"active-color":"#3F8CFF"},on:{change:e.handleEnableClassicMode},model:{value:e.enableClassicMode,callback:function(t){e.enableClassicMode=t},expression:"enableClassicMode"}})],1)])}),[function(){var e=this,t=e._self._c;return t("span",{staticClass:"top-bar-left-box"},[e._v("SeaArt."),t("span",{staticClass:"top-bar-left-text"},[e._v("Ai")])])},function(){var e=this._self._c;return e("span",{staticClass:"guide-btn-content"},[e("i",{staticClass:"iconfont icon-tutorial"})])}],!1,null,"04e88efe",null).exports),Sa=n(340);function xa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ia(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xa(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Oa={name:"EasyMessageImg",components:{EasyTaskImageViewer:Sa.a,SaveTo:K.a,AiChatCreteConfirm:z.a,commonConfirmModal:un.a,auditDialog:Z.a},inject:["easyTop","easyTaskView"],props:{src:{type:String,required:!0,default:function(){return""}},nsfw:{type:Number,default:2},showSaveFlag:{type:Boolean,default:!1},width:{type:Number,default:100},height:{type:Number,default:100},message:{type:Object,default:function(){return{}}},gridBanner:{type:Object,default:function(){return{}}},operateNumber:{type:Number,default:function(){return 1}},viewStatus:{type:Object,default:function(){return{0:!0,1:!0,2:!0,3:!0,4:!0}}},msgId:{type:String,default:""},loraModels:{type:Object,default:function(){}}},data:function(){return{flag:!0,showMask:!1,loading:!0,loaded:!0,error:!1,dialogVisible:!1,retryCount:0,isShowImage:!0,baseImageWidth:374,imageURLValid:!0,imageUrl:"",canViewNsfw:!1,checked:!1,alreadySave:!1,hoverBtnList:[{code:"upscale",icon:"task-upscale-icon",useText:!0,text:"U",order:2,tips:"WorkUpscale",show:!0,showTypeOptions:[]},{code:"variations",icon:"task-variations-icon",useText:!0,text:"V",order:3,tips:"WorkVariations",show:!0,showTypeOptions:[]},{code:"extraUpscale",icon:"upload-image-icon",useText:!1,order:5,tips:"ExtraUpscale",show:!0,showTypeOptions:[]},{code:"animGen",icon:"AnimGenIcon",useText:!1,order:4,tips:"AnimGen",show:!0,showTypeOptions:[]},{code:"aiGenerateVideo",icon:"a-icon-VideoGeneration",useText:!1,order:6,tips:"ImageToVideoTip",show:!0,showTypeOptions:[]},{code:"chat",icon:"a-home-top-personl1",useText:!1,order:0,tips:"createChartacterToChat",show:!0,showTypeOptions:[]},{code:"removeBackground",icon:"work-remove-background",useText:!1,order:4,tips:"RemoveBackground",show:!0,showTypeOptions:[]},{code:"deleteSingleImg",icon:"moveDeleteTask",useText:!1,order:5,tips:"Delete",show:!1,showTypeOptions:[]}],isShowHoverMask:!1,hide:!1}},computed:Ia(Ia(Ia(Ia({},Object(S.c)(["isSupportWebp"])),Object(S.c)("user",["userInfo","isCompanyAccount","isLoggedIn"])),Object(S.e)("user",["cdnHost"])),{},{getImageRenderAspectRatio:function(){var e,t={},n=(null==this||null===(e=this.message)||void 0===e?void 0:e.components[0])||{},o=n.width,l=n.height,r=this.isAspectRatioExtreme(o,l);return o&&l&&o!==l&&(o<384||l<384||r)&&(t.aspectRatio=o>l?"2/1":"1/2"),t},getMessageInfo:function(){return Object.assign((null==this?void 0:this.message)||[],{img_uris:this.message.components})},showHoverMask:function(){return this.renderList.length&&this.isShowHoverMask},isStudioFlux:function(){var e,t,n,o,l=Array.isArray(null==this||null===(e=this.message)||void 0===e?void 0:e.ckpts)?null==this||null===(t=this.message)||void 0===t?void 0:t.ckpts:[],r=null!=l&&l.length?null===(n=l[0])||void 0===n?void 0:n.id:"";return this.isStudioMode&&(r===this.easyTop.fluxModelId||"sa"===Object(Ue.c)(null==l||null===(o=l[0])||void 0===o?void 0:o.base_model_name))},isShowChat:function(){return!this.hide&&1!=this.nsfw&&!this.isCompanyAccount&&!this.$isChinaSite&&[1,2,7,8,3,13,11,25,4,"1","2","7","8","3","13","11","25","4"].includes(this.message.type)&&[1,5,"1","5",11,"11"].includes(this.message.category)},renderList:function(){var e=JSON.parse(JSON.stringify(this.hoverBtnRenderList)),t=null,n=null,o=null,l=Object(X.chunk)(e,2),r=[],c=[];if(l.length>3){if(r=e.filter((function(e){return"animGen"===e.code?(t=e,!1):"deleteSingleImg"===e.code?(n=e,!1):"chat"!==e.code||(o=e,!1)})),c=Object(X.chunk)(r,2),o&&c[0].unshift(o),n){var d=c.length-1;d<2?(c[2]=[],c[2].push(n)):c[d]&&c[d].push(n)}if(t){var h=1;c.forEach((function(e,i){1==e.length&&(h=c.length<2?i:1)})),c[h]&&c[h].unshift(t)}}else r=e,c=Object(X.chunk)(r,2);return c},getChunkRenderList:function(){var e=this;return function(t){return e.renderList.length&&t<=e.renderList.length-1?e.renderList[t]:[]}},showAnimGen:function(){return![24,"24",25,"25"].includes(this.message.type)&&!this.isSdModel&&!this.isStudioMode},showExtraUpscale:function(){return[1,3,"1","3",7,"7",8,"8",11,23,"23",2,"2",13,"13","25",25].includes(this.message.type)&&!this.isStudioFlux},showUpscale:function(){return[1,3,5,7,8,11,23,25].includes(Number(this.message.type))},showVariations:function(){return[2,13,1,3,7,8,11,23,25,5].includes(this.message.type)},showRemoveBackground:function(){return[2,"2",13,"13"].includes(this.message.type)&&!this.isStudioFlux},isShowBtn:function(){var e,t=4===(null===(e=this.message)||void 0===e?void 0:e.type)?{chat:[!0],aiGenerateVideo:[!0]}:{extraUpscale:[this.showExtraUpscale&&1!==this.nsfw],upscale:[this.showUpscale&&1!==this.nsfw],variations:[this.showVariations&&1!==this.nsfw],removeBackground:[this.showRemoveBackground&&1!==this.nsfw],post:[this.showPostBtn&&1!==this.nsfw],save:[this.isShowSaveTo&&1!==this.nsfw],deleteSingleImg:[this.isMyMsg&&1===this.nsfw],animGen:[this.showAnimGen&&1!==this.nsfw],chat:[this.isShowChat],aiGenerateVideo:[this.isShowChat]};return function(e){return!!Object.keys(t).includes(e)&&t[e].every((function(e){return!!e}))}},covertI18n:function(){var e=this;return function(t){return"upscale"===(null==t?void 0:t.code)?e.isStudioMode?"".concat(e.$t("WorkUpscale")).replace("2048*2048","3072*3072"):e.$t("WorkUpscale"):e.$t(null==t?void 0:t.tips)}},hoverBtnRenderList:function(){var e=this;return this.hoverBtnList.map((function(t){return t.show=e.isShowBtn(t.code),t})).filter((function(e){return e.show}))},isShowNsfwIcon:function(){return this.checkIsShowViewNsfw&&this.isNsfwPlus&&this.isMyMsg},isShowSaveTo:function(){var e,t=this.message.components,n=void 0===t?[]:t;return!!n.length&&(!(null!==(e=n[this.operateNumber-1])&&void 0!==e&&e.is_saved_personal)&&this.isMyMsg&&!this.alreadySave)},isEnableSubmit:function(){return!this.isShowNsfwBg&&!this.error&&!this.loading},isShowNotSelectBox:function(){var e;return!(null!==(e=this.message)&&void 0!==e&&null!==(e=e.banner)&&void 0!==e&&e.is_submit)},selectPostList:function(){var e;return(null==this||null===(e=this.top)||void 0===e?void 0:e.postSelectList)||[]},enableSubmit:function(){var e;return null==this||null===(e=this.top)||void 0===e?void 0:e.enableSubmit},showPostBtn:function(){var e;return(null===(e=this.message)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.is_submit)&&!this.isShowNsfwBg&&this.isMyMsg&&!this.isCompanyAccount},renderUrl:function(){return"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")},getRenderUrl:function(){var e,t=((null===(e=this.message)||void 0===e?void 0:e.components)||[]).findIndex((function(e){return 1!==e.nsfw}));if(-1!==t){var n,o=null===(n=this.message)||void 0===n||null===(n=n.components[t])||void 0===n?void 0:n.url;return(o=o?Object(k.x)(o,"high"):"")||"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")}return"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")},isShowNsfwBg:function(){var e="";return 1===this.nsfw||(e=this.checkIsShowViewNsfw&&this.isMyMsg?this.handleShowNsfwImageUrl():this.isShowImage?this.imageUrl:"",this.renderUrl===e)},isMyMsg:function(){var e,t;return(null===(e=this.message)||void 0===e||null===(e=e.messageInfo)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id)===this.userInfo.id||!(null!==(t=this.message)&&void 0!==t&&t.messageInfo)},isSdModel:function(){var e,t;return[5,"5","sdxl"].includes(null==this||null===(e=this.message)||void 0===e?void 0:e.channel)||[5,"5","sdxl"].includes(null==this||null===(t=this.message)||void 0===t?void 0:t.category)},isStudioMode:function(){var e,t;return["studio",7,"7",11].includes(null==this||null===(e=this.message)||void 0===e?void 0:e.channel)||["studio",7,"7",11].includes(null==this||null===(t=this.message)||void 0===t?void 0:t.category)},isBlur:function(){return 1===this.nsfw||(this.checkIsShowViewNsfw&&this.isMyMsg?(null==this||null===(e=this.message)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.is_nsfw_plus)&&!this.canViewNsfw:1===this.nsfw);var e},isShowHover:function(){var e;return!(!this.checkIsShowViewNsfw||!this.isMyMsg)&&((null==this||null===(e=this.message)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.is_nsfw_plus)&&!this.canViewNsfw)},isNsfwPlus:function(){var e;return(null==this||null===(e=this.message)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.is_nsfw_plus)&&1!==this.nsfw},isShowOperateBtn:function(){return[1,3,"1","3",7,"7",11,8,"8",2,"2",11,"13",13,24,"24","25",25,"4",4].includes(this.message.type)&&!this.isBlur&&!this.error},convertPictureWidthAndHeight:function(){var e=this.message.banner,t=(void 0===e?{}:e)||{},n=t.width,o=void 0===n?200:n,l=t.height,r=void 0===l?200:l,c=Object(B.f)(o,r,this.baseImageWidth);return isNaN(c.height)?{}:{width:"".concat(c.width,"px"),height:"".concat(c.height,"px")}},covertSmallWidth:function(){var e=this.message.banner,t=(void 0===e?{}:e).width;return(void 0===t?0:t)<=200?{minWidth:"".concat(150,"px"),maxWidth:"".concat(150,"px")}:{}},viewImageList:function(){var e=this,t=this.message,n=t.banner,o=void 0===n?{}:n,l=t.components,r=void 0===l?[]:l,c=(t.preprocess_images,t.type),d=void 0===c?"":c;return Array.isArray(r)&&[10,"10"].includes(d)?(J()(r||[])||[]).map((function(e,t){return e.operateNumber=t+1,e})).filter((function(t){return e.checkIsShowViewNsfw&&e.isMyMsg&&e.enableNsfwMode?![1,"1"].includes(t.nsfw)&&e.viewStatus[t.operateNumber]:![1,"1"].includes(t.nsfw)})):Array.isArray(r)&&r.length?(J()(this.message.components||[])||[]).map((function(e,t){return e.operateNumber=t+1,e})).filter((function(t){return e.checkIsShowViewNsfw&&e.isMyMsg&&e.enableNsfwMode?![1,"1"].includes(t.nsfw)&&e.viewStatus[t.operateNumber]:![1,"1"].includes(t.nsfw)})):[Object.assign({},J()(o),{operateNumber:1})]},currentImageIndex:function(){var e,t=this;return-1===(e=this.viewImageList.findIndex((function(e){return e.operateNumber===t.operateNumber})))?0:e},getImageUrl:function(){return this.isShowImage?this.imageUrl:""},checkIsShowViewNsfw:function(){var e;return null==this||null===(e=this.userInfo)||void 0===e?void 0:e.enable_nsfw_plus},enableNsfwMode:function(){var e;return![2,"2"].includes(null==this||null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.nsfw_plus)},getImageManageList:function(){var e;return null==this||null===(e=this.easyTaskView)||void 0===e?void 0:e.manageList}}),mounted:function(){this.canViewNsfw=this.checkIsShowViewNsfw&&this.enableNsfwMode},watch:{src:{handler:function(e){e&&"string"==typeof e&&(this.imageUrl=this.isSupportWebp?Object(k.x)(e,"high"):this.src)},immediate:!0},enableNsfwMode:{handler:function(e,t){t&&t!==e&&(this.flag=!0),this.isMyMsg&&this.flag&&(this.canViewNsfw=this.checkIsShowViewNsfw&&this.enableNsfwMode)},deep:!0,immediate:!0},canViewNsfw:{handler:function(e){this.$emit("viewNsfwStatus",{index:this.operateNumber,canViewNsfw:!this.isMyMsg||this.canViewNsfw,isGrid:!!Object.keys(this.gridBanner||{}).length})},deep:!0,immediate:!0},getImageManageList:{handler:function(e){e&&(this.checked=-1!==this.checkInList())},immediate:!0,deep:!0}},methods:Ia(Ia(Ia({},Object(S.b)("user",["getAccountInfo"])),Object(S.d)("user",["SET_USER_INFO"])),{},{openLogin:function(){this.isLoggedIn||(this.$EventBus.$emit("openLoginDialog"),this.$logEvent("log_actions",{operation:"click_login_now",behavior_info:"on_new_create_flow_page"}))},isAspectRatioExtreme:function(e,t){try{return e/t>=2||t/e>=2}catch(e){return!1}},handleGenerate:function(){this.$emit("copyGenerationData")},handleUpdateModelName:function(e,t){this.$emit("updateModelName",e,t)},handleConfirm:function(){this.showMask=!1,this.handleChat()},handleSaveSuccess:function(){this.$logEvent("log_actions",{operation:"creative_flow_single_picture",behavior_info:"save"}),this.alreadySave=!0,this.$emit("saveSuccess")},handleClickCheck:function(){var e,t=this.checkInList();(null===(e=this.getImageManageList)||void 0===e?void 0:e.length)>=20&&-1===t&&!this.checked?this.$message.warning(this.$t("newGenerate37",{num:20})):(this.checked=!this.checked,this.updateDataToPostSelectList(this.checked))},checkInList:function(){var e=this;try{var t,n={taskId:this.message.id,index:null==this||null===(t=this.message)||void 0===t||null===(t=t.banner)||void 0===t?void 0:t.index,url:this.imageUrl};return(this.getImageManageList||[]).findIndex((function(t){var o,l;return(null==n?void 0:n.url)===(null==t?void 0:t.url)&&(null===(o=e.message)||void 0===o?void 0:o.id)===(null==t?void 0:t.taskId)||(null===(l=e.message)||void 0===l?void 0:l.id)===(null==t?void 0:t.taskId)&&(null==t?void 0:t.index)===(null==n?void 0:n.index)}))}catch(e){}},updateDataToPostSelectList:function(e){var t,n,o={taskId:this.message.id,index:null==this||null===(t=this.message)||void 0===t||null===(t=t.banner)||void 0===t?void 0:t.index,url:this.viewImageList[this.currentImageIndex].url};null==this||null===(n=this.easyTaskView)||void 0===n||n.updateSelectManageList(o)},deleteSingleImg:function(){var e=this;this.$refs.commonConfirmModal.show({subTitle:"deleteConfirm"}).then((function(){e.$emit("deleteSingleImg",e.operateNumber)})).catch((function(e){console.log("err",e)}))},handleCheckChange:function(e){var t=this.checkInList();if(this.selectPostList.length>=20&&-1===t&&e)return this.$message.warning(this.$t("newGenerate37",{num:20})),void(this.checked=!1);this.updateDataToPostSelectList(this.checked)},handleSinglePost:function(){var e,t={taskId:this.message.id,index:null==this||null===(e=this.message)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.index,url:this.viewImageList[this.currentImageIndex].url};this.$logEvent("log_actions",{operation:"click_post_picture_button",behavior_info:"on_creative_flow_hover",behavior_info_sub:t.url}),this.$EventBus.$emit("openCreativeCenterModal",{list:[t],type:"text",source:"task"})},settingViewNsfw:function(){var e;this.$logEvent("log_actions",{operation:"click_NSFW_on_task"}),this.isMyMsg&&(this.enableNsfwMode||1===(null===(e=this.userInfo)||void 0===e?void 0:e.is_audit)?this.applyNsfw(!1):this.$refs.auditDialog.showDialog())},applyNsfw:function(){var e=this;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){var t={};t.nsfw_plus=this.enableNsfwMode?2:1,t.mode=1,t.age_confirm=!0,Object(Q.b)(t).then((function(t){var n=(t||{}).status.code;["10000",1e4].includes(void 0===n?"":n)&&e.$message.success(e.$t(e.enableNsfwMode?"ClosedSuccessfully":"OpenedSuccessfully"))})).finally((function(){e.flag=!1;var data=J()(e.userInfo);data.is_audit=1,e.SET_USER_INFO(data),e.canViewNsfw=!e.canViewNsfw}))}else this.canViewNsfw=!this.canViewNsfw},handleShowNsfwImageUrl:function(){var e;return null!=this&&null!==(e=this.message)&&void 0!==e&&null!==(e=e.banner)&&void 0!==e&&e.is_nsfw_plus&&!this.canViewNsfw?this.renderUrl:this.isShowImage?this.imageUrl:""},onLoad:function(e){this.loading=!1,this.loaded=!0,this.error=!1,this.$EventBus.$emit("needScrollBottom",J()(this.message))},onError:function(){this.loading=!1,this.imageUrl&&(this.imageUrl.includes("_high.webp")||this.imageUrl.includes("_low.webp"))&&(this.imageUrl=this.src),this.reLoadImage(),this.error=!0},reLoadImage:function(){var e=this;this.retryCount>=1||(this.isShowImage=!1,this.retryCount++,this.loading=!0,this.$nextTick((function(){e.isShowImage=!0})))},clickReloadImage:function(){this.retryCount=0,this.error=!1,this.imageUrl=this.isSupportWebp?Object(k.x)(this.src,"high"):this.src,this.reLoadImage()},viewBigImage:function(){var e;1!==this.nsfw&&(this.isShowHover||(null!==(e=this.getImageManageList)&&void 0!==e&&e.length?this.handleClickCheck():this.dialogVisible=!0))},closeViewBigImage:function(){this.dialogVisible=!1},handleContextMenu:function(e){1===this.nsfw&&e.preventDefault()},handleChat:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,d,h,m,v,f,_,y,w,C;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return f={height:(null===(n=e.message)||void 0===n||null===(n=n.banner)||void 0===n?void 0:n.height)||(null===(o=e.message)||void 0===o||null===(o=o.meta)||void 0===o?void 0:o.height),width:(null===(l=e.message)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.width)||(null===(r=e.message)||void 0===r||null===(r=r.meta)||void 0===r?void 0:r.width),id:null===(c=e.message)||void 0===c?void 0:c.id,url:e.imageUrl||(null===(d=e.message)||void 0===d||null===(d=d.banner)||void 0===d?void 0:d.url),source_account_id:(null===(h=e.message)||void 0===h||null===(h=h.messageInfo)||void 0===h||null===(h=h.author)||void 0===h?void 0:h.id)||(null===(m=e.userInfo)||void 0===m?void 0:m.id),channel:"task"},t.next=3,Object(W.D)({channel:"task",source_id:f.id});case 3:if(_=t.sent,y=(null==_?void 0:_.data)||{},w=y.can,2!==(void 0===w?2:w)){t.next=8;break}return e.$message.warning(e.$t("chatFail")),t.abrupt("return");case 8:if(!e.isShowSaveTo||1===e.nsfw){t.next=12;break}return t.next=11,e.handleSave(f);case 11:return t.abrupt("return");case 12:localStorage.setItem("createParams",JSON.stringify(f)),C="/cyberPubPage/".concat(null===(v=e.message)||void 0===v?void 0:v.id,"?quickChat=true&source=work"),window.open(e.localePath(C),"_blank");case 15:case"end":return t.stop()}}),t)})))()},handleSave:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=e.length>0&&void 0!==e[0]?e[0]:null,l=t.message,r=l.id,c=void 0===r?"":r,d=l.components,h=(void 0===d?[]:d)[t.operateNumber-1].index,m=void 0===h?"":h,Object(V.a)({folder_no:"default",id:c,index:m}).then((function(){if(t.handleSaveSuccess(),o){var e;localStorage.setItem("createParams",JSON.stringify(o));var n="/cyberPubPage/".concat(null===(e=t.message)||void 0===e?void 0:e.id,"?quickChat=true&source=work");window.open(t.localePath(n),"_blank")}})).catch((function(e){console.log("saveFail",e)}));case 4:case"end":return n.stop()}}),n)})))()},handleClick:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l=e.length>0&&void 0!==e[0]?e[0]:"",t.handleLogEvent(l),!["deleteSingleImg"].includes(l)){n.next=5;break}return t.deleteSingleImg(),n.abrupt("return");case 5:if(!["post"].includes(l)){n.next=8;break}return t.handleSinglePost(),n.abrupt("return");case 8:if(!["save"].includes(l)){n.next=11;break}return t.$refs.saveToPopover.doShow(),n.abrupt("return");case 11:if(!["chat"].includes(l)){n.next=22;break}return n.next=14,Object(W.D)({channel:"task",source_id:null===(r=t.message)||void 0===r?void 0:r.id});case 14:if(c=n.sent,d=c.data.character_id,void 0===d?"":d){n.next=20;break}t.showMask=!0,n.next=22;break;case 20:return n.next=22,t.handleChat();case 22:if(!["aiGenerateVideo"].includes(l)){n.next=28;break}if(h={cover:t.getImageUrl},h=JSON.stringify(h),t.getImageUrl){n.next=27;break}return n.abrupt("return");case 27:window.open(t.localePath("/ai-tools/ai-video-generator?info=".concat(h)));case 28:t.$emit("imageOperate",l,t.operateNumber,null===(o=t.message)||void 0===o||null===(o=o.banner)||void 0===o?void 0:o.url);case 29:case"end":return n.stop()}}),n)})))()},handleLogEvent:function(e){var t="";switch(e){case"extraUpscale":t="click_optifine";break;case"chat":t="click_chat";break;case"upscale":t="click_superscore";break;case"variations":t="click_variant";break;case"animGen":t="click_animation"}t&&this.$logEvent("log_actions",{operation:t,behavior_info:"on_create_flow_detail_page"})},handleImageOperate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.$emit("imageOperate",e,t.operateNumber,t.url),this.closeViewBigImage()}})},Ta=Oa,$a=(n(3065),n(3066),Object(y.a)(Ta,(function(){var e,t,n=this,o=n._self._c;return o("div",{staticClass:"c-media-attachments-container"},[n.isLoggedIn||n.loading?n._e():o("div",{staticClass:"visitor-mask-box",on:{click:function(e){return n.openLogin()}}},[o("div",{staticClass:"visitor-mask-box-title"},[n._v(n._s(n.$t("loginLookWorks")))]),n._v(" "),o("div",{staticClass:"visitor-mask-box-btn"},[n._v(n._s(n.$t("loginNow")))])]),n._v(" "),o("div",{staticClass:"attachments-wrap",class:[n.checked?"attachments-wrap-checked":"",!n.isLoggedIn&&!n.loading&&"visitor-mask"]},[o("div",{staticClass:"message-attachment-media"},[o("div",{staticClass:"image-content"},[o("div",{staticClass:"image-content-wrap",class:[1===n.nsfw?"image-content-wrap-background":""],style:{"max-width":"".concat(n.baseImageWidth,"px"),"min-width":"".concat(150,"px")}},[o("div",{staticClass:"image-render-box"},[1===n.nsfw?[o("img",{staticClass:"media-attachments-img image-opacity-0",style:n.loading?n.convertPictureWidthAndHeight:n.getImageRenderAspectRatio,attrs:{src:n.getRenderUrl,alt:"",decoding:"async",loading:"lazy"},on:{load:n.onLoad,error:n.onError,contextmenu:function(e){return n.handleContextMenu(e)}}})]:[24!=n.message.type?o("img",{staticClass:"media-attachments-img",class:[n.loading?"":"media-attachments-img-show",n.loading?"image-opacity-0":"",n.isShowNsfwBg?"blurBackground":""],style:n.loading?n.convertPictureWidthAndHeight:n.getImageRenderAspectRatio,attrs:{src:n.getImageUrl,alt:"",decoding:"async",loading:"lazy"},on:{load:n.onLoad,error:n.onError,click:n.viewBigImage,contextmenu:function(e){return n.handleContextMenu(e)}}}):n.getImageUrl?o("video",{class:[n.loading?"image-opacity-0":"",n.isShowNsfwBg?"blurBackground":""],style:{borderRadius:"8px",width:"".concat(n.baseImageWidth,"px"),height:"".concat(parseInt(n.height*n.baseImageWidth/n.width),"px")},attrs:{src:n.getImageUrl,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0},on:{play:function(e){n.loading=!1}}}):n._e()],n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.loading&&1!==n.nsfw,expression:"loading && nsfw !== 1"}],staticClass:"loading-wrapper"},[o("div",{staticClass:"loading-wrapper-inner"},[o("span",{staticClass:"spinner",attrs:{role:"img","aria-label":n.$t("Loading")}},[n._m(0)])])]),n._v(" "),n.isShowNsfwIcon?o("div",{staticClass:"generate-view-nsfw-plus",on:{click:function(e){return e.stopPropagation(),n.settingViewNsfw.apply(null,arguments)}}},[o("i",{staticClass:"iconfont",class:n.canViewNsfw?"icon-work-hide":"icon-work-show"})]):n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.showSaveFlag,expression:"showSaveFlag"}],staticClass:"save-status-flag"},[o("i",{staticClass:"iconfont icon-yibaocun"})]),n._v(" "),n.isEnableSubmit?[o("div",{staticClass:"image-manage-check-btn",class:[n.checked&&"image-manage-check-btn-active",(null===(e=n.getImageManageList)||void 0===e?void 0:e.length)&&"image-manage-check-btn-show"],on:{click:function(e){return e.stopPropagation(),n.handleClickCheck()}}},[o("span",{staticClass:"image-manage-check-btn-icon el-icon-check"})])]:n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.isShowOperateBtn&&!(null!==(t=n.getImageManageList)&&void 0!==t&&t.length)&&n.isShowImage&&n.src&&!n.loading&&![0,"0"].includes(this.operateNumber)||1===n.nsfw,expression:"\n                  (isShowOperateBtn && !getImageManageList?.length &&\n                    isShowImage &&\n                    src &&\n                    !loading &&\n                    ![0, '0'].includes(this.operateNumber)) ||\n                  nsfw === 1\n                "}],staticClass:"image-hover-mask",on:{click:n.viewBigImage}},[o("div",{staticClass:"image-hover-mask-btn-box"},[[n.getChunkRenderList(0).length?[n.getChunkRenderList(0).length>1?o("div",{staticClass:"image-hover-item"},[o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:n.covertI18n(n.getChunkRenderList(0)[0])}},["save"===n.getChunkRenderList(0)[0].code?[o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(0)[0].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(0)[0].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(0)[0].icon)})],2)])]:[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(0)[0].code)}}},[n.getChunkRenderList(0)[0].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(0)[0].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(0)[0].icon)})],2)]],2),n._v(" "),n.getChunkRenderList(0)[1]?o("div",{staticClass:"line-item"}):n._e(),n._v(" "),n.getChunkRenderList(0)[1]?o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"bottom",content:n.covertI18n(n.getChunkRenderList(0)[1])}},["save"===n.getChunkRenderList(0)[1].code?[o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(0)[1].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(0)[1].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(0)[1].icon)})],2)])]:[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(0)[1].code)}}},[n.getChunkRenderList(0)[1].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(0)[1].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(0)[1].icon)})],2)]],2):n._e(),n._v(" "),n.getChunkRenderList(0)[2]?o("div",{staticClass:"line-item"}):n._e(),n._v(" "),n.getChunkRenderList(0)[2]?o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"bottom",content:n.covertI18n(n.getChunkRenderList(0)[2])}},["save"===n.getChunkRenderList(0)[2].code?[o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(0)[2].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(0)[2].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(0)[2].icon)})],2)])]:[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(0)[2].code)}}},[n.getChunkRenderList(0)[2].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(0)[2].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(0)[2].icon)})],2)]],2):n._e()],1):[o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:n.covertI18n(n.getChunkRenderList(0)[0])}},["save"===n.getChunkRenderList(0)[0].code?[o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(0)[0].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(0)[0].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(0)[0].icon)})],2)])]:[o("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(0)[0].code)}}},[n.getChunkRenderList(0)[0].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(0)[0].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(0)[0].icon)})],2)]],2)]]:n._e(),n._v(" "),n.getChunkRenderList(1).length?[n.getChunkRenderList(1).length>1?o("div",{staticClass:"image-hover-item"},[o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:n.covertI18n(n.getChunkRenderList(1)[0])}},["save"===n.getChunkRenderList(1)[0].code?[o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(1)[0].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(1)[0].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(1)[0].icon)})],2)])]:[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(1)[0].code)}}},[n.getChunkRenderList(1)[0].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(1)[0].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(1)[0].icon)})],2)]],2),n._v(" "),n.getChunkRenderList(1)[1]?o("div",{staticClass:"line-item"}):n._e(),n._v(" "),n.getChunkRenderList(1)[1]?o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"bottom",content:n.covertI18n(n.getChunkRenderList(1)[1])}},["save"===n.getChunkRenderList(1)[1].code?[o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(1)[1].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(1)[1].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(1)[1].icon)})],2)])]:[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(1)[1].code)}}},[n.getChunkRenderList(1)[1].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(1)[1].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(1)[1].icon)})],2)]],2):n._e(),n._v(" "),n.getChunkRenderList(1)[2]?o("div",{staticClass:"line-item"}):n._e(),n._v(" "),n.getChunkRenderList(1)[2]?o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"bottom",content:n.covertI18n(n.getChunkRenderList(1)[2])}},["save"===n.getChunkRenderList(1)[2].code?[o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(1)[2].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(1)[2].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(1)[2].icon)})],2)])]:[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(1)[2].code)}}},[n.getChunkRenderList(1)[2].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(1)[2].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(1)[2].icon)})],2)]],2):n._e()],1):[o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:n.covertI18n(n.getChunkRenderList(1)[0])}},["save"===n.getChunkRenderList(1)[0].code?[o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(1)[0].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(1)[0].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(1)[0].icon)})],2)])]:[o("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(1)[0].code)}}},[n.getChunkRenderList(1)[0].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(1)[0].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(1)[0].icon)})],2)]],2)]]:n._e(),n._v(" "),n.getChunkRenderList(2).length?[n.getChunkRenderList(2).length>1?o("div",{staticClass:"image-hover-item"},[o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:n.covertI18n(n.getChunkRenderList(2)[0])}},["save"===n.getChunkRenderList(2)[0].code?[o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(2)[0].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(2)[0].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(2)[0].icon)})],2)])]:[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(2)[0].code)}}},[n.getChunkRenderList(2)[0].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(2)[0].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(2)[0].icon)})],2)]],2),n._v(" "),n.getChunkRenderList(2)[1]?o("div",{staticClass:"line-item"}):n._e(),n._v(" "),n.getChunkRenderList(2)[1]?o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:n.covertI18n(n.getChunkRenderList(2)[1])}},["save"===n.getChunkRenderList(2)[1].code?[o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(2)[1].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(2)[1].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(2)[1].icon)})],2)])]:[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(2)[1].code)}}},[n.getChunkRenderList(2)[1].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(2)[1].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(2)[1].icon)})],2)]],2):n._e(),n._v(" "),n.getChunkRenderList(2)[2]?o("div",{staticClass:"line-item"}):n._e(),n._v(" "),n.getChunkRenderList(2)[2]?o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:n.covertI18n(n.getChunkRenderList(2)[2])}},["save"===n.getChunkRenderList(2)[2].code?[o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(2)[2].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(2)[2].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(2)[2].icon)})],2)])]:[o("span",{staticClass:"image-hover-mask-btn",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(2)[2].code)}}},[n.getChunkRenderList(2)[2].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(2)[2].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(2)[2].icon)})],2)]],2):n._e()],1):[o("el-tooltip",{attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:n.covertI18n(n.getChunkRenderList(2)[0])}},["save"===n.getChunkRenderList(2)[0].code?[n.isShowSaveTo?o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:n.getMessageInfo,operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[n.getChunkRenderList(2)[0].useText?[n._v("\n                                  "+n._s(n.getChunkRenderList(2)[0].text)+"\n                                ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(2)[0].icon)})],2)]):n._e()]:[o("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(e){e.stopPropagation(),n.handleClick(n.getChunkRenderList(2)[0].code)}}},[n.getChunkRenderList(2)[0].useText?[n._v("\n                                "+n._s(n.getChunkRenderList(2)[0].text)+"\n                              ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(n.getChunkRenderList(2)[0].icon)})],2)]],2)]]:n._e()]],2)])],2)]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.error&&!n.loading,expression:"error && !loading"}],staticClass:"image-load-error"},[o("i",{staticClass:"iconfont icon-image-load-error image-load-error-icon"}),n._v(" "),o("span",{staticClass:"image-load-error-text",on:{click:function(e){return e.stopPropagation(),n.clickReloadImage.apply(null,arguments)}}},[n._v(n._s(n.$t("reloadImage")))])])])]),n._v(" "),n.dialogVisible?o("easy-task-image-viewer",{staticClass:"message-img-viewer",staticStyle:{"z-index":"9999"},attrs:{operateNumber:n.operateNumber,nsfw:n.nsfw,"on-close":n.closeViewBigImage,"initial-index":n.currentImageIndex,"show-operate-btn":n.isShowOperateBtn,message:n.getMessageInfo,hoverBtnRenderList:n.hoverBtnRenderList,"url-list":n.viewImageList,msgId:n.message.id,loraModels:n.loraModels},on:{imageOperate:n.handleImageOperate,updateModelName:n.handleUpdateModelName,handleAnimate:function(e){return n.handleClick("animGen")},saveSuccess:n.handleSaveSuccess,copyGenerationData:n.handleGenerate,setLoraModel:function(e){return n.$emit("setLoraModel",e)}}}):n._e()],1),n._v(" "),o("AiChatCreteConfirm",{attrs:{"dialog-visible":n.showMask,source:"task",fromPage:"newTask"},on:{"update:dialogVisible":function(e){n.showMask=e},"update:dialog-visible":function(e){n.showMask=e},confirm:n.handleConfirm}}),n._v(" "),o("common-confirm-modal",{ref:"commonConfirmModal"}),n._v(" "),o("auditDialog",{ref:"auditDialog",on:{confirm:n.applyNsfw}})],1)}),[function(){var e=this._self._c;return e("span",{staticClass:"inner-MGEKwh wanderingCubes-2A046F"},[e("span",{staticClass:"item-2VgEex"}),e("span",{staticClass:"item-2VgEex"})])}],!1,null,"e03dd438",null)),La=$a.exports,Pa={name:"MessageLoraPopup",props:{message:{type:Object,default:function(){return[]}}},data:function(){return{visible:!1}},computed:{getCoverList:function(){var e;return(null==this||null===(e=this.message)||void 0===e?void 0:e.loras)||[]}},methods:{jumpToDetail:function(e){if(null!=e&&e.id){var t=this.localePath("/models/detail/".concat(e.id));window.open(t,"_blank")}}}},Ma=(n(3067),Object(y.a)(Pa,(function(){var e=this,t=e._self._c;return t("el-popover",{ref:"myPopover",attrs:{placement:"bottom-end","popper-class":"easy-message-lora-popup","visible-arrow":!1,trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)},[t("div",{staticClass:"message-lora-popup-body"},e._l(e.getCoverList,(function(n,o){var l,r;return t("div",{key:"lora_pop_".concat(o),staticClass:"message-lora-list-item",on:{click:function(t){return t.stopPropagation(),e.jumpToDetail(n)}}},[t("div",{staticClass:"message-lora-list-item-cover"},[null!=n&&null!==(l=n.banner)&&void 0!==l&&l.url?t("img",{attrs:{src:null==n||null===(r=n.banner)||void 0===r?void 0:r.url,alt:""}}):e._e()]),e._v(" "),t("div",{staticClass:"message-lora-list-item-content"},[t("div",{staticClass:"message-lora-list-item-content-title"},[e._v(e._s(e.$t("LoRA")))]),e._v(" "),t("div",{staticClass:"message-lora-list-item-content-sub-title",attrs:{title:null==n?void 0:n.name}},[e._v(e._s((null==n?void 0:n.name)||""))])])])})),0)])}),[],!1,null,null,null).exports);function ja(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Da(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ja(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ja(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Na={name:"EasyMsgItemHeader",inject:["easyTop"],components:{MessageLoraPopup:Ma},props:{message:{type:Object,default:function(){return{}},required:!0},isShowExpireTime:{type:[Boolean,Number],default:!1},expireTime:{type:String,default:""},isMyMsg:{type:Boolean,default:!1},moreActionsShow:{type:Boolean,default:!1},checkPermission:{type:Boolean,default:!1},checkIsChannelOwner:{type:Boolean,default:!1}},data:function(){return{isI18nToggled:!1,isFoldPrompt:!0,morePopoverVisible:!1,showFoldBtn:!0,isInDownloadTask:!1,pollingTimer:null}},mounted:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.$EventBus.$on("messageItemPromptWidthUpdate",e.handleResize),e.isI18nToggled=!e.accountSettingsData.is_off_localization,e.checkPromptOverflow();case 3:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.$EventBus.$off("messageItemPromptWidthUpdate",this.handleResize),this.pollingTimer&&window.clearTimeout(this.pollingTimer),this.pollingTimer=null,this.isInDownloadTask=!1},computed:Da(Da({},Object(S.c)("user",["accountSettingsData","isCompanyAccount","isLoggedIn"])),{},{allowRefreshOrMoreOperate:function(){return[3,4].includes(this.message.status)},allowRestartOperate:function(){var e,t;return![4,"4","5",5,6,"6",10,"10",2,"2",23,"23",25,"25"].includes(null===(e=this.message)||void 0===e?void 0:e.type)&&[1,"1","2",2,3,"3"].includes(null===(t=this.message)||void 0===t?void 0:t.status)},getFirstLoraName:function(){var e;return(null===(e=this.message)||void 0===e||null===(e=e.loras[0])||void 0===e?void 0:e.name)||""},getCoverList:function(){var e,t=((null===(e=this.message)||void 0===e?void 0:e.loras)||[]).map((function(e){var t;return(null==e||null===(t=e.banner)||void 0===t?void 0:t.url)||""}));return(null==t?void 0:t.length)>3?t.slice(0,3):t},moreActionShow:function(){return[2,4,13].includes(this.message.type)},isStudioMode:function(){return[7,"7","studio",11,"11"].includes(this.message.category)},convertTaskType:function(){var e={1:"Txt2Img",2:"Upscaling",3:"Variations",4:"taskTabUpscale",5:"RemoveBackground",6:"GetDescriptors",7:"TaskUploadImage",8:"conditionToImage",10:"Preview",11:"Expansion",13:"taskTabUpscale",23:"RoopLabel",24:"AnimGen",25:"characterRepair"};return e[this.message.type]?e[this.message.type]:""},setI18nPrompt:function(){var e=this.message.local_prompt,t=this.message.prompt?this.message.prompt:"";return this.isI18nToggled?e:t}}),methods:{handleJumpModelDetail:function(e){if(null!=e&&e.id){var t=this.localePath("/models/detail/".concat(e.id));window.open(t,"_blank")}},handleLogEvent:function(e){this.$logEvent("log_actions",{operation:e,behavior_info:"on_new_create_flow_page",behavior_info_sub:"on_create_flow_topbar"})},handleClickMore:function(){this.handleLogEvent("click_more")},handleResize:function(){this.checkPromptOverflow()},checkPromptOverflow:function(){var e=this;this.$nextTick((function(){try{var element=e.$refs.promptBox;return void(e.isFoldPrompt?e.showFoldBtn=element.scrollWidth>element.clientWidth:e.showFoldBtn=element.offsetHeight>30)}catch(e){}e.showFoldBtn=!0}))},toggleFoldPromptStatus:function(){this.handleLogEvent("click_view_prompt"),this.isFoldPrompt=!this.isFoldPrompt,this.checkPromptOverflow()},toggleI18nPrompt:function(){this.handleLogEvent("click_translate"),this.isI18nToggled=!this.isI18nToggled,this.checkPromptOverflow()},handleSendAll:function(){var e,content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";content&&(null==this||null===(e=this.easyTop)||void 0===e||e.updatePrompt(content)),this.$emit("messageItemPromptWidthUpdate"),this.$emit("resetInputPackUpStatus"),this.$logEvent("log_actions",{operation:"click_copy_prompt",behavior_info:"on_new_create_flow_page"})},handleCopyAll:function(){var content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";content&&(Object(k.d)(content),this.$message.success(this.$t("CopySuccess")))},handleRefreshTask:function(){this.isLoggedIn?(this.handleLogEvent("click_retry"),this.$emit("moreAction","REFRESH_TASK")):this.$EventBus.$emit("openLoginDialog")},handleMoreActionClick:function(){return this.isLoggedIn||this.$EventBus.$emit("openLoginDialog"),!1},handleMoreAction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.isLoggedIn?this.allowRefreshOrMoreOperate&&(this.handleMoreActionLogEvent(e),"DOWNLOAD_ALL"!==e?this.$emit("moreAction",e):this.handleDownloadImages()):this.$EventBus.$emit("openLoginDialog")},handleMoreActionLogEvent:function(e){var t="";switch(e){case"SAVE_ALL":t="click_save_all";break;case"DOWNLOAD_ALL":t="click_download_all";break;case"TASK_INFO":t="click_task_info";break;case"DELETE_ALL":t="click_delete_all"}t&&this.$logEvent("log_actions",{operation:t,behavior_info:"on_new_create_flow_page"})},handleDownloadImages:function(){var e,t,n=this;if(!this.isInDownloadTask){var o={download_task_id:"",items:[]};o.items=((null===(e=this.message)||void 0===e?void 0:e.components)||[]).map((function(e){var t;return{index:e.index,id:null===(t=n.message)||void 0===t?void 0:t.id}})),null!==(t=o.items)&&void 0!==t&&t.length&&(this.isInDownloadTask=!0,Object(dn.g)(o).then((function(e){var t;if(1e4===(null==e||null===(t=e.status)||void 0===t?void 0:t.code)){var o=(null==e?void 0:e.data)||{},l=o.download_task_id,r=void 0===l?"":l;o.url;return n.pollingTask(r)}n.isInDownloadTask=!1})).catch((function(e){n.isInDownloadTask=!1})))}},stopTask:function(){this.pollingTimer&&window.clearTimeout(this.pollingTimer),this.pollingTimer=null,this.isInDownloadTask=!1},pollingTask:function(e){var t=this;return new Promise((function(n,o){t.isInDownloadTask=!0;var l={download_task_id:e,items:[]};t.pollingTimer=setTimeout((function(){Object(dn.g)(l).then((function(l){var r,c;if(1e4!==(null==l||null===(r=l.status)||void 0===r?void 0:r.code))return t.pollingTimer&&window.clearTimeout(t.pollingTimer),t.pollingTimer=null,t.$message.error(t.$t("ServerError")),t.isInDownloadTask=!1,void o();var d=(null==l||null===(c=l.data)||void 0===c?void 0:c.url)||"";["",null,void 0].includes(d)?t.pollingTask(e):(t.pollingTimer&&window.clearTimeout(t.pollingTimer),t.pollingTimer=null,t.isInDownloadTask=!1,t.openDownloadLink(d),t.handleClosePopover(),n())})).catch((function(e){t.$message.error(t.$t("ServerError")),t.isInDownloadTask=!1,o()}))}),1e3)}))},openDownloadLink:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e){var a=document.createElement("a");document.body.appendChild(a),a.style.display="none",a.href=e,a.download="image_download",a.click(),document.body.removeChild(a)}},handleClosePopover:function(){try{this.$refs.myPopover.doClose()}catch(e){}}}},Ea=Na,Ra=(n(3068),n(3069),Object(y.a)(Ea,(function(){var e,t,n,o,l,r,c,d,h,m,v,f,_,y,w,C,k,S=this,x=S._self._c;return x("div",{staticClass:"c-easy-msg-item-header"},[x("div",{staticClass:"msg-item-header-info-panel",class:[S.isFoldPrompt&&"align-items-center"]},[x("div",{staticClass:"msg-item-header-info-panel-tag"},[S._v(S._s(S.$t(S.convertTaskType)))]),S._v(" "),x("div",{staticClass:"msg-item-header-info-panel-prompt-box",class:[S.isFoldPrompt&&"align-items-center"]},[x("div",{ref:"promptBox",staticClass:"info-panel-prompt-box-content",class:[S.isFoldPrompt&&"text-ellipsis"]},[S._v(S._s(S.setI18nPrompt))]),S._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:S.$t("newGenerate67"),placement:"bottom"}},[x("span",{directives:[{name:"show",rawName:"v-show",value:!["",null,void 0].includes(S.setI18nPrompt),expression:"!['',null,void(0)].includes(setI18nPrompt)"}],staticClass:"info-panel-prompt-box-icon iconfont icon-a-icon-TopPrompt",on:{click:function(e){return e.stopPropagation(),S.handleSendAll(S.setI18nPrompt)}}})]),S._v(" "),x("span",{directives:[{name:"show",rawName:"v-show",value:!["",null,void 0].includes(S.setI18nPrompt),expression:"!['',null,void(0)].includes(setI18nPrompt)"}],staticClass:"info-panel-prompt-box-icon iconfont icon-i18n_prompt",on:{click:function(e){return e.stopPropagation(),S.toggleI18nPrompt.apply(null,arguments)}}}),S._v(" "),x("span",{directives:[{name:"show",rawName:"v-show",value:!["",null,void 0].includes(S.setI18nPrompt)&&S.showFoldBtn,expression:"!['',null,void(0)].includes(setI18nPrompt) && showFoldBtn"}],staticClass:"info-panel-prompt-box-icon",class:[S.isFoldPrompt?"iconfont icon-add-tag":"el-icon-minus"],on:{click:function(e){return e.stopPropagation(),S.toggleFoldPromptStatus.apply(null,arguments)}}})],1)]),S._v(" "),x("div",{staticClass:"msg-item-header-operate-bar",class:[!S.isFoldPrompt&&"align-items-flex-start"]},[S._l((null===(e=S.message)||void 0===e?void 0:e.ckpts)||[],(function(e){var t;return[x("div",{staticClass:"operate-bar-model-card",on:{click:function(t){return t.stopPropagation(),S.handleJumpModelDetail(e)}}},[x("el-image",{staticClass:"operate-bar-model-card-img",attrs:{src:null==e||null===(t=e.banner)||void 0===t?void 0:t.url}},[x("template",{slot:"error"},[x("div",{staticClass:"operate-bar-model-card-img"})])],2),S._v(" "),x("div",{staticClass:"operate-bar-model-card-info"},[x("div",{staticClass:"operate-bar-model-card-info-title"},[S._v(S._s(S.$t("Model")))]),S._v(" "),x("div",{staticClass:"operate-bar-model-card-info-sub-title"},[S._v(S._s(null==e?void 0:e.name))])])],1)]})),S._v(" "),x("message-lora-popup",{attrs:{message:S.message}},[null!==(t=S.message)&&void 0!==t&&null!==(t=t.loras)&&void 0!==t&&t.length?x("div",{staticClass:"operate-bar-model-card",class:["operate-bar-model-card-gap-".concat(null===(n=S.getCoverList)||void 0===n?void 0:n.length)]},[S._l(S.getCoverList,(function(e,t){return x("img",{key:"operate-bar-model-card-img-".concat(t),staticClass:"operate-bar-model-card-img",class:["operate-bar-model-card-img-".concat(t)],attrs:{src:e,alt:""}})})),S._v(" "),x("div",{staticClass:"operate-bar-model-card-info"},[x("div",{staticClass:"operate-bar-model-card-info-title"},[S._v(S._s(S.$t("LoRA")))]),S._v(" "),x("div",{staticClass:"operate-bar-model-card-info-sub-title"},[S._v(S._s(S.getFirstLoraName))])])],2):S._e()]),S._v(" "),[3,"3"].includes(null===(o=S.message)||void 0===o?void 0:o.status)?x("div",{directives:[{name:"show",rawName:"v-show",value:!["",null,void 0,0].includes(null===(l=S.message)||void 0===l||null===(l=l.components[0])||void 0===l?void 0:l.width),expression:"!['',null,void(0),0].includes(message?.components[0]?.width)"}],staticClass:"operate-bar-num-card"},[x("span",{staticClass:"operate-bar-num-card-icon iconfont icon-home_icon_lora"}),S._v(" "),x("span",{staticClass:"operate-bar-num-card-text operate-bar-num-card-text-100"},[S._v(S._s("".concat(null===(r=S.message)||void 0===r||null===(r=r.components[0])||void 0===r?void 0:r.width," x ").concat(null===(c=S.message)||void 0===c||null===(c=c.components[0])||void 0===c?void 0:c.height))+"px")])]):S._e(),S._v(" "),S.isMyMsg&&S.isLoggedIn?x("el-popover",{attrs:{trigger:"hover","popper-class":"custom-popver"}},[x("div",{staticClass:"easy-task-info-tips"},[x("p",[x("span",{staticClass:"task-info-tips-label"},[S._v(S._s(S.$t("TaskID")))]),x("span",{staticClass:"task-info-tips-copy",on:{click:function(e){return S.handleCopyAll(S.message.id)}}},[S._v(S._s(S.message.id)+" "),x("i",{staticClass:"iconfont icon-copy-ops"})])]),S._v(" "),3!==S.message.status||S.isCompanyAccount?S._e():[[1,2,"1","2"].includes(null===(d=S.message)||void 0===d?void 0:d.pub_community)?x("p",[x("span",{staticClass:"task-info-tips-label"},[S._v(S._s(S.$t("status")))]),S._v(" "),x("span",{staticClass:"task-pub-status"},[S._v(S._s([2,"2"].includes(null===(h=S.message)||void 0===h?void 0:h.pub_community)?S.$t("createSetting1"):S.$t("createSetting2")))])]):S._e(),S._v(" "),x("p",[x("span",{staticClass:"task-info-tips-label"},[S._v(S._s(S.$t("expend")))]),S._v(" "),x("span",{staticClass:"task-info-tips-content"},[x("span",[S._v(S._s(S.$t("tempCoins"))+" : "+S._s(null===(m=S.message)||void 0===m||null===(m=m.deduction_detail)||void 0===m?void 0:m.temp_hashrate))]),S._v(" "),x("span",[S._v(S._s(S.$t("calculateCoins"))+" : "+S._s(null===(v=S.message)||void 0===v||null===(v=v.deduction_detail)||void 0===v?void 0:v.hashrate))])])]),S._v(" "),null!==(f=S.message)&&void 0!==f&&null!==(f=f.deduction_detail)&&void 0!==f&&f.history_hashrate?x("p",[x("span",{staticClass:"task-info-tips-label"},[S._v(S._s(S.$t("currentBalance")))]),S._v(" "),x("span",{staticClass:"task-info-tips-content"},[x("span",[S._v(S._s(S.$t("tempCoins"))+" : "+S._s(null===(_=S.message)||void 0===_||null===(_=_.deduction_detail)||void 0===_?void 0:_.after_temp_hashrate))]),S._v(" "),x("span",[S._v(S._s(S.$t("calculateCoins"))+" : "+S._s(null===(y=S.message)||void 0===y||null===(y=y.deduction_detail)||void 0===y?void 0:y.after_hashrate))])])]):S._e(),S._v(" "),S.isShowExpireTime?x("p",[x("span",{staticClass:"task-info-tips-label"},[S._v(S._s(S.$t("trainExpirationTime")))]),S._v(" "),x("span",{staticClass:"task-info-tips-text"},[S._v(S._s(S.expireTime))])]):S._e()]],2),S._v(" "),x("div",{staticClass:"msg-item-header-operate-bar-refresh-btn",attrs:{slot:"reference"},slot:"reference"},[x("i",{staticClass:"iconfont icon-icon-information"})])]):S._e(),S._v(" "),S.isLoggedIn?S._e():[x("div",{staticClass:"msg-item-header-operate-bar-refresh-btn",on:{click:function(e){return e.stopPropagation(),S.handleMoreActionClick.apply(null,arguments)}}},[x("i",{staticClass:"iconfont icon-icon-information"})])],S._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:S.allowRestartOperate,expression:"allowRestartOperate"}],staticClass:"msg-item-header-operate-bar-refresh-btn",on:{click:function(e){return e.stopPropagation(),S.handleRefreshTask.apply(null,arguments)}}},[x("i",{staticClass:"iconfont icon-refresh-icon2"})]),S._v(" "),S.isLoggedIn&&S.moreActionsShow&&S.allowRefreshOrMoreOperate&&null!==(w=S.easyTop)&&void 0!==w&&w.isShowPopup?x("el-popover",{ref:"myPopover",attrs:{placement:"bottom-end","popper-class":"easy-msg-item-more-popover","visible-arrow":!1,trigger:"click"},model:{value:S.morePopoverVisible,callback:function(e){S.morePopoverVisible=e},expression:"morePopoverVisible"}},[x("div",{staticClass:"pop-btns flex"},[[3,"3"].includes(null===(C=S.message)||void 0===C?void 0:C.status)?x("button",{on:{click:function(e){return S.handleMoreAction("SAVE_ALL")}}},[x("span",{staticClass:"pop-btns-icon"},[x("i",{staticClass:"iconfont icon-workflow_icon_save"})]),S._v(" "),x("span",{staticClass:"pop-btns-text"},[S._v(S._s(S.$t("newGenerate13")))])]):S._e(),S._v(" "),[3,"3"].includes(null===(k=S.message)||void 0===k?void 0:k.status)?x("button",{on:{click:function(e){return S.handleMoreAction("DOWNLOAD_ALL")}}},[x("span",{staticClass:"pop-btns-icon"},[x("i",{class:[S.isInDownloadTask?"el-icon-loading":"iconfont icon-icon-Download"]})]),S._v(" "),x("span",{staticClass:"pop-btns-text"},[S._v(S._s(S.$t("newGenerate14")))])]):S._e(),S._v(" "),x("button",{on:{click:function(e){return S.handleMoreAction("TASK_INFO")}}},[x("span",{staticClass:"pop-btns-icon"},[x("i",{staticClass:"iconfont icon-icon-information"})]),S._v(" "),x("span",{staticClass:"pop-btns-text"},[S._v(S._s(S.$t("newGenerate15")))])]),S._v(" "),S.checkPermission||S.checkIsChannelOwner?x("button",{on:{click:function(e){return S.handleMoreAction("DELETE_ALL")}}},[x("span",{staticClass:"pop-btns-icon"},[x("i",{staticClass:"iconfont icon-a-pyDelete1"})]),S._v(" "),x("span",{staticClass:"pop-btns-text"},[S._v(S._s(S.$t("DeleteAll")))])]):S._e()]),S._v(" "),x("div",{staticClass:"msg-item-header-operate-bar-more-btn",attrs:{slot:"reference"},on:{click:S.handleClickMore},slot:"reference"},[x("i",{staticClass:"iconfont icon-more"})])]):S._e(),S._v(" "),S.isLoggedIn?S._e():[x("div",{staticClass:"msg-item-header-operate-bar-more-btn",attrs:{slot:"reference"},on:{click:function(e){return e.stopPropagation(),S.handleMoreActionClick.apply(null,arguments)}},slot:"reference"},[x("i",{staticClass:"iconfont icon-more"})])]],2)])}),[],!1,null,"3e7769f5",null)),Aa=Ra.exports;function Ba(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ua(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ba(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ba(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fa={name:"EasyMetaTooltip",props:{meta:{type:Object,require:!0,default:function(){return{}}},message:{type:Object,default:function(){return{}}},sourceFrom:{type:String,default:""},model:{type:String,default:""},modelName:{type:String,default:""},category:{type:[String,Number],default:1},msgId:{type:String,default:""},loraModels:{type:Object,default:function(){}},showCreate:{type:Boolean,default:!0}},filters:{formatDateTime:function(e){var t=new Date(e),n=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),r=t.getHours().toString().padStart(2,"0"),c=t.getMinutes().toString().padStart(2,"0"),d=t.getSeconds().toString().padStart(2,"0");return Object(k.u)(t,new Date)?"".concat(r,":").concat(c,":").concat(d):"".concat(n,"/").concat(o,"/").concat(l," ").concat(r,":").concat(c,":").concat(d)}},data:function(){return{intLoraModel:[],loading:!1}},computed:Ua(Ua(Ua(Ua({},Object(S.c)("user",["isLoggedIn"])),Object(S.e)("creation",["generateViewShow"])),Object(S.c)("creation",["studioStyle","lab_styles"])),{},{getModelList:function(){var e,t,n,o=(null===(e=this.message)||void 0===e?void 0:e.art_model)||{};o=Ua(Ua({},o),{},{type:"Checkpoint"});var l=((null===(t=this.message.meta)||void 0===t?void 0:t.lora_models)||[]).map((function(e){return Ua(Ua(Ua({},e),(null==e?void 0:e.art_model)||{}),{},{type:"LORA"})}));return o&&null!==(n=o)&&void 0!==n&&n.id?[o].concat(Object(R.a)(l)):l},convertTaskType:function(){var e={1:"Txt2Img",2:"Upscaling",3:"Variations",4:"taskTabUpscale",5:"RemoveBackground",6:"GetDescriptors",7:"TaskUploadImage",8:"conditionToImage",10:"Preview",11:"Expansion",13:"taskTabUpscale",23:"RoopLabel",24:"AnimGen",25:"characterRepair"};return e[this.message.type]?e[this.message.type]:""},isSdModel:function(){return[5,"5","sdxl"].includes(null==this?void 0:this.category)},isStudioFlux:function(){var e,t=(null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[];return this.model===xe.h||t.includes(null===(e=this.message)||void 0===e||null===(e=e.ckpts)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.base_model_name)},isStudioModel:function(){return[7,"7","studio",11].includes(null==this?void 0:this.category)},studioRenderList:function(){var e=this;return(this.lab_styles||[]).map((function(t){var n="labStyle_".concat(t.value.replace(/\s/g,""));return{label:e.$t(n)||t.value,id:t.value}}))},getStudioStyle:function(){var e,t=(null===(e=this.meta)||void 0===e||null===(e=e.lab_base)||void 0===e?void 0:e.style_selections)||[];return(this.studioRenderList||[]).filter((function(e){return t.includes(e.id)})).map((function(e){return e.label})).join("、")||""}}),mounted:function(){this.msgId&&this.getMsgInfo()},methods:{handleCopyAll:function(){var content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";["",null,void 0].includes(content)||(this.$logEvent("log_actions",{operation:"click_copy",behavior_info:"on_new_create_flow_page",behavior_info_sub:"on_task_info"}),Object(k.d)(content),this.$message.success(this.$t("CopySuccess")))},getMsgInfo:function(){var e=this;this.loading=!0;var t=0===Object.keys(this.loraModels).length,n=["",null,void 0].includes(this.modelName),o=![this.loraModels&&this.loraModels[this.msgId]];[t,n,o].some((function(e){return e}))?Object(A.h)({id:this.msgId,task_flow_version:"v2"}).then((function(n){var o,l;if(1e4===n.status.code){e.intLoraModel=(null===(o=n.data.meta)||void 0===o?void 0:o.lora_models)||[];var r=(null==n||null===(l=n.data)||void 0===l?void 0:l.art_model_name)||"",c={};c[e.msgId]=e.intLoraModel,["",null,void 0].includes(e.modelName)&&e.$emit("updateModelName",r,null==n?void 0:n.data),t&&e.$emit("setLoraModel",c)}})).finally((function(){e.loading=!1})):this.loading=!1,this.intLoraModel&&!this.intLoraModel.length&&(this.intLoraModel=this.loraModels[this.msgId]||[])},handleClick:function(){this.$logEvent("log_actions",{operation:"click_retry",behavior_info:"on_new_create_flow_page",behavior_info_sub:"on_task_info"}),this.$emit("copyGenerationData",{model:this.model,meta:this.meta})},openLora:function(e){window.open("/models/detail/"+e.art_model.id)},handleJumpDetail:function(e){["",null,void 0].includes(null==e?void 0:e.id)||window.open("/models/detail/".concat(null==e?void 0:e.id),"_blank")}}},za=Fa;n(3070);function Va(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var Wa={name:"EasyTaskInfoPopup",components:{EasyMetaTooltip:Object(y.a)(za,(function(){var e,t,n,o,l,r,c,d,h,m,v,f,_,y,w=this,C=w._self._c;return C("div",{directives:[{name:"loading",rawName:"v-loading",value:w.loading,expression:"loading"}],staticClass:"easy-tooltip-wraper"},[null!==(e=w.meta)&&void 0!==e&&e.prompt?C("div",[C("div",{staticClass:"easy-tooltip-wraper-title"},[C("span",{staticClass:"easy-tooltip-wraper-title-text"},[w._v(w._s(w.$t("Prompt")))]),w._v(" "),C("span",{directives:[{name:"show",rawName:"v-show",value:null===(t=w.meta)||void 0===t?void 0:t.prompt,expression:"meta?.prompt"}],staticClass:"easy-tooltip-wraper-title-icon iconfont icon-codeCopy1",on:{click:function(e){var t;return e.stopPropagation(),w.handleCopyAll(null===(t=w.meta)||void 0===t?void 0:t.prompt)}}})]),w._v(" "),C("div",{staticClass:"promptDesc"},[w._v("\n      "+w._s(null===(n=w.meta)||void 0===n?void 0:n.prompt)+"\n    ")])]):w._e(),w._v(" "),null!==(o=w.meta)&&void 0!==o&&o.negative_prompt?C("div",[C("div",{staticClass:"easy-tooltip-wraper-title"},[C("span",{staticClass:"easy-tooltip-wraper-title-text"},[w._v(w._s(w.$t("NegativePrompts")))]),w._v(" "),C("span",{directives:[{name:"show",rawName:"v-show",value:null===(l=w.meta)||void 0===l?void 0:l.negative_prompt,expression:"meta?.negative_prompt"}],staticClass:"easy-tooltip-wraper-title-icon iconfont icon-codeCopy1",on:{click:function(e){var t;return e.stopPropagation(),w.handleCopyAll(null===(t=w.meta)||void 0===t?void 0:t.negative_prompt)}}})]),w._v(" "),C("div",{staticClass:"promptDesc"},[w._v("\n      "+w._s(null===(r=w.meta)||void 0===r?void 0:r.negative_prompt)+"\n    ")])]):w._e(),w._v(" "),C("div",{staticClass:"easy-tooltip-wraper-params-box"},[C("div",{staticClass:"easy-tooltip-params-item"},[C("div",{staticClass:"easy-tooltip-params-item-title"},[w._v(w._s(w.$t("newGenerate27")))]),w._v(" "),C("div",{staticClass:"easy-tooltip-params-item-content"},[w._v(w._s(w.$t(w.convertTaskType)))])]),w._v(" "),C("div",{staticClass:"easy-tooltip-params-item"},[C("div",{staticClass:"easy-tooltip-params-item-title"},[w._v(w._s(w.$t("newGenerate26")))]),w._v(" "),C("div",{staticClass:"easy-tooltip-params-item-content"},[w._v(w._s(w._f("formatDateTime")(w.message.create_at)))])]),w._v(" "),C("div",{staticClass:"easy-tooltip-params-item"},[C("div",{staticClass:"easy-tooltip-params-item-title"},[w._v(w._s(w.$t("imageDimensions")))]),w._v(" "),C("div",{staticClass:"easy-tooltip-params-item-content"},[w._v(w._s("".concat(null===(c=w.message)||void 0===c||null===(c=c.components[0])||void 0===c?void 0:c.width," x ").concat(null===(d=w.message)||void 0===d||null===(d=d.components[0])||void 0===d?void 0:d.height))+" px")])]),w._v(" "),C("div",{staticClass:"easy-tooltip-params-item"},[C("div",{staticClass:"easy-tooltip-params-item-title"},[w._v(w._s(w.$t("Seed")))]),w._v(" "),C("div",{staticClass:"easy-tooltip-params-item-content"},[w._v(w._s(null===(h=w.meta)||void 0===h?void 0:h.seed))])]),w._v(" "),C("div",{directives:[{name:"show",rawName:"v-show",value:!w.isStudioFlux,expression:"!isStudioFlux"}],staticClass:"easy-tooltip-params-item"},[C("div",{staticClass:"easy-tooltip-params-item-title"},[w._v(w._s(w.$t("Sampler")))]),w._v(" "),C("div",{staticClass:"easy-tooltip-params-item-content"},[w._v(w._s(null===(m=w.meta)||void 0===m?void 0:m.sampler_name))])]),w._v(" "),C("div",{directives:[{name:"show",rawName:"v-show",value:!w.isStudioFlux,expression:"!isStudioFlux"}],staticClass:"easy-tooltip-params-item"},[C("div",{staticClass:"easy-tooltip-params-item-title"},[w._v(w._s(w.$t("Steps")))]),w._v(" "),C("div",{staticClass:"easy-tooltip-params-item-content"},[w._v(w._s(null===(v=w.meta)||void 0===v?void 0:v.steps))])]),w._v(" "),C("div",{directives:[{name:"show",rawName:"v-show",value:!w.isStudioFlux,expression:"!isStudioFlux"}],staticClass:"easy-tooltip-params-item"},[C("div",{staticClass:"easy-tooltip-params-item-title"},[w._v(w._s(w.$t("CFGScale")))]),w._v(" "),C("div",{staticClass:"easy-tooltip-params-item-content"},[w._v(w._s(null===(f=w.meta)||void 0===f?void 0:f.cfg_scale))])]),w._v(" "),C("div",{directives:[{name:"show",rawName:"v-show",value:!w.isStudioFlux,expression:"!isStudioFlux"}],staticClass:"easy-tooltip-params-item"},[C("div",{staticClass:"easy-tooltip-params-item-title"},[w._v(w._s(w.$t("clipSkip")))]),w._v(" "),C("div",{staticClass:"easy-tooltip-params-item-content"},[w._v(w._s((null===(_=w.meta)||void 0===_?void 0:_.clip_skip)||""))])])]),w._v(" "),null!==(y=w.getModelList)&&void 0!==y&&y.length?C("div",{directives:[{name:"show",rawName:"v-show",value:!w.loading,expression:"!loading"}],staticClass:"easy-tooltip-wraper-model-box"},w._l(w.getModelList,(function(e,t){var n;return C("div",{key:"model_i_".concat(t),staticClass:"easy-tooltip-wraper-model-box-item"},[C("div",{staticClass:"easy-tooltip-wraper-model-box-item-cover"},[C("img",{attrs:{src:null==e||null===(n=e.banner)||void 0===n?void 0:n.url,alt:""}})]),w._v(" "),C("div",{staticClass:"easy-tooltip-wraper-model-box-item-content",on:{click:function(t){return t.stopPropagation(),w.handleJumpDetail(e)}}},[C("div",{staticClass:"easy-tooltip-model-box-model-type-box"},[C("span",{staticClass:"easy-tooltip-model-box-model-type"},[w._v(w._s(w.$t(null==e?void 0:e.type)))])]),w._v(" "),C("div",{staticClass:"easy-tooltip-model-box-model-name",attrs:{title:null==e?void 0:e.name}},[w._v(w._s((null==e?void 0:e.name)||""))])])])})),0):w._e(),w._v(" "),w.showCreate?C("div",{staticClass:"easy-meta-tooltip-divider-line"}):w._e(),w._v(" "),w.showCreate?C("div",{staticClass:"copyClass",on:{click:w.handleClick}},[w._v("\n    "+w._s(w.$t("Generate"))+"\n  ")]):w._e()])}),[],!1,null,"c2c71024",null).exports},props:{message:{type:Object,default:function(){return{}}},loraModeObj:{type:Object},isMyMsg:{type:Boolean,default:!1},isShowExpireTime:{type:[Boolean,Number],default:!1},expireTime:{type:String,default:""}},data:function(){return{visible:!1}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Va(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Va(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(S.c)("user",["isCompanyAccount"])),methods:{show:function(){this.visible=!0},handleClose:function(){this.visible=!1,this.$emit("close")},handleUpdateModelName:function(e,t){this.$emit("updateModelName",e,t)},handleCopyGenerationData:function(){this.$emit("copyGenerationData")},setLoraModel:function(e){this.$emit("setLoraModel",e)},handleCopyAll:function(){var content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";["",null,void 0].includes(content)||(Object(k.d)(content),this.$message.success(this.$t("CopySuccess")))}}},Ha=Wa,qa=(n(3071),Object(y.a)(Ha,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,"custom-class":"easy-task-info-popup","destroy-on-close":!1,"close-on-press-escape":!0,modal:!1,"modal-append-to-body":"","append-to-body":"",width:"322px"},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"easy-task-info-popup-header"},[t("div",{staticClass:"modal-header-title"},[t("span",{staticClass:"modal-header-title-text"},[e._v(e._s(e.$t("newGenerate15")))])]),e._v(" "),t("span",{staticClass:"modal-header-close",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[t("i",{staticClass:"el-icon-close"})])]),e._v(" "),e.visible?t("div",{staticClass:"easy-task-info-popup-content"},[t("easy-meta-tooltip",{attrs:{meta:e.message.meta,msgId:e.message.id,loraModels:e.loraModeObj,model:e.message.art_model_no,category:e.message.category,message:e.message,"model-name":e.message.art_model_name},on:{updateModelName:e.handleUpdateModelName,copyGenerationData:e.handleCopyGenerationData,setLoraModel:e.setLoraModel}})],1):e._e()])}),[],!1,null,null,null).exports);function Ga(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ja(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ga(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ga(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ka=n(124),Xa={name:"EasyMsgItem",mixins:[ce.a],inject:["easyTop"],props:{message:{type:Object,default:function(){return{}},required:!0},showTime:{type:Boolean,default:!1},taskFrom:{type:String,default:function(){return""}},channelId:{type:String,default:function(){return""}}},components:{MessageImg:La,MessageOperateBtn:le,MetaTooltipVue:re.a,SwipeList:he.a,EasyMsgItemHeader:Aa,EasyTaskInfoPopup:qa,commonConfirmModal:un.a},filters:{formatDateTime:function(e,t){var n=new Date(e),o=["zhCN","zhTw"].includes(t.$i18n.locale)?"zh-CN":"en-US",l="zh-CN"===o?{weekday:"short",year:"numeric",month:"long",day:"numeric"}:{weekday:"long",day:"numeric",month:"long",year:"numeric"},r=new Intl.DateTimeFormat(o,l).format(n);return"zh-CN"===o&&(r=(r||"").replace(/(日)([^0-9]+)/,"$1 $2")),r}},computed:Ja(Ja(Ja(Ja({},Object(S.c)(["isSupportWebp"])),Object(S.c)("user",["accountSettingsData","userInfo","isCompanyAccount"])),Object(S.e)("payment",["paymentInfo"])),{},{isVip:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},isShowExpireTime:function(){var e=this.message.expiration_time;return!this.alreadySave&&e&&e>0},getExpireTime:function(){var e=this.message.expiration_time,t=(new Date).getTime();if(e&&e>t){var n=e-t,o=Math.floor(n/864e5);return o?this.$t("TaskExpireTime",{param:o}):this.$t("ExpiresSoon")}return this.$t("TaskExpireTime",{param:0})},isStudioMode:function(){return[7,"7","studio",11,"11"].includes(this.message.category)},showTaskMode:function(){return[1,2,3,4,5,7,8,13].includes(this.message.type)},convertTaskMode:function(){var e={1:"createModeType1",2:"createModeType2",6:"createModeType6",4:"createModeType4",5:"createModeType5",7:"studio",11:"studio"};return e[this.message.category]?e[this.message.category]:""},moreActionsShow:function(){return[!["",null,void 0].includes(this.message.pub_artwork_no),!["",null,void 0].includes(this.message.pub_artwork_no)&&![4,"4"].includes(this.message.type),this.checkPermission||this.checkIsChannelOwner].some((function(e){return!!e}))},setI18nPrompt:function(){var e=this.message.local_prompt,t=this.message.meta?this.message.meta.prompt:"";return this.isI18nToggled?e:t},computedPercentage:function(){return function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).process;return void 0===e?0:e}},convertStatusText:function(){var e={userCancelDesc:this.$t("userCancel"),sysCancelDesc:this.$t("systemCancel"),sysTimeoutDesc:this.$t("systemTimeoutCancel")};return this.message.status_desc?e[this.message.status_desc]:""},checkBtnStatus:function(){var e=this;return function(t){var n={disabled:!1,loading:!1};return e.currentClickBtn===t?(n.loading=!0,n.disabled=!1,n):(e.currentClickBtn&&e.currentClickBtn!==t&&(n.loading=!1,n.disabled=!0),n)}},checkBtnIsNSFW:function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!1;try{var o,l,r=this.message.type||1;if([2,"2"].includes(r))n=!(null===(o=this.message)||void 0===o||null===(o=o.components)||void 0===o||!o.length)&&[1,"1"].includes(null===(l=this.message)||void 0===l?void 0:l.components[0].nsfw);if([1,"1",3,"3"].includes(r)){var c,d,h=!(null===(c=this.message)||void 0===c||!c.components||null===(d=this.message)||void 0===d||null===(d=d.components)||void 0===d||!d.length)&&this.message.components[t-1];n=h&&[1,"1"].includes(h.nsfw)}}catch(e){}return n}},getImageUrl:function(){var e,t,n,o,l,r="";return null!==(e=this.message)&&void 0!==e&&null!==(e=e.components)&&void 0!==e&&e.length&&!["",null,void 0].includes(null===(t=this.message)||void 0===t||null===(t=t.components[0])||void 0===t?void 0:t.url)?r=this.isSupportWebp&&![6,"6"].includes(this.message.type)?Object(k.x)(null===(o=this.message)||void 0===o?void 0:o.components[0].url,"high"):null===(l=this.message)||void 0===l?void 0:l.components[0].url:!![10,"10"].includes(this.message.type)||(!(![24,"24"].includes(this.message.type)||null===(n=this.message)||void 0===n||null===(n=n.components)||void 0===n||!n.length)||r)},getGridImageUrl:function(){return function(e){var t="";return e&&!["",null,void 0].includes(e.url)?t=e.url:t}},moreActionShow:function(){return[2,4,13].includes(this.message.type)},convertTaskType:function(){var e={1:"Txt2Img",2:"Upscaling",3:"Variations",4:"taskTabUpscale",5:"RemoveBackground",6:"GetDescriptors",7:"TaskUploadImage",8:"conditionToImage",10:"Preview",11:"Expansion",13:"taskTabUpscale",23:"RoopLabel",24:"AnimGen",25:"characterRepair"};return e[this.message.type]?e[this.message.type]:""},checkBtnClicked:function(){return function(e,t){var n=this.message.operation,o=void 0===n?[]:n;if(!o||!o.length)return!1;var l=(o||[]).filter((function(e){return[2,"2"].includes(e.action)})).map((function(e){return e.number})),r=(o||[]).filter((function(e){return[3,"3"].includes(e.action)})).map((function(e){return e.number})),c=(o||[]).filter((function(e){return[4,"4"].includes(e.action)})).map((function(e){return e.number})),d=!1;switch(e){case"U":d=-1!==l.indexOf(t);break;case"V":d=-1!==r.indexOf(t);break;case"reStart":d=!!c.length}return d}},imagePromptList:function(){return this.isI18nToggled?Array.isArray(this.message.reverse_local_prompts)?this.message.reverse_local_prompts:[]:Array.isArray(this.message.reverse_prompts)?this.message.reverse_prompts:[]},getImageInfo:function(){return function(e){return Object.assign(J()(this.message),{banner:e})}},checkPermission:function(){var e=!1;this.message.type;return this.message.sender_id&&this.message.sender_id===this.userInfo.id?e=!0:(this.isPrivateChannel&&(e=!0),e)},checkIsChannelOwner:function(){var e;return this.message.sender_id&&(null==this||null===(e=this.top)||void 0===e||null===(e=e.channelInfo)||void 0===e?void 0:e.owner_id)===this.userInfo.id},isPrivateChannel:function(){return["PRIVATE"].includes(this.channelId)},getAuthorName:function(){var e,t="",n=null===(e=this.message)||void 0===e||null===(e=e.messageInfo)||void 0===e?void 0:e.author;return t=n?n.name||n.id:"",t=["",null,void 0].includes(t)?"":"@".concat(t)},isMyMsg:function(){var e,t;return(null===(e=this.message)||void 0===e||null===(e=e.messageInfo)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id)===this.userInfo.id||!(null!==(t=this.message)&&void 0!==t&&t.messageInfo)},isShowCancel:function(){var e=this.message,t=e.status,n=e.category,o=e.type,l=![4,"4"].includes(t),r=![4,5,6,10,11,13,23,"23"].includes(o);return l&&![3,"3"].includes(n)&&this.checkPermission&&r},isShowFaster:function(){var e=this.message,t=e.status,n=e.speed_type;return 1==t&&1===n&&!this.hasAccelerated}}),watch:{accountSettingsData:{handler:function(e){this.isI18nToggled=!e.is_off_localization},deep:!0},message:{handler:function(e){var t=this;this.$nextTick((function(){t.isLoading=!!e.isLoading,t.currentClickBtn=e.loadingBtn||""}))},deep:!0,immediate:!0}},data:function(){return{defaultAvatar:Ka,customColor:"#2E9E60",isLoading:!1,isPosting:!1,currentClickBtn:"",isI18nToggled:!1,morePopoverVisible:!1,reportLoading:!1,mapObj:{0:!0,1:!0,2:!0,3:!0,4:!0},trailBtnLoading:!1,hasAccelerated:!1,alreadySave:!1,metaTooltipShow:!1,loraModeObj:{},checkpoiontNameObj:{},isInSave:!1}},mounted:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.isI18nToggled=!e.accountSettingsData.is_off_localization;case 1:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.mapObj={}},methods:{handleMoreAction:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""){case"TASK_INFO":this.$refs.easyTaskInfoPopup.show();break;case"REFRESH_TASK":this.handleReStart();break;case"DELETE_ALL":this.isPrivateChannel?this.handleDeleteTask():this.handleDeleteMessage();break;case"SAVE_ALL":this.saveToSever()}},saveToSever:function(){var e=this;if(!this.isInSave){var t={};t.items=(this.message.components||[]).filter((function(e){return 1!==(null==e?void 0:e.nsfw)})).map((function(t){var n;return{folder_no:"default",id:null===(n=e.message)||void 0===n?void 0:n.id,index:t.index}})),this.isInSave=!0,Object(dn.c)(t).then((function(){e.$message.success(e.$t("SaveSuccess")),e.alreadySave=!0,e.$emit("saveSuccess"),e.handleClosePopover()})).finally((function(){e.isInSave=!1}))}},handleClosePopover:function(){try{this.$refs.easyMsgHeader.handleClosePopover()}catch(e){}},handleAutoGenerate:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";null==this||null===(e=this.easyTop)||void 0===e||e.handleGenerateByPrompt(t)},expireClick:function(){var e=(this.paymentInfo||{}).vipType,t=["svip_1","svip_2","svip_1_trial","svip_2_trial","vip_lite"].includes(e)||e.includes("vip_day");this.isVip?t&&this.$EventBus.$emit("showUpgradeDialog","NoExpireTimeTipWeb","professional"):this.$EventBus.$emit("showBreakDialog","ExpireTimeTipWeb","basic")},handleUpdateModelName:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(["",null,void 0].includes(this.modelName)&&this.$set(this.message,"art_model_name",e),t){var n,o,l={};l.meta=(null==t?void 0:t.meta)||{},l.art_model=(null==t?void 0:t.art_model)||{},this.$set(this.message,"art_model",Object.assign({},(null===(n=this.message)||void 0===n?void 0:n.art_model)||{},l.art_model)),this.$set(this.message,"meta",Object.assign({},(null==this||null===(o=this.message)||void 0===o?void 0:o.meta)||{},l.meta))}},setLoraModel:function(e){this.loraModeObj=Object.assign(this.loraModeObj,e)},deleteSingleImg:function(e){var t=this,n=this.message,o=n.id,l=void 0===o?"":o,r=n.components,c=(void 0===r?[]:r)[e-1].index,d=void 0===c?"":c;Object(V.b)({id:l,index:d}).then((function(){var e;t.$logEvent("log_actions",{operation:"creative_flow_single_picture",behavior_info:"delete"}),t.$message({message:t.$t("deleteSuccess"),type:"success"}),t.message.components=t.message.components.filter((function(e){return e.index!=d})),null!==(e=t.message)&&void 0!==e&&null!==(e=e.components)&&void 0!==e&&e.length||t.$emit("operate",{type:"deleteTask",info:t.message})}))},handleNsfwStatus:function(e){var t=e.index,n=e.canViewNsfw;this.$set(this.mapObj,t,n)},autoResizeScrollBtn:function(){var e=this;this.$nextTick((function(){try{var t;null==e||null===(t=e.$refs)||void 0===t||t.swipeList.setMoveBtnShow()}catch(e){}}))},toUserPage:function(e){var t,n=null===(t=this.message)||void 0===t||null===(t=t.messageInfo)||void 0===t?void 0:t.author;e=n?n.id:"",["",null,void 0].includes(e)||this.$router.push("/user/"+e)},moreActions:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""){case"report":this.reportArtwork();break;case"collect":this.message&&this.message.collect?this.unFavorite():this.handleCollect();break;case"shareLink":this.handleShareLink();break;case"delete":this.isPrivateChannel?this.handleDeleteTask():this.handleDeleteMessage()}},handleDeleteTask:function(){var e=this;try{this.$refs.commonConfirmModal.show({subTitle:"deleteTaskConfirm"}).then((function(){var t={ids:[e.message.id]};e.globalLoading=!0,Object(A.f)(t).then((function(t){var n,o;["10000",1e4].includes(null==t||null===(n=t.status)||void 0===n?void 0:n.code)?(e.$emit("operate",{type:"deleteTask",info:e.message}),e.$message({message:e.$t("deleteSuccess"),type:"success"}),e.handleClosePopover()):e.$message({message:(null==t||null===(o=t.status)||void 0===o?void 0:o.msg)||e.$t("ServerError"),type:"error"})})).finally((function(){e.globalLoading=!1}))})).catch((function(e){}))}catch(e){}},handleDeleteMessage:function(){var e=this;try{this.$refs.commonConfirmModal.show({subTitle:"deleteTaskConfirm"}).then((function(){var t={channel_id:e.channelId,message_ids:[e.message.message_id]};e.globalLoading=!0,Object(A.e)(t).then((function(t){var n,o;["10000",1e4].includes(null==t||null===(n=t.status)||void 0===n?void 0:n.code)?(e.$emit("operate",{type:"deleteTask",info:e.message}),e.$message({message:e.$t("deleteSuccess"),type:"success"})):e.$message({message:(null==t||null===(o=t.status)||void 0===o?void 0:o.msg)||e.$t("ServerError"),type:"error"})})).finally((function(){e.globalLoading=!1}))})).catch((function(e){}))}catch(e){}},handleCollect:function(){var e=this,t={id:this.message.pub_artwork_no};this.addFavorite(t,"artwork",null,(function(data){e.$emit("updateData",e.message.id,{collect:data})}))},unFavorite:function(){var e=this;if(!this.isCollecting){var t={id:this.message.pub_artwork_no,collect:{id:this.message.collect.id}};this.isCollecting=!0,Object(ue.h)({id:t.collect.id}).then((function(n){var o={id:t.id,collect:null};e.$logEvent("log_actions",{operation:"cancel_collect_image",behavior_info:t.id}),e.$emit("updateData",e.message.id,{collect:null}),e.changeCollectData(o)})).finally((function(){e.isCollecting=!1}))}},handleShareLink:function(){var e=this.message,t=e.pub_artwork_no,n=void 0===t?"":t,o=e.pub_artwork_nos,l=void 0===o?[]:o,r=n;if(l&&l.length&&(r=l[0]),!["",null,void 0].includes(r)){var c="".concat(window.location.origin,"/")+"explore/detail/".concat(r);this.$message.success(this.$t("CopiedURLToClipboard")),Object(k.d)(c)}},reportArtwork:function(){var e=this,t=this.message.pub_artwork_no,n=void 0===t?"":t;this.reportLoading||["",null,void 0].includes(n)||(this.reportLoading=!0,Object(de.o)({id:n}).then((function(t){var code=t&&t.status?t.status.code:"";[1e4,"10000"].includes(code)&&F()({message:e.$t("ReportSuccess"),type:"success",duration:5e3})})).finally((function(){e.reportLoading=!1})))},handleReStart:function(){this.closeMetaPopover(),this.$emit("operate",{info:this.message,type:"reStart"})},handleImageOperate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";switch(e){case"extraUpscale":this.$EventBus.$emit("openGenerate",{action:6,data:{imageUrl:n,art_work_no:this.message.pub_artwork_no,meta:Object.assign({},J()(this.message.meta),{channel:this.message.category})}});break;case"upscale":this.$emit("operate",{info:this.message,type:"U",btnInfo:{btnType:"U",id:t}});break;case"variations":this.$emit("operate",{info:this.message,type:"V",btnInfo:{btnType:"V",id:t}});break;case"removeBackground":this.$emit("operate",{info:this.message,type:"removeBackground",imageUrl:n});break;case"animGen":this.$emit("operate",{info:this.message,type:"A",btnInfo:{btnType:"A",id:t}})}},handlePromptSearch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$emit("operate",{info:this.message,type:"promptSearch",prompt:e})},handleTaskReStart:function(){this.$emit("operate",{info:this.message,type:"taskReStart"})},handleOperate:function(e,t){this.$emit("operate",{info:this.message,type:t,btnInfo:e})},handleCancelTask:function(){this.isLoading||this.$emit("operate",{info:this.message,type:"cancelTask"})},handleTrialFastQueue:function(){var e=this;this.$logEvent("log_actions",{operation:"try_quick_queue",behavior_info:"click_try"});var t=this.message.id,n=void 0===t?"":t;this.trailBtnLoading=!0,Object(V.c)({id:n}).then((function(t){var n,code=null==t||null===(n=t.status)||void 0===n?void 0:n.code;70010===code?(e.$EventBus.$emit("showBreakDialog","FastQueueTipWeb","basic"),e.$logEvent("log_actions",{operation:"try_quick_queue",behavior_info:"vip_pop_show"})):1e4===code&&(e.hasAccelerated=!0,e.$message.success(e.$t("AccelerateSuccess"))),e.trailBtnLoading=!1}))},handleCopyGenerationData:function(){this.closeMetaPopover(),this.$emit("copyGenerationData",this.message)},closeMetaPopover:function(){try{this.$refs.easyTaskInfoPopup.handleClose()}catch(e){}}}},Qa=Xa,Za=(n(3072),n(3073),n(3074),Object(y.a)(Qa,(function(){var e,t,n,o,l,r=this,c=r._self._c;return c("div",{staticClass:"c-easy-msg-item"},[r.showTime?c("div",{staticClass:"easy-msg-item-time-box"},[r._v(r._s(r._f("formatDateTime")(null===(e=r.message)||void 0===e?void 0:e.create_at,this)))]):r._e(),r._v(" "),c("easy-msg-item-header",{ref:"easyMsgHeader",attrs:{message:r.message,isMyMsg:r.isMyMsg,moreActionsShow:r.moreActionsShow,checkPermission:r.checkPermission,isShowExpireTime:r.isShowExpireTime,expireTime:r.getExpireTime,checkIsChannelOwner:r.checkIsChannelOwner},on:{moreAction:r.handleMoreAction}}),r._v(" "),null!==(t=r.easyTop)&&void 0!==t&&t.isShowPopup?c("easy-task-info-popup",{ref:"easyTaskInfoPopup",attrs:{loraModeObj:r.loraModeObj,message:r.message,"is-my-msg":r.isMyMsg,isShowExpireTime:r.isShowExpireTime,expireTime:r.getExpireTime},on:{updateModelName:r.handleUpdateModelName,setLoraModel:r.setLoraModel,close:function(e){return r.handleClosePopover()},copyGenerationData:r.handleCopyGenerationData}}):r._e(),r._v(" "),[6,"6"].includes(r.message.type)?[c("div",{staticClass:"message-text-list"},r._l(r.imagePromptList,(function(e,t){return c("div",{key:t,staticClass:"message-text-list-item"},[c("span",{staticClass:"message-text-list-item-order"},[r._v(r._s(t+1))]),r._v(" "),c("span",{staticClass:"message-text-list-item-text"},[r._v(r._s(e))])])})),0),r._v(" "),c("div",{staticClass:"operating-options-text"},r._l(r.imagePromptList,(function(e,t){return c("message-operate-btn",{key:"".concat(t,"_prompt_text"),on:{click:function(t){return r.handleAutoGenerate(e)}}},[r._v("\n          "+r._s(t+1)+"\n        ")])})),1)]:r._e(),r._v(" "),[2,"2",3,"3"].includes(r.message.status)&&(r.getImageUrl||r.isStudioMode&&null!==(n=r.message)&&void 0!==n&&null!==(n=n.components)&&void 0!==n&&n.length)?c("div",{staticClass:"message-accessories",on:{mouseenter:r.autoResizeScrollBtn}},[c("div",{staticClass:"media-attachments-container"},[r.message&&[10,"10"].includes(r.message.type)?r._l(r.message.components,(function(e,t){return c("message-img",{key:t,attrs:{src:r.getGridImageUrl(e),msgId:r.message.id,loraModels:r.loraModeObj,nsfw:e.nsfw,message:r.getImageInfo(e),"operate-number":t+1,"view-status":r.mapObj},on:{setLoraModel:r.setLoraModel,imageOperate:r.handleImageOperate,viewNsfwStatus:r.handleNsfwStatus,copyGenerationData:r.handleCopyGenerationData,updateModelName:r.handleUpdateModelName}})})):r.message&&Array.isArray(null===(o=r.message)||void 0===o?void 0:o.components)&&null!==(l=r.message)&&void 0!==l&&null!==(l=l.components)&&void 0!==l&&l.length?r._l(r.message.components,(function(e,t){return c("message-img",{key:t,attrs:{src:r.getGridImageUrl(e),msgId:r.message.id,loraModels:r.loraModeObj,nsfw:e.nsfw,width:e.width,height:e.height,message:r.getImageInfo(e),"operate-number":t+1,showSaveFlag:(null==e?void 0:e.is_saved_personal)||r.alreadySave,"view-status":r.mapObj},on:{setLoraModel:r.setLoraModel,copyGenerationData:r.handleCopyGenerationData,imageOperate:r.handleImageOperate,updateModelName:r.handleUpdateModelName,viewNsfwStatus:r.handleNsfwStatus,deleteSingleImg:r.deleteSingleImg,saveSuccess:function(e){r.alreadySave=!0}}})})):c("message-img",{attrs:{src:r.getImageUrl,nsfw:r.message.nsfw,message:r.message,msgId:r.message.id,loraModels:r.loraModeObj,"view-status":r.mapObj},on:{updateModelName:r.handleUpdateModelName,copyGenerationData:r.handleCopyGenerationData,setLoraModel:r.setLoraModel,imageOperate:r.handleImageOperate,viewNsfwStatus:r.handleNsfwStatus}})],2)]):r._e(),r._v(" "),[1,"1",2,"2",4,"4"].includes(r.message.status)?c("div",{staticClass:"message-process-container"},[[2,"2"].includes(r.message.status)&&r.computedPercentage(r.message)?c("div",{staticClass:"message-process-panel"},[c("el-progress",{staticClass:"message-process-panel-progress",attrs:{percentage:r.computedPercentage(r.message),color:r.customColor,"show-text":!1,"stroke-width":12}})],1):r._e(),r._v(" "),c("div",{staticClass:"message-process-operate-box"},[[1,"1"].includes(r.message.status)?[c("span",{staticClass:"process-operate-box-text"},[r._v(r._s(r.$t("TaskStatusWaitingToStart"))+" "),c("span",{staticClass:"message-process-loading-span"})])]:[2,"2"].includes(r.message.status)&&!r.computedPercentage(r.message)?[c("span",{staticClass:"process-operate-box-text"},[r._v(r._s(r.$t("TaskStatusPreparing"))+" "),c("span",{staticClass:"message-process-loading-span"})])]:[4,"4"].includes(r.message.status)?c("span",{staticClass:"process-operate-box-text",staticStyle:{color:"#DA373D"}},[r._v(r._s(r.convertStatusText))]):c("span",{staticClass:"process-operate-box-text"},[r._v(r._s(r.$t("youHaveCompleted"))),c("span",{staticClass:"process-operate-box-text-strong",staticStyle:{"margin-left":"5px"}},[r._v(r._s(r.computedPercentage(r.message))+"%")]),r._v(" "),c("span",{staticClass:"message-process-loading-span"})]),r._v(" "),r.isShowFaster?c("el-button",{staticClass:"message-process-operate-box-btn fast-queue",attrs:{size:"mini",loading:r.trailBtnLoading},on:{click:r.handleTrialFastQueue}},[c("i",{staticClass:"iconfont icon-trail-fast-queue"}),r._v(" "),c("span",{staticClass:"words"},[r._v(r._s(r.$t("TrialFastQueue")))])]):r._e(),r._v(" "),r.isShowCancel?c("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:r.$t("CancelJobTips"),placement:"top-start"}},[c("el-button",{staticClass:"message-process-operate-box-btn",class:{isLoading:r.isLoading},attrs:{type:"danger",size:"mini"},on:{click:r.handleCancelTask}},[r._v("\n            "+r._s(r.isLoading?"Canceling…":r.$t("CancelJob"))+"\n          ")])],1):r._e(),r._v(" "),[4,"4"].includes(r.message.status)&&r.checkPermission?c("message-operate-btn",{key:"reStart",attrs:{loading:r.checkBtnStatus("reStart").loading,disabled:r.checkBtnStatus("reStart").disabled},on:{click:r.handleTaskReStart}},[c("i",{staticClass:"iconfont icon-refresh-icon2",staticStyle:{"font-size":"18px"}})]):r._e()],2)]):r._e(),r._v(" "),c("common-confirm-modal",{ref:"commonConfirmModal"})],2)}),[],!1,null,"004b87ed",null).exports),Ya=n(109);function eo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function to(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eo(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var io={name:"TaskView",provide:function(){return{easyTaskView:this}},components:{EasyMsgItem:Za,auditDialog:Z.a,SaveTo:K.a,commonConfirmModal:un.a},props:{channelId:{type:String,default:""},taskTopPadding:{type:Number,default:0}},mixins:[Ce.a],inject:["easyTop"],data:function(){return{manageBtnConfig:[{code:"POST",i18nKey:"Post",icon:"iconfont icon-icon-Posts"},{code:"SAVE",i18nKey:"Save",icon:"iconfont icon-workflow_icon_save"},{code:"DOWNLOAD",i18nKey:"Download",icon:"el-icon-download"},{code:"DELETE",i18nKey:"Delete",icon:"iconfont icon-delete-gpt"},{code:"CANCEL",i18nKey:"Cancel",icon:"iconfont icon-close-btn"}],manageList:[],list:[],debounceHandleScroll:function(){},loading:!1,showBackTopBtn:!1,last1:0,last2:0,timer:null,showScroll:!1,showNoDataContent:!1,keyword:"",btnLoading:!1,debounceResize:function(){},isInDownloadTask:!1,pollingTimer:null,taskVersion:"v2"}},watch:{collectData:{handler:function(){var e=this;if(this.collectData&&this.collectData.id){var t=this.list.find((function(t){return t.pub_artwork_no&&t.pub_artwork_no===e.collectData.id})),n=t?t.id:"";!["",null,void 0].includes(n)&&this.handleUpdateData(n,{collect:this.collectData.collect||null})}},deep:!0,immediate:!0},channelId:{handler:function(e){this.handleChannelChange(e)},deep:!0,immediate:!0},isLoggedIn:{handler:function(e,t){(!t&&e||!e&&t)&&this.refreshPageData()},immediate:!0}},created:function(){this.addEmitEvent()},mounted:function(){this.init(),this.initScrollBar(),this.debounceHandleScroll=Object(X.debounce)(this.handleScroll,600),this.$EventBus.$on("needScrollBottom",this.checkNeedScrollToBottom),this.addPageShowEvent(),window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),this.debounceResize=Object(X.debounce)(this.handleResize,800),window.addEventListener("resize",this.debounceResize)},beforeDestroy:function(){this.debounceHandleScroll=null,this.timer&&window.clearTimeout(this.timer),this.timer=null,this.$EventBus.$off("needScrollBottom"),window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),document.removeEventListener("visibilitychange",this.showPageEvent),window.removeEventListener("resize",this.debounceResize),this.$EventBus.$off("messageItemPromptWidthUpdate"),this.debounceResize=null,this.closeWebsocket(),this.stopTask()},computed:to(to(to(to(to({},Object(S.e)("user",["collectData","userInfo"])),Object(S.c)("payment",["activeState"])),Object(S.c)("user",["isLoggedIn","isCompanyAccount"])),Object(S.e)("payment",["paymentInfo"])),{},{getMessageInfo:function(){var e,t,n={};(n.img_uris=[{url:""}],null!==(e=this.manageList)&&void 0!==e&&e.length)&&(n.img_uris=[null===(t=this.manageList)||void 0===t?void 0:t[0]]);return n},isVip:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},showNewUserGuide:function(){var e=!this.keyword&&this.showNoDataContent&&!this.loading&&!this.list.length,t=!this.isLoggedIn&&!this.loading&&!this.list.length;return e||t},showDateIds:function(){var e=[],t=new Date,n=new Date(t);n.setDate(t.getDate()+1);var o=n;try{(this.list||[]).forEach((function(t){var n=null==t?void 0:t.create_at;Object(k.u)(n,o)||(e.push(t.id),o=n)}))}catch(e){}return e},checkIsShowBackTopBtn:function(){return this.showBackTopBtn&&this.list.length},showMessage:function(){return function(e){var t;return![8,"8"].includes(null==e||null===(t=e.messageInfo)||void 0===t?void 0:t.type)}},checkIsShowViewNsfw:function(){var e;return null==this||null===(e=this.userInfo)||void 0===e?void 0:e.enable_nsfw_plus},enableNsfwMode:function(){var e;return![2,"2"].includes(null==this||null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.nsfw_plus)},getBatchSaveParams:function(){return(this.manageList||[]).map((function(e){return{id:null==e?void 0:e.taskId,index:null==e?void 0:e.index}}))}}),methods:to(to({},Object(S.b)("user",["getAccountInfo"])),{},{handleDebounceScroll:function(){try{this.$EventBus.$emit("needCheckInputPackUp"),this.debounceHandleScroll&&this.debounceHandleScroll()}catch(e){}},refreshPageData:function(){var e=this;"PRIVATE"===this.channelId&&(this.last1=0,this.last2=0,this.manageList=[],this.list=[],this.getHistoryMessage().finally((function(){e.showNoDataContent=!0})))},handleDownloadImages:function(){var e,t,n=this;if((null===(e=this.manageList)||void 0===e?void 0:e.length)>4&&!this.isVip)this.$EventBus.$emit("showBreakDialog","newGenerate55","basic");else if(!this.isInDownloadTask){var o={download_task_id:"",items:[]};o.items=(this.manageList||[]).map((function(e){return{id:null==e?void 0:e.taskId,index:null==e?void 0:e.index}})),null!==(t=o.items)&&void 0!==t&&t.length&&(this.isInDownloadTask=!0,Object(dn.g)(o).then((function(e){var t;if(1e4===(null==e||null===(t=e.status)||void 0===t?void 0:t.code)){var o=(null==e?void 0:e.data)||{},l=o.download_task_id,r=void 0===l?"":l;o.url;return n.pollingTask(r)}n.isInDownloadTask=!1})).catch((function(e){n.isInDownloadTask=!1})))}},stopTask:function(){this.pollingTimer&&window.clearTimeout(this.pollingTimer),this.pollingTimer=null,this.isInDownloadTask=!1},pollingTask:function(e){var t=this;return new Promise((function(n,o){t.isInDownloadTask=!0;var l={download_task_id:e,items:[]};t.pollingTimer=setTimeout((function(){Object(dn.g)(l).then((function(l){var r,c;if(1e4!==(null==l||null===(r=l.status)||void 0===r?void 0:r.code))return t.pollingTimer&&window.clearTimeout(t.pollingTimer),t.pollingTimer=null,t.$message.error(t.$t("ServerError")),t.isInDownloadTask=!1,void o();var d=(null==l||null===(c=l.data)||void 0===c?void 0:c.url)||"";["",null,void 0].includes(d)?t.pollingTask(e):(t.pollingTimer&&window.clearTimeout(t.pollingTimer),t.pollingTimer=null,t.isInDownloadTask=!1,t.openDownloadLink(d),n())})).catch((function(e){t.$message.error(t.$t("ServerError")),t.isInDownloadTask=!1,o()}))}),1e3)}))},openDownloadLink:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e){var a=document.createElement("a");document.body.appendChild(a),a.style.display="none",a.href=e,a.download="image_download",a.click(),document.body.removeChild(a)}},handleResize:function(){this.$EventBus.$emit("messageItemPromptWidthUpdate")},handleSaveSuccess:function(){var e=this;this.$refs.saveToPopover.handleClose();try{(this.list||[]).forEach((function(t){var n,o=e.manageList.filter((function(e){return(null==e?void 0:e.taskId)===(null==t?void 0:t.id)}));if(null!=o&&o.length&&(null==o||null===(n=o[0])||void 0===n?void 0:n.taskId)===(null==t?void 0:t.id)){var l=o.map((function(e){return e.index})),r=JSON.parse(JSON.stringify(t.components));(r||[]).forEach((function(e){l.includes(null==e?void 0:e.index)&&(e.is_saved_personal=!0)})),e.$set(t,"components",r)}}))}catch(e){}this.manageList=[]},updateSelectManageList:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(this.manageList||[]).findIndex((function(e){return t.url===e.url}));null!==(e=this.manageList)&&void 0!==e&&e.length||this.$logEvent("log_actions",{operation:"manage_work_popup_show",behavior_info:"on_new_create_flow_page"}),-1===n?-1===n&&this.manageList.length<20&&this.manageList.push(t):this.manageList.splice(n,1)},handleManageOperate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch(this.handleLogEvent(e),e){case"POST":this.sendToPost();break;case"SAVE":this.$refs.saveToPopover.openModal();break;case"DOWNLOAD":this.handleDownloadImages();break;case"DELETE":this.handleImageMangeDeleteImageConfirm();break;case"CANCEL":this.manageList=[],this.stopTask()}},handleLogEvent:function(e){var t="",n="";switch(e){case"POST":t="click_post";break;case"SAVE":t="click_organize",n=(this.manageList||[]).map((function(e){return e.url}));break;case"DOWNLOAD":t="click_download";break;case"DELETE":t="click_delete"}if(t){var o={operation:t,behavior_info:"on_new_create_flow_page"};n&&(o.behavior_info_sub=n),this.$logEvent("log_actions",o)}},handleImageMangeDeleteImageConfirm:function(){var e=this;try{this.$refs.commonConfirmModal.show({subTitle:"deleteConfirm"}).then((function(){e.handleImageMangeDeleteImage()})).catch((function(e){console.log("err",e)}))}catch(e){}},handleImageMangeDeleteImage:function(){var e=this,t=Array.from(new Set((this.manageList||[]).map((function(e){return e.taskId})))),n=(this.list||[]).filter((function(e){return t.includes(null==e?void 0:e.id)})),o={},l=(n=JSON.parse(JSON.stringify(n))).map((function(t){var n,l=(e.manageList||[]).filter((function(e){return e.taskId===(null==t?void 0:t.id)})).map((function(e){return e.index}));return t.components=(t.components||[]).filter((function(e){return!l.includes(null==e?void 0:e.index)})),(null==t||null===(n=t.components)||void 0===n||!n.length)&&(o[t.id]=1),t})).filter((function(e){var t;return null==e||null===(t=e.components)||void 0===t?void 0:t.length})),r={};r.items=(this.manageList||[]).map((function(e){return{id:null==e?void 0:e.taskId,index:null==e?void 0:e.index}})),Object(Ya.b)(r).then((function(t){e.list.forEach((function(t){var n=l.find((function(e){return e.id===t.id}));n&&e.$set(t,"components",(null==n?void 0:n.components)||[])})),e.list=e.list.filter((function(e){return!Object.keys(o).includes(null==e?void 0:e.id)})),e.manageList=[]})).finally((function(){}))},sendToPost:function(){this.manageList.length?this.$EventBus.$emit("openCreativeCenterModal",{list:this.manageList,type:"text",source:"task"}):this.$message.warning(this.$t("selectOneWork"))},addEmitEvent:function(){var e=this;this.$EventBus.$on("TaskListHandle",(function(t){e.handleTaskOperate(t)}))},addPageShowEvent:function(){document.addEventListener("visibilitychange",this.showPageEvent)},showPageEvent:function(){"visible"===document.visibilityState&&this.handleOnline()},settingViewNsfw:function(){var e;this.btnLoading||(this.enableNsfwMode||1===(null===(e=this.userInfo)||void 0===e?void 0:e.is_audit)?this.applyNsfw():this.$refs.auditDialog.showDialog())},applyNsfw:function(){var e=this;this.btnLoading=!0;var t={};t.nsfw_plus=this.enableNsfwMode?2:1,t.mode=1,t.age_confirm=!0,Object(Q.b)(t).then((function(t){var n=(t||{}).status.code;["10000",1e4].includes(void 0===n?"":n)&&(e.$message.success(e.$t(e.enableNsfwMode?"ClosedSuccessfully":"OpenedSuccessfully")),e.btnLoading=!1,e.getAccountInfo())})).finally((function(){e.btnLoading=!1}))},handleSearch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.keyword=e,this.list=[],this.getHistoryMessage()},handleOnline:function(){try{var e;if(!this.webSocketService)return;null===(e=this.webSocketService)||void 0===e||e.reconnectWebSocket(!0)}catch(e){}},handleOffline:function(){},init:function(){var e=this;this.showNoDataContent=!1,this.$store.dispatch("creation/getTaskOptionsInfo"),this.last1=0,this.last2=0,this.isLoggedIn&&this.initWebSocketService(),"PRIVATE"===this.channelId?this.getHistoryMessage().finally((function(){e.showNoDataContent=!0})):this.getHistoryChatMessage().finally((function(){e.showNoDataContent=!0})),this.pollingMiddleware=new we.a(3e3,(function(){e.fetchTaskData()}))},handleTaskError:function(code){var e={7e4:this.$t("taskOperateFailed"),70001:this.$t("taskExceededDailyGenerationLimit"),70002:this.$t("taskQueueFull"),70003:this.$t("taskModelVersionNotSupportVariations"),70009:this.$t("taskModelForbidden"),70008:this.$t("taskArtWorkForbidden"),70024:this.$t("error_code_70024"),80008:this.$t("InsufficientBalance"),70010:this.$t("error_code_70010"),70011:this.$t("error_code_70011"),70013:this.$t("error_code_70013"),70014:this.$t("error_code_70014"),70015:this.$t("error_code_70015"),70016:this.$t("error_code_70016"),70019:this.$t("error_code_70019"),70023:this.$t("HttpErrorCode_70023")};code&&e[code]?this.$message.error(e[code]):this.$message.error(this.$t("ServerError"))},checkNeedScrollToBottom:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t=this.list.findIndex((function(t){return t.id===e.id})),n=this.$refs.scrollWrapper;-1===t||t!==this.list.length-1||this.showScroll||n.scrollHeight-n.scrollTop<n.clientHeight+e.banner.height&&this.scrollToTop()}catch(e){}},checkUpdateMessageNeedScrollToBottom:function(){try{var e=this.$refs.scrollWrapper;e.scrollHeight-e.scrollTop<=2*e.clientHeight&&this.scrollToTop()}catch(e){}},initScrollBar:function(){var e=this;try{this.$refs.scrollWrapper.addEventListener("scroll",this.initScrollBarStatus),this.$once("hook:beforeDestroy",(function(){e.$refs.scrollWrapper.removeEventListener("scroll",e.initScrollBarStatus)}))}catch(e){}},initScrollBarStatus:function(){this.showScroll=!0},getHistoryMessage:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.loading)return Promise.resolve();var n={limit:50};return this.isLoggedIn||(n.g_mode=1),["",null,void 0].includes(t)||(n.after_id=t),n.keyword=this.keyword,this.loading=!0,Object(dn.i)(n).then((function(t){if("PRIVATE"!==e.channelId)return t;var o=t.data,data=void 0===o?{}:o;if(n.after_id){var l,r,c=Object(B.e)(e.list,(null==data?void 0:data.items)||[]);c=e.sortByField(c,"create_at",!1);var d=null===(l=e.$refs)||void 0===l||null===(l=l.scrollWrapper)||void 0===l?void 0:l.scrollHeight;c=c.map((function(e){return e.img_uris=((null==e?void 0:e.img_uris)||[]).filter((function(e){return null==e?void 0:e.url})),e.components=((null==e?void 0:e.components)||[]).filter((function(e){return null==e?void 0:e.url})),e})),(r=e.list).push.apply(r,Object(R.a)(c)),d&&c.length&&e.scrollToTop(d,"instant")}else e.list=((null==data?void 0:data.items)||[]).map((function(e){return e.img_uris=(e.img_uris||[]).filter((function(e){return null==e?void 0:e.url})),e.components=((null==e?void 0:e.components)||[]).filter((function(e){return null==e?void 0:e.url})),e})),e.scrollToTop(0,"instant")})).finally((function(){e.loading=!1}))},sortByField:function(e,t){var n=function(a,b){var e=a[t],n=b[t];return e<n?-1:e>n?1:0};return!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?e.sort(n):e.sort((function(a,b){return n(b,a)}))},handleScroll:function(){try{var e=this.$refs.scrollWrapper;try{if(0===e.scrollTop&&0===e.scrollHeight)return;this.showBackTopBtn=e.scrollHeight-e.scrollTop>e.clientHeight+50,window.clearTimeout(this.timer),this.timer=setTimeout(this.isScrollEnd,1500),this.last1=null==e?void 0:e.scrollTop}catch(e){}var t=e.scrollHeight-e.scrollTop-e.clientHeight;e&&t<=100&&this.handleLoadMore()}catch(e){}},isScrollEnd:function(){try{var e=this.$refs.scrollWrapper;this.last2=null==e?void 0:e.scrollTop,this.last2===this.last1&&(this.showScroll=!1)}catch(e){}},handleLoadMore:function(){var e=this.list.length?this.list[this.list.length-1]:"",t=e?e.id:"",n=e?e.timestamp:"";this.channelId&&"PRIVATE"===this.channelId?this.getHistoryMessage(t):this.getHistoryChatMessage(n)},scrollToTop:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"smooth";this.$nextTick((function(){try{var o=e.$refs.scrollWrapper;if(o){var l=t?t-200:t;o.scrollTo({top:l,behavior:n})}}catch(e){}}))},handleUpdateData:function(e,data){this.list.forEach((function(t){e===t.id&&Object.assign(t,data)}))},handleUpscale:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=J()(source),n={id:(t||{}).info.id,task_flow_version:"v2"};Object(A.h)(n).then((function(n){var o=n||{},l=o.status.code,code=void 0===l?"":l,r=o.data,data=void 0===r?{}:r;return[1e4,"10000"].includes(code)&&(t.info.meta=data.meta,t.info.pub_artwork_no=(null==data?void 0:data.art_work_no)||"",t.info.art_model_no=(null==data?void 0:data.art_model_no)||"",t.info.art_model_ver_no=(null==data?void 0:data.art_model_ver_no)||"",t.info.prompt=t.info.local_prompt||t.info.prompt,e.handleOtherOperate(t)),[1e4,"10000"].includes(code)||e.handleTaskError(code),n}))},handleGetMeta:function(e){var t=this;return Object(A.h)({id:null==e?void 0:e.id,task_flow_version:"v2"}).then((function(n){var o,l;if(1e4===n.status.code){var r=(null==n||null===(o=n.data)||void 0===o?void 0:o.meta)||{},c=t.list.find((function(t){return(null==t?void 0:t.id)===(null==e?void 0:e.id)}));t.$set(c,"meta",Object.assign((null==c?void 0:c.meta)||{},r)),t.$set(c,"art_model",Object.assign((null==c?void 0:c.art_model)||{},(null==n||null===(l=n.data)||void 0===l?void 0:l.art_model)||{}))}})).finally((function(){}))},handleTaskOperate:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=(l=e.length>0&&void 0!==e[0]?e[0]:{}).info,c=void 0===r?{}:r,d=l.type,h=void 0===d?"":d,m=l.callback,!["U","V","A","removeBackground","reStart"].includes(h)||null!=c&&c.meta){n.next=5;break}return n.next=5,t.handleGetMeta(c);case 5:n.t0=h,n.next="taskReStart"===n.t0?8:"cancelTask"===n.t0?10:"reStart"===n.t0?12:"extraUpscale"===n.t0?14:"U"===n.t0?16:"V"===n.t0?18:"A"===n.t0?20:"advanced"===n.t0?22:"promptSearch"===n.t0?24:"deleteTask"===n.t0?26:"removeBackground"===n.t0?28:30;break;case 8:return t.handleReStartTask(c),n.abrupt("break",31);case 10:return t.handleCancelTask(c,m),n.abrupt("break",31);case 12:return 3===(null==c?void 0:c.type)?t.handleVariations(l):t.handleTaskRestart(c),n.abrupt("break",31);case 14:return t.handleExtraUpscale(l),n.abrupt("break",31);case 16:return t.handleUpscale(l),n.abrupt("break",31);case 18:return t.handleVariations(l),n.abrupt("break",31);case 20:return t.handleOtherOperate(l),n.abrupt("break",31);case 22:return t.handleAdvancedOperate(l),n.abrupt("break",31);case 24:return null==t||null===(o=t.top)||void 0===o||o.setTextToImagePrompt(l.prompt),n.abrupt("break",31);case 26:return t.handleDeleteTask(c.id),n.abrupt("break",31);case 28:return t.handleRemoveBackground(l),n.abrupt("break",31);case 30:return n.abrupt("break",31);case 31:case"end":return n.stop()}}),n)})))()},handleExtraUpscale:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=J()(source),n=t.info,o=void 0===n?{}:n,l=t.data,data=void 0===l?{}:l;try{o.meta.prompt=o.local_prompt||o.meta.prompt;var r=["mask","mask_blur","inpainting_fill","inpainting_mask_invert","inpaint_full_res","inpaint_full_res_padding","hi_res_arg","ad_units"];Object.keys(o.meta).forEach((function(e){r.includes(e)&&delete o.meta[e]}))}catch(e){}var c=this.groupTaskOperateParams({operate_number:data.number,action:2,info:o});c.category=o.category||1,c.channel_id="PRIVATE"===this.channelId?"":this.channelId,c.meta.hi_res_arg={image:data.imageUrl,upscaler_1:"4x-UltraSharp",upscaling_resize:2},c.operate_number=data.number||1,Object(A.d)(c).then((function(t){var n=t||{},o=n.data,data=void 0===o?{}:o,l=n.status,r=(void 0===l?{}:l).code;if([1e4,"10000"].includes(void 0===r?"":r)){var c=to({},data);c.sender_id=e.userInfo.id,c.messageInfo={},c.messageInfo.author={id:c.sender_id,name:e.userInfo.name},e.list.unshift(c),e.checkNeedClearSearch(),e.$message.success(e.$t("CreateSuccess")),e.checkUpdateMessageNeedScrollToBottom();try{Object(ke.h)()}catch(e){}}else;})).finally((function(){}))},handleTaskRestart:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if([2].includes(null==e?void 0:e.type))this.handleCreateRestartTask(e);else if([5,"5"].includes(e.type))this.$EventBus.$emit("taskUserUpscale",{action:9,url:e.banner.url});else{var t,n,o=e.type||1;if([13,"13"].includes(o))return o=6,void this.$EventBus.$emit("openGenerate",{action:6,data:{imageUrl:(null==e||null===(t=e.banner)||void 0===t?void 0:t.url)||(null==e||null===(n=e.components[0])||void 0===n?void 0:n.url),art_work_no:e.pub_artwork_no,meta:J()(e.meta),local_prompt:(null==e?void 0:e.local_prompt)||""}});if([8,"8"].includes(o)&&(o=10),[7,"7"].includes(o)&&(o=9),[11].includes(o)&&(o=13),e&&([7,"7","studio",11].includes(e.category)||24===e.type)){var l;console.log("海艺实验室任务重试");var r=(null==e?void 0:e.pub_artwork_no)||"";return Array.isArray(null==e?void 0:e.pub_artwork_nos)&&null!=e&&null!==(l=e.pub_artwork_nos)&&void 0!==l&&l.length&&(r=null==e?void 0:e.pub_artwork_nos[0]),void this.$emit("reload",{action:o,data:{parent_task_id:e.id,id:r,local_prompt:(null==e?void 0:e.local_prompt)||""}})}console.log("重新唤起任务参数表单，相当于带着参数点创作（文生图）"),this.$emit("reload",{action:o,data:{parent_task_id:e.id,id:e.pub_artwork_no,local_prompt:(null==e?void 0:e.local_prompt)||"",meta:J()(e.meta),category:e.category}})}},handleCreateRestartTask:function(e){var t,n,o,l,r=this,c={channel_id:"",model_no:null==e||null===(t=e.ckpts[0])||void 0===t?void 0:t.id,model_ver_no:null==e||null===(n=e.ckpts[0])||void 0===n?void 0:n.model_ver_no,speed_type:2,meta:(null==e?void 0:e.meta)||{}},d=(null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[],h=c.model_no===(null==this||null===(o=this.easyTop)||void 0===o?void 0:o.fluxModelId)||d.includes(null==e||null===(l=e.ckpts)||void 0===l||null===(l=l[0])||void 0===l?void 0:l.base_model_name);c.meta.seed=Object(B.c)(h),(3===(null==e?void 0:e.type)?dn.o:dn.n)(c).then((function(e){var t;e.data;if(!e||1e4===(null==e||null===(t=e.status)||void 0===t?void 0:t.code)){r.$message.success(r.$t("CreateSuccess"));var n=Object.assign({},c,(null==e?void 0:e.data)||{});n.banner=null,n.img_uris=[],n.components=[],n.status=1,r.updateMessageList(n)}}))},handleRemoveBackground:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=source.info,n=void 0===t?{}:t,o=source.imageUrl,l=void 0===o?"":o,r={action:7,art_work_no:n.pub_artwork_no,parent_task_id:n.id,category:n.category||1};r.meta=J()(n.meta);try{r.meta.prompt=n.local_prompt||n.meta.prompt}catch(e){}return r.meta.hi_res_arg&&delete r.meta.hi_res_arg,r.meta.remove_background={uri:l},r.channel_id="PRIVATE"===this.channelId?"":this.channelId,r.category=n.category||1,Object(A.d)(r).then((function(t){var n=t||{},o=(n.data,n.status.code);if([1e4,"10000"].includes(void 0===o?"":o)){var l=Object.assign({},r,(null==t?void 0:t.data)||{});l.banner=null,l.img_uris=[],l.components=[],l.status=1,e.updateMessageList(l),e.$message.success(e.$t("CreateSuccess")),e.checkNeedClearSearch(),e.checkUpdateMessageNeedScrollToBottom();try{Object(ke.h)()}catch(e){}}}))},handleDeleteTask:function(e){var t=this.list.findIndex((function(t){return t.id===e}));-1!==t&&this.list.splice(t,1)},handleCopyTask:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=11===e.type?13:24==e.type?24:1;if(e&&[7,"7","studio"].includes(null==e?void 0:e.category)){var n,o=(null==e?void 0:e.pub_artwork_no)||"";return Array.isArray(null==e?void 0:e.pub_artwork_nos)&&null!=e&&null!==(n=e.pub_artwork_nos)&&void 0!==n&&n.length&&(o=null==e?void 0:e.pub_artwork_nos[0]),void this.$emit("reload",{action:t,data:{parent_task_id:e.id,id:o}})}this.$emit("reload",{action:t,data:{parent_task_id:e.id,id:e.pub_artwork_no}})},handleAdvancedOperate:function(){var source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=source.info,t=void 0===e?{}:e,n=source.btnInfo,o=void 0===n?{}:n;o&&"Make Variations"===o.btnType?this.handleOtherOperate(source):o&&"Web"===o.btnType&&(this.$router.push("/explore/detail/"+t.pub_artwork_no),this.$emit("closePopup"))},handleVariations:function(){var e,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=J()(source),n=t.info,o=void 0===n?{}:n,l=t.btnInfo,r=void 0===l?{}:l,c=(t.callback,this.groupTaskOperateParams({operate_number:r.id,action:3,info:o}));this.$emit("reload",{action:3,data:{parent_task_id:null==o?void 0:o.id,id:null==o?void 0:o.id,init_images:null==c||null===(e=c.meta)||void 0===e?void 0:e.init_images}})},handleOtherOperate:function(){var e,t,n=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=J()(source),l=o.info,r=void 0===l?{}:l,c=o.btnInfo,d=void 0===c?{}:c,h=o.callback;r.meta.prompt=r.local_prompt||r.meta.prompt;var m=-1!==d.btnType.indexOf("U")?2:-1!==d.btnType.indexOf("A")?24:3,v=["mask","mask_blur","inpainting_fill","inpainting_mask_invert","inpaint_full_res","inpaint_full_res_padding"];if(2===m&&v.push("hi_res_arg"),Object.keys((null==r?void 0:r.meta)||{}).forEach((function(e){v.includes(e)&&delete r.meta[e]})),null!=r&&null!==(e=r.meta)&&void 0!==e&&null!==(e=e.ad_units)&&void 0!==e&&e.length||delete r.meta.ad_units,2===m)try{r.meta.enable_hr=!1,delete r.meta.ad_units,delete r.meta.hr_upscaler,delete r.meta.hr_scale}catch(e){}var f={action:m,parent_task_id:r.id,operate_number:d.id,meta:r.meta,art_work_no:r.pub_artwork_no,task_id:r.id,number:d.id},_=this.groupTaskOperateParams({operate_number:d.id,action:m,info:r});if(!((null==r?void 0:r.art_model_no)===this.easyTop.fluxModelId&&[7,11,"studio"].includes(r.category))&&24===f.action&&![3,"3"].includes(r.category)){var y={action:f.action,parent_task_id:r.id,operate_number:d.id,art_work_no:r.pub_artwork_no,meta:null==r?void 0:r.meta};if(24===(null==f?void 0:f.action)){var w=r.img_uris,C=void 0===w?[]:w,k=r.components,S=void 0===k?[]:k,x=S.length?S[d.id-1].url:"";x||(x=C.length?C[d.id-1].url:""),y.meta.init_images=[x]}return console.log({data:y,action:f.action},"动画生成的快捷操作"),void this.$emit("reload",{data:y,action:f.action})}_.category=r.category||1,_.speed_type=(null===(t=this.easyTop)||void 0===t||null===(t=t.config)||void 0===t||null===(t=t.extraUpscale)||void 0===t?void 0:t.speed_type)||(this.activeState?2:1),this.handleUpdateBtnStatus(f.task_id,d.btnType),_.channel_id="PRIVATE"===this.channelId?"":this.channelId,_.meta.prompt=_.meta.local_prompt||_.meta.prompt,2!==m?3!==m?Object(A.d)(_).then((function(e){var t=e||{},o=t.data,data=void 0===o?{}:o,l=t.status,r=(void 0===l?{}:l).code;if([1e4,"10000"].includes(void 0===r?"":r)){h&&h(data);var c=to({},data);c.sender_id=n.userInfo.id,c.messageInfo={},c.messageInfo.author={id:c.sender_id,name:n.userInfo.name},n.list.unshift(c),n.checkNeedClearSearch(),n.updateBtnClickStatus(f),n.$message.success(n.$t("CreateSuccess")),n.checkUpdateMessageNeedScrollToBottom();try{Object(ke.h)()}catch(e){}}else;})).finally((function(){n.handleUpdateBtnStatus(f.task_id,"")})):this.handleStudioVariationsTask(_,r,h):this.handleStudioUpscaleTask(_,r,h)},handleStudioUpscaleTask:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>2?arguments[2]:void 0,n={};n.model_no=source.art_model_no,n.model_ver_no=source.art_model_ver_no,["channel_id","parent_task_id","meta","speed_type","source"].forEach((function(e){n[e]=source[e]})),Object(dn.n)(n).then((function(o){var l=o||{},r=l.data,data=void 0===r?{}:r,c=l.status,d=(void 0===c?{}:c).code;if([1e4,"10000"].includes(void 0===d?"":d)){t&&t(data);var h=to({},data);h.sender_id=e.userInfo.id,h.messageInfo={},h.messageInfo.author={id:h.sender_id,name:e.userInfo.name},h.art_model_no=n.art_model_no||"",h.status=1,h.banner=null,h.img_uris=[],h.components=[],e.list.unshift(h),e.checkNeedClearSearch(),e.updateBtnClickStatus(n),e.$message.success(e.$t("CreateSuccess")),e.checkUpdateMessageNeedScrollToBottom();try{Object(ke.h)()}catch(e){}}else;})).catch((function(e){}))},handleStudioVariationsTask:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>2?arguments[2]:void 0,n={};n.model_no=source.art_model_no,n.model_ver_no=source.art_model_ver_no,["channel_id","parent_task_id","meta","speed_type","source"].forEach((function(e){n[e]=source[e]})),Object(dn.o)(n).then((function(o){var l=o||{},r=l.data,data=void 0===r?{}:r,c=l.status,d=(void 0===c?{}:c).code;if([1e4,"10000"].includes(void 0===d?"":d)){t&&t(data);var h=to({},data);h.sender_id=e.userInfo.id,h.messageInfo={},h.messageInfo.author={id:h.sender_id,name:e.userInfo.name},h.art_model_no=n.art_model_no||"",h.status=1,h.banner=null,h.img_uris=[],h.components=[],e.list.unshift(h),e.checkNeedClearSearch(),e.updateBtnClickStatus(n),e.$message.success(e.$t("CreateSuccess")),e.checkUpdateMessageNeedScrollToBottom();try{Object(ke.h)()}catch(e){}}else;})).catch((function(e){}))},groupTaskOperateParams:function(){var e,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=source.operate_number,n=void 0===t?1:t,o=source.action,l=void 0===o?1:o,r=source.info,c=void 0===r?{}:r,d={};d.action=l,d.operate_number=n,d.art_work_no=c.pub_artwork_no,d.art_model_no=(null==c?void 0:c.art_model_no)||"",d.art_model_ver_no=(null==c?void 0:c.art_model_ver_no)||"",d.parent_task_id=c.id,d.meta=c.meta;var h=c.img_uris,m=void 0===h?[]:h,v=c.components,f=void 0===v?[]:v;m=null!=f&&f.length?f:m;var _=(null==c||null===(e=c.banner)||void 0===e?void 0:e.url)||"",y=m.length?m[n-1].url:"";if(3===l){var w,C=(null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[],k=d.art_model_no===xe.h||C.includes(null==c||null===(w=c.ckpts)||void 0===w||null===(w=w[0])||void 0===w?void 0:w.base_model_name);d.meta.seed=Object(B.c)(k),d.meta.init_images=[y],d.meta.controlnet_units=[]}return 2===l&&(d.meta.init_images=m.length?[y]:[_],d.meta.controlnet_units=[]),d},handleReStartTask:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id,n={action:4,task_id:void 0===t?"":t};this.handleUpdateBtnStatus(n.task_id,"reStart"),Object(A.r)(n).then((function(t){var n=(t||{}).status,o=(void 0===n?{}:n).code,code=void 0===o?"":o;if([1e4,"10000"].includes(code)){var l=(t.data||{}).new_task,r=void 0===l?null:l;return-1!==e.list.findIndex((function(e){return e.id===r.id}))?e.list.forEach((function(e){r&&e.id===r.id&&Object.assign(e,r)})):e.list.unshift(r),void e.checkNeedClearSearch()}[1e4,"10000"].includes(code)||e.handleTaskError(code)})).finally((function(){e.handleUpdateBtnStatus(n.task_id,"")}))},handleCancelTask:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;console.log("取消任务");var o=t.id,l=void 0===o?"":o,r={action:5,task_id:l};this.isLoggedIn||(r.g_mode=1),this.handleUpdateCancelBtnStatus(l,!0),Object(A.r)(r).then((function(t){e.$message.warning(e.$t("cancelJobSuccess"));var o=(t||{}).status,r=(void 0===o?{}:o).code,code=void 0===r?"":r;if(n&&n(),[1e4,"10000"].includes(code)){var c=e.list.findIndex((function(e){return e.id===l}));-1!==c&&e.list.splice(c,1)}else[1e4,"10000"].includes(code)||e.handleTaskError(code)})).finally((function(){e.handleUpdateCancelBtnStatus(l,!1)}))},handleUpdateBtnStatus:function(e,t){var n=this;this.list.forEach((function(o){o.id===e&&n.$set(o,"loadingBtn",t)}))},handleUpdateCancelBtnStatus:function(e,t){var n=this;this.list.forEach((function(o){o.id===e&&n.$set(o,"isLoading",t)}))},updateBtnClickStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.action,n=e.task_id,o=e.number;this.list.forEach((function(e){if(e.id===n){var l={action:t,number:o};-1===(e.operation||[]).findIndex((function(e){return e.action===t&&o===e.number}))&&(!Array.isArray(e.operation)||e.operation.push(l))}}))},updateMessageList:function(e){this.checkNeedClearSearch();var t=this.list.findIndex((function(t){return e.id===t.id})),n=to({},e);n.sender_id=this.userInfo.id,n.messageInfo={},n.messageInfo.author={id:n.sender_id,name:this.userInfo.name},-1===t&&this.list.unshift(n),this.checkUpdateMessageNeedScrollToBottom()},checkNeedClearSearch:function(){"PRIVATE"!==this.channelId||["",null,void 0].includes(this.keyword)||this.$EventBus.$emit("clearTaskSearch")},initWebSocketService:function(){var e=this;if(Object(ye.l)()){var t=Object(xe.t)();this.webSocketService=new Se.a(t,(function(){e.list.length&&e.getLastChatMessage()}),this.handleWebsocketMessage)}},handleWebsocketMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$EventBus.$emit("chatMessage",e),this.checkNeedDropMessage(),e&&[5,"5"].includes(e.type)?this.handleMessageError(e):e&&[8,"8"].includes(e.type)?this.handleDeleteTaskMessage(e):this.channelId==e.channel_id&&this.handleChannelMessage(e)},checkNeedDropMessage:function(){try{this.list.length>=2e3&&(this.list=this.list.slice(Math.ceil(this.list.length/2)))}catch(e){}},checkHasDeleteMessage:function(){var e=this;this.list.forEach((function(t){var n,o=null==t||null===(n=t.messageInfo)||void 0===n?void 0:n.type;t&&[8,"8"].includes(o)&&e.handleDeleteTaskMessage(t.messageInfo)}))},handleMessageError:function(){var e=this;[20002,20003,20004,"20002","20003","20004"].includes((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).error_code)?this.$store.dispatch("user/logout").then((function(){e.$router.replace({path:"/home",query:{openLoginDialog:"1"}})})):this.webSocketService.reconnectWebSocket(!0)},handleDeleteTaskMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.message_id,e.channel_id),n=void 0===t?"":t,o=(e.components,e.related_message_id),l=void 0===o?"":o;if(n===this.channelId){var r=this.list.findIndex((function(e){return e.message_id===l}));-1!==r&&this.list.splice(r,1)}},handleChannelMessage:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("PRIVATE"!==this.channelId){var n=t.components,o=void 0===n?[]:n,l=t.message_id,r=t.sender_id,c=t.timestamp,d=o.filter((function(e){return[1,"1"].includes(e.type)})).map((function(e){return e.custom_id}));d.length&&Object(A.b)({ids:d}).then((function(n){(n.data.items||[]).map((function(e){var n=to({},e);return n.message_id=l,n.timestamp=c,n.sender_id=r,n.messageInfo=t,n})).forEach((function(t){var n=e.list.find((function(e){return e.id===t.id||e.message_id===t.message_id}));n?Object.assign(n,t):e.list.unshift(t)}))})).finally((function(){}))}},closeWebsocket:function(){try{if(this.webSocketService)return;this.webSocketService.close(),this.webSocketService.destroy(),this.webSocketService=null}catch(e){}},getHistoryChatMessage:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.loading)return Promise.resolve();var n={page_size:50};return t&&(n.time_from=t),n.channel_id=this.channelId,this.loading=!0,Object(A.g)(n).then((function(t){if(n.channel_id!==e.channelId)return t;var o=t&&t.data?t.data:{},l=o.items,r=void 0===l?[]:l;o.has_more;if(n.time_from){var c,d,h=Object(B.e)(e.list,r||[],"message_id");h=(h=(h=e.sortByField(h,"timestamp",!1)).map((function(e){var t,n={};if(e&&null!=e&&null!==(t=e.components)&&void 0!==t&&t.length){var o=e.components.find((function(e){return 1===e.type}));n=o?to({},o.task_resource):{}}return n.message_id=e.message_id,n.timestamp=e.timestamp,n.sender_id=e.sender_id,n.messageInfo=e,n})).filter((function(e){return!["userCancelDesc"].includes(e.status_desc)}))).map((function(e){return e.img_uris=(e.img_uris||[]).filter((function(e){return null==e?void 0:e.url})),e.components=(e.components||[]).filter((function(e){return null==e?void 0:e.url})),e}));var m=null===(c=e.$refs)||void 0===c||null===(c=c.scrollWrapper)||void 0===c?void 0:c.scrollHeight;(d=e.list).unshift.apply(d,Object(R.a)(h)),m&&h.filter((function(e){return e.id})).length&&e.scrollToTop(m,"instant")}else e.list=(r||[]).map((function(e){var t,n={};if(e&&null!=e&&null!==(t=e.components)&&void 0!==t&&t.length){var o=e.components.find((function(e){return 1===e.type}));n=o?to({},o.task_resource):{}}return n.img_uris=(n.img_uris||[]).filter((function(e){return null==e?void 0:e.url})),n.components=(n.components||[]).filter((function(e){return null==e?void 0:e.url})),n.message_id=e.message_id,n.timestamp=e.timestamp,n.sender_id=e.sender_id,n.messageInfo=e,n})).filter((function(e){return!["userCancelDesc"].includes(e.status_desc)})).reverse(),e.scrollToTop(0,"instant");e.checkHasDeleteMessage()})).finally((function(){e.loading=!1}))},handleChannelChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.list=[],this.keyword="";try{this.webSocketService.reconnectWebSocket()}catch(e){}e&&"PRIVATE"===e?this.getHistoryMessage():this.getHistoryChatMessage()},getLastChatMessage:function(){var e=this;if("PRIVATE"!==this.channelId){var t={page_size:100},n=this.list.length?this.list[this.list.length-1]:"",o=n?n.timestamp:"";return o&&(t.time_from=o),t.channel_id=this.channelId,t.order_by="asc",this.loading=!0,Object(A.g)(t).then((function(n){if(t.channel_id!==e.channelId)return n;var o=n&&n.data?n.data:{},l=o.items,r=void 0===l?[]:l,c=o.has_more,d=void 0!==c&&c;if(t.time_from){var h,m=Object(B.e)(e.list,r||[],"message_id");(m=(m=e.sortByField(m,"timestamp",!1)).map((function(e){var t,n={};if(e&&null!=e&&null!==(t=e.components)&&void 0!==t&&t.length){var o=e.components.find((function(e){return 1===e.type}));n=o?to({},o.task_resource):{}}return n.message_id=e.message_id,n.timestamp=e.timestamp,n.sender_id=e.sender_id,n.messageInfo=e,n})).filter((function(e){return!["userCancelDesc"].includes(e.status_desc)}))).length&&(h=e.list).unshit.apply(h,Object(R.a)(m)),e.checkHasDeleteMessage(),d&&m.length&&e.getLastChatMessage()}})).finally((function(){e.loading=!1}))}}})},no=io,ao=(n(3075),Object(y.a)(no,(function(){var e,t,n=this,o=n._self._c;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],staticClass:"c-easy-task-view-box"},[o("div",{directives:[{name:"show",rawName:"v-show",value:!n.showNewUserGuide&&n.checkIsShowBackTopBtn,expression:"!showNewUserGuide && checkIsShowBackTopBtn"}],staticClass:"generate-view-back-top",class:[n.checkIsShowViewNsfw?"":"generate-view-back-top-only"],on:{click:function(e){return n.scrollToTop(0)}}},[o("i",{staticClass:"el-icon-caret-top"})]),n._v(" "),!n.showNewUserGuide&&n.checkIsShowViewNsfw?o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:n.enableNsfwMode?n.$t("hideAdultContent"):n.$t("showAdultContent"),placement:"left"}},[o("div",{staticClass:"generate-view-nsfw-plus",on:{click:n.settingViewNsfw}},[o("i",{staticClass:"iconfont",class:n.enableNsfwMode?"icon-work-hide":"icon-work-show"})])]):n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!n.showNewUserGuide&&(null===(e=n.manageList)||void 0===e?void 0:e.length),expression:"!showNewUserGuide && manageList?.length"}],staticClass:"easy-task-view-box-top padding-top-32"},[o("div",{staticClass:"easy-task-view-manage"},[o("div",{staticClass:"easy-task-view-manage-info"},[n._v("\n        "+n._s(n.$t("newGenerate11",{number:null===(t=n.manageList)||void 0===t?void 0:t.length}))+"\n      ")]),n._v(" "),o("div",{staticClass:"easy-task-view-manage-operate"},[n._l(n.manageBtnConfig,(function(e){return["DOWNLOAD"===e.code?[o("el-tooltip",{attrs:{content:n.$t("newGenerate54",{num:4}),placement:"top-start",effect:"light"}},[o("div",{key:"manage-btn_".concat(null==e?void 0:e.code),staticClass:"manage-operate-btn",on:{click:function(t){return t.stopPropagation(),n.handleManageOperate(null==e?void 0:e.code)}}},["DOWNLOAD"===e.code?[o("span",{staticClass:"manage-operate-btn-icon",class:[n.isInDownloadTask&&"DOWNLOAD"===e.code?"el-icon-loading":e.icon]})]:[o("span",{staticClass:"manage-operate-btn-icon",class:[e.icon]})],n._v(" "),o("span",{staticClass:"manage-operate-btn-text"},[n._v(n._s(n.$t(e.i18nKey)))])],2)])]:o("div",{key:"manage-btn_".concat(null==e?void 0:e.code),staticClass:"manage-operate-btn",on:{click:function(t){return t.stopPropagation(),n.handleManageOperate(null==e?void 0:e.code)}}},["DOWNLOAD"===e.code?[o("el-tooltip",{attrs:{content:n.$t("newGenerate54",{num:4}),placement:"top-start",effect:"light"}},[o("span",{staticClass:"manage-operate-btn-icon",class:[n.isInDownloadTask&&"DOWNLOAD"===e.code?"el-icon-loading":e.icon]})])]:[o("span",{staticClass:"manage-operate-btn-icon",class:[e.icon]})],n._v(" "),o("span",{staticClass:"manage-operate-btn-text"},[n._v(n._s(n.$t(e.i18nKey)))])],2)]})),n._v(" "),o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),isBatchSave:!0,allowCreateCollect:!0,batchSaveParams:n.getBatchSaveParams,message:n.getMessageInfo,isColorBtn:!0,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}})],2)])]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!n.showNewUserGuide,expression:"!showNewUserGuide"}],ref:"scrollWrapper",staticClass:"c-easy-task-view-scroll-wrap",class:[n.showScroll?"":"show-scroll-bar"],on:{scroll:n.handleDebounceScroll}},[o("div",{staticClass:"c-easy-task-view"},[o("div",{ref:"scrollContainer",staticClass:"message-list"},[o("div",{staticClass:"messages-wrapper"},[o("div",{staticClass:"scroll-wrapper"},[n._l(n.list,(function(e,t){return[e.id&&n.showMessage(e)?o("easy-msg-item",{key:e.id||e.message_id,attrs:{message:e,"task-from":"",channelId:n.channelId,showTime:n.showDateIds.includes(null==e?void 0:e.id)},on:{operate:n.handleTaskOperate,copyGenerationData:n.handleCopyTask,updateData:n.handleUpdateData}}):n._e()]}))],2)])]),n._v(" "),o("auditDialog",{ref:"auditDialog",on:{confirm:n.applyNsfw}}),n._v(" "),o("common-confirm-modal",{ref:"commonConfirmModal"})],1)]),n._v(" "),n.showNewUserGuide?o("div",{staticClass:"user-guide-box"},[o("div",{staticClass:"user-guide-box-icon"}),n._v(" "),o("div",{staticClass:"user-guide-box-title"},[o("div",{staticClass:"user-guide-box-title-liner"},[n._v(n._s(n.$t("newGenerate39")))]),n._v(" "),o("div",{staticClass:"user-guide-box-title-text"},[n._v(n._s(n.$t("newGenerate40")))])]),n._v(" "),o("div",{staticClass:"user-guide-image-box"})]):n._e()],1)}),[],!1,null,"dbe3a8b0",null).exports);function oo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function so(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oo(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var lo={name:"SelectControlNetModal",inject:["easyTop"],data:function(){return{visible:!1,modelCover:xe.n,selectItem:null}},computed:so(so({},Object(S.c)("creation",["taskUnits","taskSdxlUnits","lab_ctr_units","v2_sd_xl_ctr_units","v2_ctr_units"])),{},{taskModules:function(){var e;return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isSDXLModel?this.v2_sd_xl_ctr_units:this.v2_ctr_units},hideModel:function(){return"preview"===(null==this?void 0:this.menuIndex)?["none","reference_only"]:["none"]},getSelectClass:function(){return function(e){var t;return this.selectItem&&(null===(t=this.selectItem)||void 0===t?void 0:t.type)===(null==e?void 0:e.type)?"select-control-net-item-active":""}}}),methods:{show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.resetData(),this.selectItem=e,this.visible=!0},resetData:function(){this.selectItem=null},handleClose:function(){this.visible=!1},handleConfirm:function(){var e=this,t={},n=this.taskModules.find((function(i){return e.selectItem&&e.selectItem.type==i.type}))||{};t.model=(null==n?void 0:n.default_model)||"None",t.module=(null==n?void 0:n.default_module)||"none",t.type=this.selectItem.type,this.$emit("confirm",t),this.handleClose()},handleClick:function(e){this.selectItem=e}}},ro=lo,co=(n(3076),Object(y.a)(ro,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,"custom-class":"select-control-net-modal custom-dialog",title:e.$t("ControlNet"),"destroy-on-close":!1,"close-on-press-escape":!0,modal:!1,"modal-append-to-body":"",width:"1058px"},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"modal-header"},[t("div",{staticClass:"modal-header-title"},[e._v(e._s(e.$t("ControlNet")))]),e._v(" "),t("span",{staticClass:"modal-header-close",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[t("i",{staticClass:"el-icon-close"})])]),e._v(" "),t("div",{staticClass:"select-control-net--modal-content"},e._l(e.taskModules,(function(n,i){return t("div",{directives:[{name:"show",rawName:"v-show",value:!e.hideModel.includes(n.type),expression:"!hideModel.includes(item.type)"}],key:"model_"+i,staticClass:"image-card-item-content",class:[e.getSelectClass(n)],on:{click:function(t){return e.handleClick(n)}}},[t("div",{staticClass:"image-card-item-content-img"},[t("img",{attrs:{src:null==n?void 0:n.covers[0],alt:""}})]),e._v(" "),t("div",{staticClass:"image-card-item-content-img"},[null!=n&&n.covers[1]?t("img",{attrs:{src:null==n?void 0:n.covers[1],alt:""}}):e._e()]),e._v(" "),t("div",{staticClass:"image-card-item-content-text"},[t("div",{staticClass:"image-card-item-content-title"},[e._v(e._s(e.$t(n.type)))]),e._v(" "),t("div",{staticClass:"image-card-item-content-subtitle"},[e._v("\n          "+e._s(e.$t(n.type+"_Tips"))+"\n        ")])])])})),0),e._v(" "),t("div",{staticClass:"select-control-net--modal-footer"},[t("span",{staticClass:"modal-footer-btn",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("span",{staticClass:"modal-footer-btn modal-footer-btn-confirm",on:{click:function(t){return t.stopPropagation(),e.handleConfirm()}}},[e._v(e._s(e.$t("Confirm")))])])])}),[],!1,null,null,null).exports);function uo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ho(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uo(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var po={name:"ImageAndControlNetPopup",data:function(){return{visible:!1}},inject:["easyTop"],components:{SelectControlNetModal:co},computed:ho(ho(ho({},Object(S.c)("creation",["v2_sd_xl_ctr_units","v2_ctr_units"])),Object(S.c)("user",["cdnHostFun","isLoggedIn"])),{},{showIpMaintain:function(){var e,t,n,o=(null==this||null===(e=this.easyTop)||void 0===e||null===(e=e.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.art_model_no)===(null==this||null===(t=this.easyTop)||void 0===t?void 0:t.fluxModelId),l=!(null!=this&&null!==(n=this.easyTop)&&void 0!==n&&null!==(n=n.config)&&void 0!==n&&null!==(n=n.textToImage)&&void 0!==n&&null!==(n=n.lora_models)&&void 0!==n&&n.length);return o&&l},taskModules:function(){var e;return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isSDXLModel?this.v2_sd_xl_ctr_units:this.v2_ctr_units},renderControlNetList:function(){var e=["canny","reference_only"];return(this.taskModules||[]).filter((function(t){return e.includes(null==t?void 0:t.type)}))},isHideControlNet:function(){var e,t,n;return(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isStudioFlux)||(null==this||null===(t=this.easyTop)||void 0===t?void 0:t.isCommunityFlux)||(null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isSd35Model)},isAnimeEnhanceEnable:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isAnimeEnhanceEnable}}),methods:{onClose:function(){this.visible=!1},handlePopupShow:function(){this.$emit("show")},handlePopupHide:function(){this.$emit("hide")},openModal:function(e,t){if(this.$logEvent("log_actions",{operation:"imageToImage"===e?"click_image_to_image_tab":"click_controlnet_tab",behavior_info:"on_new_create_flow_page"}),this.isLoggedIn)if(this.isAnimeEnhanceEnable&&["controlNet","imageToImage"].includes(e))this.$message.warning(this.$t("newGenerate20"));else{var n=null;"controlNet"===e&&((n={}).model=(null==t?void 0:t.default_model)||"None",n.module=(null==t?void 0:t.default_module)||"none",n.type=t.type),"controlNet"===e&&this.isHideControlNet||("IpMaintain"!==e||this.showIpMaintain)&&this.$emit("openUploadImage",{type:e,controlNetInfo:n,checkFace:"IpMaintain"===e})}else this.$EventBus.$emit("openLoginDialog")},handleSelect:function(e){this.$emit("openUploadImage",{type:"controlNet",controlNetInfo:e})},handleOpenPickControlNet:function(){this.isLoggedIn?this.isAnimeEnhanceEnable?this.$message.warning(this.$t("newGenerate20")):this.isHideControlNet||this.$refs.selectControlNetModal.show():this.$EventBus.$emit("openLoginDialog")}}},mo=(n(3077),Object(y.a)(po,(function(){var e=this,t=e._self._c;return t("el-popover",{ref:"topBarPopover",attrs:{title:"",trigger:"click","popper-class":"image-and-control-net-popup","append-to-body":!0,"visible-arrow":!1,placement:"bottom-start"},on:{show:e.handlePopupShow,hide:e.handlePopupHide},scopedSlots:e._u([{key:"reference",fn:function(){return[e._t("default")]},proxy:!0}],null,!0),model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{staticClass:"image-card-item",on:{click:function(t){return t.stopPropagation(),e.openModal("imageToImage")}}},[t("div",{staticClass:"image-card-item-title"},[e._v(e._s(e.$t("TaskUploadImage")))]),e._v(" "),t("div",{staticClass:"image-card-item-content"},[t("div",{staticClass:"image-card-item-content-img"},[t("img",{attrs:{src:"https://".concat(e.cdnHostFun(),"/static/upload/20240919/f4c390e3-8622-4a9b-a9c6-dd6a72866ac6.jpeg"),alt:""}})]),e._v(" "),t("div",{staticClass:"image-card-item-content-img"},[t("img",{attrs:{src:"https://".concat(e.cdnHostFun(),"/static/upload/20240919/53cc0e90-573b-4e5e-a952-d56f5a87ff66.jpeg"),alt:""}})]),e._v(" "),t("div",{staticClass:"image-card-item-content-text",attrs:{title:e.$t("newGenerate19")}},[e._v("\n        "+e._s(e.$t("newGenerate19"))+"\n      ")])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showIpMaintain,expression:"showIpMaintain"}],staticClass:"image-card-item",on:{click:function(t){return t.stopPropagation(),e.openModal("IpMaintain")}}},[t("div",{staticClass:"image-card-item-title"},[e._v(e._s(e.$t("studio46")))]),e._v(" "),t("div",{staticClass:"image-card-item-content"},[t("div",{staticClass:"image-card-item-content-img"},[t("img",{attrs:{src:"https://".concat(e.cdnHostFun(),"/20241111/357f66fe-6dcb-46fd-b9d8-7b65b4c81cf4_high.webp"),alt:""}})]),e._v(" "),t("div",{staticClass:"image-card-item-content-img"},[t("img",{attrs:{src:"https://".concat(e.cdnHostFun(),"/20241111/ce6bee26-a8ff-4241-9775-f45c476e6674_high.webp"),alt:""}})]),e._v(" "),t("div",{staticClass:"image-card-item-content-text",attrs:{title:e.$t("studio47")}},[e._v("\n        "+e._s(e.$t("studio47"))+"\n      ")])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isHideControlNet,expression:"!isHideControlNet"}],staticClass:"image-card-item"},[t("div",{staticClass:"image-card-item-title"},[e._v(e._s(e.$t("ConditionToImg")))]),e._v(" "),e._l(e.renderControlNetList,(function(n,o){return[t("div",{key:"image_card_".concat(null==n?void 0:n.type),staticClass:"elements-card-item-content",on:{click:function(t){return t.stopPropagation(),e.openModal("controlNet",n)}}},[t("div",{staticClass:"elements-card-item-content-img"},[t("img",{attrs:{src:null==n?void 0:n.covers[0],alt:""}})]),e._v(" "),t("div",{staticClass:"elements-card-item-content-img"},[null!=n&&n.covers[1]?t("img",{attrs:{src:null==n?void 0:n.covers[1],alt:""}}):e._e()]),e._v(" "),t("div",{staticClass:"elements-card-item-content-text"},[t("div",{staticClass:"content-text--title"},[e._v(e._s(e.$t(n.type)))]),e._v(" "),t("div",{staticClass:"content-text--subtitle",attrs:{title:e.$t(n.type+"_Tips")}},[e._v("\n            "+e._s(e.$t(n.type+"_Tips"))+"\n          ")])])])]}))],2),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isHideControlNet,expression:"!isHideControlNet"}],staticClass:"tools-popup-view-more-btn",on:{click:e.handleOpenPickControlNet}},[t("span",{staticClass:"tools-popup-view-more-btn-text"},[e._v(e._s(e.$t("viewMore")))]),e._v(" "),t("span",{staticClass:"tools-popup-view-more-btn-icon el-icon-right"})]),e._v(" "),e._v(" "),t("select-control-net-modal",{ref:"selectControlNetModal",on:{confirm:e.handleSelect}})],1)}),[],!1,null,null,null).exports);function vo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var go={name:"RandomPromptPopup",inject:["easyTop"],data:function(){return{visible:!1,isLoading:!1}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vo(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(S.c)("user",["isLoggedIn"])),methods:{onClose:function(){this.visible=!1},changeRandom:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoggedIn){t.next=3;break}return e.$EventBus.$emit("openLoginDialog"),t.abrupt("return");case 3:return e.isLoading=!0,t.prev=4,e.$EventBus.$emit("resetInputPackUpStatus"),t.next=8,null===(n=e.easyTop)||void 0===n?void 0:n.getRandomPrompt("click");case 8:e.isLoading=!1,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),e.isLoading=!1;case 14:case"end":return t.stop()}}),t,null,[[4,11]])})))()},openPickImageModal:function(){this.isLoggedIn?this.$emit("openPickImageModal",{type:"imageDescribe"}):this.$EventBus.$emit("openLoginDialog")}}},fo=go,_o=(n(3078),Object(y.a)(fo,(function(){var e=this,t=e._self._c;return t("el-popover",{ref:"randomPromptPopup",attrs:{title:"",trigger:"click","popper-class":"random-prompt-popup","append-to-body":!0,"visible-arrow":!1,placement:"bottom-end"},scopedSlots:e._u([{key:"reference",fn:function(){return[e._t("default")]},proxy:!0}],null,!0),model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{staticClass:"random-prompt-popup-card-item",on:{click:e.changeRandom}},[t("div",{staticClass:"popup-card-item-title"},[t("span",{staticClass:"popup-card-item-title-icon iconfont icon-dice-square",class:[e.isLoading&&"random-prompt-loading"]}),e._v(" "),t("span",{staticClass:"popup-card-item-title-text"},[e._v(e._s(e.$t("newGenerate28")))])]),e._v(" "),t("div",{staticClass:"popup-card-item-content"},[e._v("\n      "+e._s(e.$t("newGenerate29"))+"\n    ")])]),e._v(" "),t("div",{staticClass:"random-prompt-popup-card-item",on:{click:function(t){return t.stopPropagation(),e.openPickImageModal.apply(null,arguments)}}},[t("div",{staticClass:"popup-card-item-title"},[t("span",{staticClass:"popup-card-item-title-icon iconfont icon-icon-describe"}),e._v(" "),t("span",{staticClass:"popup-card-item-title-text"},[e._v(e._s(e.$t("newGenerate30")))])]),e._v(" "),t("div",{staticClass:"popup-card-item-content"},[e._v("\n      "+e._s(e.$t("newGenerate31"))+"\n    ")])])])}),[],!1,null,null,null)),bo=_o.exports,yo=n(40),wo=(n(118),n(87)),Co=n(39),ko=n(193),So=n(115);function xo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Io(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xo(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Oo={name:"waterFall",mixins:[ce.a],components:{CollectPopover:an.a,listCheckbox:So.a,modelPayNum:on.a},props:{showNs:Boolean,currentTab:{type:String,default:""},list:{type:Array,default:function(){return[]}},containerForImg:{type:Object,default:null},container:{type:String,require:!0},gap:{type:Number,default:16},lazy:{type:Boolean,default:!1},type:{type:String,default:""},actived:{type:Boolean,default:!0},cols:{type:Number,default:7},fromPage:{type:String,default:""},isFromRelated:{type:Boolean,default:!1},isShowNullRelatedImg:{type:Boolean,default:!1},alreadyNoMoreData:{type:Boolean,default:!1},noSearchData:{type:Boolean,default:!1},isCheck:{type:Boolean,default:!1},dislikeShow:{type:Boolean,default:!1},hidethumbup:{type:Boolean,default:!1},hidecollect:{type:Boolean,default:!1},hoverShow:{type:Boolean,default:!1},imgQuality:{type:String,default:"low"},isTiemRow:{type:Boolean,default:!1},openWin:{type:Boolean,default:!1},checkMax:{type:Number,default:-1},category:{type:Boolean,default:!1},dotReportInfo:{type:Object,default:function(){return{category:"default",view_domain:"",batch_id:""}}},scrollContainerClassName:{type:String,default:""},scrollContentTop:{type:Number,default:0},selectList:{type:Array,default:function(){return[]}}},data:function(){var e=this;return{formatNumberForeign:k.i,copyTextToClipboard:k.d,saveImg:k.z,width:0,heights:[],dataList:[],resizeListener:Object(wo.a)((function(){return e.resize(e.dataList)}),500),selfCols:4,isCollecting:!1,imagePopoverVisible:!1,reportLoading:!1,openWatch:!0,isDelete:!1,sharevisible:!1,popTime:0,itemShow:!1,itemShowId:"",checkList:{ids:[],collectIds:[],folderNos:[],url:[],info:[]},isCheckAll:!1,scrollTop:0,lastTime:null,appeaData:{obj_no:"",obj_type:1,remark:""},appealShow:!1,collectDotReportInfo:{}}},watch:{appealShow:{handler:function(e){e||(this.appeaData={obj_no:"",obj_type:1,remark:""})}},isCheck:{handler:function(e){this.isCheckAll=!1,this.dataList.forEach((function(e){e.isCheck=!1})),this.checkList={ids:[],collectIds:[],folderNos:[],url:[],info:[]},this.$emit("getChecList",this.checkList)}},list:{handler:function(e,t){this.updateList(e,t)}},WaterFallDeleteLits:{handler:function(e){this.isDelete=!0}},scrollContentTop:{handler:function(e){this.scrollTop=this.scrollContentTop||0},immediate:!0,deep:!0}},computed:Io(Io(Io({},Object(S.c)("user",["isLoggedIn","accountSettingsData"])),Object(S.e)("user",["userInfo","accountData","adminOff"])),{},{greenMode:function(){var e;return 2!==(null==this||null===(e=this.accountData)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.green_mode)},enableGreenMode:function(){return this.greenMode&&!["/personal"].includes(this.$route.path)},checkIsShowViewNsfw:function(){var e;return null==this||null===(e=this.userInfo)||void 0===e?void 0:e.enable_nsfw_plus},enableNsfwMode:function(){var e;return![2,"2"].includes(null==this||null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.nsfw_plus)},isShowNsfw:function(){return function(e){return this.category&&this.checkIsShowViewNsfw&&!this.enableNsfwMode&&1!==e.nsfw&&(null==e?void 0:e.is_nsfw_plus)}},isPC:function(){return"PC"===localStorage.getItem("visitFrom")},setDeffBoxShow:function(){return function(e){return 2==e.status||5==e.status||((e.author&&e.author.id)!=this.userInfo.id&&"personal"!=this.fromPage?"artwork"==this.type&&1==e.primary:void 0)}},renderList:function(){return this.dynamicList(this.dataList)}}),activated:function(){var e=this;this.openWatch=!0,this.resizeListener(),window.addEventListener("resize",this.resizeListener),this.lazy&&document.addEventListener("scroll",this.lazyLoad),this.$nextTick((function(){window.scrollTo(0,e.scrollTop)}))},deactivated:function(){this.openWatch=!1,window.removeEventListener("resize",this.resizeListener),window.removeEventListener("scroll",this.lazyLoad)},mounted:function(){var e=this;window.addEventListener("resize",this.resizeListener),this.lazy,this.$nextTick((function(){e.checkList.ids=e.selectList.map((function(e){return e.id})),e.checkList.url=e.selectList.map((function(e){return e.url})),(e.list||[]).forEach((function(t){var n;t.isCheck=e.checkList.url.includes(null==t||null===(n=t.banner)||void 0===n?void 0:n.url)})),(e.dataList||[]).forEach((function(t){var n;t.isCheck=e.checkList.url.includes(null==t||null===(n=t.banner)||void 0===n?void 0:n.url)})),e.updateList(e.list)}))},beforeDestroy:function(){window.removeEventListener("resize",this.resizeListener)},methods:Io(Io({},Object(S.b)("user",["getAccountInfo"])),{},{handleBeforeUpload:function(e){return this.$emit("openCustomUpload","local",e),!1},updateList:function(e,t){var n=this.openWatch,o=this.width;if(n){o&&0!=o||(this.width=this.getWidth());var l=J()(e);if(this.dataList.length<100)this.updateDataList(l,!1);else if(l.length>this.dataList.length){var r=Object(R.a)(l.slice(this.dataList.length));this.updateDataList(r,!0)}else l.length<=this.dataList.length&&(this.dataList=[],this.updateDataList(l,!1))}},refreshCheck:function(){var e=this;this.$nextTick((function(){e.checkList.ids=e.selectList.map((function(e){return null==e?void 0:e.id})),e.checkList.url=e.selectList.map((function(e){return null==e?void 0:e.url})),(e.list||[]).forEach((function(t){var n;t.isCheck=e.checkList.url.includes(null==t||null===(n=t.banner)||void 0===n?void 0:n.url)})),(e.dataList||[]).forEach((function(t){var n;t.isCheck=e.checkList.url.includes(null==t||null===(n=t.banner)||void 0===n?void 0:n.url)})),e.updateList(e.list)}))},goToDetail:function(e){e.name?window.open("/models/detail/".concat(e.id),"_blank"):window.open("/explore/detail/".concat(e.id),"_blank")},goToPersonal:function(e){var t;if(this.isLoggedIn){var n=e.author.id,o=null===(t=this.userInfo)||void 0===t?void 0:t.id,path="/user/"+encodeURIComponent(n);o==n&&(path="/personal"),window.open(path,"_blank")}else this.$EventBus.$emit("openLoginDialog")},dynamicList:function(e){var t=this.containerForImg||this.$parent.$refs[this.container]||document.querySelectorAll(".".concat(this.scrollContainerClassName,">.").concat(this.container))[0];if(!t)return e;var n=this.scrollTop-t.offsetTop;return e.filter((function(e){return n-e.top<1500&&e.top-n<2e3}))},getItemTime:function(e){var t=new Date(e),n=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0");return"".concat(n,"-").concat(o)},processTimeGroups:function(e){for(var i=0;i<e.length;i++){var t,n,o,l,r=e[i];if(null!=r&&null!==(t=r.folder_no)&&void 0!==t&&t.collect_at)if(this.getItemTime(null==r||null===(n=r.folder_no)||void 0===n?void 0:n.collect_at)!==this.lastTime)e.splice(i,0,{timeItem:this.getItemTime(null==r||null===(o=r.folder_no)||void 0===o?void 0:o.collect_at)}),this.lastTime=this.getItemTime(null==r||null===(l=r.folder_no)||void 0===l?void 0:l.collect_at)}return e},updateDataList:function(e,t){var n=this,o=this.dataList,l=this.isCheckAll,r=this.checkList,c=this.WaterFallDeleteLits,d=this.width;e.forEach((function(e){o.forEach((function(t){e.id==t.id&&(e.collect=t.collect,e.isCheck=t.isCheck,e.liked=t.liked)}))}));var h,m,v=e.filter((function(e){return!c.includes(e.id)}));this.isTiemRow&&(t||(this.lastTime=null),this.processTimeGroups(v));for(var i=0;i<v.length;i++){var f=v[i];if(f.timeItem)f.waterWidth=d,f.waterHeight=30;else{var _,y,w,C,k;if(this.$set(f,"hoverd",!1),this.$set(f,"propS",!1),this.$set(f,"rowIndex",-1),!l&&r.ids.includes(f.id)?this.$set(f,"isCheck",r.ids.includes(f.id)):this.$set(f,"isCheck",!!l),l&&!r.ids.includes(f.id))r.ids.push(f.id),null!=f&&null!==(w=f.collect)&&void 0!==w&&w.id&&r.collectIds.push(f.collect.id),null!=f&&null!==(C=f.folder_no)&&void 0!==C&&C.id&&r.folderNos.push(f.folder_no.id),null!=f&&null!==(k=f.banner)&&void 0!==k&&k.url&&r.url.push(f.banner.url),f&&r.info.push(f);f.timeDiff=Object(Co.c)(f.created_at,Date.now()),f.waterWidth=d,this.isTiemRow||"gallery"===this.type?f.waterHeight=d:(h=f.banner&&f.banner.width?f.banner.width:308,m=f.banner&&f.banner.height?f.banner.height:308,f.waterHeight=parseInt(m*d/h),isNaN(f.waterHeight)&&(f.waterHeight=320)),null===(_=f.banner)||void 0===_||!_.url||null!==(y=f.banner)&&void 0!==y&&y.replaceUrl||(f.banner.replaceUrl=f.banner.url),f.errorTime=0}}t?v.forEach((function(e){n.dataList.push(e)})):this.dataList=v,this.waterfall()},checkAll:function(){var e=this;if(this.isCheck){var t=this.dataList.filter((function(e){return!e.timeItem}));this.checkList.ids.length<t.length?(t.forEach((function(t){t.isCheck=!0,e.checkChange(t)})),this.isCheckAll=!0):(t.forEach((function(t){t.isCheck=!1,e.checkChange(t)})),this.isCheckAll=!1)}},clearCheck:function(e){var t=this;e.forEach((function(e){t.dataList.forEach((function(t){e==t.id&&(t.isCheck=!1)})),t.checkList.ids.forEach((function(n,o){e!==n&&e.id!==n||(t.checkList.ids.splice(o,1),t.checkList.collectIds.splice(o,1),t.checkList.folderNos.splice(o,1),t.checkList.url.splice(o,1),t.checkList.info.splice(o,1))}))})),this.$emit("getChecList",this.checkList)},checkChange:function(e){if(e.isCheck){var t,n,o;if(!this.checkList.ids.includes(e.id))this.checkList.ids.push(e.id),null!=e&&null!==(t=e.collect)&&void 0!==t&&t.id&&this.checkList.collectIds.push(e.collect.id),null!=e&&null!==(n=e.folder_no)&&void 0!==n&&n.id&&this.checkList.folderNos.push(e.folder_no.id),null!=e&&null!==(o=e.banner)&&void 0!==o&&o.url&&this.checkList.url.push(e.banner.url),e&&this.checkList.info.push(e)}else{var l,r,c;if(-1==this.checkList.ids.indexOf(e.id))return;if(this.checkList.ids.splice(this.checkList.ids.indexOf(e.id),1),null!=e&&null!==(l=e.collect)&&void 0!==l&&l.id&&this.checkList.collectIds.splice(this.checkList.collectIds.indexOf(e.collect.id),1),null!=e&&null!==(r=e.folder_no)&&void 0!==r&&r.id&&this.checkList.folderNos.splice(this.checkList.folderNos.indexOf(e.folder_no.id),1),null!=e&&null!==(c=e.banner)&&void 0!==c&&c.url&&this.checkList.url.splice(this.checkList.url.indexOf(e.banner.url),1),e){var d=this.checkList.info.findIndex((function(t){return t.id===e.id}));this.checkList.info.splice(d,1)}}this.$emit("getChecList",this.checkList)},changeItemShow:function(e){this.itemShow=e.show,this.itemShowId=e.id,this.handleCollectPopoverClick(e)},moreActions:function(e,t){var n=this;switch(e){case"flag":this.reportArtwork(t.id);break;case"save":this.downloadImg(t);break;case"share":this.sharevisible=!0,this.popTime=setTimeout((function(){n.sharevisible=!1}),1e3);var o="".concat(window.location.origin,"/")+"explore/detail/".concat(t.id);this.$message.success(this.$t("CopiedURLToClipboard")),this.copyTextToClipboard(o);break;case"delete":this.handleWorkDelete(t);break;case"not_interested":Object(de.g)({items:[{action:"not_interested",obj_no:t.id,obj_type:1}]}).then((function(e){var o,l;1e4==(null==e||null===(o=e.status)||void 0===o?void 0:o.code)?(n.$message({message:n.$t("reduceWork"),type:"success"}),t.propS=!1,n.setWaterFallDeleteLits(t.id),n.resizeListener()):n.$message({message:(null==e||null===(l=e.status)||void 0===l?void 0:l.msg)||n.$t("ServerError"),type:"error"})}));break;case"setBg":Object(ue.s)({id:t.id}).then((function(e){var o;if(1e4==(null==e||null===(o=e.status)||void 0===o?void 0:o.code))n.$message({message:n.$t("SetSuccess"),type:"success"}),t.propS=!1,n.getAccountInfo();else{var l,r,c=n.$t("ServerError");if(20309==(null==e||null===(l=e.status)||void 0===l?void 0:l.code))c=n.$t("SetBgLimit");else c=null==e||null===(r=e.status)||void 0===r?void 0:r.msg;n.$message({message:c,type:"error"})}}));break;case"appeal":this.appeaData.obj_no=t.id,this.appealShow=!0}},downloadImg:function(e){var t=this.getImageExtensionFromUrl(e.banner.url),n=(e.author?e.id:"image")+"".concat(t);this.saveImg(e.banner.url,n)},getImageExtensionFromUrl:function(e){var t=e.match(/\/([^/]+)$/);return t&&t[1].includes(".")?"."+t[1].split(".").pop().toLowerCase():".jpeg"},handleWorkDelete:function(e){var t=this;this.$confirm(this.$t("deleteConfirm"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){var n={id:e.id};t.globalLoading=!0,Object(ko.a)(n).then((function(n){var o,l;1e4==(null==n||null===(o=n.status)||void 0===o?void 0:o.code)?(t.$message({message:t.$t("deleteSuccess"),type:"success"}),t.setWaterFallDeleteLits(e.id),t.resizeListener()):t.$message({message:(null==n||null===(l=n.status)||void 0===l?void 0:l.msg)||t.$t("ServerError"),type:"error"})})).finally((function(){t.globalLoading=!1}))})).catch((function(e){console.log("err",e)}))},handleContextMenu:function(e,t){1===t.nsfw&&e.preventDefault()},reportArtwork:function(e){var t=this;this.reportLoading||(this.reportLoading=!0,Object(de.o)({id:e}).then((function(e){var code=e&&e.status?e.status.code:"";[1e4].includes(code)&&F()({message:t.$t("ReportSuccess"),type:"success",duration:5e3})})).finally((function(){t.reportLoading=!1})))},handleClick:function(e,t,n){if(this.isLoggedIn){var o=this.list.findIndex((function(i){return i.id===e.id})),l=(o<10?this.list.slice(0,o):this.list.slice(o-10,o)).map((function(e){return e.id})).filter((function(e){return"banner"!=e&&"ai_tool"!=e}));switch(t){case"创作":Object(de.g)({items:[Io(Io({},this.dotReportInfo),{},{negative_ids:l,action:"task",obj_no:e.id,obj_type:1})]});var r=Object.assign({},e);"model"===this.type&&["explore","personal"].includes(this.fromPage)&&(r.taskSource=1),this.$EventBus.$emit("openGenerate",{action:1,data:{source:r}});break;case"收藏":Object(de.g)({items:[Io(Io({},this.dotReportInfo),{},{negative_ids:l,action:"collection",obj_no:e.id,obj_type:1})]}),this.setCollect(e,n)}}else this.$EventBus.$emit("openLoginDialog")},handleCollectPopoverClick:function(e){var t=this.list.findIndex((function(i){return i.id===e.id})),n=(t<10?this.list.slice(0,t):this.list.slice(t-10,t)).map((function(e){return e.id})).filter((function(e){return"banner"!=e&&"ai_tool"!=e}));this.collectDotReportInfo=Io(Io({},this.dotReportInfo),{},{negative_ids:n,action:"collection",obj_no:e.id,obj_type:1})},handleLinkUpload:function(e,t){if("upload"===(null==t?void 0:t.customType))return this.$emit("openLinkUpload","link"),!1},handleDelete:function(e){this.$emit("deleteUploadImage",e)},handleChange:function(){},handleDetail:function(e,t){var n=this;if("upload"===(null==t?void 0:t.customType))return!1;if(this.isCheck){if(-1==this.checkMax||this.checkList.ids.length<this.checkMax)this.checkList.ids.length==this.dataList.length&&(this.isCheckAll=!0),t.isCheck&&(this.isCheckAll=!1),t.isCheck=!t.isCheck;else if(t.isCheck)this.checkList.ids.length==this.dataList.length&&(this.isCheckAll=!0),t.isCheck&&(this.isCheckAll=!1),t.isCheck=!t.isCheck;else{var o;if(1===this.checkMax)return((null===(o=this.checkList)||void 0===o?void 0:o.ids[0])||"")&&this.dataList.forEach((function(e){n.$set(e,"isCheck",!1)})),void(t.isCheck=!t.isCheck);this.$message({message:this.$t("已超过最大选择上限"),type:"warning"})}return!1}if(this.$logEvent("log_actions",{operation:{artwork:"click_image",model:"click_model",gallery:"click_gallery"}[this.type],behavior_info:t.id}),"activity"!==this.type)if("IMG"!==e.target.tagName&&"cltpop"!==e.target.className&&"img-content"!==e.target.className&&"statusZg"!==e.target.className&&"workInfo"!==e.target.className||"model"!==this.type)if("IMG"!==e.target.tagName&&"cltpop"!==e.target.className&&"img-content"!==e.target.className&&"statusZg"!==e.target.className&&"workInfo"!==e.target.className&&"green-mode-div"!==e.target.className||"artwork"!==this.type)"IMG"!==e.target.tagName&&"img-content"!==e.target.className&&"statusZg"!==e.target.className&&"workInfo"!==e.target.className||"gallery"!==this.type||(Object(de.g)({items:[{action:"view",obj_no:t.id,obj_type:4}]}),this.$router.push("/artWorkDetail/"+t.id));else{if(this.checkGreen(t))return void this.$EventBus.$emit("openLoginDialog",{redirect:"/explore/detail/"+t.id});var l=this.list.findIndex((function(i){return i.id===t.id})),r=(l<10?this.list.slice(0,l):this.list.slice(l-10,l)).map((function(e){return e.id})).filter((function(e){return"banner"!=e&&"ai_tool"!=e}));Object(de.g)({items:[Io(Io({},this.dotReportInfo),{},{negative_ids:r,action:"view",obj_no:t.id,obj_type:1})]}),this.openWin?window.open("/explore/detail/"+t.id,"_blank"):this.$router.push("/explore/detail/"+t.id)}else 3==t.status||4==t.status?this.$router.push({path:"/models/detail/".concat(t.id),query:{type:"other"}}):this.$router.push("/models/detail/".concat(t.id))},imgError:function(e){e.errorTime++,e.errorTime>=2||(this.$refs[e.id][0].src=e.banner.url)},waterfall:function(){var e=this;try{this.heights=[];for(var t=function(){var t=e.dataList[i],n=t.waterHeight,o="artwork"==e.type?0:70;if(t.timeItem){t.left=0;var l=e.getMaxIndex(e.heights);t.top=l>-1?e.heights[l]+e.gap:0,e.heights.forEach((function(l,r){e.heights[r]=t.top+n+o}))}else if(e.heights.length<e.selfCols)if(e.dataList[i-1]&&e.dataList[i-1].timeItem)if(t.left=0,t.top=e.dataList[i-1].top+e.dataList[i-1].waterHeight+e.gap,e.heights[0]){var r=e.heights[0]+n;e.heights=[r+e.gap]}else e.heights.push(t.top+n+o);else t.top=e.dataList[i-1]?e.dataList[i-1].top:0,t.left=e.heights.length*(e.width+e.gap),e.heights.push(t.top+n+o);else{var c=e.getMinIndex(e.heights),d=e.heights[c]+e.gap;t.top=d,t.left=c*(e.width+e.gap),e.heights[c]=d+n+o}},i=0;i<this.dataList.length;i++)t();this.setWaterFallRect()}catch(e){}},getWidth:function(){var e,t;this.selfCols=this.cols;var n=this.containerForImg?this.containerForImg.offsetWidth:(null===(e=this.$parent.$refs[this.container])||void 0===e?void 0:e.offsetWidth)||(null===(t=document.querySelectorAll(".".concat(this.scrollContainerClassName,">.").concat(this.container))[0])||void 0===t?void 0:t.offsetWidth);n||(n=1236),n<1700&&(this.selfCols=6),n<1500&&(this.selfCols=5),n<1240&&(this.selfCols=5),n<980&&(this.selfCols=4),n<730&&(this.selfCols=4),n<500&&this.isPC&&(this.selfCols=1);var o=~~((n-this.selfCols*this.gap-this.gap+32)/this.selfCols);return this.isPC,o>176?o:176},setWaterFallRect:function(){var e=this.containerForImg||this.$parent.$refs[this.container]||document.querySelectorAll(".".concat(this.scrollContainerClassName,">.").concat(this.container))[0],t=Math.max.apply(null,this.heights);this.list.length&&(e.style.height=t+"px",e.style.marginBottom="130px")},getMinIndex:function(e){var t=Math.min.apply(null,e);return e.indexOf(t)},getMaxIndex:function(e){var t=Math.max.apply(null,e);return e.indexOf(t)},resize:function(e){var t=this;if(this.openWatch){var n,o;if(this.containerForImg){if(this.containerForImg.offsetWidth<600)return}else if((null===(n=this.$parent.$refs[this.container])||void 0===n?void 0:n.offsetWidth)<600||(null===(o=document.querySelectorAll(".".concat(this.scrollContainerClassName,">.").concat(this.container))[0])||void 0===o?void 0:o.offsetWidth)<600)return;this.dataList=J()(e).filter((function(e){return!t.WaterFallDeleteLits.includes(e.id)})),this.width=this.getWidth(),this.dataList.forEach((function(e){if(e.timeItem)e.waterWidth=t.width,e.waterHeight=30;else{var n,o;if(t.$set(e,"hoverd",!1),e.timeDiff=Object(Co.c)(e.created_at,Date.now()),e.waterWidth=t.width,t.isTiemRow||"gallery"===t.type)e.waterHeight=t.width;else null!=e&&null!==(o=e.banner)&&void 0!==o&&o.width&&(e.waterHeight=parseInt(t.width/(e.banner.width/e.banner.height))),isNaN(e.waterHeight)&&(e.waterHeight=320);null!=e&&null!==(n=e.banner)&&void 0!==n&&n.replaceUrl&&(e.banner.replaceUrl=e.banner.url),e.errorTime=0}})),this.waterfall()}},lazyLoad:function(){this.actived&&this.openWatch},initials:function(e){return e.split(" ").map((function(e){return e[0]})).join("")},otherUser:function(e,t){var path=t?"/user/"+encodeURIComponent(e.author.id)+"?type=gather":"/user/"+encodeURIComponent(e.author.id);this.userInfo.id==e.author.id&&(path="/personal?tab=gather"),this.openWin?window.open(path,"_blank"):this.$router.push(path)},getPersonalInfoUrl:function(e){var path="/user/"+encodeURIComponent(e.author.id);return this.userInfo.id==e.author.id&&(path="/personal"),path},checkGreen:function(e){return!this.isLoggedIn&&!(null==e||!e.green||![2,"2"].includes(e.green))}})},To=Oo,$o=(n(3079),n(3080),Object(y.a)(To,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"waterfall-container"},[e._l(e.renderList,(function(n,o){var l,r,c,d,h,m;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:null==n?void 0:n.uploading,expression:"item?.uploading"}],key:n.top+","+n.left,staticClass:"waterfall-item",class:{"waterfall-dialog":e.containerForImg},style:{top:n.top+"px",left:n.left+"px"},on:{click:function(t){return t.stopPropagation(),e.handleDetail(t,n)},contextmenu:function(t){return e.handleContextMenu(t,n)}}},["upload"===(null==n?void 0:n.customType)?t("span",{staticClass:"custom-upload-by-link",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handleLinkUpload(t,n)}}},[e._v(e._s(e.$t("TaskUploadImageFromUrl")))]):e._e(),e._v(" "),"upload"===(null==n?void 0:n.customType)?t("span",{staticClass:"custom-upload-icon iconfont icon-icon_Upload"}):e._e(),e._v(" "),"upload"!==(null==n?void 0:n.customType)&&"upload"===e.currentTab?t("span",{staticClass:"custom-upload-delete-btn",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handleDelete(n)}}},[t("i",{staticClass:"iconfont icon-postDelete"})]):e._e(),e._v(" "),e.setDeffBoxShow(n)?t("div",{staticClass:"deffBox",style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}},[t("div",[e._v(e._s(e.$t("PictureInvalid")))]),e._v(" "),t("div",[t("i",{staticClass:"el-icon-warning-outline"}),e._v(" "),t("span",[e._v(e._s(e.$t("PictureHidden")))])]),e._v(" "),e.isCheck&&n?t("listCheckbox",{on:{change:function(t){return e.checkChange(n)}},model:{value:n.isCheck,callback:function(t){e.$set(n,"isCheck",t)},expression:"item.isCheck"}}):e._e()],1):n.timeItem?t("div",{staticClass:"timeRow",style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}},[e._v("\n      "+e._s(n.timeItem)+"\n    ")]):t("div",{staticClass:"listCnt marking-item",class:[1===n.banner.nsfw||e.isShowNsfw(n.banner)?"bg-nsfw":""]},[[2,"2"].includes(n.green)&&e.enableGreenMode?t("div",{staticClass:"green-mode-div",staticStyle:{"backdrop-filter":"blur(19px) saturate(160%)",position:"absolute",left:"0",top:"0"},style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}}):e._e(),e._v(" "),t("div",{staticClass:"img-content",style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}},["upload"===(null==n?void 0:n.customType)?t("el-upload",{ref:"imageUpload3",refInFor:!0,staticClass:"custom-image-upload",attrs:{action:"#",drag:"","before-upload":e.handleBeforeUpload,"on-change":e.handleChange,accept:".jpg,.png,.jpeg,.webp",multiple:"",limit:1,"http-request":function(){},"show-file-list":!1}},[t("i",{staticClass:"iconfont icon-icon_Upload image-upload-icon",staticStyle:{display:"none"},attrs:{slot:"trigger"},slot:"trigger"})]):e._e(),e._v(" "),"upload"!==(null==n?void 0:n.customType)&&6==n.type&&1!=n.banner.nsfw?t("video",{ref:"mainVideo",refInFor:!0,staticClass:"cntVideo",attrs:{src:null===(l=n.banner)||void 0===l?void 0:l.url,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0}}):"upload"!==(null==n?void 0:n.customType)&&1!=n.banner.nsfw?t("el-image",{staticClass:"cntImg",style:{transform:n.isCheck?"scale(0.85)":null,filter:e.showNs||(e.category?!(null!=n&&null!==(r=n.banner)&&void 0!==r&&r.is_nsfw_plus&&null!==(c=e.userInfo)&&void 0!==c&&c.enable_nsfw_plus&&[2,"2"].includes(null===(d=e.userInfo)||void 0===d||null===(d=d.settings)||void 0===d?void 0:d.nsfw_plus)):null==n||null===(h=n.banner)||void 0===h||!h.is_nsfw_plus)?"":"blur(19px) saturate(160%)"},attrs:{src:null===(m=n.banner)||void 0===m?void 0:m.replaceUrl,fit:"cover",lazy:""}},[t("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture-outline"})])]):e._e()],1),e._v(" "),3==n.status||4==n.status?t("div",{staticClass:"statusCnt"},[t("div",{staticClass:"statusZg"}),e._v(" "),t("div",{staticClass:"statusBox",style:{color:4==n.status?"#EF3B3B":"#ffffff"}},[t("i",{staticClass:"iconfont icon-statusBox"}),e._v(" "),t("div",[e._v(e._s(4==n.status?e.$t("notApproved"):e.$t("underReview")))])])]):e._e(),e._v(" "),e.isCheck&&n?t("listCheckbox",{on:{change:function(t){return e.checkChange(n)}},model:{value:n.isCheck,callback:function(t){e.$set(n,"isCheck",t)},expression:"item.isCheck"}}):t("div",[t("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"shade"},[t("p",[e._v(e._s(e.$t("NotPass"))+" "+e._s(e.$t("Auditing")))])]),e._v(" "),("artwork"==e.type?3!=n.type:1==n.status&&"gallery"!==e.type&&"activity"!==e.type)?t("div",{staticClass:"waterfall-hover-try",class:{"prompt-show":!e.isLoggedIn},on:{click:function(t){return t.preventDefault(),e.handleClick(n,"创作")}}},[e._v("\n          "+e._s("artwork"==e.type?e.$t("Remix"):e.$t("Try"))+"\n        ")]):e._e(),e._v(" "),e.isLoggedIn&&1==n.status&&"gallery"!==e.type&&"activity"!==e.type?t("CollectPopover",{staticClass:"CollectPop",attrs:{type:e.type,folder:n,dotReportInfo:e.collectDotReportInfo,from:"waterfall"},on:{showChaneg:e.changeItemShow}}):e._e(),e._v(" "),e.isLoggedIn&&1==n.status&&"gallery"!==e.type&&"activity"!==e.type?t("div",{staticClass:"cltpop",style:{opacity:e.itemShow&&e.itemShowId==n.id?1:0}}):e._e(),e._v(" "),"artwork"===e.type&&n.waterHeight>200?t("div",[t("div",{staticClass:"waterfall-hover-photo"},[t("div",{staticClass:"hoverTop"},[t("span",[e._v(e._s(n.type&&1!=n.type&&3!=n.type?"/grid":"/upscale"))]),e._v(" "),n?t("div",{staticClass:"moreEdit"},[e.isLoggedIn?[t("el-popover",{key:o,ref:"myPopover",refInFor:!0,attrs:{placement:"top-end","popper-class":"water-fall-popover","append-to-body":!1,"visible-arrow":!1,"popper-options":{boundariesElement:"body"},width:"100",trigger:"click"},model:{value:n.propS,callback:function(t){e.$set(n,"propS",t)},expression:"item.propS"}},[t("div",{staticClass:"pop-btns flex"},[t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("flag",n)}}},[e._v("\n                        "+e._s(e.$t("Report"))+"\n                      ")]),e._v(" "),t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("save",n)}}},[e._v("\n                        "+e._s(e.$t("SaveImage"))+"\n                      ")]),e._v(" "),t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("share",n)}}},[e._v("\n                        "+e._s(e.$t("ShareLink"))+"\n                      ")]),e._v(" "),!e.dislikeShow||n.author&&n.author.id==e.userInfo.id?e._e():t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("not_interested",n)}}},[e._v("\n                        "+e._s(e.$t("dislike"))+"\n                      ")]),e._v(" "),n.author&&n.author.id==e.userInfo.id&&n.banner.a_a?t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("appeal",n)}}},[e._v("\n                        "+e._s(e.$t("appeal"))+"\n                      ")]):e._e(),e._v(" "),n.author&&n.author.id==e.userInfo.id?t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("delete",n)}}},[e._v("\n                        "+e._s(e.$t("Delete"))+"\n                      ")]):e._e()]),e._v(" "),t("div",{class:{"login-waterFall-btn-icon":e.isLoggedIn,"noLogin-waterFall-collect-icon prompt-show":!e.isLoggedIn},attrs:{slot:"reference"},slot:"reference"},[t("i",{staticClass:"iconfont icon-more"})])])]:e._e()],2):e._e()]),e._v(" "),3!=n.type?t("div",{staticClass:"hoverMiddle"},[e._v("\n              "+e._s(n.prompt)+"\n            ")]):e._e()])]):e._e(),e._v(" "),"model"===e.type&&n.base_model.includes("SDXL")?t("div",{staticClass:"modelPoint"},[e._v("\n          "+e._s((null==n?void 0:n.type)+" | XL ")+"\n        ")]):"model"===e.type?t("div",{staticClass:"modelPoint"},[e._v(e._s(null==n?void 0:n.type))]):e._e()],1),e._v(" "),"activity"===e.type?t("div",{staticClass:"activity",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.goToDetail(n)}}},[n.name?t("div",{staticClass:"top-container"},[t("div",{staticClass:"name"},[e._v(e._s(n.name))])]):e._e(),e._v(" "),t("div",{staticClass:"personal-info"},[t("div",{staticClass:"left-info",style:{width:n.name?"100%":"calc(100% - 68px)"}},[n.author.head?t("img",{staticClass:"avatorClass",attrs:{decoding:"async",loading:"lazy",src:n.author.head,alt:""},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.goToPersonal(n)}}}):t("div",{staticClass:"avatorClass",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.goToPersonal(n)}}},[e._v("\n              "+e._s(e.initials(n.author.name||n.author.id))+"\n            ")]),e._v(" "),t("span",{staticClass:"ellipsis-text",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.goToPersonal(n)}}},[e._v("\n              "+e._s(n.author.name||n.author.id)+"\n            ")])])])]):e._e()],1),e._v(" "),"model"===e.type?t("div",{staticClass:"waterfall-hover-model"},[t("span",{staticClass:"ellipsis-text modelName"},[e._v(e._s(n.name))]),e._v(" "),t("div",{staticClass:"hoverBottom"},[n.author?t("div",{staticClass:"flex-center",staticStyle:{"max-width":"50%"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.otherUser(n)}}},[n.author.head?t("img",{staticClass:"avatorClass",attrs:{decoding:"async",loading:"lazy",src:n.author.head,alt:""}}):n.author?t("div",{staticClass:"avatorClass"},[e._v("\n            "+e._s(e.initials(n.author.name||n.author.id))+"\n          ")]):e._e(),e._v(" "),t("span",{staticClass:"ellipsis-text"},[e._v(e._s(n.author.name))])]):t("div"),e._v(" "),1==n.status?t("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center"}}):e._e()])]):e._e()])})),e._v(" "),e.isShowNullRelatedImg?t("div",{staticClass:"null-data-container"},[t("img",{staticClass:"null-image",attrs:{src:n(289),alt:"null_related_image"},on:{load:function(t){return e.$emit("solveScrollbarStyle")}}}),e._v(" "),t("div",{staticClass:"null-tips"},[e._v(e._s(e.$t("NoRelatedWorks")))])]):e._e(),e._v(" "),e.alreadyNoMoreData?t("div",{staticClass:"at-bottom"},[t("div",{staticClass:"dashed-line"}),e._v(" "),t("div",{staticClass:"tips"},[e._v(e._s(e.$t("NoMoreData")))]),e._v(" "),t("div",{staticClass:"dashed-line"})]):e._e(),e._v(" "),e.noSearchData?t("div",{staticClass:"no-search-data-container"},[t("img",{staticClass:"no-search-image",attrs:{src:n(290),alt:"no search data"}}),e._v(" "),t("div",{staticClass:"null-tips"},[e._v(e._s(e.$t("NoSearchData")))])]):e._e(),e._v(" "),t("el-dialog",{attrs:{title:e.$t("appeal"),visible:e.appealShow,width:"500px","modal-append-to-body":!1,"close-on-click-modal":!1,"custom-class":"SaDialog"},on:{"update:visible":function(t){e.appealShow=t}}},[t("div",{staticClass:"appealCnt"},[t("el-input",{attrs:{type:"textarea",placeholder:e.$t("enterAppealCnt"),maxlength:"50","show-word-limit":""},model:{value:e.appeaData.remark,callback:function(t){e.$set(e.appeaData,"remark",t)},expression:"appeaData.remark"}})],1),e._v(" "),t("div",{staticClass:"bntitem",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.appealShow=!1}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("el-button",{attrs:{loading:e.isAppealLoading},on:{click:function(t){return e.setResourceAppeal(e.appeaData)}}},[e._v(e._s(e.$t("Submit")))])],1)])],2)}),[],!1,null,"96bb1ac4",null).exports),Lo={name:"LinkUploadModal",props:{value:{type:Object,default:function(){return{}}}},components:{SliderItem:Ln.a},data:function(){return{visible:!1,uploading:!1,linkInput:"",imageInfo:{url:"",width:0,height:0}}},computed:{},methods:{show:function(){this.initData(),this.visible=!0},initData:function(){},handleClose:function(){this.uploading||(this.visible=!1)},handleConfirm:function(){this.$emit("linkImage",this.imageInfo),this.handleClose(),this.linkInput="",this.uploading=!1},handleLinkUpload:function(){this.checkIsImageURL(this.linkInput)?this.uploadImageByLink(this.linkInput):this.$message.warning(this.$t("InputNotAnImageLink"))},closeLinkUploadModal:function(){this.linkInput="",this.uploading=!1},uploadImageByLink:function(){var e=this,t={url:arguments.length>0&&void 0!==arguments[0]?arguments[0]:""};this.uploading||(this.uploading=!0,Object(A.x)(t,"link").then(function(){var t=Object(E.a)(regeneratorRuntime.mark((function t(n){var o,code,l,r,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.uploading=!1,o=(n||{data:{}}).status.code,![1e4,"10000"].includes(code=void 0===o?"":o)){t.next=12;break}return l=n.data.access_url,e.imageInfo.url=l,t.next=7,Object(k.l)(l);case 7:r=t.sent,e.imageInfo=Object.assign(e.imageInfo,r||{}),e.handleConfirm(),t.next=14;break;case 12:c=30003===code?"UploadImageExceed5MB":"GainFail",e.$message.error(e.$t(c));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).finally((function(t){e.uploading=!1})))},checkIsImageURL:function(e){return/^https?:\/\/.*\.(jpg|jpeg|png|webp)$/i.test(e)}}},Po=Lo,Mo=(n(3081),{name:"PickOrUploadImageModal",components:{WaterFallVue:$o,LinkUploadModal:Object(y.a)(Po,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,"custom-class":"easy-link-upload-modal custom-dialog","destroy-on-close":!1,"close-on-press-escape":!0,modal:!1,"modal-append-to-body":"",width:"407px"},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"modal-header"},[t("div",{staticClass:"modal-header-title"},[e._v(e._s(e.$t("TaskUploadImageFromUrl")))]),e._v(" "),t("span",{staticClass:"modal-header-close",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[t("i",{staticClass:"el-icon-close"})])]),e._v(" "),t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-content-item"},[t("div",{staticClass:"modal-content-item-label"},[e._v(e._s(e.$t("Link")))]),e._v(" "),t("div",{staticClass:"modal-content-item-content"},[t("el-input",{attrs:{placeholder:e.$t("Link"),disabled:e.uploading,clearable:""},model:{value:e.linkInput,callback:function(t){e.linkInput=t},expression:"linkInput"}})],1)])]),e._v(" "),t("div",{staticClass:"modal-footer"},[t("span",{staticClass:"modal-footer-btn",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("span",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],staticClass:"modal-footer-btn modal-footer-btn-confirm",on:{click:function(t){return t.stopPropagation(),e.handleLinkUpload()}}},[e._v(e._s(e.$t("Confirm")))])])])}),[],!1,null,null,null).exports,commonConfirmModal:un.a},props:{maxNum:{type:Number,default:1},type:{type:String,default:"default"}},data:function(){return{visible:!1,loading:!1,list:[],noMore:!1,queryParam:{keyword:"",page:1,page_size:60,time_to:0,after:0},debounceHandleScroll:null,scrollTop:0,selectList:[],debounceHandleSearch:null,activeTab:"upload",UPLOAD:new pi.a({type:2}),uploading:!1,accept:".jpg,.png,.jpeg,.webp",baseSize:5,extraOption:null,faceCheckResult:null,btnLoading:!1}},computed:{renderList:function(){return"animGen"==this.type?this.list.filter((function(e){return"sdxl"!=e.channel&&"studio"!=e.channel&&6!=e.type})):this.list}},mounted:function(){this.debounceHandleScroll=Object(X.debounce)(this.handleScroll,200),this.debounceHandleSearch=Object(X.debounce)(this.handleSearch,600)},beforeDestroy:function(){this.debounceHandleScroll=null,this.debounceHandleSearch=null},methods:{handleChangeTab:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.activeTab!==e&&!this.loading&&!this.uploading){var t="upload"===e?"click_upload_images_tab":"click_personal_work_tab";this.$logEvent("log_actions",{operation:t,behavior_info:"on_image_upload_popup"}),this.activeTab=e,this.selectList=[],this.resetData(),this.$refs.WaterFallVue.refreshCheck(),"upload"===this.activeTab?this.getLocalList():this.getList()}},handleDeleteImage:function(e){var t=this;this.$refs.commonConfirmModal.show({subTitle:"deleteConfirm"}).then(Object(E.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=t.list.findIndex((function(t){return t.id===e.id})),t.deleteRecentUsedImage(t.list[o]).then((function(e){-1!==o&&t.list.splice(o,1)}));case 3:case"end":return n.stop()}}),n)}))))},openModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.resetData(),this.extraOption=null,"animGen"===this.type&&(this.activeTab="pick"),this.extraOption=t||null,"upload"===this.activeTab?this.getLocalList():this.getList(),this.selectList=e||[],this.visible=!0},handleClose:function(){this.visible=!1},resetData:function(){this.list=[],this.loading=!1,this.queryParam={keyword:"",page:1,page_size:60,time_to:0,after:0},"animGen"===this.type&&(this.queryParam.scene="motion"),this.scrollTop=0,this.noMore=!1,this.selectList=[],this.btnLoading=!1},handleCancel:function(){this.visible=!1},handleSearch:function(){this.loading=!1,this.noMore=!1,this.queryParam.page=1,this.queryParam.time_to=0,this.queryParam.after=0,this.scrollTop=0,this.list=[],this.getList()},handleScroll:function(){var e=this.$refs.handleWorkScroll;this.scrollTop=e.scrollTop||0;try{e&&e.scrollTop+e.clientHeight>=e.scrollHeight-50&&this.getList(!0)}catch(e){}},getList:function(e){var t=this;if(!this.loading&&!this.noMore){this.loading=!0;var n=yo.artworkList;this.queryParam.order_by="new",this.queryParam.artwork_types=[1,4,6],"animGen"==this.type&&(this.queryParam.artwork_types=[1,4]),"character"==this.type&&(this.queryParam.artwork_types=[1,3,4]),"contribute"===this.type&&(this.queryParam.artwork_types=[1,3,4,6],this.queryParam.scene="post"),this.queryParam.type="bookmarks",this.queryParam.category=2;var o=this.queryParam;return new Promise((function(l,r){n(o).then((function(n){if(1e4===n.status.code){var r;if(t.noMore=!n.data.has_more,t.list=e?t.list.concat(n.data.items||[]):n.data.items||[],1===o.page&&n.data.time_ms&&(o.time_to=n.data.time_ms),n.data.items.length>0)t.queryParam.after=null===(r=n.data.items[n.data.items.length-1])||void 0===r||null===(r=r.folder_no)||void 0===r?void 0:r.collect_at;o.page++,l()}})).catch((function(e){r(e)})).finally((function(){t.loading=!1}))}))}},getLocalList:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n={scene:"tf_v2"},e.loading=!0,Object(dn.q)(n).then((function(t){var n;console.log(t);var o=[{id:"upload",banner:{width:268,height:268,url:"https://image.cdn.centcloud.seaart.me/2024-09-02/dev-crap5pdgflik2alqoeig-2/e1e5ee5245caef9f9adf649d960d218d_low.webp"},customType:"upload"}];if(1e4===(null==t||null===(n=t.status)||void 0===n?void 0:n.code)){var l,r=((null==t||null===(l=t.data)||void 0===l?void 0:l.items)||[]).map((function(e){return e.banner={url:null==e?void 0:e.url,width:null==e?void 0:e.width,height:null==e?void 0:e.height},e}));o=[].concat(Object(R.a)(o),Object(R.a)(r))}e.list=o,e.noMore=!0})).finally((function(){e.loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},addRecentUsedImage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";console.log(e,"图片信息···");var n={};n.width=null==e?void 0:e.width,n.height=null==e?void 0:e.height,n.url=(null==e?void 0:e.url)||"",t&&(n.img_category=2),null!=e&&e.artwork_id&&!((null==e?void 0:e.artwork_id)||"").includes("personal_upload_")&&(n.artwork_id=null==e?void 0:e.artwork_id),Object(dn.a)(n).then((function(e){})).finally((function(){}))},deleteRecentUsedImage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return t.url=null==e?void 0:e.url,Object(dn.b)(t)},getCheckList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.selectList=[],(t.url||[]).forEach((function(n,o){e.selectList.push({url:n,id:(null==t?void 0:t.ids[o])||"",type:"check",info:null==t?void 0:t.info[o]})}))},handleLinkImageUpload:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(X.uniqueId)("personal_upload_".concat(Date.now(),"_"));this.updateImageInfo(t,{banner:e,uploading:!1})},handleConfirm:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.selectList.length){t.next=3;break}return e.$message.warning(e.$t("selectOneWork")),t.abrupt("return");case 3:if(null==e||null===(n=e.extraOption)||void 0===n||!n.checkFace){t.next=13;break}return t.next=6,e.checkFaceByLink((null==e||null===(o=e.selectList)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.url)||"");case 6:if(null!==(l=e.faceCheckResult)&&void 0!==l&&l.is_face){t.next=9;break}return e.$message.warning(e.$t("HttpErrorCode_30044")),t.abrupt("return");case 9:return"upload"!==e.activeTab&&e.handleUpdateAddImage(e.selectList[0]),e.$emit("confirm",e.selectList,e.extraOption),e.handleClose(),t.abrupt("return");case 13:"upload"!==e.activeTab&&e.handleUpdateAddImage(e.selectList[0]),e.$emit("confirm",e.selectList,e.extraOption),e.handleClose();case 16:case"end":return t.stop()}}),t)})))()},handleUpdateAddImage:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,source,c,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((c={}).url=(null==(source=e.length>0&&void 0!==e[0]?e[0]:{})?void 0:source.url)||(null==source||null===(o=source.info)||void 0===o||null===(o=o.banner)||void 0===o?void 0:o.url)||"",c.width=null==source||null===(l=source.info)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.width,c.height=null==source||null===(r=source.info)||void 0===r||null===(r=r.banner)||void 0===r?void 0:r.height,c.artwork_id=null==source?void 0:source.id,null!=c&&c.width&&null!=c&&c.height){n.next=12;break}return n.next=9,t.getImageDimensions(c.url);case 9:d=n.sent,c.width=d.width,c.height=d.height;case 12:t.addRecentUsedImage(c);case 13:case"end":return n.stop()}}),n)})))()},checkFaceByLink:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o={scene:"tf_v2_inf_ip_adapter",url:e.length>0&&void 0!==e[0]?e[0]:""},t.btnLoading=!0,n.abrupt("return",Object(dn.d)(o).then((function(e){var n;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&(t.faceCheckResult=Object.assign({},o,(null==e?void 0:e.data)||{}))})).finally((function(){t.btnLoading=!1})));case 4:case"end":return n.stop()}}),n)})))()},handleBeforeUpload:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.UPLOAD,["image/jpeg","image/png","image/webp","image/jpg"].includes(e.type)){n.next=5;break}return t.$message.error(t.$t("AllowImageFiles")),n.abrupt("return",!1);case 5:if(!(l=e)||l.size){n.next=8;break}return n.abrupt("return",!1);case 8:if(l.size/1024/1024<=t.baseSize){n.next=20;break}return n.prev=10,n.next=13,Object(Ut.a)(l,1024*t.baseSize*1024);case 13:l=n.sent,n.next=20;break;case 16:return n.prev=16,n.t0=n.catch(10),console.error("Compression failed:",n.t0),n.abrupt("return",!1);case 20:if(!t.uploading){n.next=22;break}return n.abrupt("return");case 22:return n.next=24,t.checkImageSize(l);case 24:return r=n.sent,t.uploading=!0,c=Object(X.uniqueId)("personal_upload_".concat(Date.now(),"_")),d=URL.createObjectURL(new Blob([t.fileToBlob(e)])),h={url:d,width:null==r?void 0:r.width,height:null==r?void 0:r.height},n.next=31,t.updateImageInfo(c,{banner:h,uploading:!0});case 31:return o.startUpload(l).then((function(e){t.uploading=!1,h.url=e,t.updateImageInfo(c,{banner:h,uploading:!1})})).catch((function(e){t.uploading=!1,h.url="",t.updateImageInfo(c,{banner:h,uploading:!1}),t.$message.error(t.$t("uploadError"))})).finally((function(){t.uploading=!1})),n.abrupt("return",!1);case 33:case"end":return n.stop()}}),n,null,[[10,16]])})))()},updateImageInfo:function(e){var t=arguments,n=this;return Object(E.a)(regeneratorRuntime.mark((function o(){var l,r,c,d,h,m,v,f,_;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(c=t.length>1&&void 0!==t[1]?t[1]:{},d=/^blob:/,h=n.list.find((function(t){return t.id===e})),m=n.list.findIndex((function(t){return t.id===e})),v=Object.assign({id:e},c),h?(Object.assign(h,c),null!=c&&null!==(f=c.banner)&&void 0!==f&&f.url||n.list.splice(m,1),n.$refs.WaterFallVue.refreshCheck()):(n.list.splice(1,0,v),n.$refs.WaterFallVue.refreshCheck()),null==c||null===(l=c.banner)||void 0===l||!l.url||d.test(null==c||null===(r=c.banner)||void 0===r?void 0:r.url)){o.next=11;break}return n.addRecentUsedImage(null==c?void 0:c.banner,2),_=(n.list||[]).filter((function(e){var t,n;return"upload"!==(null==e?void 0:e.customType)&&(null==e||null===(t=e.banner)||void 0===t?void 0:t.url)&&!d.test(null==e||null===(n=e.banner)||void 0===n?void 0:n.url)})),o.next=11,fi.a.setItem("uploadImages",_);case 11:case"end":return o.stop()}}),o)})))()},handleBeforeUploadEmpty:function(){},fileToBlob:function(e){return e.slice(0,e.size,e.type)},checkImageSize:function(e){return new Promise((function(t,n){var o=new FileReader;o.onload=function(e){var img=new Image;img.onload=function(){var e=img.naturalWidth,n=img.naturalHeight;t({width:e,height:n})},img.onerror=function(){n(!1)},img.src=e.target.result},o.readAsDataURL(e)}))},getImageDimensions:function(e){return new Promise((function(t,n){var img=new Image;img.onload=function(){t({width:img.naturalWidth,height:img.naturalHeight})},img.onerror=function(){n(new Error("Failed to load image."))},img.src=e}))},handleTriggerUpload:function(){var e=arguments.length>1?arguments[1]:void 0;this.$logEvent("log_actions",{operation:"click_upload_image",behavior_info:"on_create_flow_popup",behavior_info_sub:"local_upload"}),e&&this.handleBeforeUpload(e)},handleTriggerLinkUpload:function(){this.$logEvent("log_actions",{operation:"click_upload_image",behavior_info:"on_create_flow_popup",behavior_info_sub:"click_url_upload"}),this.$refs.linkUpload.show()}}}),jo=Mo,Do=(n(3082),Object(y.a)(jo,(function(){var e=this,t=e._self._c;return e.visible?t("el-dialog",{attrs:{visible:e.visible,"custom-class":"c-pick-or-upload-image-modal","modal-append-to-body":!0,"append-to-body":!0,"destroy-on-close":"",center:"",width:"1106px"},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"pick-or-upload-image-modal-header"},[t("div",{staticClass:"pick-or-upload-image-modal-header-title"},[e._v(e._s(e.$t("newGenerate32")))]),e._v(" "),t("div",{staticClass:"pick-or-upload-image-modal-header-tabs"},["animGen"!==e.type?t("div",{staticClass:"header-tabs-item",class:["upload"===e.activeTab&&"header-tabs-item-active"],on:{click:function(t){return t.stopPropagation(),e.handleChangeTab("upload")}}},[e._v("\n        "+e._s(e.$t("newGenerate33"))+"\n      ")]):e._e(),e._v(" "),t("div",{staticClass:"header-tabs-item",class:["pick"===e.activeTab&&"header-tabs-item-active"],on:{click:function(t){return t.stopPropagation(),e.handleChangeTab("pick")}}},[e._v("\n        "+e._s(e.$t("newGenerate34"))+"\n      ")])])]),e._v(" "),t("div",{staticClass:"pick-or-upload-image-modal-body"},[t("div",{ref:"handleWorkScroll",staticClass:"handle-work-scroll-list",on:{scroll:e.debounceHandleScroll}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"wraper",staticClass:"wraper"},[t("WaterFallVue",{ref:"WaterFallVue",attrs:{showNs:"",type:"artwork",cols:5,gap:10,container:"wraper",list:e.renderList,lazy:!0,dislikeShow:!0,isCheck:!0,checkMax:e.maxNum,alreadyNoMoreData:e.noMore,scrollContainerClassName:"handle-work-scroll-list",scrollContentTop:e.scrollTop,selectList:e.selectList,currentTab:e.activeTab},on:{load:function(t){return e.getList(!0)},getChecList:e.getCheckList,openCustomUpload:e.handleTriggerUpload,openLinkUpload:e.handleTriggerLinkUpload,deleteUploadImage:e.handleDeleteImage}})],1)])]),e._v(" "),t("div",{staticClass:"pick-or-upload-image-modal-bottom",attrs:{slot:"footer"},slot:"footer"},[t("div",{staticClass:"pick-or-upload-image-modal-bottom-btn",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("div",{staticClass:"pick-or-upload-image-modal-bottom-btn pick-or-upload-image-modal-bottom-btn-color",on:{click:function(t){return t.stopPropagation(),e.handleConfirm()}}},[e.btnLoading?[t("span",{staticClass:"el-icon-loading"})]:e._e(),e._v("\n      "+e._s(e.$t("Confirm"))+"\n    ")],2)]),e._v(" "),t("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],ref:"imageUpload2",staticClass:"image-upload",staticStyle:{display:"none !important"},attrs:{action:"#",drag:"","before-upload":e.handleBeforeUpload,disabled:e.uploading,accept:e.accept,multiple:"",limit:20,"http-request":e.handleBeforeUploadEmpty,"show-file-list":!1}},[t("i",{staticClass:"iconfont icon-icon_Upload image-upload-icon",attrs:{slot:"trigger"},slot:"trigger"})]),e._v(" "),t("link-upload-modal",{ref:"linkUpload",on:{linkImage:e.handleLinkImageUpload}}),e._v(" "),t("common-confirm-modal",{ref:"commonConfirmModal"})],1):e._e()}),[],!1,null,null,null).exports),No={name:"ImageToImageOptionModal",props:["value","source"],inject:["easyTop"],components:{SliderItem:Ln.a,generateRedrawModal:Si,PickOrUploadImageModal:Do},data:function(){return{visible:!1,rawImgLoading:!0}},computed:{isShowRedraw:function(){var e,t,n,o=!(null!==(e=this.easyTop)&&void 0!==e&&null!==(e=e.config)&&void 0!==e&&null!==(e=e.textToImage)&&void 0!==e&&null!==(e=e.controlnet_units)&&void 0!==e&&e.length),l=!(null!=this&&null!==(t=this.easyTop)&&void 0!==t&&null!==(t=t.config)&&void 0!==t&&null!==(t=t.ipList)&&void 0!==t&&t.length),r="SD 3.5"!==(null==this||null===(n=this.easyTop)||void 0===n?void 0:n.getCurrentModelType);return o&&l&&r},renderOptions:function(){return{min:.01,max:1,step:.05}},getCurrentModelType:function(){var e,t,n=(null===(e=this.easyTop)||void 0===e||null===(e=e.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.base_model_type)||"",o=Object(Ue.c)(n);return null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isStudioFlux?"flux":o||"sd"},getCustomSizeOptions:function(){var e,t,n={min:128,max:1024};return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isStudioFlux||null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isCommunityFlux?{min:384,max:1024}:"sd"===this.getCurrentModelType?n:["sdxl","sd3"].includes(this.getCurrentModelType)?{min:128,max:1536}:n}},watch:{"source.mask":{handler:function(e,t){if(e&&["",null,void 0].includes(t)){this.value.keepDenoisingStrength||this.changeConfig(.7,"denoising_strength");try{var n;if(!/^(http|https):\/\//.test(e))null===(n=this.easyTop)||void 0===n||n.updateConfig({prompt:""})}catch(e){}}var o;e&&e!==t&&(null===(o=this.easyTop)||void 0===o||o.updateConfig({ad_model:""}))},immediate:!0,deep:!0}},methods:{show:function(){this.visible=!0},handleClose:function(){this.visible=!1},handleConfirm:function(){this.handleClose()},openPickImageModal:function(){this.$refs.pickOrUploadImageModal.openModal([],null)},changeConfig:function(e,t){this.$set(this.source,t,e)},handleOpenRedrawModal:function(){this.$refs.generateRedrawModal.show(this.source.url)},handlePickImage:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.changeConfig(null===(e=t[0])||void 0===e?void 0:e.url,"url"),this.changeConfig("","mask"),this.changeConfig("","tempMask"),this.changeConfig("","copyMask"),this.handleUpdateImageSize(null!=t&&t.length?t[0]:{})},handleUpdateImageSize:function(){var e,t,n,o,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(null==l||null===(e=l.info)||void 0===e?void 0:e.banner)||(null==l?void 0:l.banner)||{},c=r.width,d=r.height;if(c&&d){var h=JSON.parse(JSON.stringify(this.value)),m={};m=this.convertStudioBaseSize(c,d,this.getCustomSizeOptions),h.width=(null===(t=m)||void 0===t?void 0:t.width)||(null==h?void 0:h.width),h.height=(null===(n=m)||void 0===n?void 0:n.height)||(null==h?void 0:h.height),null==this||null===(o=this.easyTop)||void 0===o||o.updateConfig(h)}},convertStudioBaseSize:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=([{code:1,label:"2:3",icon:"icon-a-2_3",sd:{standard:{width:512,height:768}},sdxl:{standard:{width:768,height:1152}},flux:{standard:{width:688,height:1024},quality:{width:1024,height:1536}}},{code:2,label:"1:1",icon:"icon-a-1_11",sd:{standard:{width:768,height:768}},sdxl:{standard:{width:1024,height:1024}},flux:{standard:{width:1024,height:1024},quality:{width:1536,height:1536}}},{code:3,label:"9:16",icon:"icon-a-9_161",sd:{standard:{width:432,height:768}},sdxl:{standard:{width:810,height:1440}},flux:{standard:{width:592,height:1024},quality:{width:864,height:1536}}},{code:4,label:"4:3",icon:"icon-a-4_31",sd:{standard:{width:768,height:576}},sdxl:{standard:{width:1024,height:768}},flux:{standard:{width:1024,height:768},quality:{width:1536,height:1152}}},{code:5,label:"custom",icon:"icon-icon-Custom",sd:{},sdxl:{},flux:{}}]||[]).filter((function(e){return 5!==e.code})).map((function(e){return e.width=e.sd.standard.width,e.height=e.sd.standard.height,e})),l={},r=parseFloat((e/t).toFixed(2)),c=o.find((function(e){var t=parseFloat((e.width/e.height).toFixed(2));return r===t})),d=n;if(c){var h=this.getCurrentModelType;["sd","sdxl"].includes(h)&&(l=c[h].standard),["flux"].includes(h)&&(l=c[h].standard)}else{var m=Object(B.g)(e,t,d.max);l.width=m.width,l.height=m.height,l.isCustom=!0}return l},updateImageMask:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$set(this.source,"mask",e),e||this.$set(this.source,"compose_mask",e)},updateMixedImageMask:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$set(this.source,"compose_mask",e)},handleDelete:function(){var e;null===(e=this.easyTop)||void 0===e||e.updateConfig({imageToImageList:[]}),this.handleClose()}}},Eo=No,Ro=(n(3083),Object(y.a)(Eo,(function(){var e,t,n,o,l=this,r=l._self._c;return r("el-dialog",{attrs:{visible:l.visible,"custom-class":"image-to-image-option-modal custom-dialog","destroy-on-close":!1,"close-on-press-escape":!0,modal:!1,"modal-append-to-body":"",width:"320px"},on:{"update:visible":function(e){l.visible=e}}},[r("div",{staticClass:"modal-content"},[r("div",{staticClass:"modal-content-top"},[r("div",{staticClass:"modal-content-top-left"},[r("span",{staticClass:"modal-content-top-icon",on:{click:function(e){var t;return l.changeConfig(!(null!==(t=l.source)&&void 0!==t&&t.enable),"enable")}}},[r("i",{staticClass:"el-icon-switch-button"})]),l._v(" "),r("span",{staticClass:"modal-content-top-icon",on:{click:l.openPickImageModal}},[r("i",{staticClass:"iconfont icon-a-icon-reselectimg"})])]),l._v(" "),r("div",{staticClass:"modal-content-top-right",on:{click:function(e){return e.stopPropagation(),l.handleDelete()}}},[r("span",{staticClass:"modal-content-top-icon"},[r("i",{staticClass:"el-icon-delete"})])])]),l._v(" "),r("div",{staticClass:"modal-content-strength"},[r("div",{staticClass:"modal-content-strength-text"},[l._v("Strength")]),l._v(" "),r("div",{staticClass:"modal-content-strength-content"},[r("slider-item",{attrs:{"hide-label":!0,value:l.source.denoising_strength,precision:2,min:l.renderOptions.min,max:l.renderOptions.max,step:l.renderOptions.step},on:{change:function(e){return l.changeConfig(e,"denoising_strength")}}})],1)]),l._v(" "),r("div",{staticClass:"modal-content-image-box"},[r("img",{staticClass:"modal-content-image-box-img",attrs:{src:null===(e=l.source)||void 0===e?void 0:e.url,alt:""},on:{load:function(e){l.rawImgLoading=!1},error:function(e){l.rawImgLoading=!1}}}),l._v(" "),null!==(t=l.source)&&void 0!==t&&t.mask?r("img",{staticClass:"redraw-mask-image",attrs:{src:null===(n=l.source)||void 0===n?void 0:n.mask,alt:""}}):l._e(),l._v(" "),l.isShowRedraw?r("span",{staticClass:"modal-content-image-box-icon",on:{click:function(e){return e.stopPropagation(),l.handleOpenRedrawModal.apply(null,arguments)}}},[r("i",{staticClass:"iconfont icon-huabi"})]):l._e()])]),l._v(" "),r("generate-redraw-modal",{ref:"generateRedrawModal",attrs:{needMixedMask:null===(o=l.easyTop)||void 0===o?void 0:o.isStudioFlux,mask:l.source.mask||""},on:{updateMask:l.updateImageMask,updateMixedMask:l.updateMixedImageMask}}),l._v(" "),r("pick-or-upload-image-modal",{ref:"pickOrUploadImageModal",on:{confirm:l.handlePickImage}})],1)}),[],!1,null,null,null)),Ao=Ro.exports;function Bo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Uo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bo(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fo={name:"ControlNetOptionModal",props:["value","source"],inject:["easyTop"],components:{SliderItem:Ln.a,SelectControlNetModal:co,PickOrUploadImageModal:Do},data:function(){return{visible:!1,viewMore:!1,controlMode:["Balance","Prompt","Controlnet"]}},computed:Uo(Uo({},Object(S.c)("creation",["taskUnits","taskSdxlUnits","lab_ctr_units","v2_sd_xl_ctr_units","v2_ctr_units"])),{},{renderOptions:function(){return{min:.01,max:1,step:.05}},taskModules:function(){var e;return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isSDXLModel?this.v2_sd_xl_ctr_units:this.v2_ctr_units},finder:function(){var e=this;return this.taskModules.find((function(t){var n;return(null===(n=e.source)||void 0===n?void 0:n.type)==t.type}))||{}},isShowStyleFidelity:function(){var e,t;return(null===(e=this.finder)||void 0===e?void 0:e.has_style_fidelity)&&"0"===(null===(t=this.source)||void 0===t?void 0:t.control_mode)},isShowResolution:function(){var e;return(null===(e=this.finder)||void 0===e?void 0:e.has_processor_res)&&this.source.isHandle},control_modules:function(){var e;return null===(e=this.finder)||void 0===e?void 0:e.modules},control_models:function(){var e;return null===(e=this.finder)||void 0===e?void 0:e.models}}),methods:{show:function(){this.visible=!0},handleClose:function(){this.visible=!1},handleConfirm:function(){this.handleClose()},openPickImageModal:function(){var e;this.$logEvent("log_actions",{operation:"click_hide",behavior_info:"on_new_create_flow_page",behavior_info_sub:null===(e=this.source)||void 0===e?void 0:e.type}),this.$refs.pickOrUploadImageModal.openModal([],null)},handlePickImage:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];console.log(t,"此时的list---"),this.changeConfig(null===(e=t[0])||void 0===e?void 0:e.url,"input_image")},handleDelete:function(){var e;this.$logEvent("log_actions",{operation:"click_delete",behavior_info:"on_new_create_flow_page",behavior_info_sub:null===(e=this.source)||void 0===e?void 0:e.type}),this.$emit("delete"),this.handleClose()},changeConfig:function(e,t){var n;"enable"===t&&this.$logEvent("log_actions",{operation:"click_hide",behavior_info:"on_new_create_flow_page",behavior_info_sub:null===(n=this.source)||void 0===n?void 0:n.type});"input_image"===t&&this.$logEvent("log_actions",{operation:"click_switch_picture",behavior_info:"on_new_create_flow_page",behavior_info_sub:e||""}),this.$set(this.source,t,e)},openControlNetSelectPopup:function(){this.$refs.selectControlNetModal.show(this.source)},handleSelect:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null!=e&&e.type&&(this.$logEvent("log_actions",{operation:"click_controlnet_type",behavior_info:"on_new_create_flow_page",behavior_info_sub:null==e?void 0:e.type}),this.$set(this.source,"type",null==e?void 0:e.type),this.$set(this.source,"module",null==e?void 0:e.module),this.$set(this.source,"model",null==e?void 0:e.model))}}},zo=Fo,Vo=(n(3084),Object(y.a)(zo,(function(){var e,t,n,o,l,r=this,c=r._self._c;return c("el-dialog",{attrs:{visible:r.visible,"custom-class":"control-net-option-modal custom-dialog","destroy-on-close":!1,"close-on-press-escape":!0,modal:!1,"modal-append-to-body":"",width:"320px"},on:{"update:visible":function(e){r.visible=e}}},[c("div",{staticClass:"modal-content"},[c("div",{staticClass:"modal-content-top"},[c("div",{staticClass:"modal-content-top-left"},[c("span",{staticClass:"modal-content-top-icon",on:{click:function(e){var t;return r.changeConfig(!(null!==(t=r.source)&&void 0!==t&&t.enable),"enable")}}},[c("i",{staticClass:"el-icon-switch-button"})]),r._v(" "),c("span",{staticClass:"modal-content-top-icon",on:{click:r.openPickImageModal}},[c("i",{staticClass:"iconfont icon-a-icon-reselectimg"})])]),r._v(" "),c("div",{staticClass:"modal-content-top-right",on:{click:function(e){return e.stopPropagation(),r.handleDelete()}}},[c("span",{staticClass:"modal-content-top-icon"},[c("i",{staticClass:"el-icon-delete"})])])]),r._v(" "),c("div",{staticClass:"modal-content-item-1"},[c("div",{staticClass:"modal-content-item-cover"},[c("img",{attrs:{src:null===(e=r.source)||void 0===e?void 0:e.input_image,alt:""}})]),r._v(" "),c("div",{staticClass:"modal-content-item-box"},[c("div",{staticClass:"modal-content-item-box-title"},[r._v("Controlnet Type")]),r._v(" "),c("div",{staticClass:"modal-content-item-box-select",on:{click:function(e){return e.stopPropagation(),r.openControlNetSelectPopup.apply(null,arguments)}}},[c("span",{staticClass:"modal-content-item-box-select-text"},[r._v(r._s(r.$t(r.source.type)))]),r._v(" "),c("span",{staticClass:"iconfont icon-edit1 modal-content-item-box-select-icon"})])])]),r._v(" "),c("div",{staticClass:"modal-content-item"},[c("div",{staticClass:"modal-content-strength-text"},[r._v(r._s(r.$t("ControlWeight")))]),r._v(" "),c("div",{staticClass:"modal-content-strength-content"},[c("slider-item",{attrs:{"hide-label":!0,value:r.source.weight,precision:1,min:0,max:2,step:.1},on:{input:function(e){return r.changeConfig(e,"weight")},change:function(e){return r.changeConfig(e,"weight")}}})],1)]),r._v(" "),c("div",{staticClass:"modal-content-item modal-content-item-flex-between"},[c("span",{staticClass:"content-item-label-text"},[r._v("More Settings")]),r._v(" "),c("el-switch",{attrs:{"active-color":"#3F8CFF"},model:{value:r.viewMore,callback:function(e){r.viewMore=e},expression:"viewMore"}})],1),r._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:r.viewMore,expression:"viewMore"}],staticClass:"modal-content-item"},[c("div",{staticClass:"modal-content-item-label"},[r._v("Preprocessor")]),r._v(" "),c("div",{staticClass:"modal-content-item-box"},[c("div",{staticClass:"panel-item",class:[(null===(t=r.source)||void 0===t?void 0:t.isHandle)&&"active-btn"],on:{click:function(e){return e.stopPropagation(),r.changeConfig(!0,"isHandle")}}},[r._v("\n          "+r._s(r.$t("Yes"))+"\n        ")]),r._v(" "),c("div",{staticClass:"panel-item",class:[!(null!==(n=r.source)&&void 0!==n&&n.isHandle)&&"active-btn"],on:{click:function(e){return e.stopPropagation(),r.changeConfig(!1,"isHandle")}}},[r._v("\n          "+r._s(r.$t("No"))+"\n        ")])])]),r._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:r.viewMore&&"None"!=(null===(o=r.source)||void 0===o?void 0:o.model),expression:"viewMore && source?.model != 'None'"}],staticClass:"modal-content-item"},[c("div",{staticClass:"modal-content-item-label"},[r._v(r._s(r.$t("ControlPreprocessingModel")))]),r._v(" "),c("div",{staticClass:"modal-content-item-box"},[c("el-select",{staticClass:"easy-custom-select",attrs:{value:r.source.model,"popper-class":"custom-select","popper-append-to-body":!0},on:{change:function(e){return r.changeConfig(e,"model")}}},r._l(r.control_models,(function(e,i){return c("el-option",{key:"ControlMode_"+i,attrs:{value:e,label:e}},[c("el-tooltip",{attrs:{content:e,placement:"left"}},[c("span",[r._v(r._s(e))])])],1)})),1)],1)]),r._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:r.viewMore,expression:"viewMore"}],staticClass:"modal-content-item"},[c("div",{staticClass:"modal-content-item-label"},[r._v(r._s(r.$t("ControlMode")))]),r._v(" "),c("div",{staticClass:"modal-content-item-box"},[c("el-select",{staticClass:"easy-custom-select",attrs:{value:r.source.control_mode,"popper-class":"custom-select","popper-append-to-body":!1},on:{change:function(e){return r.changeConfig(e,"control_mode")}}},r._l(r.controlMode,(function(e,i){return c("el-option",{key:"ControlMode_"+i,attrs:{value:i,label:r.$t("ControlMode"+e)}},[r._v(" "+r._s(r.$t("ControlMode"+e))+"\n          ")])})),1)],1)]),r._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:r.viewMore&&(null===(l=r.source)||void 0===l?void 0:l.isHandle),expression:"viewMore && source?.isHandle"}],staticClass:"modal-content-item"},[c("div",{staticClass:"modal-content-item-label"},[r._v(r._s(r.$t("ControlPreprocessor")))]),r._v(" "),c("div",{staticClass:"modal-content-item-box"},[c("el-select",{staticClass:"easy-custom-select",attrs:{value:r.source.module,"popper-class":"custom-select","popper-append-to-body":!0},on:{change:function(e){return r.changeConfig(e,"module")}}},r._l(r.control_modules,(function(e,i){return c("el-option",{key:"ControlMode_"+i,attrs:{value:e,label:e}},[r._v(" "+r._s(e)+"\n          ")])})),1)],1)]),r._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:r.viewMore&&r.isShowStyleFidelity,expression:"viewMore && isShowStyleFidelity"}],staticClass:"modal-content-item"},[c("div",{staticClass:"modal-content-item-label"},[r._v(r._s(r.$t("StyleFidelity")))]),r._v(" "),c("div",{staticClass:"modal-content-item-box"},[c("slider-item",{attrs:{"hide-label":!0,value:r.source.threshold_a,precision:1,min:.1,max:1,step:.1},on:{input:function(e){return r.changeConfig(e,"threshold_a")},change:function(e){return r.changeConfig(e,"threshold_a")}}})],1)]),r._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:r.viewMore&&r.isShowResolution,expression:"viewMore && isShowResolution"}],staticClass:"modal-content-item"},[c("div",{staticClass:"modal-content-strength-text"},[r._v(r._s(r.$t("ControlPreprocessorResolution")))]),r._v(" "),c("div",{staticClass:"modal-content-strength-content"},[c("slider-item",{attrs:{"hide-label":!0,value:r.source.processor_res,min:0,max:2048,step:1},on:{change:function(e){return r.changeConfig(e,"processor_res")}}})],1)])]),r._v(" "),c("select-control-net-modal",{ref:"selectControlNetModal",on:{confirm:r.handleSelect}}),r._v(" "),c("pick-or-upload-image-modal",{ref:"pickOrUploadImageModal",on:{confirm:r.handlePickImage}})],1)}),[],!1,null,null,null)),Wo=Vo.exports,Ho={name:"IpMainOptionModal",props:["value","source"],inject:["easyTop"],components:{SliderItem:Ln.a,generateRedrawModal:Si,PickOrUploadImageModal:Do},data:function(){return{visible:!1,rawImgLoading:!0}},computed:{renderOptions:function(){return{min:0,max:1,step:.001}},getCurrentModelType:function(){var e,t,n=(null===(e=this.easyTop)||void 0===e||null===(e=e.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.base_model_type)||"",o=Object(Ue.c)(n);return null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isStudioFlux?"flux":o||"sd"},getCustomSizeOptions:function(){var e,t,n={min:128,max:1024};return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isStudioFlux||null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isCommunityFlux?{min:384,max:1024}:"sd"===this.getCurrentModelType?n:["sdxl","sd3"].includes(this.getCurrentModelType)?{min:128,max:1536}:n}},methods:{show:function(){this.visible=!0},handleClose:function(){this.visible=!1},handleConfirm:function(){this.handleClose()},openPickImageModal:function(){this.$refs.pickOrUploadImageModal.openModal([],{checkFace:!0})},changeConfig:function(e,t){this.$set(this.source,t,e)},handlePickImage:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.changeConfig(null===(e=t[0])||void 0===e?void 0:e.url,"image")},handleUpdateImageSize:function(){var e,t,n,o,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(null==l||null===(e=l.info)||void 0===e?void 0:e.banner)||(null==l?void 0:l.banner)||{},c=r.width,d=r.height;if(c&&d){var h=JSON.parse(JSON.stringify(this.value)),m={};m=this.convertStudioBaseSize(c,d,this.getCustomSizeOptions),h.width=(null===(t=m)||void 0===t?void 0:t.width)||(null==h?void 0:h.width),h.height=(null===(n=m)||void 0===n?void 0:n.height)||(null==h?void 0:h.height),null==this||null===(o=this.easyTop)||void 0===o||o.updateConfig(h)}},convertStudioBaseSize:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=([{code:1,label:"2:3",icon:"icon-a-2_3",sd:{standard:{width:512,height:768}},sdxl:{standard:{width:768,height:1152}},flux:{standard:{width:688,height:1024},quality:{width:1024,height:1536}}},{code:2,label:"1:1",icon:"icon-a-1_11",sd:{standard:{width:768,height:768}},sdxl:{standard:{width:1024,height:1024}},flux:{standard:{width:1024,height:1024},quality:{width:1536,height:1536}}},{code:3,label:"9:16",icon:"icon-a-9_161",sd:{standard:{width:432,height:768}},sdxl:{standard:{width:810,height:1440}},flux:{standard:{width:592,height:1024},quality:{width:864,height:1536}}},{code:4,label:"4:3",icon:"icon-a-4_31",sd:{standard:{width:768,height:576}},sdxl:{standard:{width:1024,height:768}},flux:{standard:{width:1024,height:768},quality:{width:1536,height:1152}}},{code:5,label:"custom",icon:"icon-icon-Custom",sd:{},sdxl:{},flux:{}}]||[]).filter((function(e){return 5!==e.code})).map((function(e){return e.width=e.sd.standard.width,e.height=e.sd.standard.height,e})),l={},r=parseFloat((e/t).toFixed(2)),c=o.find((function(e){var t=parseFloat((e.width/e.height).toFixed(2));return r===t})),d=n;if(c){var h=this.getCurrentModelType;["sd","sdxl"].includes(h)&&(l=c[h].standard),["flux"].includes(h)&&(l=c[h].standard)}else{var m=Object(B.g)(e,t,d.max);l.width=m.width,l.height=m.height,l.isCustom=!0}return l},handleDelete:function(){this.$emit("delete"),this.handleClose()}}},qo=Ho,Go=(n(3085),{name:"ImageToImageCard",components:{ImageToImageOptionModal:Ao,ControlNetOptionModal:Wo,IpMainOptionModal:Object(y.a)(qo,(function(){var e,t=this,n=t._self._c;return n("el-dialog",{attrs:{visible:t.visible,"custom-class":"image-to-image-option-modal custom-dialog","destroy-on-close":!1,"close-on-press-escape":!0,modal:!1,"modal-append-to-body":"",width:"320px"},on:{"update:visible":function(e){t.visible=e}}},[n("div",{staticClass:"modal-content"},[n("div",{staticClass:"modal-content-top"},[n("div",{staticClass:"modal-content-top-left"},[n("span",{staticClass:"modal-content-top-icon",on:{click:function(e){var n;return t.changeConfig(!(null!==(n=t.source)&&void 0!==n&&n.enable),"enable")}}},[n("i",{staticClass:"el-icon-switch-button"})]),t._v(" "),n("span",{staticClass:"modal-content-top-icon",on:{click:t.openPickImageModal}},[n("i",{staticClass:"iconfont icon-a-icon-reselectimg"})])]),t._v(" "),n("div",{staticClass:"modal-content-top-right",on:{click:function(e){return e.stopPropagation(),t.handleDelete()}}},[n("span",{staticClass:"modal-content-top-icon"},[n("i",{staticClass:"el-icon-delete"})])])]),t._v(" "),n("div",{staticClass:"modal-content-strength"},[n("div",{staticClass:"modal-content-strength-text"},[t._v("Strength")]),t._v(" "),n("div",{staticClass:"modal-content-strength-content"},[n("slider-item",{attrs:{"hide-label":!0,value:t.source.weight,precision:3,min:t.renderOptions.min,max:t.renderOptions.max,step:t.renderOptions.step},on:{change:function(e){return t.changeConfig(e,"weight")}}})],1)]),t._v(" "),n("div",{staticClass:"modal-content-image-box"},[n("img",{staticClass:"modal-content-image-box-img",attrs:{src:null===(e=t.source)||void 0===e?void 0:e.image,alt:""},on:{load:function(e){t.rawImgLoading=!1},error:function(e){t.rawImgLoading=!1}}})])]),t._v(" "),n("pick-or-upload-image-modal",{ref:"pickOrUploadImageModal",on:{confirm:t.handlePickImage}})],1)}),[],!1,null,null,null).exports},inject:["easyTop"],props:{cardInfo:{type:Object,default:function(){return{}}},value:{type:Object,default:function(){return{}}},type:{type:String,default:""}},data:function(){return{}},computed:{getImageUrl:function(){var e,t;return"IpMaintain"===this.type?null===(e=this.cardInfo)||void 0===e?void 0:e.image:this.cardInfo.url||(null===(t=this.cardInfo)||void 0===t?void 0:t.input_image)},isDisable:function(){return!this.cardInfo.enable},getWeightText:function(){var e,t;return"image"===this.type?null===(e=this.cardInfo)||void 0===e?void 0:e.denoising_strength:["controlNet","IpMaintain"].includes(this.type)?null===(t=this.cardInfo)||void 0===t?void 0:t.weight:""},getTypeText:function(){var e,text="";return"image"===this.type?"img2img":["controlNet"].includes(this.type)?null===(e=this.cardInfo)||void 0===e?void 0:e.type:("IpMaintain"===this.type&&(text=this.$t("studio46")),text)}},methods:{handleDisable:function(){var e;"controlNet"===this.type&&this.$logEvent("log_actions",{operation:"click_hide",behavior_info:"on_new_create_flow_page",behavior_info_sub:null===(e=this.cardInfo)||void 0===e?void 0:e.type});this.$emit("changeEnableStatus",this.cardInfo),this.$set(this.cardInfo,"enable",!1)},handleEnable:function(){this.$emit("changeEnableStatus",this.cardInfo),this.$set(this.cardInfo,"enable",!0)},handleDelete:function(){if("IpMaintain"!==this.type)"image"!==this.type?"controlNet"===this.type&&this.$emit("delete"):this.easyTop.updateConfig({imageToImageList:[]});else try{var e=JSON.parse(JSON.stringify(this.value));e.ipList=[],e.lab_base.conds=(e.lab_base.conds||[]).filter((function(e){return"IpMaintain"!==(null==e?void 0:e.mode)})),this.easyTop.updateConfig(e)}catch(e){}},handleOpenModal:function(){if(!this.isDisable){var e;if("image"===this.type&&this.$refs.imageToImageOptionModal.show(),"controlNet"===this.type)this.$refs.controlNetOptionModal.show(),this.$logEvent("log_actions",{operation:"click_delete",behavior_info:"on_new_create_flow_page",behavior_info_sub:null===(e=this.cardInfo)||void 0===e?void 0:e.type});"IpMaintain"===this.type&&this.$refs.ipMainOptionModal.show()}}}}),Jo=(n(3086),Object(y.a)(Go,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-image-to-image-card",class:[e.isDisable&&"image-to-image-card-disable"]},[t("div",{staticClass:"image-box"},[t("img",{attrs:{src:e.getImageUrl,alt:""}})]),e._v(" "),t("div",{staticClass:"image-box-mask",class:[e.isDisable&&"image-box-mask-black"],on:{click:function(t){return t.stopPropagation(),e.handleOpenModal.apply(null,arguments)}}},[t("span",{directives:[{name:"show",rawName:"v-show",value:!e.isDisable,expression:"!isDisable"}],staticClass:"image-box-top-btn image-box-top-btn-left",on:{click:function(t){return t.stopPropagation(),e.handleDisable.apply(null,arguments)}}},[t("i",{staticClass:"el-icon-switch-button"})]),e._v(" "),t("span",{staticClass:"image-box-top-btn image-box-top-btn-right",on:{click:function(t){return t.stopPropagation(),e.handleDelete.apply(null,arguments)}}},[t("i",{staticClass:"el-icon-close"})]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.isDisable,expression:"isDisable"}],staticClass:"image-box-top-enable-btn",on:{click:function(t){return t.stopPropagation(),e.handleEnable.apply(null,arguments)}}},[t("i",{staticClass:"el-icon-switch-button"}),t("span",[e._v("Enable")])])]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!e.isDisable,expression:"!isDisable"}],staticClass:"image-box-weight"},[e._v(e._s(e.getWeightText))]),e._v(" "),t("div",{staticClass:"image-box-bottom"},[t("div",{staticClass:"image-box-bottom-text"},[t("span",{staticClass:"image-box-bottom-text-icon iconfont icon-icon-picture-selected"}),e._v(" "),t("span",{staticClass:"image-box-bottom-text-content"},[e._v(e._s(e.getTypeText))])]),e._v(" "),t("span",{staticClass:"image-box-bottom-icon el-icon-caret-bottom"})]),e._v(" "),t("image-to-image-option-modal",{ref:"imageToImageOptionModal",attrs:{value:e.cardInfo,source:e.cardInfo}}),e._v(" "),t("control-net-option-modal",{ref:"controlNetOptionModal",attrs:{value:e.cardInfo,source:e.cardInfo},on:{delete:e.handleDelete}}),e._v(" "),t("ip-main-option-modal",{ref:"ipMainOptionModal",attrs:{value:e.cardInfo,source:e.cardInfo},on:{delete:e.handleDelete}})],1)}),[],!1,null,"c712b184",null));function Ko(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Xo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ko(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ko(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qo={name:"EasyTopInputArea",props:["value"],inject:["easyTop"],components:{ImageAndControlNetPopup:mo,RandomPromptPopup:bo,ImageToImageCard:Jo.exports,PickOrUploadImageModal:Do,commonConfirmModal:un.a},data:function(){return{inputSize:{minRows:1,maxRows:8},promptActive:!1,imageToImageTemplate:{url:"",denoising_strength:.35,mask:"",copyMask:"",enable:!0,width:0,height:0},imagePopupVisible:!1,inputIsScroll:!1,debounceCheckScroll:function(){},debounceGenerate:function(){},hasBottomPadding:!1,isPackUp:!1}},computed:Xo(Xo({},Object(S.c)("user",["isCompanyAccount"])),{},{showLockParamsBtn:function(){var e,t,n,o;return[!["",null,void 0].includes(null==this||null===(e=this.value)||void 0===e?void 0:e.prompt),!["",null,void 0].includes(null==this||null===(t=this.value)||void 0===t?void 0:t.negative_prompt),null===(n=this.value)||void 0===n||null===(n=n.imageToImageList)||void 0===n?void 0:n.length,null===(o=this.value)||void 0===o||null===(o=o.controlnet_units)||void 0===o?void 0:o.length].some((function(e){return!!e}))},showPlaceholder:function(){var e,t,n,o,l="WhatDoUWantToCreate",mask=null!==(e=this.value)&&void 0!==e&&null!==(e=e.imageToImageList)&&void 0!==e&&e.length?null===(t=this.value)||void 0===t||null===(t=t.imageToImageList[0])||void 0===t?void 0:t.mask:"";return null===(n=this.value)||void 0===n||null===(n=n.imageToImageList)||void 0===n||!n.length||["",null,void 0].includes(mask)||/^(http|https):\/\//.test(mask)||null!==(o=this.value)&&void 0!==o&&null!==(o=o.controlnet_units)&&void 0!==o&&o.length||(l="TaskImage2ImagePlaceholder"),l},showBottomPadding:function(){var e,t,n=!1,o=!this.value.enableNegativePrompts&&this.value.prompt,l=!(null!==(e=this.value)&&void 0!==e&&null!==(e=e.imageToImageList)&&void 0!==e&&e.length||null!==(t=this.value)&&void 0!==t&&null!==(t=t.controlnet_units)&&void 0!==t&&t.length),r=this.inputIsScroll&&this.hasBottomPadding&&o&&l,c=this.value.enableNegativePrompts,d=this.isPositionBottom;return l&&(r||c||d)&&(n=!0),n},showLineHeight:function(){var e=!1;return this.inputIsScroll&&this.hasBottomPadding&&(e=!0),e},isPositionBottom:function(){var e=!1;return(this.value.enableNegativePrompts||this.showExtraOptionBar)&&(e=!0),this.value.prompt&&this.inputIsScroll&&(e=!0),e},showExtraOptionBar:function(){var e,t,n,o,l="SA"===(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.currentModelType)&&(null===(t=this.value)||void 0===t||null===(t=t.ipList)||void 0===t?void 0:t.length);return(null===(n=this.value)||void 0===n||null===(n=n.controlnet_units)||void 0===n?void 0:n.length)||(null===(o=this.value)||void 0===o||null===(o=o.imageToImageList)||void 0===o?void 0:o.length)||l},getCurrentModelType:function(){var e,t=this.value.base_model_type||"",n=Object(Ue.c)(t);return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isStudioFlux?"flux":n||"sd"},getCustomSizeOptions:function(){var e,t,n={min:128,max:1024};return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isStudioFlux||null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isCommunityFlux?{min:384,max:1024}:"sd"===this.getCurrentModelType?n:["sdxl","sd3"].includes(this.getCurrentModelType)?{min:128,max:1536}:n},isRedrawMask:function(){var e,t,n=(null==this||null===(e=this.easyTop)||void 0===e||null===(e=e.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.imageToImageList)||[];return(null==n?void 0:n.length)&&!["",null,void 0].includes(null===(t=n[0])||void 0===t?void 0:t.mask)}}),watch:{"value.enableNegativePrompts":{handler:function(e,t){var n=this;e&&!t&&this.$nextTick((function(){n.$refs.negativePromptInput.focus()}))},deep:!0,immediate:!0},"value.prompt":{handler:function(e){e&&!this.promptActive&&(this.debounceResizeTextArea(),this.debounceCheckScroll()),e||(this.isPackUp=!1)},deep:!0,immediate:!0},showLockParamsBtn:{handler:function(e,t){if(!e){var n,o=JSON.parse(JSON.stringify(this.value));o.isLockParams=!1,null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)}},immediate:!0}},mounted:function(){this.debounceGenerate=Object(X.debounce)(this.handleGenerate,500),this.debounceCheckScroll=Object(X.debounce)(this.checkInputScroll,100),this.debounceCheckScroll(),this.$EventBus.$on("messageItemPromptWidthUpdate",this.checkInputScroll),this.$EventBus.$on("closeAllGeneratePopup",this.handleClosePopup),this.$EventBus.$on("resetInputPackUpStatus",this.changePackUpStatus),this.$EventBus.$on("needCheckInputPackUp",this.handleClickOutside)},beforeDestroy:function(){this.debounceCheckScroll=null,this.debounceGenerate=null,this.$EventBus.$off("messageItemPromptWidthUpdate",this.checkInputScroll),this.$EventBus.$off("closeAllGeneratePopup",this.handleClosePopup),this.$EventBus.$off("resetInputPackUpStatus",this.changePackUpStatus),this.$EventBus.$off("needCheckInputPackUp",this.handleClickOutside)},methods:{handleClickOutside:function(e){var t,n=this;if(null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isShowPopup&&!this.isPackUp)try{this.isPackUp=!0,this.$nextTick((function(){n.$refs.realPromptInput.blur()}))}catch(e){}},changePackUpStatus:function(){this.isPackUp=!1,this.autoResizeInputHeight()},handleInputFocus:function(){this.promptActive=!0,this.isPackUp&&(this.isPackUp=!1)},handleChangePackUpStatus:function(){this.$logEvent("log_actions",{operation:"click_fold",behavior_info:"on_new_create_flow_page"}),this.isPackUp=!0},handleClearPrompt:function(){var e;this.$logEvent("log_actions",{operation:"click_prompt_delete",behavior_info:"on_new_create_flow_page"});var t=JSON.parse(JSON.stringify(this.value));t.prompt="",null==this||null===(e=this.easyTop)||void 0===e||e.updateConfig(t)},toggleLockParamsStatus:function(){var e,t=JSON.parse(JSON.stringify(this.value));t.isLockParams=!t.isLockParams,null==this||null===(e=this.easyTop)||void 0===e||e.updateConfig(t),this.$logEvent("log_actions",{operation:"click_fixed_params",behavior_info:"on_new_create_flow_page"})},handleClosePopup:function(){try{this.$refs.imageControlNetPopup.onClose()}catch(e){}},autoResizeInputHeight:function(){var e=this;try{setTimeout((function(){var t;null===(t=e.$refs)||void 0===t||null===(t=t.realPromptInput)||void 0===t||t.resizeTextarea()}),0)}catch(e){}},checkInputScroll:function(){var e=this;this.value.prompt?this.$nextTick((function(){try{var t,n,o,l,r,c=(null===(t=window)||void 0===t?void 0:t.devicePixelRatio)||1,d=27;c>=1.5&&(d=22);var h=(null===(n=e.$refs.easyGenerateInputAreaCheck)||void 0===n||null===(n=n.$refs)||void 0===n?void 0:n.textarea)||(null===(o=e.$refs)||void 0===o||null===(o=o.easyGenerateInputAreaCheck)||void 0===o?void 0:o.$el),m=(null===(l=e.$refs.easyGenerateInputAreaCheck2)||void 0===l||null===(l=l.$refs)||void 0===l?void 0:l.textarea)||(null===(r=e.$refs)||void 0===r||null===(r=r.easyGenerateInputAreaCheck2)||void 0===r?void 0:r.$el);e.inputIsScroll=h.clientHeight>d,e.hasBottomPadding=h.clientHeight>d&&!(m.clientHeight>90),setTimeout((function(){var t;null===(t=e.$refs)||void 0===t||null===(t=t.realPromptInput)||void 0===t||t.resizeTextarea()}),0)}catch(t){var v;e.inputIsScroll=!1,e.hasBottomPadding=!1,null===(v=e.$refs)||void 0===v||null===(v=v.realPromptInput)||void 0===v||v.resizeTextarea()}})):this.inputIsScroll=!1},debounceResizeTextArea:function(){try{var e;null===(e=this.$refs)||void 0===e||null===(e=e.realPromptInput)||void 0===e||e.resizeTextarea()}catch(e){}},handleKeyCode:function(e){if(this.debounceCheckScroll&&this.debounceCheckScroll(),13==e.keyCode)if(e.metaKey||e.altKey){var t=this.value.prompt,n=document.querySelector("#easyGenerateInput"),o=n.selectionStart,l=n.selectionEnd,r=t.slice(0,o)+"\n"+t.slice(l);n.focus(),setTimeout((function(){n.setSelectionRange(o+1,o+1),n.focus()}),10),this.changeConfig(r,"prompt")}else e.preventDefault(),this.debounceGenerate&&this.debounceGenerate()},checkNotAllowQualityMode:function(){var e,t,n;return(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.hasEnableImageToImage)&&(null==this||null===(t=this.easyTop)||void 0===t?void 0:t.isSDXLModel)&&(null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isEnableQuality)},handleGenerate:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==(n=e.value)&&void 0!==n&&n.prompt){t.next=2;break}return t.abrupt("return");case 2:if(!e.checkNotAllowQualityMode()){t.next=13;break}return t.prev=3,t.next=6,null===(o=e.$refs)||void 0===o||null===(o=o.commonConfirmModal)||void 0===o?void 0:o.show({subTitle:"newGenerate46"}).then((function(){var t,n=JSON.parse(JSON.stringify(e.value));Object.assign(n,{generate:{gen_mode:0}}),null==e||null===(t=e.easyTop)||void 0===t||t.updateConfig(n)}));case 6:null===(l=e.easyTop)||void 0===l||l.handleGenerate(),t.next=11;break;case 9:t.prev=9,t.t0=t.catch(3);case 11:t.next=14;break;case 13:null===(r=e.easyTop)||void 0===r||r.handleGenerate();case 14:case"end":return t.stop()}}),t,null,[[3,9]])})))()},handleDeleteControlNet:function(e){var t=JSON.parse(JSON.stringify(this.value));try{var n;t.controlnet_units.splice(e,1),null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(t)}catch(e){}},changeConfig:function(e,t){var n;"enableNegativePrompts"===t&&this.$logEvent("log_actions",{operation:"click_cancel_negative_prompt",behavior_info:"on_new_create_flow_page"}),this.debounceCheckScroll&&this.debounceCheckScroll();var o=JSON.parse(JSON.stringify(this.value));t&&(o[t]=e),null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)},handleOpenPickWorkModal:function(){var e,t,n,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;o&&"imageToImage"===o.type&&null!==(e=this.value.imageToImageList)&&void 0!==e&&e.length||o&&"controlNet"===o.type&&(null===(t=this.value)||void 0===t||null===(t=t.controlnet_units)||void 0===t?void 0:t.length)>=3?this.$message.warning(this.$t("newGenerate41")):o&&"IpMaintain"===o.type&&(null===(n=this.value)||void 0===n||null===(n=n.ipList)||void 0===n?void 0:n.length)>=1?this.$message.warning(this.$t("newGenerate64")):this.$refs.pickOrUploadImageModal.openModal([],o||null)},handleDeleteIpMain:function(){try{var e,t=JSON.parse(JSON.stringify(this.value));t.ipList=[],t.lab_base.conds=(t.lab_base.conds||[]).filter((function(e){return"IpMaintain"!==(null==e?void 0:e.mode)})),null===(e=this.easyTop)||void 0===e||e.updateConfig(t)}catch(e){}},handleUpdateImageSize:function(){var e,t,n,o,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(null==l||null===(e=l.info)||void 0===e?void 0:e.banner)||(null==l?void 0:l.banner)||{},c=r.width,d=r.height,h=JSON.parse(JSON.stringify(this.value)),m={};m=this.convertStudioBaseSize(c,d,this.getCustomSizeOptions),h.width=(null===(t=m)||void 0===t?void 0:t.width)||(null==h?void 0:h.width),h.height=(null===(n=m)||void 0===n?void 0:n.height)||(null==h?void 0:h.height),null==this||null===(o=this.easyTop)||void 0===o||o.updateConfig(h)},convertStudioBaseSize:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=([{code:1,label:"2:3",icon:"icon-a-2_3",sd:{standard:{width:512,height:768}},sdxl:{standard:{width:768,height:1152}},flux:{standard:{width:688,height:1024},quality:{width:1024,height:1536}}},{code:2,label:"1:1",icon:"icon-a-1_11",sd:{standard:{width:768,height:768}},sdxl:{standard:{width:1024,height:1024}},flux:{standard:{width:1024,height:1024},quality:{width:1536,height:1536}}},{code:3,label:"9:16",icon:"icon-a-9_161",sd:{standard:{width:432,height:768}},sdxl:{standard:{width:810,height:1440}},flux:{standard:{width:592,height:1024},quality:{width:864,height:1536}}},{code:4,label:"4:3",icon:"icon-a-4_31",sd:{standard:{width:768,height:576}},sdxl:{standard:{width:1024,height:768}},flux:{standard:{width:1024,height:768},quality:{width:1536,height:1152}}},{code:5,label:"custom",icon:"icon-icon-Custom",sd:{},sdxl:{},flux:{}}]||[]).filter((function(e){return 5!==e.code})).map((function(e){return e.width=e.sd.standard.width,e.height=e.sd.standard.height,e})),l={},r=parseFloat((e/t).toFixed(2)),c=o.find((function(e){var t=parseFloat((e.width/e.height).toFixed(2));return r===t})),d=n;if(c){var h=this.getCurrentModelType;["sd","sdxl"].includes(h)&&(l=c[h].standard),["flux"].includes(h)&&(l=c[h].standard)}else{var m=Object(B.g)(e,t,d.max);l.width=m.width,l.height=m.height,l.isCustom=!0}return l},handlePickImage:function(){var e,t,n=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(l&&"imageToImage"===l.type){var r=JSON.parse(JSON.stringify(this.imageToImageTemplate));return r=Xo(Xo({},r),o[0]||{}),this.handleUpdateImageSize(r),this.changeConfig([r],"imageToImageList"),this.changePackUpStatus(),void this.handleClosePopup()}if(l&&"controlNet"===l.type){var c,d,h,m;if((null===(c=JSON.parse(JSON.stringify(this.value)).controlnet_units)||void 0===c?void 0:c.length)>=3)return;if(this.isRedrawMask)(null===(d=this.$refs)||void 0===d||null===(d=d.commonConfirmModal)||void 0===d?void 0:d.show({subTitle:"newGenerate58"})).then((function(){var e,t,r,c=JSON.parse(JSON.stringify(n.value));(c.imageToImageList||[]).map((function(e){return e.mask="",e.denoising_strength=.35,e})),c.mask="",c.tempMask="",c.copyMask="",null==n||null===(e=n.easyTop)||void 0===e||e.updateConfig(c),null===(t=n.easyTop)||void 0===t||t.addControlNet(null==l?void 0:l.controlNetInfo,(null===(r=o[0])||void 0===r?void 0:r.url)||""),n.changePackUpStatus(),n.handleClosePopup()}));else null===(h=this.easyTop)||void 0===h||h.addControlNet(null==l?void 0:l.controlNetInfo,(null===(m=o[0])||void 0===m?void 0:m.url)||""),this.changePackUpStatus(),this.handleClosePopup()}l&&"imageDescribe"===l.type&&(null==this||null===(e=this.easyTop)||void 0===e||e.handleImageToPrompt(null===(t=o[0])||void 0===t?void 0:t.url));if(l&&"IpMaintain"===l.type){var v=JSON.parse(JSON.stringify({image:"",stop_at:1,weight:.75,enable:!0,mode:"IpMaintain"}));(v=Xo(Xo({},v),o[0]||{})).image=v.url||"",this.changeConfig([v],"ipList"),this.changePackUpStatus(),this.handleClosePopup()}},clearMask:function(){}}},Zo=Qo,Yo=(n(3087),Object(y.a)(Zo,(function(){var e,t,n,o,l,r,c,d,h,m,v,f=this,_=f._self._c;return _("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:f.handleClickOutside,expression:"handleClickOutside"},{name:"loading",rawName:"v-loading",value:f.value.loading,expression:"value.loading"}],ref:"inputBox",staticClass:"c-easy-top-input-area",class:[f.promptActive&&"easy-top-input-area-active",f.showBottomPadding&&!f.isPackUp&&"easy-top-input-area-padding-bottom",f.isPackUp&&"easy-top-input-area-pack-up"]},[_("div",{staticClass:"top-input-box top-input-box-check",staticStyle:{opacity:"0 !important",visibility:"hidden"}},[f._m(0),f._v(" "),_("div",{staticClass:"top-input-area"},[_("el-input",{key:"top-input-area-input-check",ref:"easyGenerateInputAreaCheck",staticClass:"top-input-area-input",attrs:{type:"textarea",value:f.value.prompt,placeholder:f.$t(f.showPlaceholder),autosize:f.inputSize,resize:"none",maxlength:"2000"}})],1),f._v(" "),_("div",{staticClass:"top-input-box-right"},[null!==(e=f.value)&&void 0!==e&&e.prompt?_("div",{staticClass:"top-input-box-right-icon icon-hover-show"},[_("i",{staticClass:"iconfont icon-icon-clear"})]):f._e(),f._v(" "),f._m(1),f._v(" "),_("div",{staticClass:"generate-btn",class:[!(null!==(t=f.value)&&void 0!==t&&t.prompt)&&"generate-btn-disable"]},[null!==(n=f.value)&&void 0!==n&&n.generateing?[_("span",{staticClass:"el-icon-loading"})]:f._e(),f._v("\n        "+f._s(f.$t("Generate"))+"\n        "),!f.value.prompt||null!==(o=f.value)&&void 0!==o&&o.generateing?f._e():_("span",{staticClass:"generate-btn-sub"},[f._v("\n          ("+f._s(f.$t("PhysicalExertion"))+": "+f._s(f.easyTop.calcCost?f.easyTop.calcCost:null===(l=f.easyTop)||void 0===l?void 0:l.computedCost)+" )\n        ")])],2)])]),f._v(" "),_("div",{staticClass:"top-input-box top-input-box-check",staticStyle:{opacity:"0 !important",visibility:"hidden"}},[f._m(2),f._v(" "),_("div",{staticClass:"top-input-area"},[_("el-input",{key:"top-input-area-input-check2",ref:"easyGenerateInputAreaCheck2",staticClass:"top-input-area-input",attrs:{type:"textarea",value:f.value.prompt,placeholder:f.$t(f.showPlaceholder),autosize:f.inputSize,resize:"none",maxlength:"2000"}})],1)]),f._v(" "),_("div",{staticClass:"top-input-box",class:[(!f.isPositionBottom||f.isPackUp)&&"top-input-box-align-center"]},[_("image-and-control-net-popup",{ref:"imageControlNetPopup",on:{openUploadImage:f.handleOpenPickWorkModal,show:function(e){f.imagePopupVisible=!0},hide:function(e){f.imagePopupVisible=!1}}},[_("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:f.$t("newGenerate68"),placement:"top-start"}},[_("span",{staticClass:"top-input-box-icon",class:[f.imagePopupVisible&&"top-input-box-icon-active"]},[_("i",{staticClass:"iconfont icon-a-icon-addimg2img"})])])],1),f._v(" "),_("div",{staticClass:"top-input-area",class:[f.showLineHeight&&"top-input-area-line-height"]},[_("el-input",{ref:"realPromptInput",staticClass:"top-input-area-input top-input-area-input-real",class:[f.isPackUp&&"top-input-area-input-real-pack-up"],attrs:{type:"textarea",value:f.value.prompt,placeholder:f.$t(f.showPlaceholder),autosize:f.inputSize,resize:"none",maxlength:"2000",id:"easyGenerateInput"},on:{focus:f.handleInputFocus,blur:function(e){f.promptActive=!1},input:function(e){return f.changeConfig(e,"prompt")}},nativeOn:{keydown:function(e){return f.handleKeyCode(e)}}})],1),f._v(" "),_("div",{staticClass:"top-input-box-right",class:[f.isPositionBottom&&!f.isPackUp&&"top-input-box-right-absolute"]},[_("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:f.$t("newGenerate69"),placement:"top-start"}},[_("div",{directives:[{name:"show",rawName:"v-show",value:f.showLockParamsBtn,expression:"showLockParamsBtn"}],staticClass:"top-input-box-right-icon icon-hover-show",on:{click:function(e){return e.stopPropagation(),f.toggleLockParamsStatus()}}},[_("i",{staticClass:"iconfont",class:[null!==(r=f.value)&&void 0!==r&&r.isLockParams?"icon-collectLock":"icon-lock-open-variant-outline"]})])]),f._v(" "),_("random-prompt-popup",{on:{openPickImageModal:f.handleOpenPickWorkModal}},[_("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:f.$t("newGenerate70"),placement:"top-start"}},[_("div",{staticClass:"top-input-box-right-icon"},[_("i",{staticClass:"iconfont icon-search-magic"})])])],1),f._v(" "),_("div",{staticClass:"generate-btn",class:[!(null!==(c=f.value)&&void 0!==c&&c.prompt)&&"generate-btn-disable"],on:{click:function(e){return f.debounceGenerate()}}},[null!==(d=f.value)&&void 0!==d&&d.generateing?[_("span",{staticClass:"el-icon-loading"})]:f._e(),f._v("\n        "+f._s(f.$t("Generate"))+"\n        "),!f.value.prompt||null!==(h=f.value)&&void 0!==h&&h.generateing||f.isCompanyAccount?f._e():_("span",{staticClass:"generate-btn-sub"},[f._v("\n          ("+f._s(f.$t("PhysicalExertion"))+": "+f._s(f.easyTop.calcCost>=0?f.easyTop.calcCost:null===(m=f.easyTop)||void 0===m?void 0:m.computedCost)+" )\n        ")])],2)],1)],1),f._v(" "),_("div",{directives:[{name:"show",rawName:"v-show",value:f.value.enableNegativePrompts&&!f.isPackUp,expression:"value.enableNegativePrompts && !isPackUp"}],staticClass:"negative-prompt-input-box"},[_("hr",{staticClass:"negative-prompt-input-box-divider",class:[null!==(v=f.value)&&void 0!==v&&v.prompt?"margin-top-10":""],attrs:{"aria-orientation":"horizontal"}}),f._v(" "),_("div",{staticClass:"negative-prompt-input-box-tag"},[_("div",{staticClass:"input-box-tag"},[_("div",{staticClass:"input-box-tag-text"},[f._v(f._s(f.$t("NegativePrompts")))]),f._v(" "),_("div",{staticClass:"input-box-tag-icon",on:{click:function(e){return e.stopPropagation(),f.changeConfig(!1,"enableNegativePrompts")}}},[_("i",{staticClass:"el-icon-close"})])])]),f._v(" "),_("div",{staticClass:"negative-prompt-input"},[_("el-input",{ref:"negativePromptInput",staticClass:"top-input-area-input",attrs:{type:"textarea",value:f.value.negative_prompt,autosize:f.inputSize,resize:"none",maxlength:"2000"},on:{focus:function(e){f.promptActive=!0},blur:function(e){f.promptActive=!1},input:function(e){return f.changeConfig(e,"negative_prompt")}}})],1)]),f._v(" "),_("div",{directives:[{name:"show",rawName:"v-show",value:f.showExtraOptionBar,expression:"showExtraOptionBar"}],staticClass:"extra-options-bar"},[f._l(f.value.imageToImageList,(function(image,i){return _("image-to-image-card",{key:"image_".concat(i),attrs:{value:f.value,type:"image",cardInfo:image}})})),f._v(" "),f._l(f.value.ipList,(function(e,i){return _("image-to-image-card",{key:"ipItem_".concat(i),attrs:{value:f.value,type:"IpMaintain",cardInfo:e},on:{delete:f.handleDeleteIpMain}})})),f._v(" "),f._l(f.value.controlnet_units,(function(e,t){return[_("image-to-image-card",{key:"controlNet_".concat(t),attrs:{value:f.value,type:"controlNet",cardInfo:e},on:{delete:function(e){return f.handleDeleteControlNet(t)}}})]}))],2),f._v(" "),_("pick-or-upload-image-modal",{ref:"pickOrUploadImageModal",on:{confirm:f.handlePickImage}}),f._v(" "),_("common-confirm-modal",{ref:"commonConfirmModal"})],1)}),[function(){var e=this._self._c;return e("span",{staticClass:"top-input-box-icon"},[e("i",{staticClass:"iconfont icon-a-icon-addimg2img"})])},function(){var e=this._self._c;return e("div",{staticClass:"top-input-box-right-icon"},[e("i",{staticClass:"iconfont icon-search-magic"})])},function(){var e=this._self._c;return e("span",{staticClass:"top-input-box-icon"},[e("i",{staticClass:"iconfont icon-a-icon-addimg2img"})])}],!1,null,"80f8fde4",null).exports);function es(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ts(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?es(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):es(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var is={name:"UpscaleToolsModal",inject:["easyTop"],props:{value:{type:Object,default:function(){return{}}}},components:{SliderItem:Ln.a,PickOrUploadImageModal:Do},mounted:function(){},data:function(){return{visible:!1,config:{up_scaler:"4x-UltraSharp",scaling_ratio:2,width:768,height:768,realWidth:0,realHeight:0,url:""},loading:!1}},computed:ts(ts(ts({},Object(S.c)("creation",["taskUpscaler"])),Object(S.c)("user",["accountSettingsData","userInfo","isCompanyAccount","isLoggedIn"])),{},{renderUpscaleOptions:function(){return(this.taskUpscaler||[]).map((function(e){return{id:e,name:e}}))},setExpend:function(){var e=1,t=Math.max(this.config.realWidth,this.config.realHeight);t*=this.config.scaling_ratio;return[{min:1024,max:1536,value:1},{min:1536,max:2048,value:3},{min:2048,max:2560,value:4},{min:2560,max:3072,value:6},{min:3072,max:3584,value:8},{min:3584,max:4096,value:10}].forEach((function(n){t>n.min&&t<=n.max&&(e=n.value||2)})),t>4096&&(e=10),e}}),methods:{handleImageLoad:function(e){var t=e.target.naturalWidth,n=e.target.naturalHeight;this.config.realWidth=t,this.config.realHeight=n,this.loading=!1},handleImageLoadError:function(){this.loading=!1},handleGenerate:function(){var e,t=this,n={action:6,category:1};if(n.meta={width:this.config.realWidth,height:this.config.realHeight,hi_res_arg:{image:this.config.url,upscaler_1:this.config.up_scaler,upscaling_resize:this.config.scaling_ratio}},!this.validImageSize(this.config))return this.$message.warning(this.$t("ImageSizeExceedsError"));null===(e=this.easyTop)||void 0===e||e.handleImageExtraUpscale(n).then((function(){t.handleClose()}))},validImageSize:function(e){var t=e.realWidth,n=e.realHeight,o=e.scaling_ratio;return[t,n].every((function(e){return e*o<=4096}))},show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetData(),this.initData(e),this.visible=!0},resetData:function(){this.loading=!1,this.config={up_scaler:"4x-UltraSharp",scaling_ratio:2,width:768,height:768,realWidth:0,realHeight:0,url:""}},initData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null!=e&&e.url&&(this.loading=!0,this.config.url=(null==e?void 0:e.url)||"",this.config.scaling_ratio=(null==e?void 0:e.upscaling_resize)||2,this.config.up_scaler=(null==e?void 0:e.upscaler_1)||"4x-UltraSharp")},handleClose:function(){this.visible=!1},handleConfirm:function(){this.handleClose()},changeConfig:function(e,t){this.$set(this.config,t,e)},handleSelectImage:function(){var e,t,n,o,l,r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])[0]||{};this.loading=!0,this.config.width=null==r||null===(e=r.info)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.width,this.config.height=null==r||null===(t=r.info)||void 0===t||null===(t=t.banner)||void 0===t?void 0:t.height,this.config.realWidth=null==r||null===(n=r.info)||void 0===n||null===(n=n.banner)||void 0===n?void 0:n.width,this.config.realHeight=null==r||null===(o=r.info)||void 0===o||null===(o=o.banner)||void 0===o?void 0:o.height,this.config.url=null==r||null===(l=r.info)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.url},openPickImageModal:function(){this.$refs.pickOrUploadImageModal.openModal()}}},ns=is,as=(n(3088),Object(y.a)(ns,(function(){var e,t=this,n=t._self._c;return n("el-dialog",{attrs:{visible:t.visible,"custom-class":"easy-upscale-tools-modal custom-dialog","destroy-on-close":!1,"close-on-press-escape":!0,modal:!1,"modal-append-to-body":"","append-to-body":"",width:"320px"},on:{"update:visible":function(e){t.visible=e}}},[n("div",{staticClass:"modal-header"},[n("div",{staticClass:"modal-header-title"},[t._v(t._s(t.$t("taskTabUpscale")))])]),t._v(" "),n("div",{staticClass:"modal-content"},[n("div",{staticClass:"modal-content-item"},[n("div",{staticClass:"modal-content-item-label modal-content-item-label-flex"},[n("span",{staticClass:"modal-content-item-label-text"},[t._v(t._s(t.$t("newGenerate10")))]),t._v(" "),n("span",{staticClass:"modal-content-item-label-btn",on:{click:function(e){return e.stopPropagation(),t.openPickImageModal.apply(null,arguments)}}},[t._v(t._s(t.$t("CreativeCenterPopup33")))])]),t._v(" "),n("div",{staticClass:"modal-content-item-content"},[null!==(e=t.config)&&void 0!==e&&e.url?n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"modal-content-item-content-img"},[n("img",{attrs:{src:t.config.url,alt:""},on:{load:t.handleImageLoad,error:t.handleImageLoadError}})]):n("div",{staticClass:"modal-content-item-content-upload-box",on:{click:function(e){return e.stopPropagation(),t.openPickImageModal.apply(null,arguments)}}},[n("span",{staticClass:"iconfont icon-icon_Upload modal-content-item-content-add-icon"})])])]),t._v(" "),n("div",{staticClass:"modal-content-item"},[n("div",{staticClass:"modal-content-item-label"},[t._v(t._s(t.$t("taskRepairMethod")))]),t._v(" "),n("div",{staticClass:"modal-content-item-content"},[n("el-select",{staticClass:"easy-custom-select",attrs:{"popper-append-to-body":!1,"popper-class":"custom-select"},model:{value:t.config.up_scaler,callback:function(e){t.$set(t.config,"up_scaler",e)},expression:"config.up_scaler"}},t._l(t.renderUpscaleOptions,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)]),t._v(" "),n("div",{staticClass:"modal-content-item"},[n("div",{staticClass:"modal-content-item-label"},[t._v(t._s(t.$t("taskScalingRatio")))]),t._v(" "),n("div",{staticClass:"modal-content-item-content"},[n("slider-item",{attrs:{"show-tooltip":!1,value:t.config.scaling_ratio,"hide-label":!0,min:1,max:4,step:.05,label:t.$t("taskScalingRatio")},on:{change:function(e){return t.changeConfig(e,"scaling_ratio")}}})],1)]),t._v(" "),n("el-button",{staticClass:"easy-upscale-tools-modal-btn",on:{click:function(e){return e.stopPropagation(),t.handleGenerate.apply(null,arguments)}}},[t._v("\n      "+t._s(t.$t("Generate"))+"\n      "),t.isCompanyAccount?t._e():n("span",{staticClass:"generate-btn-sub"},[t._v("\n          ("+t._s(t.$t("PhysicalExertion"))+": "+t._s(t.setExpend)+" )\n      ")])])],1),t._v(" "),n("pick-or-upload-image-modal",{ref:"pickOrUploadImageModal",on:{confirm:t.handleSelectImage}})],1)}),[],!1,null,null,null)),os=as.exports;function ss(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ls(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ss(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ss(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rs={name:"AnimeToolsModal",inject:["easyTop"],props:{value:{type:Object,default:function(){return{}}}},components:{SliderItem:Ln.a,PickOrUploadImageModal:Do},data:function(){return{visible:!1,config:{width:0,height:0,realWidth:0,realHeight:0,cover:"",animatediff:{lora:"",weight:1,category:0},url:"",workInfo:null},timeList:[{label:"shortVersion",value:0},{label:"longVersion",value:1}],motionLoRAVisible:!1,loading:!1,taskLoading:!1,btnLoading:!1}},computed:ls(ls(ls({},Object(S.c)("creation",["taskUpscaler","animationLoraRecommends"])),Object(S.c)("user",["accountSettingsData","userInfo","isCompanyAccount","isLoggedIn"])),{},{setExpend:function(){var e,t=30;return 1===(null===(e=this.config)||void 0===e||null===(e=e.animatediff)||void 0===e?void 0:e.category)&&(t=50),t},renderUpscaleOptions:function(){return(this.taskUpscaler||[]).map((function(e){return{id:e,name:e}}))}}),methods:{handleImageLoad:function(e){var t=e.target.naturalWidth,n=e.target.naturalHeight;this.config.realWidth=t,this.config.realHeight=n,this.loading=!1},handleImageLoadError:function(){this.loading=!1},show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetData(),this.initData(e),this.visible=!0},initData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.animatediff,n=void 0===t?{}:t,o=e.url,l=void 0===o?"":o,r=e.requestParams;this.config.animatediff=Object.assign(this.config.animatediff,n||{}),this.config.url=l||"",this.config.requestParams=r||null},resetData:function(){this.config={width:0,height:0,realWidth:0,realHeight:0,cover:"",animatediff:{lora:"",weight:1,category:0},url:"",requestParams:null},this.btnLoading=!1,this.taskLoading=!1,this.loading=!1},handleClose:function(){this.resetData(),this.visible=!1},handleConfirm:function(){this.handleClose()},changeConfig:function(e,t){["weight","category"].includes(t)?this.$set(this.config.animatediff,t,e):this.$set(this.config,t,e)},handleSelectImage:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return m=(e.length>0&&void 0!==e[0]?e[0]:[])[0]||{},t.config.width=null==m||null===(o=m.info)||void 0===o||null===(o=o.banner)||void 0===o?void 0:o.width,t.config.height=null==m||null===(l=m.info)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.height,t.config.realWidth=null==m||null===(r=m.info)||void 0===r||null===(r=r.banner)||void 0===r?void 0:r.width,t.config.realHeight=null==m||null===(c=m.info)||void 0===c||null===(c=c.banner)||void 0===c?void 0:c.height,t.loading=!0,t.config.url=null==m||null===(d=m.info)||void 0===d||null===(d=d.banner)||void 0===d?void 0:d.url,t.config.requestParams=null,n.next=11,t.handleGetReferInfo(null==m||null===(h=m.info)||void 0===h?void 0:h.id);case 11:case"end":return n.stop()}}),n)})))()},openPickImageModal:function(){this.$refs.pickOrUploadImageModal.openModal()},handleAddMotion:function(){this.motionLoRAVisible=!0},handleDeleteMotion:function(){this.config.cover="",this.config.animatediff.lora=""},setModel:function(e){this.config.animatediff.weight=1,this.config.animatediff.lora=e.value,this.config.cover=e.url,this.motionLoRAVisible=!1},handleGetReferInfo:function(e){var t=this,n={art_work_no:e,task_flow_version:"v2"};this.taskLoading=!0,Object(A.o)(n).then((function(e){var o;if([1e4,"10000"].includes(null==e||null===(o=e.status)||void 0===o?void 0:o.code)){var l=(null==e?void 0:e.data)||{},r=(null==l?void 0:l.art_model)||{},c={art_model_no:r.id,art_model_ver_no:r.model_ver_no,art_work_no:n.art_work_no,action:24,category:1,meta:(null==l?void 0:l.meta)||{}};if(null!=c&&c.meta)try{delete c.meta.hi_res_arg}catch(e){}t.config.requestParams=c}else t.$message.error(e.status.msg||t.$t("ServerError"))})).catch((function(e){})).finally((function(){t.taskLoading=!1}))},handleGenerate:function(){var e=this;if(!this.taskLoading&&!this.btnLoading){var t=JSON.parse(JSON.stringify(this.config.requestParams));t.meta.init_images=[this.config.url],t.meta.animatediff=this.config.animatediff,this.btnLoading=!0;try{var n;null===(n=this.easyTop)||void 0===n||n.handleAnimeGenerate(t).then((function(t){1e4===(null==t?void 0:t.status.code)&&e.handleClose()})).finally((function(){e.btnLoading=!1}))}catch(e){}}}}},cs=rs,ds=(n(3089),Object(y.a)(cs,(function(){var e,t,n,o,l,r,c,d=this,h=d._self._c;return h("el-dialog",{attrs:{visible:d.visible,"custom-class":"easy-upscale-tools-modal custom-dialog","destroy-on-close":!1,"close-on-press-escape":!0,modal:!1,"modal-append-to-body":"","append-to-body":"",width:"320px"},on:{"update:visible":function(e){d.visible=e}}},[h("div",{staticClass:"modal-header"},[h("div",{staticClass:"modal-header-title"},[d._v(d._s(d.$t("AnimGen")))])]),d._v(" "),h("div",{staticClass:"modal-content"},[h("div",{staticClass:"modal-content-item"},[h("div",{staticClass:"modal-content-item-label modal-content-item-label-flex"},[h("span",{staticClass:"modal-content-item-label-text"},[d._v(d._s(d.$t("personalFeed")))]),d._v(" "),h("span",{directives:[{name:"show",rawName:"v-show",value:null===(e=d.config)||void 0===e?void 0:e.url,expression:"config?.url"}],staticClass:"modal-content-item-label-btn",on:{click:function(e){return e.stopPropagation(),d.openPickImageModal.apply(null,arguments)}}},[d._v(d._s(d.$t("selectingMaterialsType1")))])]),d._v(" "),h("div",{staticClass:"modal-content-item-content"},[null!==(t=d.config)&&void 0!==t&&t.url?h("div",{directives:[{name:"loading",rawName:"v-loading",value:d.loading||d.taskLoading,expression:"loading || taskLoading"}],staticClass:"modal-content-item-content-img"},[h("img",{attrs:{src:d.config.url,alt:""},on:{load:d.handleImageLoad,error:d.handleImageLoadError}})]):h("div",{staticClass:"modal-content-item-content-upload-box",on:{click:function(e){return e.stopPropagation(),d.openPickImageModal.apply(null,arguments)}}},[h("span",{staticClass:"iconfont icon-organize modal-content-item-content-add-icon"})])])]),d._v(" "),h("div",{staticClass:"modal-content-item"},[h("div",{staticClass:"modal-content-item-label modal-content-item-label-flex"},[h("span",{staticClass:"modal-content-item-label-text"},[d._v(d._s(d.$t("newGenerate57")))]),d._v(" "),h("span",{directives:[{name:"show",rawName:"v-show",value:null===(n=d.config.animatediff)||void 0===n?void 0:n.lora,expression:"config.animatediff?.lora"}],staticClass:"modal-content-item-label-btn",on:{click:function(e){return e.stopPropagation(),d.handleAddMotion.apply(null,arguments)}}},[d._v(d._s(d.$t("Replace")))])]),d._v(" "),h("div",{directives:[{name:"show",rawName:"v-show",value:!(null!==(o=d.config.animatediff)&&void 0!==o&&o.lora),expression:"!config.animatediff?.lora"}],staticClass:"modal-content-item-content-add"},[h("div",{staticClass:"modal-content-item-content-add-text"},[d._v(d._s(d.$t("add")))]),d._v(" "),h("div",{staticClass:"modal-content-item-content-add-icon el-icon-circle-plus-outline",on:{click:function(e){return e.stopPropagation(),d.handleAddMotion.apply(null,arguments)}}})]),d._v(" "),null!==(l=d.config.animatediff)&&void 0!==l&&l.lora?h("div",{staticClass:"content-motion-card"},[h("div",{staticClass:"additional-panel-card-item-cover"},[h("video",{attrs:{src:null===(r=d.config)||void 0===r?void 0:r.cover,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0}})]),d._v(" "),h("div",{staticClass:"additional-panel-card-item-content"},[h("div",{staticClass:"card-item-content-title"},[h("div",{staticClass:"card-item-content-title-text"},[d._v(d._s(null===(c=d.config.animatediff)||void 0===c?void 0:c.lora))]),d._v(" "),h("i",{staticClass:"el-icon-delete card-item-close-btn",on:{click:function(e){return e.stopPropagation(),d.handleDeleteMotion.apply(null,arguments)}}})]),d._v(" "),h("slider-item",{attrs:{value:d.config.animatediff.weight,min:-1,max:2,step:.05,label:"Strength","hide-label":!0},on:{change:function(e){return d.changeConfig(e,"weight")}}})],1)]):d._e()]),d._v(" "),h("div",{staticClass:"modal-content-item"},[h("div",{staticClass:"modal-content-item-label"},[d._v(d._s(d.$t("taskScalingRatio")))]),d._v(" "),h("div",{staticClass:"modal-content-item-content-panel"},d._l(d.timeList,(function(e,t){return h("div",{key:"method_".concat(t,"_").concat(e.category),staticClass:"panel-item",class:[e.value===d.config.animatediff.category?"active-btn":""],on:{click:function(t){return t.stopPropagation(),d.changeConfig(e.value,"category")}}},[d._v(d._s(d.$t(e.label))+"\n        ")])})),0)]),d._v(" "),h("el-button",{staticClass:"easy-upscale-tools-modal-btn",attrs:{loading:d.btnLoading},on:{click:function(e){return e.stopPropagation(),d.handleGenerate.apply(null,arguments)}}},[d._v("\n      "+d._s(d.$t("Generate"))+"\n      "),d.isCompanyAccount?d._e():h("span",{staticClass:"generate-btn-sub"},[d._v("\n          ("+d._s(d.$t("PhysicalExertion"))+": "+d._s(d.setExpend)+" )\n      ")])])],1),d._v(" "),h("pick-or-upload-image-modal",{ref:"pickOrUploadImageModal",attrs:{type:"animGen"},on:{confirm:d.handleSelectImage}}),d._v(" "),h("el-dialog",{attrs:{visible:d.motionLoRAVisible,"custom-class":"styleModal",width:"1376px",title:"MotionLoRA","modal-append-to-body":!0,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){d.motionLoRAVisible=e}}},[h("div",{staticClass:"anime-tools-modal-modelList"},d._l(d.animationLoraRecommends,(function(e){var t,n;return h("div",{key:e.value,staticClass:"anime-tools-modal-model-item",class:{"anime-tools-modal-model-item-active":(null===(t=d.config.animatediff)||void 0===t?void 0:t.lora)===e.value},on:{click:function(t){return d.setModel(e)}}},[h("video",{style:{transform:(null===(n=d.config.animatediff)||void 0===n?void 0:n.lora)==e.value?"scale(0.8)":""},attrs:{src:e.url,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0}}),d._v(" "),h("div",{staticClass:"anime-tools-modal-model-name"},[d._v(d._s(e.value))])])})),0)])],1)}),[],!1,null,null,null)),us=ds.exports,hs=n(3090),ps={name:"categoryPanel",inject:["easyTop"],data:function(){return{categoryMap:{model:"Model",fast_app:"Swtft_App",character:"digitalHuman"}}},computed:{covertType:function(){var e,t=this.categoryMap[null==this||null===(e=this.easyTop)||void 0===e?void 0:e.activeCategory]||"";return t?this.$t(t):""},currentCategoryInfo:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.categoryInfo}},methods:{openCategoryModal:function(){this.$EventBus.$emit("openCombinedSelectDialog")}}},ms=(n(3091),Object(y.a)(ps,(function(){var e,t,n=this,o=n._self._c;return o("div",{staticClass:"c-easy-model-panel",style:{backgroundImage:"url(".concat(null===(e=n.currentCategoryInfo)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.url,")")},on:{click:function(e){return e.stopPropagation(),n.openCategoryModal.apply(null,arguments)}}},[o("div",{staticClass:"model-panel-card"},[o("div",{staticClass:"model-panel-card-left"},[o("div",{staticClass:"model-panel-card-left-box"},[o("span",{staticClass:"model-panel-card-left-tag"},[n._v(n._s(n.covertType))])]),n._v(" "),o("span",{staticClass:"model-panel-card-left-text"},[n._v(n._s(null===(t=n.currentCategoryInfo)||void 0===t?void 0:t.name))])]),n._v(" "),n._m(0)])])}),[function(){var e=this._self._c;return e("div",{staticClass:"model-panel-card-right"},[e("span",{staticClass:"el-icon-caret-bottom"})])}],!1,null,"e5b12cd6",null)),vs=ms.exports,gs={props:{title:{type:String,default:""}},data:function(){return{isOpen:!0,scrollHeight:0}},mounted:function(){this.updateScrollHeight()},computed:{getStyle:function(){return{maxHeight:this.isOpen?"".concat(this.scrollHeight+20,"px"):"0px",padding:this.isOpen?"10px 0":"0px",borderTop:this.isOpen?"1px solid rgba(255, 255, 255, 0.06)":"0"}}},methods:{handleClick:function(){this.isOpen=!this.isOpen,this.updateScrollHeight()},updateScrollHeight:function(){var e=this;this.$nextTick((function(){var t;e.scrollHeight=(null===(t=e.$refs.content)||void 0===t?void 0:t.scrollHeight)||0}))}}},fs=(n(3092),Object(y.a)(gs,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"collapse-components"},[t("div",{staticClass:"collapse-components-top",on:{click:e.handleClick}},[t("span",{staticClass:"collapse-components-top-title overflow-ellipsis"},[e._v(e._s(e.title))]),e._v(" "),t("i",{staticClass:"el-icon-arrow-down collapse-components-top-icon",class:{"is-open":e.isOpen}})]),e._v(" "),t("div",{ref:"content",staticClass:"collapse-components-content",style:e.getStyle},[e._t("default")],2)])}),[],!1,null,"112a1226",null).exports);function _s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function bs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_s(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ys={inject:["top"],props:{itemData:{type:Object,default:function(){}}},components:{CollapseComponent:fs},data:function(){return{}},mounted:function(){},computed:{idsObj:function(){var e=this.itemData;return{field:e.field,node_id:e.node_id,node_type:e.node_type}},getClass:function(){return{"input-field":!0,"number-input":1!=this.itemData.value_type}}},methods:{changeValue:function(e){this.top.changeVal(bs(bs({},this.idsObj),{},{val:e}))},getDecimalCount:function(e){var t=e.toString();return t.includes(".")?t.split(".")[1].length:0},formatStepPrecision:function(e,t){var n=Math.pow(10,e-1);return Number((Math.ceil(t*n)/n).toFixed(e))}},render:function(){var e=arguments[0],t=this.itemData,n=t.value_type,o=t.option||{},l=o.step,r=void 0===l?.1:l,c=o.min,d=void 0===c?0:c,h=o.max,m=void 0===h?100:h,v=o.accuracy,f=void 0===v?.1:v;f<this.getDecimalCount(r)&&(r=this.formatStepPrecision(f,r)),0!=f&&0!=r||(r=1);var _=e(fs,{attrs:{title:this.itemData.title}},[e("el-input",{attrs:{placeholder:"",type:"textarea",resize:"none",value:this.itemData.val},on:{input:this.changeValue}})]),y=e("div",{class:"number-input-box width-height-hundred"},[e("div",{class:"number-input-title"},[this.itemData.title]),e("el-input-number",{attrs:{size:"small",step:r,precision:f,min:d,max:m,value:this.itemData.val},on:{change:this.changeValue}})]);return e("div",{class:this.getClass},[1==n?_:y])}},ws=ys,Cs=(n(3093),Object(y.a)(ws,undefined,undefined,!1,null,"252edf68",null).exports),ks=n(209);function Ss(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function xs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ss(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ss(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Is={inject:["top"],props:{itemData:{type:Object,default:function(){}}},components:{CollapseComponent:fs,pickWorkModal:ks.a},data:function(){return{uploading:!1}},computed:xs(xs({},Object(S.c)("user",["isLoggedIn"])),{},{idsObj:function(){var e=this.itemData;return{field:e.field,node_id:e.node_id,node_type:e.node_type}},enableMaskEdit:function(){var e=(this.itemData||{}).option,option=void 0===e?{}:e;return null==option?void 0:option.is_mask_draw}}),mounted:function(){var e=this;this.$EventBus.$on("workflowAppDetailModalConfirm",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})||{},o=n.field,l=void 0===o?"":o,r=n.node_id,c=void 0===r?"":r,d=n.node_type,h=void 0===d?"":d,m=l&&l===e.idsObj.field,v=c&&c===e.idsObj.node_id,f=h&&h===e.idsObj.node_type;m&&v&&f&&e.top.changeVal(xs(xs({},e.idsObj),{},{val:t}))}))},beforeDestroy:function(){this.$EventBus.$off("workflowAppDetailModalConfirm")},methods:{openGenerateModal:function(){this.enableMaskEdit&&(this.$logEvent("log_actions",{operation:"click_edit_mask",behavior_info:"on_app_detail_page"}),this.$EventBus.$emit("openWorkflowAppDetailModal",this.itemData.val,this.itemData))},openPickWorkModal:function(){this.isLoggedIn?(this.$logEvent("log_actions",{operation:"click_choose_personal_work",behavior_info:"on_app_detail_page"}),this.$refs.pickWorkModal.openModal([])):this.$EventBus.$emit("openLoginDialog")},handlePickImage:function(e){e.type;var t=e.url,n=void 0===t?"":t;e.width,e.height;this.top.changeVal(xs(xs({},this.idsObj),{},{val:n}))},handleBeforeUpload:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(["image/jpeg","image/png","image/jpg","image/webp"].includes(e.type)){n.next=4;break}return t.$message.error(t.$t("AllowImageFiles")),n.abrupt("return");case 4:if(!(e.size/1024/1024>10)){n.next=14;break}return n.prev=5,n.next=8,Object(Ut.a)(e,10485760);case 8:e=n.sent,n.next=14;break;case 11:return n.prev=11,n.t0=n.catch(5),n.abrupt("return",!1);case 14:t.handleUploadImage(e);case 15:case"end":return n.stop()}}),n,null,[[5,11]])})))()},handleUploadImage:function(e){var t=this;this.uploading=!0,new pi.a({type:20}).startUpload(e,{category:20}).then((function(e){t.top.changeVal(xs(xs({},t.idsObj),{},{val:e})),t.uploading=!1})).catch((function(e){t.uploading=!1}))},handleDelete:function(){this.top.changeVal(xs(xs({},this.idsObj),{},{val:""}))}}},Os=Is,Ts=(n(3094),Object(y.a)(Os,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"image-field"},[t("CollapseComponent",{attrs:{title:e.itemData.title}},[e.itemData.val?t("div",{staticClass:"image-field-display"},[t("img",{staticClass:"img width-height-hundred",class:[e.enableMaskEdit&&"cursor-pointer"],attrs:{src:e.itemData.val,alt:"image"},on:{click:function(t){return t.stopPropagation(),e.openGenerateModal.apply(null,arguments)}}}),e._v(" "),t("i",{staticClass:"iconfont delete-icon icon-shanchu",on:{click:e.handleDelete}}),e._v(" "),e.enableMaskEdit?t("span",{staticClass:"edit-mask-btn",on:{click:function(t){return t.stopPropagation(),e.openGenerateModal.apply(null,arguments)}}},[e._v("Edit Mask")]):e._e()]):t("div",{staticClass:"image-field-upload-box"},[t("el-upload",{attrs:{action:"#","before-upload":e.handleBeforeUpload,"show-file-list":!1,"http-request":function(){}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],staticClass:"uploader"},[t("i",{staticClass:"el-icon-plus"})])]),e._v(" "),t("div",{staticClass:"el-upload pick-item",on:{click:function(t){return t.stopPropagation(),e.openPickWorkModal()}}},[t("div",{staticClass:"upload-item-text"},[e._v(e._s(e.$t("CreativeCenterPopup21")))])]),e._v(" "),t("pick-work-modal",{ref:"pickWorkModal",attrs:{type:"workFlowAppDetail"},on:{confirm:e.handlePickImage}})],1)])],1)}),[],!1,null,"39394a9a",null)),$s=Ts.exports,Ls=n(210);function Ps(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ms(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ps(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ps(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var js={inject:["top"],props:{itemData:{type:Object,default:function(){}}},components:{CollapseComponent:fs,WorkflowStyleModal:Ls.a},data:function(){return{displayData:{name:"",url:"",version_name:""}}},watch:{itemData:{handler:function(e){var t,n=(e||{}).art_model;n&&(this.displayData.name=null==n?void 0:n.name,this.displayData.url=null==n||null===(t=n.banner)||void 0===t?void 0:t.url,this.displayData.version_name=null==n?void 0:n.version_name)},deep:!0}},computed:{idsObj:function(){var e=this.itemData;return{field:e.field,node_id:e.node_id,node_type:e.node_type}}},methods:{changeUrl:function(e){return Object(k.x)(e,"high")},openModelSelect:function(){this.$refs.workflowStyleModal.openModal({modelType:"Checkpoint"})},handleSelectModel:function(e){var t=e.info||{},n=t.id,o=void 0===n?"":n,l=t.name,r=void 0===l?"":l,c=t.model_ver_no,d=void 0===c?"":c,h=t.version_name,m=void 0===h?"":h,v=t.banner,f=void 0===v?{}:v,_="".concat(o,"@").concat(d);this.displayData={name:r,url:(null==f?void 0:f.url)||"",version_name:m},this.top.changeVal(Ms(Ms({},this.idsObj),{},{val:_})),this.$refs.collapse.updateScrollHeight()}}},Ds=(n(3095),Object(y.a)(js,(function(){var e,t=this,n=t._self._c;return n("div",{staticClass:"checkpoint-field"},[n("CollapseComponent",{ref:"collapse",attrs:{title:t.itemData.title}},[t.itemData.val?n("div",{staticClass:"checkpoint-field-content"},[n("div",{staticClass:"checkpoint-field-content-left"},[n("div",{staticClass:"version-name flex-center"},[t._v("\n\t\t\t\t\t"+t._s(t.displayData.version_name)+"\n\t\t\t\t")]),t._v(" "),null!==(e=t.displayData)&&void 0!==e&&e.url?n("el-image",{attrs:{fit:"cover",src:t.changeUrl(t.displayData.url)}},[n("template",{slot:"placeholder"},[n("i",{staticClass:"el-icon-loading image-loading"})])],2):n("p",{staticClass:"empty-img flex-center"},[t._v("\n\t\t\t\t\t"+t._s(t.$t("EmptyBannerText"))+"\n\t\t\t\t")]),t._v(" "),n("div",{staticClass:"name overflow-ellipsis",attrs:{title:t.displayData.name}},[t._v("\n\t\t\t\t\t"+t._s(t.displayData.name)+"\n\t\t\t\t")])],1),t._v(" "),n("div",{staticClass:"checkpoint-field-content-right flex-center",on:{click:t.openModelSelect}},[n("i",{staticClass:"iconfont icon-select-model-icon"}),t._v(" "),n("span",{staticClass:"text"},[t._v(t._s(t.$t("switch")))])])]):n("div",{staticClass:"add-icon flex-center",on:{click:t.openModelSelect}},[n("i",{staticClass:"el-icon-plus"})])]),t._v(" "),n("WorkflowStyleModal",{ref:"workflowStyleModal",on:{selectModel:t.handleSelectModel}})],1)}),[],!1,null,"7589cd04",null).exports);function Ns(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Es(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ns(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ns(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Rs={inject:["top"],props:{itemData:{type:Object,default:function(){}}},components:{CollapseComponent:fs,WorkflowStyleModal:Ls.a},data:function(){return{displayData:{name:"",url:"",version_name:""}}},watch:{itemData:{handler:function(e){var t,n=(e||{}).art_model;n&&(this.displayData.name=null==n?void 0:n.name,this.displayData.url=null==n||null===(t=n.banner)||void 0===t?void 0:t.url,this.displayData.version_name=null==n?void 0:n.version_name)},deep:!0}},computed:{idsObj:function(){var e=this.itemData;return{field:e.field,node_id:e.node_id,node_type:e.node_type}}},methods:{changeUrl:function(e){return Object(k.x)(e,"high")},openModelSelect:function(){this.$refs.workflowStyleModal.openModal({modelType:"LORA"})},handleSelectModel:function(e){var t=e.info||{},n=t.id,o=void 0===n?"":n,l=t.name,r=void 0===l?"":l,c=t.model_ver_no,d=void 0===c?"":c,h=t.version_name,m=void 0===h?"":h,v=t.banner,f=void 0===v?{}:v,_="".concat(o,"@").concat(d);this.displayData={name:r,url:(null==f?void 0:f.url)||"",version_name:m},this.top.changeVal(Es(Es({},this.idsObj),{},{val:_})),this.$refs.collapse.updateScrollHeight()}}},As=(n(3096),Object(y.a)(Rs,(function(){var e,t=this,n=t._self._c;return n("div",{staticClass:"lora-field"},[n("CollapseComponent",{ref:"collapse",attrs:{title:t.itemData.title}},[t.itemData.val?n("div",{staticClass:"lora-field-content"},[n("div",{staticClass:"lora-field-content-left"},[n("div",{staticClass:"version-name flex-center"},[t._v("\n\t\t\t\t\t"+t._s(t.displayData.version_name)+"\n\t\t\t\t")]),t._v(" "),null!==(e=t.displayData)&&void 0!==e&&e.url?n("el-image",{attrs:{fit:"cover",src:t.changeUrl(t.displayData.url)}},[n("template",{slot:"placeholder"},[n("i",{staticClass:"el-icon-loading image-loading"})])],2):n("p",{staticClass:"empty-img flex-center"},[t._v("\n\t\t\t\t\t"+t._s(t.$t("EmptyBannerText"))+"\n\t\t\t\t")]),t._v(" "),n("div",{staticClass:"name overflow-ellipsis",attrs:{title:t.displayData.name}},[t._v("\n\t\t\t\t\t"+t._s(t.displayData.name)+"\n\t\t\t\t")])],1),t._v(" "),n("div",{staticClass:"lora-field-content-right flex-center",on:{click:t.openModelSelect}},[n("i",{staticClass:"iconfont icon-select-model-icon"}),t._v(" "),n("span",{staticClass:"text"},[t._v(t._s(t.$t("switch")))])])]):n("div",{staticClass:"add-icon flex-center",on:{click:t.openModelSelect}},[n("i",{staticClass:"el-icon-plus"})])]),t._v(" "),n("WorkflowStyleModal",{ref:"workflowStyleModal",on:{selectModel:t.handleSelectModel}})],1)}),[],!1,null,"7089af7c",null).exports);function Bs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Us(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bs(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fs={inject:["top"],props:{itemData:{type:Object,default:function(){}}},components:{CollapseComponent:fs},data:function(){return{}},mounted:function(){},computed:{idsObj:function(){var e=this.itemData;return{field:e.field,node_id:e.node_id,node_type:e.node_type}}},methods:{changeValue:function(e){this.top.changeVal(Us(Us({},this.idsObj),{},{val:e}))}}},zs=(n(3097),Object(y.a)(Fs,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"slider-field"},[t("CollapseComponent",{attrs:{title:e.itemData.title}},[t("el-slider",{attrs:{"show-input":"","show-input-controls":!1,value:e.itemData.val,min:e.itemData.option.min,max:e.itemData.option.max,step:e.itemData.option.step},on:{input:e.changeValue}})],1)],1)}),[],!1,null,"08b6523d",null).exports);function Vs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ws(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vs(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Hs={inject:["top"],props:{itemData:{type:Object,default:function(){}}},data:function(){return{}},mounted:function(){},computed:{idsObj:function(){var e=this.itemData;return{field:e.field,node_id:e.node_id,node_type:e.node_type}}},methods:{changeValue:function(e){this.top.changeVal(Ws(Ws({},this.idsObj),{},{val:e}))}}},qs=(n(3098),Object(y.a)(Hs,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"select-field"},[t("div",{staticClass:"select-field-title"},[e._v(e._s(e.itemData.title))]),e._v(" "),t("el-select",{staticClass:"custom-select-transparent",attrs:{"popper-class":"painting-board-select",value:e.itemData.val,"popper-append-to-body":!0},on:{change:e.changeValue}},e._l(e.itemData.option.values,(function(e){return t("el-option",{key:"key"+e,attrs:{label:e,value:e}})})),1)],1)}),[],!1,null,"65e5a2b5",null).exports);function Gs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Js(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gs(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ks={inject:["top"],props:{itemData:{type:Object,default:function(){}}},data:function(){return{seedMode:"random",numVal:{random:0,custom:0}}},computed:{idsObj:function(){var e=this.itemData;return{field:e.field,node_id:e.node_id,node_type:e.node_type}},isRandom:function(){return"random"===this.seedMode},seedPlsHd:function(){return this.isRandom?this.$t("RandomSeed"):this.$t("customSeed")},getVal:function(){var e=this.numVal,t=e.random,n=e.custom;return this.isRandom?t:n}},watch:{numVal:{handler:function(){this.top.changeVal(Js(Js({},this.idsObj),{},{val:this.getVal}))},deep:!0,immediate:!0}},methods:{initData:function(){this.numVal.random=this.getRandomSeed(),this.numVal.custom=this.getRandomSeed()},changeSeedMode:function(e){this.seedMode=e,this.isRandom?this.numVal.random=this.getRandomSeed():this.top.changeVal(Js(Js({},this.idsObj),{},{val:this.getVal}))},changeValue:function(e){this.isRandom?this.numVal.random=e:this.numVal.custom=e},getRandomSeed:function(){return Math.floor(4294967294*Math.random())+1}}},Xs=(n(3099),Object(y.a)(Ks,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"seed-field"},[t("div",{staticClass:"seed-field-top"},[t("div",{staticClass:"seed-field-top-title"},[e._v(e._s(e.itemData.title))]),e._v(" "),t("div",{staticClass:"seed-field-top-switch"},[t("button",{staticClass:"switch-btn",class:{active:e.isRandom},on:{click:function(t){return e.changeSeedMode("random")}}},[e._v("\n\t\t\t\t"+e._s(e.$t("Random"))+"\n\t\t\t")]),e._v(" "),t("button",{staticClass:"switch-btn",class:{active:!e.isRandom},on:{click:function(t){return e.changeSeedMode("custom")}}},[e._v("\n\t\t\t\t"+e._s(e.$t("Customization"))+"\n\t\t\t")])])]),e._v(" "),t("div",{staticClass:"seed-field-content flex-center"},[t("el-input-number",{attrs:{placeholder:e.seedPlsHd,precision:0,controls:!1,min:-1,disabled:e.isRandom,value:e.getVal},on:{input:e.changeValue}})],1)])}),[],!1,null,"bbc238ee",null).exports),Qs=n(359);function Zs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ys(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zs(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var el={name:"CodeViewer",mixins:[n(575).a],inject:["top","handleQuick"],props:{codeViewData:{type:Array,default:function(){return[]}},height:{type:String,default:"100%"},isCreate:{type:Boolean,default:!1},templateId:{type:String,default:""},loading:{type:Boolean,default:!1}},components:{InputField:Cs,ImageField:$s,CheckpointField:Ds,LoraField:As,SliderField:zs,SelectField:qs,SeedField:Xs,VideoField:Qs.a},data:function(){return{percentComplete:"none",debounceGenerate:function(){}}},computed:Ys(Ys({},Object(S.c)("user",["isLoggedIn"])),{},{getCodeStyle:function(){return{height:this.height}},getComponentsStyle:function(){return{height:this.isCreate?"calc(100% - 68px)":"100%"}},isShowConsume:function(){var e;return 4==(null===(e=this.top)||void 0===e||null===(e=e.workFlowAppData)||void 0===e||null===(e=e.permission)||void 0===e?void 0:e.source)},getEstimatedCost:function(){var e=this.codeViewData.find((function(e){var t=e.field,n=e.node_type;return"model"==t&&"SeaArtSD3"==n}));return"sd3-turbo"==(null==e?void 0:e.val)?30:45}}),watch:{percentComplete:function(e){}},mounted:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.debounceGenerate=Object(X.debounce)(e.handleGenerate,500),t.prev=1,t.next=4,e.loadCaptcha();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),console.log("Google Captcha failed to load or execute",t.t0);case 9:case"end":return t.stop()}}),t,null,[[1,6]])})))()},beforeDestroy:function(){this.debounceGenerate=function(){}},methods:{fieldMap:function(){var e=this.$createElement;return this.codeViewData.map((function(t){var n=t.type,o=[e(Cs,{class:"item-component",attrs:{itemData:t}}),e($s,{class:"item-component",attrs:{itemData:t}}),e(Ds,{class:"item-component",attrs:{itemData:t}}),e(As,{class:"item-component",attrs:{itemData:t}}),e(zs,{class:"item-component",attrs:{itemData:t}}),e(qs,{class:"item-component",attrs:{itemData:t}}),e(Xs,{class:"item-component",attrs:{itemData:t},ref:"seedField"}),e(Qs.a,{class:"item-component",attrs:{itemData:t}})];return(null==o?void 0:o[n-1])||""}))},handleGenerate:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updateCaptcha("cmfy_app");case 2:if(e.percentComplete=0,l=(null==e?void 0:e.templateId)||"",r=!0,c=e.codeViewData.map((function(e){var t=e.field,n=e.node_id,o=e.node_type,l=e.val,c=e.value_type;switch(l||(r=!1),c){case 1:l+="";break;case 2:l=Number(Math.round(l));break;case 3:l=Number(l)}return{field:t,node_id:n,node_type:o,val:l}})),r){t.next=10;break}return e.$message.warning(e.$t("AllValuesRequired")),e.percentComplete="none",t.abrupt("return");case 10:(null===(n=e.$refs)||void 0===n||null===(n=n.seedField)||void 0===n?void 0:n.isRandom)&&(null===(o=e.$refs)||void 0===o||null===(o=o.seedField)||void 0===o||o.changeSeedMode("random")),d={apply_id:l,inputs:c},e.captchaToken&&(d.g_recaptcha_token=e.captchaToken),e.isLoggedIn||(d.g_mode=1,e.$logEvent("log_actions",{operation:"click_generate",behavior_info:"on_swift_ai_detail_page",behavior_info_sub:"guest_visit"})),e.$logEvent("log_actions",{operation:"click_generate",behavior_info:"on_new_create_flow_page"}),Object(Ya.e)(d).then((function(t){var n=t.data.id;if(n){var o,r=[{id:n,process:0,components:[],expiration_time:0,deduction_detail:{},create_at:0,status_desc:"waiting",status:1,creativity:{name:null===(o=e.top)||void 0===o||null===(o=o.workFlowAppData)||void 0===o?void 0:o.name,id:l}}];e.$emit("onCreateTask",r)}else e.percentComplete="none"})).catch((function(e){}));case 16:case"end":return t.stop()}}),t)})))()},loopGetResult:function(e){var t=this;this.loopInterval=setInterval(Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,o={task_ids:[e]},t.isLoggedIn||(o.g_mode=1),n.next=5,batchFetchTaskProcess(o);case 5:if(l=n.sent,null!=(r=l.data.items)&&r[0]){n.next=9;break}return n.abrupt("return");case 9:c=r[0],d=c.process,h=c.status_desc,m=c.task_id,v=void 0===m?"":m,t.handleQuick(r[0]),t.percentComplete=d,n.t0=h,n.next="finish"===n.t0?15:"sysCancelDesc"===n.t0?19:"sysTimeoutDesc"===n.t0?23:27;break;case 15:return clearInterval(t.loopInterval),t.percentComplete="none",t.top.changeSelectedId(v),n.abrupt("break",28);case 19:return clearInterval(t.loopInterval),t.$message.warning(t.$t("systemCancel")),t.percentComplete="none",n.abrupt("break",28);case 23:return clearInterval(t.loopInterval),t.$message.warning(t.$t("systemTimeoutCancel")),t.percentComplete="none",n.abrupt("break",28);case 27:return n.abrupt("break",28);case 28:n.next=32;break;case 30:n.prev=30,n.t1=n.catch(0);case 32:case"end":return n.stop()}}),n,null,[[0,30]])}))),3e3)}},render:function(){var e=arguments[0],t=e("el-tooltip",{class:"item",attrs:{effect:"dark",content:this.$t("workFlow31"),placement:"top"}},[e("span",{class:"el-icon-question generate-tips"})]),n=e("div",{class:"estimated-cost"},["(",this.$t("expend"),": ",this.getEstimatedCost," ",this.$t("coin"),")"]),o=e("el-button",{class:"generate-btn flex-center",on:{click:this.debounceGenerate}},[e("div",{class:"flex-center"},[e("span",{class:"txt"},[this.$t("Generate")]),!this.isShowConsume&&t]),this.isShowConsume&&n]);return e("div",{class:"code-viewer",style:this.getCodeStyle,directives:[{name:"loading",value:this.loading}]},[e("div",{class:"items-component width-height-hundred",style:this.getComponentsStyle},[this.fieldMap()]),this.isCreate&&o])}},tl=el;n(3100);function il(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function nl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?il(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):il(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var al={name:"workFlowAppParams",provide:function(){return{top:this,handleQuick:this.handleQuick}},inject:["easyTop"],components:{CodeViewer:Object(y.a)(tl,undefined,undefined,!1,null,"0514523e",null).exports},data:function(){return{workFlowAppData:{},quickOptions:{},noData:!1}},watch:{categoryInfo:{immediate:!0,deep:!0,handler:function(e){!e||!e.id||null!=e&&e.onlyUpdateInfo||this.handleUpdateWorkflow(e.id)}}},mounted:function(){this.$EventBus.$on("workFlowRetry",this.remixWork)},beforeDestroy:function(){this.$EventBus.$off("workFlowRetry",this.remixWork)},computed:{categoryInfo:function(){return this.easyTop.categoryInfo||null},codeViewerHeight:function(){return""},codeViewData:function(){var e;return(null===(e=this.workFlowAppData)||void 0===e?void 0:e.inputs)||[]}},methods:{handleUpdateWorkflow:function(e){console.log("快应用更新",e),this.workFlowAppData={loading:!0},this.getWorkflowConfig(e)},createTask:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];try{var t;null==this||null===(t=this.easyTop)||void 0===t||t.createWorkFlowAppTask(e)}catch(e){}},getWorkflowConfig:function(e){var t=this,n={template_id:e};Object(Ya.d)(n).then(function(){var n=Object(E.a)(regeneratorRuntime.mark((function n(o){var l,r,c,data,d,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=o.data,d=(null===(l=(null==(data=void 0===c?{}:c)?void 0:data.inputs)||[])||void 0===l?void 0:l.map((function(e){return nl({val:""},e)})))||[],data.inputs=d,data.selectedId="",data.progress="none",t.workFlowAppData=nl(nl(nl({},t.workFlowAppData),data),{},{template_id:e}),null===(r=t.categoryInfo)||void 0===r||!r.retryId){n.next=9;break}return n.next=9,Object(A.h)({id:null===(h=t.categoryInfo)||void 0===h?void 0:h.retryId}).then((function(e){var n,o=(null==e||null===(n=e.data)||void 0===n||null===(n=n.meta)||void 0===n?void 0:n.comfyui_inputs)||[];t.fillFormData(o)}));case 9:t.workFlowAppData.loading=!1;try{t.$nextTick((function(){var e;null===(e=t.$refs.codeViewer.$refs.seedField)||void 0===e||e.initData()}))}catch(e){}case 11:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).finally((function(){try{t.$set(t.workFlowAppData,"loading",!1)}catch(e){}}))},remixWork:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";"retry"===e&&Object(A.h)({id:n}).then((function(e){var n,o=(null==e||null===(n=e.data)||void 0===n||null===(n=n.meta)||void 0===n?void 0:n.comfyui_inputs)||[];t.fillFormData(o)})),"mix"===e&&Object(A.o)({art_work_no:n,source:4}).then((function(e){var n,o=(null==e||null===(n=e.data)||void 0===n||null===(n=n.meta)||void 0===n?void 0:n.comfyui_inputs)||[];t.fillFormData(o)}))},handleQuick:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.quickOptions=e},fillFormData:function(data){var e,t={};data.forEach((function(e){var n="".concat(e.field,"_").concat(e.node_id);t[n]={val:null==e?void 0:e.val,art_model:null==e?void 0:e.art_model}})),((null===(e=this.workFlowAppData)||void 0===e?void 0:e.inputs)||[]).forEach((function(e){var n,o,l="".concat(e.field,"_").concat(e.node_id);e.val=(null===(n=t[l])||void 0===n?void 0:n.val)||e.val,e.art_model=null===(o=t[l])||void 0===o?void 0:o.art_model}))},changeVal:function(e){var t=e.field,n=e.node_id,o=e.node_type,l=e.val,r=this.workFlowAppData.inputs.find((function(e){return e.field==t&&e.node_id==n&&e.node_type==o}));r&&(r.val=l)}}},sl=al,ll=(n(3101),Object(y.a)(sl,(function(){var e,t,n=this,o=n._self._c;return o("div",{staticClass:"c-workflow-app-params"},[o("CodeViewer",{ref:"codeViewer",attrs:{isCreate:!0,height:n.codeViewerHeight,codeViewData:n.codeViewData,templateId:null===(e=n.workFlowAppData)||void 0===e?void 0:e.template_id,loading:null===(t=n.workFlowAppData)||void 0===t?void 0:t.loading},on:{onCreateTask:n.createTask}})],1)}),[],!1,null,"752736e2",null).exports),rl={name:"creaCharacterConfirmModal",data:function(){return{visible:!1,options:null}},props:{dialogWidth:{type:Number,default:407}},methods:{show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetData(),this.options=e,this.visible=!0},resetData:function(){this.options=null},handleClose:function(){this.visible=!1,this.$emit("cancel")},handleConfirm:function(){var e,t,n;null!==(e=this.options)&&void 0!==e&&e.customClose||(this.visible=!1),this.$emit("confirm",{type:null===(t=this.options)||void 0===t?void 0:t.handleMethods,id:(null===(n=this.options)||void 0===n?void 0:n.id)||""})}}},cl=rl,hl=(n(3102),Object(y.a)(cl,(function(){var e,t,n=this,o=n._self._c;return o("el-dialog",{attrs:{"close-on-press-escape":!1,"close-on-click-modal":!1,visible:n.visible,"custom-class":"common-confirm-modal custom-dialog","destroy-on-close":!1,"modal-append-to-body":"","append-to-body":"",width:n.dialogWidth+"px"},on:{"update:visible":function(e){n.visible=e}}},[o("div",{staticClass:"confirm-modal-header"},[o("div",{staticClass:"modal-header-title"},[n._v(n._s((null===(e=n.options)||void 0===e?void 0:e.title)||n.$t("Tip")))]),n._v(" "),o("span",{staticClass:"modal-header-close",on:{click:function(e){return e.stopPropagation(),n.handleClose()}}},[o("i",{staticClass:"el-icon-close"})])]),n._v(" "),n._t("custom_content",(function(){var e,t,l;return[o("div",{staticClass:"confirm-modal-content"},[o("div",{staticClass:"modal-content-left"},[o("div",{staticClass:"warning-icon-box"},[o("i",{staticClass:"iconfont icon-warn"})])]),n._v(" "),o("div",{staticClass:"modal-content-right"},[o("div",{staticClass:"modal-content-right-title"},[n._v(n._s((null===(e=n.options)||void 0===e?void 0:e.mainTitle)||n.$t("createCharacterTip")))]),n._v(" "),null!==(t=n.options)&&void 0!==t&&t.subTitle?[Array.isArray(n.options.subTitle)?n._l(n.options.subTitle,(function(e,t){return o("div",{key:t,staticClass:"modal-content-right-sub-title",domProps:{innerHTML:n._s(e)}})})):[o("div",{staticClass:"modal-content-right-sub-title"},[n._v("\n              "+n._s(null===(l=n.options)||void 0===l?void 0:l.subTitle)+"\n            ")])]]:n._e()],2)])]})),n._v(" "),o("div",{staticClass:"confirm-modal-footer"},[null!==(t=n.options)&&void 0!==t&&t.hideClose?n._e():o("span",{staticClass:"modal-footer-btn modal-footer-btn-cancel",on:{click:function(e){return e.stopPropagation(),n.handleClose()}}},[n._v(n._s(n.$t("Cancel")))]),n._v(" "),o("span",{staticClass:"modal-footer-btn modal-footer-btn-confirm",on:{click:function(e){return e.stopPropagation(),n.handleConfirm()}}},[n._v(n._s(n.$t("Confirm")))])])],2)}),[],!1,null,"7ed11538",null).exports),pl={components:{ConfirmModal:hl},props:{characterId:{type:String,default:""},historyStack:{type:Array,default:function(){return[]}},onlyBack:{type:Boolean,default:!1},fromPage:{type:String,default:""}},data:function(){return{curSessionId:"",loading:!1,characterInfo:{},editIndex:null,curHandle:"edit",isShowLast:!0,editForm:{title:"",id:""},rules:{title:[{required:!0,message:this.$t("enterName"),trigger:"blur"}]},manageMenu:[{title:"Edit",icon:"icon-icon-edit2",key:"edit"},{title:"Delete",icon:"icon-icon-delete",key:"delete"}]}},computed:{lastChatList:{get:function(){var e;return(null===(e=this.characterInfo)||void 0===e?void 0:e.latest_session)||[]},set:function(e){this.characterInfo&&(this.characterInfo.latest_session=e)}}},mounted:function(){var e=this;this.$EventBus.$on("updateCharacterInfo",(function(t){e.characterInfo=t})),this.$EventBus.$on("updateAiChatSessionId",(function(t){e.curSessionId=t}))},beforeDestroy:function(){this.$EventBus.$off("updateCharacterInfo"),this.$EventBus.$off("updateAiChatSessionId")},methods:{handleActions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};console.log("更多操作--",data);var t=e.key,n=void 0===t?"":t,o=data.session_id,l=void 0===o?"":o;switch(this.curHandle=n,this.$logEvent("log_actions",{operation:"click_".concat(n),behavior_info:"on_tarven_detail_page",behavior_info_sub:"last_chat"}),this.editIndex=this.lastChatList.findIndex((function(e){return e.session_id===l})),n){case"edit":this.editForm.title=data.name||this.formatTimestamp(data.create_at),this.editForm.id=data.session_id,this.$refs.confirmModal.show({title:this.$t("lastChatEditTitle"),customClose:!0});break;case"delete":this.$refs.confirmModal.show({id:l,subTitle:this.$t("lastChatDelTitle"),mainTitle:this.$t("lastChatDelMainTitle"),handleMethods:"Del"})}},submitForm:function(e){var t=arguments,n=this;return Object(E.a)(regeneratorRuntime.mark((function o(){var l,r,c,d;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(l=(t.length>1&&void 0!==t[1]?t[1]:{}).id,!(r=void 0===l?"":l)){o.next=15;break}return n.loading=!0,o.prev=4,o.next=7,Object(W.j)({id:r});case 7:d=o.sent,1e4===(null===(c=d.status)||void 0===c?void 0:c.code)&&(null!==n.editIndex&&(n.lastChatList.splice(n.editIndex,1),n.editIndex=null),n.$message.success(n.$t("OperateSuccess")),n.loading=!1),o.next=14;break;case 11:o.prev=11,o.t0=o.catch(4),n.loading=!1;case 14:return o.abrupt("return");case 15:n.$refs[e].validate(function(){var e=Object(E.a)(regeneratorRuntime.mark((function e(t){var o,l,r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=14;break}return n.loading=!0,e.prev=2,e.next=5,Object(W.o)(n.editForm);case 5:l=e.sent,1e4===(null===(o=l.status)||void 0===o?void 0:o.code)&&(null!==n.editIndex&&((r=n.lastChatList[n.editIndex]).name=n.editForm.title,(c=Object(R.a)(n.lastChatList))[n.editIndex]=r,n.lastChatList=c,n.editIndex=null),n.$message.success(n.$t("OperateSuccess")),n.$refs.confirmModal.handleClose(),n.loading=!1),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),n.loading=!1;case 12:e.next=16;break;case 14:return console.log("error submit!!"),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}());case 16:case"end":return o.stop()}}),o,null,[[4,11]])})))()},resetForm:function(e){this.editIndex=null,this.$refs[e]&&this.$refs[e].resetFields()},handleClickNewChat:function(){console.log("$parent",this.$parent),this.$logEvent("log_actions",{operation:"click_create_new_chat",behavior_info:"on_tarven_detail_page"}),this.$EventBus.$emit("createChat")},formatTimestamp:function(e){var t=new Date(e),n=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),r=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0"),d=String(t.getSeconds()).padStart(2,"0");return"".concat(n,"-").concat(o,"-").concat(l," ").concat(r,":").concat(c,":").concat(d)},goback:function(){if(1!==window.history.length){var e=this.historyStack.pop();if(this.onlyBack)this.$router.go(-1);else if(e){var t=e.split("/")[3]||"",n=/\d/.test(t);if(e.includes("source=work"))return this.$router.replace(this.localePath("/cyberPub")),!1;if(e.includes("?quickChat=true"))return this.$router.go(-2),!1;if(t)return n?this.$router.go(-1):this.$router.go(-2),!1;this.$router.go(-1)}else this.$router.go(-1)}else{var o=this.localePath("/");this.$router.push(o)}},changeAiChat:function(e){var t=this.characterInfo.id,n=e.session_id;"chatDetail"===this.fromPage?this.$logEvent("log_actions",{operation:"click_last_chat",behavior_info:"on_tavern_detail_page"}):this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"click_recent_chat"}),this.$EventBus.$emit("updateSession",{character_id:t,session_id:n})}}},ml=pl,vl=(n(3103),{name:"AiChatNav",components:{AiChatLast:Object(y.a)(ml,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"ai-chat-last",class:{"ai-chat-last-pb0":!e.isShowLast}},[t("div",{staticClass:"last-panel",class:{"off-panel":e.isShowLast}},[t("div",{staticClass:"last-title flex-between",on:{click:function(t){e.isShowLast=!e.isShowLast}}},[e._v("\n      "+e._s(e.$t("LastChat"))+"\n      "),t("i",{staticClass:"el-icon-arrow-down"})]),e._v(" "),e.isShowLast?t("div",{staticClass:"last-list"},[t("div",{staticClass:"inner-last-list start-new-chat",on:{click:e.handleClickNewChat}},[t("i",{staticClass:"new-chat-btn iconfont icon-icon_xinjianshuziren"}),e._v(" "),t("span",[e._v(e._s(e.$t("StartNewChat")))])]),e._v(" "),e._l(e.lastChatList,(function(n,i){var o,l;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],key:"lastAiChat_"+i,staticClass:"inner-last-list",class:{"inner-last-list-active":n.session_id===e.curSessionId}},[null!==(o=e.characterInfo)&&void 0!==o&&null!==(o=o.cover)&&void 0!==o&&o.url?t("span",{staticClass:"avatar",style:{backgroundImage:"url(".concat(null===(l=e.characterInfo)||void 0===l||null===(l=l.cover)||void 0===l?void 0:l.url,")")},on:{click:function(t){return e.changeAiChat(n)}}}):t("span",{staticClass:"avatar",on:{click:function(t){return e.changeAiChat(n)}}}),e._v(" "),t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"bottom"}},[t("div",{staticClass:"tooltip-txt",attrs:{slot:"content"},slot:"content"},[e._v("\n            "+e._s(n.name||e.formatTimestamp(n.create_at))+"\n          ")]),e._v(" "),t("span",{staticClass:"time overflow-ellipsis",on:{click:function(t){return e.changeAiChat(n)}}},[e._v("\n            "+e._s(n.name||e.formatTimestamp(n.create_at))+"\n          ")])]),e._v(" "),t("el-popover",{ref:"myPopover",refInFor:!0,attrs:{trigger:"click",placement:"bottom-end","popper-class":"popover-information","append-to-body":!1,"visible-arrow":!1,"popper-options":{boundariesElement:"body"},width:"167"}},[t("div",{staticClass:"pop-btns"},e._l(e.manageMenu,(function(o){return t("div",{key:o.key,staticClass:"pop-btns-item",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.handleActions(o,n)}}},[t("i",{staticClass:"iconfont",class:o.icon}),e._v(" "),t("span",{staticClass:"pop-btns-text"},[e._v(e._s(e.$t(o.title)))])])})),0),e._v(" "),t("div",{staticClass:"el-icon-more-box",attrs:{slot:"reference"},slot:"reference"},[t("i",{staticClass:"el-icon-more"})])])],1)}))],2):e._e()]),e._v(" "),t("ConfirmModal",{ref:"confirmModal",attrs:{dialogWidth:560},on:{confirm:function(t){return e.submitForm("editForm",t)},cancel:function(t){return e.resetForm("editForm")}}},["edit"===e.curHandle?t("template",{slot:"custom_content"},[t("el-form",{ref:"editForm",staticClass:"popup-content-form",attrs:{"label-position":"top",inline:"",model:e.editForm,rules:e.rules,"label-width":"500px"}},[t("el-form-item",{attrs:{label:e.$t("trainName"),prop:"title"}},[t("el-input",{attrs:{maxlength:"30"},model:{value:e.editForm.title,callback:function(t){e.$set(e.editForm,"title",t)},expression:"editForm.title"}})],1)],1)],1):e._e()],2)],1)}),[],!1,null,"053308e0",null).exports},inject:["easyTop"],data:function(){return{}},mounted:function(){},computed:{},methods:{handleScroll:function(){}}}),gl=(n(3104),{name:"CommonParamsPanel",inject:["easyTop"],components:{AiChatNav:Object(y.a)(vl,(function(){var e=this._self._c;return e("div",{staticClass:"ai-chat-nav",on:{scroll:this.handleScroll}},[e("div",{staticClass:"params-panel-main"},[e("AiChatLast")],1)])}),[],!1,null,"8a72bb98",null).exports,categoryPanel:vs,workFlowAppParams:ll},data:function(){return{}},mounted:function(){},computed:{codeViewerHeight:function(){return this.app.isShowBanner?"calc(100vh - 20px - 74px - 46px - 62px)":"calc(100vh - 20px - 74px - 62px)"},codeViewData:function(){var e;return(null===(e=this.workFlowAppData)||void 0===e?void 0:e.inputs)||[]}},methods:{createTask:function(){}}}),fl=(n(3105),Object(y.a)(gl,(function(){var e,t,n,o=this,l=o._self._c;return l("div",{staticClass:"c-common-params-panel"},[l("div",{staticClass:"params-panel-main",class:[["fast_app"].includes(null===(e=o.easyTop)||void 0===e?void 0:e.activeCategory)&&"params-panel-main-100"]},[l("category-panel"),o._v(" "),["fast_app"].includes(null===(t=o.easyTop)||void 0===t?void 0:t.activeCategory)?[l("work-flow-app-params")]:o._e(),o._v(" "),["character"].includes(null===(n=o.easyTop)||void 0===n?void 0:n.activeCategory)?[l("AiChatNav")]:o._e()],2)])}),[],!1,null,"c539d2ec",null).exports),_l=n(31),bl=n(270);function yl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function wl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yl(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n(125);var Cl=n(133),kl={props:{info:{type:Object,default:function(){return{}}}},data:function(){return{formList:[]}},computed:{},mounted:function(){this.getMetaInfo()},methods:{isModelItem:function(e){return["CheckpointLoaderSimple","LoraLoader"].includes(e.node_type)},getMetaInfo:function(){var e=this,t=this.info.id;Object(A.h)({id:t}).then((function(t){var n;e.formList=(null==t||null===(n=t.data.meta)||void 0===n?void 0:n.comfyui_inputs)||[]}))},handleJumpDetail:function(){var e=((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})||{}).art_model,t=void 0===e?{}:e;null!=t&&t.id&&window.open("/models/detail/".concat(null==t?void 0:t.id),"_blank")},isWordsLine:function(){return String((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).val).length<40},handleCopyAll:function(){var content=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).val||"";content&&(this.$message.success(this.$t("CopySuccess")),Object(k.d)(content))}}},Sl=kl,xl=(n(3106),Object(y.a)(Sl,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"config-databox"},e._l(e.formList,(function(n,o){var l,r,c;return t("div",{key:n.field+o},[e.isModelItem(n)?[t("div",{staticClass:"easy-tooltip-wraper-model-box"},[t("div",{staticClass:"easy-tooltip-wraper-model-box-item",on:{click:function(t){return t.stopPropagation(),e.handleJumpDetail(n)}}},[t("div",{staticClass:"easy-tooltip-wraper-model-box-item-cover"},[t("img",{attrs:{src:null==n||null===(l=n.art_model)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.url,alt:""}})]),e._v(" "),t("div",{staticClass:"easy-tooltip-wraper-model-box-item-content"},[t("div",{staticClass:"easy-tooltip-model-box-model-type-box"},[t("span",{staticClass:"easy-tooltip-model-box-model-type"},[e._v(e._s(e.$t(null==n||null===(r=n.art_model)||void 0===r?void 0:r.type)))])]),e._v(" "),t("div",{staticClass:"easy-tooltip-model-box-model-name"},[e._v("\n              "+e._s((null==n||null===(c=n.art_model)||void 0===c?void 0:c.name)||"")+"\n            ")])])])])]:e._e(),e._v(" "),e.isModelItem(n)?e._e():[n.val&&e.isWordsLine(n)?t("div",{staticClass:"line-cell flex"},[t("div",{staticClass:"title"},[e._v(e._s(n.field||""))]),e._v(" "),t("div",{staticClass:"content"},[e._v(e._s(n.val||""))])]):e._e(),e._v(" "),n.val&&!e.isWordsLine(n)?t("div",{staticClass:"lines-cell"},[t("div",{staticClass:"title flex_m"},[t("span",[e._v(" "+e._s(n.field||""))]),e._v(" "),t("span",{staticClass:"iconfont icon-codeCopy1 copy",on:{click:function(t){return t.stopPropagation(),e.handleCopyAll(n)}}})]),e._v(" "),t("div",{staticClass:"content"},[e._v(e._s(n.val||""))])]):e._e()]],2)})),0)}),[],!1,null,"7385f3d2",null).exports);function Il(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ol(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Il(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Il(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Tl={name:"historyImg",inject:["top","workflowTaskView"],components:{taskImageViewer:Sa.a,SaveTo:K.a,ElImageViewer:Cl.a,auditDialog:Z.a,CreateConfig:xl},props:{src:{type:String,required:!0,default:function(){return""}},nsfw:{type:Number,default:2},width:{type:Number,default:100},height:{type:Number,default:100},message:{type:Object,default:function(){return{}}},imgInfo:{type:Object,default:function(){return{}}},operateNumber:{type:Number,default:function(){return 1}},baseSize:{type:String,default:""}},data:function(){return{loading:!0,loaded:!0,error:!1,dialogVisible:!1,retryCount:0,isShowImage:!0,baseImageWidth:374,imageUrl:"",checked:!1,alreadySave:!1,hoverBtnList:[{code:"download",icon:"modelDownload",useText:!1,order:5,tips:"DownloadImg",show:!0,showTypeOptions:[]},{code:"save",icon:"save",useText:!1,order:5,tips:"Save",show:!0,showTypeOptions:[]},{code:"deleteSingleImg",icon:"moveDeleteTask",useText:!1,order:5,tips:"Delete",show:!0,showTypeOptions:[]}],bigImageBtns:[{code:"save",icon:"save",useText:!1,order:5,tips:"Save",show:!0,showTypeOptions:[]},{code:"chat",icon:"a-home-top-personl1",useText:!1,order:0,tips:"createChartacterToChat",show:!0,showTypeOptions:[]},{code:"aiGenerateVideo",icon:"a-icon-VideoGeneration",useText:!1,order:6,tips:"ImageToVideoTip",show:!0,showTypeOptions:[]}],isShowHoverMask:!1,viewImageList:[]}},computed:Ol(Ol(Ol(Ol({},Object(S.c)(["isSupportWebp"])),Object(S.c)("user",["userInfo","isCompanyAccount","isLoggedIn"])),Object(S.e)("user",["cdnHost"])),{},{getImageRenderAspectRatio:function(){var e,t={},n=(null==this||null===(e=this.message)||void 0===e||null===(e=e.components)||void 0===e?void 0:e[0])||{},o=n.width,l=n.height,r=this.isAspectRatioExtreme(o,l);return o&&l&&o!==l&&(o<384||l<384||r)&&(t.aspectRatio=o>l?"2/1":"1/2"),t},isEnableSubmit:function(){return!this.isShowNsfwBg&&!this.error&&!this.loading},getImageManageList:function(){var e;return null==this||null===(e=this.workflowTaskView)||void 0===e?void 0:e.manageList},convertPictureWidthAndHeight:function(){var e=this.message.banner,t=(void 0===e?{}:e)||{},n=t.width,o=void 0===n?200:n,l=t.height,r=void 0===l?200:l,c=Object(B.f)(o,r,this.baseImageWidth);return isNaN(c.height)?{}:{width:"".concat(c.width,"px"),height:"".concat(c.height,"px")}},currentImageIndex:function(){var e,t=this;return-1===(e=this.viewImageList.findIndex((function(e){return e.operateNumber===t.operateNumber})))?0:e},renderUrl:function(){return"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")},getRenderUrl:function(){var e,t=((null===(e=this.message)||void 0===e?void 0:e.components)||[]).findIndex((function(e){return 1!==e.nsfw}));if(-1!==t){var n,o=null===(n=this.message)||void 0===n||null===(n=n.components[t])||void 0===n?void 0:n.url;return(o=o?Object(k.x)(o,"high"):"")||"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")}return"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")},isShowNsfwBg:function(){var e="";return 1===this.nsfw||(e=this.checkIsShowViewNsfw?this.handleShowNsfwImageUrl():this.isShowImage?this.imageUrl:"",this.renderUrl===e)},isBlur:function(){return 1===this.nsfw||(this.checkIsShowViewNsfw?(null==this||null===(e=this.imgInfo)||void 0===e?void 0:e.is_nsfw_plus)&&!this.imgInfo.canViewNsfw:1===this.nsfw);var e},isShowOperateBtn:function(){return!this.isBlur&&!this.error},isShowHover:function(){var e,t;return!!this.checkIsShowViewNsfw&&((null==this||null===(e=this.imgInfo)||void 0===e?void 0:e.is_nsfw_plus)&&!(null!=this&&null!==(t=this.imgInfo)&&void 0!==t&&t.canViewNsfw))},isNsfwPlus:function(){var e;return(null==this||null===(e=this.imgInfo)||void 0===e?void 0:e.is_nsfw_plus)&&1!==this.nsfw},getImageUrl:function(){return this.isShowImage?this.imageUrl:""},isVideoUrl:function(){var e=this;return[".mp4",".mkv",".webm",".avi",".mov",".flv",".wmv"].some((function(t){return(e.imageUrl||"").toLowerCase().endsWith(t)}))},checkIsShowViewNsfw:function(){var e;return null==this||null===(e=this.userInfo)||void 0===e?void 0:e.enable_nsfw_plus},hoverBtnRenderList:function(){var e=this;return this.hoverBtnList.map((function(t){return t.show=e.isShowBtn(t.code),t})).filter((function(e){return e.show}))},isShowSaveTo:function(){var e,t,n=this.message.components,o=void 0===n?[]:n;return!!o.length&&!(null!==(e=o[this.operateNumber-1])&&void 0!==e&&e.is_saved_personal||null!==(t=o[this.operateNumber-1])&&void 0!==t&&t.alreadySave||this.alreadySave)},isShowBtn:function(){var e={save:[this.isShowSaveTo&&1!==this.nsfw],deleteSingleImg:[!0],download:[1!==this.nsfw]};return function(t){return!!Object.keys(e).includes(t)&&e[t].every((function(e){return!!e}))}},isShowNsfwIcon:function(){return this.checkIsShowViewNsfw&&this.isNsfwPlus},enableNsfwMode:function(){var e;return![2,"2"].includes(null==this||null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.nsfw_plus)}}),mounted:function(){this.$set(this.imgInfo,"canViewNsfw",this.checkIsShowViewNsfw&&this.enableNsfwMode)},watch:{src:{handler:function(e){e&&"string"==typeof e&&(this.imageUrl=this.isSupportWebp?Object(k.x)(e,"high"):this.src)},immediate:!0}},methods:Ol(Ol({},Object(S.b)("user",["getAccountInfo"])),{},{openLogin:function(){this.isLoggedIn||this.$EventBus.$emit("openLoginDialog")},isAspectRatioExtreme:function(e,t){try{return e/t>=2||t/e>=2}catch(e){return!1}},handleSaveSuccess:function(){this.$logEvent("log_actions",{operation:"creative_flow_single_picture",behavior_info:"save"});try{this.message.components[this.operateNumber-1].alreadySave=!0}catch(e){}this.alreadySave=!0,this.$emit("saveSuccess")},deleteSingleImg:function(){var e=this;this.$confirm(this.$t("deleteConfirm"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){e.$emit("deleteSingleImg",e.operateNumber,e.message)}))},handleShowNsfwImageUrl:function(){var e;return null!=this&&null!==(e=this.imgInfo)&&void 0!==e&&e.is_nsfw_plus&&!this.imgInfo.canViewNsfw?this.renderUrl:this.isShowImage?this.imageUrl:""},onLoad:function(e){this.loading=!1,this.loaded=!0,this.error=!1,this.$EventBus.$emit("needScrollBottom",J()(this.message))},onError:function(){this.loading=!1,this.imageUrl&&(this.imageUrl.includes("_high.webp")||this.imageUrl.includes("_low.webp"))&&(this.imageUrl=this.src),this.reLoadImage(),this.error=!0},reLoadImage:function(){var e=this;this.retryCount>=1||(this.isShowImage=!1,this.retryCount++,this.loading=!0,this.$nextTick((function(){e.isShowImage=!0})))},clickReloadImage:function(){this.retryCount=0,this.error=!1,this.imageUrl=this.isSupportWebp?Object(k.x)(this.src,"high"):this.src,this.reLoadImage()},viewBigImage:function(){var e,t=this;1!==this.nsfw&&(this.isShowHover||(this.$logEvent("log_actions",{operation:"view_image",behavior_info:"on_quick_tools_created_records_page"}),console.log(this.viewImageList,this.message,"8888"),this.viewImageList=(J()((null===(e=this.message)||void 0===e?void 0:e.components)||[])||[]).map((function(e,t){return e.operateNumber=t+1,e})).filter((function(e){return t.checkIsShowViewNsfw&&t.enableNsfwMode?![1,"1"].includes(e.nsfw):![1,"1"].includes(null==e?void 0:e.nsfw)})),console.log(this.viewImageList,"this.viewImageList"),this.dialogVisible=!0))},closeViewBigImage:function(){this.dialogVisible=!1},handleContextMenu:function(e){1===this.nsfw&&e.preventDefault()},downloadImage:function(){Object(k.z)(this.src,this.$t("WorkFlow"))},handleClick:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";["deleteSingleImg"].includes(t)?this.deleteSingleImg():"download"!==t?["save"].includes(t)&&(null===(e=this.$refs)||void 0===e||null===(e=e.saveToPopover[0])||void 0===e||e.doShow()):this.downloadImage()},settingViewNsfw:function(){var e;this.$logEvent("log_actions",{operation:"click_NSFW_on_task"}),this.enableNsfwMode||1===(null===(e=this.userInfo)||void 0===e?void 0:e.is_audit)?this.applyNsfw(!1):this.$refs.auditDialog.showDialog()},applyNsfw:function(){var e=this;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){var t={};t.nsfw_plus=this.enableNsfwMode?2:1,t.mode=1,t.age_confirm=!0,Object(Q.b)(t).then((function(t){var n=(t||{}).status.code;["10000",1e4].includes(void 0===n?"":n)&&(e.$message.success(e.$t(e.enableNsfwMode?"ClosedSuccessfully":"OpenedSuccessfully")),e.getAccountInfo())})).finally((function(){e.$set(e.imgInfo,"canViewNsfw",!e.imgInfo.canViewNsfw)}))}else this.$set(this.imgInfo,"canViewNsfw",!this.imgInfo.canViewNsfw)},handImageBtns:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).type,t={chat:"click_chat",aiGenerateVideo:"click_image_to_video"};t[e]&&this.$logEvent("log_actions",{operation:t[e],behavior_info:"on_image_detail_page"})}})},$l=Tl,Ll=(n(3107),n(3108),Object(y.a)($l,(function(){var e,t,n=this,o=n._self._c;return o("div",{staticClass:"c-history-img"},[n.isLoggedIn||n.loading?n._e():o("div",{staticClass:"visitor-mask-box",on:{click:function(e){return n.openLogin()}}},[o("div",{staticClass:"visitor-mask-box-title"},[n._v(n._s(n.$t("loginLookWorks")))]),n._v(" "),o("div",{staticClass:"visitor-mask-box-btn"},[n._v(n._s(n.$t("loginNow")))])]),n._v(" "),o("div",{staticClass:"attachments-wrap",class:[n.checked?"attachments-wrap-checked":"",!n.isLoggedIn&&!n.loading&&"visitor-mask"]},[o("div",{staticClass:"message-attachment-media"},[o("div",{staticClass:"image-content"},[o("div",{staticClass:"image-content-wrap",class:[1===n.nsfw?"image-content-wrap-background":""],style:{"max-width":"".concat(n.baseImageWidth,"px"),"min-width":"".concat(150,"px")}},[o("div",{staticClass:"image-render-box"},[1===n.nsfw?[o("img",{staticClass:"media-attachments-img image-opacity-0",style:n.loading?n.convertPictureWidthAndHeight:n.getImageRenderAspectRatio,attrs:{src:n.getRenderUrl,alt:"",decoding:"async",loading:"lazy"},on:{load:n.onLoad,error:n.onError,contextmenu:function(e){return n.handleContextMenu(e)}}})]:[n.isVideoUrl?n._e():o("img",{staticClass:"media-attachments-img",class:[n.loading?"":"media-attachments-img-show",n.loading?"image-opacity-0":"",n.isShowNsfwBg?"blurBackground":""],style:n.loading?n.convertPictureWidthAndHeight:n.getImageRenderAspectRatio,attrs:{src:n.getImageUrl,alt:"",decoding:"async",loading:"lazy"},on:{load:n.onLoad,error:n.onError,click:n.viewBigImage,contextmenu:function(e){return n.handleContextMenu(e)}}}),n._v(" "),n.isVideoUrl&&n.getImageUrl?o("video",{class:[n.loading?"image-opacity-0":"",n.isShowNsfwBg?"blurBackground":""],style:{borderRadius:"8px",width:"".concat(n.baseImageWidth,"px"),height:"".concat(parseInt(n.height*n.baseImageWidth/n.width),"px")},attrs:{src:n.getImageUrl,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0},on:{play:function(e){n.loading=!1}}}):n._e()],n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.loading&&1!==n.nsfw,expression:"loading && nsfw !== 1"}],staticClass:"loading-wrapper"},[o("div",{staticClass:"loading-wrapper-inner"},[o("span",{staticClass:"spinner",attrs:{role:"img","aria-label":n.$t("Loading")}},[n._m(0)])])]),n._v(" "),n.isShowNsfwIcon?o("div",{staticClass:"generate-view-nsfw-plus",on:{click:function(e){return e.stopPropagation(),n.settingViewNsfw.apply(null,arguments)}}},[o("i",{staticClass:"iconfont",class:null!==(e=n.imgInfo)&&void 0!==e&&e.canViewNsfw?"icon-work-hide":"icon-work-show"})]):n._e(),n._v(" "),n.isEnableSubmit?[o("div",{staticClass:"image-manage-check-btn",class:[n.checked&&"image-manage-check-btn-active",(null===(t=n.getImageManageList)||void 0===t?void 0:t.length)&&"image-manage-check-btn-show"],on:{click:function(e){return e.stopPropagation(),n.handleClickCheck()}}},[o("span",{staticClass:"image-manage-check-btn-icon el-icon-check"})])]:n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.isShowOperateBtn&&n.isShowImage&&n.src&&!n.loading||1===n.nsfw,expression:"\n                (isShowOperateBtn && isShowImage && src && !loading) ||\n                nsfw === 1\n              "}],staticClass:"image-hover-mask",on:{click:n.viewBigImage}},[o("div",{staticClass:"image-hover-mask-btn-box"},n._l(n.hoverBtnRenderList,(function(e){var t;return o("el-tooltip",{key:e.code,attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"top",content:n.$t(null==e?void 0:e.tips)}},["save"!==e.code?o("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(t){return t.stopPropagation(),n.handleClick(e.code)}}},[e.useText?[n._v("\n                      "+n._s(e.text)+"\n                    ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.icon)})],2):n._e(),n._v(" "),"save"===e.code&&n.isShowSaveTo?o("save-to",{ref:"saveToPopover",refInFor:!0,attrs:{type:"artwork",category:!0,title:n.$t("Save"),message:wl(wl({},n.message),{},{img_uris:(null===(t=n.message)||void 0===t?void 0:t.components)||[]}),operateNumber:n.operateNumber,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}},[o("span",{staticClass:"image-hover-mask-btn image-hover-mask-btn-single",on:{click:function(e){return e.stopPropagation(),n.handleClick("save")}}},[e.useText?[n._v("\n                        "+n._s(e.text)+"\n                      ")]:o("i",{staticClass:"iconfont image-hover-mask-btn-icon",class:"icon-".concat(e.icon)})],2)]):n._e()],1)})),1)])],2)]),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.error&&!n.loading,expression:"error && !loading"}],staticClass:"image-load-error"},[o("i",{staticClass:"iconfont icon-image-load-error image-load-error-icon"}),n._v(" "),o("span",{staticClass:"image-load-error-text",on:{click:function(e){return e.stopPropagation(),n.clickReloadImage.apply(null,arguments)}}},[n._v(n._s(n.$t("reloadImage")))])])])])]),n._v(" "),n.dialogVisible?o("task-image-viewer",{staticClass:"work-message-img-viewer",staticStyle:{"z-index":"9999"},attrs:{"on-close":n.closeViewBigImage,"initial-index":n.currentImageIndex,"show-operate-btn":!0,hoverBtnRenderList:n.bigImageBtns,message:n.message,"url-list":n.viewImageList,customForm:!0},on:{onClickBtns:n.handImageBtns},scopedSlots:n._u([{key:"customContent",fn:function(){return[o("CreateConfig",{attrs:{info:n.message}})]},proxy:!0}],null,!1,1028422645)}):n._e(),n._v(" "),o("auditDialog",{ref:"auditDialog",on:{confirm:n.applyNsfw}})],1)}),[function(){var e=this._self._c;return e("span",{staticClass:"inner-MGEKwh wanderingCubes-2A046F"},[e("span",{staticClass:"item-2VgEex"}),e("span",{staticClass:"item-2VgEex"})])}],!1,null,"14f643a7",null)),Pl=Ll.exports,Ml=n(98);function jl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Dl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jl(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Nl={name:"historyHeader",inject:["easyTop"],components:{MessageLoraPopup:Ma},filters:{formatDateTime:function(e){var t=new Date(e),n=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),r=t.getHours().toString().padStart(2,"0"),c=t.getMinutes().toString().padStart(2,"0"),d=t.getSeconds().toString().padStart(2,"0");return Object(k.u)(t,new Date)?"".concat(r,":").concat(c,":").concat(d):"".concat(n,"/").concat(o,"/").concat(l," ").concat(r,":").concat(c,":").concat(d)}},props:{message:{type:Object,default:function(){return{}},required:!0},isShowExpireTime:{type:[Boolean,Number],default:!1},expireTime:{type:String,default:""},isMyMsg:{type:Boolean,default:!1},moreActionsShow:{type:Boolean,default:!1},checkPermission:{type:Boolean,default:!1},checkIsChannelOwner:{type:Boolean,default:!1}},data:function(){return{isI18nToggled:!1,isFoldPrompt:!0,morePopoverVisible:!1,showFoldBtn:!0,isInDownloadTask:!1,pollingTimer:null}},mounted:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.$EventBus.$on("messageItemPromptWidthUpdate",e.handleResize),e.isI18nToggled=!e.accountSettingsData.is_off_localization,e.checkPromptOverflow();case 3:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.$EventBus.$off("messageItemPromptWidthUpdate",this.handleResize),this.pollingTimer&&window.clearTimeout(this.pollingTimer),this.pollingTimer=null,this.isInDownloadTask=!1},computed:Dl(Dl(Dl({},Object(S.c)("user",["accountSettingsData","isCompanyAccount","isLoggedIn"])),Object(S.e)("payment",["paymentInfo"])),{},{getRenderImageUrl:function(){var e,t=(null===(e=this.message)||void 0===e||null===(e=e.creativity)||void 0===e||null===(e=e.cover)||void 0===e?void 0:e.url)||"";return t?Object(k.x)(t,"low"):t},allowRefreshOrMoreOperate:function(){return[3,4].includes(this.message.status)},allowRestartOperate:function(){var e,t;return![4,"4","5",5,6,"6",10,"10",2,"2",23,"23",25,"25"].includes(null===(e=this.message)||void 0===e?void 0:e.type)&&[1,"1","2",2,3,"3"].includes(null===(t=this.message)||void 0===t?void 0:t.status)},moreActionShow:function(){return[2,4,13].includes(this.message.type)},isStudioMode:function(){return[7,"7","studio",11,"11"].includes(this.message.category)},convertTaskType:function(){var e={1:"Txt2Img"};return e[this.message.type]?e[this.message.type]:""},setI18nPrompt:function(){var e=this.message.local_prompt,t=this.message.prompt?this.message.prompt:"";return this.isI18nToggled?e:t},isVip:function(){var e,t;return!!(null!==(e=this.paymentInfo)&&void 0!==e&&e.activeState||null!==(t=this.paymentInfo)&&void 0!==t&&t.liteActiveState)}}),methods:{toMall:function(){this.$logEvent("log_actions",{operation:"extend_maturity",behavior_info:"on_swtft_app_detail_page"});var e=(this.paymentInfo||{}).vipType,t=["svip_1","svip_2","svip_1_trial","svip_2_trial","vip_lite"].includes(e)||e.includes("vip_day");this.isVip?t&&this.$EventBus.$emit("showUpgradeDialog","NoExpireTimeTipWeb","professional"):this.$EventBus.$emit("showBreakDialog","ExpireTimeTipWeb","basic")},handleJumpModelDetail:function(e){if(null!=e&&e.id){var t=this.localePath("/workFlowAppDetail/".concat(e.id));window.open(t,"_blank")}},handleLogEvent:function(e){this.$logEvent("log_actions",{operation:e,behavior_info:"on_new_create_flow_page",behavior_info_sub:"on_create_flow_topbar"})},handleClickMore:function(){this.handleLogEvent("click_more")},handleResize:function(){this.checkPromptOverflow()},checkPromptOverflow:function(){var e=this;this.$nextTick((function(){try{var element=e.$refs.promptBox;return void(e.isFoldPrompt?e.showFoldBtn=element.scrollWidth>element.clientWidth:e.showFoldBtn=element.offsetHeight>30)}catch(e){}e.showFoldBtn=!0}))},toggleFoldPromptStatus:function(){this.handleLogEvent("click_view_prompt"),this.isFoldPrompt=!this.isFoldPrompt,this.checkPromptOverflow()},toggleI18nPrompt:function(){this.handleLogEvent("click_translate"),this.isI18nToggled=!this.isI18nToggled,this.checkPromptOverflow()},handleCopyAll:function(){var content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";content&&(Object(k.d)(content),this.$message.success(this.$t("CopySuccess")))},handleRefreshTask:function(){this.isLoggedIn?(this.handleLogEvent("click_retry"),this.$emit("moreAction","REFRESH_TASK")):this.$EventBus.$emit("openLoginDialog")},handleMoreActionClick:function(){return this.isLoggedIn||this.$EventBus.$emit("openLoginDialog"),!1},handleMoreAction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.isLoggedIn?this.allowRefreshOrMoreOperate&&(this.handleMoreActionLogEvent(e),"DOWNLOAD_ALL"!==e?this.$emit("moreAction",e):this.handleDownloadImages()):this.$EventBus.$emit("openLoginDialog")},handleMoreActionLogEvent:function(e){var t="";switch(e){case"SAVE_ALL":t="click_save_all";break;case"DOWNLOAD_ALL":t="click_download_all";break;case"TASK_INFO":t="click_task_info";break;case"DELETE_ALL":t="click_delete_all"}t&&this.$logEvent("log_actions",{operation:t,behavior_info:"on_new_create_flow_page"})},handleDownloadImages:function(){var e,t,n=this;if(!this.isInDownloadTask){var o={download_task_id:"",items:[]};o.items=((null===(e=this.message)||void 0===e?void 0:e.components)||[]).map((function(e){var t;return{index:e.index,id:null===(t=n.message)||void 0===t?void 0:t.id}})),null!==(t=o.items)&&void 0!==t&&t.length&&(this.isInDownloadTask=!0,Object(dn.g)(o).then((function(e){var t;if(1e4===(null==e||null===(t=e.status)||void 0===t?void 0:t.code)){var o=(null==e?void 0:e.data)||{},l=o.download_task_id,r=void 0===l?"":l;o.url;return n.pollingTask(r)}n.isInDownloadTask=!1})).catch((function(e){n.isInDownloadTask=!1})))}},stopTask:function(){this.pollingTimer&&window.clearTimeout(this.pollingTimer),this.pollingTimer=null,this.isInDownloadTask=!1},pollingTask:function(e){var t=this;return new Promise((function(n,o){t.isInDownloadTask=!0;var l={download_task_id:e,items:[]};t.pollingTimer=setTimeout((function(){Object(dn.g)(l).then((function(l){var r,c;if(1e4!==(null==l||null===(r=l.status)||void 0===r?void 0:r.code))return t.pollingTimer&&window.clearTimeout(t.pollingTimer),t.pollingTimer=null,t.$message.error(t.$t("ServerError")),t.isInDownloadTask=!1,void o();var d=(null==l||null===(c=l.data)||void 0===c?void 0:c.url)||"";["",null,void 0].includes(d)?t.pollingTask(e):(t.pollingTimer&&window.clearTimeout(t.pollingTimer),t.pollingTimer=null,t.isInDownloadTask=!1,t.openDownloadLink(d),t.handleClosePopover(),n())})).catch((function(e){t.$message.error(t.$t("ServerError")),t.isInDownloadTask=!1,o()}))}),1e3)}))},openDownloadLink:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e){var a=document.createElement("a");document.body.appendChild(a),a.style.display="none",a.href=e,a.download="image_download",a.click(),document.body.removeChild(a)}},handleClosePopover:function(){try{this.$refs.myPopover.doClose()}catch(e){}}}},El=Nl,Rl=(n(3109),n(3110),Object(y.a)(El,(function(){var e,t,n,o,l,r,c,d,h,m,v,f,_,y,w=this,C=w._self._c;return C("div",{staticClass:"c-easy-msg-item-header"},[C("div",{staticClass:"msg-item-header-info-panel"},[C("div",{staticClass:"msg-item-header-info-panel-tag"},[w._v(w._s(w.$t("Swtft_App")))]),w._v(" "),C("div",{staticClass:"msg-item-header-info-panel-prompt-box",class:[w.isFoldPrompt&&"align-items-center"]},[C("div",{ref:"promptBox",staticClass:"info-panel-prompt-box-content",class:[w.isFoldPrompt&&"text-ellipsis"]},[w._v(w._s(null===(e=w.message)||void 0===e||null===(e=e.creativity)||void 0===e?void 0:e.name))]),w._v(" "),C("span",{directives:[{name:"show",rawName:"v-show",value:!["",null,void 0].includes(w.setI18nPrompt)&&w.showFoldBtn,expression:"!['',null,void(0)].includes(setI18nPrompt) && showFoldBtn"}],staticClass:"info-panel-prompt-box-icon",class:[w.isFoldPrompt?"iconfont icon-add-tag":"el-icon-minus"],on:{click:function(e){return e.stopPropagation(),w.toggleFoldPromptStatus.apply(null,arguments)}}})])]),w._v(" "),C("div",{staticClass:"msg-item-header-operate-bar",class:[!w.isFoldPrompt&&"align-items-flex-start"]},[C("div",{staticClass:"operate-bar-model-card",on:{click:function(e){var t;return e.stopPropagation(),w.handleJumpModelDetail(null===(t=w.message)||void 0===t?void 0:t.creativity)}}},[C("el-image",{staticClass:"operate-bar-model-card-img",attrs:{src:w.getRenderImageUrl}},[C("template",{slot:"error"},[C("div",{staticClass:"operate-bar-model-card-img"})])],2),w._v(" "),C("div",{staticClass:"operate-bar-model-card-info"},[C("div",{staticClass:"operate-bar-model-card-info-title"},[w._v(w._s(w.$t("Swtft_App")))]),w._v(" "),C("div",{staticClass:"operate-bar-model-card-info-sub-title"},[w._v(w._s(null===(t=w.message)||void 0===t||null===(t=t.creativity)||void 0===t?void 0:t.name))])])],1),w._v(" "),[3,"3"].includes(null===(n=w.message)||void 0===n?void 0:n.status)?C("div",{directives:[{name:"show",rawName:"v-show",value:!["",null,void 0,0].includes(null===(o=w.message)||void 0===o||null===(o=o.components)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.width),expression:"!['',null,void(0),0].includes(message?.components?.[0]?.width)"}],staticClass:"operate-bar-num-card"},[C("span",{staticClass:"operate-bar-num-card-icon iconfont icon-home_icon_lora"}),w._v(" "),C("span",{staticClass:"operate-bar-num-card-text operate-bar-num-card-text-100"},[w._v(w._s("".concat(null===(l=w.message)||void 0===l||null===(l=l.components)||void 0===l||null===(l=l[0])||void 0===l?void 0:l.width," x ").concat(null===(r=w.message)||void 0===r||null===(r=r.components)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.height))+"px")])]):w._e(),w._v(" "),w.isMyMsg&&w.isLoggedIn?C("el-popover",{attrs:{trigger:"hover","popper-class":"custom-popver"}},[C("div",{staticClass:"easy-task-info-tips"},[C("p",[C("span",{staticClass:"task-info-tips-label"},[w._v(w._s(w.$t("TaskID")))]),C("span",{staticClass:"task-info-tips-copy",on:{click:function(e){return w.handleCopyAll(w.message.id)}}},[w._v(w._s(w.message.id)+" "),C("i",{staticClass:"iconfont icon-copy-ops"})])]),w._v(" "),3!==w.message.status||w.isCompanyAccount?w._e():[[1,2,"1","2"].includes(null===(c=w.message)||void 0===c?void 0:c.pub_community)?C("p",[C("span",{staticClass:"task-info-tips-label"},[w._v(w._s(w.$t("status")))]),w._v(" "),C("span",{staticClass:"task-pub-status"},[w._v(w._s([2,"2"].includes(null===(d=w.message)||void 0===d?void 0:d.pub_community)?w.$t("createSetting1"):w.$t("createSetting2")))])]):w._e(),w._v(" "),C("p",[C("span",{staticClass:"task-info-tips-label"},[w._v(w._s(w.$t("expend")))]),w._v(" "),C("span",{staticClass:"task-info-tips-content"},[C("span",[w._v(w._s(w.$t("tempCoins"))+" : "+w._s(null===(h=w.message)||void 0===h||null===(h=h.deduction_detail)||void 0===h?void 0:h.temp_hashrate))]),w._v(" "),C("span",[w._v(w._s(w.$t("calculateCoins"))+" : "+w._s(null===(m=w.message)||void 0===m||null===(m=m.deduction_detail)||void 0===m?void 0:m.hashrate))])])]),w._v(" "),null!==(v=w.message)&&void 0!==v&&null!==(v=v.deduction_detail)&&void 0!==v&&v.history_hashrate?C("p",[C("span",{staticClass:"task-info-tips-label"},[w._v(w._s(w.$t("currentBalance")))]),w._v(" "),C("span",{staticClass:"task-info-tips-content"},[C("span",[w._v(w._s(w.$t("tempCoins"))+" : "+w._s(null===(f=w.message)||void 0===f||null===(f=f.deduction_detail)||void 0===f?void 0:f.after_temp_hashrate))]),w._v(" "),C("span",[w._v(w._s(w.$t("calculateCoins"))+" : "+w._s(null===(_=w.message)||void 0===_||null===(_=_.deduction_detail)||void 0===_?void 0:_.after_hashrate))])])]):w._e(),w._v(" "),w.message.create_at?C("p",[C("span",{staticClass:"task-info-tips-label"},[w._v(w._s(w.$t("newGenerate26")))]),w._v(" "),C("span",{staticClass:"task-info-tips-text"},[w._v(w._s(w._f("formatDateTime")(w.message.create_at)))])]):w._e(),w._v(" "),w.isShowExpireTime?C("p",[C("span",{staticClass:"task-info-tips-label"},[w._v(w._s(w.$t("trainExpirationTime")))]),w._v(" "),C("span",{staticClass:"task-info-tips-text",staticStyle:{cursor:"pointer"},on:{click:function(e){return e.stopPropagation(),w.toMall.apply(null,arguments)}}},[w._v(w._s(w.expireTime))])]):w._e()]],2),w._v(" "),C("div",{staticClass:"msg-item-header-operate-bar-refresh-btn",attrs:{slot:"reference"},slot:"reference"},[C("i",{staticClass:"iconfont icon-icon-information"})])]):w._e(),w._v(" "),w.isLoggedIn?w._e():[C("div",{staticClass:"msg-item-header-operate-bar-refresh-btn",on:{click:function(e){return e.stopPropagation(),w.handleMoreActionClick.apply(null,arguments)}}},[C("i",{staticClass:"iconfont icon-icon-information"})])],w._v(" "),C("div",{directives:[{name:"show",rawName:"v-show",value:w.allowRestartOperate,expression:"allowRestartOperate"}],staticClass:"msg-item-header-operate-bar-refresh-btn",on:{click:function(e){return e.stopPropagation(),w.handleRefreshTask.apply(null,arguments)}}},[C("i",{staticClass:"iconfont icon-refresh-icon2"})]),w._v(" "),w.isLoggedIn&&w.moreActionsShow&&w.allowRefreshOrMoreOperate&&null!==(y=w.easyTop)&&void 0!==y&&y.isShowPopup?C("el-popover",{ref:"myPopover",attrs:{placement:"bottom-end","popper-class":"easy-msg-item-more-popover","visible-arrow":!1,trigger:"click"},model:{value:w.morePopoverVisible,callback:function(e){w.morePopoverVisible=e},expression:"morePopoverVisible"}},[C("div",{staticClass:"pop-btns flex"},[w.checkPermission||w.checkIsChannelOwner?C("button",{on:{click:function(e){return w.handleMoreAction("DELETE_ALL")}}},[C("span",{staticClass:"pop-btns-icon"},[C("i",{staticClass:"iconfont icon-a-pyDelete1"})]),w._v(" "),C("span",{staticClass:"pop-btns-text"},[w._v(w._s(w.$t("DeleteAll")))])]):w._e()]),w._v(" "),C("div",{staticClass:"msg-item-header-operate-bar-more-btn",attrs:{slot:"reference"},on:{click:w.handleClickMore},slot:"reference"},[C("i",{staticClass:"iconfont icon-more"})])]):w._e(),w._v(" "),w.isLoggedIn?w._e():[C("div",{staticClass:"msg-item-header-operate-bar-more-btn",attrs:{slot:"reference"},on:{click:function(e){return e.stopPropagation(),w.handleMoreActionClick.apply(null,arguments)}},slot:"reference"},[C("i",{staticClass:"iconfont icon-more"})])]],2)])}),[],!1,null,"4d8f5534",null)),Al=Rl.exports;function Bl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ul(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bl(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fl=n(124),zl={name:"historyItem",components:{historyImg:Pl,TryCreateMask:bl.a,QuickQueue:Ml.a,commonConfirmModal:un.a,historyHeader:Al,MessageOperateBtn:le},props:{message:{type:Object,default:function(){return{}},required:!0},viewMode:{type:String,default:""},showTime:{type:Boolean,default:!1}},filters:{formatDateTime:function(e){var t=new Date(e),n=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),r=t.getHours().toString().padStart(2,"0"),c=t.getMinutes().toString().padStart(2,"0"),d=t.getSeconds().toString().padStart(2,"0");return Object(k.u)(t,new Date)?"".concat(r,":").concat(c,":").concat(d):"".concat(n,"/").concat(o,"/").concat(l," ").concat(r,":").concat(c,":").concat(d)}},data:function(){return{defaultAvatar:Fl,alreadySave:!1,customColor:"#2E9E60",isLoading:!1,mapObj:{0:!0,1:!0,2:!0,3:!0,4:!0},currentClickBtn:"",trailBtnLoading:!1,hasAccelerated:!1}},watch:{message:{handler:function(e){var t=this;this.$nextTick((function(){t.isLoading=!(null==e||!e.isLoading),t.currentClickBtn=(null==e?void 0:e.loadingBtn)||""}))},deep:!0,immediate:!0}},computed:Ul(Ul(Ul({},Object(S.e)("payment",["paymentInfo"])),Object(S.c)("user",["isLoggedIn"])),{},{getImageList:function(){var e,t,n;return(null==this||null===(e=this.message)||void 0===e||null===(e=e.components)||void 0===e?void 0:e.length)>4?null==this||null===(t=this.message)||void 0===t||null===(t=t.components)||void 0===t?void 0:t.slice(0,4):null==this||null===(n=this.message)||void 0===n?void 0:n.components},computedPercentage:function(){return function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).process;return void 0===e?0:e}},convertStatusText:function(){var e,t={userCancelDesc:this.$t("userCancel"),sysCancelDesc:this.$t("systemCancel"),sysTimeoutDesc:this.$t("systemTimeoutCancel")};return null!==(e=this.message)&&void 0!==e&&e.status_desc?t[this.message.status_desc]:""},isShowExpireTime:function(){var e=this.paymentInfo.productLevel,t=this.message.expiration_time,n=[4,3].includes(e),o=t&&t>0,l=!this.alreadySave;return!n&&(o&&l)},getExpireTime:function(){var e=this.message.expiration_time,t=(new Date).getTime();if(e&&e>t){var n=e-t,o=Math.floor(n/864e5);return o?this.$t("TaskExpireTime",{param:o}):this.$t("ExpiresSoon")}return this.$t("TaskExpireTime",{param:0})},isShowCancel:function(){var e=this.message,t=e.status,n=e.category,o=e.type,l=![4,"4"].includes(t),r=![4,5,6,10,11,13,23,"23"].includes(o);return l&&![3,"3"].includes(n)&&r},isVip:function(){var e,t;return!!(null!==(e=this.paymentInfo)&&void 0!==e&&e.activeState||null!==(t=this.paymentInfo)&&void 0!==t&&t.liteActiveState)},checkBtnStatus:function(){var e=this;return function(t){var n={disabled:!1,loading:!1};return e.currentClickBtn===t?(n.loading=!0,n.disabled=!1,n):(e.currentClickBtn&&e.currentClickBtn!==t&&(n.loading=!1,n.disabled=!0),n)}},isShowFaster:function(){var e=this.message,t=e.status,n=e.speed_type;return 1==t&&1===n&&!this.hasAccelerated}}),methods:{handleMoreAction:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""){case"TASK_INFO":this.$refs.easyTaskInfoPopup.show();break;case"REFRESH_TASK":this.handleReStart();break;case"DELETE_ALL":this.handleDeleteTask();break;case"SAVE_ALL":this.saveToSever()}},handleReStart:function(){var e,t,n,o={obj:Ul(Ul({},(null===(e=this.message)||void 0===e?void 0:e.creativity)||{}),{},{onlyUpdateInfo:!1,retryId:null===(t=this.message)||void 0===t?void 0:t.id,banner:Object.assign({},(null===(n=this.message)||void 0===n||null===(n=n.creativity)||void 0===n?void 0:n.cover)||{})}),type:"fast_app"};this.$EventBus.$emit("updateCategoryInfo",o)},handleDeleteTask:function(){var e=this;if(this.isLoggedIn)try{this.$refs.commonConfirmModal.show({subTitle:"deleteTaskConfirm"}).then((function(){var t;if(null!=e&&null!==(t=e.message)&&void 0!==t&&t.id){var n={ids:[e.message.id]};e.globalLoading=!0,Object(A.f)(n).then((function(t){var n,o,l;["10000",1e4].includes(null==t||null===(n=t.status)||void 0===n?void 0:n.code)?(e.$message.success(e.$t("deleteSuccess")),e.$emit("deleteTask",null==e||null===(o=e.message)||void 0===o?void 0:o.id)):e.$message({message:(null==t||null===(l=t.status)||void 0===l?void 0:l.msg)||e.$t("ServerError"),type:"error"})})).finally((function(){e.globalLoading=!1}))}})).catch((function(e){}))}catch(e){}else this.$EventBus.$emit("openLoginDialog")},updateImageInfo:function(e,source,t,n){this.$emit("updateImageInfo",e,source,t,n)},deleteSingleImg:function(e){var t=this,n=this.message,o=n.id,l=void 0===o?"":o,r=n.components,c=(void 0===r?[]:r)[e-1].index,d=void 0===c?-1:c;Object(V.b)({id:l,index:d}).then((function(){var e;(t.$message({message:t.$t("deleteSuccess"),type:"success"}),t.message.components=t.message.components.filter((function(e){return e.index!==d})),t.message.components.length)||t.$emit("deleteTask",null==t||null===(e=t.message)||void 0===e?void 0:e.id)}))},handleNsfwStatus:function(e){var t=e.index,n=e.canViewNsfw;this.$set(this.mapObj,t,n)},handleTaskReStart:function(){this.$emit("operate",{info:this.message,type:"taskReStart"})},handleTrialFastQueue:function(){var e=this;this.$logEvent("log_actions",{operation:"try_quick_queue",behavior_info:"click_try"});var t=this.message.id,n=void 0===t?"":t;this.trailBtnLoading=!0,Object(V.c)({id:n}).then((function(t){var n,code=null==t||null===(n=t.status)||void 0===n?void 0:n.code;70010===code?(e.$EventBus.$emit("showBreakDialog","FastQueueTipWeb","basic"),e.$logEvent("log_actions",{operation:"try_quick_queue",behavior_info:"vip_pop_show"})):1e4===code&&(e.hasAccelerated=!0,e.$message.success(e.$t("AccelerateSuccess"))),e.trailBtnLoading=!1}))},retryWork:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$emit("onRetryWork",data)},handleCancelTask:function(){this.isLoading||(this.$message({message:this.$t("canceTaskNum",{num:3}),type:"info"}),this.$emit("onCancelTask",{info:this.message}))},toMall:function(){this.$logEvent("log_actions",{operation:"extend_maturity",behavior_info:"on_swtft_app_detail_page"});var e=this.paymentInfo.productLevel;this.isVip||this.$EventBus.$emit("showBreakDialog","ExpireTimeTipWeb","basic"),this.isVip&&1===e&&this.$EventBus.$emit("showUpgradeDialog","ExpireTimeTipWeb","standard"),this.isVip&&e>=2&&this.$EventBus.$emit("showUpgradeDialog","ExpireTimeTipWeb","professional")}}},Vl=zl,Wl=(n(3111),Object(y.a)(Vl,(function(){var e,t,n,o,l,r=this,c=r._self._c;return c("div",{staticClass:"c-workflow-history-item"},[r.showTime&&null!==(e=r.message)&&void 0!==e&&e.create_at?c("div",{staticClass:"easy-msg-item-time-box"},[r._v(r._s(r._f("formatDateTime")(null===(t=r.message)||void 0===t?void 0:t.create_at,this)))]):r._e(),r._v(" "),c("history-header",{ref:"easyMsgHeader",attrs:{message:r.message,isMyMsg:!0,moreActionsShow:!0,checkPermission:!0,isShowExpireTime:r.isShowExpireTime,expireTime:r.getExpireTime},on:{moreAction:r.handleMoreAction}}),r._v(" "),[2,"2",3,"3"].includes(r.message.status)&&null!==(n=r.message)&&void 0!==n&&null!==(n=n.components)&&void 0!==n&&n.length?c("div",{staticClass:"message-accessories"},[c("div",{staticClass:"media-attachments-container"},[r.message&&Array.isArray(null===(o=r.message)||void 0===o?void 0:o.components)&&null!==(l=r.message)&&void 0!==l&&null!==(l=l.components)&&void 0!==l&&l.length?r._l(r.getImageList,(function(e,t){return c("history-img",{key:"list-item_".concat(t),attrs:{"img-info":e,src:e.url,msgId:r.message.id,nsfw:e.nsfw,width:e.width,height:e.height,message:r.message,imgInfo:e,"operate-number":t+1,"view-status":r.mapObj},on:{viewNsfwStatus:r.handleNsfwStatus,deleteSingleImg:r.deleteSingleImg,saveSuccess:function(e){r.alreadySave=!0}}})})):r._e()],2)]):r._e(),r._v(" "),[1,"1",2,"2",4,"4"].includes(r.message.status)?c("div",{staticClass:"message-process-container"},[[2,"2"].includes(r.message.status)&&r.computedPercentage(r.message)?c("div",{staticClass:"message-process-panel"},[c("el-progress",{staticClass:"message-process-panel-progress",attrs:{percentage:r.computedPercentage(r.message),color:r.customColor,"show-text":!1,"stroke-width":12}})],1):r._e(),r._v(" "),c("div",{staticClass:"message-process-operate-box"},[[1,"1"].includes(r.message.status)?[c("span",{staticClass:"process-operate-box-text"},[r._v(r._s(r.$t("TaskStatusWaitingToStart"))+" "),c("span",{staticClass:"message-process-loading-span"})])]:[2,"2"].includes(r.message.status)&&!r.computedPercentage(r.message)?[c("span",{staticClass:"process-operate-box-text"},[r._v(r._s(r.$t("TaskStatusPreparing"))+" "),c("span",{staticClass:"message-process-loading-span"})])]:[4,"4"].includes(r.message.status)?c("span",{staticClass:"process-operate-box-text",staticStyle:{color:"#DA373D"}},[r._v(r._s(r.convertStatusText))]):c("span",{staticClass:"process-operate-box-text"},[r._v(r._s(r.$t("youHaveCompleted"))),c("span",{staticClass:"process-operate-box-text-strong",staticStyle:{"margin-left":"5px"}},[r._v(r._s(r.computedPercentage(r.message))+"%")]),r._v(" "),c("span",{staticClass:"message-process-loading-span"})]),r._v(" "),r.isShowFaster?c("el-button",{staticClass:"message-process-operate-box-btn fast-queue",attrs:{size:"mini",loading:r.trailBtnLoading},on:{click:r.handleTrialFastQueue}},[c("i",{staticClass:"iconfont icon-trail-fast-queue"}),r._v(" "),c("span",{staticClass:"words"},[r._v(r._s(r.$t("TrialFastQueue")))])]):r._e(),r._v(" "),r.isShowCancel?c("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:r.$t("canceTaskNum",{num:3}),placement:"top-start"}},[c("el-button",{staticClass:"message-process-operate-box-btn",class:{isLoading:r.isLoading},attrs:{type:"danger",size:"mini"},on:{click:r.handleCancelTask}},[r._v("\n          "+r._s(r.isLoading?"Canceling…":r.$t("CancelJob"))+"\n        ")])],1):r._e(),r._v(" "),[4,"4"].includes(r.message.status)?c("message-operate-btn",{key:"reStart",attrs:{loading:r.checkBtnStatus("reStart").loading,disabled:r.checkBtnStatus("reStart").disabled},on:{click:r.handleTaskReStart}},[c("i",{staticClass:"iconfont icon-refresh-icon2",staticStyle:{"font-size":"18px"}})]):r._e()],2)]):r._e(),r._v(" "),c("common-confirm-modal",{ref:"commonConfirmModal"})],1)}),[],!1,null,"512d6e6a",null).exports),Hl=n(297),ql=n(354);function Gl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Jl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gl(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Kl={name:"workFlowAppDetailHistoryPage",inject:["top"],provide:function(){return{workflowTaskView:this}},components:{historyItem:Wl,taskImageViewer:H.a,historyImg:Pl,NoData:ql.a,TryCreateMask:bl.a,auditDialog:Z.a,SaveTo:K.a,commonConfirmModal:un.a},data:function(){return{viewMode:"list",list:[],loading:!1,queryParams:{limit:10},hasMore:!0,showScroll:!0,debounceHandleScroll:function(){},dialogVisible:!1,viewImageList:[],activeCard:null,currentImageIndex:0,manageList:[],manageBtnConfig:[{code:"POST",i18nKey:"Post",icon:"iconfont icon-icon-Posts"},{code:"SAVE",i18nKey:"Save",icon:"iconfont icon-workflow_icon_save"},{code:"DOWNLOAD",i18nKey:"Download",icon:"el-icon-download"},{code:"DELETE",i18nKey:"Delete",icon:"iconfont icon-delete-gpt"},{code:"CANCEL",i18nKey:"Cancel",icon:"iconfont icon-close-btn"}],isInDownloadTask:!1,pollingTimer:null}},watch:{isLoggedIn:{handler:function(e,t){(!t&&e||!e&&t)&&this.handleRefresh()},immediate:!0}},mixins:[Hl.a],computed:Jl(Jl(Jl(Jl(Jl({},Object(S.c)("user",["taskExpireDay","isLoggedIn","userInfo","isCompanyAccount"])),Object(S.e)("payment",["paymentInfo"])),Object(S.e)("user",["collectData","userInfo"])),Object(S.c)("payment",["activeState"])),{},{renderCardList:function(){return this.list.filter((function(e){var t;return[3,"3"].includes(e.status)&&(null==e||null===(t=e.components)||void 0===t?void 0:t.length)}))},getExpirationTime:function(){return this.taskExpireDay},isVip:function(){var e,t;return!!(null!==(e=this.paymentInfo)&&void 0!==e&&e.activeState||null!==(t=this.paymentInfo)&&void 0!==t&&t.liteActiveState)},showExpireTime:function(){var e=this.paymentInfo.productLevel,t=[4,3].includes(e);return this.isLoggedIn&&!t&&0!==this.getExpirationTime},getMessageInfo:function(){var e,t,n={};(n.img_uris=[{url:""}],null!==(e=this.manageList)&&void 0!==e&&e.length)&&(n.img_uris=[null===(t=this.manageList)||void 0===t?void 0:t[0]]);return n},showDateIds:function(){var e=[],t=new Date,n=new Date(t);n.setDate(t.getDate()+1);var o=n;try{(this.list||[]).forEach((function(t){var n=null==t?void 0:t.create_at;Object(k.u)(n,o)||(e.push(t.id),o=n)}))}catch(e){}return e},checkIsShowBackTopBtn:function(){return this.showBackTopBtn&&this.list.length},checkIsShowViewNsfw:function(){var e;return null==this||null===(e=this.userInfo)||void 0===e?void 0:e.enable_nsfw_plus},enableNsfwMode:function(){var e;return![2,"2"].includes(null==this||null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.nsfw_plus)},getBatchSaveParams:function(){return(this.manageList||[]).map((function(e){return{id:null==e?void 0:e.taskId,index:null==e?void 0:e.index}}))}}),mounted:function(){var e=this;this.initScrollBar(),this.debounceHandleScroll=Object(X.debounce)(this.handleScroll,600),this.getList(),this.$EventBus.$on("deleteHistoriesList",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=function(){var n=e.list.filter((function(e){return e.id!=t}));e.$set(e,"list",n),e.top.changeSelectedId("")};if(n.length){var l,r=e.list.findIndex((function(e){return e.id==t}))||0,c=null===(l=e.list)||void 0===l?void 0:l[r];if(c){var d=c.components.filter((function(e){return!n.includes(e.index)}));d.length?e.$set(e.list[r],"components",d):o()}}else o()}))},destroyed:function(){this.debounceHandleScroll=function(){}},methods:Jl(Jl({},Object(S.b)("user",["getAccountInfo"])),{},{handleManageOperate:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""){case"POST":this.sendToPost();break;case"SAVE":this.$refs.saveToPopover.openModal();break;case"DOWNLOAD":this.handleDownloadImages();break;case"DELETE":this.handleImageMangeDeleteImageConfirm();break;case"CANCEL":this.manageList=[],this.stopTask()}},handleSaveSuccess:function(){this.$refs.saveToPopover.handleClose(),this.manageList=[]},settingViewNsfw:function(){var e;this.btnLoading||(this.enableNsfwMode||1===(null===(e=this.userInfo)||void 0===e?void 0:e.is_audit)?this.applyNsfw():this.$refs.auditDialog.showDialog())},applyNsfw:function(){var e=this;this.btnLoading=!0;var t={};t.nsfw_plus=this.enableNsfwMode?2:1,t.mode=1,t.age_confirm=!0,Object(Q.b)(t).then((function(t){var n=(t||{}).status.code;["10000",1e4].includes(void 0===n?"":n)&&(e.$message.success(e.$t(e.enableNsfwMode?"ClosedSuccessfully":"OpenedSuccessfully")),e.btnLoading=!1,e.getAccountInfo())})).finally((function(){e.btnLoading=!1}))},doLogEvent:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n={operation:e,behavior_info:"on_comfyui_project_editing_page"};t&&(n.behavior_info_sub=t),this.$logEvent("log_actions",n)},viewBigImage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.activeCard=e,this.viewImageList=[t],this.dialogVisible=!0},closeViewBigImage:function(){this.dialogVisible=!1,this.viewImageList=[],this.activeCard=null},deleteSingleImg:function(e,t){var n=this,o=t||{},l=o.id,r=void 0===l?"":l,c=o.components,d=(void 0===c?[]:c)[e-1].index,h=void 0===d?-1:d;Object(V.b)({id:r,index:h}).then((function(){n.$message({message:n.$t("deleteSuccess"),type:"success"}),n.list.forEach((function(e){var o;e&&(null==e?void 0:e.id)===(null==t?void 0:t.id)&&(n.$set(e,"components",((null==e?void 0:e.components)||[]).filter((function(e){return e.index!==h}))),null!=e&&null!==(o=e.components)&&void 0!==o&&o.length||n.handleDeleteTask(null==e?void 0:e.id))}))}))},updateImageInfo:function(e,source,t,n){var o=this;this.list.forEach((function(l){e&&e===(null==l?void 0:l.id)&&(l.components||[]).forEach((function(e){e.index===source.index&&o.$set(e,t,n)}))}))},insertDataToList:function(e){this.list.unshift(e)},handleDeleteTask:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this.list.findIndex((function(t){return t.id===e}));-1!==t&&this.list.splice(t,1),this.top.changeSelectedId("")},changeViewMode:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.doLogEvent(t),this.scrollToTop("instant"),this.viewMode=e},scrollToTop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{var t=this.$refs.scrollWrapper;if(t){t.scrollTo({top:0,behavior:e})}}catch(e){}},handleRefresh:function(){this.list=[],this.hasMore=!0,this.getList()},addHeadItem:function(e){var t=this,n=e||[],o=Object(_l.a)(n,1)[0];this.list.unshift(o),setTimeout((function(){t.$refs.scrollWrapper.scrollTop=0}),0)},getList:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=(null===(e=this.$route.params)||void 0===e||e.id,{limit:20,scene:1,source:1});["",null,void 0].includes(n)||(o.time_from=n),this.loading=!0,this.isLoggedIn||(o.g_mode=1),Object(Ya.f)(o).then((function(e){var n=(null==e?void 0:e.data)||{},l=n.items,r=void 0===l?[]:l,c=n.has_more,d=void 0===c||c;if(t.hasMore=d,null!=o&&o.time_from){var h,m,v=Object(B.e)(t.list,r||[]),f=null===(h=t.$refs)||void 0===h||null===(h=h.scrollWrapper)||void 0===h?void 0:h.scrollHeight;(m=t.list).push.apply(m,Object(R.a)(v)),f&&v.length&&t.scrollToTop(f,"instant")}else t.list=Array.isArray(r)&&null!=r&&r.length?r:[],t.scrollToTop(0,"instant")})).finally((function(){t.loading=!1}))},toMall:function(){this.$logEvent("log_actions",{operation:"extend_maturity",behavior_info:"on_swtft_app_detail_page"});var e=this.paymentInfo.productLevel;this.isVip||this.$EventBus.$emit("showBreakDialog","ExpireTimeTipWeb","basic"),this.isVip&&1===e&&this.$EventBus.$emit("showUpgradeDialog","ExpireTimeTipWeb","standard"),this.isVip&&e>=2&&this.$EventBus.$emit("showUpgradeDialog","ExpireTimeTipWeb","professional")},initScrollBar:function(){var e=this;try{this.$refs.scrollWrapper.addEventListener("scroll",this.initScrollBarStatus),this.$once("hook:beforeDestroy",(function(){e.$refs.scrollWrapper.removeEventListener("scroll",e.initScrollBarStatus)}))}catch(e){}},initScrollBarStatus:function(){this.showScroll=!0},handleScroll:function(){try{var e=this.$refs.scrollWrapper;try{if(0===e.scrollTop&&0===e.scrollHeight)return}catch(e){}var t=(null==e?void 0:e.scrollHeight)-e.scrollTop;t-=null==e?void 0:e.clientHeight,e&&t<=30&&this.hasMore&&this.handleLoadMore()}catch(e){}},handleLoadMore:function(){var e=this.list.length?this.list[this.list.length-1]:"",t=e?e.create_at:"";this.getList(t)},retryWork:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$emit("onRetryWork",data)},handleCancelTask:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).info;console.log("info",t);var n=t.id,o=void 0===n?"":n,l={action:5,task_id:o};this.handleUpdateCancelBtnStatus(o,!0),Object(A.r)(l).then((function(t){var n=(t||{}).status,l=(void 0===n?{}:n).code,code=void 0===l?"":l;if([1e4,"10000"].includes(code)){var r=e.list.findIndex((function(e){return e.id===o}));-1!==r&&e.list.splice(r,1)}else[1e4,"10000"].includes(code)||e.handleTaskError(code),e.$logEvent("log_generates",{work_id:o,operation:"cancel_generate"})})).finally((function(){e.handleUpdateCancelBtnStatus(o,!1)}))},handleTaskError:function(code){var e={7e4:this.$t("taskOperateFailed"),70001:this.$t("taskExceededDailyGenerationLimit"),70002:this.$t("taskQueueFull"),70003:this.$t("taskModelVersionNotSupportVariations"),70009:this.$t("taskModelForbidden"),70008:this.$t("taskArtWorkForbidden"),80008:this.$t("InsufficientBalance")};code&&e[code]?this.$message.error(e[code]):this.$message.error(this.$t("ServerError"))},handleUpdateCancelBtnStatus:function(e,t){var n=this;this.list.forEach((function(o){o.id===e&&n.$set(o,"isLoading",t)}))}})},Xl=Kl,Ql=(n(3112),Object(y.a)(Xl,(function(){var e,t,n=this,o=n._self._c;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],staticClass:"c-workflow-history-modal"},[o("div",{directives:[{name:"show",rawName:"v-show",value:n.checkIsShowBackTopBtn,expression:"checkIsShowBackTopBtn"}],staticClass:"generate-view-back-top",class:[n.checkIsShowViewNsfw?"":"generate-view-back-top-only"],on:{click:function(e){return n.scrollToTop(0)}}},[o("i",{staticClass:"el-icon-caret-top"})]),n._v(" "),n.checkIsShowViewNsfw?o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:n.enableNsfwMode?n.$t("hideAdultContent"):n.$t("showAdultContent"),placement:"left"}},[o("div",{staticClass:"generate-view-nsfw-plus",on:{click:n.settingViewNsfw}},[o("i",{staticClass:"iconfont",class:n.enableNsfwMode?"icon-work-hide":"icon-work-show"})])]):n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:null===(e=n.manageList)||void 0===e?void 0:e.length,expression:"manageList?.length"}],staticClass:"easy-task-view-box-top padding-top-32"},[o("div",{staticClass:"easy-task-view-manage"},[o("div",{staticClass:"easy-task-view-manage-info"},[n._v("\n        "+n._s(n.$t("newGenerate11",{number:null===(t=n.manageList)||void 0===t?void 0:t.length}))+"\n      ")]),n._v(" "),o("div",{staticClass:"easy-task-view-manage-operate"},[n._l(n.manageBtnConfig,(function(e){return["DOWNLOAD"===e.code?[o("el-tooltip",{attrs:{content:n.$t("newGenerate54",{num:4}),placement:"top-start",effect:"light"}},[o("div",{key:"manage-btn_".concat(null==e?void 0:e.code),staticClass:"manage-operate-btn",on:{click:function(t){return t.stopPropagation(),n.handleManageOperate(null==e?void 0:e.code)}}},["DOWNLOAD"===e.code?[o("span",{staticClass:"manage-operate-btn-icon",class:[n.isInDownloadTask&&"DOWNLOAD"===e.code?"el-icon-loading":e.icon]})]:[o("span",{staticClass:"manage-operate-btn-icon",class:[e.icon]})],n._v(" "),o("span",{staticClass:"manage-operate-btn-text"},[n._v(n._s(n.$t(e.i18nKey)))])],2)])]:o("div",{key:"manage-btn_".concat(null==e?void 0:e.code),staticClass:"manage-operate-btn",on:{click:function(t){return t.stopPropagation(),n.handleManageOperate(null==e?void 0:e.code)}}},["DOWNLOAD"===e.code?[o("el-tooltip",{attrs:{content:n.$t("newGenerate54",{num:4}),placement:"top-start",effect:"light"}},[o("span",{staticClass:"manage-operate-btn-icon",class:[n.isInDownloadTask&&"DOWNLOAD"===e.code?"el-icon-loading":e.icon]})])]:[o("span",{staticClass:"manage-operate-btn-icon",class:[e.icon]})],n._v(" "),o("span",{staticClass:"manage-operate-btn-text"},[n._v(n._s(n.$t(e.i18nKey)))])],2)]})),n._v(" "),o("save-to",{ref:"saveToPopover",attrs:{type:"artwork",category:!0,title:n.$t("Save"),isBatchSave:!0,allowCreateCollect:!0,batchSaveParams:n.getBatchSaveParams,message:n.getMessageInfo,isColorBtn:!0,showArrowIcon:!1},on:{saveSuccess:n.handleSaveSuccess}})],2)])]),n._v(" "),o("div",{ref:"scrollWrapper",staticClass:"c-easy-task-view-scroll-wrap",class:[n.showScroll?"":"show-scroll-bar"],on:{scroll:n.debounceHandleScroll}},[o("div",{staticClass:"c-easy-task-view"},[o("div",{ref:"scrollContainer",staticClass:"message-list"},[o("div",{staticClass:"messages-wrapper"},[o("div",{staticClass:"scroll-wrapper"},[n._l(n.list,(function(e,t){return[o("history-item",{key:e.id,attrs:{message:e,viewMode:n.viewMode,showTime:n.showDateIds.includes(null==e?void 0:e.id)},on:{deleteTask:n.handleDeleteTask,onRetryWork:n.retryWork,onCancelTask:n.handleCancelTask}})]}))],2)])]),n._v(" "),o("auditDialog",{ref:"auditDialog",on:{confirm:n.applyNsfw}}),n._v(" "),o("common-confirm-modal",{ref:"commonConfirmModal"})],1)])],1)}),[],!1,null,"0b48a583",null).exports),Zl=n(3113);function Yl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yl(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ir={name:"AiChatCardUpdatePopup",data:function(){var e=this;return{genderOption:[{key:"male",label:"informationDialog5"},{key:"femail",label:"informationDialog6"},{key:"anime",label:"informationDialog7"}],loading:!1,coverImageLoading:!1,UPLOAD:new pi.a({type:51}),accept:".jpg,.jpeg,.png,.webp",isCoverLoading:!1,visible:!1,options:{title:"新增消息",syncTitle:"informationDialog13"},ruleForm:{username:"",like:"",is_default:"",gender:"",extra:"",dislike:"",avatar:{url:"",width:0,height:0},age:"",account_id:""},rules:{username:[{required:!0,message:this.$t("informationDialog19"),trigger:"blur"}],age:[{validator:function(t,n,o){Number(n<18)?o(new Error(e.$t("cardEditAgeError"))):o()},trigger:"blur"}]}}},computed:er({},Object(S.c)("user",["userInfo"])),props:{needSetDefaultUse:Boolean,dialogWidth:{type:Number,default:560},useCardId:{type:String,default:""},sessionId:{type:String,default:""}},methods:er(er({},Object(S.d)("user",["SET_USER_INFO"])),{},{changeDefault:function(e){var t;this.$logEvent("log_actions",{operation:"informationDialog13"===(null===(t=this.options)||void 0===t?void 0:t.syncTitle)?"click_defalut":"click_update_profile",behavior_info:"on_tarven_detail_page",behavior_info_sub:1===e?"open":"close"})},bindChat:function(data){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.sessionId&&data.id){t.next=2;break}return t.abrupt("return");case 2:n={session_id:e.sessionId,data_card_id:data.id},Object(W.c)(n).then((function(t){var n;1e4===(null===(n=t.status)||void 0===n?void 0:n.code)&&e.$EventBus.$emit("updateCurrentCard",data)}));case 4:case"end":return t.stop()}}),t)})))()},show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetData(),null!=e&&e.data&&(Object.assign(this.ruleForm,null==e?void 0:e.data),0===this.ruleForm.age&&(this.ruleForm.age=""),0===this.ruleForm.is_default&&(this.ruleForm.is_default="")),this.options=e,this.visible=!0},resetData:function(){this.resetForm(),this.options=null},handleClose:function(){this.resetData(),this.visible=!1},submitForm:function(e){var t=this;this.loading?this.$message.warning(this.$t("code_10405")):this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var n;t.loading=!0,null!==(n=t.options)&&void 0!==n&&n.data?t.editnformationFn():t.addInformationFn()}))},resetForm:function(){this.ruleForm={username:"",like:"",is_default:"",gender:"",extra:"",dislike:"",avatar:{url:"",width:0,height:0},age:"",account_id:""},this.$refs.ruleForm&&this.$refs.ruleForm.resetFields()},handleDelAvatar:function(){this.ruleForm.avatar.url=""},handleRoleCoverBeforeUpload:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.UPLOAD,l=["image/jpeg","image/png","image/jpg","image/gif","image/webp"],!t.isCoverLoading){n.next=4;break}return n.abrupt("return");case 4:if(l.includes(e.type)){n.next=7;break}return t.$message.error(t.$t("AllowImageFiles")),n.abrupt("return",!1);case 7:if(!(r=e)||r.size){n.next=10;break}return n.abrupt("return",!1);case 10:if(!(e.size/1024/1024>10)){n.next=21;break}return n.prev=11,n.next=14,Object(Ut.a)(e,10485760);case 14:r=n.sent,n.next=21;break;case 17:return n.prev=17,n.t0=n.catch(11),console.error("Compression failed:",n.t0),n.abrupt("return");case 21:return n.next=23,t.checkImageSize(r);case 23:if(c=n.sent,t.ruleForm.avatar.url=c.url||"",t.ruleForm.avatar.width=c.realWidth||0,t.ruleForm.avatar.height=c.realHeight||0,!t.isCoverLoading){n.next=29;break}return n.abrupt("return");case 29:return t.isCoverLoading=!0,o.startUpload(r).then((function(e){t.isCoverLoading=!1,t.coverImageLoading=!0,t.ruleForm.avatar.url=e||""})).catch((function(e){t.isCoverLoading=!1,t.coverImageLoading=!1,t.ruleForm.avatar.url="",t.ruleForm.avatar.width=0,t.ruleForm.avatar.height=0,t.$message.error(t.$t("uploadError"))})),n.abrupt("return",!1);case 32:case"end":return n.stop()}}),n,null,[[11,17]])})))()},checkImageSize:function(e){return new Promise((function(t,n){var o=new FileReader;o.onload=function(e){var img=new Image;img.onload=function(){var e={width:img.width,height:img.height,realWidth:img.naturalWidth,realHeight:img.naturalHeight};e.url=img.src,t(e)},img.onerror=function(){n(!1)},img.src=e.target.result},o.readAsDataURL(e)}))},addInformationFn:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,d,data,h,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(o=Object(xe.N)(e.ruleForm)).account_id=null===(n=e.userInfo)||void 0===n?void 0:n.id,o.age&&(o.age=Number(o.age)),console.log("新增参数-",o),t.prev=4,t.next=7,Object(W.a)(o);case 7:if(l=t.sent,r=l.status,c=void 0===r?{}:r,d=l.data,data=void 0===d?{}:d,10619!==(null==c?void 0:c.code)){t.next=13;break}return e.$message.warning(e.$t("addMore")),e.loading=!1,t.abrupt("return");case 13:if(1e4!==(null==c?void 0:c.code)){t.next=23;break}if(e.$message.success(e.$t("informationDialog17")),!e.needSetDefaultUse){t.next=20;break}return h={id:data.id},Object.assign(h,o),t.next=20,e.bindChat(h);case 20:1===o.is_default&&((m=Object(X.cloneDeep)(e.userInfo)).character_setting.default_card=data.id,e.SET_USER_INFO(m)),e.handleClose(),e.$emit("updateList");case 23:e.loading=!1,t.next=29;break;case 26:t.prev=26,t.t0=t.catch(4),e.loading=!1;case 29:case"end":return t.stop()}}),t,null,[[4,26]])})))()},editnformationFn:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,d,h,m,v,f,_,y,w,C;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c="datacard"===(null===(n=e.options)||void 0===n?void 0:n.type)||!1,d=W.n,c&&(d=W.p),h=Object(xe.N)(e.ruleForm),m=c?{card:h,session_id:e.sessionId,sync_main_card:e.ruleForm.is_default||2}:h,null!==(o=e.options)&&void 0!==o&&o.hideAsync&&delete m.sync_main_card,m.age&&(m.age=Number(m.age)),null!==(l=m.card)&&void 0!==l&&l.age&&(m.card.age=Number(m.card.age)),m.account_id=null===(r=e.userInfo)||void 0===r?void 0:r.id,console.log("编辑参数-",m),t.prev=10,t.next=13,d(m);case 13:v=t.sent,f=v.status,_=void 0===f?{}:f,y=v.data,1e4===(null==_?void 0:_.code)&&(e.$message.success(e.$t("informationDialog17")),e.useCardId===(null===(w=m.card)||void 0===w?void 0:w.id)&&c&&e.$EventBus.$emit("updateCurrentCard",m.card),1!==m.is_default||c||(console.log("手动进行新聊天默认的绑定",m.id),(C=Object(X.cloneDeep)(e.userInfo)).character_setting.default_card=m.id,e.SET_USER_INFO(C)),e.handleClose(),e.$emit("updateList")),e.loading=!1,t.next=22;break;case 19:t.prev=19,t.t0=t.catch(10),e.loading=!1;case 22:case"end":return t.stop()}}),t,null,[[10,19]])})))()}})},nr=ir,ar=(n(3114),Object(y.a)(nr,(function(){var e,t,n,o,l,r=this,c=r._self._c;return c("el-dialog",{attrs:{top:"3vh","close-on-click-modal":!1,"close-on-press-escape":!1,visible:r.visible,"custom-class":"aichat-information-modal","lock-scroll":"","destroy-on-close":!1,"modal-append-to-body":"","append-to-body":"",width:r.dialogWidth+"px"},on:{"update:visible":function(e){r.visible=e}}},[c("div",{staticClass:"popup-content"},[c("div",{staticClass:"popup-content-header"},[c("div",{staticClass:"top"},[c("div",{staticClass:"popup-content-header-title overflow-ellipsis"},[r._v(r._s(null===(e=r.options)||void 0===e?void 0:e.title))]),r._v(" "),c("span",{staticClass:"popup-content-header-close",on:{click:function(e){return e.stopPropagation(),r.handleClose.apply(null,arguments)}}},[c("i",{staticClass:"el-icon-close"})])]),r._v(" "),c("div",{staticClass:"popup-content-header-description"},[r._v("\n        "+r._s(r.$t("informationDialog2"))+"\n      ")])]),r._v(" "),c("div",{directives:[{name:"loading",rawName:"v-loading",value:r.loading,expression:"loading"}],staticClass:"popup-content-form-box hide-scrollbar"},[c("el-form",{ref:"ruleForm",staticClass:"popup-content-form",attrs:{"label-position":"top",inline:"",model:r.ruleForm,rules:r.rules,"label-width":"100px"}},[c("el-form-item",{attrs:{prop:"username"}},[c("template",{slot:"label"},[c("div",{staticClass:"custom-label"},[c("div",{staticClass:"symbol"},[r._v("*")]),r._v(" "),c("div",{staticClass:"label"},[c("span",[r._v(r._s(r.$t("informationDialog3")))]),r._v(" "),c("span",[r._v(r._s(r.$t("informationDialog18")))])])])]),r._v(" "),c("el-input",{attrs:{maxlength:"40",placeholder:r.$t("informationDialog19")},model:{value:r.ruleForm.username,callback:function(e){r.$set(r.ruleForm,"username",e)},expression:"ruleForm.username"}},[c("template",{slot:"append"},[r._v(r._s(r.ruleForm.username.length)+"/40")])],2)],2),r._v(" "),c("el-form-item",{attrs:{label:r.$t("informationDialog4")}},[c("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{maxlength:"40"},model:{value:r.ruleForm.avatar.url,callback:function(e){r.$set(r.ruleForm.avatar,"url",e)},expression:"ruleForm.avatar.url"}}),r._v(" "),null!==(t=r.ruleForm.avatar)&&void 0!==t&&t.url?c("div",{staticClass:"img-box"},[c("img",{staticClass:"avatar-img",attrs:{loading:"lazy",src:r.ruleForm.avatar.url,alt:null===(n=r.options)||void 0===n?void 0:n.title},on:{load:function(e){r.coverImageLoading=!1},error:function(e){r.coverImageLoading=!1}}}),r._v(" "),c("i",{staticClass:"del-icon el-icon-error",on:{click:function(e){return e.stopPropagation(),r.handleDelAvatar.apply(null,arguments)}}})]):c("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:r.isCoverLoading,expression:"isCoverLoading"}],key:"add-role-avatar",staticClass:"image-upload",attrs:{action:"#","before-upload":r.handleRoleCoverBeforeUpload,disabled:r.isCoverLoading,accept:r.accept,"http-request":function(){},"show-file-list":!1}},[c("div",{staticClass:"handle-upload",attrs:{slot:"trigger"},slot:"trigger"},[c("i",{staticClass:"iconfont icon-add-tag"})])])],1),r._v(" "),c("el-form-item",{attrs:{label:r.$t("gender"),prop:"gender"}},[c("el-radio-group",{model:{value:r.ruleForm.gender,callback:function(e){r.$set(r.ruleForm,"gender",e)},expression:"ruleForm.gender"}},r._l(r.genderOption,(function(e,t){return c("el-radio",{key:t,attrs:{label:e.key}},[r._v("\n              "+r._s(r.$t(e.label))+"\n            ")])})),1)],1),r._v(" "),c("el-form-item",{attrs:{label:r.$t("informationDialog8"),prop:"age"}},[c("el-input",{attrs:{placeholder:r.$t("inputAge"),maxlength:"8"},on:{input:function(e){r.ruleForm.age=e.replace(/[^\d]/g,"")}},model:{value:r.ruleForm.age,callback:function(e){r.$set(r.ruleForm,"age",e)},expression:"ruleForm.age"}},[c("template",{slot:"append"},[r._v(r._s(String(r.ruleForm.age).length||0)+"/8")])],2)],1),r._v(" "),c("el-form-item",{attrs:{label:r.$t("informationDialog9"),prop:"like"}},[c("el-input",{attrs:{autosize:"",type:"textarea",maxlength:"40","show-word-limit":"",placeholder:r.$t("pleaseEnte")},model:{value:r.ruleForm.like,callback:function(e){r.$set(r.ruleForm,"like",e)},expression:"ruleForm.like"}})],1),r._v(" "),c("el-form-item",{attrs:{label:r.$t("informationDialog10"),prop:"dislike"}},[c("el-input",{attrs:{autosize:"",type:"textarea",maxlength:"40","show-word-limit":"",placeholder:r.$t("pleaseEnte")},model:{value:r.ruleForm.dislike,callback:function(e){r.$set(r.ruleForm,"dislike",e)},expression:"ruleForm.dislike"}})],1),r._v(" "),c("el-form-item",{staticClass:"other-info-form-item",attrs:{label:r.$t("informationDialog11"),prop:"extra"}},[c("el-input",{attrs:{autosize:"",type:"textarea",placeholder:r.$t("informationDialog12"),maxlength:"1000","show-word-limit":""},model:{value:r.ruleForm.extra,callback:function(e){r.$set(r.ruleForm,"extra",e)},expression:"ruleForm.extra"}})],1)],1)],1)]),r._v(" "),c("div",{staticClass:"popup-footer"},[c("div",{staticClass:"default-box"},[null!==(o=r.options)&&void 0!==o&&o.hideAsync?r._e():c("el-checkbox",{attrs:{"true-label":1,"false-label":2,label:r.$t(null===(l=this.options)||void 0===l?void 0:l.syncTitle)},on:{change:r.changeDefault},model:{value:r.ruleForm.is_default,callback:function(e){r.$set(r.ruleForm,"is_default",e)},expression:"ruleForm.is_default"}})],1),r._v(" "),c("span",{staticClass:"popup-footer-btn popup-footer-btn-confirm",on:{click:function(e){return e.stopPropagation(),r.submitForm("ruleForm")}}},[r._v(r._s(r.$t("Save")))])])])}),[],!1,null,"2b8c7013",null)),or=ar.exports;function sr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function lr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sr(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rr={name:"AiChatCardListPopup",components:{AiChatCardUpdatePopup:or,ConfirmModal:hl},props:{useCardId:{type:String,default:""},sessionId:{type:String,default:""}},data:function(){return{modalWidth:740,useCardIdSelf:"",genderEnum:{male:"informationDialog5",femail:"informationDialog6",anime:"informationDialog7"},loading:!1,listData:[],manageMenu:[{title:"Edit",icon:"icon-icon-edit2",key:"editCard"},{title:"informationListDialog3",icon:"icon-a-icon-Usethiscard",key:"useCard"},{title:"informationListDialog4",icon:"icon-a-icon-SetasDefault",key:"setDefaultCard"},{title:"Delete",icon:"icon-icon-delete",key:"deleteCard"}],visible:!1,options:{},curIndex:null}},watch:{$route:{handler:function(){}},useCardId:{handler:function(e){this.useCardIdSelf=e},immediate:!0},listData:{handler:function(e){e&&e.length>2&&(this.modalWidth=1088),e&&e.length<3&&(this.modalWidth=740)},deep:!0,immediate:!0}},computed:lr(lr({},Object(S.c)("user",["userInfo","isLoggedIn"])),{},{accountId:function(){var e;return null===(e=this.userInfo)||void 0===e?void 0:e.id},default_card_id:function(){var e;return(null===(e=this.userInfo)||void 0===e||null===(e=e.character_setting)||void 0===e?void 0:e.default_card)||""},titleComputed:function(){var e=this;return function(t){var n=t.action,o=t.item;return"icon-a-icon-SetasDefault"===n.icon?o.id===e.default_card_id?"informationListDialog5":"informationListDialog4":n.title}}}),methods:lr(lr({},Object(S.d)("user",["SET_USER_INFO"])),{},{handleClickItem:function(e){this.useCardIdSelf=e},handleSave:function(){var e=this;if(this.useCardIdSelf!==this.useCardId){var t={data_card_id:this.useCardIdSelf,session_id:this.sessionId},data=this.listData.find((function(t){return t.id===e.useCardIdSelf}));this.bindChat(t,data)}this.handleClose()},bindChat:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&Object(W.c)(t).then((function(t){var n;1e4===(null===(n=t.status)||void 0===n?void 0:n.code)&&(e.$message.success(e.$t("informationDialog17")),e.$EventBus.$emit("updateCurrentCard",data))}))},setDefault:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-";Object(W.I)({default_card_id:t}).then((function(n){var o;if(1e4===(null===(o=n.status)||void 0===o?void 0:o.code)){e.$message.success(e.$t("informationDialog17"));var l=Object(X.cloneDeep)(e.userInfo);l.character_setting.default_card="-"===t?"":t,e.SET_USER_INFO(l)}}))},confirm:function(data){console.log("confirm",data);var e=data.type,t=void 0===e?"":e,n=data.id,o=void 0===n?"":n;if("Del"===t)this.delInformationFn({id:o})},handleActions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.key;if("icon-a-icon-SetasDefault"===e.icon)return data.id===this.default_card_id?void this.setDefault():data.id!==this.default_card_id?void this.setDefault(null==data?void 0:data.id):void 0;switch(t){case"editCard":this.$refs.AiChatCardUpdatePopup.show({data:data,title:this.$t("informationDialog20"),syncTitle:"informationDialog13",hideAsync:data.id===this.default_card_id});break;case"useCard":var n={data_card_id:null==data?void 0:data.id,session_id:this.sessionId};this.bindChat(n,data);break;case"deleteCard":this.$refs.confirmModal.show({subTitle:this.$t("delInformationDesc"),mainTitle:this.$t("delInformationTitle"),handleMethods:"Del",id:null==data?void 0:data.id})}},handleAdd:function(){this.$logEvent("log_actions",{operation:"click_create_new_profile",behavior_info:"on_tarven_detail_page"}),this.$refs.AiChatCardUpdatePopup.show({data:null,title:this.$t("informationDialog16"),syncTitle:"informationDialog13"})},delInformationFn:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,Object(W.i)(e);case 4:o=n.sent,l=o.status,1e4===(null==(r=void 0===l?{}:l)?void 0:r.code)&&(t.getList(),t.$message.success(t.$t("informationDialog17")),t.$emit("updateList"));case 7:case"end":return n.stop()}}),n)})))()},getList:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,data,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoggedIn){t.next=2;break}return t.abrupt("return");case 2:return e.loading=!0,t.next=5,Object(W.z)({account_id:e.accountId});case 5:n=t.sent,o=n.status,l=void 0===o?{}:o,r=n.data,data=void 0===r?{}:r,1e4===(null==l?void 0:l.code)&&(e.listData=(null==data||null===(c=data.items)||void 0===c?void 0:c.reverse())||[]),e.loading=!1;case 9:case"end":return t.stop()}}),t)})))()},show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,this.visible=!0,this.getList()},handleClose:function(){this.listData=[],this.visible=!1}})},cr=rr,dr=(n(3115),Object(y.a)(cr,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{top:"5vh",visible:e.visible,"custom-class":"aichat-information-modal","lock-scroll":"","destroy-on-close":"","modal-append-to-body":"","append-to-body":"","close-on-press-escape":!1,"close-on-click-modal":!1,width:e.modalWidth+"px"},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"popup-content-manage"},[t("div",{staticClass:"custom-header"},[t("i",{staticClass:"el-icon-close custom-header-close",on:{click:e.handleClose}}),e._v(" "),t("div",{staticClass:"custom-header-description"},[t("span",{staticClass:"left"},[e._v(e._s(e.$t("informationListDialog1")))]),e._v(" "),t("span",{staticClass:"right",on:{click:e.handleAdd}},[t("i",{staticClass:"el-icon-plus"}),e._v(" "),t("span",[e._v(e._s(e.$t("informationDialog16")))])])])]),e._v(" "),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"conintar-box hide-scrollbar"},[e.listData.length?e._l(e.listData,(function(n,o){var l,r,c;return t("div",{key:o,staticClass:"item-box",class:{"item-box-active":n.id===e.useCardIdSelf},on:{click:function(t){return e.handleClickItem(n.id)}}},[t("div",{staticClass:"info-top"},[[null,void 0,""].includes(null==n||null===(l=n.avatar)||void 0===l?void 0:l.url)?t("span",{staticClass:"avatar name-avatar"},[e._v(" "+e._s(n.username.slice(0,1)))]):t("img",{staticClass:"avatar",attrs:{loading:"lazy",src:null==n||null===(r=n.avatar)||void 0===r?void 0:r.url,alt:null==n?void 0:n.username},on:{click:function(t){return e.handleClickItem(n.id)}}}),e._v(" "),[null,void 0,""].includes(null==n||null===(c=n.avatar)||void 0===c?void 0:c.url)?e._e():[t("div",{staticClass:"avatar-background",style:{backgroundImage:"url(".concat(n.avatar.url,")")}},[t("div",{staticClass:"gradient-overlay"})])],e._v(" "),t("div",{staticClass:"left"},[n.id===e.default_card_id&&n.id===e.useCardId?[n.id===e.default_card_id?t("span",{staticClass:"tag"},[e._v(e._s(e.$t("createModeType1")))]):e._e(),e._v(" "),n.id===e.useCardId?t("span",{staticClass:"tag tag-use"},[e._v(e._s(e.$t("useIng")))]):e._e()]:[n.id===e.default_card_id||n.id===e.useCardId?t("span",{staticClass:"tag",class:{"tag-use":n.id===e.useCardId}},[e._v("\n                                    "+e._s(e.$t(n.id===e.default_card_id?"createModeType1":"useIng"))+"\n                                ")]):e._e()]],2),e._v(" "),e.useCardId!==n.id?t("el-popover",{ref:"myPopover",refInFor:!0,attrs:{trigger:"hover",placement:"bottom-end","popper-class":"popover-information","append-to-body":!1,"visible-arrow":!1,"popper-options":{boundariesElement:"body"},width:"167"}},[t("div",{staticClass:"pop-btns"},e._l(e.manageMenu,(function(o){return t("div",{key:o.key,staticClass:"pop-btns-item",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.handleActions(o,n)}}},[t("i",{staticClass:"iconfont",class:o.icon}),e._v(" "),t("span",{staticClass:"pop-btns-text"},[e._v(e._s(e.$t(e.titleComputed({action:o,item:n}))))])])})),0),e._v(" "),t("i",{staticClass:"el-icon-more",attrs:{slot:"reference"},on:{click:function(e){e.preventDefault(),e.stopPropagation()}},slot:"reference"})]):e._e()],2),e._v(" "),t("div",{staticClass:"info-box"},[t("div",{staticClass:"info-box-1"},[t("div",{staticClass:"info-box-1-name"},[t("el-tooltip",{attrs:{content:n.username,"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"bottom"}},[t("span",{staticClass:"name overflow-ellipsis"},[e._v(e._s(n.username))])])],1),e._v(" "),t("div",{staticClass:"info-box-1-dec"},[t("div",{staticClass:"info-box-1-dec-item"},[t("span",{staticClass:"gender"},[e._v(e._s(e.$t("gender")))]),e._v(" "),t("span",[e._v("\n                                        "+e._s(e.genderEnum[n.gender]?e.$t(e.genderEnum[n.gender]):"-")+"\n                                    ")])]),e._v(" "),t("div",{staticClass:"info-box-1-dec-item"},[t("span",{staticClass:"gender"},[e._v(e._s(e.$t("AI_person_age")))]),e._v(" "),t("span",[e._v(e._s(n.age||"-"))])])])]),e._v(" "),t("div",{staticClass:"info-box-2"},[t("div",{staticClass:"like-item"},[t("span",[e._v(e._s(e.$t("like")))]),e._v(" "),t("span",{staticClass:"txt txt-over2"},[e._v("\n                                    "+e._s(n.like||"-")+"\n                                ")])]),e._v(" "),t("div",{staticClass:"like-item like-item-2"},[t("span",[e._v(e._s(e.$t("disLike")))]),e._v(" "),t("span",{staticClass:"txt overflow-ellipsis"},[e._v("\n                                    "+e._s(n.dislike||"-")+"\n                                ")])])])])])})):e._e()],2)]),e._v(" "),t("div",{staticClass:"manage-list-popup-footer"},[t("span",{staticClass:"manage-list-popup-footer-btn",on:{click:function(t){return t.stopPropagation(),e.handleClose.apply(null,arguments)}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("span",{staticClass:"manage-list-popup-footer-btn manage-list-popup-footer-btn-confirm",on:{click:function(t){return t.stopPropagation(),e.handleSave()}}},[e._v("\n            "+e._s(e.$t("Save"))+"\n        ")])]),e._v(" "),t("AiChatCardUpdatePopup",{ref:"AiChatCardUpdatePopup",on:{updateList:e.getList}}),e._v(" "),t("ConfirmModal",{ref:"confirmModal",on:{confirm:e.confirm}})],1)}),[],!1,null,"69d272f6",null));function ur(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function pr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ur(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ur(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var mr={name:"AiChatCardManagePopup",components:{ConfirmModal:hl,AiChatCardUpdatePopup:or,AiChatCardListPopup:dr.exports},data:function(){return{isShowHandle:!1,manageMenu:[{title:"Edit",icon:"icon-icon-edit2"},{title:"Replace",icon:"icon-icon-replace"},{title:"Remove",icon:"icon-icon-Remove"}],listData:[]}},props:{positionBottom:{type:Number,default:84},useCard:{type:Object,default:function(){return{}}},sessionId:{type:String,default:""}},computed:pr(pr({},Object(S.c)("user",["userInfo","isLoggedIn"])),{},{useCardComputed:function(){return this.useCard||{}},needSetDefaultUse:function(){return!this.listData.length}}),mounted:function(){this.getList()},methods:{handleAddInformation:function(){this.listData.length?(console.log("挑选"),this.$refs.myInformationPopup.show()):(this.$logEvent("log_actions",{operation:"click_create_profile",behavior_info:"on_tarven_detail_page"}),console.log("新增！"),this.$refs.AiChatCardUpdatePopup.show({data:null,title:this.$t("informationDialog1"),syncTitle:"informationDialog13"}))},getList:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,data,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoggedIn){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Object(W.z)({account_id:e.accountId});case 4:n=t.sent,o=n.status,l=void 0===o?{}:o,r=n.data,data=void 0===r?{}:r,1e4===(null==l?void 0:l.code)&&(e.listData=(null==data||null===(c=data.items)||void 0===c?void 0:c.reverse())||[]);case 7:case"end":return t.stop()}}),t)})))()},handleEditInformation:function(){var e,t=this;this.$logEvent("log_actions",{operation:"click_profile_tab",behavior_info:"on_tarven_detail_page"}),Object(W.d)({id:null===(e=this.useCardComputed)||void 0===e?void 0:e.id}).then((function(e){var n;10616===(null===(n=e.status)||void 0===n?void 0:n.code)?t.$refs.AiChatCardUpdatePopup.show({data:t.useCardComputed,title:t.$t("informationDialog14"),hideAsync:!0,type:"datacard"}):t.$refs.AiChatCardUpdatePopup.show({data:t.useCardComputed,title:t.$t("informationDialog14"),syncTitle:"informationDialog15",type:"datacard"})}))},confirm:function(e){var t=e.type;if("Remove"===(void 0===t?"":t))this.removeInformationFn()},handleClickManage:function(title){switch(title){case"Edit":this.$logEvent("log_actions",{operation:"click_edit_profile",behavior_info:"on_tarven_detail_page"}),this.handleEditInformation();break;case"Replace":this.$logEvent("log_actions",{operation:"click_replace_profile",behavior_info:"on_tarven_detail_page"}),this.$refs.myInformationPopup.show();break;case"Remove":this.$logEvent("log_actions",{operation:"click_remove_profile",behavior_info:"on_tarven_detail_page"}),this.$refs.confirmModal.show({subTitle:this.$t("removeInformationTipConfirm"),mainTitle:this.$t("removeInformationTip"),handleMethods:"Remove"})}},removeInformationFn:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(W.k)({session_id:e.sessionId});case 2:o=t.sent,1e4===(null===(n=o.status)||void 0===n?void 0:n.code)&&(e.$message.success(e.$t("informationDialog17")),e.$EventBus.$emit("updateCurrentCard",{}));case 4:case"end":return t.stop()}}),t)})))()},hideHandle:function(){this.isShowHandle=!1}}},vr=(n(3116),Object(y.a)(mr,(function(){var e,t,n=this,o=n._self._c;return o("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:n.hideHandle,expression:"hideHandle"}],staticClass:"role-box",style:{bottom:n.positionBottom+"px"}},[n.useCardComputed.id?o("div",{staticClass:"current-role",on:{click:n.handleEditInformation}},[o("span",{staticClass:"name overflow-ellipsis"},[n._v("\n            "+n._s(n.useCardComputed.username)+"\n        ")]),n._v(" "),o("div",{staticClass:"more-handle",on:{click:function(e){e.stopPropagation(),n.isShowHandle=!n.isShowHandle}}},[o("i",{staticClass:"el-icon-more"})])]):o("div",{staticClass:"add-tip",on:{click:n.handleAddInformation}},[o("i",{staticClass:"el-icon-plus"}),n._v(" "),o("span",[n._v(n._s(n.$t("addInformation")))])]),n._v(" "),o("AiChatCardListPopup",{ref:"myInformationPopup",attrs:{sessionId:n.sessionId,useCardId:(null===(e=n.useCardComputed)||void 0===e?void 0:e.id)||""},on:{updateList:n.getList}}),n._v(" "),o("AiChatCardUpdatePopup",{ref:"AiChatCardUpdatePopup",attrs:{sessionId:n.sessionId,needSetDefaultUse:n.needSetDefaultUse,useCardId:(null===(t=n.useCardComputed)||void 0===t?void 0:t.id)||""},on:{updateList:n.getList}}),n._v(" "),o("ConfirmModal",{ref:"confirmModal",on:{confirm:n.confirm}}),n._v(" "),n.isShowHandle?o("div",{staticClass:"handle-menu"},n._l(n.manageMenu,(function(e,t){return o("div",{key:t,staticClass:"handle-menu-item",on:{click:function(t){return n.handleClickManage(e.title)}}},[o("i",{staticClass:"iconfont",class:e.icon}),n._v(" "),o("span",[n._v(n._s(n.$t(e.title)))])])})),0):n._e()],1)}),[],!1,null,"116e11f3",null).exports),gr=n(99);function fr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var _r={name:"BottomPopup",inject:["aiChatBody"],props:{info:{type:Object,default:function(){return{}}},sendMessage:{type:Array,default:function(){return[]}}},data:function(){return{isFree:!0,aniLoading:!1,listData:[],loading:!1}},mounted:function(){this.getList()},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fr(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(S.e)("user",["userInfo"])),beforeDestroy:function(){document.removeEventListener("click",this.handleOutsideClick)},methods:{handleEdit:function(text){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.aiChatBody.msgChange({text:text,isSend:e})},getList:function(){var e,t,n=this,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.listData=[],o&&this.$logEvent("log_actions",{operation:"click_switch",behavior_info:"on_tarven_detail_page"}),!this.ani&&!this.loading){this.aniLoading=o,this.loading=!0;var l={char_name:null===(e=this.info)||void 0===e?void 0:e.name,messages:this.sendMessage,user_name:this.userInfo.name||(null===(t=JSON.parse(localStorage.getItem("userInfo")))||void 0===t?void 0:t.name)};Object(W.E)(l).then((function(e){var t=e.status,o=void 0===t?{}:t,l=e.data,data=void 0===l?{}:l;1e4===o.code&&(n.listData=null==data?void 0:data.items),n.isFree=data.free_times>0,n.loading=!1,n.aniLoading=!1})).catch((function(e){console.log(e),n.loading=!1,n.aniLoading=!1,n.hidePopup()}))}},hidePopup:function(){this.aiChatBody.closePopup()}}},yr=_r,wr=(n(3117),Object(y.a)(yr,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"bottom-popup"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"inner-box"},[t("i",{staticClass:"el-icon-close",on:{click:e.hidePopup}}),e._v(" "),t("div",{staticClass:"inner-box-container"},[e.listData.length?t("div",{staticClass:"last-item"},[t("div",{staticClass:"last-item-inner",on:{click:function(t){return e.getList(!0)}}},[t("i",{staticClass:"el-icon-refresh",class:{"ani-class":e.aniLoading}}),e._v(" "),t("span",[e._v(e._s(e.$t("changeit")))]),e._v(" "),e.isFree?t("span",{staticClass:"free"},[e._v(e._s("(".concat(e.$t("aiChatReTip"),")")))]):e._e()])]):e._e(),e._v(" "),e._l(e.listData,(function(n,o){return t("div",{key:o,staticClass:"inner-box-item"},[t("div",{staticClass:"left"},[t("i",{staticClass:"iconfont icon-icon-edit2",on:{click:function(t){return e.handleEdit(n.text)}}}),e._v(" "),t("div",{staticClass:"line"},[e._v("|")])]),e._v(" "),t("div",{staticClass:"right",on:{click:function(t){return e.handleEdit(n.text,!0)}}},[e._v("\n                    "+e._s(n.text)+"\n                ")])])}))],2)])])}),[],!1,null,"6fb0dec2",null).exports),Cr=n(212);function kr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Sr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kr(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var xr={props:{msg:{type:Object,default:function(){return{}}},getVoiceParams:{type:Object,default:function(){return{}}}},watch:{"getVoiceParams.timbre_id":{handler:function(e){this.timbre_id=e,this.voiceUrl=""}}},data:function(){return{audioPlayer:null,duration:void 0,voiceLoading:!1,isPlaying:!1,customClass:"line-scale-audio",timbre_id:"",voiceUrl:null}},beforeDestroy:function(){this.stopAudio()},components:{LineLoading:gr.a,selectSoundModel:Cr.a},computed:Sr(Sr(Sr(Sr({},Object(S.e)("payment",["paymentInfo"])),Object(S.c)("user",["cdnHostFun","isCompanyAccount","isLoggedIn"])),Object(S.e)("user",["token"])),{},{playTime:function(){var e;return Math.floor(null===(e=this.audioPlayer)||void 0===e||null===(e=e.audioPlayer)||void 0===e?void 0:e.scheduledTime)||void 0},isVip:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount}}),methods:Sr(Sr({playAudio:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.voiceUrl){t.next=2;break}return t.abrupt("return");case 2:if(e.audioPlayer=e.$createAudioPlayer(e.voiceUrl,e.updateStatus),t.prev=3,!e.audioPlayer){t.next=7;break}return t.next=7,e.audioPlayer.start();case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),e.$message.warning(e.$t("soundPlayFail"));case 12:case"end":return t.stop()}}),t,null,[[3,9]])})))()},stopAudio:function(){this.audioPlayer&&this.audioPlayer.stop()},updateStatus:function(e,t){if(console.log("updateStatus",e,t),"over"!==t&&"start"!==t&&"error"!==e&&"error"!==t||(this.voiceLoading=!1),"error"===e||"error"===t)return this.isPlaying=!1,void this.$message.warning(this.$t("soundPlayFail"));this.isPlaying=e},handleClickPlay:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$logEvent("log_actions",{operation:"click_audio_broadcast",behavior_info:"on_tavern_chat_page"}),!e.voiceLoading){t.next=5;break}return e.voiceLoading=!1,e.stopAudio(),t.abrupt("return");case 5:if(e.getVoiceParams.timbre_id){t.next=8;break}return null===(n=e.$refs.selectSoundModel)||void 0===n||n.openModal(),t.abrupt("return");case 8:if(!e.isPlaying){t.next=11;break}return e.stopAudio(),t.abrupt("return");case 11:if(e.isLoggedIn){t.next=14;break}return e.$EventBus.$emit("openLoginDialog"),t.abrupt("return");case 14:if(!e.voiceUrl){t.next=19;break}e.voiceLoading=!0,e.playAudio(),t.next=21;break;case 19:return t.next=21,e.getTts();case 21:case"end":return t.stop()}}),t)})))()}},Object(S.b)("payment",["getPaymentInfo"])),{},{updateTts:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.voiceUrl||(e.timbre_id=e.getVoiceParams.timbre_id),e.voiceUrl&&!e.isPlaying&&(e.timbre_id=e.getVoiceParams.timbre_id,e.voiceUrl="");case 2:case"end":return t.stop()}}),t)})))()},selectModel:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.$emit("updateTimbreObj",e,"播放器更新音色"),t.timbre_id=e.id,t.$refs.selectSoundModel.handleClose(),t.voiceUrl="",n.next=6,t.getTts();case 6:case"end":return n.stop()}}),n)})))()},getTts:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.voiceLoading=!0,t.prev=1,n=JSON.parse(JSON.stringify(e.getVoiceParams)),e.timbre_id&&(n.timbre_id=e.timbre_id),t.next=6,Object(W.K)(n);case 6:1e4===(o=t.sent).status.code?(e.voiceUrl=o.data.url||"",e.duration=o.data.duration,e.getPaymentInfo(),e.playAudio()):(l={70039:["showVipComputingDialog","vipDialogComputedTit2"],70010:["showBreakDialog","VipTip","basic"],80008:e.isVip?["showVipComputingDialog"]:["showNotVipComputingDialog"]},o.status.code&&l[o.status.code]&&(r=e.$EventBus).$emit.apply(r,Object(R.a)(l[o.status.code])),e.voiceLoading=!1),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),e.$message.warning(e.$t("soundPlayFail")),e.voiceLoading=!1;case 14:case"end":return t.stop()}}),t,null,[[1,10]])})))()}})},Ir=(n(3118),Object(y.a)(xr,(function(){var e,t,n=this,o=n._self._c;return o("div",{staticClass:"audio-player-fcc",on:{click:n.handleClickPlay}},[o("div",{staticClass:"icon-container"},[n.msg.loading||n.voiceLoading?o("i",{staticClass:"el-icon-loading"}):[o("i",{directives:[{name:"show",rawName:"v-show",value:!n.isPlaying,expression:"!isPlaying"}],staticClass:"custom-play-btn"}),n._v(" "),o("line-loading",{directives:[{name:"show",rawName:"v-show",value:n.isPlaying,expression:"isPlaying"}],attrs:{customClass:n.customClass,count:7}})]],2),n._v(" "),o("selectSoundModel",{ref:"selectSoundModel",attrs:{selectList:null!==(e=n.getVoiceParams)&&void 0!==e&&e.timbre_id?[null===(t=n.getVoiceParams)||void 0===t?void 0:t.timbre_id]:[]},on:{selectModel:n.selectModel}})],1)}),[],!1,null,"9e5dd910",null).exports),Or=n(674);function Tr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function $r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tr(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Lr={components:{LineLoading:gr.a,AudioPlayer:Ir,AiChatReChatPopup:wr},props:{useCard:{type:Object,default:function(){return{}}},voiceDuration:{type:Number,default:0},msg:{type:Object,default:function(){return{}}},info:{type:Object,default:function(){return{}}},value:{type:String,default:""},isRegenerate:{type:Boolean,default:!1},isFirst:{type:Boolean,default:!1}},data:function(){return{formatMsg:Or.a,env:"production",msgText:""}},filters:{shortName:function(e){return e?e[0]:""}},computed:$r($r($r({},Object(S.e)("user",["userInfo"])),Object(S.c)("user",["isCompanyAccount"])),{},{showVoiceIcon:function(){var e,t=(null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.lang_code)||this.$i18n.locale,n=2===this.msg.role&&["zhCN","zhTW","ja","en"].includes(t)&&!this.isCompanyAccount&&this.msg.content||1===this.msg.support_voice,o=void 0===this.msg.showVoice||this.msg.showVoice;return n&&o},sender:function(){var e={name:"",avatar:""};if(1===this.msg.role){var t=this.useCard,n=t.username,o=void 0===n?"":n,l=t.avatar,r=void 0===l?{url:""}:l,c=this.userInfo,head=c.head,d=c.id,h=c.name;e.avatar=(null==r?void 0:r.url)||head,e.name=o||h||d}else{var m,v;e.avatar=null===(m=this.info)||void 0===m||null===(m=m.cover)||void 0===m?void 0:m.url,e.name=null===(v=this.info)||void 0===v?void 0:v.name}return e},isHandle:function(){var e=this.msg,t=e.loading,n=e.id;return!t&&"number"!=typeof n&&!this.isFirst}}),methods:{copyMsg:function(){this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"click_copy"}),Object(k.d)(this.msg.content),this.$message.success(this.$t("CopySuccess"))},delMsg:function(){this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"click_delete_chat"}),this.$emit("handle",{msg:this.msg,type:"DEL"})},changeMsgEdit:function(e){var t=this;this.$emit("input",e),this.$nextTick((function(){t.msgText=t.msg.content}))},editMsg:function(){var e,t=this,n=this.$route.query.s_id;this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"click_edit"}),Object(W.m)({id:null===(e=this.msg)||void 0===e?void 0:e.id,message:this.msgText,session_id:n}).then((function(e){var n=JSON.parse(JSON.stringify(t.msg));n.content=t.msgText,t.changeMsgEdit(""),t.$emit("handle",{msg:n,type:"EDIT"}),2===t.msg.role&&t.$refs.player&&t.$refs.player.updateTts()}))},regenerateMsg:function(){this.$emit("handle",{msg:this.msg,type:"REGENERATE"}),2===this.msg.role&&this.$refs.player&&this.$refs.player.updateTts()}}},Pr=(n(3119),Object(y.a)(Lr,(function(){var e,t,n=this,o=n._self._c;return o("div",{staticClass:"msg-item",class:{"my-msg":1===n.msg.role,"edit-item":n.value===n.msg.id,"msg-item-has-keep":n.msg.hasKeep}},[n.msg.coin?o("div",{staticClass:"msg-item-cost",class:{"msg-item-cost-right":1===n.msg.role}},[n._v("\n    "+n._s("Cost: - ".concat(n.msg.coin||"-"))+"\n    "),n.env.includes("production")?n._e():o("span",[n._v(n._s("Token: ".concat(n.msg.num_of_token||"-")))])]):n._e(),n._v(" "),o("div",{staticClass:"msg-sender",class:{"sender-name":!(null!==(e=n.sender)&&void 0!==e&&e.avatar)},style:{backgroundImage:"url(".concat(n.sender.avatar,")"),marginTop:2===n.msg.role?"54px":"0"},attrs:{"data-sender":n._f("shortName")(n.sender.name)}}),n._v(" "),o("div",{staticClass:"msg-body-box"},[n.showVoiceIcon?o("AudioPlayer",n._g(n._b({ref:"player",attrs:{getVoiceParams:{msg_id:n.msg.id,timbre_id:n.info.timbre_id},msg:n.msg}},"AudioPlayer",n.$attrs,!1),n.$listeners)):n._e(),n._v(" "),n.msg.recommend?[o("AiChatReChatPopup",n._b({attrs:{info:n.info}},"AiChatReChatPopup",n.$attrs,!1))]:o("div",{staticClass:"msg-body"},[o("div",{staticClass:"sender-name"},[n._v(n._s(null===(t=n.sender)||void 0===t?void 0:t.name))]),n._v(" "),n.isHandle?o("span",{staticClass:"handle-icon"},[n.isRegenerate?o("i",{staticClass:"el-icon-refresh",on:{click:n.regenerateMsg}}):n._e(),n._v(" "),n.value!==n.msg.id?o("i",{staticClass:"el-icon-edit",on:{click:function(e){return n.changeMsgEdit(n.msg.id)}}}):n._e()]):n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.value!==n.msg.id,expression:"value !== msg.id"}],staticClass:"msg-content",class:{"msg-content-disable":3===n.msg.status||n.msg.isDisabled},domProps:{innerHTML:n._s(n.formatMsg(n.msg.content))}}),n._v(" "),n.msg.loading?o("line-loading"):n._e(),n._v(" "),o("el-input",{directives:[{name:"show",rawName:"v-show",value:n.value===n.msg.id,expression:"value === msg.id"}],staticClass:"msg-textarea",attrs:{type:"textarea",autosize:{minRows:2,maxRows:10}},model:{value:n.msgText,callback:function(e){n.msgText=e},expression:"msgText"}})],1)],2),n._v(" "),n.isHandle?o("div",{staticClass:"msg-handle",style:{marginTop:"auto"}},[n.value!==n.msg.id?[o("i",{staticClass:"el-icon-copy-document",on:{click:n.copyMsg}}),n._v(" "),1===n.msg.role?o("i",{staticClass:"el-icon-delete",on:{click:n.delMsg}}):n._e()]:[o("i",{staticClass:"el-icon-success",on:{click:n.editMsg}}),n._v(" "),o("i",{staticClass:"el-icon-error",on:{click:function(e){return n.changeMsgEdit("")}}})]],2):n._e(),n._v(" "),n.msg.hasKeep?n._t("keepSAy"):n._e()],2)}),[],!1,null,"23b5a63a",null).exports),Mr={props:{isShowKeep:Boolean,data:{type:Object,default:function(){return{list:[],laoding:!1,info:"",offset_to:0}}},voiceDuration:{type:Number,default:0}},components:{AiChatMsgItem:Pr,LineLoading:gr.a},data:function(){return{showMsgIndex:[0,1,2,3,4],editMsg:"",debounceHandleScroll:function(){},scrollTop:0}},mounted:function(){this.debounceHandleScroll=Object(X.debounce)(this.scrollLoad,200)},methods:{handleKeepSay:function(){this.$logEvent("log_actions",{operation:"go_on_talk",behavior_info:"on_tarven_detail_page"}),this.$emit("handleKeepSay")},isRegenerate:function(i){var e=this.data.list,t=e[i];return!(e.length<2)&&(0===i&&2===t.role)},scrollBottom:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.$refs.msgList,n=t.scrollHeight;this.$nextTick((function(){t.scrollTo({top:e?-n:n,behavior:"smooth"})}))},scrollLoad:function(){var e=this.$refs.msgList;this.scrollTop=e.scrollTop||0;try{e&&Math.abs(e.scrollTop)+e.clientHeight>=e.scrollHeight-50&&this.$emit("load")}catch(e){}}}},jr=Mr,Dr=(n(3120),Object(y.a)(jr,(function(){var e,t,n=this,o=n._self._c;return o("div",{staticClass:"aichat-msg"},[o("div",{staticClass:"scroll-body"},[o("div",{ref:"msgList",staticClass:"msg-list hide-scrollbar",on:{scroll:n.debounceHandleScroll}},[n._l(n.data.list,(function(e,i){var t;return o("ai-chat-msg-item",n._g(n._b({key:"msg_"+e.id,attrs:{voiceDuration:n.voiceDuration,msg:e,info:n.data.info,isRegenerate:n.isRegenerate(i),isFirst:i===(null===(t=n.data.list)||void 0===t?void 0:t.length)-1},scopedSlots:n._u([{key:"keepSAy",fn:function(){return[n.isShowKeep?o("div",{staticClass:"keep-say",on:{click:n.handleKeepSay}},[o("div",{staticClass:"i-box"},[o("i",{staticClass:"iconfont icon-a-icon-keepon"})]),n._v(" "),o("span",[n._v(n._s(n.$t("keepSay")))])]):n._e()]},proxy:!0}],null,!0),model:{value:n.editMsg,callback:function(e){n.editMsg=e},expression:"editMsg"}},"ai-chat-msg-item",n.$attrs,!1),n.$listeners))})),n._v(" "),n.data.laoding||(null===(e=n.data.list)||void 0===e?void 0:e.length)%20==0?n._e():o("div",{staticClass:"aichat-body-desc"},[o("p",[o("span",{staticClass:"tips"},[n._v(n._s(n.$t("tavern12"))+": ")]),n._v(" "+n._s(null===(t=n.data.info)||void 0===t?void 0:t.evaluation))])])],2)])])}),[],!1,null,"8ef57aee",null).exports),Nr=n(427),Er=n(675);function Rr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,a){if(e){if("string"==typeof e)return Ar(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Ar(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,l=function(){};return{s:l,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw r}}}}function Ar(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,n=Array(a);t<a;t++)n[t]=e[t];return n}function Br(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ur(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Br(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Br(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fr={components:{AiChatMsg:Dr,AiChatCardManagePopup:vr},props:["value","sessionId","info","handleConfig","aiChatId"],provide:function(){return{aiChatBody:this}},watch:{sessionId:{handler:function(e){e&&this.initLoadMsg("sessionId 发生改变")},immediate:!0}},data:function(){return{contentQueue:[],isProcessing:!1,regenerateMsgCopy:"",handleRegenerateMsg:!1,activeTypingEffects:0,streamIng:!1,typingSpeed:20,chatStreamClass:null,optimizeIng:!1,msg:"",isShowLayout:!1,msgList:[],isOver:!1,loading:!1,params:{page_size:20,offset_to:0}}},computed:Ur(Ur(Ur(Ur({},Object(S.e)("user",["userInfo"])),Object(S.e)("payment",["paymentInfo"])),Object(S.c)("user",["isCompanyAccount","isLoggedIn"])),{},{characterInfo:function(){return this.info},isTreamMsgModel:function(){var e;return 1===(null===(e=this.handleConfig)||void 0===e?void 0:e.enable_stream_chat)},dataComputed:function(){var e=Object(X.cloneDeep)(this.msgList);return{list:this.setHasKeepForFirstRole2(e),loading:this.loading,characterInfo:this.characterInfo,offset_to:this.params.offset_to}},isShowKeep:function(){return!(this.loading||this.sendLoading||0===this.msgList.length||this.streamIng||this.isProcessing)},sendLoading:function(){var e,t=!1;this.msgList.length&&(t=null===(e=this.msgList)||void 0===e?void 0:e.some((function(e){return e.loading})));return this.isTreamMsgModel?t||this.isProcessing:t},maxInput:function(){return this.msg.length>2e3},isVip:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},sendMessage:function(){var e=[];return this.msgList.length&&(e=this.getNewArray(this.msgList)),e}}),mounted:function(){if(this.contentQueue=[],!this.sessionId&&this.characterInfo.first_msg){var e={content:this.characterInfo.first_msg,create_at:(new Date).getTime(),id:"".concat((new Date).getTime(),"random"),is_first_msg:1,role:2,status:3,loading:!1};this.msgList.push(e)}console.log("🚀 ~ mounted ~ characterInfo:",this.characterInfo)},methods:Ur(Ur({},Object(S.b)("payment",["getPaymentInfo"])),{},{setHasKeepForFirstRole2:function(e){var t=e.findIndex((function(e){return"number"==typeof e.role&&2===e.role}));return-1!==t&&(e[t].hasKeep=!0),e},closePopup:function(){var e;null!==(e=this.msgList[0])&&void 0!==e&&e.recommend&&this.msgList.shift()},msgChange:function(data){var text=data.text,e=data.isSend;this.closePopup(),this.msg=text,e&&this.sendMsg()},handleOptimizeChat:function(){var e,t,n=this;if(this.$logEvent("log_actions",{operation:"click_polish",behavior_info:"on_tarven_detail_page"}),this.isLoggedIn){if(!this.optimizeIng&&!this.sendLoading){this.optimizeIng=!0;var o={char_name:null===(e=this.characterInfo)||void 0===e?void 0:e.name,messages:this.sendMessage,user_name:this.userInfo.name||(null===(t=JSON.parse(localStorage.getItem("userInfo")))||void 0===t?void 0:t.name),text:this.msg};Object(W.A)(o).then((function(e){var t=e.status,o=void 0===t?{}:t,l=e.data,data=void 0===l?{}:l;1e4===o.code&&(n.msg=data.text),n.optimizeIng=!1})).catch((function(e){console.log(e),n.optimizeIng=!1}))}}else this.$EventBus.$emit("openLoginDialog",{callBack:function(){return n.$emit("newChat")}})},getNewArray:function(e){var t=(JSON.parse(JSON.stringify(e))||[]).filter((function(e){return!e.recommend}));return(t.length>=3?t.slice(0,3):t).map((function(e){return{role:2===e.role?"assistant":"user",text:e.content}}))},handleShowPopup:function(){var e=this;this.$logEvent("log_actions",{operation:"recommend_reply",behavior_info:"on_tarven_detail_page"}),this.isLoggedIn?(this.closePopup(),this.pushMsg("this is popup",!0)):this.$EventBus.$emit("openLoginDialog",{callBack:function(){return e.$emit("newChat")}})},scrollBottom:function(){this.$refs.aiChatMsg&&this.$refs.aiChatMsg.scrollBottom()},initLoadMsg:function(e){console.log("初始化消息--",e),this.msgList=[],this.params.offset_to=0,this.isOver=!1,this.loading=!1,this.getChatMsg(e)},getChatMsg:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("获取消息列表",e,t.sessionId),t.isLoggedIn&&t.sessionId){n.next=3;break}return n.abrupt("return");case 3:if(n.prev=3,!(o=localStorage.getItem("translate_".concat(t.sessionId)))){n.next=8;break}return t.msgList=JSON.parse(o),n.abrupt("return");case 8:if(!t.isOver){n.next=10;break}return n.abrupt("return");case 10:return t.loading=!0,n.next=13,Object(W.s)(Ur(Ur({},t.params),{},{session_id:t.sessionId}));case 13:l=n.sent,r=l.data,c=r.has_more,d=r.items,h=r.offset,t.msgList=t.msgList.concat(d||[]),!c&&0===t.params.offset_to&&t.msgList.length<=1&&t.$refs.aiChatMsg.scrollBottom(!0),t.params.offset_to=h,t.isOver=!c,n.next=27;break;case 25:n.prev=25,n.t0=n.catch(3);case 27:return n.prev=27,t.loading=!1,n.finish(27);case 30:case"end":return n.stop()}}),n,null,[[3,25,27,30]])})))()},hideLayout:function(){this.isShowLayout=!1},setLayout:function(e){this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"change_chat_position",behavior_info_sub:e}),this.$emit("layOutChange",e),this.isShowLayout=!1},enterSend:function(e){e.ctrlKey?this.msg+="\n":(e.preventDefault(),this.sendMsg())},handleKeepSay:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoggedIn){t.next=3;break}return e.$EventBus.$emit("openLoginDialog",{callBack:function(){return e.$emit("newChat")}}),t.abrupt("return");case 3:if(!e.sendLoading){t.next=5;break}return t.abrupt("return");case 5:e.closePopup(),n=e.pushMsg("",!1),o=e.characterInfo,l=o.vip_only,r=o.name,e.getStream({content:"",session_id:e.sessionId,vip_only:l,support_voice:e.characterInfo.support_voice,name:r},n,!0);case 9:case"end":return t.stop()}}),t)})))()},sendMsg:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoggedIn){t.next=3;break}return e.$EventBus.$emit("openLoginDialog",{callBack:function(){return e.$emit("newChat")}}),t.abrupt("return");case 3:if(e.msg.trim()&&!e.sendLoading&&!e.maxInput&&!e.optimizeIng){t.next=5;break}return t.abrupt("return");case 5:e.closePopup(),n=JSON.parse(JSON.stringify(e.msg)),o=e.pushMsg(e.msg,!0),l=e.characterInfo,r=l.vip_only,c=l.name,e.getStream({content:n,session_id:e.sessionId,vip_only:r,support_voice:e.characterInfo.support_voice,name:c},o),e.msg="";case 11:case"end":return t.stop()}}),t)})))()},isAsset:function(){var e,t=((null===(e=this.userInfo)||void 0===e?void 0:e.character_setting)||{}).gpt_model,n=this.paymentInfo||{},o=n.tempCoins,l=n.calculateCoins;return("GPT-4-Turbo-1106"===t?o+l>=120:o>0||l>0)||(this.isVip?this.$EventBus.$emit("showVipComputingDialog"):"GPT-4-Turbo-1106"===t?this.$EventBus.$emit("showBreakDialog","AiChatSendNotCoin","basic"):this.$EventBus.$emit("showNotVipComputingDialog"),!1)},getStream:function(e,t){var n=arguments,o=this;return Object(E.a)(regeneratorRuntime.mark((function l(){var r,c,d,h;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(r=n.length>2&&void 0!==n[2]&&n[2],c=o.isTreamMsgModel?"/api/stream/character/session/chat":"/api/v1/character/session/chat",d="",!o.isTreamMsgModel){l.next=10;break}if(h={data:e,isKeep:r,rMsgId:d,c_time:t,url:c},r){l.next=8;break}return setTimeout((function(){d=o.pushMsg("",""),o.sendStreamRequest(h,function(){var e=Object(E.a)(regeneratorRuntime.mark((function e(n){var l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{(c=null==n||null===(l=n.headers)||void 0===l?void 0:l.get("X-Msg-Id"))&&!r&&o.setMsgId(c,t)}catch(e){console.error("getStream-Error:",e)}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),500),l.abrupt("return");case 8:return o.sendStreamRequest(h,function(){var e=Object(E.a)(regeneratorRuntime.mark((function e(n){var l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{(c=null==n||null===(l=n.headers)||void 0===l?void 0:l.get("X-Msg-Id"))&&!r&&o.setMsgId(c,t)}catch(e){console.error("getStream-Error:",e)}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l.abrupt("return");case 10:r||setTimeout((function(){d=o.pushMsg("","")}),500),o.sendStreamRequest({data:e,url:c},function(){var e=Object(E.a)(regeneratorRuntime.mark((function e(n){var l,c,h,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,h=!(null==n||null===(l=n.headers)||void 0===l||!l.get("X-Status")),(m=null==n||null===(c=n.headers)||void 0===c?void 0:c.get("X-Msg-Id"))&&o.setMsgId(m,t),e.next=6,o.readStream(n,r?m:d,m,h,r);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("getStream-Error:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}());case 12:case"end":return l.stop()}}),l)})))()},readStream:function(e,t,n){var o=arguments,l=this;return Object(E.a)(regeneratorRuntime.mark((function r(){var c,d,h,m,v,f,_,y,w,C,k,S,x,I;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(h=o.length>3&&void 0!==o[3]&&o[3],m=o.length>4&&void 0!==o[4]&&o[4],v=null==e||null===(c=e.body)||void 0===c?void 0:c.getReader(),f=!0,_=null==e||null===(d=e.headers)||void 0===d?void 0:d.get("X-Response-Msg-Id"),-1===(y=l.msgList.findIndex((function(e){return e.id===t})))&&(y=0),w=l.msgList[y],e){r.next=12;break}return w.content=l.$t("AiChatErrorMsg"),w.loading=!1,r.abrupt("return");case 12:if(!f){r.next=39;break}return r.next=15,v.read();case 15:if(C=r.sent,k=C.done,S=C.value,x=Object(Nr.a)(S),!k){r.next=22;break}return f=!1,r.abrupt("break",39);case 22:if(!l.isErrorMsg(x)){r.next=28;break}return console.log("非流式输出接口报错！！",l.handleRegenerateMsg,y),l.msgList.length&&l.msgList[y]&&l.$set(l.msgList[y],"loading",!1),!l.handleRegenerateMsg&&l.msgList.splice(y,1),l.handleRegenerateMsg&&(l.msgList[y]&&(l.msgList[y].content=l.regenerateMsgCopy),l.handleRegenerateMsg=!1,l.regenerateMsgCopy=""),r.abrupt("return");case 28:l.msgList[y]&&(l.msgList[y].content=""),I=l.wipeMsg(x,y,n,m),w.content="",w.content=I,w.isDisabled=h,w.id=_,w.loading=!1,l.$nextTick((function(){l.scrollBottom(),l.getPaymentInfo()})),console.log("获取消息---\x3e 内容为: "+x,_),r.next=12;break;case 39:case"end":return r.stop()}}),r)})))()},objectToEncodedJSON:function(e){var t=JSON.stringify(e);return encodeURIComponent(t)},wipeMsg:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];console.log("wipeMsg--",e,t,n);var l=e.match(/\[([^\]]*)\][^\[]*$/);if(!l)return e;var r=JSON.parse(l[0]),c=Object(_l.a)(r,4),d=c[0],h=c[1],m=c[2],v=c[3];if(this.$set(this.msgList[t],"coin",v),this.$set(this.msgList[t],"num_of_token",m),n&&!o){var f=this.msgList.findIndex((function(e){return e.id===n}));-1!==f&&(this.$set(this.msgList[f],"coin",h),this.$set(this.msgList[f],"num_of_token",d))}return e.replace(/\[[^\]]*]$/,"")},getTimeout:function(){var e=new AbortController,t=e.signal;return setTimeout((function(){e.abort()}),6e4),t},sendStreamRequest:function(e,t){var n=this;return Object(E.a)(regeneratorRuntime.mark((function o(){var data,l,r,c,d,h,m,v,f,_,y,path,w,C;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(console.log("sendStreamRequest",e),data=e.data,l=e.isKeep,r=void 0!==l&&l,c=e.rMsgId,d=void 0===c?"":c,h=e.c_time,m=void 0===h?"":h,v=e.url,f=void 0===v?"":v,_=e.regenerateMsgId,y=void 0===_?"":_,!n.isTreamMsgModel){o.next=16;break}return o.prev=3,path="".concat(f,"?q=").concat(n.objectToEncodedJSON(data)),o.next=7,n.getSSE({path:path,isKeep:r,rMsgId:d,c_time:m,regenerateMsgId:y});case 7:w=o.sent,t&&t(w),o.next=15;break;case 11:o.prev=11,o.t0=o.catch(3),console.log("sendStreamRequest-err:",o.t0),t&&t("");case 15:return o.abrupt("return");case 16:return o.prev=16,o.next=19,fetch(f,{signal:n.getTimeout(),method:"POST",headers:{"Content-Type":"application/json",token:n.$cookies.get("T"),"Accept-Language":n.$cookies.get("lang")||navigator.language||navigator.browserLanguage,"X-App-Id":"web_global_seaart","X-Ad-Id":window.$nuxt.$cookies.get("ad")},body:JSON.stringify(data)});case 19:if((C=o.sent).ok){o.next=22;break}throw new Error("Network response was not ok");case 22:t&&t(C),o.next=29;break;case 25:o.prev=25,o.t1=o.catch(16),console.log("sendStreamRequest-err:",o.t1),t&&t("");case 29:case"end":return o.stop()}}),o,null,[[3,11],[16,25]])})))()},getSSE:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var path,o,l,r,c,d,h,m,v,f,_,y,w;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(path=e.path,o=e.isKeep,l=void 0!==o&&o,r=e.rMsgId,c=void 0===r?"":r,d=e.c_time,h=void 0===d?"":d,m=e.regenerateMsgId,v=void 0===m?"":m,console.log("getSSE--",e),path){n.next=4;break}return n.abrupt("return",Promise.reject(new Error("No path provided")));case 4:return f=t.$cookies.get("lang")||navigator.language||navigator.browserLanguage,_=t.$cookies.get("T"),y=t.getTimeout(),w=window.$nuxt.$cookies.get("ad"),n.abrupt("return",new Promise((function(e,n){var o=null,r=null,d=null,m=!!v;t.chatStreamClass=new Er.a({url:path,headers:{signal:y,token:_,"Accept-Language":f,"X-App-Id":"web_global_seaart","X-Ad-Id":w},onUpdate:function(data){t.handleStreamUpdate(data,o)},onFinish:function(e,n){t.handleStreamFinish({msg:e,expend:n},{isKeep:l,sMsgId:r,msgIndex:o,isRegenerate:m})},onError:function(e){t.handleStreamError(e),n(e)},onResponseReceived:function(n){var m,f,_,y=null==n||null===(m=n.headers)||void 0===m?void 0:m.get("X-Status");if(y&&t.isErrorMsg(y))return console.log("流式接口报错！！",t.handleRegenerateMsg),t.msgList.length&&t.$set(t.msgList[0],"loading",!1),!t.handleRegenerateMsg&&t.msgList.splice(0,1),t.handleRegenerateMsg&&(t.msgList[0].content=t.regenerateMsgCopy,t.handleRegenerateMsg=!1,t.regenerateMsgCopy=""),t.streamIng=!1,void(t.activeTypingEffects=0);if(d=v||(l?h:c),r=null==n||null===(f=n.headers)||void 0===f?void 0:f.get("X-Msg-Id"),-1===(o=t.msgList.findIndex((function(e){return e.id===d||e.create_at===d})))&&(o=0),console.log("msgIndex--targetId",o,d),2===(null===(_=t.msgList[o])||void 0===_?void 0:_.role)&&!v){var w,C=null==n||null===(w=n.headers)||void 0===w?void 0:w.get("X-Response-Msg-Id");t.msgList[o].id=C}t.msgList[o]&&(t.$set(t.msgList[o],"showVoice",!1),t.$set(t.msgList[o],"loading",!1)),e(n)}}),t.activeTypingEffects=0,t.streamIng=!0,t.chatStreamClass.fetchSSE()})));case 9:case"end":return n.stop()}}),n)})))()},handleStreamUpdate:function(data,e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,content;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.msgList[e]&&t.$set(t.msgList[e],"loading",!1),o=data.content,content=void 0===o?"":o){n.next=4;break}return n.abrupt("return");case 4:t.contentQueue.push({content:content,msgIndex:e}),t.isProcessing||t.processQueue();case 6:case"end":return n.stop()}}),n)})))()},processQueue:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,content,l,r,c,d,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isProcessing&&0!==e.contentQueue.length){t.next=2;break}return t.abrupt("return");case 2:e.isProcessing=!0,e.activeTypingEffects++,n=null;case 5:if(!(e.contentQueue.length>0)){t.next=30;break}o=e.contentQueue.shift(),content=o.content,l=o.msgIndex,n=l,r=content.split(""),c=Rr(r),t.prev=10,c.s();case 12:if((d=c.n()).done){t.next=20;break}return h=d.value,t.next=16,e.wait(e.typingSpeed);case 16:e.msgList[l]&&e.$set(e.msgList[l],"content",(e.msgList[l].content||"")+h),e.scrollBottom();case 18:t.next=12;break;case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(10),c.e(t.t0);case 25:return t.prev=25,c.f(),t.finish(25);case 28:t.next=5;break;case 30:e.activeTypingEffects--,e.isProcessing=!1,0===e.activeTypingEffects&&(console.log("流式输出效果结束！"),null!==n&&e.msgList[n]&&e.$set(e.msgList[n],"showVoice",!0)),e.contentQueue.length>0&&e.processQueue();case 34:case"end":return t.stop()}}),t,null,[[10,22,25,28]])})))()},handleStreamFinish:function(e,t){console.log("消息流结束回调--",e,t);e.msg;var n=e.expend,o=t.isKeep,l=void 0!==o&&o,r=t.sMsgId,c=void 0===r?"":r,d=t.msgIndex,h=void 0===d?null:d,m=t.isRegenerate,v=void 0!==m&&m;if(n.length){var f=Object(_l.a)(n,4),_=f[0],y=f[1],w=f[2],C=f[3],k=null;this.msgList[h]&&(this.$set(this.msgList[h],"coin",C),this.$set(this.msgList[h],"num_of_token",w)),!c||l||v||(k=this.msgList.findIndex((function(e){return e.id===c})),this.msgList[k]&&(this.$set(this.msgList[k],"coin",y),this.$set(this.msgList[k],"num_of_token",_))),console.log("消息流结束回调--","回复索引--",h,"发送者索引--",k,"发送者id--",c,"this.msgList--",this.msgList)}this.streamIng=!1,this.getPaymentInfo()},handleStreamError:function(e){console.error("Stream error:",e),this.streamIng=!1,this.isProcessing=!1},wait:function(e){return new Promise((function(t){return setTimeout(t,e)}))},isErrorMsg:function(e){console.log("isErrorMsg--",e);try{var t={70039:["showVipComputingDialog","vipDialogComputedTit2"],70010:["showBreakDialog","VipTip","basic"],80008:this.isVip?["showVipComputingDialog"]:["showNotVipComputingDialog"]};if(this.isTreamMsgModel){var n;if(e&&t[e])return(n=this.$EventBus).$emit.apply(n,Object(R.a)(t[e])),!0}else{var o,data=JSON.parse(e);if(data.status.code&&t[data.status.code])return(o=this.$EventBus).$emit.apply(o,Object(R.a)(t[data.status.code])),!0}}catch(e){return!1}},setMsgId:function(e,t){console.log("setMsgId","-msgIde-",e,"-cTime-",t);var n=this.msgList.findIndex((function(e){return e.create_at===t}));-1!==n&&(this.msgList[n].id=e)},pushMsg:function(e,t,n){var o=(new Date).getTime(),l={content:e,create_at:o,role:t?1:2,id:n||o,coin:"",num_of_token:"",loading:!Boolean(t),isDisabled:!1,recommend:"this is popup"===e,hasKeep:!1,showVoice:!0};return this.msgList.unshift(l),this.scrollBottom(),o},handleMsg:function(e){var t=e.msg,n=t.id,content=t.content,o=e.type,l=this.msgList.findIndex((function(e){return e.id===n}));switch(o){case"DEL":this.delMsg(l);break;case"EDIT":this.editMsg(l,content);break;case"REGENERATE":this.regenerateMsg(l)}},regenerateMsg:function(e){var t=this,n=this.msgList[e+1],content=n.content,o=n.id,l=this.msgList[e].id,r=this.$route.query.s_id;this.regenerateMsgCopy=this.msgList[e].content,this.msgList[e].content="",this.$set(this.msgList[e],"loading",!0),this.handleRegenerateMsg=!0;var c={data:{last_msg:content,last_msg_id:Object(Ye.a)(o)===Number?String(o):o,msg_id:l,session_id:r,support_voice:this.characterInfo.support_voice},url:this.isTreamMsgModel?"/api/stream/character/session/msg/refresh":"/api/v1/character/session/message/refresh",regenerateMsgId:l};[null,void 0,""].includes(l)&&(delete c.data.msg_id,delete c.data.last_msg_id),this.isTreamMsgModel&&delete c.data.last_msg,this.sendStreamRequest(c,function(){var e=Object(E.a)(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isTreamMsgModel){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.readStream(n,l);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},editMsg:function(e,content){this.msgList[e].content=content},delMsg:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.$route.query.s_id,n.prev=1,2!==(l=t.msgList.slice(e-1,e+1).map((function(e){return null==e?void 0:e.id}))).length){n.next=6;break}return n.next=6,Object(W.h)({ids:l,session_id:o});case 6:t.msgList.splice(e-1,2),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(1),console.error("Error deleting messages:",n.t0);case 12:case"end":return n.stop()}}),n,null,[[1,9]])})))()},handleTips:function(){var e=this;this.msg=this.msg.concat("**");var t=this.msg.length;this.$nextTick((function(){var n,input=null===(n=e.$refs.aichatInput)||void 0===n?void 0:n.$el.querySelector("textarea");input&&input.setSelectionRange&&(input.focus(),input.setSelectionRange(t-1,t-1))}))}})},zr=Fr,Vr=(n(3121),Object(y.a)(zr,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"ai-chat-body"},[t("ai-chat-msg",e._g(e._b({ref:"aiChatMsg",attrs:{sendMessage:e.sendMessage,isShowKeep:e.isShowKeep,data:e.dataComputed},on:{msgChange:e.msgChange,handleKeepSay:e.handleKeepSay,load:function(t){return e.getChatMsg("load")},handle:e.handleMsg}},"ai-chat-msg",e.$attrs,!1),e.$listeners)),e._v(" "),t("AiChatCardManagePopup",e._b({attrs:{positionBottom:52,"session-id":e.sessionId}},"AiChatCardManagePopup",e.$attrs,!1)),e._v(" "),t("div",{staticClass:"ai-chat-input flex-center"},[t("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.hideLayout,expression:"hideLayout"}],staticClass:"set-layout"},[e._e(),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowLayout,expression:"isShowLayout"}],staticClass:"layout-popup"},[t("p",[e._v(e._s(e.$t("ChatPosition")))]),e._v(" "),t("div",{staticClass:"set-list",class:e.value},[t("i",{staticClass:"el-icon-arrow-left",on:{click:function(t){return e.setLayout("left")}}}),e._v(" "),t("i",{staticClass:"el-icon-arrow-down",on:{click:function(t){return e.setLayout("center")}}}),e._v(" "),t("i",{staticClass:"el-icon-arrow-right",on:{click:function(t){return e.setLayout("right")}}})])])]),e._v(" "),t("div",{staticClass:"input-panel flex-center",class:{"max-input":e.maxInput}},[t("div",{staticClass:"auto-chat-btn",on:{click:e.handleShowPopup}},[t("i",{staticClass:"iconfont icon-a-icon-AutomaticReply"})]),e._v(" "),t("el-input",{ref:"aichatInput",attrs:{type:"textarea",placeholder:e.$t("gpt_input_placeholder_mobile"),autosize:{minRows:1,maxRows:6}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.enterSend.apply(null,arguments))}},model:{value:e.msg,callback:function(t){e.msg=t},expression:"msg"}}),e._v(" "),e.optimizeIng?t("i",{staticClass:"el-icon-loading"}):t("i",{directives:[{name:"show",rawName:"v-show",value:e.msg,expression:"msg"}],staticClass:"iconfont icon-mofabang",on:{click:e.handleOptimizeChat}}),e._v(" "),e.sendLoading||e.optimizeIng?t("i",{staticClass:"el-icon-loading"}):t("i",{staticClass:"el-icon-s-promotion",class:{disabled:!e.msg},on:{click:e.sendMsg}})],1)])],1)}),[],!1,null,"2023585e",null)),Wr=Vr.exports,Hr={props:["url"],data:function(){return{screenWidth:0,screenHeight:0}},computed:{is4K:function(){return this.screenWidth>1e3},imageStyle:function(){return{width:"100%",height:"100%",objectFit:"contain",objectPosition:"bottom",verticalAlign:"middle"}}},mounted:function(){this.updateScreenSize(),window.addEventListener("resize",this.updateScreenSize)},beforeDestroy:function(){window.removeEventListener("resize",this.updateScreenSize)},methods:{updateScreenSize:function(){this.screenWidth=window.innerWidth},imgLoad:function(){this.$emit("imgLoad")}}},qr=(n(3122),Object(y.a)(Hr,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"aichat-figure flex-center"},[t("img",{style:e.imageStyle,attrs:{src:e.url,alt:"searArt.AI"},on:{load:e.imgLoad}})])}),[],!1,null,"d7bdf93c",null).exports),Gr=(n(670),n(395)),Jr=n.n(Gr),Kr=n(51);function Xr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Qr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xr(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Zr={name:"soundItem",components:{AudioPlayer:n(150).a,CollectPopover:an.a},data:function(){return{playIconCustomStyle:{position:"absolute",right:"11px",bottom:"9px",zIndex:"999"}}},props:{showHandle:{type:Boolean,default:!0},item:{type:Object,default:function(){}},imgStyle:{type:String,default:"contain"},domId:{type:String,default:""}},computed:Qr(Qr({},Object(S.c)("user",["isLoggedIn"])),{},{imgUrl:function(){var e=this.item||{},t="";return e.cover?t=e.cover:e.cover.cover?t=e.cover.cover:t},selfTag:function(){var e,t,n=[];null!==(e=this.item)&&void 0!==e&&null!==(e=e.tags)&&void 0!==e&&e.length&&(n=null===(t=this.item)||void 0===t?void 0:t.tags.map((function(e){return e.title})));return n},attrTags:function(){var e=this,t=[];if(this.item){var n,o,l,r=[],c=[],d=[];if(this.item.gender){var h=xe.z.filter((function(t){return t.value===e.item.gender}))||[];h.length&&c.push(h[0].i18Key)}if(this.item.age){var m=xe.z.filter((function(t){return t.value===e.item.age}))||[];m.length&&r.push(m[0].i18Key)}if(null!==(n=this.item)&&void 0!==n&&n.tones&&null!==(o=this.item)&&void 0!==o&&o.tones.length)d=null===(l=this.item)||void 0===l?void 0:l.tones.map((function(e){var t=xe.z.find((function(t){return t.value===e}));return t?t.i18Key:""}));return t=[].concat(r,c,Object(R.a)(d))}return t}}),methods:{handleClickCollect:function(e){var t=this;this.$logEvent("log_actions",{operation:"click_quick_collect",behavior_info:"on_choose_audio_popup"}),this.isLoggedIn||(e.stopPropagation(),this.$EventBus.$emit("openLoginDialog",{callBack:function(){return t.$emit("newChat")}}))},handleDetail:function(){this.$logEvent("log_actions",{operation:"click_detail",behavior_info:"on_choose_audio_popup"});var e=this.localePath("/ai-audio/detail/".concat(this.item.id));window.open(e,"_blank")}}},Yr=(n(3123),Object(y.a)(Zr,(function(){var e,t,n,o,l,r,c=this,d=c._self._c;return d("div",{staticClass:"sound-item",on:{click:function(e){return c.$emit("handleSelect")}}},[c._t("default"),c._v(" "),c.showHandle?d("div",{staticClass:"cltpop",on:{click:function(e){e.stopPropagation()}}},[d("div",{staticClass:"collect-popover-container",on:{click:function(e){return e.stopPropagation(),c.handleClickCollect.apply(null,arguments)}}},[d("CollectPopover",{attrs:{type:"ai_audio",folder:c.item,from:"waterfall"}})],1),c._v(" "),d("div",{staticClass:"detail-button",on:{click:function(e){return e.stopPropagation(),c.handleDetail(c.item)}}},[c._v("\n      "+c._s(c.$t("Details"))+"\n    ")])]):c._e(),c._v(" "),d("div",{staticClass:"left"},[d("AudioPlayer",{attrs:{logParams:{operation:"click_audition",behavior_info:"on_voice_select_pop",behavior_info_sub:"vioce_name=".concat(null===(e=c.item)||void 0===e?void 0:e.name)},domId:c.domId,modelPlay:"",playIconCustomStyle:c.playIconCustomStyle,item:c.item}}),c._v(" "),["",null,void 0].includes(null===(t=c.item)||void 0===t?void 0:t.cover)?[d("div",{staticClass:"image-empty-sound"},[c._v(c._s(c.$t("EmptyBannerText")))])]:[d("el-image",{staticClass:"list-item-image-card-image",attrs:{fit:c.imgStyle,src:null===(n=c.item)||void 0===n?void 0:n.cover}},[d("template",{slot:"error"},[d("img",{directives:[{name:"webp",rawName:"v-webp",value:c.$imgL,expression:"$imgL"}],staticClass:"error-img",staticStyle:{width:"110px",height:"110px","border-radius":"8px"},attrs:{src:null===(o=c.item)||void 0===o?void 0:o.cover,alt:null===(l=c.item)||void 0===l?void 0:l.name}})])],2)]],2),c._v(" "),d("div",{staticClass:"right",style:{justifyContent:c.attrTags.length||c.selfTag.length?"center":"flex-start"}},[d("div",{staticClass:"right-name",style:{marginTop:c.attrTags.length||c.selfTag.length?"0px":"10px"}},[c._v(c._s(null===(r=c.item)||void 0===r?void 0:r.name)+"\n    ")]),c._v(" "),d("div",{staticClass:"right-tags"},[c.attrTags.length?c._l(c.attrTags,(function(e,t){return d("div",{key:e+t,staticClass:"tag-item"},[c._v("\n          "+c._s(c.$t(e))+"\n        ")])})):c._e(),c._v(" "),c.selfTag.length?c._l(c.selfTag,(function(e,t){return d("div",{key:e+t,staticClass:"tag-item"},[c._v("\n          "+c._s(e)+"\n        ")])})):c._e()],2)])],2)}),[],!1,null,"76bec1b4",null)),ec=Yr.exports;function tc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,a){if(e){if("string"==typeof e)return ic(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?ic(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,l=function(){};return{s:l,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw r}}}}function ic(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,n=Array(a);t<a;t++)n[t]=e[t];return n}function nc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ac(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nc(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var oc={name:"SelectSoundModel",mixins:[ce.a],components:{modelPayNum:on.a,changeVer:sn.a,SwipeableList:ln.a,AiChatSoundItem:ec,ElAutocomplete:Jr.a},props:{selectList:{type:Array,default:function(){return["1fb5d6c22a1d6803519a62be8006c8b2"]}}},data:function(){return{showFilter:!1,soundsTypeInfo:xe.T,visible:!1,activeTab:"mine",timeName:"All",timeTypeOption:xe.U,tagIndex:"hot",typeOption:xe.S,tabList:[{label:"我的",type:"mine",id:"mine",order:1,i18nKey:"Mine"}],queryOptionsList:xe.M,replaceKeyArr:xe.P,queryParam:{order_by:"hot",keyword:""},filterQueryParams:{styles:[],model_types:[],list_b:[],list_a:[]},list:[],hotRecentUsedList:[],loading:!1,noMore:!1,pageInfo:{page:1,page_size:60,total:0},debounceHandleScroll:null,gridNum:3,modalWidth:"1286px",debounceResize:null,itemScroll:null,queryType:"comprehensive",soundAttrSelectAll:[]}},computed:ac(ac(ac({},Object(S.c)("user",["isLoggedIn"])),{},{convertTabText:function(){return function(e){return e.title?e.title:this.$t(e.i18nKey)}}},Object(S.e)("user",["collectData","cdnHost","token"])),{},{showEmptyResult:function(){var e=!this.loading,t=!this.list.length&&!this.hotRecentUsedList.length;return e&&t},showRecommendText:function(){return!this.loading&&this.hotUsedList.length&&"mine"===this.activeTab&&"comprehensive"===this.queryType},isNoRecentUsed:function(){return!this.loading&&!this.list.length&&"recent"===this.queryType&&this.showRecommendText},nsfwUrl:function(){return"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")},activeTabClass:function(){return function(e){return e&&e===this.activeTab?"tab-active":""}},getImageUrl:function(){return function(e){var t="";return e.banner&&!["",null,void 0].includes(e.banner.url)?t=Object(k.x)(e.banner.url,this.$imgL):t}},activeSelectModel:function(){return function(e){return this.selectList.find((function(t){return e.id===t}))?"select-sound-active":""}},hotUsedList:function(){return this.hotRecentUsedList}}),beforeDestroy:function(){this.debounceHandleScroll=null},watch:{hotRecentUsedList:{handler:function(e){for(var i=0;i<this.hotRecentUsedList.length;i++)for(var t=0;t<this.selectList.length;t++)this.selectList[t].id,this.hotRecentUsedList[i].id}},list:{handler:function(e){for(var i=0;i<this.list.length;i++)for(var t=0;t<this.selectList.length;t++)if(this.selectList[t].id===this.list[i].id&&this.selectList[t].art_model_ver_no_name&&this.list[i].version_name){this.list[i].version_name=this.selectList[t].art_model_ver_no_name,this.list[i].banner.url=this.selectList[t].model_cover;break}}}},mounted:function(){var e=this;this.debounceHandleScroll=Object(X.debounce)(this.handleScroll,600),this.debounceResize=Object(X.debounce)(this.handleResize,500),window.addEventListener("resize",this.debounceResize),this.$nextTick((function(){e.handleResize()}))},methods:{newChat:function(){this.$emit("newChat")},querySearchAsync:function(e,t){var n=this;return Object(E.a)(regeneratorRuntime.mark((function e(){var o,l,r,c,data,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={except_num:10,nsfw_plus:1,prefix:n.queryParam.keyword,source_type:16},e.next=3,Object(Kr.g)(o);case 3:l=e.sent,r=l.status,c=l.data,data=void 0===c?{}:c,1e4===r.code&&(d=data.items.map((function(e){return{value:e.title}}))).length&&t(d);case 6:case"end":return e.stop()}}),e)})))()},handleFilterChange:function(e){this.loading||(this.$logEvent("log_actions",{operation:"click_select_params",behavior_info:"on_voice_select_pop",behavior_info_sub:e}),-1!==this.soundAttrSelectAll.indexOf(e)?this.soundAttrSelectAll.splice(this.soundAttrSelectAll.indexOf(e),1):this.soundAttrSelectAll.push(e),"recommend"===this.queryType&&(this.tagIndex="hot"),this.checkGetList())},handleFilterReset:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loading||(this.soundAttrSelectAll=[],this.filterQueryParams.list_a=[],this.filterQueryParams.list_b=[],this.filterQueryParams.styles=[],this.filterQueryParams.model_types=[],e||this.checkGetList())},getParamsForAttr:function(){this.filterQueryParams.list_a=[],this.filterQueryParams.list_b=[],this.filterQueryParams.styles=[],this.filterQueryParams.model_types=[];var e,t=tc(this.soundsTypeInfo);try{for(t.s();!(e=t.n()).done;){var n,o=e.value,l=tc(o.value);try{for(l.s();!(n=l.n()).done;){var r=n.value;this.soundAttrSelectAll.includes(r.value)&&!this.filterQueryParams[o.paramsKey].includes(r.value)&&this.filterQueryParams[o.paramsKey].push(r.value)}}catch(e){l.e(e)}finally{l.f()}}}catch(e){t.e(e)}finally{t.f()}return this.filterQueryParams},loginAndChangeQuery:function(e){this.$emit("newChat"),this.changeQueryType(e)},changeQueryType:function(e){var t=this;this.$logEvent("log_actions",{operation:{collect:"click_my_collect",myAudio:"click_my_vioce",comprehensive:"click_recommendation",recent:"click_recent_use",recommend:"click_more_recommendation"}[e],behavior_info:"on_voice_select_pop"}),"myAudio"!==e&&"collect"!==e||this.isLoggedIn?(this.list=[],this.hotRecentUsedList=[],this.pageInfo={page:1,page_size:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:""},this.checkGetList()):this.$EventBus.$emit("openLoginDialog",{callBack:function(){return t.loginAndChangeQuery(e)}})},checkGetList:function(){"comprehensive"!==this.queryType?"recent"===this.queryType?this.handleGetRecentUsed():this.handleSearch():this.handleGetComList()},handleGetComList:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,code,c,d,h,m,v,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("获取综合推荐",e.queryType),e.pageInfo.page=1,e.loading=!0,e.noMore=!1,e.loading=!0,{},n=e.getParamsForAttr(),t.prev=7,t.next=10,Object(W.F)(n);case 10:return o=t.sent,r=(l=o||{}).status.code,code=void 0===r?"":r,c=l.data,d=void 0===c?{}:c,[1e4,"10000"].includes(code)&&(h=Array.isArray(null==d?void 0:d.recently)?d.recently:[],e.noMore=!0,m=(h||[]).map((function(t){var n=(t||{}).nsfw;return[1,"1"].includes(void 0===n?0:n)&&(t.cover=e.nsfwUrl),t.timbre.cover=t.cover,t})),e.list="recent"===e.queryType?m.length<=10?m:m.slice(0,10):m,v=Array.isArray(null==d?void 0:d.items)&&"recent"!==e.queryType?d.items:[],f=e.list.map((function(e){return e.id})),e.hotRecentUsedList=(v||[]).filter((function(e){return!f.includes(e.id)})).map((function(t){var n=(t||{}).nsfw;[1,"1"].includes(void 0===n?0:n)&&(t.cover=e.nsfwUrl);var o=e.findSelectItem(t);return o&&(t=Object.assign(t,o)),t.timbre.cover=t.cover,t}))),t.abrupt("return",e.list);case 14:return t.prev=14,e.loading=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[7,,14,17]])})))()},setIcon:function(){var e=this,t="homeIcon1";return this.typeOption.forEach((function(n){e.tagIndex===n.id&&(t=n.icon)})),t},handleCommand:function(e){this.tagIndex=e,this.queryParam.order_by=this.tagIndex,this.handleSearch()},handleTimeCommand:function(e){this.timeName=e.name,this.queryParam.start_at=e.startTime,this.queryParam.end_at=e.endTime,this.handleSearch()},changeScroll:function(){var e=this;this.$refs.listItem.forEach((function(t,n){t.classList.contains("tab-active")&&(e.itemScroll={value:t.getBoundingClientRect().left,index:n})}))},getTag:function(){var e=this;Object(rn.a)({show_area:"timbre"}).then((function(t){if(1e4===t.status.code){var n=t.data||[],o=[];n.forEach((function(t){t.title=t[xe.l[e.$i18n.locale]],t.title&&o.push(t)})),console.log("resultArr",o),e.tabList=[].concat(Object(R.a)(e.tabList),o)}}))},changeType:function(e){this.list=[],this.pageInfo={page:1,page_size:60,total:0},this.handleSearch()},handleResize:function(){try{window.innerWidth>1400?(this.modalWidth="1286px",this.gridNum=3):(this.modalWidth="888px",this.gridNum=2)}catch(e){}},selectItem:function(e,t,n){var o,l;(t.model_ver_no=e.model_ver_id,t.version_name=e.version_no,t.base_model=e.base_model_name,t.modelTags=Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[],null!==(o=e.sample)&&void 0!==o&&null!==(o=o.banner)&&void 0!==o&&o.url)?t.banner.url=null===(l=e.sample)||void 0===l||null===(l=l.banner)||void 0===l?void 0:l.url:t.banner.url="";n&&this.$emit("selectModel",t)},openModal:function(){var e=this;if(this.resetData(),this.tabList=[{label:"我的",type:"mine",id:"mine",order:1,i18nKey:"Mine"}],this.activeTab="mine",this.queryType="comprehensive",this.getTag(),!this.token)return this.checkGetList(),void(this.visible=!0);this.$nextTick((function(){e.handleGetComList().finally((function(){e.loading=!1,e.list.length&&e.list.length>=10?(e.activeTab="mine",e.queryType="recent"):(e.activeTab="mine",e.queryType="comprehensive")})),e.visible=!0}))},handleClose:function(){this.visible=!1,this.resetData()},resetData:function(){this.pageInfo={page:1,page_size:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:""},this.activeTab="mine",this.queryType="comprehensive",this.loading=!1,this.noMore=!1,this.hotRecentUsedList=[],this.list=[],this.filterQueryParams.list_a=[],this.filterQueryParams.list_b=[],this.filterQueryParams.model_types=[],this.filterQueryParams.styles=[]},handleViewMore:function(){this.activeTab="",this.handleTabClick("mine","recommend")},handleTabClick:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.$logEvent("log_actions",{operation:"click_tab",behavior_info:"on_voice_select_pop",behavior_info_sub:e}),e===this.activeTab||this.loading||(this.activeTab=e,this.queryType="mine"===e?n||"comprehensive":"recommend",this.$nextTick((function(){t.changeScroll()})),this.list=[],this.hotRecentUsedList=[],this.pageInfo={page:1,page_size:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:""},this.checkGetList())},handleSearch:function(){if(this.$route.name.includes("AIAudioCreate")?this.$logEvent("log_actions",{operation:"click_search",behavior_info:"on_choose_audio_popup"}):this.$logEvent("log_actions",{operation:"click_search",behavior_info:"on_voice_select_pop"}),this.pageInfo.page=1,this.loading=!1,this.noMore=!1,this.list=[],"recent"===this.queryType)return this.queryType="recommend",void this.handleGetComList();"comprehensive"===this.queryType&&(this.queryType="recommend"),this.getList()},handleScroll:function(){var e=this.$refs.scrollWrapper;try{e&&e.scrollTop+e.clientHeight>=e.scrollHeight-30&&"recent"!==this.queryType&&this.getList(!0)}catch(e){}},getList:function(e){var t=this;if(console.log("getList"),!this.loading&&!this.noMore){this.loading=!0;var n={page:this.pageInfo.page,page_size:this.pageInfo.page_size};["mine"].includes(this.activeTab)||(n.tag=this.activeTab),Object.assign(n,this.queryParam,this.getParamsForAttr());var o=W.w;"myAudio"===this.queryType&&(o=W.t),"collect"===this.queryType&&(o=ue.b),this.queryParam.keyword&&(o=W.x),o(n).then((function(n){var o=n||{},l=o.status,r=void 0===l?{}:l,c=o.data,data=void 0===c?{}:c,d=r.code;if([1e4,"10000"].includes(void 0===d?"":d)){if(t.noMore=!data.has_more,e){var h=t.list.map((function(e){return e.id})),m=(n.data.items||[]).filter((function(e){return!h.includes(e.id)})).map((function(e){var n=(e||{}).nsfw;return[1,"1"].includes(void 0===n?0:n)&&(e.cover=t.nsfwUrl),e.timbre.cover=e.cover,e}));t.list=t.list.concat(m)}else t.list=(n.data.items||[]).map((function(e){var n=(e||{}).nsfw;return[1,"1"].includes(void 0===n?0:n)&&(e.cover=t.nsfwUrl),e.timbre.cover=e.cover,e}));1===t.pageInfo.page&&(t.queryParam.time_to=n.data.time_ms),t.pageInfo.page++}})).catch((function(e){console.log(e)})).finally((function(){t.loading=!1}))}},findSelectItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.activeSelectModel(e)){var t=this.selectList.find((function(t){return e.id===t.id}));return e=t||e}return null},handleSelect:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.$message.warning(this.$t("CannotSelectedRepeatedly")):this.$emit("selectModel",e)},handleGetRecentUsed:function(){this.pageInfo.page=1,this.loading=!0,this.noMore=!1,this.handleGetComList()},handleDetail:function(e){(null==e?void 0:e.id)&&window.open("/models/detail/".concat(e.id))}}},sc=oc;n(3124);function lc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function rc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lc(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var cc={components:{selectSoundModel:Object(y.a)(sc,(function(){var e,t,n=this,o=n._self._c;return o("el-dialog",{ref:"styleModal",attrs:{title:n.$t("audioSelect"),visible:n.visible,width:n.modalWidth,height:"auto","custom-class":"c-style-modal c-style-modal-sound","modal-append-to-body":!1,"append-to-body":!0,"close-on-click-modal":!1,center:""},on:{"update:visible":function(e){n.visible=e},close:function(e){return n.handleFilterReset(!0)}}},[o("div",{staticClass:"style-content-wrapper-sound"},[o("div",{staticClass:"style-content__header"},[o("swipeable-list",{attrs:{scrollChange:n.itemScroll,top:"22px"}},[o("div",{staticClass:"style-content__header-tabs-sound"},n._l(n.tabList,(function(e,t){return o("div",{key:e.type+t},[o("div",{ref:"listItem",refInFor:!0,staticClass:"style-content__header-tabs-item-sound",class:[n.activeTabClass(e.id)],on:{click:function(t){return t.stopPropagation(),n.handleTabClick(e.id)}}},[n._v("\n              "+n._s(n.convertTabText(e))+"\n            ")])])})),0)])],1),n._v(" "),o("div",{staticClass:"style-content__search-box style-content__search-box-sound"},[o("div",{staticClass:"flex-a-center"},[o("el-autocomplete",{staticClass:"style-content__search-input-sound",attrs:{"popper-append-to-body":!1,"popper-class":"autocomplete-popper",placeholder:n.$t("searchMoreSounds"),"trigger-on-focus":!1,clearable:"","fetch-suggestions":n.querySearchAsync},on:{clear:n.handleSearch,select:n.handleSearch},model:{value:n.queryParam.keyword,callback:function(e){n.$set(n.queryParam,"keyword",e)},expression:"queryParam.keyword"}},[o("template",{slot:"prefix"},[o("i",{staticClass:"iconfont icon-search search-icon-sound",on:{click:n.handleSearch}})])],2),n._v(" "),o("div",{staticClass:"style-content__search-btn style-content__search-btn-gra-border",on:{click:n.handleSearch}},[o("span",[n._v(n._s(n.$t("Search")))])])],1),n._v(" "),o("div",{staticClass:"search-right"},[o("el-popover",{attrs:{placement:"bottom","popper-class":"homeFilter",trigger:"click"},on:{show:function(e){n.showFilter=!0},hide:function(e){n.showFilter=!1}}},[o("div",{staticClass:"filterCnt"},[n._l(n.soundsTypeInfo,(function(e,t){return o("div",{key:t},[o("div",{staticClass:"filterTit",staticStyle:{"margin-top":"16px"}},[n._v("\n                "+n._s(n.$t(e.i18Key))+"\n              ")]),n._v(" "),o("div",{staticClass:"filterList"},n._l(e.value,(function(t,l){return o("div",{key:l,staticClass:"filterItem",class:{AfilterItem:n.soundAttrSelectAll.includes(e)},on:{click:function(e){return n.handleFilterChange(t.value)}}},[n.soundAttrSelectAll.includes(t.value)?o("i",{staticClass:"el-icon-check"}):n._e(),n._v(" "),o("span",[n._v(n._s(n.$t(t.i18Key)))])])})),0)])})),n._v(" "),o("div",{staticClass:"filterReset graBorder",on:{click:function(e){return n.handleFilterReset(!1)}}},[n._v("\n              "+n._s(n.$t("resetSelection"))+"\n            ")])],2),n._v(" "),o("el-badge",{staticClass:"item",attrs:{slot:"reference",value:null===(e=n.soundAttrSelectAll)||void 0===e?void 0:e.length,hidden:0===(null===(t=n.soundAttrSelectAll)||void 0===t?void 0:t.length)},slot:"reference"},[o("div",{staticClass:"filterBox",style:{borderColor:n.showFilter?"#409eff":"#293045"}},[o("div",[o("i",{staticClass:"iconfont icon-a-filterIcon"}),n._v(" "),o("span",[n._v(n._s(n.$t("Filter")))])]),n._v(" "),o("i",{staticClass:"el-icon-arrow-down"})])])],1),n._v(" "),"mine"===n.activeTab?o("el-select",{staticClass:"showType custom-select",class:n.$i18n.locale,attrs:{"popper-class":"custom-select"},on:{change:n.changeQueryType},model:{value:n.queryType,callback:function(e){n.queryType=e},expression:"queryType"}},n._l(n.queryOptionsList,(function(e){return o("el-option",{key:e.value,attrs:{label:n.$t(e.i18nKey),value:e.value}})})),1):n._e(),n._v(" "),["mine"].includes(n.activeTab)?n._e():o("div",{staticClass:"Screening"},[o("el-dropdown",{staticClass:"el-dropdown-sound",attrs:{trigger:"hover"},on:{command:n.handleTimeCommand}},[o("div",{staticClass:"el-dropdown-link selectTime"},[o("div",[o("i",{staticClass:"el-icon-time"}),n._v(" "),o("span",[n._v(n._s(n.$t(n.timeName)))])]),n._v(" "),o("i",{staticClass:"el-icon-arrow-down"})]),n._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},n._l(n.timeTypeOption,(function(e,t){return o("el-dropdown-item",{key:t,attrs:{command:e}},[o("div",{staticClass:"el-dropdown-item el-dropdown-item-time"},[o("span",[n._v(n._s(n.$t(e.name)))])])])})),1)],1),n._v(" "),o("el-dropdown",{staticClass:"el-dropdown-sound",attrs:{trigger:"hover"},on:{command:n.handleCommand}},[o("div",{staticClass:"el-dropdown-link"},[o("div",[o("i",{staticClass:"iconfont custom-iconfont",class:"icon-".concat(n.setIcon())}),n._v(" "),o("span",[n._v(n._s(n.$t(n.tagIndex.charAt(0).toUpperCase()+n.tagIndex.slice(1))))])]),n._v(" "),o("i",{staticClass:"el-icon-arrow-down"})]),n._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},n._l(n.typeOption,(function(e,t){return o("el-dropdown-item",{key:t,attrs:{command:e.id}},[o("div",{staticClass:"el-dropdown-item"},[o("i",{staticClass:"iconfont custom-iconfont",class:"icon-".concat(e.icon)}),n._v(" "),o("span",[n._v(n._s(n.$t(e.name)))])])])})),1)],1)],1)],1)]),n._v(" "),o("div",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],ref:"scrollWrapper",staticClass:"style-content__list-wrapper-sound",class:[n.isNoRecentUsed?"style-content__list-wrapper-no-margin":""],style:{gridTemplateColumns:"repeat(".concat(n.gridNum,", 1fr)")},on:{scroll:n.handleScroll}},[n.list.length?[n._l(n.list,(function(e){return o("AiChatSoundItem",{key:e.id,class:[n.activeSelectModel(e)],attrs:{item:e.timbre},on:{handleSelect:function(t){n.handleSelect(e,n.activeSelectModel(e))}}})})),n._v(" "),n.list.length>1&&n.list.length<9?n._l(9,(function(e){return o("div",{staticClass:"sound-item",attrs:{index:e}})})):n._e()]:n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.showRecommendText,expression:"showRecommendText"}],staticClass:"recommend-text",style:{gridColumn:"span ".concat(n.gridNum)}},[o("div",{staticClass:"recommend-text-line"}),n._v(" "),o("div",{staticClass:"recommend-text-main"},[n._v(n._s(n.$t("hotSoundsForYou")))]),n._v(" "),o("div",{staticClass:"recommend-text-line"})]),n._v(" "),!n.loading&&n.hotUsedList.length&&"mine"===n.activeTab&&["comprehensive"].includes(n.queryType)?[n._l(n.hotUsedList,(function(e){return o("AiChatSoundItem",{key:e.id,class:[n.activeSelectModel(e)],attrs:{item:e.timbre},on:{newChat:n.newChat,handleSelect:function(t){n.handleSelect(e,n.activeSelectModel(e))}}})})),n._v(" "),o("div",{staticClass:"show-more-item",style:{gridColumn:"span ".concat(n.gridNum)}},[o("span",{staticClass:"show-more-item-btn",on:{click:function(e){return e.stopPropagation(),n.handleViewMore()}}},[o("span",{staticClass:"show-more-item-btn-text"},[n._v(n._s(n.$t("viewMore")))]),n._v(" "),o("i",{staticClass:"iconfont icon-icon-direction-down show-more-item-btn-icon"})])])]:n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.showEmptyResult,expression:"showEmptyResult"}],staticClass:"style-content__list-empty"},[o("svg-icon",{staticClass:"style-content__list-empty-icon",attrs:{"icon-class":"style-empty-icon"}}),n._v(" "),"mine"===n.activeTab&&["recent"].includes(n.queryType)&&["",null,void 0].includes(n.queryParam.keyword)?[n._v("\n          "+n._s(n.$t("soundRecent"))+"\n        ")]:["collect"].includes(n.queryType)&&"mine"===n.activeTab&&["",null,void 0].includes(n.queryParam.keyword)?[n._v("\n          "+n._s(n.$t("soundCollect"))+"\n        ")]:[n._v(n._s(n.$t("NoResultsFound")))]],2)],2)])])}),[],!1,null,"18bdae1c",null).exports},props:["info","timbreObj"],data:function(){return{coins:[{name:"credit",icon:n(279),type:"calculateCoins",desc:"new_credit_desc"},{name:"stamina",icon:n(280),type:"tempCoins",desc:"new_stamina_desc"}]}},computed:rc(rc(rc(rc({},Object(S.c)("user",["isLoggedIn"])),Object(S.e)("payment",["paymentInfo"])),Object(S.e)("user",["userInfo"])),{},{showVoiceIcon:function(){var e,t,n=(null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.lang_code)||this.$i18n.locale;return["zhCN","zhTW","ja","en"].includes(n)&&1===(null===(t=this.info)||void 0===t?void 0:t.support_voice)}}),filters:{formatNumberForeign:k.i},methods:{newChat:function(){this.$emit("newChat")},selectModel:function(e){this.$emit("updateTimbreObj",e,"顶部更新音色"),this.$refs.selectSoundModel.handleClose()},handleSelectSound:function(){var e;this.$logEvent("log_actions",{operation:"vioce_select",behavior_info:"on_tarven_detail_page"}),this.$logEvent("log_actions",{operation:"voice_select_pop_show",behavior_info:"on_voice_select_pop"}),null===(e=this.$refs.selectSoundModel)||void 0===e||e.openModal()},toMall:function(e){var t=this;if(this.$logEvent("log_actions",{operation:"click_mall",behavior_info:"on_tavern_sidebar"}),this.isLoggedIn){var n=this.localePath("/mall");window.open(n+e,"_blank")}else this.$EventBus.$emit("openLoginDialog",{callBack:function(){return t.$emit("newChat")}})},openSetting:function(){this.$emit("openSetting"),this.$logEvent("log_actions",{operation:"click_sidebar",behavior_info:"on_chat_detail_page"})}}},dc=(n(3125),Object(y.a)(cc,(function(){var e,t,o,l=this,r=l._self._c;return r("div",{staticClass:"ai-chat-head"},[r("div",{staticClass:"info flex-center"},[l.showVoiceIcon?r("div",{staticClass:"voice-status",on:{click:l.handleSelectSound}},[l._m(0),l._v(" "),r("span",{staticClass:"tip"},[l._v(l._s((null===(e=l.timbreObj)||void 0===e?void 0:e.name)||l.$t("Pls_select")))]),l._v(" "),r("i",{staticClass:"el-icon-arrow-right"})]):l._e(),l._v(" "),r("div",{staticClass:"info-item vip-item",on:{click:function(e){return l.toMall("?dotFrom=on_tavern_sidebar")}}},[r("img",{attrs:{src:n(319),alt:""}})]),l._v(" "),r("div",{staticClass:"info-item info-set flex-center",on:{click:l.openSetting}},[r("i",{staticClass:"el-icon-more"})])]),l._v(" "),r("selectSoundModel",{ref:"selectSoundModel",attrs:{selectList:null!==(t=l.timbreObj)&&void 0!==t&&t.id?[null===(o=l.timbreObj)||void 0===o?void 0:o.id]:[]},on:{newChat:l.newChat,selectModel:l.selectModel}})],1)}),[function(){var e=this._self._c;return e("div",{staticClass:"voice-icon"},[e("i",{staticClass:"iconfont icon-icon-video1"})])}],!1,null,"e62fad76",null).exports),uc=n(126),hc={data:function(){return{isShowPopup:!1,loading:!1,submitEvent:null,session_id:""}},methods:{open:function(e,t){this.submitEvent=t,this.session_id=e,this.isShowPopup=!0},close:function(){this.isShowPopup=!1},submit:function(){var e=this;this.loading=!0,Object(uc.d)({id:this.session_id}).then((function(t){e.submitEvent&&e.submitEvent(t),e.$message.success(e.$t("deleteSuccess")),e.close()})).finally((function(){e.loading=!1}))}}},pc=(n(3126),{components:{DelChatPopup:Object(y.a)(hc,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"custom-dialog delchat-popup",attrs:{visible:e.isShowPopup,"append-to-body":!0,"before-close":e.close},on:{"update:visible":function(t){e.isShowPopup=t}}},[t("div",{staticClass:"popup-body"},[t("div",{staticClass:"title"},[t("i",{staticClass:"iconfont icon-Vector"}),e._v(e._s(e.$t("DelAiChatTitle"))+"\n    ")]),e._v(" "),t("div",{staticClass:"popup-desc"},[e._v("\n      "+e._s(e.$t("DelAiChatDesc1"))+"\n    ")])]),e._v(" "),t("div",{staticClass:"handle-btn",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"cancel-btn",attrs:{type:"default"},on:{click:e.close}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("el-button",{staticClass:"submit-btn",attrs:{type:"default",loading:e.loading},on:{click:e.submit}},[e._v(e._s(e.$t("Confirm")))])],1)])}),[],!1,null,"351052c3",null).exports},props:["value"],data:function(){return{loading:!1,list:[],isShowPopup:!1}},filters:{DateFormat:function(e){var t=new Date(e),n=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),l=t.getDate().toString().padStart(2,"0");return"".concat(n,"/").concat(o,"/").concat(l)},TimeFormat:function(e){var t=new Date(e);return t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")}},methods:{getLastChatList:function(){var e,t=this;this.loading=!0,Object(W.r)({page_size:100,with_latest_msg:1,character_id:null===(e=this.value)||void 0===e?void 0:e.id}).then((function(e){var n=(null==e?void 0:e.data).items;t.list=n||[]})).finally((function(){t.loading=!1}))},show:function(){this.getLastChatList(),this.isShowPopup=!0},close:function(){this.isShowPopup=!1},showDelChatPopup:function(e){var t=this,n=this.list[e].session_id;this.$refs.delChatPopup.open(n,(function(){t.delChatHandle(e)}))},delChatHandle:function(e){var t=this.$route.query.s_id,n=this.list[e].session_id;this.list.splice(e,1),n===t&&this.changeChat(this.list.length?0:-1,this.list)},changeChat:function(i,e){var t=this.$route.query.s_id,n=this.$route.params.id;if(i<0)this.$router.replace(this.localePath("/cyberPub/"+n));else{var o=e[i].session_id;o!==t&&(this.$router.replace(this.localePath({path:"/aiChat/"+n,query:{s_id:o}})),this.close())}}}}),mc=(n(3127),Object(y.a)(pc,(function(){var e,t=this,n=t._self._c;return n("el-dialog",{staticClass:"custom-dialog allchat-popup",attrs:{"modal-append-to-body":!1,"append-to-body":"",visible:t.isShowPopup,title:t.$t("AllChatTitle",{name:null===(e=t.value)||void 0===e?void 0:e.name})},on:{"update:visible":function(e){t.isShowPopup=e}}},[n("div",{staticClass:"popup-body"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"aichat-list hide-scrollbar"},t._l(t.list,(function(e,i){var o,l,r;return n("div",{key:e.session_id,staticClass:"aichat-item",class:{"aichat-item-active":e.session_id===(null===(o=t.$route.query)||void 0===o?void 0:o.s_id)}},[n("div",{staticClass:"aichat-head",style:{backgroundImage:"url(".concat(null===(l=t.value)||void 0===l||null===(l=l.cover)||void 0===l?void 0:l.url,")")},on:{click:function(e){return t.changeChat(i,t.list)}}}),t._v(" "),n("div",{staticClass:"aichat-info"},[n("p",{staticClass:"info-name",on:{click:function(e){return t.changeChat(i,t.list)}}},[t._v("\n            "+t._s(null===(r=t.value)||void 0===r?void 0:r.name)+"\n          ")]),t._v(" "),e.session_title?n("p",{staticClass:"info-date"},[t._v(t._s(e.session_title))]):[n("p",{staticClass:"info-date"},[t._v(t._s(t._f("DateFormat")(e.create_at)))]),t._v(" "),n("p",{staticClass:"info-time"},[t._v(t._s(t._f("TimeFormat")(e.create_at)))])],t._v(" "),n("p",{staticClass:"info-del"},[n("i",{staticClass:"el-icon-delete",on:{click:function(e){return t.showDelChatPopup(i)}}})])],2)])})),0),t._v(" "),n("del-chat-popup",{ref:"delChatPopup"})],1)])}),[],!1,null,"90cf694a",null).exports),vc={props:["aiChatId"],name:"AiChatReport",data:function(){return{isShowPopup:!1,remark:"",loading:!1,step:1}},methods:{report:function(e){""!==e?(this.remark=this.$t("AiChatReport"+e),this.submit()):this.step=2},open:function(){this.isShowPopup=!0},close:function(){var e=this;this.isShowPopup=!1,setTimeout((function(){e.step=1,e.remark="",e.loading=!1}),300)},submit:function(){var e=this;this.$logEvent("log_actions",{operation:"report_submit",behavior_info:this.remark}),this.loading=!0,Object(W.G)({id:this.aiChatId,remark:this.remark}).then((function(t){e.step=3})).finally((function(){e.loading=!1}))}}},gc=(n(3128),Object(y.a)(vc,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"custom-dialog aichat-report",attrs:{visible:e.isShowPopup,title:e.$t("Report"),"before-close":e.close,"append-to-body":!0},on:{"update:visible":function(t){e.isShowPopup=t}}},[t("div",{staticClass:"report-body"},[1===e.step?t("div",{staticClass:"report-reason"},[t("p",{staticClass:"title"},[e._v(e._s(e.$t("AiChatReportTitle1")))]),e._v(" "),t("div",{staticClass:"reason-list"},[e._l(6,(function(n){return t("p",{key:"reason_"+n,on:{click:function(t){return e.report(n)}}},[e._v(e._s(e.$t("AiChatReport"+n)))])})),e._v(" "),t("p",{on:{click:function(t){return e.report("")}}},[e._v(e._s(e.$t("other")))])],2)]):2===e.step?t("div",{staticClass:"report-remark"},[t("p",{staticClass:"title"},[e._v(e._s(e.$t("AiChatReportTitle2")))]),e._v(" "),t("el-input",{attrs:{type:"textarea",autosize:{minRows:5,maxRows:7}},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1):3===e.step?t("div",{staticClass:"report-result"},[t("img",{attrs:{src:n(472),alt:""}}),e._v(" "),t("p",{staticClass:"result-text"},[e._v(e._s(e.$t("AiChatReportResult1")))]),e._v(" "),t("p",{staticClass:"result-tips"},[e._v(e._s(e.$t("AiChatReportResult2")))])]):e._e()]),e._v(" "),2===e.step?t("div",{staticClass:"handle-btn",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"cancel-btn",attrs:{type:"default"},on:{click:e.close}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("el-button",{staticClass:"submit-btn",attrs:{type:"default",loading:e.loading},on:{click:e.submit}},[e._v(e._s(e.$t("Submit")))])],1):e._e()])}),[],!1,null,"56e278d9",null).exports);function fc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fc(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bc={components:{STooltip:n(189).a},props:["value","info","timbreObj","isShowSetting"],data:function(){return{isShowHandle:!1,menuList:[{title:"FullScreen",key:"full_screen",off:!0},{title:"HideBack",key:"hide_bg",off:!0},{title:"enableMemory",key:"enable_memory",off:!0,isHide:!1},{title:"chatModelResponse",key:"enable_stream_chat",off:!0,isHide:!1},{title:"StartNewChat",icon:"icon-a-icon_newchat",key:"NewChat"},{title:"ResetChat",icon:"icon-a-icon_restartchat",key:"ResetChat"},{title:"Share",icon:"icon-icon_share",key:"Share",isHide:!1},{title:"AllChat",icon:"icon-a-icon_allchat",key:"AllChat"},{title:"Report",key:"Report",icon:"icon-icon_report"}],modeList:[{name:"AdvancedMode",value:"GPT-4-Turbo-1106",tips:this.$t("AdvancedModeTips"),logName:"Immersive"},{name:"freelyChat",value:"GPT-35-Turbo-1106",tips:this.$t("UniversalModeTips"),logName:"chat"},{name:"OvervalueMode",value:"Normal",tips:this.$t("OvervalueModeTips"),logName:"value"}],modeIndex:1,isShowModeHandle:!1}},computed:_c(_c(_c({},Object(S.c)("user",["isLoggedIn"])),Object(S.e)("user",["cdnHost","userInfo"])),{},{list:function(){var e=this.menuList,t=this.info.publish_status;return e[6].isHide=2===t,e}}),mounted:function(){this.initModeIndex()},methods:_c(_c({},Object(S.d)("user",["SET_USER_INFO"])),{},{handleChangeModel:function(){var e=this;this.isLoggedIn?this.isShowModeHandle=!this.isShowModeHandle:this.$EventBus.$emit("openLoginDialog",{callBack:function(){return e.$emit("newChat")}})},compareTimestamp:function(e){return Date.now()-e>864e5?"long_memory_chat_old":"long_memory_chat_new"},switchChange:function(e,t){var n=this;if(this.isLoggedIn){if("enable_memory"===t){var o,l=null===(o=this.userInfo)||void 0===o?void 0:o.create_at;this.$logEvent("log_actions",{operation:this.compareTimestamp(l),behavior_info:"on_tarven_detail_page",behavior_info_sub:1===e?"open":"close"})}var r={};r[t]=e,Object(W.I)(r).then((function(o){var l;if(1e4===(null===(l=o.status)||void 0===l?void 0:l.code)){var r=JSON.parse(JSON.stringify(n.userInfo));r.character_setting[t]=e,n.SET_USER_INFO(r)}}))}},closePopup:function(){this.$emit("handle",{key:"Close",value:""})},initModeIndex:function(){if(this.isLoggedIn){var e=JSON.parse(localStorage.getItem("userInfo")).character_setting.gpt_model,t=this.modeList.findIndex((function(t){return t.value===e}));this.modeIndex=t>-1?t:1}},hideHandle:function(){this.isShowHandle&&(this.isShowHandle=!1)},hideModeHandle:function(){this.isShowModeHandle&&(this.isShowModeHandle=!1)},chooseMode:function(e,t){this.$logEvent("log_actions",{operation:"choose_".concat(e.logName,"_mode"),behavior_info:"on_tarven_detail_page"}),this.modeIndex=t,this.isShowModeHandle=!1,this.$emit("handle",{key:"gpt_model",value:e.value})},chooseLanguage:function(e){this.isShowHandle=!1,localStorage.setItem("translate_language",e),this.$emit("handle",{key:"Language",value:e})},openModal:function(){this.$emit("handle",{key:"Setting"})},handle:function(e,t){var n=this;if(this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"click_button_on_corner",behavior_info_sub:t}),this.isLoggedIn||["Share","HideBack","FullScreen","enableMemory","chatModelResponse"].includes(this.list[e].title)){var o=this.menuList[e];!t&&o.off||this.value.loading!==o.key&&(t||(this.isShowHandle=!1),this.$emit("handle",o))}else this.$EventBus.$emit("openLoginDialog",{callBack:function(){return n.$emit("newChat")}})}})},yc=(n(3129),Object(y.a)(bc,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"aichat-set"},[t("i",{staticClass:"el-icon-close",on:{click:e.closePopup}}),e._v(" "),t("div",{staticClass:"info flex-center"},[t("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.hideModeHandle,expression:"hideModeHandle"}],staticClass:"info-item asset-item"},[t("span",{staticClass:"mode-item",on:{click:e.handleChangeModel}},[e._v("\n        "+e._s(e.$t(e.modeList[e.modeIndex].name))+" "),t("i",{staticClass:"el-icon-arrow-down",class:{"icon-active":e.isShowModeHandle}})]),e._v(" "),e.isShowModeHandle?t("div",{staticClass:"handle-menu handle-menu-mode"},[t("div",{staticClass:"menu-list"},e._l(e.modeList,(function(n,o){return t("div",{key:n.name,staticClass:"menu-item flex-between",class:{"menu-item-active":e.modeIndex===o},on:{click:function(t){return e.chooseMode(n,o)}}},[t("div",[t("span",{staticClass:"menu-item-text"},[e._v(e._s(e.$t(n.name)))]),e._v(" "),"GPT-4-Turbo-1106"===n.value?t("div",{staticClass:"new-img"},[e._v("\n                New\n              ")]):e._e()]),e._v(" "),e.modeIndex===o?t("span",{staticClass:"iconfont icon-gou"}):e._e()])})),0)]):e._e()]),e._v(" "),t("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.hideHandle,expression:"hideHandle"}],staticClass:"info-item handle-item"},[t("span",{staticClass:"handle-icon",on:{click:function(t){e.isShowHandle=!e.isShowHandle}}},[e._v("...")]),e._v(" "),e.isShowHandle?t("div",{staticClass:"handle-menu"},[t("div",{staticClass:"menu-list"},e._l(e.list,(function(n,i){return t("div",{directives:[{name:"show",rawName:"v-show",value:!n.isHide&&"full_screen"!==n.key,expression:"!m.isHide && m.key !== 'full_screen'"}],key:n.title,staticClass:"menu-item flex-between",class:{"last-menu-item":i===e.list.length-1}},[t("div",{on:{click:function(t){return e.handle(i,"")}}},[n.icon?t("i",{class:"iconfont ".concat(n.icon)}):e._e(),e._v(" "),t("span",[e._v(e._s(e.$t(n.title)))]),e._v(" "),n.tips?t("s-tooltip",{attrs:{info:n.tips,icon:"el-icon-info"}}):e._e()],1),e._v(" "),!["enable_memory","enable_stream_chat"].includes(n.key)&&n.off?t("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:function(t){return e.handle(i,"change")}},model:{value:e.value[n.key],callback:function(t){e.$set(e.value,n.key,t)},expression:"value[m.key]"}}):e._e(),e._v(" "),"enable_memory"===n.key&&n.off?t("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:function(t){return e.switchChange(t,"enable_memory")}},model:{value:e.value.enable_memory,callback:function(t){e.$set(e.value,"enable_memory",t)},expression:"value.enable_memory"}}):e._e(),e._v(" "),"enable_stream_chat"===n.key&&n.off?t("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:function(t){return e.switchChange(t,"enable_stream_chat")}},model:{value:e.value.enable_stream_chat,callback:function(t){e.$set(e.value,"enable_stream_chat",t)},expression:"value.enable_stream_chat"}}):t("i",{directives:[{name:"show",rawName:"v-show",value:e.value.loading===n.key,expression:"value.loading === m.key"}],staticClass:"el-icon-loading"})],1)})),0)]):e._e()])])])}),[],!1,null,"8862dfe2",null).exports),wc={data:function(){return{isShowPopup:!1,loading:!1,submitEvent:null}},methods:{open:function(e){console.log("open reset ai chat dialog"),this.submitEvent=e,this.isShowPopup=!0},close:function(){this.isShowPopup=!1},submit:function(){var e=this;this.loading=!0,this.submitEvent&&this.submitEvent((function(t){e.loading=!1,t&&e.close()}))}}};n(3130);function Cc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function kc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cc(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Sc={beforeRouteEnter:function(e,t,n){n((function(e){e.historyStack.push(t.fullPath)}))},beforeRouteLeave:function(e,t,n){this.historyStack=this.historyStack.filter((function(path){return path!==t.fullPath})),n()},name:"aiChat",components:{AiChatHead:dc,AiChatFigure:qr,AiChatBody:Wr,AllChatPopup:mc,AiChatReport:gc,ResetChatPopup:Object(y.a)(wc,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"custom-dialog big-head-dialog allchat-popup reset-chat-popup",attrs:{visible:e.isShowPopup,"modal-append-to-body":!1,"append-to-body":""},on:{"update:visible":function(t){e.isShowPopup=t}}},[t("div",{staticClass:"popup-body"},[t("div",{staticClass:"title"},[e._v(e._s(e.$t("ResetAiChatTitle")))]),e._v(" "),t("i",{staticClass:"el-icon-close",on:{click:e.close}}),e._v(" "),t("div",{staticClass:"aichat-reset"},[e._v("\n      "+e._s(e.$t("ResetAiChatDesc"))+"\n    ")])]),e._v(" "),t("div",{staticClass:"handle-btn",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"cancel-btn",attrs:{type:"default"},on:{click:e.close}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("el-button",{staticClass:"submit-btn",attrs:{type:"default",loading:e.loading},on:{click:e.submit}},[e._v(e._s(e.$t("ResetChat")))])],1)])}),[],!1,null,"140dab1c",null).exports,AiChatSetting:yc,CommentDrawer:n(345).a},data:function(){return{showOverlay:!1,characterCode:1e4,loading:!1,aiChatId:"",aiChatSessionId:null,useCard:{},isShowFree:!1,timbreObj:{},historyStack:[],layout:"center",characterInfo:{},imgReady:!1,handleConfig:{hide_bg:2,full_screen:1,style:"center",gpt_model:"GPT-35-Turbo-1106",Lang:"",loading:"",enable_memory:2,enable_stream_chat:1}}},computed:kc(kc(kc(kc({},Object(S.c)("user",["isCompanyAccount","isLoggedIn"])),Object(S.e)("user",["userInfo"])),Object(S.e)("payment",["paymentInfo"])),{},{bgImg:function(){var e,t,n=(null===(e=this.characterInfo)||void 0===e?void 0:e.vision)||{},o=n.bg,l=n.character;return(null==o?void 0:o.url)||(null==l?void 0:l.url)||(null===(t=this.characterInfo)||void 0===t||null===(t=t.cover)||void 0===t?void 0:t.url)||"https://image.cdn2.seaart.ai/static/upload/20231211/af3b8892-05bf-4823-a304-9f8de1231b47.webp'"},figureImg:function(){var e,t,n=(null===(e=this.characterInfo)||void 0===e?void 0:e.vision)||{},o=n.bg,l=n.character;return(null==l?void 0:l.url)||(null==o?void 0:o.url)||(null===(t=this.characterInfo)||void 0===t||null===(t=t.cover)||void 0===t?void 0:t.url)||"https://image.cdn2.seaart.ai/static/upload/20231211/af3b8892-05bf-4823-a304-9f8de1231b47.webp"},isDim:function(){var e,t=(null===(e=this.characterInfo)||void 0===e?void 0:e.vision)||{},n=t.bg,o=t.character;return!(null!=o&&o.url&&null!=n&&n.url)},isShowFigure:function(){var e=this.handleConfig,t=e.hide_bg;e.full_screen;return this.imgLoad&&1!==t},isVip:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)},characterSetting:function(){var e;return(null===(e=this.userInfo)||void 0===e?void 0:e.character_setting)||{}}}),watch:{characterSetting:{handler:function(e){var t=this;e&&"{}"!==JSON.stringify(e)&&this.$nextTick((function(){t.handleConfig.full_screen=e.full_screen||1,t.handleConfig.hide_bg=e.hide_bg||2,t.handleConfig.style=e.style||"center",t.layout=t.handleConfig.style,t.handleConfig.enable_memory=e.enable_memory||2,t.handleConfig.enable_stream_chat=e.enable_stream_chat||1,e.gpt_model?t.handleConfig.gpt_model=e.gpt_model:t.setModel("GPT-35-Turbo-1106"),t.handleConfig.Lang=localStorage.getItem("translate_language")||t.$i18n.locale}))},immediate:!0,deep:!0}},mounted:function(){var e=this;this.chatPermission(),this.$EventBus.$on("createChat",this.createChat),this.$EventBus.$on("updateCurrentCard",this.updateCurrentCard),this.$EventBus.$on("updateSession",this.updateSession),this.$EventBus.$on("refreshData",(function(t){e.getAiChatInfoDetails(t,!0)})),this.aiChatId=localStorage.getItem("aiChatId_general")||"",console.log("mounted!!!")},beforeDestroy:function(){this.$EventBus.$off("createChat",this.createChat),this.$EventBus.$off("updateSession",this.updateSession),this.$EventBus.$off("updateCurrentCard"),this.$EventBus.$off("refreshData",this.getAiChatInfoDetails),this.aiChatId&&localStorage.setItem("aiChatId_general",this.aiChatId)},methods:kc(kc({},Object(S.d)("user",["SET_USER_INFO"])),{},{hideOverlayModal:function(){this.showOverlay=!1,this.$EventBus.$emit("openCombinedSelectDialog")},checkStatus:function(){if(1e4===this.characterCode)return!1;switch(this.characterCode){case 10610:this.showOverlay=!0;break;case 10621:this.$message({type:"warning",message:this.$t("chatFail"),duration:5e3,offset:100});break;default:console.warn("Unhandled character code: ".concat(this.characterCode))}return!0},updateCurrentCard:function(data){this.useCard=data},compareTimestamp:function(e){return Date.now()-e>864e5?"long_memory_chat_old":"long_memory_chat_new"},enableMemoryChange:function(e){var t,n=this;if(this.handleConfig.enableMemory=e,this.isLoggedIn){var o=null===(t=this.userInfo)||void 0===t?void 0:t.create_at;this.$logEvent("log_actions",{operation:this.compareTimestamp(o),behavior_info:"on_tarven_detail_page",behavior_info_sub:1===e?"open":"close"}),Object(W.I)({enable_memory:e}).then((function(t){var o;if(1e4===(null===(o=t.status)||void 0===o?void 0:o.code)){var l=JSON.parse(JSON.stringify(n.userInfo));l.character_setting.enable_memory=e,console.log("更新用户信息",l.character_setting.enable_memory),n.SET_USER_INFO(l)}}))}},updateSession:function(e){if(!this.checkStatus()){var t=e.character_id,n=e.session_id;this.aiChatId=t,this.$refs.chatBody.contentQueue=[],this.aiChatSessionId=n,this.getAiChatInfoDetails(this.aiChatId)}},layOutChange:function(e){this.changeCharacterSetting("style",e)},getVoiceDetail:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"+"!==(null===(n=e.characterInfo)||void 0===n?void 0:n.timbre_id)&&null!==(o=e.characterInfo)&&void 0!==o&&o.timbre_id){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=5,Object(W.v)({id:null===(l=e.characterInfo)||void 0===l?void 0:l.timbre_id});case 5:1e4===(r=t.sent).status.code&&(e.timbreObj=r.data),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.log("err",t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},reportView:function(e){Object(de.g)({items:[{action:"view",obj_no:e,obj_type:9}]})},updateTimbreObj:function(e,source){var t;if(console.log("聊天页更新会话的音色",e.timbre,source),(null===(t=this.timbreObj)||void 0===t?void 0:t.id)===e.id)return!1;this.timbreObj=e.timbre,this.characterInfo.timbre_id=this.timbreObj.id||this.characterInfo.timbre_id,this.bindVoiceToSeeion()},chatPermission:function(){location.origin.includes(".me")&&this.$router.replace(this.localePath("/"))},imgLoad:function(){this.imgReady=!0},startChat:function(){var e=this;this.aiChatSessionId&&this.$EventBus.$emit("updateAiChatSessionId",this.aiChatSessionId),this.aiChatSessionId&&Object(W.L)({session_id:this.aiChatSessionId,dft_timbre_id:this.characterInfo.timbre_id}).then((function(t){var n=t.data,o=n.timbre,l=void 0===o?null:o,r=n.isFree,c=void 0!==r&&r,d=n.card,h=void 0===d?{}:d;e.timbreObj=l,e.characterInfo.timbre_id=l.id||e.characterInfo.timbre_id,e.isShowFree=c,e.useCard=h}))},updateCard:function(e){console.log("更新当前的使用资料卡信息",e),this.useCard=e},bindVoiceToSeeion:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoggedIn){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,Object(W.J)({session_id:e.aiChatSessionId,timbre_id:e.timbreObj.id});case 5:t.next=9;break;case 7:t.prev=7,t.t0=t.catch(2);case 9:case"end":return t.stop()}}),t,null,[[2,7]])})))()},handle:function(e){var t=e.key;if(["hide_bg","Close","Share","AllChat","full_screen"].includes(t)||this.isLoggedIn)switch(t){case"full_screen":this.fullScreen(!1);break;case"hide_bg":this.fullScreen(!0);break;case"NewChat":if(!this.isLoggedIn)return void this.$EventBus.$emit("openLoginDialog",{redirect:this.$route.fullPath});this.createChat();break;case"ResetChat":this.openResetPopup();break;case"Share":this.shareAiChat();break;case"AllChat":this.showAllChatPopup();break;case"Report":this.showReport();break;case"gpt_model":this.setModel(e.value);break;case"chooseLanguage":this.setLanguage(e.value);break;case"Setting":this.openSetting();break;case"Close":this.closeSetModal()}else this.$EventBus.$emit("openLoginDialog")},closeSetModal:function(){this.$refs.commentDrawer.handleClose()},fullScreen:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e.length>0&&void 0!==e[0]&&e[0])){n.next=6;break}return n.next=4,t.changeCharacterSetting("hide_bg","",!0);case 4:n.next=8;break;case 6:return n.next=8,t.changeCharacterSetting("full_screen","",!1);case 8:case"end":return n.stop()}}),n)})))()},shareAiChat:function(){var e=location.host+this.localePath("/cyberPub/".concat(this.aiChatId));Object(k.d)(e+"/cyberPub/".concat(this.aiChatId)),this.$message.success(this.$t("CopiedURLToClipboard"))},openResetPopup:function(){this.$refs.resetChatPopup.open(this.resetChat)},resetChat:function(e){var t=this;this.handleConfig.loading="ResetChat",localStorage.removeItem("translate_".concat(this.aiChatSessionId)),Object(W.H)({session_id:this.aiChatSessionId}).then((function(n){t.closeSetModal(),e&&e(n),t.$refs.chatBody.initLoadMsg("resetChat")})).catch((function(t){e&&e("")})).finally((function(){t.handleConfig.loading=""}))},createChat:function(){var e=this;console.log("创建聊天！！"),this.$refs.chatBody&&(this.$refs.chatBody.contentQueue=[]),this.isLoggedIn&&(this.handleConfig.loading="NewChat",Object(W.g)({character_id:this.aiChatId,mask:""}).then((function(t){var n=t.data,o=n.session_id,l=void 0===o?"":o,r=n.create_at,c=void 0===r?"":r;(e.aiChatSessionId=l,e.startChat(),e.characterInfo.latest_session&&e.characterInfo.latest_session.length)?!e.characterInfo.latest_session.find((function(e){return e.session_id===l}))&&e.characterInfo.latest_session.unshift({session_id:l,create_at:c,name:""}):e.characterInfo.latest_session=[{session_id:l,create_at:c,name:""}]})).finally((function(){e.handleConfig.loading=""})))},setModel:function(e){var t=this;Object(W.I)({gpt_model:e}).then((function(n){var o=JSON.parse(JSON.stringify(t.userInfo));o.character_setting.gpt_model=e,t.SET_USER_INFO(o)}))},changeCharacterSetting:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l=e.length>1&&void 0!==e[1]?e[1]:"",r=e.length>2&&void 0!==e[2]&&e[2],"style"!==(o=e.length>0&&void 0!==e[0]?e[0]:"")||!l||t.isLoggedIn){n.next=6;break}return t.layout=l,n.abrupt("return");case 6:if((c=Object(X.cloneDeep)(t.userInfo)).character_setting[o]=l||(2===c.character_setting[o]||0===c.character_setting[o]?1:2),o&&Object.keys(t.characterSetting).includes(o)&&Object.keys(t.handleConfig).includes(o)){n.next=10;break}return n.abrupt("return");case 10:if((d={})[o]=null==c?void 0:c.character_setting[o],r&&1===c.character_setting.hide_bg&&(t.handleConfig.full_screen=1,d.full_screen=1),r||(t.handleConfig.hide_bg=2,d.hide_bg=2),t.isLoggedIn){n.next=16;break}return n.abrupt("return");case 16:return"style"===o&&(d[o]=l),t.SET_USER_INFO(c),console.log("params",d),n.prev=19,n.next=22,Object(W.I)(d);case 22:n.next=27;break;case 24:n.prev=24,n.t0=n.catch(19),console.log(n.t0);case 27:case"end":return n.stop()}}),n,null,[[19,24]])})))()},showAllChatPopup:function(){this.$refs.allChatPopup.show()},showReport:function(){this.$refs.aiChatReport.open()},getAiChatInfoDetails:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("获取数字人详情",t,n),this.aiChatSessionId=n?"":this.aiChatSessionId,this.aiChatId=t||this.aiChatId,t||(t=this.aiChatId),t?(this.imgReady=!1,this.loading=!0,this.characterInfo={},this.showOverlay=!1,Object(W.q)({id:t}).then((function(n){var o,l;if(e.characterCode=(null===(o=n.status)||void 0===o?void 0:o.code)||1e4,1e4===(null===(l=n.status)||void 0===l?void 0:l.code)){n.data&&(e.characterInfo=n.data||{},e.$set(e,"characterInfo",n.data||{})),e.$EventBus.$emit("updateCharacterInfo",e.characterInfo);var r=(e.characterInfo||{}).latest_session,c=void 0===r?null:r;c&&c.length&&!e.aiChatSessionId?(console.log("详情接口获取的latest_session",c),e.aiChatSessionId=c[0].session_id,e.startChat()):(e.aiChatSessionId&&e.startChat(),!e.aiChatSessionId&&e.createChat()),e.getVoiceDetail(),e.reportView(t)}else e.checkStatus()})).finally((function(){e.loading=!1}))):console.error("id不能为空")},setLanguage:function(e){this.handleConfig.Lang=e},handleUpdateCountNum:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.characterInfo=Object.assign({},this.characterInfo,e),this.$EventBus.$emit("updateCharacterInfo",this.characterInfo)},openSetting:function(){this.$refs.commentDrawer&&this.$refs.commentDrawer.openModal(this.characterInfo)}})},xc=Sc,Ic=(n(3131),Object(y.a)(xc,(function(){var e,t=this,o=t._self._c;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"ai-chat-page",class:{hideback:1===t.handleConfig.hide_bg,"dim-bg":t.isDim,"full-page":1===t.handleConfig.full_screen}},[t.showOverlay?o("div",{staticClass:"overlay"},[o("div",{staticClass:"modal"},[o("img",{staticClass:"null-image",attrs:{src:n(327),alt:"null_image"}}),t._v(" "),o("p",[t._v(t._s(t.$t("bannedTipCharter")))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.hideOverlayModal}},[t._v(t._s(t.$t("Back")))])],1)]):t._e(),t._v(" "),o("div",{staticClass:"bg",style:{backgroundImage:"url(".concat(t.bgImg,")")}}),t._v(" "),o("div",{staticClass:"ai-chat-main ai-chat-center"},[o("ai-chat-head",{attrs:{info:t.characterInfo,timbreObj:t.timbreObj},on:{newChat:t.createChat,openSetting:t.openSetting,updateTimbreObj:t.updateTimbreObj}}),t._v(" "),null!==(e=t.characterInfo)&&void 0!==e&&e.id?o("div",{staticClass:"ai-chat-content"},[o("ai-chat-body",{ref:"chatBody",attrs:{useCard:t.useCard,handleConfig:t.handleConfig,sessionId:t.aiChatSessionId,info:t.characterInfo,isShowFree:t.isShowFree},on:{newChat:t.createChat,layOutChange:t.layOutChange,updateTimbreObj:t.updateTimbreObj}}),t._v(" "),o("ai-chat-figure",{class:{"show-img":t.isShowFigure},attrs:{url:t.figureImg},on:{imgLoad:t.imgLoad}})],1):t._e()],1),t._v(" "),o("all-chat-popup",{ref:"allChatPopup",model:{value:t.characterInfo,callback:function(e){t.characterInfo=e},expression:"characterInfo"}}),t._v(" "),o("ai-chat-report",{ref:"aiChatReport",attrs:{aiChatId:t.aiChatId}}),t._v(" "),o("reset-chat-popup",{ref:"resetChatPopup",attrs:{aiChatId:t.aiChatId}}),t._v(" "),o("CommentDrawer",{ref:"commentDrawer",attrs:{characterId:t.aiChatId,isShowSetting:""},on:{newChat:t.createChat,updateCountNum:t.handleUpdateCountNum},scopedSlots:t._u([{key:"Settings",fn:function(){return[o("AiChatSetting",{attrs:{info:t.characterInfo,timbreObj:t.timbreObj,isShowSetting:!0},on:{newChat:t.createChat,handle:t.handle,updateTimbreObj:t.updateTimbreObj},model:{value:t.handleConfig,callback:function(e){t.handleConfig=e},expression:"handleConfig"}})]},proxy:!0}])})],1)}),[],!1,null,"3c8b8382",null).exports),Oc=(n(113),n(97)),Tc=(n(3231),n(3232),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(312),n(313),n(338));n(105);function $c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Lc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$c(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pc="",Mc={components:{LenovoPanel:Tc.a},inject:["CombinedSelectionDialog"],data:function(){return{is_preset:"",modelGenerate:null,keyIndex:-1,keyword:"",isFocus:!1,showMockBox:!1,searchNoDataImg:n(398),debounceGetRelatedList:Object(wo.a)(this.getRelatedList,500),associateList:[],searchPlaceholder:{model:"searchModelPlaceHolder",fast_app:"searchWorkflowAppPlaceHolder",character:"searchCharacterPlaceHolder",collect:"Search",mine:"Search"}}},computed:{isShowLeftStyle:function(){return this.CombinedSelectionDialog.isUseTagFilter},code:function(){var e;return(null===(e=this.CombinedSelectionDialog.curPage)||void 0===e?void 0:e.code)||""},placeHolder:function(){return this.searchPlaceholder[this.code]||"Search"},showAssociate:function(){return this.isFocus&&this.keyword},searchType:function(){return xe.q[this.code]}},mounted:function(){},methods:{resetSearch:function(){this.keyword=""},handleSearch:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.keyword,o=this.searchType;console.log("handleSearch--",n,o),this.$nextTick((function(){e.$refs.inputRef.blur()})),this.$emit("search",t||n)},searchLog:function(e){this.$logEvent("log_actions",{operation:"type_search",behavior_info:{1:"work",2:"model",6:"tag",8:"user",7:"post",13:"workFlow",14:"swtftApp",11:"designTemplate",9:"tavern"}[e]||"work"})},inputText:function(e){e&&this.debounceGetRelatedList(e)},onKeydown:function(){var e=this.associateList[this.keyIndex];e?this.handAssoriateItem(e):this.handleSearch()},onKeyWordUp:function(){var e=document.querySelector("#associateListId"),t=this.associateList.length;t&&(this.keyIndex--,this.keyIndex<=0&&(this.keyIndex=0),this.associateList.forEach((function(e){e.active=!1})),this.associateList[this.keyIndex].active=!0,this.keyIndex<t-4&&(e.scrollTop-=150))},onKeyWordDown:function(){var e=document.querySelector("#associateListId"),t=this.associateList.length-1;this.associateList.length&&(this.keyIndex++,this.keyIndex>=t&&(this.keyIndex=t),this.associateList.forEach((function(e){e.active=!1})),this.associateList[this.keyIndex].active=!0,this.keyIndex>4&&(e.scrollTop+=150))},onFocusFn:function(){this.isFocus=!0,this.showMockBox=!0,Pc=this.keyword,this.keyword&&this.debounceGetRelatedList()},onBlurFn:function(){var e=this;this.isFocus=!1,setTimeout((function(){e.showMockBox=!1}),200)},clearText:function(){var e=this;this.keyword="",this.associateList=[],this.$nextTick((function(){e.$refs.inputRef&&e.$refs.inputRef.focus()})),this.handleSearch()},handMaskBox:function(){this.keyword=Pc,console.log(this.keyword)},beforeUpload:function(e){return!!["image/jpeg","image/png","image/jpg","image/webp"].includes(e.type)||(this.$message.error(this.$t("AllowImageFiles")),!1)},handAssoriateItem:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("点击联想记录--",e),o={art_model:"model",quick_app:"fast_app",character:"character"}[e.source],l={obj:{name:(null==e?void 0:e.title)||"",id:null==e?void 0:e.source_id,banner:{url:(null==e?void 0:e.cover)||""}},type:o},"model"!==o){n.next=7;break}return t.handleSearch(null==e?void 0:e.title),n.abrupt("return");case 7:t.$EventBus.$emit("updateCategoryInfo",l),t.$nextTick((function(){t.$refs.inputRef&&t.$refs.inputRef.blur(),t.modelGenerate=null}));case 9:case"end":return n.stop()}}),n)})))()},findMore:function(){this.handleSearch()},getRelatedList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.keyword;if(""!==t){var n={prefix:t,source_type:this.searchType,except_num:10};2===this.searchType&&(n.type="Checkpoint"),Object(Kr.g)(n).then((function(t){var n,o=(null==t||null===(n=t.data)||void 0===n?void 0:n.items)||[];e.associateList=o.map((function(e){return Lc(Lc({},e),{},{active:!1})})),e.keyIndex=-1}))}else this.associateList=[]}}},jc=Mc,Dc=(n(3132),Object(y.a)(jc,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"home-search"},[t("div",{staticClass:"flex justify-between items-center"},[t("el-input",{ref:"inputRef",staticClass:"style-content__search-input",attrs:{placeholder:e.$t(e.placeHolder),type:"input",resize:"none",maxlength:"2000"},on:{input:e.inputText,focus:e.onFocusFn,blur:e.onBlurFn},nativeOn:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onKeydown.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:e.onKeyWordUp.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:e.onKeyWordDown.apply(null,arguments)}]},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[t("i",{staticClass:"iconfont search-icon icon-search",attrs:{slot:"prefix"},slot:"prefix"}),e._v(" "),e.keyword?t("i",{staticClass:"el-input__icon el-icon-circle-close",attrs:{slot:"suffix"},on:{click:e.clearText},slot:"suffix"}):e._e()])],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showAssociate,expression:"showAssociate"}],staticClass:"associate-content",class:{"associate-content-left":e.isShowLeftStyle},on:{mousedown:function(e){e.preventDefault()}}},[t("div",{staticClass:"item-list",attrs:{id:"associateListId"}},[t("LenovoPanel",{ref:"LenovoPanelRef",attrs:{list:e.associateList,keyword:e.keyword,showType:e.searchType},on:{onClick:e.handAssoriateItem,mousedown:function(e){e.preventDefault()}}})],1),e._v(" "),e.associateList.length>0?t("div",{staticClass:"more-item",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.findMore.apply(null,arguments)},mousedown:function(e){e.preventDefault()}}},[e._v("\n      "+e._s(e.$t("viewMore"))+"\n    ")]):e._e(),e._v(" "),0===e.associateList.length?[t("div",{staticClass:"no-search-box"},[t("el-image",{staticStyle:{width:"90px",height:"66px"},attrs:{src:e.searchNoDataImg}}),e._v(" "),t("p",[e._v(e._s(e.$t("NoSearchData")))])],1)]:e._e()],2),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showMockBox,expression:"showMockBox"}],staticClass:"mock-associate-box",on:{click:e.handMaskBox}})])}),[],!1,null,"c433187c",null)),Nc=Dc.exports,Ec={name:"CombinedSelectDialogNoData"},Rc=(n(3133),Object(y.a)(Ec,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"style-content__list-empty"},[t("svg-icon",{staticClass:"style-content__list-empty-icon",attrs:{"icon-class":"style-empty-icon"}}),e._v(" "),t("p",[e._v(e._s(e.$t("NoResultsFound")))])],1)}),[],!1,null,"6c9cc396",null).exports);function Ac(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Bc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ac(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ac(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Uc={name:"fastAppItem",components:{CollectPopover:an.a,changeVer:sn.a,modelPayNum:on.a},mixins:[ce.a],inject:["easyTop","CombinedSelectionDialog"],props:{logEventPosition:{type:String,default:""},item:{type:Object,default:function(){}},activeTopTab:{type:String,default:""}},data:function(){return{showImage:!0,formatNumberForeign:k.i,modelType:"Checkpoint",callBackObj:null}},computed:Bc(Bc({},Object(S.c)("user",["userInfo","isLoggedIn"])),{},{selectedId:function(){var e;return null===(e=this.CombinedSelectionDialog)||void 0===e?void 0:e.selectedId},authorAvatar:function(){var e;return(null===(e=this.item)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.head)||""},itemAuthorName:function(){var e,t;return(null===(e=this.item)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.name)||(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)||""},itemName:function(){var e,t,n;return(null===(e=this.item)||void 0===e?void 0:e.name)||(null===(t=this.item)||void 0===t||null===(t=t.comfy_ui)||void 0===t?void 0:t.name)||(null===(n=this.item)||void 0===n?void 0:n.title)||""},itemCover:function(){var e,t,n;return(null===(e=this.item)||void 0===e||null===(e=e.cover)||void 0===e?void 0:e.url)||(null===(t=this.item)||void 0===t?void 0:t.cover)||(null===(n=this.item)||void 0===n||null===(n=n.banner)||void 0===n?void 0:n.url)||""},getImageUrl:function(){var e="";return this.itemCover?e=Object(k.x)(this.itemCover,this.$imgL):e},getCurrentModelType:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.currentModelType},isSDXL:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isSDXLModel},isSD35:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isSd35Model},isStudioMode:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isStudioFlux},activeSelectModel:function(){var e,t;return((null===(e=this.item)||void 0===e?void 0:e.id)||(null===(t=this.item)||void 0===t?void 0:t.model_id))===this.selectedId?"select-model-active":""},getModels:function(){var e=xe.B.sd,t=xe.B.sdxl,n=xe.B.flux,o=xe.B.sd35,l=xe.B.pony,r=void 0===l?[]:l,c=xe.B.other,d=void 0===c?[]:c,h=xe.B.sa,m=void 0===h?[]:h,v=[].concat(Object(R.a)(e),Object(R.a)(o),Object(R.a)(t),Object(R.a)(n),Object(R.a)(m),Object(R.a)(d));return{sd:this.SDmodel||[].concat(Object(R.a)(e),Object(R.a)(d)),sdxl:this.SDXLmodel||t,sd35:o,flux:n,allBaseModels:v,pony:r,sa:m}},convertModelFlag:function(){return"APP"}}),methods:{handleImageError:function(){this.showImage=!1},handleLogEventFn:function(e){var t,n,o={operation:e,behavior_info:null===(t=this.item)||void 0===t?void 0:t.id,obj_type:14};null!==(n=this.CombinedSelectionDialog)&&void 0!==n&&n.dynamicModel&&this.logEventPosition&&(o.position=this.logEventPosition),this.$logEvent("log_actions",o)},addFavoriteCallback:function(){this.handleLogEventFn("collect")},unFavoriteCallback:function(e){this.$emit("unFavorite",e),this.handleLogEventFn("collect")},otherUser:function(){var e,t,n,path="/user/"+encodeURIComponent(null===(e=this.item)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id);(null===(t=this.userInfo)||void 0===t?void 0:t.id)===(null===(n=this.item)||void 0===n||null===(n=n.author)||void 0===n?void 0:n.id)&&(path="/personal"),window.open(this.localePath(path),"_blank")},handleDetail:function(){var e,t;this.handleLogEventFn("detail"),(null===(e=this.item)||void 0===e?void 0:e.id)&&window.open("/workFlowAppDetail/".concat(null===(t=this.item)||void 0===t?void 0:t.id))},handleSelect:function(e){var t,n,o;this.handleLogEventFn("click"),"hover-pop"===(null===(t=e.target)||void 0===t?void 0:t.className)&&((null===(n=this.item)||void 0===n?void 0:n.id)!==this.selectedId?(this.callBackObj={name:this.itemName,id:null===(o=this.item)||void 0===o?void 0:o.id,banner:{url:this.itemCover||""}},this.$emit("handleItemSelect",{obj:this.callBackObj,type:"fast_app"})):this.$message.warning(this.$t("CannotSelectedRepeatedly")))}}},Fc=(n(3134),Object(y.a)(Uc,(function(){var e,t,n,o=this,l=o._self._c;return l("div",[l("div",{staticClass:"content__list-item",class:[o.activeSelectModel],on:{click:function(e){return e.stopPropagation(),o.handleSelect(e)}}},[l("div",{staticClass:"hover-pop"},[l("div",{staticClass:"collect-popover-container"},[l("CollectPopover",{attrs:{type:"swtft_app",folder:o.item,from:"waterfall"},on:{unFavorite:o.unFavoriteCallback,addFavorite:o.addFavoriteCallback}})],1),o._v(" "),l("div",{staticClass:"detail-button",on:{click:function(e){return e.stopPropagation(),o.handleDetail.apply(null,arguments)}}},[o._v("\n          "+o._s(o.$t("Details"))+"\n        ")])]),o._v(" "),l("div",{staticClass:"item-image-wrapper"},[["",null,void 0].includes(o.itemCover)?l("div",{staticClass:"list-item-image-card-image"},[l("div",{staticClass:"image-empty"},[o._v(o._s(o.$t("EmptyBannerText")))])]):l("el-image",{staticClass:"list-item-image-card-image",attrs:{src:o.getImageUrl}},[l("template",{slot:"error"},[l("img",{directives:[{name:"webp",rawName:"v-webp",value:o.$imgL,expression:"$imgL"}],staticClass:"list-item-image-card-image",attrs:{src:o.itemCover,alt:""}})])],2),o._v(" "),l("div",{staticClass:"info-handle-box"},[l("el-tooltip",{attrs:{"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"top"}},[l("div",{staticClass:"tooltip-txt-fcc",attrs:{slot:"content"},slot:"content"},[o._v("\n              "+o._s(o.itemName)+"\n            ")]),o._v(" "),l("div",{staticClass:"title"},[o._v(o._s(o.itemName))])]),o._v(" "),l("div",{staticClass:"user"},[l("div",{staticClass:"author-box",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),o.otherUser.apply(null,arguments)}}},[o.authorAvatar&&o.showImage?l("div",{staticClass:"authorHead"},[l("img",{directives:[{name:"webp",rawName:"v-webp",value:o.$imgL,expression:"$imgL"}],attrs:{src:o.authorAvatar,alt:"searArt.AI"},on:{error:o.handleImageError}})]):l("div",{staticClass:"authorHead"},[o._v(o._s(o.itemAuthorName[0]))]),o._v(" "),l("div",{staticClass:"authorName overflow-ellipsis"},[o._v(o._s(o.itemAuthorName))])]),o._v(" "),l("div",{staticClass:"num-box"},[l("div",{staticClass:"funItem"},[l("i",{staticClass:"iconfont icon-icon-play"}),o._v(" "),l("span",[o._v(o._s(o.formatNumberForeign((null===(e=o.item.stat)||void 0===e?void 0:e.num_of_task)||0)))])]),o._v(" "),l("div",{staticClass:"funItem",staticStyle:{margin:"0"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),o.setCollect(o.item,"swtft_app")}}},[l("i",{staticClass:"iconfont",class:o.setCollectData(o.item)}),o._v(" "),(null===(t=o.item.stat)||void 0===t?void 0:t.num_of_collection)>0?l("span",[o._v("\n                  "+o._s(o.formatNumberForeign((null===(n=o.item.stat)||void 0===n?void 0:n.num_of_collection)||0))+"\n                ")]):o._e()])])])],1)],1),o._v(" "),o.convertModelFlag?[l("span",{staticClass:"model-type-flag"},[o._v("\n          "+o._s(o.convertModelFlag)+"\n        ")])]:o._e()],2)])}),[],!1,null,"147209eb",null)),zc=Fc.exports;function Vc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Wc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vc(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Hc={name:"characterItem",components:{CollectPopover:an.a,changeVer:sn.a,modelPayNum:on.a},mixins:[ce.a],inject:["easyTop","CombinedSelectionDialog"],props:{logEventPosition:{type:String,default:""},item:{type:Object,default:function(){}},activeTopTab:{type:String,default:""}},data:function(){return{showImage:!0,formatNumberForeign:k.i,callBackObj:null}},computed:Wc(Wc({},Object(S.c)("user",["userInfo","isLoggedIn"])),{},{selectedId:function(){var e;return null===(e=this.CombinedSelectionDialog)||void 0===e?void 0:e.selectedId},authorAvatar:function(){var e;return(null===(e=this.item)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.head)||""},itemAuthorName:function(){var e,t;return(null===(e=this.item)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.name)||(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)||""},itemDesc:function(){var e,t,n;return(null===(e=this.item)||void 0===e?void 0:e.evaluation)||(null===(t=this.item)||void 0===t||null===(t=t.character)||void 0===t?void 0:t.evaluation)||(null===(n=this.item)||void 0===n?void 0:n.sub_title)||""},itemName:function(){var e,t,n;return(null===(e=this.item)||void 0===e?void 0:e.name)||(null===(t=this.item)||void 0===t||null===(t=t.character)||void 0===t?void 0:t.name)||(null===(n=this.item)||void 0===n?void 0:n.title)||""},itemCover:function(){var e,t,n;return(null===(e=this.item)||void 0===e||null===(e=e.cover)||void 0===e?void 0:e.url)||(null===(t=this.item)||void 0===t?void 0:t.cover)||(null===(n=this.item)||void 0===n||null===(n=n.banner)||void 0===n?void 0:n.url)||""},getImageUrl:function(){var e="";return this.itemCover?e=Object(k.x)(this.itemCover,this.$imgL):e},activeSelectModel:function(){var e;return(null===(e=this.item)||void 0===e?void 0:e.id)===this.selectedId?"select-model-active":""}}),methods:{handleImageError:function(){this.showImage=!1},handleLogEventFn:function(e){var t,n,o={operation:e,behavior_info:null===(t=this.item)||void 0===t?void 0:t.id,obj_type:9};null!==(n=this.CombinedSelectionDialog)&&void 0!==n&&n.dynamicModel&&this.logEventPosition&&(o.position=this.logEventPosition),this.$logEvent("log_actions",o)},unFavoriteCallback:function(e){this.$emit("unFavorite",e),this.handleLogEventFn("collect")},addFavoriteCallback:function(){this.handleLogEventFn("collect")},otherUser:function(){var e,t,n,path="/user/"+encodeURIComponent(null===(e=this.item)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id);(null===(t=this.userInfo)||void 0===t?void 0:t.id)===(null===(n=this.item)||void 0===n||null===(n=n.author)||void 0===n?void 0:n.id)&&(path="/personal"),window.open(this.localePath(path),"_blank")},handleDetail:function(){var e,t;this.handleLogEventFn("detail"),(null===(e=this.item)||void 0===e?void 0:e.id)&&window.open("/cyberPubPage/".concat(null===(t=this.item)||void 0===t?void 0:t.id))},handleSelect:function(e){var t,n,o,l;console.log("e.target?.className",null===(t=e.target)||void 0===t?void 0:t.className),["hover-pop","el-tooltip title","el-tooltip desc","iconfont icon-users-solid"].includes(null===(n=e.target)||void 0===n?void 0:n.className)&&(this.handleLogEventFn("click"),(null===(o=this.item)||void 0===o?void 0:o.id)!==this.selectedId?(this.callBackObj={name:this.itemName,id:null===(l=this.item)||void 0===l?void 0:l.id,banner:{url:this.itemCover||""}},this.$emit("handleItemSelect",{obj:this.callBackObj,type:"character"})):this.$message.warning(this.$t("CannotSelectedRepeatedly")))}}},qc=(n(3135),Object(y.a)(Hc,(function(){var e,t,n,o=this,l=o._self._c;return l("div",[l("div",{staticClass:"content__list-item",class:[o.activeSelectModel],on:{click:function(e){return e.stopPropagation(),o.handleSelect(e)}}},[l("div",{staticClass:"hover-pop"},[l("div",{staticClass:"collect-popover-container"},[l("CollectPopover",{attrs:{type:"character",folder:o.item,from:"waterfall"},on:{unFavorite:o.unFavoriteCallback,addFavorite:o.addFavoriteCallback}})],1),o._v(" "),l("div",{staticClass:"detail-button",on:{click:function(e){return e.stopPropagation(),o.handleDetail.apply(null,arguments)}}},[o._v("\n          "+o._s(o.$t("Details"))+"\n        ")])]),o._v(" "),l("div",{staticClass:"item-image-wrapper"},[["",null,void 0].includes(o.itemCover)?l("div",{staticClass:"list-item-image-card-image"},[l("div",{staticClass:"image-empty"},[o._v(o._s(o.$t("EmptyBannerText")))])]):l("el-image",{staticClass:"list-item-image-card-image",attrs:{src:o.getImageUrl}},[l("template",{slot:"error"},[l("img",{directives:[{name:"webp",rawName:"v-webp",value:o.$imgL,expression:"$imgL"}],staticClass:"list-item-image-card-image",attrs:{src:o.itemCover,alt:""}})])],2),o._v(" "),l("div",{staticClass:"info-handle-box"},[l("el-tooltip",{attrs:{"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"top"}},[l("div",{staticClass:"tooltip-txt-fcc",attrs:{slot:"content"},slot:"content"},[o._v("\n              "+o._s(o.itemName)+"\n            ")]),o._v(" "),l("div",{staticClass:"title"},[o._v(o._s(o.itemName))])]),o._v(" "),l("el-tooltip",{attrs:{"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"top"}},[l("div",{staticClass:"tooltip-txt-fcc",attrs:{slot:"content"},slot:"content"},[o._v("\n              "+o._s(o.itemDesc)+"\n            ")]),o._v(" "),l("div",{staticClass:"desc"},[o._v(o._s(o.itemDesc))])]),o._v(" "),l("div",{staticClass:"user"},[l("div",{staticClass:"author-box",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),o.otherUser.apply(null,arguments)}}},[o.authorAvatar&&o.showImage?l("div",{staticClass:"authorHead"},[l("img",{directives:[{name:"webp",rawName:"v-webp",value:o.$imgL,expression:"$imgL"}],attrs:{src:o.authorAvatar,alt:"searArt.AI"},on:{error:o.handleImageError}})]):l("div",{staticClass:"authorHead"},[o._v(o._s(o.itemAuthorName[0]))]),o._v(" "),l("div",{staticClass:"authorName overflow-ellipsis"},[o._v(o._s(o.itemAuthorName))])]),o._v(" "),l("div",{staticClass:"num-box"},[l("div",{staticClass:"funItem"},[l("i",{staticClass:"iconfont icon-users-solid"}),o._v(" "),l("span",[o._v(o._s(o.formatNumberForeign((null===(e=o.item.stat)||void 0===e?void 0:e.num_of_token)||0)))])]),o._v(" "),l("div",{staticClass:"funItem",staticStyle:{margin:"0"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),o.setCollect(o.item,"character")}}},[l("i",{staticClass:"iconfont",class:o.setCollectData(o.item)}),o._v(" "),(null===(t=o.item.stat)||void 0===t?void 0:t.num_of_collection)>0?l("span",[o._v("\n                  "+o._s(o.formatNumberForeign((null===(n=o.item.stat)||void 0===n?void 0:n.num_of_collection)||0))+"\n                ")]):o._e()])])])],1)],1),o._v(" "),o._m(0)])])}),[function(){var e=this._self._c;return e("div",{staticClass:"model-type-flag"},[e("i",{staticClass:"iconfont icon-icon-shuzir"})])}],!1,null,"1ae60dc4",null)),Gc=qc.exports;function Jc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Kc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jc(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xc={name:"modelItem",components:{commonConfirmModal:un.a,CollectPopover:an.a,changeVer:sn.a,modelPayNum:on.a},mixins:[ce.a],inject:["easyTop","CombinedSelectionDialog"],watch:{enableUsePresetConfigProps:{handler:function(e){this.enableUsePresetConfig=e},immediate:!0}},props:{logEventPosition:{type:String,default:""},enableUsePresetConfigProps:Boolean,item:{type:Object,default:function(){}},activeTopTab:{type:String,default:""}},data:function(){return{showImage:!0,model_type_map:{LORA:"LoRa",Checkpoint:"Checkpoint"},enableUsePresetConfig:!0,formatNumberForeign:k.i,modelType:"Checkpoint",callBackObj:null,selectModelData:null}},computed:Kc(Kc(Kc({},Object(S.e)("user",["collectData","cdnHost","token"])),Object(S.c)("user",["userInfo","isLoggedIn","accountData"])),{},{getModelType:function(){var e,t=this.item,n=t.content_type,o=t.content_sub_type,l=t.type,r=void 0===l?"":l,c=t.base_model,d=void 0===c?"":c,h=(null===(e=this.item)||void 0===e?void 0:e.art_model)||{},m=h.type,v=void 0===m?"":m,f=h.base_model,_=n||r||v,y=o||d||(void 0===f?"":f),w="LORA"===_?"LoRA":_,C=(null===xe.B||void 0===xe.B?void 0:xe.B.flux)||[],k="TextualInversion"===w,S="Pony"===y,x=y;return y.includes("SDXL")&&!S?(k?this.$t("embedding1"):w)+" | XL ":C.includes(x)?"LORA"===_?"LoRA | F1 ":_+" | F1 ":k?this.$t("embedding1"):w},gridNum:function(){var e;return null===(e=this.CombinedSelectionDialog)||void 0===e?void 0:e.gridNum},selectedId:function(){var e;return null===(e=this.CombinedSelectionDialog)||void 0===e?void 0:e.selectedId},authorAvatar:function(){var e;return(null===(e=this.item)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.head)||""},itemAuthorName:function(){var e,t;return(null===(e=this.item)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.name)||(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)||""},itemName:function(){var e,t,n;return(null===(e=this.item)||void 0===e?void 0:e.title)||(null===(t=this.item)||void 0===t||null===(t=t.art_model)||void 0===t?void 0:t.name)||(null===(n=this.item)||void 0===n?void 0:n.name)||""},itemCover:function(){var e,t,n;return(null===(e=this.item)||void 0===e||null===(e=e.cover)||void 0===e?void 0:e.url)||(null===(t=this.item)||void 0===t?void 0:t.cover)||(null===(n=this.item)||void 0===n||null===(n=n.banner)||void 0===n?void 0:n.url)||""},itemCoverObj:function(){var e,t;return(null===(e=this.item)||void 0===e?void 0:e.cover)||(null===(t=this.item)||void 0===t?void 0:t.banner)||{}},getImageUrl:function(){var e="";return this.itemCover?e=Object(k.x)(this.itemCover,this.$imgL):e},getCurrentModelType:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.currentModelType},isSDXL:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isSDXLModel},isSD35:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isSd35Model},isStudioMode:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isStudioFlux},getBaseModel:function(){var e,t=this.getModels.sd;return t=this.isSDXL?this.getModels.sdxl:this.getModels.sd,(this.isStudioMode||this.isSDXL)&&(t="Checkpoint"===this.modelType?[]:this.getModels.sd,"Checkpoint"===this.modelType&&(t=this.getModels.allBaseModels)),"flux"===this.getCurrentModelType&&(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isCommunityFlux)?Object(R.a)(xe.B.flux):Object(R.a)(t)},activeSelectModel:function(){var e,t;return((null===(e=this.item)||void 0===e?void 0:e.id)||(null===(t=this.item)||void 0===t?void 0:t.model_id))===this.selectedId?"select-model-active":""},getModels:function(){var e=xe.B.sd,t=xe.B.sdxl,n=xe.B.flux,o=xe.B.sd35,l=xe.B.pony,r=void 0===l?[]:l,c=xe.B.other,d=void 0===c?[]:c,h=xe.B.sa,m=void 0===h?[]:h,v=[].concat(Object(R.a)(e),Object(R.a)(o),Object(R.a)(t),Object(R.a)(n),Object(R.a)(m),Object(R.a)(d));return{sd:this.SDmodel||[].concat(Object(R.a)(e),Object(R.a)(d)),sdxl:this.SDXLmodel||t,sd35:o,flux:n,allBaseModels:v,pony:r,sa:m}},BASE_MODEL:function(){var e,t,n=null!==(e=this.item)&&void 0!==e&&e.art_model?null===(t=this.item)||void 0===t?void 0:t.art_model:this.item,o=n.content_sub_type,l=void 0===o?"":o,r=n.base_model;return(l||(void 0===r?"":r)).replace(/\s.*$/,"")||""},MODEL_TYPE:function(){var e,t,n=null!==(e=this.item)&&void 0!==e&&e.art_model?null===(t=this.item)||void 0===t?void 0:t.art_model:this.item,o=n.content_type,l=void 0===o?"":o,r=n.type,c=void 0===r?"":r;return this.model_type_map[l||c||""]||l||c||""}}),methods:{handleImageError:function(){this.showImage=!1},handleLogEventFn:function(e){var t,n,o={operation:e,behavior_info:null===(t=this.item)||void 0===t?void 0:t.id,obj_type:2};null!==(n=this.CombinedSelectionDialog)&&void 0!==n&&n.dynamicModel&&this.logEventPosition&&(o.position=this.logEventPosition),this.$logEvent("log_actions",o)},addFavoriteCallback:function(){this.handleLogEventFn("collect")},unFavoriteCallback:function(e){this.$emit("unFavorite",e),this.handleLogEventFn("collect")},otherUser:function(){var e,t,path="/user/"+encodeURIComponent(null===(e=this.item)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id);this.userInfo.id===(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)&&(path="/personal"),window.open(this.localePath(path),"_blank")},handleDetail:function(){var e,t;this.handleLogEventFn("detail"),(null===(e=this.item)||void 0===e?void 0:e.id)&&window.open("/models/detail/".concat(null===(t=this.item)||void 0===t?void 0:t.id))},selectItem:function(e,t,n){var o,l,r,c,d,h,m,v,f,_,y,w,C,k,S,x,I,O,T,$,L,P,M,j,D,N,E,R,A,B,U,F,z,V;if(console.log("选中版本---",e,t,n),null!==(o=this.item)&&void 0!==o&&o.child&&this.item.child.length>0&&(this.item.child[0].title=e.version_no),t.model_ver_no=e.model_ver_id,t.version_name=e.version_no,t.base_model=e.base_model_name,t.modelTags=Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[],t.trained_words=Array.isArray(null==e?void 0:e.trained_words)?null==e?void 0:e.trained_words:[],null!==(l=e.sample)&&void 0!==l&&null!==(l=l.banner)&&void 0!==l&&l.url){var W,H,G;if(t.cover)if(t.cover instanceof Object)t.cover.url=null===(H=e.sample)||void 0===H||null===(H=H.banner)||void 0===H?void 0:H.url;else t.cover=null===(G=e.sample)||void 0===G?void 0:G.banner;t.banner&&(t.banner.url=null===(W=e.sample)||void 0===W||null===(W=W.banner)||void 0===W?void 0:W.url)}else t.cover&&t.cover instanceof Object&&(t.cover.url=""),t.banner&&(t.banner.url="");n&&(this.callBackObj=Kc(Kc({name:this.itemName,id:null==t?void 0:t.id,banner:{url:this.itemCover||"",width:(null===(r=this.itemCoverObj)||void 0===r?void 0:r.width)||(null===(c=this.item)||void 0===c?void 0:c.cover_width)||0,height:(null===(d=this.itemCoverObj)||void 0===d?void 0:d.height)||(null===(h=this.item)||void 0===h?void 0:h.cover_height)||0,nsfw:(null===(m=this.itemCoverObj)||void 0===m?void 0:m.nsfw)||(null===(v=this.item)||void 0===v?void 0:v.nsfw)||0,is_nsfw_plus:(null===(f=this.itemCoverObj)||void 0===f?void 0:f.nsfw_plus)||(null===(_=this.item)||void 0===_?void 0:_.nsfw_plus)||!1,green:(null===(y=this.itemCoverObj)||void 0===y?void 0:y.green)||(null===(w=this.item)||void 0===w?void 0:w.green)||0,has_meta:(null===(C=this.itemCoverObj)||void 0===C?void 0:C.has_meta)||0}},t),{},{base_model:(null===(k=this.item)||void 0===k?void 0:k.content_sub_type)||(null===(S=this.item)||void 0===S?void 0:S.base_model)||(null===(x=this.item)||void 0===x||null===(x=x.art_model)||void 0===x?void 0:x.base_model),type:(null===(I=this.item)||void 0===I?void 0:I.content_type)||(null===(O=this.item)||void 0===O?void 0:O.type)||(null===(T=this.item)||void 0===T||null===(T=T.art_model)||void 0===T?void 0:T.type),version_name:(null===($=this.item)||void 0===$?void 0:$.version_name)||(null!==(L=this.item)&&void 0!==L&&L.child&&this.item.child.length>0?null===(P=this.item)||void 0===P?void 0:P.child[0].title:(null===(M=this.item)||void 0===M||null===(M=M.art_model)||void 0===M?void 0:M.version_name)||""),is_agency_fee:(null===(j=this.item)||void 0===j?void 0:j.is_agency_fee)||!1,agency_fee:(null===(D=this.item)||void 0===D?void 0:D.agency_fee)||0,payment_way:(null===(N=this.item)||void 0===N?void 0:N.payment_way)||0,sample_ids:(null===(E=this.item)||void 0===E?void 0:E.sample_ids)||null,model_ver_no:(null===(R=this.item)||void 0===R?void 0:R.model_ver_no)||(null!==(A=this.item)&&void 0!==A&&A.child&&this.item.child.length>0?null===(B=this.item)||void 0===B?void 0:B.child[0].id:(null===(U=this.item)||void 0===U||null===(U=U.art_model)||void 0===U?void 0:U.ver_id)||"")}),this.selectModelData={model:this.callBackObj,model_type:(null===(F=this.item)||void 0===F?void 0:F.content_type)||(null===(z=this.item)||void 0===z?void 0:z.type),isPreset:"preset",usePreset:!1},this.handleConfirm(1===(null===(V=this.item)||void 0===V?void 0:V.is_preset)?"preset":""))},handleConfirm:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(console.log("确认选择!",t,this.enableUsePresetConfig,this.callBackObj),this.selectModelData.usePreset=!0,t&&this.enableUsePresetConfig){var n,o,l=!0;if(this.isLoggedIn)l=null===(n=this.accountData)||void 0===n?void 0:n.shot_task_v2_preset_meta_popup,null!==(o=this.accountData)&&void 0!==o&&o.shot_task_v2_preset_meta_popup||localStorage.setItem("presetModelNotTips",1);else l=!localStorage.getItem("presetModelNotTips");if(l)this.$refs.commonConfirmModal.show({subTitle:"newGenerate60",fromPage:"modelPreset"}).then((function(){e.selectModelData.usePreset=!0,e.$logEvent("log_actions",{operation:"click_try_it_now",behavior_info:"on_model_config_popup"}),e.sendData()})).catch((function(){e.selectModelData.usePreset=!1,e.sendData()}));else this.sendData()}else this.selectModelData.usePreset=!1,this.sendData()},sendData:function(){var e=this;this.$emit("handleItemSelect",{obj:this.callBackObj,type:"model"}),setTimeout((function(){e.$EventBus.$emit("selectModel",e.selectModelData),e.selectModelData=null}),10)},handleSelect:function(e,t){var n,o,l,r,c,d,h,m,v,f,_,y,w,C,k,S,x,I,O,T,$,L,P,M,j,D,N,E,R,A;this.handleLogEventFn(t),console.log("e.target?.className",null===(n=e.target)||void 0===n?void 0:n.className),["hover-pop","use"].includes(null===(o=e.target)||void 0===o?void 0:o.className)&&((null===(l=this.item)||void 0===l?void 0:l.id)!==this.selectedId?(this.callBackObj=Kc(Kc({name:this.itemName,id:null===(r=this.item)||void 0===r?void 0:r.id,banner:{url:this.itemCover||"",width:(null===(c=this.itemCoverObj)||void 0===c?void 0:c.width)||0,height:(null===(d=this.itemCoverObj)||void 0===d?void 0:d.height)||0,nsfw:null===(h=this.itemCoverObj)||void 0===h?void 0:h.url,is_nsfw_plus:(null===(m=this.itemCoverObj)||void 0===m?void 0:m.nsfw_plus)||(null===(v=this.item)||void 0===v?void 0:v.nsfw_plus)||!1,green:(null===(f=this.itemCoverObj)||void 0===f?void 0:f.green)||(null===(_=this.item)||void 0===_?void 0:_.green)||0,has_meta:(null===(y=this.itemCoverObj)||void 0===y?void 0:y.has_meta)||0}},this.item),{},{base_model:(null===(w=this.item)||void 0===w?void 0:w.content_sub_type)||(null===(C=this.item)||void 0===C?void 0:C.base_model),type:(null===(k=this.item)||void 0===k?void 0:k.content_type)||(null===(S=this.item)||void 0===S?void 0:S.type),version_name:(null===(x=this.item)||void 0===x?void 0:x.version_name)||(null!==(I=this.item)&&void 0!==I&&I.child&&this.item.child.length>0?null===(O=this.item)||void 0===O?void 0:O.child[0].title:(null===(T=this.item)||void 0===T||null===(T=T.art_model)||void 0===T?void 0:T.version_name)||""),is_agency_fee:(null===($=this.item)||void 0===$?void 0:$.is_agency_fee)||!1,agency_fee:(null===(L=this.item)||void 0===L?void 0:L.agency_fee)||0,payment_way:(null===(P=this.item)||void 0===P?void 0:P.payment_way)||0,sample_ids:(null===(M=this.item)||void 0===M?void 0:M.sample_ids)||null,model_ver_no:(null===(j=this.item)||void 0===j?void 0:j.model_ver_no)||(null!==(D=this.item)&&void 0!==D&&D.child&&this.item.child.length>0?this.item.child[0].id:(null===(N=this.item)||void 0===N||null===(N=N.art_model)||void 0===N?void 0:N.ver_id)||"")}),this.selectModelData={model:this.callBackObj,model_type:(null===(E=this.item)||void 0===E?void 0:E.content_type)||(null===(R=this.item)||void 0===R?void 0:R.type),isPreset:""},this.handleConfirm(1===(null===(A=this.item)||void 0===A?void 0:A.is_preset)?"preset":"")):this.$message.warning(this.$t("CannotSelectedRepeatedly")))}}},Qc=Xc,Zc=(n(3136),Object(y.a)(Qc,(function(){var e,t,n,o,l=this,r=l._self._c;return r("div",[r("div",{staticClass:"content__list-item",class:[l.activeSelectModel],style:{height:5===l.gridNum?"340px":"280px"},on:{click:function(e){return e.stopPropagation(),l.handleSelect(e,"click")}}},[r("div",{staticClass:"hover-pop"},[r("div",{staticClass:"collect-popover-container"},[r("CollectPopover",{attrs:{type:"model",folder:l.item,from:"waterfall"},on:{unFavorite:l.unFavoriteCallback,addFavorite:l.addFavoriteCallback}})],1),l._v(" "),r("div",{staticClass:"detail-button",on:{click:function(e){return e.stopPropagation(),l.handleDetail.apply(null,arguments)}}},[l._v("\n          "+l._s(l.$t("Details"))+"\n        ")])]),l._v(" "),r("div",{staticClass:"item-image-wrapper",style:{height:5===l.gridNum?"300px":"240px"}},[["",null,void 0].includes(l.itemCover)?r("div",{staticClass:"list-item-image-card-image"},[r("div",{staticClass:"image-empty"},[l._v(l._s(l.$t("EmptyBannerText")))])]):r("el-image",{staticClass:"list-item-image-card-image",attrs:{src:l.getImageUrl}},[r("template",{slot:"error"},[r("img",{directives:[{name:"webp",rawName:"v-webp",value:l.$imgL,expression:"$imgL"}],staticClass:"list-item-image-card-image",attrs:{src:l.itemCover,alt:""}})])],2),l._v(" "),r("div",{staticClass:"info-handle-box"},[r("el-tooltip",{attrs:{"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"top"}},[r("div",{staticClass:"tooltip-txt-fcc",attrs:{slot:"content"},slot:"content"},[l._v("\n              "+l._s(l.itemName)+"\n            ")]),l._v(" "),r("div",{staticClass:"title"},[l._v(l._s(l.itemName))])]),l._v(" "),r("div",{staticClass:"user"},[r("div",{staticClass:"author-box",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),l.otherUser.apply(null,arguments)}}},[l.authorAvatar&&l.showImage?r("div",{staticClass:"authorHead"},[r("img",{directives:[{name:"webp",rawName:"v-webp",value:l.$imgL,expression:"$imgL"}],attrs:{src:l.authorAvatar,alt:"searArt.AI"},on:{error:l.handleImageError}})]):r("div",{staticClass:"authorHead"},[l._v(l._s(l.itemAuthorName[0]))]),l._v(" "),r("div",{staticClass:"authorName overflow-ellipsis"},[l._v(l._s(l.itemAuthorName))])]),l._v(" "),r("div",{staticClass:"num-box"},[r("div",{staticClass:"funItem"},[r("i",{staticClass:"iconfont icon-icon-play"}),l._v(" "),r("span",[l._v(l._s(l.formatNumberForeign((null===(e=l.item.stat)||void 0===e?void 0:e.num_of_task)||0)))])]),l._v(" "),r("div",{staticClass:"funItem",staticStyle:{margin:"0"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),l.setCollect(l.item,"model")}}},[r("i",{staticClass:"iconfont",class:l.setCollectData(l.item)}),l._v(" "),(null===(t=l.item.stat)||void 0===t?void 0:t.num_of_collection)>0?r("span",[l._v("\n                  "+l._s(l.formatNumberForeign((null===(n=l.item.stat)||void 0===n?void 0:n.num_of_collection)||0))+"\n                ")]):l._e()])])])],1)],1),l._v(" "),r("div",{staticClass:"bottom-box"},[r("changeVer",{attrs:{fontSize:"12",from:"styleModal",item:l.item,base_models:l.getBaseModel},on:{selectItem:function(e){return l.selectItem(e,l.item,l.activeSelectModel)}}}),l._v(" "),r("div",{staticClass:"use",on:{click:function(e){return e.stopPropagation(),l.handleSelect(e,"use")}}},[l._v("\n          "+l._s(l.$t("workFlow46"))+"\n        ")])],1),l._v(" "),r("div",{staticClass:"model-type-flag"},[l._v("\n        "+l._s(l.getModelType)+"\n        "),"Pony"===(null===(o=l.item)||void 0===o?void 0:o.content_sub_type)?[r("span",{staticClass:"pony-span"},[l._v(" | ")]),l._v(" "),r("i",{staticClass:"iconfont icon-icon-horse"})]:l._e()],2)]),l._v(" "),r("common-confirm-modal",{ref:"commonConfirmModal"})],1)}),[],!1,null,"d9da5782",null)),Yc=Zc.exports;function ed(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function id(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ed(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ed(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nd={name:"SquareList",components:{ModelItem:Yc,CharacterItem:Gc,FastAppItem:zc,NoData:Rc,CombinedSelectionLenovoSearch:Nc},inject:["CombinedSelectionDialog"],props:{marginTop:{type:[String,Number],default:0},gridNum:{type:Number,default:6},activeTopTab:{type:String,default:"character"},enableUsePresetConfigProps:Boolean},watch:{activeTopTab:{handler:function(e,t){var n=this;return Object(E.a)(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(e===t){o.next=9;break}return console.log("tab切换触发广场数据更新！"),n.squareList=[],o.next=5,n.initFilter(n.activeTopTab);case 5:return n.queryParam.keyword="",n.queryParam.tag_ids="",o.next=9,n.intList();case 9:case"end":return o.stop()}}),o)})))()},immediate:!0},enableUsePresetConfigProps:{handler:function(e){this.enableUsePresetConfig=e},immediate:!0}},computed:id(id(id({code:function(){var e;return(null===(e=this.CombinedSelectionDialog)||void 0===e||null===(e=e.curPage)||void 0===e?void 0:e.code)||""},searchType:function(){return xe.q[this.code]},isShowSearch:function(){var e;return null===(e=this.CombinedSelectionDialog)||void 0===e?void 0:e.isUseTagFilter},parentTab:function(){var e,t;return null!==(e=this.CombinedSelectionDialog)&&void 0!==e&&e.activeTabDynamic?[null===(t=this.CombinedSelectionDialog)||void 0===t?void 0:t.activeTabDynamic]:[]},emptyNumber:function(){var e,t;return 6===this.gridNum?18-(null===(e=this.squareList)||void 0===e?void 0:e.length):15-(null===(t=this.squareList)||void 0===t?void 0:t.length)},paramsCount:function(){var e;return null===(e=this.baseModelSelect)||void 0===e?void 0:e.length},isHiddleTitle:function(){var e;return(null===(e=this.CombinedSelectionDialog)||void 0===e?void 0:e.searchIng)||this.isShowSearch},isLoggedIn:{handler:function(e){this.tagIndex=e?"recommend":"hot"}},timeTypeOption:function(){return this.timeInit},lang:function(){return this.$i18n.locale},hideTimeTypeOption:function(){return["recommend","follows","new"].includes(this.tagIndex)},renderTypeOption:function(){var e=Object(X.cloneDeep)(this.typeOption);return this.isLoggedIn||(e=e.filter((function(e){return"follows"!==e.id}))),["fast_app"].includes(this.activeTopTab)&&(e=e.filter((function(e){return"follows"!==e.id&&"recommend"!==e.id}))),"character"===this.activeTopTab&&(e=e.filter((function(e){return"follows"!==e.id}))).push({name:"recentlyUsed",id:"recently",icon:"oldest"}),e},setIcon:function(){var e=this,t="homeIcon1";return this.renderTypeOption.forEach((function(n){e.tagIndex===n.id&&(t=n.icon)})),t}},Object(S.e)("app",["topBanner","ABInfo"])),Object(S.e)("user",["adminOff","token","userInfo"])),Object(S.c)("user",["isLoggedIn","accountData","userInfo","isCompanyAccount","cdnHostFun"])),methods:id(id({},Object(S.b)("user",["recordEnableUsePresetConfig"])),{},{handleSearch:function(e,t){var n;null===(n=this.CombinedSelectionDialog)||void 0===n||n.handleSearch(e,t)},updateList:function(e){var t;switch(console.log("updateList",e),"add"!==e&&(this.queryParam.keyword="",this.queryParam.tag_ids=""),e){case"tab":this.queryParam.tag_ids=this.parentTab,this.intList();break;case"search":this.queryParam.keyword=(null===(t=this.CombinedSelectionDialog)||void 0===t?void 0:t.keyword)||"",this.intList(!!this.queryParam.keyword);break;case"add":this.getList(!!this.queryParam.keyword);break;default:this.intList()}},handleChangeUsePresetConfig:function(e){this.recordEnableUsePresetConfig(e?1:2),this.$logEvent("log_actions",{operation:"click_use_official_recommended_params",behavior_info:"on_model_select_page",behavior_info_sub:e?"open":"close"})},lazyLoad:function(){var e=document.documentElement.scrollHeight,t=window.innerHeight;this.scrollTop=document.documentElement.scrollTop||document.body.scrollTop||window.pageYOffset;var n=e-this.scrollTop-t,o=1.5*t;console.log("lazyLoad---",n,o),n<o&&(console.log("lazyLoad"),this.getList())},noWebpImgReport:function(e){var t=["png","jpg","jpeg"],n=e.map((function(e){return{id:e.id,webpimg:Object(k.x)(e.cover||"","low")}})).filter((function(e){var n=e.webpimg.split("."),o=n[n.length-1];return o&&t.includes(o)}));n.length>0&&Object(k.C)("nowebp",n)},onFilterReset:function(){var e;this.isReq||(this.modelTypeSelect=[null===(e=this.CombinedSelectionDialog)||void 0===e?void 0:e.modelType],this.baseModelSelect=[],this.intList())},intList:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.length>0&&void 0!==e[0]&&e[0],t.squareList=[],t.isReq=!1,t.isLock=!1,t.queryParam.page=1,t.queryParam.page_size=35,t.queryParam.offset="",n.next=9,t.getList(o);case 9:case"end":return n.stop()}}),n)})))()},initFilter:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=t.ABInfo.filter_recommend,l={feature:["All","recommend"],model:["months","hot"],post:["week","hot"],lora_train:["months","hot"],design_template:["All","hot"],ishow:["All","hot"],workflow:["All","hot"],fast_app:["All","hot"],character:["months","hot"],ai_video:["All","hot"]},r={feature:"B"===o?["All","recommend"]:["months","hot"],model:["All","hot"],post:["All","hot"],lora_train:["All","hot"],design_template:["All","hot"],ishow:["All","hot"],workflow:["All","hot"],fast_app:["All","hot"],character:["All","hot"],ai_video:["All","hot"]},c=null,t.isLoggedIn&&l[e]?(t.tagIndex=l[e][1],c=t.timeTypeOption.find((function(t){return t.name===l[e][0]}))):!t.isLoggedIn&&r[e]?(t.tagIndex=r[e][1],c=t.timeTypeOption.find((function(t){return t.name===r[e][0]}))):(t.tagIndex="hot",c=t.timeTypeOption.find((function(e){return"All"===e.name}))),c&&(t.timeName=c.name);case 7:case"end":return n.stop()}}),n)})))()},handleItemSelect:function(e){this.$emit("handleItemSelect",e)},getList:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e.length>0&&void 0!==e[0]&&e[0],l={months:"month",days:"day",week:"week",All:""},r=t.queryParam.page,!t.isReq&&!t.isLock){n.next=6;break}return console.log("isReq/isLock return"),n.abrupt("return");case 6:if(t.isReq=!0,delete t.queryParam.model_type,delete t.queryParam.domain,delete t.queryParam.order_by,delete t.queryParam.model_types,delete t.queryParam.base_models,delete t.queryParam.refer,delete t.queryParam.scene,delete t.queryParam.type,delete t.queryParam.model_type,delete t.queryParam.mode,delete t.queryParam.created,delete t.queryParam.base_models,delete t.searchParams.model_types,c=yo.getRecentSquare,d=1===r,h="recommend"===t.tagIndex,!o){n.next=29;break}c=Kr.a,2===t.searchType&&(t.searchParams.model_types=["Checkpoint"]),t.searchParams={obj_name:t.queryParam.keyword,obj_type:t.searchType,offset:t.queryParam.offset,order_by:"hot",page_size:t.queryParam.page_size,page:t.queryParam.page},n.next=44;break;case 29:if(t.tagIndex&&(t.queryParam.order_by="All"!==t.timeName?l[t.timeName]+"_"+t.tagIndex:t.tagIndex),"model"===t.activeTopTab&&(o?(t.queryParam.page_size=35,t.queryParam.refer="task",t.queryParam.scene="tf_v2",t.queryParam.type="community",t.queryParam.model_type="Checkpoint",t.queryParam.mode="lab",t.queryParam.created="",t.queryParam.base_models=["SD 1.4","SD 1.5","SD 1.9","SD 2.0","SD 2.0 768","SD 2.1","SD 2.1 768","SD 2.1 Unclip","SD 3.5M","SD 3.5L","SDXL 1.0","Pony","Flux.1 S","Flux.1 D","SA 1.0","Other"],c=Be.o):"recommend"===t.tagIndex?(delete t.queryParam.keyword,t.queryParam.model_types=[null===(m=t.CombinedSelectionDialog)||void 0===m?void 0:m.modelType],c=yo.getModelSquareRecommend):(t.queryParam.model_types=[null===(v=t.CombinedSelectionDialog)||void 0===v?void 0:v.modelType],t.queryParam.base_models=t.baseModelSelect,t.queryParam.model_types.forEach((function(e,n){"LoRA"===e&&(t.queryParam.model_types[n]="LORA")})),"follows"===t.tagIndex?(t.queryParam.source_types=[2],c=yo.getModelSquareAttention):c=yo.getModelSquare)),"fast_app"===t.activeTopTab?(t.queryParam.run_available=1,c=yo.getFastAppSquare):t.queryParam.run_available="","character"!==t.activeTopTab){n.next=43;break}n.t0=t.tagIndex,n.next="recommend"===n.t0?36:"recently"===n.t0?38:41;break;case 36:return c=yo.getCharacterSquareRecommend,n.abrupt("break",43);case 38:return t.queryParam.source_types=[9],c=yo.getRecentSquare,n.abrupt("break",43);case 41:return c=yo.getCharacterSquare,n.abrupt("break",43);case 43:d&&h||delete t.queryParam.window_code;case 44:t.loading=!0,c(Object(xe.O)(o?t.searchParams:t.queryParam)).then((function(e){var n=e.status,data=e.data;1e4===(null==n?void 0:n.code)&&("recommend"===t.tagIndex?data.has_more||(t.queryParam.page=0):t.isLock=!data||!data.has_more,t.squareList=1===t.queryParam.page?data.items||[]:t.squareList.concat(data.items||[]),o||console.log("获取广场数据！！",t.squareList),o&&console.log("获取搜索数据！！",t.squareList),t.isReq=!1,data.offset&&("new"===t.queryParam.order_by||o)&&(t.queryParam.offset=data.offset),t.queryParam.page++,t.noWebpImgReport(data.items||[])),t.loading=!1})).catch((function(e){t.loading=!1,t.isReq=!1}));case 46:case"end":return n.stop()}}),n)})))()},onFilter:function(e,t){var n=this;this.isReq||(1===t?this.modelTypeSelect.includes(e)?this.modelTypeSelect.forEach((function(t,o){t===e&&n.modelTypeSelect.splice(o,1)})):this.modelTypeSelect.push(e):this.baseModelSelect.includes(e)?this.baseModelSelect.forEach((function(t,o){t===e&&n.baseModelSelect.splice(o,1)})):this.baseModelSelect.push(e),"recommend"===this.tagIndex&&(this.tagIndex="hot"),this.intList())},handleTimeCommand:function(e){this.timeUpdate(),this.timeName=e.name,"recommend"!==this.tagIndex&&"follows"!==this.tagIndex||(this.tagIndex="hot"),this.intList(),"All"!==e.name&&this.$logEvent("log_actions",{operation:" click_time_filter_button",behavior_info:e.name})},timeUpdate:function(){this.timeInit=[{name:"All",startTime:null,endTime:null},{name:"days",startTime:Object(k.p)().startTimestamp,endTime:Object(k.p)().endTimestamp},{name:"week",startTime:Object(k.r)().startTimestamp,endTime:Object(k.r)().endTimestamp},{name:"months",startTime:Object(k.o)().startTimestamp,endTime:Object(k.o)().endTimestamp}]},handleCommand:function(e){var t=!1;if("recommend"!==this.tagIndex&&"follows"!==this.tagIndex||(t=!0),this.timeUpdate(),this.tagIndex=e,"recommend"===this.tagIndex)delete this.queryParam.tag,this.modelTypeSelect=[this.CombinedSelectionDialog.modelType],this.baseModelSelect=[],this.timeName="All",this.$refs.tagList&&(this.$refs.tagList.selectItem="");else if("follows"==this.tagIndex)this.timeName="All",this.$refs.tagList&&(this.$refs.tagList.selectItem="");else if(t){var n=["character"].includes(this.activeTopTab)?"All":"week",o=this.timeTypeOption.find((function(e){return e.name===n}));return void this.handleTimeCommand(o)}this.intList()}}),created:function(){this.throttledLazyLoad=Object(X.throttle)(this.lazyLoad,200,{leading:!0,trailing:!0})},mounted:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.debounceChangeHandle=Object(X.debounce)(e.handleChangeUsePresetConfig,500);case 1:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.debounceChangeHandle=null,this.throttledLazyLoad.cancel()},data:function(){var e,t;return{test:!0,enableUsePresetConfig:!0,debounceChangeHandle:function(){},throttledLazyLoad:null,scrollTop:0,getListNum:0,isLock:!1,isReq:!1,queryParam:{offset:"",page:1,page_size:35,with_ver_info:1,model_types:null!==(e=this.CombinedSelectionDialog)&&void 0!==e&&e.modelType?[null===(t=this.CombinedSelectionDialog)||void 0===t?void 0:t.modelType]:[]},searchParams:{},timeInit:[{name:"All",name2:"click_All_filter",startTime:null,endTime:null},{name:"days",name2:"click_days_filter",startTime:Object(k.p)().startTimestamp,endTime:Object(k.p)().endTimestamp},{name:"week",name2:"click_week_filter",startTime:Object(k.r)().startTimestamp,endTime:Object(k.r)().endTimestamp},{name:"months",name2:"click_months_filter",startTime:Object(k.o)().startTimestamp,endTime:Object(k.o)().endTimestamp}],squareList:[],modelTypes:xe.K,baseModels:xe.a,baseModelSelect:[],modelTypeSelect:[],timeName:"All",typeOption:[{name:"Recommend",id:"recommend",icon:"homeIcon1"},{name:"Follow",id:"follows",icon:"homeIcon2"},{name:"Hot",id:"hot",icon:"hot"},{name:"New",id:"new",icon:"new1"}],loading:!0,tagIndex:"recommend"}}},ad=nd,od=(n(3137),Object(y.a)(ad,(function(){var e,t=this,n=t._self._c;return n("div",{staticClass:"square"},[n("div",{staticClass:"square-header",style:{justifyContent:!t.isHiddleTitle||t.isShowSearch?"space-between":"flex-end",marginTop:t.marginTop}},[t.isHiddleTitle?t._e():n("div",{staticClass:"square-header-title"},[t._v("\n        "+t._s(t.$t("square"))+"\n      ")]),t._v(" "),t.isShowSearch?n("CombinedSelectionLenovoSearch",{ref:"lenovoSearch",attrs:{code:(null===(e=t.CombinedSelectionDialog)||void 0===e||null===(e=e.curPage)||void 0===e?void 0:e.code)||""},on:{search:function(e){return t.handleSearch(e,"components")}}}):t._e(),t._v(" "),n("div",{staticClass:"square-header-filters"},["model"===t.activeTopTab?n("el-popover",{attrs:{placement:"bottom","popper-class":"homeFilter",trigger:"hover"}},[n("div",{staticClass:"filterCnt custom-dropdown-fcc"},["model"===t.activeTopTab?n("div",[n("div",{staticClass:"filterList pre-checkbox-box",staticStyle:{margin:"0 0 20px 0"}},[n("el-checkbox",{staticClass:"presets-model-option-checkbox",on:{change:t.debounceChangeHandle},model:{value:t.enableUsePresetConfig,callback:function(e){t.enableUsePresetConfig=e},expression:"enableUsePresetConfig"}}),t._v(" "),n("span",{staticClass:"pre-title"},[t._v(" "+t._s(t.$t("newGenerate59")))])],1)]):t._e(),t._v(" "),n("div",{staticClass:"filterTit",staticStyle:{"margin-top":"16px"}},[t._v(t._s(t.$t("BaseModel")))]),t._v(" "),n("div",{staticClass:"filterList"},t._l(t.baseModels,(function(e,o){return n("div",{key:o,staticClass:"filterItem",class:{AfilterItem:t.baseModelSelect.includes(e)},on:{click:function(n){return t.onFilter(e,2)}}},[t.baseModelSelect.includes(e)?n("i",{staticClass:"el-icon-check"}):t._e(),t._v(" "),n("span",[t._v(t._s(e))])])})),0),t._v(" "),n("div",{staticClass:"filterReset graBorder",on:{click:t.onFilterReset}},[t._v("\n                  "+t._s(t.$t("resetSelection"))+"\n                ")])]),t._v(" "),n("el-badge",{staticClass:"item",attrs:{slot:"reference",hidden:!t.paramsCount,value:t.paramsCount},slot:"reference"},[n("div",{staticClass:"filterBox"},[n("div",[n("i",{staticClass:"iconfont icon-a-filterIcon"}),t._v(" "),n("span",[t._v(t._s(t.$t("Filter")))])]),t._v(" "),n("i",{staticClass:"el-icon-arrow-down"})])])],1):t._e(),t._v(" "),n("el-dropdown",{directives:[{name:"show",rawName:"v-show",value:!t.hideTimeTypeOption,expression:"!hideTimeTypeOption"}],attrs:{trigger:"hover"},on:{command:t.handleTimeCommand}},[n("div",{staticClass:"el-dropdown-link selectTime"},[n("div",[n("i",{staticClass:"el-icon-time"}),t._v(" "),n("span",[t._v(t._s(t.$t(t.timeName)))])]),t._v(" "),n("i",{staticClass:"el-icon-arrow-down"})]),t._v(" "),n("el-dropdown-menu",{staticClass:"custom-dropdown custom-dropdown-fcc",attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.timeTypeOption,(function(e,o){return n("el-dropdown-item",{key:o,attrs:{command:e}},[n("div",{staticClass:"el-dropdown-item el-dropdown-item-time"},[n("span",[t._v(t._s(t.$t(e.name)))])])])})),1)],1),t._v(" "),n("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleCommand}},[n("div",{staticClass:"el-dropdown-link"},[n("div",[n("i",{staticClass:"iconfont custom-iconfont",class:"icon-".concat(t.setIcon)}),t._v(" "),"recently"===t.tagIndex?n("span",[t._v(t._s(t.$t("recentlyUsed")))]):n("span",[t._v(t._s(t.$t(t.tagIndex.charAt(0).toUpperCase()+t.tagIndex.slice(1))))])]),t._v(" "),n("i",{staticClass:"el-icon-arrow-down"})]),t._v(" "),n("el-dropdown-menu",{staticClass:"custom-dropdown custom-dropdown-fcc",attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.renderTypeOption,(function(e,o){return n("el-dropdown-item",{key:o,attrs:{command:e.id}},[n("div",{staticClass:"el-dropdown-item"},[n("i",{staticClass:"iconfont custom-iconfont",class:"icon-".concat(e.icon)}),t._v(" "),n("span",[t._v(t._s(t.$t(e.name)))])])])})),1)],1)],1)],1),t._v(" "),n("div",{staticClass:"square-square-list",style:{gridTemplateColumns:"repeat(".concat(t.gridNum,", 1fr)")}},[t.squareList.length?t._l(t.squareList,(function(e,o){return n("div",{key:o,staticClass:"card-item",style:{height:2!==e.obj_type&&"model"!==t.activeTopTab||5!==t.gridNum?"280px":"340px"}},[2===e.obj_type||"model"===t.activeTopTab?n("ModelItem",{attrs:{item:e},on:{handleItemSelect:t.handleItemSelect}}):t._e(),t._v(" "),9===e.obj_type||"character"===t.activeTopTab?n("CharacterItem",{attrs:{item:e},on:{handleItemSelect:t.handleItemSelect}}):t._e(),t._v(" "),14===e.obj_type||"fast_app"===t.activeTopTab?n("FastAppItem",{attrs:{item:e},on:{handleItemSelect:t.handleItemSelect}}):t._e(),t._v(" "),t.emptyNumber>0?t._l(t.emptyNumber,(function(o){return n("div",{key:"empty"+o,staticClass:"card-item-empty",style:{height:2!==e.obj_type&&"model"!==t.activeTopTab||5!==t.gridNum?"280px":"340px"}})})):t._e()],2)})):t._e(),t._v(" "),t.loading||t.squareList.length?t._e():[n("NoData")],t._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"loading-box"})],2)])}),[],!1,null,"076730aa",null).exports),sd={name:"CombinedSelectionSearch",inject:["CombinedSelectionDialog"],data:function(){return{keyword:"",searchPlaceholder:{model:"searchModelPlaceHolder",fast_app:"searchWorkflowAppPlaceHolder",character:"searchCharacterPlaceHolder",collect:"Search",mine:"Search"}}},methods:{handleClear:function(){this.keyword="",this.$emit("search",this.keyword)},handleSearch:function(){this.$emit("search",this.keyword)},resetSearch:function(){this.keyword=""}},computed:{code:function(){var e;return(null===(e=this.CombinedSelectionDialog.curPage)||void 0===e?void 0:e.code)||""},placeHolder:function(){return this.searchPlaceholder[this.code]||"Search"}}},ld=(n(3138),Object(y.a)(sd,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"style-content__search-box"},[t("el-input",{staticClass:"style-content__search-input",attrs:{placeholder:e.$t(e.placeHolder),autofocus:""},on:{change:e.handleSearch},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[t("i",{staticClass:"iconfont icon-search search-icon",attrs:{slot:"prefix"},on:{click:e.handleSearch},slot:"prefix"}),e._v(" "),e.keyword?t("i",{staticClass:"el-input__icon el-icon-circle-close",attrs:{slot:"suffix"},on:{click:e.handleClear},slot:"suffix"}):e._e()])],1)}),[],!1,null,"7e3ce09e",null)),rd=ld.exports,cd=n(268);function ud(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function hd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ud(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ud(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var pd={name:"RecentlyItem",components:{commonConfirmModal:un.a},inject:["CombinedSelectionDialog"],watch:{enableUsePresetConfigProps:{handler:function(e){this.enableUsePresetConfig=e},immediate:!0}},data:function(){return{showImage:!0,enableUsePresetConfig:!0,typeMap:{2:"model",14:"fast_app",9:"character"},iconMap:{9:"icon-a-icon-tag-Characters",2:"icon-icon-Menu-model-selected",14:"icon-a-icon-tag-AIquickapp"}}},computed:hd(hd(hd({},Object(S.e)("user",["collectData","cdnHost","token"])),Object(S.c)("user",["userInfo","isLoggedIn","accountData"])),{},{itemCover:function(){var e,t,n;return(null===(e=this.item)||void 0===e||null===(e=e.cover)||void 0===e?void 0:e.url)||(null===(t=this.item)||void 0===t?void 0:t.cover)||(null===(n=this.item)||void 0===n||null===(n=n.banner)||void 0===n?void 0:n.url)||""},itemCoverObj:function(){var e,t;return(null===(e=this.item)||void 0===e?void 0:e.cover)||(null===(t=this.item)||void 0===t?void 0:t.banner)||{}},selectedId:function(){var e;return null===(e=this.CombinedSelectionDialog)||void 0===e?void 0:e.selectedId}}),props:{logEventPosition:{type:String,default:""},enableUsePresetConfigProps:Boolean,item:{type:Object,default:function(){}}},methods:{handleImageError:function(){this.showImage=!1},handleLogEventFn:function(){var e,t,n,o={operation:"click",behavior_info:null===(e=this.item)||void 0===e?void 0:e.id,obj_type:null===(t=this.item)||void 0===t?void 0:t.obj_type};null!==(n=this.CombinedSelectionDialog)&&void 0!==n&&n.dynamicModel&&this.logEventPosition&&(o.position=this.logEventPosition),this.$logEvent("log_actions",o)},handleConfirm:function(){var e,t,n=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(console.log("确认选择!",o,this.enableUsePresetConfig,this.callBackObj),this.selectModelData={model:this.callBackObj,model_type:(null===(e=this.item)||void 0===e?void 0:e.content_type)||(null===(t=this.item)||void 0===t?void 0:t.type),isPreset:o},o&&this.enableUsePresetConfig){var l,r,c,d,h=!0;if(this.isLoggedIn)h=null===(l=this.accountData)||void 0===l?void 0:l.shot_task_v2_preset_meta_popup,null!==(r=this.accountData)&&void 0!==r&&r.shot_task_v2_preset_meta_popup||localStorage.setItem("presetModelNotTips",1);else h=!localStorage.getItem("presetModelNotTips");if(h)this.$refs.commonConfirmModal.show({subTitle:"newGenerate60",fromPage:"modelPreset"}).then((function(){var e,t;n.selectModelData={model:n.callBackObj,model_type:(null===(e=n.item)||void 0===e?void 0:e.content_type)||(null===(t=n.item)||void 0===t?void 0:t.type),isPreset:o,usePreset:!0},n.$logEvent("log_actions",{operation:"click_try_it_now",behavior_info:"on_model_config_popup"}),n.sendData()})).catch((function(){var e,t;n.selectModelData={model:n.callBackObj,model_type:(null===(e=n.item)||void 0===e?void 0:e.content_type)||(null===(t=n.item)||void 0===t?void 0:t.type),isPreset:o},n.sendData()}));else this.selectModelData={model:this.callBackObj,model_type:(null===(c=this.item)||void 0===c?void 0:c.content_type)||(null===(d=this.item)||void 0===d?void 0:d.type),isPreset:o,usePreset:!0},this.sendData()}else this.sendData()},sendData:function(){var e=this;this.$emit("handleItemSelect",{obj:this.callBackObj,type:"model"}),setTimeout((function(){e.$EventBus.$emit("selectModel",e.selectModelData),e.selectModelData=null}),10)},handleSelect:function(){var e,t,n,o,l,r,c,d,h,m,v,f,_,y,w,C,k,S,x,I,O,T,$,L,P,M,j,D,N,E,R;(this.handleLogEventFn(),(null===(e=this.item)||void 0===e?void 0:e.id)!==this.selectedId)?this.typeMap[this.item.obj_type]&&(this.callBackObj={name:null===(t=this.item)||void 0===t?void 0:t.title,id:null===(n=this.item)||void 0===n?void 0:n.id,banner:{url:this.itemCover||"",width:(null===(o=this.itemCoverObj)||void 0===o?void 0:o.width)||0,height:(null===(l=this.itemCoverObj)||void 0===l?void 0:l.height)||0,nsfw:null===(r=this.itemCoverObj)||void 0===r?void 0:r.url,is_nsfw_plus:(null===(c=this.itemCoverObj)||void 0===c?void 0:c.nsfw_plus)||(null===(d=this.item)||void 0===d?void 0:d.nsfw_plus)||!1,green:(null===(h=this.itemCoverObj)||void 0===h?void 0:h.green)||(null===(m=this.item)||void 0===m?void 0:m.green)||0,has_meta:(null===(v=this.itemCoverObj)||void 0===v?void 0:v.has_meta)||0},base_model:(null===(f=this.item)||void 0===f?void 0:f.content_sub_type)||(null===(_=this.item)||void 0===_?void 0:_.base_model),type:(null===(y=this.item)||void 0===y?void 0:y.content_type)||(null===(w=this.item)||void 0===w?void 0:w.type),version_name:(null===(C=this.item)||void 0===C?void 0:C.version_name)||(null!==(k=this.item)&&void 0!==k&&k.child&&this.item.child.length>0?null===(S=this.item)||void 0===S?void 0:S.child[0].title:(null===(x=this.item)||void 0===x||null===(x=x.art_model)||void 0===x?void 0:x.version_name)||""),is_agency_fee:(null===(I=this.item)||void 0===I?void 0:I.is_agency_fee)||!1,agency_fee:(null===(O=this.item)||void 0===O?void 0:O.agency_fee)||0,payment_way:(null===(T=this.item)||void 0===T?void 0:T.payment_way)||0,sample_ids:(null===($=this.item)||void 0===$?void 0:$.sample_ids)||null,model_ver_no:(null===(L=this.item)||void 0===L?void 0:L.model_ver_no)||(null!==(P=this.item)&&void 0!==P&&P.child&&this.item.child.length>0?null===(M=this.item)||void 0===M?void 0:M.child[0].id:(null===(j=this.item)||void 0===j||null===(j=j.art_model)||void 0===j?void 0:j.ver_id)||"")},this.selectModelData={model:this.callBackObj,model_type:(null===(D=this.item)||void 0===D?void 0:D.content_type)||(null===(N=this.item)||void 0===N?void 0:N.type),isPreset:""},2===(null===(E=this.item)||void 0===E?void 0:E.obj_type)?this.handleConfirm(1===(null===(R=this.item)||void 0===R?void 0:R.is_preset)?"preset":""):this.$emit("handleItemSelect",{obj:this.callBackObj,type:this.typeMap[this.item.obj_type]})):this.$message.warning(this.$t("CannotSelectedRepeatedly"))}}},md=pd,vd=(n(3139),Object(y.a)(md,(function(){var e,t,n,o=this,l=o._self._c;return l("div",{ref:"recently_listItem",staticClass:"recently-item",on:{click:function(e){return e.stopPropagation(),o.handleSelect(o.item)}}},[l("div",{staticClass:"recently-item-banner",class:{"recently-item-banner-empty":!o.itemCover||!o.showImage}},[l("div",{staticClass:"rec-icon"},[l("i",{staticClass:"iconfont",class:[o.iconMap[o.item.obj_type]]})]),o._v(" "),o.itemCover&&o.showImage?l("img",{attrs:{src:o.itemCover,alt:(null===(e=o.item)||void 0===e?void 0:e.title)||"seaArt"},on:{error:o.handleImageError}}):o._e()]),o._v(" "),l("el-tooltip",{attrs:{"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"top"}},[l("div",{staticClass:"tooltip-txt-fcc",attrs:{slot:"content"},slot:"content"},[o._v("\n        "+o._s(null===(t=o.item)||void 0===t?void 0:t.title)+"\n      ")]),o._v(" "),l("div",{staticClass:"recently-item-name overflow-ellipsis-2"},[o._v("\n        "+o._s(null===(n=o.item)||void 0===n?void 0:n.title)+"\n      ")])]),o._v(" "),l("common-confirm-modal",{ref:"commonConfirmModal"})],1)}),[],!1,null,"de10b38e",null).exports);function gd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function fd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gd(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _d={name:"mineModelFilter",props:{enableUsePresetConfigProps:Boolean,curCode:{type:String,default:""}},computed:{paramsCount:function(){return this.queryParam.base_models.length+this.selectedStatus.length}},data:function(){return{visible:!0,debounceChangeHandle:function(){},enableUsePresetConfig:!0,types:xe.K,baseModels:xe.a,selectedStatus:[],orders:[{key:"New",value:"new"},{key:"Hot",value:"hot"}],status:[{key:"createSetting1",value:1},{key:"createSetting2",value:2}],queryParam:{keyword:"",order_by:"new",publish_status:0,model_types:["Checkpoint"],base_models:[],with_ver_info:1}}},watch:{enableUsePresetConfigProps:{handler:function(e){this.enableUsePresetConfig=e},immediate:!0}},mounted:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.debounceChangeHandle=Object(X.debounce)(e.handleChangeUsePresetConfig,500);case 1:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.debounceChangeHandle=null},methods:fd(fd({},Object(S.b)("user",["recordEnableUsePresetConfig"])),{},{handleChangeUsePresetConfig:function(e){this.recordEnableUsePresetConfig(e?1:2),this.$logEvent("log_actions",{operation:"click_use_official_recommended_params",behavior_info:"on_model_select_page",behavior_info_sub:e?"open":"close"})},handleFilter:function(e,t){switch(t){case"order_by":this.queryParam.order_by=e;break;case"publish_status":this.selectedStatus.includes(e)?this.selectedStatus=this.selectedStatus.filter((function(t){return t!==e})):this.selectedStatus.push(e),[0,2].includes(this.selectedStatus.length)?this.queryParam.publish_status=0:this.queryParam.publish_status=this.selectedStatus[0];break;case"base_models":this.queryParam.base_models.includes(e)?this.queryParam.base_models=this.queryParam.base_models.filter((function(t){return t!==e})):this.queryParam.base_models.push(e)}this.$emit("handleFilter",this.queryParam)},filterReset:function(){this.list=[],this.selectedStatus=[],this.queryParam={order_by:"new",publish_status:0,model_types:["Checkpoint"],base_models:[]},this.$emit("handleFilter",this.queryParam)}})},bd=(n(3140),Object(y.a)(_d,(function(){var e=this,t=e._self._c;return t("div",[t("el-popover",{attrs:{placement:"bottom","popper-class":"waterfull-filter",trigger:"hover"}},[t("div",{staticClass:"filter-content"},[t("div",{staticClass:"filter pre-checkbox-box"},[t("el-checkbox",{staticClass:"presets-model-option-checkbox",on:{change:e.debounceChangeHandle},model:{value:e.enableUsePresetConfig,callback:function(t){e.enableUsePresetConfig=t},expression:"enableUsePresetConfig"}}),e._v(" "),t("span",{staticClass:"pre-title"},[e._v(" "+e._s(e.$t("newGenerate59")))])],1),e._v(" "),"collect"!==e.curCode?[t("div",{staticClass:"title"},[e._v(e._s(e.$t("Sorting")))]),e._v(" "),t("div",{staticClass:"filter"},e._l(e.orders,(function(n){return t("div",{key:n.value,staticClass:"item-filter",class:{active:e.queryParam.order_by===n.value},on:{click:function(t){return e.handleFilter(n.value,"order_by")}}},[e.queryParam.order_by===n.value?t("i",{staticClass:"el-icon-check"}):e._e(),e._v("\n              "+e._s(e.$t(n.key))+"\n            ")])})),0),e._v(" "),t("div",{staticClass:"title"},[e._v(e._s(e.$t("status")))]),e._v(" "),t("div",{staticClass:"filter"},e._l(e.status,(function(n){return t("div",{key:n.value,staticClass:"item-filter",class:{active:e.selectedStatus.includes(n.value)},on:{click:function(t){return e.handleFilter(n.value,"publish_status")}}},[e.selectedStatus.includes(n.value)?t("i",{staticClass:"el-icon-check"}):e._e(),e._v("\n              "+e._s(e.$t(n.key))+"\n            ")])})),0)]:e._e(),e._v(" "),t("div",{staticClass:"title"},[e._v(e._s(e.$t("BaseModel")))]),e._v(" "),t("div",{staticClass:"filter"},e._l(e.baseModels,(function(n){return t("div",{key:n,staticClass:"item-filter",class:{active:e.queryParam.base_models.includes(n)},on:{click:function(t){return e.handleFilter(n,"base_models")}}},[e.queryParam.base_models.includes(n)?t("i",{staticClass:"el-icon-check"}):e._e(),e._v("\n            "+e._s(n)+"\n          ")])})),0),e._v(" "),t("div",{staticClass:"filter-reset",on:{click:e.filterReset}},[e._v("\n          "+e._s(e.$t("resetSelection"))+"\n        ")])],2),e._v(" "),t("el-badge",{staticClass:"item",attrs:{slot:"reference",value:e.paramsCount,hidden:0===e.paramsCount},slot:"reference"},[t("div",{staticClass:"filter-box"},[t("div",[t("i",{staticClass:"iconfont icon-a-filterIcon"}),e._v(" "),t("span",[e._v(e._s(e.$t("Filter")))])]),e._v(" "),t("i",{staticClass:"el-icon-arrow-down"})])])],1)],1)}),[],!1,null,"b7f42910",null).exports),yd={name:"mineFastAppFilter",computed:{paramsCount:function(){var e;return(null===(e=this.selectedStatus)||void 0===e?void 0:e.length)||0}},data:function(){return{queryParam:{order_by:"new",publish_status:0},orders:[{key:"New",value:"new"},{key:"Hot",value:"hot"}],statusArr:[{key:"Publish",value:1},{key:"offShelf",value:2}],selectedStatus:[]}},methods:{handleFilter:function(e,t){"sort"===t?this.queryParam.order_by=e:(this.selectedStatus.includes(e)?this.selectedStatus=this.selectedStatus.filter((function(t){return t!==e})):this.selectedStatus.push(e),[0,2].includes(this.selectedStatus.length)?this.queryParam.publish_status=0:this.queryParam.publish_status=this.selectedStatus[0]);this.$emit("handleFilter",this.queryParam)},filterReset:function(){this.selectedStatus=[],this.queryParam={publish_status:0,order_by:"new"},this.$emit("handleFilter",this.queryParam)}}},wd=(n(3141),Object(y.a)(yd,(function(){var e=this,t=e._self._c;return t("el-popover",{attrs:{placement:"bottom","popper-class":"waterfull-filter",trigger:"hover"}},[t("div",{staticClass:"filter-content"},[t("div",{staticClass:"title"},[e._v(e._s(e.$t("Sorting")))]),e._v(" "),t("div",{staticClass:"filter"},e._l(e.orders,(function(n){return t("div",{key:n.value,staticClass:"item-filter",class:{active:e.queryParam.order_by===n.value},on:{click:function(t){return e.handleFilter(n.value,"sort")}}},[e.queryParam.order_by===n.value?t("i",{staticClass:"el-icon-check"}):e._e(),e._v("\n          "+e._s(e.$t(n.key))+"\n        ")])})),0),e._v(" "),t("div",{staticClass:"title"},[e._v(e._s(e.$t("status")))]),e._v(" "),t("div",{staticClass:"filter"},e._l(e.statusArr,(function(n){return t("div",{key:n.value,staticClass:"item-filter",class:{active:e.selectedStatus.includes(n.value)},on:{click:function(t){return e.handleFilter(n.value,"status")}}},[e.selectedStatus.includes(n.value)?t("i",{staticClass:"el-icon-check"}):e._e(),e._v("\n          "+e._s(e.$t(n.key))+"\n        ")])})),0),e._v(" "),t("div",{staticClass:"filter-reset",on:{click:e.filterReset}},[e._v("\n        "+e._s(e.$t("resetSelection"))+"\n      ")])]),e._v(" "),t("el-badge",{staticClass:"item",attrs:{slot:"reference",hidden:0===e.paramsCount,value:e.paramsCount},slot:"reference"},[t("div",{staticClass:"filter-box"},[t("div",[t("i",{staticClass:"iconfont icon-a-filterIcon"}),e._v(" "),t("span",[e._v(e._s(e.$t("Filter")))])]),e._v(" "),t("i",{staticClass:"el-icon-arrow-down"})])])],1)}),[],!1,null,"1f4f4c16",null).exports),Cd={name:"mineCharacterFilter",data:function(){return{queryParam:{order_by:"new",publish_status:0},orders:[{key:"New",value:"new"},{key:"Hot",value:"hot"}],statusArr:[{key:"Publish",value:1},{key:"offShelf",value:2}],selectedStatus:[]}},computed:{paramsCount:function(){var e;return(null===(e=this.selectedStatus)||void 0===e?void 0:e.length)||0}},methods:{handleFilter:function(e,t){"sort"===t?this.queryParam.order_by=e:(this.selectedStatus.includes(e)?this.selectedStatus=this.selectedStatus.filter((function(t){return t!==e})):this.selectedStatus.push(e),[0,2].includes(this.selectedStatus.length)?this.queryParam.publish_status=0:this.queryParam.publish_status=this.selectedStatus[0]);this.$emit("handleFilter",this.queryParam)},filterReset:function(){this.selectedStatus=[],this.queryParam={order_by:"new",publish_status:0},this.$emit("handleFilter",this.queryParam)}}},kd=(n(3142),Object(y.a)(Cd,(function(){var e=this,t=e._self._c;return t("el-popover",{attrs:{placement:"bottom","popper-class":"waterfull-filter",trigger:"hover"}},[t("div",{staticClass:"filter-content"},[t("div",{staticClass:"title"},[e._v(e._s(e.$t("Sorting")))]),e._v(" "),t("div",{staticClass:"filter"},e._l(e.orders,(function(n){return t("div",{key:n.value,staticClass:"item-filter",class:{active:e.queryParam.order_by===n.value},on:{click:function(t){return e.handleFilter(n.value,"sort")}}},[e.queryParam.order_by===n.value?t("i",{staticClass:"el-icon-check"}):e._e(),e._v("\n          "+e._s(e.$t(n.key))+"\n        ")])})),0),e._v(" "),t("div",{staticClass:"title"},[e._v(e._s(e.$t("status")))]),e._v(" "),t("div",{staticClass:"filter"},e._l(e.statusArr,(function(n){return t("div",{key:n.value,staticClass:"item-filter",class:{active:e.selectedStatus.includes(n.value)},on:{click:function(t){return e.handleFilter(n.value,"status")}}},[e.selectedStatus.includes(n.value)?t("i",{staticClass:"el-icon-check"}):e._e(),e._v("\n          "+e._s(e.$t(n.key))+"\n        ")])})),0),e._v(" "),t("div",{staticClass:"filter-reset",on:{click:e.filterReset}},[e._v("\n        "+e._s(e.$t("resetSelection"))+"\n      ")])]),e._v(" "),t("el-badge",{staticClass:"item",attrs:{slot:"reference",hidden:0===e.paramsCount,value:e.paramsCount},slot:"reference"},[t("div",{staticClass:"filter-box"},[t("div",[t("i",{staticClass:"iconfont icon-a-filterIcon"}),e._v(" "),t("span",[e._v(e._s(e.$t("Filter")))])]),e._v(" "),t("i",{staticClass:"el-icon-arrow-down"})])])],1)}),[],!1,null,"8799c3c0",null).exports),Sd=["ord"];function xd(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,a){if(e){if("string"==typeof e)return Id(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Id(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,l=function(){};return{s:l,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw r}}}}function Id(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,n=Array(a);t<a;t++)n[t]=e[t];return n}function Od(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Td(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Od(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Od(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $d={name:"CombinedSelectionDialog",mixins:[ce.a],provide:function(){return{CombinedSelectionDialog:this}},inject:["easyTop"],components:{RecentlyItem:vd,NoData:Rc,SquareList:od,CharacterItem:Gc,ModelItem:Yc,FastAppItem:zc,FilterModel:bd,FilterFastApp:wd,FilterCharacter:kd,comfyItem:cd.a,CollectPopover:an.a,modelPayNum:on.a,changeVer:sn.a,SwiperList:ln.a,LenovoInput:cn.a,CombinedSelectionSearch:rd,CombinedSelectionLenovoSearch:Nc},props:{modelType:{type:String,default:"Checkpoint"}},data:function(){return{activePage:null,hideScroll2:!1,scrollTop:0,pageConfigCache:null,pageConfigCacheTimestamp:null,pageConfigUpdateData:null,mockFeaturesTagObj:{content_type:"6",id:"features",i18nKey:"Recommend",type:"custom_tag"},enableUsePresetConfig:!0,currentCategoryCode:"",codeMap:{character:"character",model:"model",aiApp:"fast_app",squareMixRecommend:"squareMixRecommend"},codeMapRevert:{character:"character",model:"model",fast_app:"aiApp",squareMixRecommend:"squareMixRecommend"},myQueryParams:{model:{order_by:"new",publish_status:0,model_types:[this.modelType],base_models:[]},character:{account_no:"",order_by:"new",publish_status:0},fast_app:{order_by:"new",publish_status:0,comfy_ui_type:2}},collectCommonParams:{order_by:"new",folder_no:"default",start_at:0,end_at:0,after:0,artwork_types:[],model_types:[this.modelType]},collectQueryParams:{model:Td({type:"bookmarks",time_to:0},this.collectCommonParams),character:Td({type:0,time_to:0},this.collectCommonParams),fast_app:Td({type:"bookmarks",time_to:0,source_type:8},this.collectCommonParams)},itemScroll:null,list:[],modulesList:[],squareList:[],selectedId:null,visible:!1,pageConfig:[{code:"collect",i18nKey:"Collect",id:"666"},{code:"mine",i18nKey:"Mine",id:"888"}],categoryOption:[{code:"model",i18nKey:"motivatingTitle1"},{code:"fast_app",i18nKey:"aiapply"},{code:"character",i18nKey:"digitalHuman"}],categoryOptionRender:[],pageLoading:!1,hasMore:!0,pageInfo:{page:1,page_size:35,total:0},debounceHandleScroll:null,gridNum:6,modalWidth:"1326px",activeTabStatic:"model",activeTabDynamic:"features",activeTabDynamicTitle:"",keyword:"",dynamicListMap:{modelList:yo.getModelSquare,modelRecommend:yo.getModelSquareRecommend,characterList:yo.getCharacterSquare,characterRecommend:yo.getCharacterSquareRecommend,recent:yo.getRecentSquare,fastAppList:yo.getFastAppSquare,follow:yo.getModelSquareAttention}}},watch:{userInfo:{handler:function(e){var t;if(null!==(t=Object.keys(e))&&void 0!==t&&t.length){var n=e.settings,o=(void 0===n?{}:n).use_model_preset_meta_mode,l=void 0===o?1:o;this.enableUsePresetConfig=1===l}},deep:!0,immediate:!0},easyTopActiveCategory:{handler:function(e){this.dynamicModel?(this.activeTabDynamic="features",this.activeTabStatic="model"):(this.activeTabStatic=e,this.activeTabDynamic="features")},immediate:!0}},computed:Td(Td(Td(Td({},Object(S.c)(["isSupportWebp"])),Object(S.e)("user",["collectData","cdnHost","token"])),Object(S.c)("user",["userInfo","isLoggedIn"])),{},{curPageIndex:function(){var e=this;return this.pageConfig.findIndex((function(t){var n;return t.id===(null===(n=e.curPage)||void 0===n?void 0:n.id)}))},searchIng:function(){return this.keyword||!1},isHideScroll:function(){return 0===this.scrollTop||this.hideScroll2},active_id:function(){var e,t;return["666","888"].includes(null===(e=this.curPage)||void 0===e?void 0:e.id)?"-":null===(t=this.curPage)||void 0===t?void 0:t.id},isShowMackTag:function(){var e,t,n=null===(e=this.curPage)||void 0===e?void 0:e.modules.find((function(e){return"6"===e.content_type}));return"squareMixRecommend"!==(null===(t=this.curPage)||void 0===t?void 0:t.code)&&!n},emptyNumber:function(){var e,t;return 6===this.gridNum?18-(null===(e=this.list)||void 0===e?void 0:e.length):15-(null===(t=this.list)||void 0===t?void 0:t.length)},activeTabs:function(){var e=this.pageConfig.map((function(e){return e.code}))||[],t=this.pageConfig.map((function(e){return e.route}))||[];return[].concat(Object(R.a)(e),Object(R.a)(t))},easyTopActiveCategory:function(){var e;return(null===(e=this.easyTop)||void 0===e?void 0:e.activeCategory)||"model"},curPage:function(){var e=this,t=this.pageConfig.find((function(t){return e.currentCategoryCode||e.activePage?e.isCheck(t):e.easyTopActiveCategory?t.code===e.codeMapRevert[e.easyTopActiveCategory]:void 0}));return!t&&this.easyTopActiveCategory&&(t=this.pageConfig.find((function(e){return"squareMixRecommend"===e.code}))),t||2!==this.pageConfig.length||(t=this.pageConfig[1]),t},dynamicModel:function(){var e;return!["mine","collect"].includes(null===(e=this.curPage)||void 0===e?void 0:e.code)},isUseTagFilter:function(){return this.dynamicModel&&"features"!==this.activeTabDynamic},activeTabClass:function(){return function(e,t){var n=e.id,o=void 0===n?"":n,l=e.code,code=void 0===l?"":l,r=this.dynamicModel?o:code;return r&&r===("static"===t?this.activeTabStatic:this.activeTabDynamic)?"tab-active":""}}}),beforeDestroy:function(){this.debounceHandleScroll=null,this.debounceResize=null,this.$refs.wrapper&&this.$refs.wrapper.removeEventListener("scroll",this.debouncedHandleScroll),this.debouncedHandleScroll.cancel(),this.$EventBus.$off("openCombinedSelectDialog"),this.$EventBus.$off("closeCombinedSelectDialog")},mounted:function(){var e,t=this;this.$EventBus.$on("openCombinedSelectDialog",this.openModal),this.$EventBus.$on("closeCombinedSelectDialog",this.handleClose),null===(e=this.$refs.wrapper)||void 0===e||e.addEventListener("scroll",this.debouncedHandleScroll),this.initUsePresetConfigStatus(),this.debounceHandleScroll=Object(X.debounce)(this.handleScroll,600),this.debounceResize=Object(X.debounce)(this.handleResize,500),window.addEventListener("resize",this.debounceResize),this.$nextTick((function(){t.handleResize()}))},created:function(){this.debouncedHandleScroll=Object(X.debounce)(this.handleScroll,200)},methods:Td(Td({},Object(S.b)("user",["recordEnableUsePresetConfig"])),{},{initCategoryOptionRender:function(){var e=this.$cookies.get("enable_tavern_user"),t=this.$cookies.get("enable_tavern_visitor");if(this.isLoggedIn){if(!e)return"character"!==this.activeTabStatic&&"character"!==this.easyTopActiveCategory||(this.activeTabStatic="model"),[{code:"model",i18nKey:"motivatingTitle1"},{code:"fast_app",i18nKey:"aiapply"}]}else if(1===t)return"character"!==this.activeTabStatic&&"character"!==this.easyTopActiveCategory||(this.activeTabStatic="model"),[{code:"model",i18nKey:"motivatingTitle1"},{code:"fast_app",i18nKey:"aiapply"}];return this.categoryOption},handleLogEventFn:function(e){var t={operation:"more",position:e,obj_type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:""};this.$logEvent("log_actions",t)},handleMouseLeave:function(){this.hideScroll2=!0},handleMouseEnter:function(){this.hideScroll2=!1},setPageConfigCache:function(data){var e={data:data,timestamp:Date.now()};localStorage.setItem("taskConfigCache",JSON.stringify(e)),this.pageConfigCache=data,this.pageConfigCacheTimestamp=e.timestamp},getPageConfigCache:function(){var e=localStorage.getItem("taskConfigCache");if(e){var t=JSON.parse(e);return this.pageConfigCache=t.data,this.pageConfigCacheTimestamp=t.timestamp,t}return null},isCacheExpired:function(){if(!this.pageConfigCacheTimestamp)return!0;return Date.now()-this.pageConfigCacheTimestamp>3e5},unFavorite:function(e){var t=e.id;if("collect"===this.curPage.code){var n=this.list.findIndex((function(e){return e.id===t}));this.list.splice(n,1)}},handleScrollTop:function(){var e=this;this.$nextTick((function(){e.$refs.wrapper.scrollTop=0}))},handleScroll:function(e){var t=e.target;if(t){var n=t.scrollHeight-(t.scrollTop+t.clientHeight);this.scrollTop=t.scrollTop,n<200&&!this.isLoading&&this.load()}},load:function(){var e;this.pageLoading||"squareMixRecommend"===this.curPage.code||("collect"!==this.curPage.code?"mine"!==this.curPage.code?null===(e=this.$refs.squareList)||void 0===e||e.updateList("add"):this.getMyList():this.getCollectList())},handleClickMore:function(e){console.log("handleClickMore--",e.link),this.activePage=e.link,this.currentCategoryCode=e.link,this.initData()},isCheck:function(e){return e.code===this.currentCategoryCode||e.id===this.currentCategoryCode||e.route===this.activePage},initUsePresetConfigStatus:function(){var e,t=localStorage.getItem("enableUsePresetConfig");this.isLoggedIn?(this.enableUsePresetConfig=[1,"1"].includes(null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.use_model_preset_meta_mode),localStorage.setItem("enableUsePresetConfig",this.enableUsePresetConfig?1:2)):this.enableUsePresetConfig=!!["",null,void 0].includes(t)||[1,"1"].includes(t)},handleFilter:function(e){var t,n;console.log("筛选回调--",e,this.myQueryParams[this.activeTabStatic],this.pageInfo),this.resetParams(),this.pageInfo.page=1,"mine"===(null===(t=this.curPage)||void 0===t?void 0:t.code)&&(this.myQueryParams[this.activeTabStatic]=Td(Td(Td({},this.myQueryParams[this.activeTabStatic]),e),this.pageInfo),this.getMyList()),"collect"===(null===(n=this.curPage)||void 0===n?void 0:n.code)&&(this.collectQueryParams[this.activeTabStatic]=Td(Td(Td({},this.collectQueryParams[this.activeTabStatic]),e),this.pageInfo),this.getCollectList())},changeScroll:function(){var e=this;this.$refs.listItem.forEach((function(t,n){t.classList.contains("tab-active")&&(e.itemScroll={value:t.getBoundingClientRect().left,index:n})}))},resetParams:function(){var e=this;this.categoryOptionRender=this.initCategoryOptionRender(),this.$nextTick((function(){var t,n;null===(t=e.$refs.lenovoSearch)||void 0===t||t.resetSearch(),null===(n=e.$refs.Search)||void 0===n||n.resetSearch()})),this.keyword="",this.hasMore=!0,this.list=[],this.pageInfo={page:1,page_size:35,total:0},this.collectQueryParams={model:Td({type:"bookmarks",model_types:[this.modelType]},this.collectCommonParams),character:Td({type:0},this.collectCommonParams),fast_app:Td({type:"bookmarks",source_type:8},this.collectCommonParams)},this.collectCommonParams={order_by:"new",folder_no:"default",start_at:0,end_at:0,after:0,artwork_types:[],model_types:[this.modelType]},this.myQueryParams={model:{order_by:"new",publish_status:0,model_types:[this.modelType],base_models:[]},character:{account_no:"ziyu",order_by:"new",publish_status:0},fast_app:{order_by:"new",publish_status:0,comfy_ui_type:2}}},handleClickTab:function(e){var t,n,o=this;(console.log("标签点击处理",e),this.pageLoading)?console.error("Frequent operations"):(this.dynamicModel?(this.activeTabDynamic=e.id,this.activeTabDynamicTitle=e.title):this.activeTabStatic=e.code,this.$nextTick((function(){o.changeScroll()})),this.dynamicModel?this.initData("tab"):(this.resetParams(),"mine"===(null===(t=this.curPage)||void 0===t?void 0:t.code)&&this.getMyList(),"collect"===(null===(n=this.curPage)||void 0===n?void 0:n.code)&&this.getCollectList()))},initData:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=e.length>0&&void 0!==e[0]?e[0]:"",t.handleScrollTop(),t.resetParams(),n.t0=null===(o=t.curPage)||void 0===o?void 0:o.code,n.next="mine"===n.t0?6:"collect"===n.t0?9:12;break;case 6:return n.next=8,t.getMyList();case 8:case 11:return n.abrupt("break",25);case 9:return n.next=11,t.getCollectList();case 12:if("tab"!==r||"features"===t.activeTabDynamic){n.next=15;break}return null===(c=t.$refs.squareList)||void 0===c||c.updateList("tab"),n.abrupt("return");case 15:if(["mine","collect"].includes(null===(l=t.curPage)||void 0===l?void 0:l.code)){n.next=23;break}if(d=t.getStaticModules(),console.log("staticModulesArr--",d),d.every((function(e){return e.elList&&Array.isArray(e.elList)&&e.elList.length>0}))){n.next=23;break}return console.log("没有reList数据 执行config更新"),n.next=23,t.getPageInfo(!1,!0);case 23:return n.next=25,t.getModuleList();case 25:case"end":return n.stop()}}),n)})))()},getStaticModules:function(){var e=[];if(this.curPage&&Array.isArray(this.curPage.modules)){var t,n=xd(this.curPage.modules);try{for(n.s();!(t=n.n()).done;){var o=t.value;"static"===o.type&&"6"!==o.content_type&&e.push(o)}}catch(e){n.e(e)}finally{n.f()}}return console.log("staticModulesArr--",e),e},getPageInfo:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,data,d,h,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.length>0&&void 0!==e[0]&&e[0],l=e.length>1&&void 0!==e[1]&&e[1],t.pageLoading=!0,n.prev=3,n.next=6,Object(yo.getComponentsConfig)({parent_id:"task",type:"page",active_id:t.active_id,with_ver_info:1});case 6:if(r=n.sent,c=r.status,data=r.data,1e4!==(null==c?void 0:c.code)){n.next=32;break}if(d=(null==data?void 0:data.items.map((function(e){return Td(Td({},e),{},{code:t.codeMap[null==e?void 0:e.content_type]})})).sort((function(a,b){return a.ord-b.ord})).map((function(e){e.ord;return Object(Oc.a)(e,Sd)})))||[],h=[].concat(Object(R.a)(d),[{code:"collect",i18nKey:"Collect",id:"666"},{code:"mine",i18nKey:"Mine",id:"888"}]),!l){n.next=20;break}return console.log("获取某个页面的配置操作"),m=t.pageConfig.findIndex((function(e){return e.id===t.curPage.id})),t.pageConfig[m]=h[m],t.curPage.modules=h[m].modules,t.setPageConfigCache(t.pageConfig),n.next=19,t.getModuleList();case 19:return n.abrupt("return");case 20:if(!o){n.next=24;break}return console.log("更新缓存操作"),t.pageConfigUpdateData=h,n.abrupt("return");case 24:if(o){n.next=31;break}return console.log("初始化操作"),t.pageConfig=h,t.setPageConfigCache(h),n.next=30,t.initData();case 30:return n.abrupt("return");case 31:console.log("--------------------------------",t.pageConfig);case 32:n.next=37;break;case 34:n.prev=34,n.t0=n.catch(3),console.error("getPageInfo-ERROR",n.t0);case 37:return n.prev=37,t.pageLoading=!1,n.finish(37);case 40:case"end":return n.stop()}}),n,null,[[3,34,37,40]])})))()},handleSearch:function(e,t){var n,o;(console.log("handleSearch--",e,t),e||this.resetParams(),this.keyword=e,this.pageInfo.page=1,this.hasMore=!0,"components"===t&&this.$refs.squareList.updateList("search"),"myOrCollect"===t)&&("mine"===(null===(n=this.curPage)||void 0===n?void 0:n.code)&&this.getMyList(),"collect"===(null===(o=this.curPage)||void 0===o?void 0:o.code)&&this.getCollectList());this.handleScrollTop()},handleItemSelect:function(e){console.log("弹窗获取到选中的对象",e),this.$EventBus.$emit("updateCategoryInfo",e),this.handleClose()},handleResize:function(){try{window.innerWidth>1400?(this.modalWidth="1326px",this.gridNum=6):(this.modalWidth="1110px",this.gridNum=5)}catch(e){}},handleClickTopTab:function(e){console.log("handleClickTopTab--",e),this.pageLoading?console.error("Frequent operations"):(this.$logEvent("log_actions",{operation:"click_navigation_tab",position:"create_flow,".concat(this.curPage.id||this.curPage.code,",").concat(this.curPage.title||this.curPage.code,",").concat(this.curPageIndex)}),this.currentCategoryCode=(null==e?void 0:e.code)||null,this.activePage=(null==e?void 0:e.route)||null,this.dynamicModel?this.activeTabDynamic="features":this.activeTabStatic="model",this.initData())},getCollectList:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,d,h,m,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.pageLoading){t.next=3;break}return console.error("Frequent operations"),t.abrupt("return");case 3:if(e.hasMore){t.next=6;break}return console.log("Not more data"),t.abrupt("return");case 6:return console.log("getCollectList--this.list",e.list),o={character:ue.e,fast_app:ue.q,model:Be.r},l=o[e.activeTabStatic],(r=Td(Td(Td({},e.collectQueryParams[e.activeTabStatic]),e.pageInfo),{},{after:(null===(n=e.list[e.list.length-1])||void 0===n||null===(n=n.collect)||void 0===n?void 0:n.collect_at)||0})).keyword=e.keyword,t.prev=11,e.pageLoading=!0,t.next=15,l(r);case 15:d=t.sent,1e4===(null===(c=d.status)||void 0===c?void 0:c.code)&&(1===r.page&&null!==(h=d.data)&&void 0!==h&&h.time_ms&&(e.collectQueryParams[e.activeTabStatic].time_to=d.data.time_ms),e.list=1===e.pageInfo.page?(null===(m=d.data)||void 0===m?void 0:m.items)||[]:[].concat(Object(R.a)(e.list),Object(R.a)((null===(v=d.data)||void 0===v?void 0:v.items)||[]))||[],e.hasMore=d.data.has_more,e.hasMore&&e.pageInfo.page++),e.pageLoading=!1,t.next=24;break;case 20:t.prev=20,t.t0=t.catch(11),e.pageLoading=!1,console.log("getCollectList--ERROR",t.t0);case 24:case"end":return t.stop()}}),t,null,[[11,20]])})))()},getMyList:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,d,h,m,v,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.pageLoading){t.next=3;break}return console.error("Frequent operations"),t.abrupt("return");case 3:if(e.hasMore){t.next=6;break}return console.error("Not more data"),t.abrupt("return");case 6:if(n={character:yo.squareCharacterList,fast_app:ue.o,model:Be.j},o=n[e.activeTabStatic],l=Td(Td({},e.myQueryParams[e.activeTabStatic]),e.pageInfo),"character"!==e.activeTabStatic){t.next=14;break}if(null!==(r=e.userInfo)&&void 0!==r&&r.id){t.next=13;break}return console.log("拦截没有用户id"),t.abrupt("return");case 13:l.account_no=null===(c=e.userInfo)||void 0===c?void 0:c.id;case 14:return"model"===e.activeTabStatic&&(l.with_ver_info=1),l.keyword=e.keyword,console.log("获取我的数据--params",l),t.prev=17,e.pageLoading=!0,t.next=21,o(l);case 21:h=t.sent,1e4===(null===(d=h.status)||void 0===d?void 0:d.code)&&(e.list=1===e.pageInfo.page?(null===(m=h.data)||void 0===m?void 0:m.items)||[]:[].concat(Object(R.a)(e.list),Object(R.a)((null===(v=h.data)||void 0===v?void 0:v.items)||[]))||[],console.log("获取我的数据",e.list),e.hasMore=null==h||null===(f=h.data)||void 0===f?void 0:f.has_more,e.hasMore&&e.pageInfo.page++,e.pageLoading=!1),t.next=29;break;case 25:t.prev=25,t.t0=t.catch(17),e.pageLoading=!1,console.log("getMyList--ERROR",t.t0);case 29:case"end":return t.stop()}}),t,null,[[17,25]])})))()},initializeAndUpdateArray:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.map((function(e){if(n&&e.id!==n)return e;if(e.modules&&Array.isArray(e.modules)){var o=e.modules.map((function(e){var n=t.find((function(data){return data.id===e.id}));return n&&n.items?Td(Td({},e),{},{elList:n.items}):Td(Td({},e),{},{elList:e.elList||[]})}));return Td(Td({},e),{},{modules:o})}return n===e.id&&1===t.length?Td(Td({},e),{},{elList:t[0].items}):e}))},getModuleList:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,d,h,m,v,f,_,y,w,C,k,S,x,I,O,T,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((o=(null===(n=e.curPage)||void 0===n?void 0:n.modules)||[]).length){t.next=4;break}return console.error("Cannot get list: no modules"),t.abrupt("return");case 4:e.pageLoading=!0,t.prev=5,l=[],r=[],c=xd(o);try{for(c.s();!(d=c.n()).done;)"6"!==(h=d.value).content_type&&("static"===h.type&&h.elList&&h.elList.length&&l.push(h),"static"!==h.type&&r.push(h))}catch(e){c.e(e)}finally{c.f()}if(console.log("获取模块数据--staticModules",l),console.log("获取模块数据--dynamicModules",r),!(l.length>0)){t.next=21;break}return m=l.flatMap((function(e){return e.elList})),v=m.map((function(e){return{obj_id:e.id||"",obj_type:e.obj_type}})),t.next=17,e.getStaticData2(v);case 17:if(f=t.sent){_=xd(l);try{for(_.s();!(y=_.n()).done;)w=y.value,C=e.mergeArrays(w.elList,f),w.elList=C||w.elList}catch(e){_.e(e)}finally{_.f()}}else console.error("getStaticData2 error");k=xd(l);try{for(k.s();!(S=k.n()).done;)x=S.value,e.pageConfig=e.initializeAndUpdateArray(e.pageConfig,[{id:x.id,items:x.elList}],e.curPage.id)}catch(e){k.e(e)}finally{k.f()}case 21:if(!(r.length>0)){t.next=41;break}I=xd(r),t.prev=23,I.s();case 25:if((O=I.n()).done){t.next=33;break}return T=O.value,t.next=29,e.getDynamicList(T.type);case 29:(data=t.sent)&&(e.pageConfig=e.initializeAndUpdateArray(e.pageConfig,[{id:T.id,items:data}],e.curPage.id));case 31:t.next=25;break;case 33:t.next=38;break;case 35:t.prev=35,t.t0=t.catch(23),I.e(t.t0);case 38:return t.prev=38,I.f(),t.finish(38);case 41:t.next=46;break;case 43:t.prev=43,t.t1=t.catch(5),console.error("Error fetching component list:",t.t1);case 46:return t.prev=46,e.pageLoading=!1,t.finish(46);case 49:case"end":return t.stop()}}),t,null,[[5,43,46,49],[23,35,38,41]])})))()},getStaticData2:function(e){return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(yo.getStaticDataMoreDetails)({items:e});case 3:if(l=t.sent,1e4!==(null===(n=l.status)||void 0===n?void 0:n.code)||null===(o=l.data)||void 0===o||!o.items){t.next=6;break}return t.abrupt("return",l.data.items.map((function(e){return{id:e.id,stat:e.stat,collect:e.collect,liked:e.liked,obj_type:e.obj_type}})));case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("Error fetching static data for getStaticData2:",t.t0);case 11:return t.abrupt("return",null);case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},getDynamicList:function(e){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("getDynamicList---",e),o={character:[9],model:[2],fast_app:[14],squareMixRecommend:[]},l=t.dynamicListMap[e]){n.next=6;break}return console.error("No API found for type: ".concat(e)),n.abrupt("return");case 6:if((r={order_by:"new",page:1,page_size:20}).source_types=o[t.curPage.code],"recent"!==e){n.next=12;break}if(t.isLoggedIn){n.next=11;break}return n.abrupt("return");case 11:r.page_size="squareMixRecommend"!==t.curPage.code?30:20;case 12:return"model"===t.curPage.code&&(r.with_ver_info=1,r.model_types=[t.modelType]),n.prev=13,n.next=16,l(r);case 16:if(d=n.sent,h=d.status,data=d.data,1e4!==(null==h?void 0:h.code)||null==data||null===(c=data.items)||void 0===c||!c.length){n.next=21;break}return n.abrupt("return",data.items);case 21:n.next=26;break;case 23:n.prev=23,n.t0=n.catch(13),console.error("Error fetching dynamic data for type ".concat(e,":"),n.t0);case 26:return n.abrupt("return",null);case 27:case"end":return n.stop()}}),n,null,[[13,23]])})))()},mergeArrays:function(e,t){var n=new Map(t.map((function(e){return["".concat(e.id).concat(e.obj_type),e]})));return e.map((function(e){var t=n.get("".concat(e.id).concat(e.obj_type));return t?Td(Td({},e),t):e}))},openModal:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.resetParams(),e.visible=!0,e.currentCategoryCode=null==e||null===(n=e.easyTop)||void 0===n?void 0:n.activeCategory,e.selectedId=(null==e||null===(o=e.easyTop)||void 0===o||null===(o=o.categoryInfo)||void 0===o?void 0:o.id)||null,l=localStorage.getItem("lastLang")||null,r=e.$cookies.get("lang")||null,!e.getPageConfigCache()){t.next=23;break}if(console.log("缓存存在!"),l&&(!l||l===r)){t.next=14;break}return console.log("强制刷新页面数据!",e.$i18n.locale),t.next=13,e.getPageInfo();case 13:return t.abrupt("return");case 14:return e.pageConfig=e.pageConfigCache,t.next=17,e.initData();case 17:if(!e.isCacheExpired()){t.next=21;break}return console.log("如果缓存过期 就请求一次getPageConfig 以便于等弹框关闭的时候进行更新数据"),t.next=21,e.getPageInfo(!0);case 21:t.next=26;break;case 23:return console.log("如果缓存不存在执行 getPageInfo"),t.next=26,e.getPageInfo();case 26:case"end":return t.stop()}}),t)})))()},handleClose:function(){this.resetParams(),this.activePage=null,this.pageConfigUpdateData&&(this.setPageConfigCache(this.pageConfigUpdateData),this.pageConfigUpdateData=null),this.$cookies.get("lang")&&!this.pageLoading&&localStorage.setItem("lastLang",this.$cookies.get("lang")),this.visible=!1}})},Ld=$d,Pd=(n(3143),Object(y.a)(Ld,(function(){var e,t,n,o,l,r,c,d,h,m=this,v=m._self._c;return v("el-dialog",{ref:"styleModal",attrs:{visible:m.visible,width:m.modalWidth,height:"auto","custom-class":"easy-style-modal","modal-append-to-body":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,"append-to-body":"",center:""},on:{"update:visible":function(e){m.visible=e}}},[v("template",{slot:"title"},[v("div",m._g({staticClass:"easy-style-modal-header"},{mouseleave:m.handleMouseLeave,mouseenter:m.handleMouseEnter}),[v("div",{staticClass:"easy-style-modal-header-tabs"},m._l(m.pageConfig,(function(e){var t;return v("div",{key:"top_tab_".concat(e.id),staticClass:"header-tabs-item",class:[((null===(t=m.curPage)||void 0===t?void 0:t.id)===(null==e?void 0:e.id)||m.currentCategoryCode===(null==e?void 0:e.code))&&"header-tabs-item-active"],on:{click:function(t){return t.stopPropagation(),m.handleClickTopTab(e)}}},[m._v("\n            "+m._s(m.$t(e.i18nKey)||(null==e?void 0:e.title))+"\n          ")])})),0),m._v(" "),m.dynamicModel?m._e():v("CombinedSelectionSearch",{ref:"Search",on:{search:function(e){return m.handleSearch(e,"myOrCollect")}}}),m._v(" "),m.dynamicModel&&"squareMixRecommend"!==(null===(e=m.curPage)||void 0===e?void 0:e.code)&&!m.isUseTagFilter?v("CombinedSelectionLenovoSearch",{ref:"lenovoSearch",on:{search:function(e){return m.handleSearch(e,"components")}}}):m._e(),m._v(" "),v("div",{staticClass:"header-close-btn",on:{click:function(e){return e.stopPropagation(),m.handleClose()}}},[v("i",{staticClass:"el-icon-close"})])],1)]),m._v(" "),v("div",m._g({ref:"wrapper",staticClass:"wrapper",on:{"&scroll":function(e){return m.handleScroll.apply(null,arguments)}}},{mouseleave:m.handleMouseLeave,mouseenter:m.handleMouseEnter}),[m.dynamicModel?m._e():v("div",{staticClass:"wrapper-top"},[v("div",{staticClass:"category-box"},m._l(m.categoryOptionRender,(function(e,t){return v("div",{key:"tab_".concat((null==e?void 0:e.id)||(null==e?void 0:e.code),"_").concat(t)},[v("div",{ref:"listItem",refInFor:!0,staticClass:"wrapper-top-item",class:[m.activeTabClass(e,"static")],on:{click:function(t){return t.stopPropagation(),m.handleClickTab(e)}}},[m._v("\n              "+m._s(m.$t(e.i18nKey))+"\n              ")])])})),0),m._v(" "),v("div",{staticClass:"wrapper-top-filter"},["model"===m.activeTabStatic?v("FilterModel",{attrs:{curCode:null===(t=m.curPage)||void 0===t?void 0:t.code,enableUsePresetConfigProps:m.enableUsePresetConfig},on:{handleFilter:m.handleFilter}}):m._e(),m._v(" "),"fast_app"===m.activeTabStatic&&"collect"!==(null===(n=m.curPage)||void 0===n?void 0:n.code)?v("FilterFastApp",{on:{handleFilter:m.handleFilter}}):m._e(),m._v(" "),"character"===m.activeTabStatic&&"collect"!==(null===(o=m.curPage)||void 0===o?void 0:o.code)?v("FilterCharacter",{on:{handleFilter:m.handleFilter}}):m._e()],1)]),m._v(" "),v("div",{staticClass:"wrapper-container"},[m.dynamicModel&&!m.searchIng?v("div",{directives:[{name:"loading",rawName:"v-loading",value:m.pageLoading,expression:"pageLoading"}],staticClass:"wrapper-container-1",style:{gap:m.isUseTagFilter?"0":"22px",marginTop:m.dynamicModel?"16px":"0px"}},[null!==(l=m.curPage)&&void 0!==l&&null!==(l=l.modules)&&void 0!==l&&l.length?[m.isShowMackTag?[v("div",{ref:"listItem",staticClass:"wrapper-top-item",class:[m.activeTabClass(m.mockFeaturesTagObj,"dynamic")],on:{click:function(e){return e.stopPropagation(),m.handleClickTab(m.mockFeaturesTagObj)}}},[m._v("\n              "+m._s(m.$t(m.mockFeaturesTagObj.i18nKey))+"\n            ")])]:m._e(),m._v(" "),m._l(null===(r=m.curPage)||void 0===r?void 0:r.modules,(function(e){var t,n,o;return[[6,"6"].includes(e.content_type)&&"squareMixRecommend"!==(null===(t=m.curPage)||void 0===t?void 0:t.code)?[v("SwiperList",{attrs:{iconBntWidth:28,scrollChange:m.itemScroll,top:"0"}},[v("div",{ref:"listItem",refInFor:!0,staticClass:"wrapper-top-item",class:[m.activeTabClass(m.mockFeaturesTagObj,"dynamic")],on:{click:function(e){return e.stopPropagation(),m.handleClickTab(m.mockFeaturesTagObj)}}},[m._v("\n                      "+m._s(m.$t(m.mockFeaturesTagObj.i18nKey))+"\n                    ")]),m._v(" "),m._l(e.elList,(function(e,t){return v("div",{key:"tab_".concat(null==e?void 0:e.id,"_").concat(t)},[v("div",{ref:"listItem",refInFor:!0,staticClass:"wrapper-top-item",class:[m.activeTabClass(e,"dynamic")],on:{click:function(t){return t.stopPropagation(),m.handleClickTab(e)}}},[m._v("\n                        "+m._s(e.i18nKey?m.$t(e.i18nKey):e.title)+"\n                      ")])])}))],2)]:m._e(),m._v(" "),m.isUseTagFilter?m._e():["recent"===e.type&&null!=e&&e.elList&&null!=e&&e.elList.length?v("SwiperList",{key:e.id,attrs:{scrollChange:m.itemScroll,bntTop:"-20px",iconBntWidth:28,height:"98px",top:"0px",listGap:"15px"}},m._l(null==e?void 0:e.elList,(function(t,n){var o,l;return v("div",{key:"recently_".concat(n),staticClass:"card-item card-item-rence"},[v("RecentlyItem",{attrs:{enableUsePresetConfigProps:m.enableUsePresetConfig,item:t,logEventPosition:"create_flow,".concat(null===(o=m.curPage)||void 0===o?void 0:o.id,",").concat(null===(l=m.curPage)||void 0===l?void 0:l.title,",").concat(m.curPageIndex,",").concat(e.id,",").concat(e.title,",").concat(n)},on:{handleItemSelect:m.handleItemSelect}})],1)})),0):m._e(),m._v(" "),"recent"!==e.type&&![6,"6"].includes(e.content_type)&&null!=e&&e.elList&&null!=e&&e.elList.length?v("div",{key:e.id,staticClass:"recommend-box"},[v("div",{staticClass:"recommend-header"},[v("div",[m._v("\n                    "+m._s(e.title)+"\n                  ")]),m._v(" "),m.activeTabs.includes(e.link||"")&&(null===(n=m.curPage)||void 0===n?void 0:n.code)!==e.link&&(null===(o=m.curPage)||void 0===o?void 0:o.route)!==e.link?v("div",{staticClass:"recommend-header-more",on:{click:function(t){var n,o;m.handleClickMore(e),m.handleLogEventFn("create_flow,".concat(null===(n=m.curPage)||void 0===n?void 0:n.id,",").concat(null===(o=m.curPage)||void 0===o?void 0:o.title,",").concat(m.curPageIndex,",").concat(e.id,",").concat(e.title),null==e?void 0:e.elList[0].obj_type)}}},[m._v("\n                    "+m._s(m.$t("more"))+"\n                    "),v("i",{staticClass:"el-icon-arrow-right"})]):m._e()]),m._v(" "),v("SwiperList",{attrs:{scrollChange:m.itemScroll,top:"0",bntTop:"-20px",iconBntWidth:28,height:null!=e&&e.elList&&2===(null==e?void 0:e.elList[0].obj_type)&&5===m.gridNum?"340px":"280px",listGap:"16px"}},m._l(null==e?void 0:e.elList,(function(t,n){var o,l,r,c,d,h;return v("div",{key:"ele_".concat(null==t?void 0:t.id,"_").concat(n),staticClass:"card-item"},[2===(null==t?void 0:t.obj_type)?v("ModelItem",{attrs:{logEventPosition:"create_flow,".concat(null===(o=m.curPage)||void 0===o?void 0:o.id,",").concat(null===(l=m.curPage)||void 0===l?void 0:l.title,",").concat(m.curPageIndex,",").concat(m.isUseTagFilter?m.activeTabDynamic:e.id,",").concat(m.isUseTagFilter?m.activeTabDynamicTitle:e.title,",").concat(n),item:t,enableUsePresetConfigProps:m.enableUsePresetConfig,selectedId:m.selectedId},on:{handleItemSelect:m.handleItemSelect}}):m._e(),m._v(" "),9===(null==t?void 0:t.obj_type)?v("CharacterItem",{attrs:{logEventPosition:"create_flow,".concat(null===(r=m.curPage)||void 0===r?void 0:r.id,",").concat(null===(c=m.curPage)||void 0===c?void 0:c.title,",").concat(m.curPageIndex,",").concat(m.isUseTagFilter?m.activeTabDynamic:e.id,",").concat(m.isUseTagFilter?m.activeTabDynamicTitle:e.title,",").concat(n),item:t,selectedId:m.selectedId},on:{handleItemSelect:m.handleItemSelect}}):m._e(),m._v(" "),14===(null==t?void 0:t.obj_type)?v("FastAppItem",{attrs:{logEventPosition:"create_flow,".concat(null===(d=m.curPage)||void 0===d?void 0:d.id,",").concat(null===(h=m.curPage)||void 0===h?void 0:h.title,",").concat(m.curPageIndex,",").concat(m.isUseTagFilter?m.activeTabDynamic:e.id,",").concat(m.isUseTagFilter?m.activeTabDynamicTitle:e.title,",").concat(n),item:t,selectedId:m.selectedId},on:{handleItemSelect:m.handleItemSelect}}):m._e()],1)})),0)],1):m._e()]]}))]:m._e(),m._v(" "),null!==(c=m.curPage)&&void 0!==c&&null!==(c=c.modules)&&void 0!==c&&c.length||m.pageLoading?m._e():[v("NoData")]],2):m._e(),m._v(" "),m.dynamicModel?m._e():v("div",{staticClass:"wrapper-container-2",style:{minHeight:m.list.length?"80vh":"40vh"}},[v("div",{directives:[{name:"loading",rawName:"v-loading",value:m.pageLoading,expression:"pageLoading"}],staticClass:"loading-box"}),m._v(" "),m.list.length?[v("div",{staticClass:"components-list-wrapper",style:{gridTemplateColumns:"repeat(".concat(m.gridNum,", 1fr)")}},[m._l(m.list,(function(e,t){return v("div",{key:t,staticClass:"card-item"},["model"===m.activeTabStatic?v("ModelItem",{attrs:{item:e,selectedId:m.selectedId,enableUsePresetConfigProps:m.enableUsePresetConfig},on:{unFavorite:m.unFavorite,handleItemSelect:m.handleItemSelect}}):m._e(),m._v(" "),"character"===m.activeTabStatic?v("CharacterItem",{attrs:{item:e,selectedId:m.selectedId},on:{unFavorite:m.unFavorite,handleItemSelect:m.handleItemSelect}}):m._e(),m._v(" "),"fast_app"===m.activeTabStatic?v("FastAppItem",{attrs:{item:e,selectedId:m.selectedId},on:{unFavorite:m.unFavorite,handleItemSelect:m.handleItemSelect}}):m._e()],1)})),m._v(" "),m.emptyNumber>0?m._l(m.emptyNumber,(function(e){return v("div",{key:"empty"+e,staticClass:"card-item-empty",style:{height:m.list.length&&2===m.list[0].obj_type&&5===m.gridNum?"340px":"280px"}})})):m._e()],2)]:m._e(),m._v(" "),m.list.length||m.pageLoading?m._e():[v("NoData")]],2),m._v(" "),"squareMixRecommend"!==(null===(d=m.curPage)||void 0===d?void 0:d.code)&&m.dynamicModel?v("SquareList",{ref:"squareList",attrs:{enableUsePresetConfigProps:m.enableUsePresetConfig,activeTopTab:m.dynamicModel?null===(h=m.curPage)||void 0===h?void 0:h.code:m.activeTabStatic,gridNum:m.gridNum,"margin-top":m.searchIng||m.isUseTagFilter?"16px":"22px"},on:{handleItemSelect:m.handleItemSelect}}):m._e()],1)])],2)}),[],!1,null,"0977ab0a",null)),Md=Pd.exports;function jd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Dd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jd(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Nd={name:"EasyGenerate",props:{isShowSubBanner:{type:Boolean,default:!1},isShowPopup:{type:Boolean,default:!0},currentGenerateMode:{type:[String,Number],default:1}},mixins:[hs.a,Zl.a],components:{CombinedSelectDialog:Md,EasyGenerateTopBar:ka,ParamsPanel:ua,taskView:ao,EasyTopInputArea:Yo,UpscaleToolsModal:os,AnimeToolsModal:us,GRechargeBanner:nn.a,CommonParamsPanel:fl,GenerateResults:Ql,AiChat:Ic},provide:function(){return{easyTop:this}},data:function(){return{categoryDefaultMap:{character:{banner:{url:"https://image.cdn2.seaart.me/static/upload/20240923/6a0123e3-0c4d-45c1-9709-5f88824c0c0a.png"},id:"9f820adf84bf8a1c259f464ba89ea11f",name:"Reiko-01",code:"character"},fast_app:{banner:{url:"https://image.cdn2.seaart.me/static/upload/20240923/6a0123e3-0c4d-45c1-9709-5f88824c0c0a.png"},name:"测试Comfyui详情",id:"cs8h91dgflipcjs1jfh0",code:"fast_app"},model:{banner:{url:"https://image.cdn2.seaart.me/static/upload/20240923/6a0123e3-0c4d-45c1-9709-5f88824c0c0a.png"},name:"测试Comfyui详情",id:"cs8h91dgflipcjs1jfh0",code:"fast_app"}},categoryInfo:{banner:{url:""},name:"",id:""},isImageToImageToTextToImage:!1,channelId:"PRIVATE",config:{textToImage:{prompt_magic:2,generationMode:1,enableNegativePrompts:!1,isLockParams:!1,lockSeed:!1,vae:"vae-ft-mse-840000-ema-pruned",prompt:"",local_prompt:"",art_work_no:"",art_model_no:"",art_model_ver_no:"",base_model_type:"",modelName:"",is_agency_fee:!1,agency_fee:0,model_cover:"",art_model_ver_no_name:"",modelTags:[],lora_models:[],restore_faces:!1,sampler_name:"DPM++ 2M Karras",cfg_scale:7,steps:20,width:688,height:1024,lcm_mode:0,generate:{anime_enhance:2,mode:0,gen_mode:0,prompt_magic_mode:2},clip_skip:1,denoising_strength:.35,n_iter:2,up_scaler:"4x-UltraSharp",mask:"",tempMask:"",copyMask:"",compose_mask:"",channelZoom:!0,faceSwapZoom:!0,enablePromptMagic:!0,enable_hr:!1,hr_upscaler:"",hr_second_pass_steps:20,hr_upscaler_redraw:.5,hr_scale:1.5,lab_base:{conds:[],style_selections:["Studio Enhance","Studio Expand"],expand_token_length:10,hdr_enabled:!0,hdr_intensity:.5,auto_brightness_open:!0,auto_brightness_strength:75,auto_adjust_open:!1,auto_adjust_strength:20,semantics_open:!1,film_turbo:0,sharpness:2,scheduler:"karras",quality_open:!1,quality_detail_offset:.45,quality_mode:3,quality_type:"anime",intelligence_open:!1,prompt_magic:!0},embeddings:[],ad_model:"",ad_units:{lora:{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""},imageToImageList:[],controlnet_units:[],ipList:[],speed_type:2,generateing:!1}},menuIndex:"textToImage",defaultModule:"canny",UPLOAD:new pi.a({type:2}),fluxModelId:xe.h,randomPrompt:"",paymentInfoDone:!1,userInfoDone:!1,calcCost:0,throttledClick:null,isPosting:!1,taskTopPadding:0,defaultModel:null,needGoogleCaptcha:"",activeCategory:"model"}},computed:Dd(Dd(Dd(Dd({},Object(S.c)("creation",["taskBaseModels","animationLoraRecommends","taskModules","taskUnits","taskSdxlUnits","taskModels","sd_xl_base_model","image_mode","lab_base_model","lab_ctr_units","lab_style_enhancement_tag","default_flux","size_billing_rule","v2_sd_xl_ctr_units","v2_ctr_units"])),Object(S.c)("user",["accountSettingsData","userInfo","isCompanyAccount","isLoggedIn"])),Object(S.e)("payment",["paymentInfo"])),{},{isVip:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},isOnlyVipLite:function(){var e,t;return!(null!==(e=this.paymentInfo)&&void 0!==e&&e.activeState)&&!this.isCompanyAccount&&(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)},isSd35Model:function(){var e=this.config.textToImage.base_model_type;return["SD 3.5"].includes(e)||(e||"").includes("SD 3.5")},isSDXLModel:function(){var e=this.config.textToImage.base_model_type;return["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony","SDXL Hyper"].includes(e)||(e||"").includes("SDXL")},isSdModel:function(){var e=this.config.textToImage.base_model_type;return[].concat(Object(R.a)(xe.B.sd),Object(R.a)(xe.B.sd3),["SD 1.5 LCM","SD 1.5 Hyper"],Object(R.a)(xe.B.other)).includes(e)},isCommunityFlux:function(){var e=this.config.textToImage.base_model_type;return xe.B.flux.includes(e)},isShowAnimeEnhance:function(){var e=this.config.textToImage,t=this.getStudioModelTagsType(e);return this.isSDXLModel&&"anime"===t},isAnimeEnhanceEnable:function(){var e,t=this.config.textToImage,n=1===(null==t||null===(e=t.generate)||void 0===e?void 0:e.anime_enhance),o=this.isShowAnimeEnhance;return n&&o},isStudioFlux:function(){var e=this.fluxModelId,t=this.config.textToImage.base_model_type,n=((null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[]).includes(t),o=(this.config[this.menuIndex]||{}).art_model_no;return((void 0===o?"":o)===e||n)&&["textToImage"].includes(this.menuIndex)},getCurrentGenerateType:function(){var e=this.config[this.menuIndex],t=(e.imageToImageList||[]).filter((function(e){return null==e?void 0:e.enable})),n=(e.controlnet_units||[]).filter((function(e){return null==e?void 0:e.enable}));return this.isStudioFlux||this.isCommunityFlux||(null==t||!t.length)&&(null==n||!n.length)||this.isAnimeEnhanceEnable||this.isSd35Model?"textToImage":null!=t&&t.length?"imageToImage":null!=n&&n.length?"conditionToImage":"textToImage"},getCurrentEquivalentCategory:function(){var e=1,t=this.config.textToImage,n=this.getCurrentModelType(t.base_model_type);return this.isCommunityFlux||this.isStudioFlux||this.isAnimeEnhanceEnable?e=7:"SD"===n?(0===t.generate.mode&&(e=1),1===t.generate.mode&&(e=2),2===t.generate.mode&&(e=6),e):"SDXL"===n?e=5:void 0},currentPrompt:function(){return this.config.textToImage.prompt},currentPromptMagicStatus:function(){var e;return null===(e=this.config.textToImage.generate)||void 0===e?void 0:e.prompt_magic_mode},currentImageSizeStatus:function(){var e;return null===(e=this.config.textToImage.generate)||void 0===e?void 0:e.gen_mode},computedCost:function(){var e,t,n=this.config.textToImage,o=this.size_billing_rule.baselines||[],l=this.size_billing_rule.extra_rule||[],r=this.size_billing_rule.face_restoration||[],c=(null===(e=this.size_billing_rule)||void 0===e?void 0:e.imt_to_img_baselines)||[],d=(null===(t=this.size_billing_rule)||void 0===t?void 0:t.lab_billing_rule)||{},h=1,m=Math.max(n.width,n.height);(o||[]).forEach((function(e){m>e.min&&m<=e.max&&(h=e.value)})),["conditionToImage","imageToImage"].includes(this.getCurrentGenerateType)&&(c||[]).forEach((function(e){m>e.min&&m<=e.max&&(h=e.value)}));var v=1,f=this.getCurrentEquivalentCategory;(l||[]).forEach((function(e){e.task_category===f&&(v=e.value||1)}));var _=0,y=(null==n?void 0:n.agency_fee)||0;(n.lora_models||[]).forEach((function(e){e&&e.agency_fee>0&&(_+=e.agency_fee)}));var w=null;w=5===f?6*(n.n_iter||1):h*v*(n.n_iter||1),"LCM"===n.sampler_name&&(w*=.5);var C=w;if([4,5,7].includes(f)||(C=w+_+y),n.enable_hr&&""!==n.hr_upscaler&&[1,"1"].includes(f)){var k,S=n.hr_scale||6,x=n.width*S,I=n.height*S,O=1,T=(null===(k=this.size_billing_rule)||void 0===k?void 0:k.hd)||[],$=Math.max(x,I);(T||[]).forEach((function(e){$>e.min&&$<=e.max&&(O=e.value)}));var L=1;(l||[]).forEach((function(e){2===e.task_action&&e.task_category===f&&(L=e.value||1)})),C+=O*L*(n.n_iter||1)}if(!["",null,void 0].includes(n.ad_model)&&["textToImage","imageToImage"].includes(this.getCurrentGenerateType)&&![7,"7",5,"5","sdxl","studio"].includes(f)){var P=0;(r||[]).forEach((function(e){m>e.min&&m<=e.max&&(P=e.value||0)})),C+=P*(n.n_iter||1)}if(7===f){var M,j={conditionToImage:"contrlnet_to_img",textToImage:"text_to_img",imageToImage:"img_to_img"}[this.getCurrentGenerateType]||"",D=j&&d[j]||6,N=0;if([1].includes(null==n||null===(M=n.generate)||void 0===M?void 0:M.anime_enhance)&&"textToImage"===this.getCurrentGenerateType){N=2*(n.n_iter||1)}C=D*(n.n_iter||1)+N}return 3!==n.speed_type||this.isStudioFlux||this.isCommunityFlux||(C=0),C},currentModelType:function(){var e;return this.getCurrentModelType(null==this||null===(e=this.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.base_model_type)},currentWidth:function(){var e;return null===(e=this.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.width},currentHeight:function(){var e;return null===(e=this.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.height},currentUpscaler:function(){var e;return null===(e=this.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.hr_upscaler},currentFaceRepair:function(){var e;return null===(e=this.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.restore_faces},currentPersonRepair:function(){var e;return null===(e=this.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.ad_model},currentPersonRepairObj:function(){var e;return null===(e=this.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.ad_units},currentImageOrControlNet:function(){try{var e=this.config.textToImage,t=(e.imageToImageList||[]).filter((function(e){return null==e?void 0:e.enable})),n=(e.controlnet_units||[]).filter((function(e){return null==e?void 0:e.enable}));return this.isStudioFlux||this.isCommunityFlux||!(null!=t&&t.length||null!=n&&n.length)||this.isAnimeEnhanceEnable?"textToImage":null!=t&&t.length?"imageToImage":null!=n&&n.length?"conditionToImage":"textToImage"}catch(e){return"textToImage"}},currentModelTypeChange:function(){var e;return null===(e=this.config)||void 0===e||null===(e=e.textToImage)||void 0===e?void 0:e.base_model_type},hasEnableImageToImage:function(){var e;return((null===(e=this.config.textToImage)||void 0===e?void 0:e.imageToImageList)||[]).some((function(e){return null==e?void 0:e.enable}))},hasEnableControlNetToImage:function(){var e;return((null===(e=this.config.textToImage)||void 0===e?void 0:e.controlnet_units)||[]).some((function(e){return null==e?void 0:e.enable}))},isEnableQuality:function(){try{var e;return 1===(null===(e=this.config)||void 0===e||null===(e=e.textToImage)||void 0===e||null===(e=e.generate)||void 0===e?void 0:e.gen_mode)}catch(e){}},taskControlNetModules:function(){return null!=this&&this.isSDXLModel?this.v2_sd_xl_ctr_units:this.v2_ctr_units},hasActiveIpMain:function(){var e,t,n=null==this||null===(e=this.config)||void 0===e?void 0:e.textToImage;return["SA"===this.getCurrentModelType(null==n?void 0:n.base_model_type)&&n.art_model_no===this.fluxModelId,((null==n?void 0:n.ipList)||[]).some((function(e){return null==e?void 0:e.enable})),!(null!=n&&null!==(t=n.lora_models)&&void 0!==t&&t.length)].every((function(e){return e}))},hasIpMaintain:function(){var e,t,n,o=null==this||null===(e=this.config)||void 0===e?void 0:e.textToImage;return["SA"===this.getCurrentModelType(null==o?void 0:o.base_model_type)&&o.art_model_no===this.fluxModelId,null==o||null===(t=o.ipList)||void 0===t?void 0:t.length,!(null!=o&&null!==(n=o.lora_models)&&void 0!==n&&n.length)].every((function(e){return e}))}}),watch:{paymentInfo:{handler:function(e){var t;null!==(t=Object.keys(e))&&void 0!==t&&t.length&&(this.paymentInfoDone=!0,this.changeSpeedType())},deep:!0,immediate:!0},userInfo:{handler:function(e){var t;if(null!==(t=Object.keys(e))&&void 0!==t&&t.length){this.userInfoDone=!0,this.changeSpeedType();var n=e.settings,o=(void 0===n?{}:n).insight;this.readOff=1===o}},deep:!0,immediate:!0},computedCost:{handler:function(e,t){this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0},currentPrompt:{handler:function(e,t){e&&""===t&&this.throttledClick&&this.throttledClick()},immediate:!0},currentPromptMagicStatus:{handler:function(e,t){this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0},currentImageSizeStatus:{handler:function(e,t){this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0},currentWidth:{handler:function(e,t){1===this.currentImageSizeStatus&&this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0},currentHeight:{handler:function(e,t){1===this.currentImageSizeStatus&&this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0},currentUpscaler:{handler:function(e,t){this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0},currentFaceRepair:{handler:function(e,t){this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0},currentPersonRepair:{handler:function(e,t){this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0},currentPersonRepairObj:{handler:function(e,t){var n;null!==(n=this.config)&&void 0!==n&&null!==(n=n.textToImage)&&void 0!==n&&n.ad_model&&this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0,deep:!0},currentImageOrControlNet:{handler:function(e,t){this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0,deep:!0},currentModelTypeChange:{handler:function(e,t){this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0,deep:!0},hasActiveIpMain:{handler:function(e,t){this.config.textToImage.prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0},isLoggedIn:{handler:function(e,t){!e&&t&&this.checkNeedGoogleCaptcha()},immediate:!0}},created:function(){this.throttledClick=Object(X.throttle)(this.getCalcCost,2e3)},mounted:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$EventBus.$on("updateCategoryInfo",e.updateCategoryInfo),e.isLoggedIn&&(null==e||null===(n=e.lab_base_model)||void 0===n||!n.length)){t.next=4;break}return t.next=4,e.$store.dispatch("creation/getTaskOptionsInfo");case 4:return t.next=6,e.init();case 6:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.throttledClick=null,this.$EventBus.$off("updateCategoryInfo",this.updateCategoryInfo)},methods:{updateCategoryInfo:function(e){var t=this;console.log("创作流顶级更新！！！",e);var n=e.obj,o=e.type;if(null!==n||null!==o){this.categoryInfo=null!=n&&n.id?n:this.categoryInfo;var l=this.activeCategory;this.activeCategory=o,(n||"model"!==this.activeCategory)&&(this.$nextTick((function(){"character"===o&&t.$EventBus.$emit("refreshData",null==n?void 0:n.id),l!==o&&"fast_app"===o&&t.$refs.GenerateResultsRef.handleRefresh()})),this.$EventBus.$emit("closeCombinedSelectDialog"))}},closeAllPopup:function(){try{this.$refs.upscaleToolsModal.close()}catch(e){}},handleChannelSearch:function(e){var t;null==this||null===(t=this.$refs)||void 0===t||null===(t=t.taskView)||void 0===t||t.handleSearch(e),this.$logEvent("log_actions",{operation:"type_search",behavior_info:"on_new_create_flow_page"})},handleUpdateTaskPadding:function(e){this.taskTopPadding=e||0},updateSpeedType:function(e){for(var i in this.config)this.config[i]=Dd(Dd({},this.config[i]),{},{speed_type:e})},closeSubBanner:function(){this.$emit("closeSubBanner")},backOld:function(){this.saveConfig(),this.$emit("backOld",1)},closePopup:function(){this.$EventBus.$emit("closeAllGeneratePopup"),this.$emit("close")},init:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.$EventBus.$off("openEasyAnimeToolsModal"),e.$EventBus.$off("openEasyUpscaleToolsModal"),e.$EventBus.$on("openEasyUpscaleToolsModal",e.openEasyUpscaleToolsModal),e.$EventBus.$on("openEasyAnimeToolsModal",e.openAnimeToolsModal),e.$store.dispatch("creation/getTaskOptionsInfo"),t.next=7,e.getPresetModel(!1,!0);case 7:e.resetConfig(!0);case 8:case"end":return t.stop()}}),t)})))()},initParams:function(){var e,t=this;if(null===(e=this.config.textToImage)||void 0===e||!e.art_model_no)try{var n,o,l,r,c,d={},h=["imageToImage","conditionToImage"],m=(this.lab_base_model||[]).filter((function(e){var n=null==e?void 0:e.base_model.includes("SD 3.5");return h.includes(t.menuIndex)?!((null==e?void 0:e.id)===t.fluxModelId||n):e}))[0];m=null===(n=this.getDefaultModel({}))||void 0===n?void 0:n.art_model,d.art_model_no=m.id,d.modelName=m.name,d.art_work_no="",d.lora_models=[],d.model_cover=(null===(o=m)||void 0===o?void 0:o.cover)||"",d.is_agency_fee=!1,d.agency_fee=0,d.art_model_ver_no_name=(null===(l=m)||void 0===l?void 0:l.model_ver_name)||"",d.art_model_ver_no=(null===(r=m)||void 0===r?void 0:r.model_ver_no)||"",d.base_model_type=(null===(c=m)||void 0===c?void 0:c.base_model)||"",d.modelTags=this.getStudioModelTags(m);var v="sa"===Object(Ue.c)(null==d?void 0:d.base_model_type),f=["textToImage"].includes(this.menuIndex)&&(d.art_model_no===this.fluxModelId||v||this.isCommunityFlux);if(f){Object.assign(d,{negative_prompt:"",cfg_scale:6,steps:30,category:1,sampler_name:"dpmpp_2m_sde_gpu",denoising_strength:.5,base_model_type:"",modelTags:[],embeddings:[],lab_base:{conds:[],style_selections:["Studio Enhance","Studio Expand"],expand_token_length:10,hdr_enabled:!0,hdr_intensity:.5,auto_brightness_open:!0,auto_brightness_strength:75,auto_adjust_open:!1,auto_adjust_strength:20,semantics_open:!1,film_turbo:0,sharpness:2,scheduler:"karras",custom_height_width:!1,quality_open:!1,quality_detail_offset:.45,quality_mode:1,quality_type:"anime",intelligence_open:!1,prompt_magic:!0},studio:{style:"classic",width:1152,height:896}});var _=this.getStudioDefaultStyle(d.base_model_type,f);d.studio.width=_.width,d.studio.height=_.height}this.$set(this.config,"textToImage",Object.assign(this.config.textToImage,d))}catch(e){}},resetStudioParams:function(){var e=this,t={negative_prompt:"",cfg_scale:6,steps:30,category:1,sampler_name:"dpmpp_2m_sde_gpu",denoising_strength:.5,base_model_type:"",modelTags:[],embeddings:[],lab_base:{conds:[],style_selections:["Studio Enhance","Studio Expand"],expand_token_length:10,hdr_enabled:!0,hdr_intensity:.5,auto_brightness_open:!0,auto_brightness_strength:75,auto_adjust_open:!1,auto_adjust_strength:20,semantics_open:!1,film_turbo:0,sharpness:2,scheduler:"karras",custom_height_width:!1,quality_open:!1,quality_detail_offset:.45,quality_mode:1,quality_type:"anime",intelligence_open:!1,prompt_magic:!0},studio:{style:"classic",width:1152,height:896}};try{var n,o,l,r,c,d=["imageToImage","conditionToImage"],h=(this.lab_base_model||[]).filter((function(t){var n=null==t?void 0:t.base_model.includes("SD 3.5");return d.includes(e.menuIndex)?!((null==t?void 0:t.id)===e.fluxModelId||n):t}))[0];h=null===(n=this.getDefaultModel({}))||void 0===n?void 0:n.art_model,t.art_model_no=h.id,t.modelName=h.name,t.art_work_no="",t.lora_models=[],t.model_cover=(null===(o=h)||void 0===o?void 0:o.cover)||"",t.is_agency_fee=!1,t.agency_fee=0,t.art_model_ver_no_name=(null===(l=h)||void 0===l?void 0:l.model_ver_name)||"",t.art_model_ver_no=(null===(r=h)||void 0===r?void 0:r.model_ver_no)||"",t.base_model_type=(null===(c=h)||void 0===c?void 0:c.base_model)||"",t.modelTags=this.getStudioModelTags(h);var m="sa"===Object(Ue.c)(null==t?void 0:t.base_model_type),v=["textToImage"].includes(this.menuIndex)&&(t.art_model_no===this.fluxModelId||m||this.isCommunityFlux),f=this.getStudioDefaultStyle(t.base_model_type,v);t.studio.width=f.width,t.studio.height=f.height}catch(e){}if(["textToImage","imageToImage","conditionToImage"].includes(this.menuIndex)){var _=Object.assign(this.config.textToImage,t);"conditionToImage"===this.menuIndex&&(_.lab_base.conds=(_.controlnet_units||[]).map((function(t){return e.$set(t,"type","canny"),{image:"",mode:"PyraCanny",stop_at:.5,weight:1}}))),this.$set(this.config,this.menuIndex,_)}},getRandomPrompt:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,pattern,text;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.length>0&&void 0!==e[0]?e[0]:"",n.prev=1,n.next=4,Object(yo.getRandomPrompts)();case 4:if(l=n.sent,r=l.data.local,t.randomPrompt=r,"click"!==o){n.next=13;break}if(pattern=/--V6|--v6/g,text=(r||"").replace(pattern,""),!["",null,void 0].includes(text)){n.next=12;break}return n.abrupt("return");case 12:t.config.textToImage.prompt=text;case 13:n.next=18;break;case 15:n.prev=15,n.t0=n.catch(1),t.randomPrompt="";case 18:case"end":return n.stop()}}),n,null,[[1,15]])})))()},updatePrompt:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.config.textToImage.prompt=e},handleSimpleTextToImage:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m,v,f,_;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(r=e.length>0&&void 0!==e[0]?e[0]:{})&&r.data){n.next=3;break}return n.abrupt("return");case 3:if(console.log(r,"params-----"),c=(null==r?void 0:r.data)||{},d=c.art_model_no,h=c.art_model_ver_no,m=(null==r||null===(o=r.data)||void 0===o?void 0:o.meta)||{},v=m.negative_prompt,f=m.prompt,(_={model_no:d,model_ver_no:h,channel_id:"",speed_type:t.config.textToImage.speed_type,meta:{cfg_scale:7,steps:20,lcm_mode:0,sampler_name:"DPM++ 2M Karras",width:683,height:1024,prompt:f||xe.i.prompt,negative_prompt:v||xe.i.negative_prompt,imageSize:2,n_iter:1,clip_skip:1,restore_faces:!1,prompt_magic:!0,vae:"vae-ft-mse-840000-ema-pruned",lora_models:[]}}).meta=Object.assign(_.meta,(null==r||null===(l=r.data)||void 0===l?void 0:l.meta)||{}),_.meta.generate=t.config.textToImage.generate,t.isLoggedIn){n.next=17;break}return _.g_mode=1,n.next=13,t.checkNeedGoogleCaptcha();case 13:if(1!==t.needGoogleCaptcha){n.next=17;break}return n.next=16,t.updateCaptcha("ttc_v2");case 16:_.g_recaptcha_token=t.captchaToken||"";case 17:Object(dn.p)(_).then((function(e){var n,o;if([2e4,20001,20002,20003,20004,20301].includes(null==e||null===(n=e.status)||void 0===n?void 0:n.code))t.$EventBus.$emit("openLoginDialog");else if(!e||1e4===(null==e||null===(o=e.status)||void 0===o?void 0:o.code)){t.$message.success(t.$t("CreateSuccess"));var l=Object.assign({},_,(null==e?void 0:e.data)||{});l.banner=null,l.img_uris=[],l.status=1,t.updateTask(l)}})).catch((function(e){})).finally((function(){}));case 18:case"end":return n.stop()}}),n)})))()},getPresetModel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(dn.j)({}).then((function(n){var o=n||{},l=o.status.code,code=void 0===l?"":l;o.data;if([1e4,"10000"].includes(code)){var r,c=(null==n||null===(r=n.data)||void 0===r||null===(r=r.default_model)||void 0===r?void 0:r.art_model)||{};e.defaultModel=null!=c&&c.id?c:null,t&&(e.config.textToImage.prompt=(null==c?void 0:c.positive_prompt)||"")}})).finally((function(){}))},show:function(e,t){var n=arguments,o=this;return Object(E.a)(regeneratorRuntime.mark((function l(){var r,c,d,h,data,m,v,f;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(c=n.length>2&&void 0!==n[2]&&n[2],o.checkNeedGoogleCaptcha(),d=e.action,h=e.data,data=void 0===h?{}:h,null!=e&&e.data&&(o.activeCategory="model"),o.$store.dispatch("creation/setGenerateTaskNum",0),"SIMPLE"===(null==data?void 0:data.openType)&&o.handleSimpleTextToImage(e),o.isLoggedIn&&null!==(r=o.config)&&void 0!==r&&null!==(r=r.textToImage)&&void 0!==r&&r.art_model_no){l.next=13;break}if(o.$store.dispatch("creation/getTaskOptionsInfo"),null!==(m=o.config)&&void 0!==m&&null!==(m=m.textToImage)&&void 0!==m&&m.prompt){l.next=11;break}return l.next=11,o.getPresetModel(!0);case 11:return o.setDefaultMeta(e,t),l.abrupt("return");case 13:if("SIMPLE"!==(null==data?void 0:data.openType)){l.next=16;break}return console.log(null==data?void 0:data.openType,"是否是简易进来的"),l.abrupt("return");case 16:if(0!==d){l.next=20;break}return o.$nextTick((function(){data&&o.updateTask(Object.assign(data,{status:1,status_desc:""}))})),data&&o.setDefaultMeta(e,t,c),l.abrupt("return");case 20:if(console.log(e,"打开新版创作的params"),6!==d||null==data||!data.imageUrl){l.next=24;break}return o.getUpscaleParamsAndOpenModal(e),l.abrupt("return");case 24:if(24!==(null==data?void 0:data.action)||null==data||!data.parent_task_id){l.next=29;break}v=JSON.parse(JSON.stringify(data));try{f=o.list.find((function(e){return(null==f?void 0:f.id)===(null==data?void 0:data.parent_task_id)}))||"",v.art_model_no=null==f?void 0:f.art_model_no,v.art_model_ver_no=null==f?void 0:f.art_model_ver_no,v.art_work_no=""}catch(e){}return o.getAnimeParamsAndOpenModal(v),l.abrupt("return");case 29:o.getConfig(Dd(Dd({},data),{},{action:d}));case 30:case"end":return l.stop()}}),l)})))()},checkNeedGoogleCaptcha:function(){var e=this;if(""!==this.needGoogleCaptcha||this.isLoggedIn)return Promise.resolve();return Object(dn.l)({scene:4}).then((function(t){var n,o;1e4===(null==t||null===(n=t.status)||void 0===n?void 0:n.code)&&(e.needGoogleCaptcha=null==t||null===(o=t.data)||void 0===o?void 0:o.state)}))},getMapMenuIndex:function(e){var t=[{code:1,value:"textToImage"},{code:7,value:"imageToImage"},{code:8,value:"conditionToImage"},{code:24,value:"animGen"}].find((function(t){return t.code===e}));return t?t.value:"textToImage"},getConfig:function(e){var t=this,n=this.getReferParams(e);if(0===Object.keys(n).length||6===e.action){var o,l=this.getCacheConfig(),r=!1;return null!=e&&e.id||!l||null===(o=l.textToImage)||void 0===o||!o.art_model_no||(r=!0),void this.setDefaultMeta(e,r)}this.config.textToImage.loading=!0;var c=null!=e&&e.parent_task_id?A.h:A.o;null!=e&&e.parent_task_id&&(n={id:null==e?void 0:e.parent_task_id});var d={art_model_ver_no:e.model_ver_no,img_url:e.cover,action:3,source:3},h=e.hsaModelEdit?d:n;h.task_flow_version="v2",c(h).then(function(){var n=Object(E.a)(regeneratorRuntime.mark((function n(o){var l,r,c,d,h,m,v,f,_,y,w,C,k,S,x,I,O,T,$,L,P,M,j,D,N,E,R,A,U,data,F,z,V,W,H,G,J,K,X,Q,Z,Y,ee,te,ie,ne,ae,oe,se,le,re,ce,de,ue,he,pe,me,ve,ge,fe,_e,be,ye,we,Ce,ke,Se,Ie,Oe,Te,$e,Le,Pe,Me,je,De,Ne,pattern,Ee,Re,Ae,Be,Fe,ze,Ve,We,He,qe,Ge,Je,Ke,Xe,Qe,Ze,Ye,et,tt,it,nt,at,ot;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if([1e4,"10000"].includes(null==o||null===(l=o.status)||void 0===l?void 0:l.code)){n.next=3;break}return t.$message.error(o.status.msg||t.$t("ServerError")),n.abrupt("return");case 3:if(data=Dd(Dd({},e),o.data),3===(null==e?void 0:e.action))try{data.meta.lab_base=[]}catch(e){}if(null==e||!e.parent_task_id||null!==(r=data)&&void 0!==r&&r.task||(data.task={},data.task.type=null===(F=data)||void 0===F?void 0:F.type),z=JSON.parse(JSON.stringify(data)),24!==(null===(c=data)||void 0===c||null===(c=c.task)||void 0===c?void 0:c.type)&&24!==(null===(d=data)||void 0===d?void 0:d.action)){n.next=12;break}V=JSON.parse(JSON.stringify(data));try{H=V.img_uris,G=void 0===H?[]:H,J=(null==V?void 0:V.meta)||{},K=J.init_images,X=null==V||null===(W=V.banner)||void 0===W?void 0:W.url,V.meta.init_images=null!=G&&G.length?K||[]:X?[X]:[]}catch(e){}return t.getAnimeParamsAndOpenModal(V),n.abrupt("return");case 12:if(3===(null==e?void 0:e.action)||![4,13].includes(null===(h=data)||void 0===h||null===(h=h.task)||void 0===h?void 0:h.type)){n.next=17;break}return Z=(null===(Q=data)||void 0===Q||null===(Q=Q.meta)||void 0===Q?void 0:Q.hi_res_arg)||{},Y=Z.upscaling_resize,ee=void 0===Y?2:Y,te=Z.upscaler_1,ie=void 0===te?"4x-UltraSharp":te,ne=Z.image,ae={url:void 0===ne?"":ne,upscaler_1:ie,upscaling_resize:ee},t.getUpscaleParamsAndOpenModal(ae,"display"),n.abrupt("return");case 17:if(null!==(m=data)&&void 0!==m&&m.art_model||(data=t.getDefaultModel(data)),oe=t.getMapMenuIndex(null===(v=data)||void 0===v||null===(v=v.task)||void 0===v?void 0:v.type),null!=e&&e.parent_task_id&&(data.meta=Object.assign({},(null==e?void 0:e.meta)||{},(null==o||null===(se=o.data)||void 0===se?void 0:se.meta)||{}),data.art_work_no=(null===(le=data)||void 0===le?void 0:le.artwork_no)||""),null!=e&&e.parent_task_id&&(data.channel=null===(re=data)||void 0===re?void 0:re.category),3===(null==e?void 0:e.action)){data.meta.init_images=(null==e?void 0:e.init_images)||[],data.meta.controlnet_units=[];try{ue={image:null==e||null===(ce=e.init_images)||void 0===ce?void 0:ce[0],mode:"ImagePrompt",stop_at:1,weight:.35},null!==(de=data)&&void 0!==de&&null!==(de=de.meta)&&void 0!==de&&null!==(de=de.lab_base)&&void 0!==de&&null!==(de=de.conds)&&void 0!==de&&de.length?data.meta.lab_base.conds.push(ue):data.meta.lab_base.conds=[ue]}catch(e){}}if(he=[t.checkIsStudioMode(null===(f=data)||void 0===f?void 0:f.category),t.checkIsStudioMode(null===(_=data)||void 0===_||null===(_=_.task)||void 0===_?void 0:_.category)].some((function(e){return e})),data&&he&&(data.channel="studio",data.category=7,t.creativeMode="studio",null===(pe=data)||void 0===pe||null===(pe=pe.task)||void 0===pe||pe.type,(null===(me=data)||void 0===me?void 0:me.art_model_no)!==t.fluxModelId&&"sa"!==Object(Ue.c)(null===(ve=data)||void 0===ve||null===(ve=ve.art_model)||void 0===ve?void 0:ve.base_model)||(data.meta=Object.assign({},(null===(fe=data)||void 0===fe?void 0:fe.meta)||{},{init_images:[]}),data.action=1),t.checkIsStudioMode(null===(ge=t.config[t.menuIndex])||void 0===ge?void 0:ge.category)||t.resetStudioParams()),t.config[t.menuIndex].isUploadImage=!1,t.config[t.menuIndex].enable_hr=!1,t.config[t.menuIndex].hr_upscaler="",t.config[t.menuIndex].hr_scale=1.5,t.config[t.menuIndex].ad_model="",t.config[t.menuIndex].restore_faces=!1,t.config[t.menuIndex].ad_units={lora:{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""},t.config[t.menuIndex].embeddings=[],t.config[t.menuIndex].imageToImageList=[],t.config[t.menuIndex].lora_models=[],t.config[t.menuIndex].controlnet_units=[],t.config[t.menuIndex].negative_prompt="",t.config[t.menuIndex].ipList=[],t.$EventBus.$emit("resetInputPackUpStatus"),(_e=t.handleMeta(data,"",t.menuIndex))&&null!==(y=_e)&&void 0!==y&&null!==(y=y.controlnet_units)&&void 0!==y&&y.length&&(_e.controlnet_units=((null===(be=_e)||void 0===be?void 0:be.controlnet_units)||[]).map((function(e){return e.enable=!0,e}))),_e.logEventSource=(null==e?void 0:e.logEventSource)||0,_e=t.setImageSize(_e),(_e=t.handleInitConfig(_e)).base_model_type=(null===(w=data)||void 0===w?void 0:w.base_model_name)||"",ye=[t.checkIsStudioMode(null===(C=data)||void 0===C?void 0:C.category),t.checkIsStudioMode(null===(k=data)||void 0===k?void 0:k.channel)].some((function(e){return e})),console.log("获取初始化参数-----"),["textToImage","imageToImage","conditionToImage"].includes(oe)&&ye)try{Pe=(t.lab_base_model||[]).filter((function(e){return(null==e?void 0:e.id)===t.fluxModelId})),Pe[0],Me=null===(we=t.getDefaultModel({}))||void 0===we?void 0:we.art_model,_e.art_model_no=_e.art_model_no||Me.id,_e.modelName=_e.modelName||Me.name,_e.art_work_no="",_e.model_cover=_e.model_cover||(null===(Ce=Me)||void 0===Ce?void 0:Ce.cover),_e.is_agency_fee=_e.is_agency_fee||!1,_e.agency_fee=_e.agency_fee||0,_e.art_model_ver_no_name=(null===(ke=_e)||void 0===ke?void 0:ke.art_model_ver_no_name)||(null===(Se=Me)||void 0===Se?void 0:Se.model_ver_name)||"",_e.art_model_ver_no=(null===(Ie=_e)||void 0===Ie?void 0:Ie.art_model_ver_no)||(null===(Oe=Me)||void 0===Oe?void 0:Oe.model_ver_no)||"",_e.base_model_type=(null===(Te=_e)||void 0===Te?void 0:Te.base_model_type)||(null===($e=Me)||void 0===$e?void 0:$e.base_model)||"",_e.modelTags=null!==(Le=_e)&&void 0!==Le&&Le.modelTags?_e.modelTags:t.getStudioModelTags(Me),_e=t.checkStudioParams(_e)}catch(e){}if("imageToImage"!==oe&&"animGen"!==oe){n.next=58;break}if(null!=z&&null!==(je=z.meta)&&void 0!==je&&je.mask&&(_e.mask=(null==z||null===(Ne=z.meta)||void 0===Ne?void 0:Ne.mask)||""),pattern=/^(http|https):\/\//,_e.keepDenoisingStrength=!1,3===_e.action&&(_e.copyMask="",_e.mask="",_e.tempMask="",_e.keepDenoisingStrength=!1),!pattern.test(_e.mask)){n.next=57;break}return _e.ad_model="",_e.keepDenoisingStrength=!0,n.next=57,Object(B.b)(_e.mask,(function(e){_e.copyMask=_e.mask,_e.mask=e,_e.tempMask=e}));case 57:!pattern.test(_e.mask)&&null!==(De=data)&&void 0!==De&&null!==(De=De.meta)&&void 0!==De&&null!==(De=De.ad_units)&&void 0!==De&&De.length&&(Re=(null===(Ee=data)||void 0===Ee||null===(Ee=Ee.meta)||void 0===Ee?void 0:Ee.ad_units[0])||{},_e.ad_model=Re.ad_model||"",_e.ad_units=Object.assign({},{lora:{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""},Re||{}),delete _e.ad_units.ad_model);case 58:("imageToImage"===oe||["textToImage","conditionToImage"].includes(oe)&&3===(null===(S=_e)||void 0===S?void 0:S.action))&&((Fe={}).url=(null===(Ae=_e)||void 0===Ae?void 0:Ae.init_images[0])||"",Fe.denoising_strength=(null===(Be=_e)||void 0===Be?void 0:Be.denoising_strength)||.35,Fe.enable=!0,Fe.mask=_e.mask||"",Fe.tempMask=_e.tempMask||"",Fe.copyMask=_e.copyMask||"",Fe.compose_mask="",_e.imageToImageList=[Fe]),ze=(null===xe.B||void 0===xe.B?void 0:xe.B.flux)||[],Ve=(null===xe.B||void 0===xe.B?void 0:xe.B.sd35)||[],((null===(x=data)||void 0===x?void 0:x.art_model_no)===t.fluxModelId||"sa"===Object(Ue.c)(null===(I=data)||void 0===I||null===(I=I.art_model)||void 0===I?void 0:I.base_model)||ze.includes(null===(O=data)||void 0===O?void 0:O.base_model_name)||Ve.includes(null===(T=data)||void 0===T?void 0:T.base_model_name))&&null!==($=data)&&void 0!==$&&null!==($=$.meta)&&void 0!==$&&null!==($=$.lab_base)&&void 0!==$&&null!==($=$.conds)&&void 0!==$&&$.length&&(Je={},Ke=((null===(We=data)||void 0===We||null===(We=We.meta)||void 0===We||null===(We=We.lab_base)||void 0===We?void 0:We.conds)||[]).find((function(e){return"ImagePrompt"===e.mode}))||null,_e.ipList=((null===(He=data)||void 0===He||null===(He=He.meta)||void 0===He||null===(He=He.lab_base)||void 0===He?void 0:He.conds)||[]).filter((function(e){return"IpMaintain"===e.mode})).map((function(e){return e.enable=!0,e})),_e.lab_base.conds=((null===(qe=_e)||void 0===qe||null===(qe=qe.lab_base)||void 0===qe?void 0:qe.conds)||[]).filter((function(e){return"IpMaintain"!==e.mode})),Je.denoising_strength=null==Ke?void 0:Ke.weight,Je.enable=!0,Je.mask=_e.mask||"",Je.tempMask=_e.tempMask||"",Je.copyMask=_e.copyMask||"",Je.url=(null==Ke?void 0:Ke.image)||"",Je.compose_mask=(null===(Ge=_e)||void 0===Ge?void 0:Ge.compose_mask)||"",Ke&&(_e.imageToImageList=[Je])),["textToImage","imageToImage","animGen"].includes(oe)&&null!==(L=data)&&void 0!==L&&null!==(L=L.meta)&&void 0!==L&&null!==(L=L.ad_units)&&void 0!==L&&L.length&&(Ye=(null===(Xe=data.meta)||void 0===Xe?void 0:Xe.ad_units[0])||{},et=null===(Qe=data)||void 0===Qe||null===(Qe=Qe.meta)||void 0===Qe||null===(Qe=Qe.ad_units)||void 0===Qe||null===(Qe=Qe[0])||void 0===Qe||null===(Qe=Qe.lora_models)||void 0===Qe?void 0:Qe[0],tt=et?Dd(Dd({},et),{},{banner:{url:(null==et||null===(Ze=et.art_model)||void 0===Ze||null===(Ze=Ze.banner)||void 0===Ze?void 0:Ze.url)||""}}):{},_e.ad_model=Ye.ad_model||"",_e.characterRepairZoom=!!_e.ad_model,_e.ad_units=Object.assign({},{lora:tt||{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""},Ye||{}),delete _e.ad_units.ad_model),null!==(P=_e)&&void 0!==P&&P.hr_scale&&(_e.hr_scale=1.5),null!==(M=data)&&void 0!==M&&null!==(M=M.meta)&&void 0!==M&&null!==(M=M.ad_units)&&void 0!==M&&M.length||(_e.ad_model="",_e.characterRepairZoom=!!_e.ad_model,_e.ad_units={lora:{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""}),_e.steps<=0&&(_e.steps=[5,"5"].includes(_e.category)?30:20),_e.imgFiles=[],_e.tabIndex=t.creativeMode,_e.generate=(null==z||null===(j=z.meta)||void 0===j?void 0:j.generate)||(null===(D=t.config[t.menuIndex])||void 0===D?void 0:D.generate);try{_e.generate.gen_mode=t.config.textToImage.generate.gen_mode||0,t.isLoggedIn||(_e.generate.gen_mode=0),_e.generate.prompt_magic_mode=[null,void 0,null].includes(null===(it=t.config)||void 0===it||null===(it=it.textToImage)||void 0===it||null===(it=it.generate)||void 0===it?void 0:it.prompt_magic_mode)?2:t.config.textToImage.generate.prompt_magic_mode}catch(e){}((null===(N=_e)||void 0===N?void 0:N.art_model_no)===t.fluxModelId||"sa"===Object(Ue.c)(null===(E=_e)||void 0===E?void 0:E.base_model_type)||(null===(R=(null===xe.B||void 0===xe.B?void 0:xe.B.flux)||[])||void 0===R?void 0:R.includes(null===(A=_e)||void 0===A?void 0:A.base_model_type)))&&(_e.enableNegativePrompts=!1,_e.negative_prompt=""),null!==(U=_e)&&void 0!==U&&U.base_model_type.includes("SD 3.5")&&(_e.steps=null===(nt=z.meta)||void 0===nt?void 0:nt.steps,_e.width=null===(at=z.meta)||void 0===at?void 0:at.width,_e.height=null===(ot=z.meta)||void 0===ot?void 0:ot.height),_e.n_iter=t.config.textToImage.n_iter,t.config[t.menuIndex]=_e,t.config.textToImage.loading=!1;try{console.log("更新当前的选中的模型id 即可更新三合一弹框的选中ID"),t.categoryInfo.id=_e.art_model_no}catch(e){console.error("update categoryInfo.id error",e)}t.$set(t.config,t.menuIndex,t.config[t.menuIndex]);case 78:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).finally((function(){t.config.textToImage.loading=!1,t.initParams()}))},setImageSize:function(){var source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object(X.cloneDeep)(source);return null!=e&&e.width&&null!=e&&e.height||(e.width=688,e.height=1024),e},getAnimeParamsAndOpenModal:function(data){var e,t,n,o,l=(null==data||null===(e=data.meta)||void 0===e?void 0:e.animatediff)||{},r=Array.isArray(null==data||null===(t=data.meta)||void 0===t?void 0:t.init_images)&&null!=data&&null!==(n=data.meta)&&void 0!==n&&null!==(n=n.init_images)&&void 0!==n&&n.length?null==data||null===(o=data.meta)||void 0===o?void 0:o.init_images[0]:"",c={art_model_no:null==data?void 0:data.art_model_no,art_model_ver_no:null==data?void 0:data.art_model_ver_no,art_work_no:null==data?void 0:data.art_work_no,action:24,category:1,meta:(null==data?void 0:data.meta)||{}};this.$EventBus.$emit("openEasyAnimeToolsModal",{animatediff:l,url:r,requestParams:c})},getUpscaleParamsAndOpenModal:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.data,o=((void 0===n?{}:n)||{}).imageUrl,l={url:void 0===o?"":o};t&&(l=e),this.$EventBus.$emit("openEasyUpscaleToolsModal",l)},getStudioDefaultStyle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getCurrentModelType(e),o={width:832,height:1216,min:768,max:1536};return"SD"===n&&(o={width:624,height:936,min:512,max:1024}),(t||["SA","FLUX"].includes(n))&&(o={width:688,height:1024,min:384,max:1024}),o},getCurrentModelType:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=["SD 1.5","SD 2.0","SD 1.4","SD 2.1 768","SD 2.1","SD 2.0 768","SD 1.5 LCM"].concat(Object(R.a)(xe.B.other)),n=null===xe.B||void 0===xe.B?void 0:xe.B.sd35,o=null===xe.B||void 0===xe.B?void 0:xe.B.flux,l=(null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[],r=["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony","SDXL Hyper"].includes(e)||(e||"").includes("SDXL"),c=t.includes(e),d=["SD 3"].includes(e),h=o.includes(e),m=l.includes(e),v=n.includes(e)||(e||"").includes("SD 3.5");return r?"SDXL":c||d?"SD":h?"FLUX":m?"SA":v?"SD 3.5":void 0},handleGenerate:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.visitorLogEvent(),!(n=e.config.textToImage).generateing){t.next=4;break}return t.abrupt("return");case 4:if(!((null===xe.B||void 0===xe.B?void 0:xe.B.sd3)||[]).includes(null==n?void 0:n.base_model_type)){t.next=7;break}return e.$message.warning(e.$t("newGenerate52")),t.abrupt("return");case 7:if("textToImage"!==e.menuIndex||!e.vipLimit(n)){t.next=9;break}return t.abrupt("return");case 9:if(!e.validParams(n)){t.next=12;break}return n.generateing=!1,t.abrupt("return");case 12:return n.generateing=!0,t.next=15,e.getParams();case 15:if(o=t.sent,console.log(o,"params"),l=e.getGenerateType(),r=e.getParamsByType(o,l),e.checkStudioModelType(n,o)){t.next=23;break}return n.generateing=!1,e.$message.warning(e.$t("studio25")),t.abrupt("return");case 23:if(e.checkEmbeddingModelType(n,o)){t.next=27;break}return n.generateing=!1,e.$message.warning(e.$t("newGenerate63")),t.abrupt("return");case 27:r.meta.generate=e.config.textToImage.generate,c=dn.p,t.t0=l,t.next="textToImage"===t.t0?32:"imageToImage"===t.t0?34:"conditionToImage"===t.t0?36:38;break;case 32:return c=dn.p,t.abrupt("break",40);case 34:return c=dn.m,t.abrupt("break",40);case 36:return c=dn.f,t.abrupt("break",40);case 38:return c=dn.p,t.abrupt("break",40);case 40:if(e.isLoggedIn||!["textToImage"].includes(l)){t.next=48;break}return r.g_mode=1,t.next=44,e.checkNeedGoogleCaptcha();case 44:if(1!==e.needGoogleCaptcha){t.next=48;break}return t.next=47,e.updateCaptcha("ttc_v2");case 47:r.g_recaptcha_token=e.captchaToken||"";case 48:c(r).then((function(t){var l;t.data;if(t&&1e4!==(null==t||null===(l=t.status)||void 0===l?void 0:l.code))e.config.textToImage.generateing=!1;else{e.clearConfig(n,e.config.textToImage.isLockParams),e.$message.success(e.$t("CreateSuccess"));var r=Object.assign({},o,(null==t?void 0:t.data)||{});r.banner=null,r.img_uris=[],r.status=1,e.updateTask(r),e.config.textToImage.generateing=!1}})).catch((function(t){e.config.textToImage.generateing=!1})).finally((function(){e.isImageToImageToTextToImage=!1,e.config.textToImage.generateing=!1}));case 49:case"end":return t.stop()}}),t)})))()},visitorLogEvent:function(){this.isLoggedIn||this.$logEvent("log_actions",{operation:"click_generate",behavior_info:"on_new_create_flow_page",behavior_info_sub:"guest_visit"})},checkStudioModelType:function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})||{}).base_model_type,n=void 0===t?"":t,o=((null==e?void 0:e.meta)||{}).lora_models,l=void 0===o?[]:o,r=["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony","SDXL Hyper"],c=["SD 1.5","SD 2.0","SD 1.4","SD 2.1 768","SD 2.1","SD 2.0 768","SD 1.5 LCM"].concat(Object(R.a)(xe.B.other)),d=["SD 3"],h=(null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[],m=(null===xe.B||void 0===xe.B?void 0:xe.B.sd35)||[],v=r.includes(n)||(n||"").includes("SDXL"),f=c.includes(n),_=d.includes(n),y=m.includes(n)||(n||"").includes("SD 3.5"),w=((null===xe.B||void 0===xe.B?void 0:xe.B.flux)||[]).includes(n),C=(h||[]).includes(n);return(l||[]).every((function(e){var t=r.includes(null==e?void 0:e.base_model),o=c.includes(null==e?void 0:e.base_model),l=d.includes(null==e?void 0:e.base_model),k=((null===xe.B||void 0===xe.B?void 0:xe.B.flux)||[]).includes(null==e?void 0:e.base_model),S=h.includes(null==e?void 0:e.base_model),x=m.includes(null==e?void 0:e.base_model)&&(null==e?void 0:e.base_model)===n;return!(y&&!x||v&&!t||f&&!o||_&&!l||w&&!k||C&&!S)}))},checkEmbeddingModelType:function(){var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})||{},o=n.base_model_type,l=void 0===o?"":o,r=n.embeddings,c=void 0===r?[]:r;if(null==t||null===(e=t.meta)||void 0===e||null===(e=e.embeddings)||void 0===e||!e.length)return!0;var d=["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony","SDXL Hyper"],h=["SD 1.5","SD 2.0","SD 1.4","SD 2.1 768","SD 2.1","SD 2.0 768","SD 1.5 LCM"].concat(Object(R.a)(xe.B.other)),m=["SD 3"],v=(null===xe.B||void 0===xe.B?void 0:xe.B.sa)||[],f=d.includes(l)||(l||"").includes("SDXL"),_=h.includes(l),y=m.includes(l),w=((null===xe.B||void 0===xe.B?void 0:xe.B.flux)||[]).includes(l),C=(v||[]).includes(l);return(c||[]).every((function(e){var t=d.includes(null==e?void 0:e.base_model),n=h.includes(null==e?void 0:e.base_model),o=m.includes(null==e?void 0:e.base_model),l=((null===xe.B||void 0===xe.B?void 0:xe.B.flux)||[]).includes(null==e?void 0:e.base_model),r=v.includes(null==e?void 0:e.base_model);return!(f&&!t||_&&!n||y&&!o||w&&!l||C&&!r)}))},validParams:function(e){var t=e.prompt;e.art_work_no,e.art_model_no;return!t&&this.$message.warning(this.$t("PromptNotEmpty"))},handleImageToPrompt:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";""!==t&&Object(A.d)({action:8,category:1,speed_type:this.config[this.menuIndex].speed_type,task_flow_version:"v2",meta:{img_2_text:{uri:t}}}).then((function(t){var n,o={banner:null,img_uris:[],status:1};(null===(n=o=Object.assign(o,(null==t?void 0:t.data)||{}))||void 0===n?void 0:n.id)&&e.updateTask(o)})).catch((function(e){}))},handleImageExtraUpscale:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign(t,{task_flow_version:"v2"});return Object(A.d)(n).then((function(t){var n,o={banner:null,img_uris:[],status:1};return(null===(n=o=Object.assign(o,(null==t?void 0:t.data)||{}))||void 0===n?void 0:n.id)&&e.updateTask(o),t})).catch((function(e){}))},handleAnimeGenerate:function(e){var t=this,n=Object.assign(e,{task_flow_version:"v2"});return Object(A.d)(n).then((function(e){var n,o={banner:null,img_uris:[],status:1};return(null===(n=o=Object.assign(o,(null==e?void 0:e.data)||{}))||void 0===n?void 0:n.id)&&t.updateTask(o),e})).catch((function(e){}))},handleGenerateByPrompt:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!["",null,void 0].includes(t)){var n=this.lab_base_model.find((function(t){return(null==t?void 0:t.id)===e.fluxModelId}))||{},o={model_no:null==n?void 0:n.id,model_ver_no:null==n?void 0:n.model_ver_no};null!=o&&o.model_no&&(o.meta={cfg_scale:6,width:688,height:1024,n_iter:2,prompt:t,seed:Object(B.c)(!0),steps:30,sampler_name:"dpmpp_2m_sde_gpu",negative_prompt:"",lab_base:{conds:[]}},Object(dn.p)(o).then((function(t){var n;t.data;if(!t||1e4===(null==t||null===(n=t.status)||void 0===n?void 0:n.code)){e.$message.success(e.$t("CreateSuccess"));var l=Object.assign({},o,(null==t?void 0:t.data)||{});l.banner=null,l.img_uris=[],l.status=1,e.updateTask(l)}})).catch((function(e){})))}},getParamsByType:function(){var source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,t={model_no:null==source?void 0:source.art_model_no,model_ver_no:null==source?void 0:source.art_model_ver_no,channel_id:"",speed_type:this.config.textToImage.speed_type};if((this.isStudioFlux||this.isCommunityFlux||this.isSd35Model)&&"textToImage"===e||this.isImageToImageToTextToImage){var n,o,l;if(t.meta={cfg_scale:source.meta.cfg_scale,width:source.meta.width,height:source.meta.height,n_iter:source.meta.n_iter,prompt:source.meta.prompt,seed:source.meta.seed,steps:source.meta.steps,sampler_name:"dpmpp_2m_sde_gpu",negative_prompt:"",lab_base:{conds:[]}},null!==(n=this.config[this.menuIndex].imageToImageList)&&void 0!==n&&n.length){var r,c=this.config[this.menuIndex].imageToImageList[0],d={image:null==c?void 0:c.url,stop_at:1,weight:null==c?void 0:c.denoising_strength,mode:"ImagePrompt",loading:!1};t.meta.lab_base={conds:[d]};var h=this.isStudioFlux&&(null===(r=this.config.textToImage)||void 0===r||null===(r=r.ipList)||void 0===r?void 0:r.length);if(null!=c&&c.mask&&!this.isCommunityFlux&&!h){["mask","mask_blur","inpainting_fill","inpainting_mask_invert","inpaint_full_res_padding"].forEach((function(e){t.meta[e]=source.meta[e]}))}}if((this.isCommunityFlux||this.isStudioFlux||this.isSd35Model)&&(t.meta.lora_models=source.meta.lora_models||[]),this.isStudioFlux&&null!==(o=this.config.textToImage)&&void 0!==o&&null!==(o=o.ipList)&&void 0!==o&&o.length){var m,v,f,_,y=/^blob:/,w=((null===(m=this.config.textToImage)||void 0===m?void 0:m.ipList)||[]).filter((function(e){return"IpMaintain"===e.mode&&e.image&&!y.test(e.image)&&(null==e?void 0:e.enable)})).map((function(e){return{image:null==e?void 0:e.image,mode:null==e?void 0:e.mode,stop_at:null==e?void 0:e.stop_at,weight:null==e?void 0:e.weight}}));if(null!==(v=t)&&void 0!==v&&null!==(v=v.meta)&&void 0!==v&&null!==(v=v.lora_models)&&void 0!==v&&v.length&&(w=(w||[]).filter((function(e){return"IpMaintain"!==e.mode})).map((function(e){return{image:null==e?void 0:e.image,mode:null==e?void 0:e.mode,stop_at:null==e?void 0:e.stop_at,weight:null==e?void 0:e.weight}}))),null!==(f=w)&&void 0!==f&&f.length)(_=t.meta.lab_base.conds).push.apply(_,Object(R.a)(w))}[3,"3"].includes(null===(l=t)||void 0===l?void 0:l.speed_type)&&(t.speed_type=2)}if(!this.isStudioFlux&&!this.isCommunityFlux&&"textToImage"===e&&!this.isImageToImageToTextToImage){var C,k,S={meta:{}},x=["prompt","negative_prompt","width","height","steps","cfg_scale","sampler_name","n_iter","lora_models","vae","clip_skip","seed","restore_faces","ad_units","embeddings"];if(""!==(null===(C=this.config)||void 0===C||null===(C=C.textToImage)||void 0===C?void 0:C.hr_upscaler))S.meta.hr_upscaler=null===(k=this.config)||void 0===k||null===(k=k.textToImage)||void 0===k?void 0:k.hr_upscaler,S.meta.hr_second_pass_steps=20,S.meta.denoising_strength=.5;if(this.isAnimeEnhanceEnable){var I=["vae","clip_skip","ad_units","embeddings"];x=x.filter((function(e){return!I.includes(e)}))}x.forEach((function(e){S.meta[e]=source.meta[e]})),this.isAnimeEnhanceEnable&&(S.meta.sampler_name="dpmpp_2m_sde_gpu",S.meta.lab_base={scheduler:"karras"}),S.speed_type=t.speed_type,t=Object.assign(t,S)}return"imageToImage"===e&&(t=Object.assign(t,this.getImageToImagePostParams(source))),"conditionToImage"===e&&(t=Object.assign(t,this.getControlNetPostParams(source))),t},getImageToImagePostParams:function(source){var e,t,n,o={},l=["prompt","negative_prompt","width","height","steps","cfg_scale","sampler_name","n_iter","lora_models","vae","clip_skip","seed","controlnet_units","init_images","denoising_strength","embeddings","ad_units"];("SD"!==this.currentModelType&&(l=l.filter((function(e){return!["ad_units"].includes(e)}))),null!=source&&null!==(e=source.meta)&&void 0!==e&&null!==(e=e.controlnet_units)&&void 0!==e&&e.length||null==source||null===(t=source.meta)||void 0===t||!t.mask)||(n=l).push.apply(n,["mask","mask_blur","inpainting_fill","inpainting_mask_invert","inpaint_full_res_padding"]);return o.meta={},l.forEach((function(e){o.meta[e]=source.meta[e]})),o.speed_type=source.speed_type,o},getControlNetPostParams:function(source){var e={};return e.meta={},["prompt","negative_prompt","width","height","steps","cfg_scale","sampler_name","n_iter","lora_models","vae","clip_skip","seed","controlnet_units","embeddings"].forEach((function(t){e.meta[t]=source.meta[t]})),e.speed_type=source.speed_type,e},getGenerateType:function(){var e=JSON.parse(JSON.stringify(this.config[this.menuIndex])),t=(e.imageToImageList||[]).filter((function(e){return null==e?void 0:e.enable})),n=(e.controlnet_units||[]).filter((function(e){return null==e?void 0:e.enable}));return this.isStudioFlux||this.isCommunityFlux||(null==t||!t.length)&&(null==n||!n.length)||this.isAnimeEnhanceEnable||this.isSd35Model?(this.isImageToImageToTextToImage=this.isSd35Model,"textToImage"):null!=t&&t.length?"imageToImage":null!=n&&n.length?"conditionToImage":"textToImage"},clearConfig:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.parent_task_id&&delete e.parent_task_id,t?(e=Dd(Dd({},e),{},{imageUrl:[""],roop_arg:{face_restorer_visibility:.6,image:""},logEventSource:0})).lab_base.conds=[]:(e=Dd(Dd({},e),{},{imageUrl:[""],mask:"",copyMask:"",tempMask:"",keepDenoisingStrength:!1,prompt:"",local_prompt:"",roop_arg:{face_restorer_visibility:.6,image:""},controlnet_units:[],logEventSource:0,imageToImageList:[],ipList:[]})).lab_base.conds=[],this.config[this.menuIndex]=e},getParams:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,d,h,m,v,f,_,y,w,meta;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.config.textToImage,o={},l=n.art_work_no,r=n.art_model_no,c=n.parent_task_id,d=n.art_model_ver_no,h=n.action,m=n.operate_number,v=n.category,f=n.speed_type,_=n.animatediff,y=n.logEventSource,w=void 0===y?0:y,meta=e.getCommonMeta(n),t.next=6,e.getPrivateMeta(n,meta);case 6:return meta=t.sent,o={action:"conditionToImage"===e.menuIndex?10:h,art_work_no:l,art_model_no:r,art_model_ver_no:d,parent_task_id:c,operate_number:m,channel_id:"PRIVATE"!==e.channelId&&e.channelId,category:v,speed_type:f,meta:meta},w&&(o.source=w),"animGen"===e.menuIndex&&(o.meta.animatediff=_),"textToImage"!==e.menuIndex&&([3,"3","midjourney","sdxl",5,"5"].includes(n.channel)||[3,"3","midjourney","sdxl",5,"5"].includes(meta.channel))&&(([3,"3","midjourney"].includes(n.channel)||[3,"3","midjourney"].includes(meta.channel))&&(o.category=3),(["sdxl",5,"5"].includes(n.channel)||["sdxl",5,"5"].includes(meta.channel))&&(o.category=5),[3,"3","midjourney","sdxl",5,"5"].includes(meta.channel)&&delete o.meta.channel),8===n.action&&"descriptors"===e.menuIndex&&(Reflect.deleteProperty(o,"art_work_no"),Reflect.deleteProperty(o,"art_model_no"),Reflect.deleteProperty(o,"art_model_ver_no")),Object.keys(o).forEach((function(e){o[e]||Reflect.deleteProperty(o,e)})),t.abrupt("return",o);case 14:case"end":return t.stop()}}),t)})))()},getCommonMeta:function(e){var t,meta={},n=["prompt","negative_prompt","restore_faces","seed","sampler_name","width","height","steps","cfg_scale","lora_models","vae","clip_skip","hr_second_pass_steps","lcm_mode"];return["development"].includes("production")&&n.push("roop_arg"),["textToImage","imageToImage","conditionToImage","expansion","animGen"].includes(this.menuIndex)&&n.push("n_iter"),["extraUpscale","descriptors"].includes(this.menuIndex)||(n.forEach((function(t){meta[t]=e[t]})),["",null,void 0,0,"0"].includes(meta.seed)&&(meta.seed=-1),["-1",-1].includes(meta.seed)&&(meta.seed=Object(B.c)(this.isStudioFlux||this.isCommunityFlux)),["",null,void 0].includes(null==meta||null===(t=meta.roop_arg)||void 0===t?void 0:t.image)&&delete meta.roop_arg,["textToImage","imageToImage","animGen","conditionToImage"].includes(this.menuIndex)&&![5,"5"].includes(e.category)||delete meta.roop_arg,!["",null,void 0].includes(e.hr_upscaler)&&"textToImage"===this.menuIndex&&[1,"1"].includes(e.category)&&(e.enable_hr?(meta.enable_hr=!0,meta.hr_upscaler=e.hr_upscaler||"R-ESRGAN 4x+",meta.hr_scale=1.5):meta.enable_hr=!1),meta.width=(null==meta?void 0:meta.width)<=0?1024:meta.width,meta.height=(null==meta?void 0:meta.height)<=0?1024:meta.height,meta.lora_models=((null==e?void 0:e.lora_models)||[]).map((function(e){var t=e.model_id,n=e.weight,o=e.model_ver_no,l=e.base_model;return{model_id:t,weight:n,model_ver_no:o||"",base_model:void 0===l?"":l}}))),meta},uploadMaskImage:function(mask){var e=mask.includes("data:image/png;base64")?mask:"data:image/png;base64,".concat(mask),t=Object(B.a)(e);return this.UPLOAD.startUpload(t,{name:"img2img-mask".concat(Date.now(),".png"),type:"png",isRedirection:!0,category:46})},getPrivateMeta:function(e,meta){var t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,h,m,v,f,_,y,w,C,k,S,x,I,O,T,$,L,P,M,j,D,N;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.menuIndex,l=e.denoising_strength,r=e.imageUrl,c=e.controlnet_units,d=e.scaling_ratio,h=e.up_scaler,m=e.controlnet_processor_res,v=e.left_margin,f=e.up_margin,_=e.embeddings,y=e.meta,w=e.imageToImageList,meta.embeddings=(_||[]).map((function(e){return{model_id:null==e?void 0:e.id,model_ver_id:null==e?void 0:e.model_ver_no,weight:(null==e?void 0:e.weight)||1}})),null==w||!w.length){n.next=17;break}if(C=w[0],meta.denoising_strength=null==C?void 0:C.denoising_strength,meta.init_images=[C.url],!c.length){n.next=11;break}n.t0={},n.next=14;break;case 11:return n.next=13,t.getCanvasParams(e);case 13:n.t0=n.sent;case 14:k=n.t0,c.length&&(meta.controlnet_units=t.getControlnet_units(c)),meta=Object.assign({},meta,k);case 17:if(null!=w&&w.length||null==c||!c.length||(meta.controlnet_units=t.getControlnet_units(c)),!["imageToImage","animGen","characterRepair"].includes(o)){n.next=34;break}if(meta.denoising_strength=l,meta.init_images=r.slice(3),c.length&&(meta.controlnet_units=t.getControlnet_units(c,r)),S=e.imageToImageList[0]||{},x={},null==S||!S.enable){n.next=33;break}if(!c.length){n.next=29;break}n.t1={},n.next=32;break;case 29:return n.next=31,t.getCanvasParams(e);case 31:n.t1=n.sent;case 32:x=n.t1;case 33:meta=Object.assign({},meta,x);case 34:return["imageToImage","textToImage","animGen","characterRepair"].includes(o)&&(""!==e.ad_model&&($=(null==e||null===(I=e.ad_units)||void 0===I?void 0:I.lora)||{},L=$.id,P=$.model_ver_no,M=$.weights,j={model_id:L,model_ver_no:P,weight:M},(null==(D=Object(X.cloneDeep)(e.ad_units))?void 0:D.lora)&&delete D.lora,meta.ad_units=[Object.assign({ad_model:e.ad_model,lora_models:null!==(O=Object.keys((null==e||null===(T=e.ad_units)||void 0===T?void 0:T.lora)||{}))&&void 0!==O&&O.length?[j]:[]},D)]),3===e.action&&(e.enable_hr?(meta.enable_hr=!0,meta.hr_upscaler=e.hr_upscaler||"R-ESRGAN 4x+",meta.hr_scale=1.5):meta.enable_hr=!1)),"extraUpscale"===o&&(meta.hi_res_arg={upscaling_resize:d,upscaler_1:h,image:r[0]},meta.width=e.realWidth||e.width,meta.height=e.realHeight||e.height,meta=Dd(Dd({},y),meta)),"conditionToImage"===o&&(meta.controlnet_units=t.getControlnet_units(c)),"descriptors"===o&&(meta={img_2_text:{uri:e.imageUrl[0]}}),"preview"===o&&(meta={controlnet_input_images:r,controlnet_module:null===(N=c[0])||void 0===N?void 0:N.module,controlnet_processor_res:m}),"expansion"===o&&(meta=Dd(Dd({},meta),{},{left_margin:v,up_margin:f,image:r[0]})),n.abrupt("return",meta);case 41:case"end":return n.stop()}}),n)})))()},getControlnet_units:function(e){var t=this;return(e||[]).filter((function(e){return null==e?void 0:e.enable})).map((function(e,n){var o=e.type,l=e.processor_res,r=e.threshold_a,c=e.control_mode,d=e.model,h=e.module,m=e.weight,v=e.isHandle,f=e.input_image,_=r,y=(t.taskControlNetModules||[]).find((function(e){return(null==e?void 0:e.type)===o}));return[0,"0"].includes(c)&&y&&null!=y&&y.has_style_fidelity||(_=null),{processor_res:v?l:0,input_image:f,threshold_a:_,model:d,module:v?h:"none",control_mode:Number(c),weight:m,guidance:1,guidance_end:1,type:o}}))},updateTask:function(data){this.$refs.taskView.updateMessageList(data)},updateTaskParams:function(){this.$refs.taskView.refreshPageData()},getCanvasParams:function(){var e=arguments,t=this;return Object(E.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,mask,h,m,v,pattern,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(d=(c=e.length>0&&void 0!==e[0]?e[0]:{}).imageToImageList[0]||{},mask=(null==d?void 0:d.mask)||"",h=(null==d?void 0:d.tempMask)||"",m=(null==d?void 0:d.compose_mask)||"",v={mask:mask,mask_blur:4,inpainting_fill:1,inpainting_mask_invert:0,inpaint_full_res_padding:32,compose_mask:m},pattern=/^(http|https):\/\//,["",null,void 0].includes(h)||["",null,void 0].includes(mask)||h!==mask){n.next=11;break}return v.mask=d.copyMask,(t.config.textToImage.imageToImageList||[]).forEach((function(e){t.$set(e,"mask",d.copyMask)})),n.abrupt("return",v);case 11:if(["",null,void 0].includes(null===(o=c.imageToImageList[0])||void 0===o?void 0:o.mask)||"data:,"===(null===(l=c.imageToImageList[0])||void 0===l?void 0:l.mask)||pattern.test(null===(r=c.imageToImageList[0])||void 0===r?void 0:r.mask)){n.next=14;break}return n.next=14,t.uploadMaskImage(null===(f=c.imageToImageList[0])||void 0===f?void 0:f.mask).then((function(e){(t.config.textToImage.imageToImageList||[]).forEach((function(n){t.$set(n,"mask",e)})),v.mask=e}));case 14:return c.generateing=!1,n.abrupt("return",["",null,void 0].includes(v.mask)?{}:v);case 16:case"end":return n.stop()}}),n)})))()},vipLimit:function(e){if(this.isVip)return!1;var t;e.category;return(null!=e&&null!==(t=e.lora_models)&&void 0!==t&&t.length?e.lora_models:[]).length>3&&(this.$EventBus.$emit("showBreakDialog","LoRALimit5TipWeb","basic"),!0)},checkStudioParams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.steps<25&&(e.steps=30),e.lab_base.quality_mode||(e.lab_base.quality_mode=1)}catch(e){}return e},setSeed:function(){var meta=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object(X.cloneDeep)(meta),t=this.config[this.menuIndex].seed;return e.seedTemp=e.seed||"",e.seed=t,e},changeLora:function(e){return e?e.map((function(e){var t=e.art_model,n=e.model_ver_no;return Dd(Dd(Dd({},e),t),{},{model_ver_no:n})})):[]},handleInitConfig:function(){var e,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(X.cloneDeep)(source),pattern=/--auto|--s2/g;try{t.local_prompt=t.local_prompt.replace(pattern,""),t.local_prompt.trim(),t.prompt=t.prompt.replace(pattern,""),t.prompt.trim()}catch(e){}if("textToImage"===this.menuIndex&&["sdxl",5,"5"].includes(t.category))try{var n,o,l,r;t.cfg_scale=t.cfg_scale||7,t.steps=t.steps||30;var c,d=this.sd_xl_base_model[0];if(d=null===(n=this.getDefaultModel({}))||void 0===n?void 0:n.art_model,t.art_model_no=t.art_model_no||d.id,t.modelName=t.modelName||d.name,t.art_model_no===d.id)t.art_work_no=(null===(c=d)||void 0===c||null===(c=c.artwork)||void 0===c?void 0:c.id)||"";else t.art_work_no=t.art_work_no||"";t.art_work_no=t.art_work_no||"",t.model_cover=t.model_cover||d.cover,t.is_agency_fee=t.is_agency_fee||!1,t.agency_fee=t.agency_fee||0,t.art_model_ver_no_name=(null==t?void 0:t.art_model_ver_no_name)||(null===(o=d)||void 0===o?void 0:o.model_ver_name)||"",t.art_model_ver_no=(null==t?void 0:t.art_model_ver_no)||(null===(l=d)||void 0===l?void 0:l.model_ver_no)||"",t.base_model_type=(null===(r=d)||void 0===r?void 0:r.base_model)||"",t.modelTags=this.getStudioModelTags(d)}catch(e){}if(null!=t&&null!==(e=t.roop_arg)&&void 0!==e&&e.image&&(t.roopZoom=!0),t&&t.sdxl)try{var h;t.enablePromptMagic=![0,"0",null,void 0].includes(t.sdxl.prompt_magic),t.sdxl={prompt_magic:[0,"0",null,void 0].includes(null==t||null===(h=t.sdxl)||void 0===h?void 0:h.prompt_magic)?.4:t.sdxl.prompt_magic,prompt_style:t.sdxl.prompt_style||"Fantasy Art"}}catch(e){}return t},handleMeta:function(data,e){var t,n,o,l,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=this.getImageNums();this.isLoggedIn||(c=2);var d=r||e,h=this.handleParams(data,d),meta=h.meta,m=h.art_work_no,v=h.art_model,f=h.base_model_name,_=void 0===f?"":f;[3,"3"].includes(null==data?void 0:data.action)&&(meta=this.handleVariationsMeta(data,meta)),meta.lcm_mode=null!==(t=meta)&&void 0!==t&&t.lcm_mode?1:0,(meta=this.setSeed(meta,data)).lora_models=this.changeLora(meta.lora_models);var y=Array.isArray(null==data||null===(n=data.meta)||void 0===n?void 0:n.embeddings)?null==data||null===(o=data.meta)||void 0===o?void 0:o.embeddings:[];meta.embeddings=(y||[]).map((function(e){return Dd(Dd({},e),(null==e?void 0:e.art_model)||{})}));var w={};if(e){var C=this.config[e];meta=Dd({width:C.width,height:C.height,seed:C.seed,prompt:C.prompt,left_margin:C.left_margin,up_margin:C.up_margin},meta)}else w=this.getOtherParams(data);return Dd(Dd(Dd(Dd({},this.config[e||this.menuIndex]),{},{art_work_no:m,art_model_ver_no:v?v.model_ver_no:"",denoising_strength:.35},meta),w),{},{isTranslate:!0,n_iter:c||2,isRead:w.imageUrl&&w.imageUrl[0],category:Object(B.d)((null==data?void 0:data.category)||(null==data||null===(l=data.meta)||void 0===l?void 0:l.category)||1),base_model_type:_})},handleVariationsMeta:function(data,meta){try{var e,t=data.img_uris,n=(meta||{}).init_images,o=null==data||null===(e=data.banner)||void 0===e?void 0:e.url;meta.init_images=t.length?n||[]:o?[o]:[]}catch(e){}return meta},getOtherParams:function(data){var e=data||{},t=e.meta,n=t.controlnet_units,o=void 0===n?[]:n,image=t.image,l=e.operate_number,r={workIndex:0};if(["imageToImage","conditionToImage","animGen"].includes(this.menuIndex)){var c,d=(null==data?void 0:data.category)||(null==data||null===(c=data.meta)||void 0===c?void 0:c.category)||1;r={imageUrl:this.getImageUrl(data),controlnet_units:l?[]:this.getControlNetParams(o,d)}}else"expansion"===this.menuIndex&&(r={imageUrl:[image],isDrag:!1});return r},getControlNetParams:function(e,t){var n=this,o=e.map((function(e){var o=e.type,l=e.processor_res,r=void 0===l?512:l,c=e.module,d=e.model,h=e.control_mode,m=e.weight,v=e.threshold_a,f=o||n.defaultModule,_=d,y=c,w=t||n.getConfigCategory(),C=["5",5,"sdxl","SDXL"].includes(w)?n.taskSdxlUnits:n.taskUnits,k=C.find((function(i){return i.type==n.defaultModule}))||{},S=C.find((function(e){return e.models.includes(d)}));S&&(f=S.type);return("None"==d||["t2i-adapter_diffusers_xl_canny","t2i-adapter_xl_canny","t2i-adapter_diffusers_xl_openpose","t2i-adapter_xl_openpose","t2i-adapter_diffusers_xl_lineart","t2i-adapter_diffusers_xl_depth_midas","t2i-adapter_diffusers_xl_depth_zoe"].includes(d))&&(f=n.defaultModule,_=(null==k?void 0:k.default_model)||"None",y=(null==k?void 0:k.default_module)||"none"),o&&(f=o),{type:f,processor_res:r,module:y,isHandle:"none"!==c,model:_,threshold_a:v,control_mode:Number(h),weight:m,enable:!0}}));return o},getImageUrl:function(data){var e=[],t=data||{},n=t.meta,o=n.init_images,l=n.controlnet_units,r=t.operate_number,c=t.img_uris,d=t.banner;return r&&c&&c.length&&(e[3]=c[r-1].url),null!=l&&l.length&&!r&&(e=l.map((function(e){return e.input_image}))),this.handleWorkIndex()&&!e[3]&&(e[3]=o?o[0]:(null==d?void 0:d.url)||""),e},handleWorkIndex:function(){return["imageToImage","animGen","characterRepair"].includes(this.menuIndex)},handleParams:function(e,t){var n=this.accountSettingsData.is_off_localization,o=["mask","mask_blur","inpainting_fill","inpainting_mask_invert","inpaint_full_res","inpaint_full_res_padding"];"imageToImage"===this.menuIndex&&(o=e.meta.mask?o.slice(1):o);var l,r=e.local_prompt,c=e.parent_task_id,d=e.operate_number,h=e.meta,m=h.prompt,v=(h.sampler_name,e.action),f=e.channel,_=e.art_model,y=(e.banner,e.task,_||{}),w=y.name,C=y.id,k=y.agency_fee,S=void 0===k?0:k,x=y.is_agency_fee,I=void 0!==x&&x;if("textToImage"===this.menuIndex){var O=Object(B.d)(f);localStorage.setItem("defaultCategory",O),e.meta.category=O}C&&(e.meta.art_model_no=C,e.meta.modelName=w,e.meta.agency_fee=S||0,e.meta.is_agency_fee=I||!1,e.meta.model_cover=(null==_||null===(l=_.banner)||void 0===l?void 0:l.url)||"",e.meta.art_model_ver_no_name=(null==_?void 0:_.version_name)||"",e.meta.base_model_type=(null==_?void 0:_.base_model)||"",e.meta.modelTags=this.getStudioModelTags(_));return _&&_.id==e.id&&(_.model_ver_no=e.model_ver_no),e.meta.local_prompt=r,e.meta=Dd(Dd({},e.meta),{},{action:v}),n||(e.meta.prompt=r,e.meta.local_prompt=m),c&&(e.meta.parent_task_id=c),d&&(e.meta.operate_number=d),Object.keys(e.meta).forEach((function(t){o.includes(t)&&delete e.meta[t]})),e},getDefaultModel:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(null==data||!data.art_model)try{var e,t,n,o,l,r,c,d,h,m,v,f,_,y,w,C,k={},S={banner:{url:""}};if(this.defaultModel)(k=JSON.parse(JSON.stringify(this.defaultModel))).cover=(null===(y=k)||void 0===y||null===(y=y.banner)||void 0===y?void 0:y.url)||"",S.cover=(null===(w=k)||void 0===w||null===(w=w.banner)||void 0===w?void 0:w.url)||"",S.model_cover=(null===(C=k)||void 0===C||null===(C=C.banner)||void 0===C?void 0:C.url)||"";S.id=null===(e=k)||void 0===e?void 0:e.id,S.name=null===(t=k)||void 0===t?void 0:t.name,S.art_work_no="",S.banner.url=null===(n=k)||void 0===n?void 0:n.cover,S.is_agency_fee=(null===(o=k)||void 0===o?void 0:o.is_agency_fee)||!1,S.agency_fee=(null===(l=k)||void 0===l?void 0:l.agency_fee)||0,S.version_name=(null===(r=k)||void 0===r?void 0:r.model_ver_name)||(null===(c=k)||void 0===c?void 0:c.version_name),S.model_ver_name=(null===(d=k)||void 0===d?void 0:d.model_ver_name)||(null===(h=k)||void 0===h?void 0:h.version_name),S.model_ver_no=(null===(m=k)||void 0===m?void 0:m.model_ver_no)||"",S.base_model=(null===(v=k)||void 0===v?void 0:v.base_model)||"",S.modelTags=Array.isArray(null===(f=k)||void 0===f?void 0:f.tags)?null===(_=k)||void 0===_?void 0:_.tags:[],data.art_model=S}catch(e){}return data},getReferParams:function(e){var t={},n=e.model_ver_no,o=e.art_work_no,l=e.id,r=e.prompt,c=(e.banner,e.samples,e.taskSource),d=void 0===c?0:c,h=e.art_model,m=this.getParentId(e);return null!=h&&h.ver_id?t.art_model_ver_no=h.ver_id:n?[3,"3"].includes(d)||(t.art_model_ver_no=n):o||l?t.art_work_no=o||m:r&&!e.noRefer&&(t.prompt=r),0===Object.keys(t).length||[0,"0"].includes(d)||(t.source=d),l||o||null==e||!e.parent_task_id||(t.id=(null==e?void 0:e.parent_task_id)||""),t},getParentId:function(e){var t=e.parent_art_work,n=e.type,o=e.parent_art_work_no,l=e.id;return 1===n&&(o||t)?o||t.id:l},setDefaultMeta:function(e,t){var n=this,o=e.action;e.art_work_no,e.imageUrl;o=o<1?1:o;Object(ye.k)();var l=this.defaultModel;if(null!=l&&l.id){var r=this.getModelParams(e);r=this.setModelVersion(r,e),t||(delete this.config[this.menuIndex].channel,this.config[this.menuIndex]=Dd(Dd(Dd({},this.config[this.menuIndex]),e),{},{action:o},r),this.$set(this.config,this.menuIndex,this.config[this.menuIndex]))}else setTimeout((function(){n.setDefaultMeta(e,t)}),2e3)},getModelParams:function(e){var t,n,o,l,r=this.config[this.menuIndex].category,c=[5,"5","sdxl"].includes(r),d=(this.checkIsStudioMode(r),e.art_work_no),h=(e.model_ver_no,e.type),m=e.banner,v=e.action,f=e.name,_=e.id,y=e.samples,w=["LORA","Checkpoint"].includes(h)&&(!(null!=y&&y.length)||""===(null==m?void 0:m.url)),C=c?this.sd_xl_base_model[0]:this.taskBaseModels[0],k=(Object(ye.k)(),{art_work_no:d,art_model_no:(C=null===(t=this.getDefaultModel({}))||void 0===t?void 0:t.art_model).id,modelName:C.name,agency_fee:0,is_agency_fee:!1,model_cover:C.cover||"",art_model_ver_no_name:(null===(n=C)||void 0===n?void 0:n.model_ver_name)||"",art_model_ver_no:(null===(o=C)||void 0===o?void 0:o.model_ver_no)||"",base_model_type:(null===(l=C)||void 0===l?void 0:l.base_model)||"",modelTags:this.getStudioModelTags(C)});return w&&("LORA"===h&&(k=this.getLoraParams(k,e)),"Checkpoint"===h&&(k.art_model_no=_,k.modelName=f)),6!==v&&(k.art_work_no=""),w&&(k.category=1),k},getLoraParams:function(e,t){var n,o=t.id,l=t.name,r=t.origin_model,c=t.agency_fee,d=t.is_agency_fee,h=t.base_model,m=t.cover;r&&(e.art_model_no=null==r?void 0:r.model_no,e.modelName=null==r?void 0:r.name,e.model_cover=(null==r||null===(n=r.banner)||void 0===n?void 0:n.url)||"",e.art_model_ver_no_name=(null==r?void 0:r.version_name)||"",e.base_model_type=(null==r?void 0:r.base_model)||"");return e.lora_models=[{id:o,name:l,banner:{url:m||""},weight:1,model_id:o,agency_fee:c,is_agency_fee:d,base_model:h||""}],e},checkIsStudioMode:function(){return["7","11",7,11,"studio"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")},getStudioModelTags:function(){var source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Array.isArray(null==source?void 0:source.tags)?null==source?void 0:source.tags:[]},setModelVersion:function(){var source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=Object(X.cloneDeep)(source);try{"LORA"===e.type&&(t.lora_models[0].model_ver_no=e.model_ver_no),"Checkpoint"===e.type&&(t.art_model_ver_no=e.model_ver_no)}catch(e){}return t},openEasyUpscaleToolsModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log("收到消息--打开高清修复"),this.$refs.upscaleToolsModal.show(e)},openAnimeToolsModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log("收到消息--打开动画生成"),this.$refs.animeToolsModal.show(e)},getCacheConfig:function(){var e=null;try{e=localStorage.getItem("easyCacheConfig")||null,e=JSON.parse(e)||null}catch(e){}return e},getImageNums:function(){var e=localStorage.getItem("imageNums")||2;return["1","2","3","4",1,2,3,4].includes(e)?Number(e):2},saveConfig:function(){localStorage.setItem("easyCacheConfig",JSON.stringify(this.config))},resetConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getCacheConfig(),o=JSON.parse(JSON.stringify(this.config)),l=this.getImageNums();for(var i in this.isLoggedIn||(l=2),this.config){var r,c={prompt_magic:2,generationMode:1,enableNegativePrompts:!1,lockSeed:!1,vae:"vae-ft-mse-840000-ema-pruned",prompt:"",local_prompt:"",art_work_no:"",art_model_no:"",art_model_ver_no:"",base_model_type:"",modelName:"",is_agency_fee:!1,agency_fee:0,model_cover:"",art_model_ver_no_name:"",modelTags:[],lora_models:[],restore_faces:!1,sampler_name:"DPM++ 2M Karras",cfg_scale:7,steps:20,width:688,height:1024,lcm_mode:0,generate:{anime_enhance:2,mode:0,gen_mode:0,prompt_magic_mode:2},clip_skip:1,denoising_strength:.35,n_iter:l||1,up_scaler:"4x-UltraSharp",mask:"",tempMask:"",copyMask:"",compose_mask:"",channelZoom:!0,faceSwapZoom:!0,enablePromptMagic:!0,enable_hr:!1,hr_upscaler:"",hr_second_pass_steps:20,hr_upscaler_redraw:.5,hr_scale:1.5,lab_base:{conds:"conditionToImage"!==i?[]:[{image:"",mode:"PyraCanny",stop_at:.5,weight:1}],style_selections:["Studio Enhance","Studio Expand"],expand_token_length:10,hdr_enabled:!0,hdr_intensity:.5,auto_brightness_open:!0,auto_brightness_strength:75,auto_adjust_open:!1,auto_adjust_strength:20,semantics_open:!1,film_turbo:0,sharpness:2,scheduler:"karras",quality_open:!1,quality_detail_offset:.45,quality_mode:3,quality_type:"anime",intelligence_open:!1,prompt_magic:!0},embeddings:[],ad_model:"characterRepair"===i?"face":"",ad_units:{lora:{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""},imageToImageList:[],controlnet_units:[],ipList:[],speed_type:this.config[i].speed_type,generateing:!1};if(e)try{var d,h,m;null===(d=(c=Object.assign({},c,n[i]||{}))[this.menuIndex])||void 0===d||d.category;c.category=1,c.generateing=!1,c.speed_type=this.config[i].speed_type,c.keepDenoisingStrength=!1,c.logEventSource=0,((null===(h=c)||void 0===h?void 0:h.imgFiles)||[]).forEach((function(e){["",null,void 0].includes(e)||(e.uploading=!1)})),null!==(m=c)&&void 0!==m&&m.art_model_no||this.resetStudioParams()}catch(e){}if(e&&(null===(r=c)||void 0===r||!r.art_model_no))return void this.initParams();try{var v,f;if(t)c.prompt=(null===(v=o[i])||void 0===v?void 0:v.prompt)||"",c.local_prompt=(null===(f=o[i])||void 0===f?void 0:f.local_prompt)||""}catch(e){}this.$set(this.config,i,c)}t&&this.resetStudioParams()},getControlNet:function(){return{type:this.defaultModule,processor_res:512,module:this.defaultModule,model:this.getModel()||"",control_mode:0,threshold_a:.5,weight:1,isHandle:!0,input_image:""}},addControlNet:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.getControlNet();n.type=e.type,(n=Object.assign(n,e||{})).input_image=t,n.enable=!0,console.log(n,"添加的controlNet"),this.config.textToImage.controlnet_units.push(n)},getModel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultModule,t=this.taskControlNetModules.findIndex((function(t){return t===e}));return this.taskModels[t]},updateConfig:function(e,t){console.log("更新属性!!",e),this.$set(this.config,"textToImage",Object.assign(this.config.textToImage,e))},getStudioModelTagsType:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(null==e?void 0:e.modelTags)||[],n=this.lab_style_enhancement_tag||{},o=n.anime,l=void 0===o?[]:o,r=n.realism,c=void 0===r?[]:r,d=(l||[]).some((function(e){return null==t?void 0:t.includes(e)})),h=(c||[]).some((function(e){return null==t?void 0:t.includes(e)}));return d?"anime":h&&!d?"realistic":"anime"},changeSpeedType:function(){var e=Number(localStorage.getItem("speed_type")),t=this.isOnlyVipLite||!e?2:e;if(this.paymentInfoDone&&this.userInfoDone)for(var i in this.config)this.config[i]=Dd(Dd({},this.config[i]),{},{speed_type:this.isVip?t:1})},getCalcCost:function(){var e=this;return Object(E.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.config[e.menuIndex],null!==(n=e.config)&&void 0!==n&&null!==(n=n.textToImage)&&void 0!==n&&n.art_model_no){t.next=3;break}return t.abrupt("return");case 3:if(o.prompt){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,e.getParams();case 8:l=t.sent,r=e.getGenerateType(),(c=e.getParamsByType(l,r)).meta.generate=e.config.textToImage.generate,e.isPosting=!0,console.log("获取最新的预估消耗-----"),Object(dn.h)(c).then((function(t){var n,o;t&&1e4!==(null==t||null===(n=t.status)||void 0===n?void 0:n.code)||(e.calcCost=(null==t||null===(o=t.data)||void 0===o?void 0:o.calculate_coins)||0)})).finally((function(){e.isPosting=!1}));case 15:case"end":return t.stop()}}),t)})))()}}},Ed=Nd,Rd=(n(3144),Object(y.a)(Ed,(function(){var e=this,t=e._self._c;return[2,"2"].includes(e.currentGenerateMode)?t("div",{staticClass:"c-easy-generate"},[t("easy-generate-top-bar",{on:{close:function(t){return e.closePopup()},backOld:e.backOld,channelSearch:e.handleChannelSearch}}),e._v(" "),t("div",{staticClass:"easy-generate-content"},[["model"].includes(e.activeCategory)?[t("params-panel",{attrs:{value:e.config.textToImage}})]:[t("common-params-panel")],e._v(" "),t("div",{staticClass:"easy-generate-content-right"},[["model"].includes(e.activeCategory)?[t("div",{staticClass:"easy-generate-content-right-top"},[t("easy-top-input-area",{attrs:{value:e.config.textToImage},on:{updateInputHeight:e.handleUpdateTaskPadding}}),e._v(" "),e.isShowSubBanner?t("g-recharge-banner",{directives:[{name:"show",rawName:"v-show",value:!e.isCompanyAccount,expression:"!isCompanyAccount"}],on:{close:e.closeSubBanner}}):e._e()],1),e._v(" "),t("task-view",{ref:"taskView",attrs:{taskTopPadding:e.taskTopPadding,channelId:e.channelId},on:{reload:e.show,closePopup:e.closePopup}})]:e._e(),e._v(" "),["fast_app"].includes(e.activeCategory)?[t("generate-results",{ref:"GenerateResultsRef"})]:e._e(),e._v(" "),["character"].includes(e.activeCategory)?[t("AiChat")]:e._e()],2)],2),e._v(" "),t("upscale-tools-modal",{ref:"upscaleToolsModal"}),e._v(" "),t("anime-tools-modal",{ref:"animeToolsModal"}),e._v(" "),t("CombinedSelectDialog")],1):e._e()}),[],!1,null,"67d9a3e6",null).exports),Ad={name:"NewVersionNoticeModal",data:function(){return{visible:!1}},methods:{show:function(){this.$logEvent("log_actions",{operation:"create_flow_guide_show",behavior_info:"on_create_flow_guide_popup"}),this.resetData(),this.visible=!0},resetData:function(){},handleClose:function(e){var t=1===e?"click_exit":"click_cancel";this.$logEvent("log_actions",{operation:t,behavior_info:"on_create_flow_guide_popup"}),this.visible=!1;Object(dn.e)({type:3}),localStorage.setItem("hasConfirmGenerateNotice",!0)},handleConfirm:function(){this.$logEvent("log_actions",{operation:"click_confirm",behavior_info:"on_create_flow_guide_popup"});Object(dn.e)({type:3}),localStorage.setItem("hasConfirmGenerateNotice",!0),this.visible=!1,this.$emit("confirm")}}},Bd=(n(3145),Object(y.a)(Ad,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,"custom-class":"easy-new-version-notice-modal custom-dialog","destroy-on-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,modal:!0,"modal-append-to-body":"","append-to-body":"",width:"407px"},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"easy-new-version-notice-modal-header"},[t("div",{staticClass:"modal-header-title"},[e._v(e._s(e.$t("Tip")))]),e._v(" "),t("span",{staticClass:"modal-header-close",on:{click:function(t){return t.stopPropagation(),e.handleClose(1)}}},[t("i",{staticClass:"el-icon-close"})])]),e._v(" "),t("div",{staticClass:"easy-new-version-notice-modal-content"},[t("div",{staticClass:"easy-new-version-notice-modal-content-title"},[t("img",{attrs:{src:n(741),alt:""}}),e._v(" "),t("span",{staticClass:"easy-new-version-notice-modal-content-title-text"},[e._v(e._s(e.$t("newGenerate25")))])]),e._v(" "),t("div",{staticClass:"easy-new-version-notice-modal-content-sub-title"},[e._v(e._s(e.$t("newGenerate24")))])]),e._v(" "),t("div",{staticClass:"easy-new-version-notice-modal-footer"},[t("span",{staticClass:"modal-footer-btn",on:{click:function(t){return t.stopPropagation(),e.handleClose(2)}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("span",{staticClass:"modal-footer-btn modal-footer-btn-confirm",on:{click:function(t){return t.stopPropagation(),e.handleConfirm()}}},[e._v(e._s(e.$t("sketch_btn")))])])])}),[],!1,null,null,null).exports),Ud={components:{GenerateMenu:N,GeneratePrompt:Ee,GenerateHandle:Yt,TaskView:Le,CWorkPanel:Bi,ControlNetPopup:Wi,ChannelPersonPopup:Ji,ChannelSearch:Yi,ChannelSelectMenu:tn,SimpleGenerate:Ui.a,GRechargeBanner:nn.a,EasyGenerate:Rd,NewVersionNoticeModal:Bd},mixins:[Ki.a,Xi.a],data:function(){return{postSelectList:[],enableSubmit:!1,enableClassicMode:!0}},watch:{$route:function(e,form){this.isShowPopup&&this.closePopup()},"config.imageToImage":{handler:function(e,t){if(e.mask&&""===t.mask){this.config.imageToImage.keepDenoisingStrength?console.log("不重置局部重绘强度"):this.config.imageToImage.denoising_strength=.7;try{/^(http|https):\/\//.test(e.mask)||(this.config.imageToImage.prompt="")}catch(e){}}e.mask&&e.mask!==t.mask&&(this.config.imageToImage.ad_model=""),e.ad_model&&""===t.ad_model&&(this.config.imageToImage.denoising_strength=.7,this.config.imageToImage.mask="")},immediate:!0,deep:!0},menuIndex:{handler:function(e,t){var n=this;"textToImage"===e&&"textToImage"!==t&&this.$nextTick((function(){n.taskViewScrollToBottom()}))},immediate:!0,deep:!0}},methods:{handleEnableClassicMode:function(){this.$logEvent("log_actions",{operation:"click_switch_model",behavior_info:"on_new_create_flow_page",behavior_info_sub:"close"}),this.handleSwitchMenu(2),this.enableClassicMode=!0},handleChannelSearch:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";null==this||null===(e=this.$refs)||void 0===e||null===(e=e.taskView)||void 0===e||e.handleSearch(t),this.$logEvent("log_actions",{operation:"type_search",behavior_info:"on_create_flow_page"})},changePostStatus:function(){this.enableSubmit=!this.enableSubmit},cancelPost:function(){this.enableSubmit=!1,this.postSelectList=[]},sendToPost:function(){if(this.postSelectList.length){try{this.$logEvent("log_actions",{operation:"click_post_picture_button",behavior_info:"on_creative_flow",behavior_info_sub:(this.postSelectList||[]).map((function(e){return e.url}))})}catch(e){}this.$EventBus.$emit("openCreativeCenterModal",{list:this.postSelectList,type:"text",source:"task"})}else this.$message.warning(this.$t("selectOneWork"))},updatePostSelectList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(this.postSelectList||[]).findIndex((function(t){return e.url===t.url}));-1===t?-1===t&&this.postSelectList.length<20&&this.postSelectList.push(e):this.postSelectList.splice(t,1)}}},Fd=Ud,zd=(n(3146),Object(y.a)(Fd,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"generate-popup",attrs:{visible:e.isShowPopup,fullscreen:"","before-close":e.closePopup,"destroy-on-close":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.isShowPopup=t}}},[t("div",{staticClass:"generate-body"},[t("easy-generate",{directives:[{name:"show",rawName:"v-show",value:[2,"2"].includes(e.currentGenerateMode),expression:"[2,'2'].includes(currentGenerateMode)"}],ref:"easyGenerate",attrs:{isShowSubBanner:e.isShowSubBanner,isShowPopup:e.isShowPopup,currentGenerateMode:e.currentGenerateMode},on:{close:e.closePopup,backOld:e.handleSwitchMenu,closeSubBanner:e.closeSubBanner}}),e._v(" "),[2,"2"].includes(e.currentGenerateMode)?e._e():[t("generate-menu",{attrs:{menuIndex:e.menuIndex},on:{changeMenu:e.changeMenu,close:e.closePopup}}),e._v(" "),t("div",{staticClass:"generate-content"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"SIMPLE"!==e.menuIndex,expression:"menuIndex !== 'SIMPLE'"}],staticClass:"generate-work"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!["promptStudio"].includes(e.menuIndex),expression:"!['promptStudio'].includes(menuIndex)"}],staticClass:"channel-title",style:{height:e.isShowSubBanner&&"textToImage"===e.menuIndex?"100px":"46px"}},[t("div",{staticClass:"title-handle"},[e.token?t("div",{staticClass:"channel-title-left"},[t("channel-select-menu"),e._v(" "),t("channel-search",{directives:[{name:"show",rawName:"v-show",value:"PRIVATE"===e.channelInfo.name&&["textToImage"].includes(e.menuIndex),expression:"\n                  channelInfo.name === 'PRIVATE' && ['textToImage'].includes(menuIndex)\n                "}],on:{channelSearch:e.handleChannelSearch}})],1):e._e(),e._v(" "),t("div",{staticClass:"channel-title-right"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"PRIVATE"===e.channelInfo.name&&["textToImage"].includes(e.menuIndex)&&!e.isCompanyAccount,expression:"\n                  channelInfo.name === 'PRIVATE' &&\n                  ['textToImage'].includes(menuIndex) &&\n                  !isCompanyAccount\n                "}],staticClass:"post-btn-area"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.enableSubmit,expression:"!enableSubmit"}],staticClass:"base-btn post-btn",on:{click:function(t){return t.stopPropagation(),e.changePostStatus.apply(null,arguments)}}},[t("i",{staticClass:"iconfont icon-post-icon1 post-btn-icon"}),e._v(" "),t("span",{staticClass:"post-btn-text"},[e._v(e._s(e.$t("Post")))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit,expression:"enableSubmit"}],staticClass:"base-btn cancel-btn",on:{click:function(t){return t.stopPropagation(),e.cancelPost.apply(null,arguments)}}},[e._v("\n                    "+e._s(e.$t("Cancel"))+"\n                  ")]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.enableSubmit,expression:"enableSubmit"}],staticClass:"base-btn next-step-btn",on:{click:function(t){return t.stopPropagation(),e.sendToPost.apply(null,arguments)}}},[e._v("\n                    "+e._s(e.$t("NextStep"))+"\n                  ")])]),e._v(" "),t("div",{staticClass:"switch-btn-box"},[t("span",{staticClass:"switch-btn-label"},[e._v(e._s(e.$t("newGenerate36")))]),e._v(" "),t("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:e.$t("newGenerate35"),placement:"top-start"}},[t("span",{staticClass:"switch-btn-icon el-icon-question"})]),e._v(" "),t("el-switch",{attrs:{"active-color":"#3F8CFF"},on:{change:e.handleEnableClassicMode},model:{value:e.enableClassicMode,callback:function(t){e.enableClassicMode=t},expression:"enableClassicMode"}})],1),e._v(" "),e.channelInfo.num?t("span",{staticClass:"channel-num",on:{click:e.viewChannelPerson}},[t("i",{staticClass:"el-icon-s-custom"}),e._v(e._s(e.channelInfo.num)+"\n              ")]):e._e()])]),e._v(" "),e.isShowSubBanner?t("g-recharge-banner",{directives:[{name:"show",rawName:"v-show",value:"textToImage"===e.menuIndex&&!e.isCompanyAccount,expression:"menuIndex === 'textToImage' && !isCompanyAccount"}],on:{close:e.closeSubBanner}}):e._e()],1),e._v(" "),t("div",{staticClass:"work-panel"},[e.token?t("task-view",{directives:[{name:"show",rawName:"v-show",value:["textToImage","task"].includes(e.menuIndex),expression:"['textToImage', 'task'].includes(menuIndex)"}],ref:"taskView",on:{reload:e.show,closePopup:e.closePopup}}):e._e(),e._v(" "),e._l(e.menuKey,(function(n,o){return t("c-work-panel",{directives:[{name:"show",rawName:"v-show",value:e.menuIndex===n,expression:"menuIndex === val"}],key:"work_"+o,attrs:{menuIndex:n},on:{generate:e.generate,imgReadInfo:e.imgReadInfo,updateImageSize:e.handleUpdateImageSize,animSetWork:function(t){return e.getConfig(t)},onDelete:function(t){return e.resetConfig(!0)}},model:{value:e.config[n],callback:function(t){e.$set(e.config,n,t)},expression:"config[val]"}})}))],2),e._v(" "),t("generate-prompt",{directives:[{name:"show",rawName:"v-show",value:e.showPrompt,expression:"showPrompt"}],model:{value:e.config[e.menuIndex],callback:function(t){e.$set(e.config,e.menuIndex,t)},expression:"config[menuIndex]"}})],1),e._v(" "),t("generate-handle",{directives:[{name:"loading",rawName:"v-loading",value:!["descriptors"].includes(e.menuIndex)&&e.config[e.menuIndex].generateing,expression:"\n          !['descriptors'].includes(menuIndex) && config[menuIndex].generateing\n        "},{name:"show",rawName:"v-show",value:e.showHandle,expression:"showHandle"}],on:{sendParams:e.sendParams},model:{value:e.config[e.menuIndex],callback:function(t){e.$set(e.config,e.menuIndex,t)},expression:"config[menuIndex]"}}),e._v(" "),t("simple-generate",{directives:[{name:"show",rawName:"v-show",value:"SIMPLE"===e.menuIndex,expression:"menuIndex === 'SIMPLE'"}],ref:"simpleGenerate"})],1),e._v(" "),t("control-net-popup",{ref:"controlnetPopup",model:{value:e.config[e.menuIndex],callback:function(t){e.$set(e.config,e.menuIndex,t)},expression:"config[menuIndex]"}}),e._v(" "),t("channel-person-popup",{ref:"channelPersonPopup"})]],2),e._v(" "),e.isShowPopup&&[1,"1"].includes(e.currentGenerateMode)?t("new-version-notice-modal",{ref:"newVersionNoticeModal",on:{confirm:function(t){return e.handleSwitchMenu(2)}}}):e._e()],1)}),[],!1,null,"562fdb3a",null));t.default=zd.exports},3249:function(e,t,n){"use strict";n.r(t);n(10),n(19),n(14),n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),l=(n(70),n(1));function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var c={name:"headBar",data:function(){return{}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(l.e)("user",["userInfo"])),methods:{handleClose:function(){this.$emit("closePopup")},initials:function(e){return(e||"").split(" ").map((function(e){return e[0]})).join("")}}},d=c,h=(n(3162),n(0)),m=Object(h.a)(d,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"head-bar"},[t("div",{staticClass:"head-bar-content"},[t("img",{staticClass:"head-bar-logo",attrs:{src:n(124),alt:"Avatar"}}),e._v(" "),t("span",{staticClass:"head-bar-title"},[e._v(e._s(e.$t("creativeCenter")))]),e._v(" "),t("i",{staticClass:"iconfont icon-goBack head-bar-icon",on:{click:e.handleClose}})]),e._v(" "),t("div",{staticClass:"head-bar-content"},[t("div",{staticClass:"avatar",class:[e.userInfo.head?"":"avatar-color"]},[e.userInfo.head?t("img",{attrs:{src:e.userInfo.head,alt:"avatar"}}):t("div",[e._v("\n        "+e._s(e.initials(e.userInfo.name?e.userInfo.name:e.userInfo.id))+"\n      ")])]),e._v(" "),t("div",{staticClass:"name-text"},[e._v("\n      "+e._s(e.userInfo.name?e.userInfo.name:e.userInfo.id)+"\n    ")])])])}),[],!1,null,"b0bab2e6",null).exports,v=(n(667),n(44),n(428)),f=n.n(v),_=(n(668),n(429)),y=n.n(_),w=(n(28),{name:"CreativeCenterMenu",components:{ElMenu:y.a,ElMenuItem:f.a},props:{menuIndex:{type:[String,Number],default:""}},data:function(){return{zoomMenu:[]}},methods:{changeMenu:function(){},changeZoom:function(){}}}),C=(n(3163),Object(h.a)(w,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"creative-center-menu"},[t("el-menu",{ref:"generateMenu",attrs:{"default-active":e.menuIndex,"default-openeds":e.zoomMenu},on:{select:e.changeMenu,open:function(t){return e.changeZoom(t,"open")},close:function(t){return e.changeZoom(t,"close")}}},[t("el-menu-item",{attrs:{index:"submittedWorks"}},[t("template",{slot:"title"},[t("i",{staticClass:"iconfont icon-wenshengtu creative-center-menu-item-icon"}),e._v("\n        "+e._s(e.$t("CreativeCenterPopup34")))])],2)],1)],1)}),[],!1,null,"76064e8f",null).exports),k={name:"handleText",inject:["top"],data:function(){return{uploading:!1,accept:".jpg,.jpeg,.png,.svg,.webp,.bmp,.tif"}},methods:{fileExceed:function(){this.$message({type:"warning",message:this.$t("CreativeCenterPopup20",{number:20})})},handleBeforeUpload:function(e){return this.handleUploadImage(e),!1},handleBeforeUploadEmpty:function(){},handleUploadImage:function(e){console.log("上传图片"),e&&(this.$emit("changeStep",2),this.top.changeType("upload"),e&&this.top.jumpToTextEdit(e))},handleSelectImage:function(){console.log("选择图片"),this.$emit("openPickWorkModal"),this.top.changeType("pick")}}},S=(n(3164),Object(h.a)(k,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"handle-text-upload"},[t("div",{staticClass:"text-upload-tip"},[t("i",{staticClass:"el-icon-warning"}),e._v(" "),t("span",[e._v(e._s(e.$t("TextPostTip")))])]),e._v(" "),t("div",{staticClass:"upload-area"},[[t("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],ref:"imageUpload2",staticClass:"image-upload",attrs:{action:"#",drag:"","before-upload":e.handleBeforeUpload,disabled:e.uploading,accept:e.accept,multiple:"",limit:20,"on-exceed":e.fileExceed,"http-request":e.handleBeforeUploadEmpty,"show-file-list":!1}},[t("i",{staticClass:"iconfont icon-icon_Upload image-upload-icon"}),e._v(" "),t("div",{staticClass:"el-upload__text"},[t("div",{staticClass:"el-upload__text_1"},[e._v(e._s(e.$t("CreativeCenterPopup19")))]),e._v(" "),t("div",{staticClass:"el-upload__text_2"},[e._v("（ "+e._s(e.$t("CreativeCenterPopup20",{number:20}))+" ）")]),e._v(" "),t("div",{staticClass:"el-upload__btn-box"},[t("div",{staticClass:"upload-box-btn upload-box-btn-gradient",on:{click:function(t){return e.handleUploadImage()}}},[t("div",{staticClass:"upload-box-btn-inner"},[e._v(e._s(e.$t("UploadImg")))])]),e._v(" "),t("div",{staticClass:"upload-box-btn",on:{click:function(t){return t.stopPropagation(),e.handleSelectImage.apply(null,arguments)}}},[e._v(e._s(e.$t("CreativeCenterPopup21")))])])])])]],2),e._v(" "),t("div",{staticClass:"upload-describe-wrapper"},[t("div",{staticClass:"upload-describe-area-item"},[t("p",[e._v(e._s(e.$t("CreativeCenterPopup1")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup2")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup3",{number:10})))])]),e._v(" "),t("div",{staticClass:"upload-describe-area-item upload-describe-area-item-margin"},[t("p",[e._v(e._s(e.$t("CreativeCenterPopup4")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup5")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup6")))])]),e._v(" "),t("div",{staticClass:"upload-describe-area-item"},[t("p",[e._v(e._s(e.$t("CreativeCenterPopup7")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup8")))])])])])}),[],!1,null,null,null)),x=S.exports,I={name:"handleVideo",inject:["top"],data:function(){return{uploading:!1}},methods:{handleBeforeUpload:function(e){if(-1===["video/mp4","video/ogg","video/flv","video/avi","video/wmv","video/rmvb","video/quicktime"].indexOf(e.type))return this.$message.warning(this.$t("OnlySupportVideo"));if(!(e.size>1073741824))return this.handleUploadVideo(e),!1;this.$message.warning(this.$t("CreativeCenterPopup12",{number:1}))},handleBeforeUploadEmpty:function(){},handleUploadVideo:function(e){e&&(this.$emit("changeStep",2),this.top.changeType("upload"),e&&this.top.jumpToVideoEdit(e))}}},O=(n(3165),Object(h.a)(I,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"handle-video-upload"},[t("div",{staticClass:"video-upload-tip"},[t("i",{staticClass:"el-icon-warning"}),e._v(" "),t("span",[e._v(e._s(e.$t("VideoPostTip")))])]),e._v(" "),t("div",{staticClass:"upload-area"},[[t("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],ref:"videoUpload",staticClass:"image-upload",attrs:{action:"#",drag:"","before-upload":e.handleBeforeUpload,disabled:e.uploading,accept:"video/*","http-request":e.handleBeforeUploadEmpty,"show-file-list":!1}},[t("i",{staticClass:"iconfont icon-icon_Upload image-upload-icon"}),e._v(" "),t("div",{staticClass:"el-upload__text"},[t("div",{staticClass:"el-upload__text_1"},[e._v(e._s(e.$t("CreativeCenterPopup22")))]),e._v(" "),t("div",{staticClass:"el-upload__btn-box"},[t("div",{staticClass:"upload-box-btn",on:{click:function(t){return e.handleUploadVideo()}}},[e._v(e._s(e.$t("selectingMaterialsType3")))])])])])]],2),e._v(" "),t("div",{staticClass:"upload-describe-wrapper"},[t("div",{staticClass:"upload-describe-area-item"},[t("p",[e._v(e._s(e.$t("CreativeCenterPopup10")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup11",{number:15})))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup12",{number:1})))])]),e._v(" "),t("div",{staticClass:"upload-describe-area-item upload-describe-area-item-margin"},[t("p",[e._v(e._s(e.$t("CreativeCenterPopup13")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup14")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup15")))])]),e._v(" "),t("div",{staticClass:"upload-describe-area-item"},[t("p",[e._v(e._s(e.$t("CreativeCenterPopup16")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup17")))])])])])}),[],!1,null,null,null).exports),T={name:"handleArticle",inject:["top"],data:function(){return{uploading:!1,accept:".jpg,.jpeg,.png,.svg,.webp,.bmp,.tif"}},methods:{handleBeforeUpload:function(e){return this.handleUploadImage(e),!1},handleBeforeUploadEmpty:function(){},handleUploadImage:function(e){e&&(this.$logEvent("log_actions",{operation:"click_upload_cover_tab",behavior_info:"on_artical_upload_popup"}),this.$emit("changeStep",2),this.top.changeType("upload"),this.top.jumpToArticleEdit(e))},handleSelectImage:function(){this.$logEvent("log_actions",{operation:"click_personal_work_tab",behavior_info:"on_artical_upload_popup"}),this.$emit("openPickWorkModal"),this.top.changeType("pick")}}},$=(n(3166),Object(h.a)(T,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"handle-article-upload"},[t("div",{staticClass:"text-upload-tip"},[t("i",{staticClass:"el-icon-warning"}),e._v(" "),t("span",[e._v(e._s(e.$t("ArticlePostTip")))])]),e._v(" "),t("div",{staticClass:"upload-area"},[[t("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],ref:"imageUpload2",staticClass:"image-upload",attrs:{action:"#",drag:"","before-upload":e.handleBeforeUpload,disabled:e.uploading,accept:e.accept,"http-request":e.handleBeforeUploadEmpty,"show-file-list":!1}},[t("i",{staticClass:"iconfont icon-icon_Upload image-upload-icon"}),e._v(" "),t("div",{staticClass:"el-upload__text"},[t("div",{staticClass:"el-upload__text_1"},[e._v("\n\t\t\t\t\t\t"+e._s(e.$t("CreativeCenterPopup19"))+"\n\t\t\t\t\t")]),e._v(" "),t("div",{staticClass:"el-upload__text_2"},[e._v("\n\t\t\t\t\t\t（ "+e._s(e.$t("ArticleUploadLimit"))+" ）\n\t\t\t\t\t")]),e._v(" "),t("div",{staticClass:"el-upload__btn-box"},[t("div",{staticClass:"upload-box-btn upload-box-btn-gradient",on:{click:function(t){return e.handleUploadImage()}}},[t("div",{staticClass:"upload-box-btn-inner"},[e._v(e._s(e.$t("UploadImg")))])]),e._v(" "),t("div",{staticClass:"upload-box-btn",on:{click:function(t){return t.stopPropagation(),e.handleSelectImage.apply(null,arguments)}}},[e._v("\n\t\t\t\t\t\t\t"+e._s(e.$t("CreativeCenterPopup21"))+"\n\t\t\t\t\t\t")])])])])]],2),e._v(" "),t("div",{staticClass:"upload-describe-wrapper"},[t("div",{staticClass:"upload-describe-area-item"},[t("p",[e._v(e._s(e.$t("CreativeCenterPopup1")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup2")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup3",{number:10})))])]),e._v(" "),t("div",{staticClass:"upload-describe-area-item upload-describe-area-item-margin"},[t("p",[e._v(e._s(e.$t("CreativeCenterPopup4")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup5")))]),e._v(" "),t("div",[e._v(e._s(e.$t("CreativeCenterPopup6")))])]),e._v(" "),t("div",{staticClass:"upload-describe-area-item"},[t("p",[e._v(e._s(e.$t("CreativeCenterPopup7")))]),e._v(" "),t("div",[e._v(e._s(e.$t("ArticleImageScale")))])])])])}),[],!1,null,null,null)),L=$.exports,P=n(3),M=(n(20),n(32),n(47),n(43),n(125),n(29),n(38)),j=n(45),D=n(5),N={name:"UploadImageItem",props:["value","createId","max","showUpload"],inject:["top"],components:{ViewImage:n(207).a},data:function(){return{replaceImageType:D.x,isUploading:!1,accept:".jpg,.jpeg,.png,.svg,.webp,.bmp,.tif",fileList:[],tempList:[],batchSize:2,selectedFilesCount:0,bigMediaShow:!1,bigMediaUrl:"",dragIndex:-1}},computed:{showImgLoading:function(){return function(img){return!img.tags&&!img.disabled_tag&&"check"!=img.type&&(100!=img.uploadStatus||!img.error&&!img.ready)}}},watch:{value:function(e){console.log(11111111111,e),e&&this.$set(this,"fileList",e)}},mounted:function(){this.value&&this.$set(this,"fileList",this.value)},methods:{isMP4Link:function(link){return!link||!link.toLowerCase().endsWith(".mp4")},curstomUpload:function(e){var t=this;return Object(P.a)(regeneratorRuntime.mark((function n(){var o,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.isUploading=!0,!((o=e.file).size/1024/1024>2)){n.next=14;break}return n.prev=3,n.next=6,Object(j.a)(o,2097152);case 6:o=n.sent,n.next=14;break;case 9:return n.prev=9,n.t0=n.catch(3),console.error("Compression failed:",n.t0),t.isUploading=!1,n.abrupt("return");case 14:return n.next=16,t.checkImageSize(o);case 16:l=n.sent,t.addFileByUpload(o).then((function(e){console.log("自定义id",e);var n=new M.a({type:2});n.startUpload(o,{category:44,size:o.size}).then((function(o){var r=t.fileList.find((function(t){return t.imageId===e}));r.url=o,r.uploadStatus=100,r.ready=!0,r.file_id=n.fileId,r.width=l.width,r.height=l.height})).catch((function(n){var o=t.fileList.findIndex((function(t){return t.imageId===e}));t.deleteFile(o)})).finally((function(){console.log("finally"),t.isUploading=!1}))}));case 18:case"end":return n.stop()}}),n,null,[[3,9]])})))()},checkImageSize:function(e){return new Promise((function(t,n){var o=new FileReader;o.onload=function(e){var img=new Image;img.onload=function(){var e=img.naturalWidth,n=img.naturalHeight;t({width:e,height:n})},img.onerror=function(){n(!1)},img.src=e.target.result},o.readAsDataURL(e)}))},handleOpenPickArtWorkModal:function(){this.fileList.length>=this.max||this.$emit("openPickWorkModal",this.fileList)},handleChange:function(e,t){var n=this;this.tempList=t,this.$emit("input",this.fileList),setTimeout((function(){n.$emit("handleChange",n.fileList)}),500)},addFileByUpload:function(e){var t=this;return new Promise((function(n,o){var l=new FileReader;l.readAsDataURL(e),l.onload=function(){var o={imageId:t.fileList.length+e.name,uploadStatus:0,ready:!1};t.fileList.push(o),n(o.imageId)},l.onerror=function(e){return o(e)}}))},addFile:function(e){var t=e.imageId,n=e.url;this.fileList.push({file_id:t,url:n,uploadStatus:100,ready:!0})},updateProgress:function(e,t){var n=e.loaded,o=e.total,l=Math.round(n/o*100),r=this.fileList.findIndex((function(e){return e.file_id==t.file_id}));r>-1&&(this.fileList[r].uploadStatus=l)},clear:function(){var e=this;this.$confirm(this.$t("DeleteAllFiles"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){e.fileList=[],e.$emit("clearAll",e.fileList),e.$emit("handleChange",e.fileList)})).catch((function(){}))},deleteFile:function(e){var t=this.fileList[e];this.fileList.splice(e,1),this.$emit("delete",t),this.$emit("handleChange",this.fileList)},fileExceed:function(){this.$message({type:"warning",message:this.$t("CreativeCenterPopup20",{number:this.max})})},refreshUpload:function(e){var t=this.fileList[e].file_id;this.fileList[e].error=!1,this.fileList[e].uploadStatus=0,t?this.startUpload(t):this.getUploadSign(t)},imgError:function(e){console.log("图片加载失败",this.$refs[e.url]),this.$refs[e.url][0].src=e.url},viewBigMedia:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image",n=arguments.length>2?arguments[2]:void 0;this.bigMediaUrl=e.url,"video"===t?this.bigMediaShow=!0:this.$refs.viewImage.show(this.bigMediaUrl,n.target)},dragstart:function(e,t){e.dataTransfer.setData("text/plain",""),this.dragIndex=t},dragenter:function(e,t){if(e.preventDefault(),this.dragIndex!==t){var n=this.fileList[this.dragIndex];this.fileList.splice(this.dragIndex,1),this.fileList.splice(t,0,n),this.dragIndex=t,this.$emit("handleChange",this.fileList)}},dragover:function(e){e.preventDefault()},drop:function(e){e.preventDefault()}}},E=N,R=(n(3167),Object(h.a)(E,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"upload-image-item flex flex-col"},[t("div",{staticClass:"upload-content flex flex-wrap"},[t("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.isUploading,expression:"isUploading"},{name:"show",rawName:"v-show",value:"upload"===e.showUpload&&e.fileList.length<e.max,expression:"showUpload  === 'upload' && fileList.length < max"}],ref:"imageUpload",staticClass:"upload-image",attrs:{action:"/",disabled:e.fileList.length==e.max,drag:"",multiple:"","http-request":e.curstomUpload,limit:20,"on-exceed":e.fileExceed,accept:e.accept,"show-file-list":!1,"on-change":e.handleChange}},[t("i",{staticClass:"el-icon-plus"})]),e._v(" "),"pick"===e.showUpload&&e.fileList.length<e.max?t("div",{staticClass:"upload-image upload-image-btn",on:{click:function(t){return t.stopPropagation(),e.handleOpenPickArtWorkModal.apply(null,arguments)}}},[t("i",{staticClass:"el-icon-plus"}),e._v(" "),t("span",{staticClass:"upload-image-btn-text"},[e._v(e._s(e.$t("CreativeCenterPopup21")))])]):e._e(),e._v(" "),e._l(e.fileList,(function(img,i){return[t("div",{key:"upload_".concat(i),staticClass:"image-item flex",attrs:{draggable:!0},on:{dragenter:function(t){return e.dragenter(t,i)},dragover:function(t){return e.dragover(t)},dragstart:function(t){return e.dragstart(t,i)},drop:e.drop}},[t("div",{staticClass:"img-handle"},[t("i",{staticClass:"el-icon-rank"}),e._v(" "),t("span",[t("i",{staticClass:"el-icon-delete",on:{click:function(t){return e.deleteFile(i)}}}),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:img.error,expression:"img.error"}],staticClass:"el-icon-refresh-left refresg-icon",on:{click:function(t){return e.refreshUpload(i)}}})])]),e._v(" "),img.url&&e.isMP4Link(img.url)?t("img",{ref:img.url,refInFor:!0,attrs:{src:e.replaceImageType(img.url,"low")},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),t.target!==t.currentTarget?null:e.viewBigMedia(img,"image",t)},mousedown:function(e){e.preventDefault()},error:function(t){return e.imgError(img)}}}):img.url?t("video",{attrs:{src:img.url,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0},on:{click:function(t){return t.stopPropagation(),t.target!==t.currentTarget?null:e.viewBigMedia(img,"video",t)}}}):e._e(),e._v(" "),e.showImgLoading(img)?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.showImgLoading(img),expression:"showImgLoading(img)"}],staticClass:"loading"}):e._e()])]}))],2),e._v(" "),e.fileList.length>0?t("el-button",{staticClass:"clear text-right",attrs:{type:"text"},on:{click:e.clear}},[t("i",{staticClass:"iconfont icon-moveDelete"}),e._v("\n    "+e._s(e.$t("DeleteAll"))+"\n  ")]):e._e(),e._v(" "),e.bigMediaShow&&e.bigMediaUrl?t("div",{staticClass:"bigMedia",on:{click:function(t){e.bigMediaShow=!1}}},[t("video",{attrs:{src:e.bigMediaUrl,autoplay:"",loop:"",controls:!1,muted:""},domProps:{muted:!0},on:{click:function(e){e.stopPropagation()}}}),e._v(" "),e._m(0)]):e._e(),e._v(" "),t("view-image",{ref:"viewImage"})],1)}),[function(){var e=this._self._c;return e("div",{staticClass:"videoClear"},[e("i",{staticClass:"el-icon-close"})])}],!1,null,"1b627a83",null)),A=R.exports,B=(n(85),n(113),n(15)),U=(n(16),n(36),n(23),n(18),n(50),n(37),n(110),n(48),n(142),n(143),n(112),n(79),n(51)),F=n(13),z=n(81);function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var H={name:"PostForm",props:{from:{type:String,default:""}},data:function(){var e=this;return{formData:{title:"",description:"",tags:[],link:[""]},rules:{tags:[{required:!0,message:this.$t("CreativeCenterPopup35"),trigger:["change","blur"]}],link:[{validator:function(t,n,o){if(n.length>0){for(var i=0;i<n.length;i++){var l=n[i];if(l)try{null===new URL(l)&&o(new Error(e.$t("linkWarn",{name:e.$t("Link")})))}catch(t){o(new Error(e.$t("linkWarn",{name:e.$t("Link")})))}else;}o()}o()},trigger:["blur"]}]},selectList:[],intRmdTag:[],loading:!1,langOptions:["zh_cn","zh_tw","ja","ar","ko","de","fr","ru","es","th","en","pt"],setSelectedTags:[]}},mounted:function(){this.resetFormData(),this.getTagList()},computed:W(W({},Object(l.c)("user",["userInfo"])),{},{renderList:function(){var e=this.$i18n.locale?this.$i18n.locale:"en";return"zhCN"===e&&(e="zh_cn"),"zhTW"===e&&(e="zh_tw"),(this.selectList||[]).map((function(t){return t.label=t[e],t.label=t.label?t.label:t.title?t.title:t.id,t}))},whiteList:function(){var e;return null===(e=this.userInfo)||void 0===e?void 0:e.post_white}}),methods:{defSelectedTags:function(e){this.setSelectedTags=e},setIntRmdTag:function(e){var t,n=this;e&&(this.selectList=[].concat(Object(B.a)(this.intRmdTag),Object(B.a)(null===(t=this.formData)||void 0===t?void 0:t.tags.filter((function(e){return!n.intRmdTag.find((function(t){return t.title===e.title}))})))))},remoteMethod:function(e){var t=this;e&&Object(U.f)({prefix:e,except_num:20,source_type:3}).then((function(e){var n;1e4==e.status.code&&(t.selectList=[],null==e||null===(n=e.data)||void 0===n||n.items.forEach((function(e){t.selectList.push({title:e.title,id:e.title,type:(null==e?void 0:e.type)||""})})))}))},filterMethod:function(){var e=this;this.$nextTick((function(){try{e.$refs.tagSelect.$el.querySelector(".el-select__input").setAttribute("maxlength",30)}catch(e){}}))},resetFormData:function(){try{this.selectList=[],this.formData.title="",this.formData.description="",this.formData.tags=[],this.$refs.postForm.resetFields()}catch(e){}},changeTag:function(e){var t=e.length-1;"string"==typeof e[t]&&(e[t]=e[t].slice(0,30)),this.formData.tags=e},getTagList:function(){var e=this;this.loading=!0,Object(z.a)({show_area:"videoPost"===this.from?"ai_video":"post"}).then((function(t){var n=(null==t?void 0:t.data)||[];if(n.length&&n.forEach((function(t){return t.title=t[F.l[e.$i18n.locale]],t.label=t.title||t.id,t.searchLabel=(e.langOptions||[]).map((function(e){return t[e]?t[e]:""})).filter((function(e){return!!e})),t})),e.$set(e,"selectList",n),e.$set(e,"intRmdTag",n),e.setSelectedTags.length){var o=e.selectList.filter((function(t){return e.setSelectedTags.includes(t.id)}));e.formData.tags=o}e.loading=!1})).finally((function(){e.loading=!1}))},submitData:function(){var e=this,t=null;return this.$refs.postForm.validate((function(n){n?((t=JSON.parse(JSON.stringify(e.formData))).description=(t.description||"").replace(/\n/g,"<br>"),t.tags.forEach((function(e,i){e.title||(t.tags[i]={title:e});var n=Object.keys(e);2===n.length&&n.every((function(e){return["title","id"].includes(e)}))&&delete t.tags[i].id})),t.link=t.link.filter((function(e){return!!e.trim()}))):e.$message.error(e.$t("CreativeCenterPopup38"))})),t},removeLink:function(e){1===this.formData.link.length?this.formData.link=[""]:this.formData.link.splice(e,1)},addLink:function(){this.formData.link.length>=5||this.formData.link.push("")}}},G=(n(3168),n(3169),Object(h.a)(H,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-post-form"},[t("el-form",{ref:"postForm",staticClass:"custom-form",attrs:{model:e.formData,rules:e.rules,"label-position":"top"}},[t("el-form-item",{attrs:{label:e.$t("Title"),prop:"title"}},[t("el-input",{staticClass:"title-input",attrs:{"show-word-limit":"",maxlength:"80",placeholder:e.$t("postFormTitleTips")},model:{value:e.formData.title,callback:function(t){e.$set(e.formData,"title",t)},expression:"formData.title"}})],1),e._v(" "),t("el-form-item",{attrs:{label:e.$t("Desc"),prop:"description"}},[t("el-input",{staticClass:"post-form-textarea",attrs:{type:"textarea",autosize:{minRows:4,maxRows:20},maxlength:"2500","show-word-limit":"",placeholder:e.$t("postFormDescTips")},model:{value:e.formData.description,callback:function(t){e.$set(e.formData,"description",t)},expression:"formData.description"}})],1),e._v(" "),e.whiteList?t("el-form-item",{attrs:{label:e.$t("Link"),prop:"link"}},e._l(e.formData.link,(function(n,o){return t("div",{key:"link".concat(o),staticClass:"links"},[[t("el-input",{staticClass:"title-input",attrs:{"show-word-limit":"",maxlength:"200",placeholder:e.$t("inputPls",{name:e.$t("Link")})},model:{value:e.formData.link[o],callback:function(t){e.$set(e.formData.link,o,t)},expression:"formData.link[index]"}}),e._v(" "),e.formData.link.length>1?t("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){return e.removeLink(o)}}}):e._e(),e._v(" "),e.formData.link.length<5?t("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return e.addLink()}}}):e._e()]],2)})),0):e._e(),e._v(" "),t("el-form-item",{attrs:{label:e.$t("TagsAssociation"),prop:"tags"}},[t("el-select",{ref:"tagSelect",staticClass:"show-tag",staticStyle:{width:"100%"},attrs:{"value-key":"title",placeholder:e.$t("TagsAssociationTips"),multiple:"","multiple-limit":5,"popper-class":"show-tag-select post-show-tag-select",clearable:"",filterable:"","allow-create":"","default-first-option":"",remote:"","remote-method":e.remoteMethod},on:{"visible-change":e.setIntRmdTag,change:e.changeTag},nativeOn:{input:function(t){return e.filterMethod.apply(null,arguments)}},model:{value:e.formData.tags,callback:function(t){e.$set(e.formData,"tags",t)},expression:"formData.tags"}},e._l(e.selectList,(function(n,i){return t("el-option",{key:"tag_".concat(n.id+i),attrs:{label:n.title,value:n}},[e._v("\n          "+e._s(n.title?n.title:n)+"\n          "),t("span",{directives:[{name:"show",rawName:"v-show",value:[1,"1"].includes(null==n?void 0:n.type),expression:"[1,'1'].includes(v?.type)"}],staticClass:"label-flag"},[e._v(e._s(e.$t("official")))])])})),1)],1)],1)],1)}),[],!1,null,null,null)),J=G.exports,K=n(213),X=n(235),Q={name:"handleTextEdit",inject:["top"],components:{PostForm:J,UploadImageItem:A,pickWorkModal:K.a},data:function(){return{selectList:[],maxNum:20,isPosting:!1}},computed:{showUpload:function(){return this.top.type}},methods:{updateImageFile:function(e){var t=this;this.$nextTick((function(){t.$refs.uploadImageItem.curstomUpload({file:e})}))},handleSelectArtWork:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.updateList(e)},handleStep:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.$emit("changeStep",e)},handleCancel:function(){var e=this;this.isPosting||this.$confirm(this.$t("handleTextEditTips"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){e.$emit("changeStep",1)})).catch((function(e){console.log("err",e)}))},imagDelete:function(){},onClearAll:function(){this.selectList=[]},imgUpChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];console.log(e,"视图里的list")},handleOpenPickWorkModal:function(){this.$refs.pickWorkModal.openModal(this.selectList)},updateList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.selectList=e||[]},handleLogEvent:function(e){try{this.$logEvent("log_actions",{operation:"post_picture",behavior_info:"choose_picture"}),this.$logEvent("log_actions",{operation:"post_picture",behavior_info:"choose_tag",behavior_info_sub:null==e?void 0:e.tags[0]}),this.$logEvent("log_actions",{operation:"post_picture",behavior_info:"release_picture"})}catch(e){}},handleConfirm:function(){var e=this,t=this.groupParams();t&&!this.isPosting&&(this.handleLogEvent(t),this.isPosting=!0,Object(X.g)(t).then((function(t){if(1e4===t.status.code)e.$message.success(e.$t("CreativeCenterPopup30")),e.resetData(),e.$emit("changeStep",1);else{if([40017,40018].includes(t.status.code))return void e.$message.error(e.$t("CreativeCenterPopup37"));e.$message.error(t.status.msg)}})).finally((function(){e.isPosting=!1})))},resetData:function(){var e;this.selectList=[],this.isPosting=!1,null==this||null===(e=this.$refs)||void 0===e||null===(e=e.postForm)||void 0===e||e.resetFormData()},groupParams:function(){var e,t={};if(!this.selectList.length)return this.$message.warning(this.$t("CreativeCenterPopup23")),!1;var n=this.$refs.postForm.submitData();return!!n&&(t.artwork_ids=(this.selectList||[]).filter((function(e){return!["",void 0,null].includes(e.id)})).map((function(e){return e.id})),t.save_personal=(this.selectList||[]).filter((function(e){return!["",void 0,null].includes(e.taskId)})).map((function(e){return{task_id:e.taskId,index:e.index}})),t.upload_images=(this.selectList||[]).filter((function(e){return["",void 0,null].includes(e.taskId)&&["",void 0,null].includes(e.id)})).map((function(e){return{width:e.width,height:e.height,uri:e.url}})),t.tags=n.tags||[],t.intro=n.description||"",t.title=n.title||"",t.source=null==this||null===(e=this.top)||void 0===e?void 0:e.source,t.link=n.link||[],t)}}},Z=Q,Y=(n(3170),Object(h.a)(Z,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"handle-text-edit"},[t("div",{staticClass:"handle-text-edit-header"},[t("div",{staticClass:"header-item"},[t("span",{staticClass:"header-item-border"}),e._v(" "),t("span",{staticClass:"header-item-text"},[e._v(e._s(e.$t("GraphicSubmission")))])]),e._v(" "),t("div",{staticClass:"header-item"},[t("div",{staticClass:"header-item-btn",on:{click:function(t){return t.stopPropagation(),e.handleCancel.apply(null,arguments)}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("div",{staticClass:"header-item-btn header-item-btn-gradient",on:{click:function(t){return t.stopPropagation(),e.handleConfirm.apply(null,arguments)}}},[e._v("\n        "+e._s(e.$t("Publish"))+"\n      ")])])]),e._v(" "),t("div",{staticClass:"handle-text-edit-content"},[t("div",{staticClass:"top-tips"},[t("span",{staticClass:"tips-select-count"},[e._v(e._s(e.$t("imageAlbum"))+" ("+e._s(e.selectList.length)+"/"+e._s(e.maxNum)+")")]),e._v(" "),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("handleWorkTips1",{number:e.maxNum}),placement:"top"}},[t("span",{staticClass:"el-icon-info tips-select-info-tips"})]),e._v(" "),t("div",{staticClass:"tips-select-desc-text"},[e._v(e._s(e.$t("handleWorkTips2")))])],1),e._v(" "),t("div",{staticClass:"pick-result-box"},[t("UploadImageItem",{ref:"uploadImageItem",attrs:{max:e.maxNum,"show-upload":e.showUpload},on:{delete:e.imagDelete,clearAll:e.onClearAll,handleChange:e.imgUpChange,openPickWorkModal:e.handleOpenPickWorkModal},model:{value:e.selectList,callback:function(t){e.selectList=t},expression:"selectList"}})],1),e._v(" "),t("post-form",{key:"textPostForm",ref:"postForm"})],1),e._v(" "),t("pick-work-modal",{ref:"pickWorkModal",attrs:{type:"contribute"},on:{confirm:e.handleSelectArtWork}})],1)}),[],!1,null,"58236450",null)),ee=Y.exports,te={name:"videoCoverEditModal",inject:["top"],data:function(){return{visible:!1,loading:!1,tabList:[{i18nKey:"CreativeCenterPopup31",icon:"GraphicSubmission",label:"截取封面",code:"captureCover"},{i18nKey:"CreativeCenterPopup32",icon:"VideoSubmission",label:"上传封面",code:"uploadCover"}],activeTab:"captureCover",uploading:!1,imageUrl:"",rawCoverUrl:"",accept:".jpeg,.png,.webp,.jpg"}},methods:{resetData:function(){this.imageUrl=""},openModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e&&(this.rawCoverUrl=e),this.visible=!0},handleRawCoverImageLoad:function(e){},reUpload:function(){this.$refs.imgUpload.$refs["upload-inner"].handleClick()},handleClose:function(){this.visible=!1},handleConfirm:function(){var e="";if("captureCover"===this.activeTab&&(e=this.rawCoverUrl),"uploadCover"===this.activeTab){if(!this.imageUrl)return void this.$message.warning("请先上传图片");e=this.imageUrl}this.$emit("updateCover",e),this.handleClose()},handleTabClick:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"uploadCover"===(null==e?void 0:e.code)&&this.$logEvent("log_actions",{operation:"post_video",behavior_info:"choose_video_cover"}),this.activeTab=e.code||""},handleUploadImage:function(){},handleImageLoad:function(e){},handleBeforeUploadEmpty:function(){},handleBeforeUpload:function(e){var t=this;return Object(P.a)(regeneratorRuntime.mark((function n(){var o,l,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.top.UPLOAD,l=["image/jpeg","image/png","image/jpg","image/webp"],!t.isLoading){n.next=4;break}return n.abrupt("return");case 4:if(l.includes(e.type)){n.next=7;break}return t.$message.error(t.$t("AllowImageFiles")),n.abrupt("return",!1);case 7:if(!(r=e)||r.size){n.next=10;break}return n.abrupt("return",!1);case 10:if(!(r.size/1024/1024>5)){n.next=21;break}return n.prev=11,n.next=14,Object(j.a)(r,5242880);case 14:r=n.sent,n.next=21;break;case 17:return n.prev=17,n.t0=n.catch(11),console.error("Compression failed:",n.t0),n.abrupt("return",!1);case 21:return t.imageUrl="",t.uploading=!0,o.startUpload(r).then((function(e){t.uploading=!1,t.imageUrl=e})).catch((function(e){t.uploading=!1,t.$message.error(t.$t("uploadError"))})),n.abrupt("return",!1);case 25:case"end":return n.stop()}}),n,null,[[11,17]])})))()}}},ie=te,ne=(n(3171),Object(h.a)(ie,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,"custom-class":"c-video-cover-edit-modal","modal-append-to-body":!0,"append-to-body":!0,"close-on-click-modal":!1,"destroy-on-close":"",width:"800px",title:e.$t("PleaseSetCover")},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"video-cover-edit-modal-header"},e._l(e.tabList,(function(n){return t("div",{key:n.code,staticClass:"tab-item",class:[e.activeTab===n.code?"tab-item-active":""],on:{click:function(t){return t.stopPropagation(),e.handleTabClick(n)}}},[e._v("\n      "+e._s(e.$t(n.i18nKey))+"\n    ")])})),0),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"captureCover"===e.activeTab,expression:"activeTab === 'captureCover'"}],staticClass:"video-cover-edit-content"},[t("div",{staticClass:"result-show"},[e.rawCoverUrl?t("img",{staticClass:"cover-img",attrs:{src:e.rawCoverUrl,alt:""},on:{load:function(t){return e.handleRawCoverImageLoad(t)}}}):e._e()])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"uploadCover"===e.activeTab,expression:"activeTab === 'uploadCover'"}],staticClass:"video-cover-edit-content"},[t("el-upload",{directives:[{name:"show",rawName:"v-show",value:!e.imageUrl,expression:"!imageUrl"},{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],ref:"imgUpload",staticClass:"image-upload",attrs:{action:"#",drag:"","before-upload":e.handleBeforeUpload,disabled:e.uploading,accept:e.accept,"http-request":e.handleBeforeUploadEmpty,"show-file-list":!1}},[t("i",{staticClass:"iconfont icon-icon_Upload image-upload-icon"}),e._v(" "),t("div",{staticClass:"el-upload__text"},[t("div",{staticClass:"el-upload__text_1"},[e._v(e._s(e.$t("CreativeCenterPopup36")))]),e._v(" "),t("div",{staticClass:"el-upload__btn-box"},[t("div",{staticClass:"upload-box-btn upload-box-btn-gradient",on:{click:e.handleUploadImage}},[t("div",{staticClass:"upload-box-btn-inner"},[e._v(e._s(e.$t("UploadImg")))])])])])]),e._v(" "),e.imageUrl?t("div",{staticClass:"result-show"},[t("img",{staticClass:"cover-img",attrs:{src:e.imageUrl,alt:""},on:{load:function(t){return e.handleImageLoad(t)}}})]):e._e(),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.imageUrl,expression:"imageUrl"}],staticClass:"re-upload",on:{click:function(t){return t.stopPropagation(),e.reUpload()}}},[t("span",{staticClass:"el-icon-refresh re-upload-icon"}),e._v(" "),t("span",{staticClass:"re-upload-text"},[e._v(e._s(e.$t("CreativeCenterPopup33")))])])],1),e._v(" "),t("div",{staticClass:"bottom-btn-box"},[t("div",{staticClass:"bottom-btn-box-btn",on:{click:function(t){return t.stopPropagation(),e.handleClose()}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("div",{staticClass:"bottom-btn-box-btn bottom-btn-box-gradient",on:{click:function(t){return t.stopPropagation(),e.handleConfirm()}}},[e._v(e._s(e.$t("Confirm")))])])])}),[],!1,null,null,null).exports),ae=n(3172),oe=n(53),se=n(282),le={name:"handleVideoEdit",inject:["top"],components:{PostForm:J,UploadImageItem:A,pickWorkModal:K.a,videoCoverEditModal:ne},mixins:[ae.a,se.a],data:function(){return{selectList:[],maxNum:20,formData:{cover:"",video:"",cover_height:0,cover_width:0,duration:0,url:""},url:"",rawCoverUrl:"",base64Cover:null,rawCoverUploading:!1}},watch:{},computed:{showUpload:function(){return this.top.type}},mounted:function(){},methods:{updateVideoFile:function(e){this.beforeUpload(e),this.generateThumbnail(e)},generateThumbnail:function(e){var t=this,n=URL.createObjectURL(e);this.getBestPoster(n,30).then((function(e){t.base64Cover=null==e?void 0:e.posterUrl,t.formData.duration=Math.floor((null==e?void 0:e.duration)||0),t.rawCoverUrl=null==e?void 0:e.posterUrl,t.formData.cover=null==e?void 0:e.posterUrl})).catch((function(e){console.log(e)})).finally((function(){URL.revokeObjectURL(n)}))},uploadMaskImage:function(){var e=this,t=this.top.UPLOAD,n=Object(oe.a)(this.base64Cover);return this.rawCoverUploading=!0,t.startUpload(n,{name:"videoPost".concat(Date.now(),".png"),type:"png"}).then((function(t){e.rawCoverUrl=t,e.formData.cover=t})).finally((function(){e.rawCoverUploading=!1}))},handleImageLoad:function(e){this.formData.cover_width=e.target.naturalWidth,this.formData.cover_height=e.target.naturalHeight},handleUpdateCover:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.formData.cover!==e&&(this.formData.cover=e)},openEditVideoCoverModal:function(){this.$refs.videoCoverEditModal.openModal(this.rawCoverUrl)},handleBeforeUpload:function(e){if(-1===["video/mp4","video/ogg","video/flv","video/avi","video/wmv","video/rmvb","video/quicktime"].indexOf(e.type))return this.$message.warning(this.$t("OnlySupportVideo"));if(!(e.size>1073741824))return this.generateThumbnail(e),this.beforeUpload(e),!1;this.$message.warning(this.$t("CreativeCenterPopup12",{number:1}))},handleUploadClick:function(){this.$refs.UploadVideo.$refs["upload-inner"].handleClick()},handleSelectArtWork:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.updateList(e)},handleStep:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.$emit("changeStep",e)},cancelUploadVideo:function(){this.clear()},handleCancel:function(){var e=this;this.$confirm(this.$t("handleTextEditTips"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){e.$emit("changeStep",1)})).catch((function(e){console.log("err",e)}))},imagDelete:function(){},onClearAll:function(){this.selectList=[]},imgUpChange:function(){},handleOpenPickWorkModal:function(){this.$refs.pickWorkModal.openModal(this.selectList)},updateList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.selectList=e||[]},remotePost:function(e){var t;this.formData=e,this.base64Cover=e.cover,"img_to_video"==(null==this||null===(t=this.top)||void 0===t?void 0:t.source)&&this.$refs.postForm.defSelectedTags(["ai video"])},handleLogEvent:function(e){try{this.$logEvent("log_actions",{operation:"post_video",behavior_info:"click_post_video"}),this.$logEvent("log_actions",{operation:"post_video",behavior_info:"choose_tag",behavior_info_sub:null==e?void 0:e.tags[0]}),this.$logEvent("log_actions",{operation:"post_video",behavior_info:"release_video"})}catch(e){}},checkCoverUrl:function(){var e=this;return Object(P.a)(regeneratorRuntime.mark((function t(){var pattern;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(pattern=/^(http|https):\/\//,""===e.formData.cover||pattern.test(e.formData.cover)){t.next=5;break}return t.abrupt("return",e.uploadMaskImage());case 5:return t.abrupt("return",e.formData.cover);case 6:case"end":return t.stop()}}),t)})))()},handleConfirm:function(){var e=this;return Object(P.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isPosting){t.next=2;break}return t.abrupt("return");case 2:return e.isPosting=!0,t.next=5,e.groupParams();case 5:if(n=t.sent){t.next=9;break}return e.isPosting=!1,t.abrupt("return");case 9:e.handleLogEvent(n),Object(X.f)(n).then((function(t){if(1e4===t.status.code)e.$message.success(e.$t("CreativeCenterPopup30")),e.resetData(),e.$emit("changeStep",1);else{if([40017,40018].includes(t.status.code))return void e.$message.error(e.$t("CreativeCenterPopup37"));e.$message.error(t.status.msg)}})).finally((function(){e.isPosting=!1}));case 11:case"end":return t.stop()}}),t)})))()},resetData:function(){var e;this.selectList=[],this.formData.cover="",this.formData.url="",this.formData.cover_width=0,this.formData.cover_height=0,this.isPosting=!1,null==this||null===(e=this.$refs)||void 0===e||null===(e=e.postForm)||void 0===e||e.resetFormData(),this.base64Cover=null,this.rawCoverUploading=!1},groupParams:function(){var e=this;return Object(P.a)(regeneratorRuntime.mark((function t(){var n,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o={},e.formData.cover){t.next=4;break}return e.$message.warning(e.$t("CreativeCenterPopup39")),t.abrupt("return",!1);case 4:if(e.formData.url){t.next=7;break}return e.$message.warning(e.$t("CreativeCenterPopup39")),t.abrupt("return",!1);case 7:if(l=e.$refs.postForm.submitData()){t.next=10;break}return t.abrupt("return",!1);case 10:return t.next=12,e.checkCoverUrl();case 12:return t.sent,o.look_book_tpl_info={id:e.formData.templateId||"",url:e.formData.originalUrl||""},o.tags=l.tags||[],o.intro=l.description||"",o.video_url=e.formData.url||"",o.cover_url=e.formData.cover||"",o.duration=e.formData.duration||0,o.title=l.title||"",o.cover_width=e.formData.cover_width,o.cover_height=e.formData.cover_height,o.source=null==e||null===(n=e.top)||void 0===n?void 0:n.source,o.link=l.link||[],t.abrupt("return",o);case 25:case"end":return t.stop()}}),t)})))()}}},re=le,ce=(n(3173),Object(h.a)(re,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"handle-video-edit"},[t("div",{staticClass:"handle-video-edit-header"},[t("div",{staticClass:"header-item"},[t("span",{staticClass:"header-item-border"}),e._v(" "),t("span",{staticClass:"header-item-text"},[e._v(e._s(e.$t("VideoSubmission")))])]),e._v(" "),t("div",{staticClass:"header-item"},[t("div",{staticClass:"header-item-btn",on:{click:function(t){return t.stopPropagation(),e.handleCancel.apply(null,arguments)}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("div",{staticClass:"header-item-btn header-item-btn-gradient",on:{click:function(t){return t.stopPropagation(),e.handleConfirm.apply(null,arguments)}}},[e._v("\n        "+e._s(e.$t("Publish"))+"\n      ")])])]),e._v(" "),t("div",{staticClass:"handle-text-edit-content"},[t("div",{staticClass:"handle-text-edit-content-left"},[t("div",{staticClass:"content-left-title"},[e._v(e._s(e.$t("CreativeCenterPopup24")))]),e._v(" "),t("div",{staticClass:"content-main"},[t("div",{staticClass:"content-main-cover-box"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.rawCoverUploading,expression:"rawCoverUploading"}],staticClass:"cover-image-box"},[e.formData.cover?t("img",{staticClass:"cover-image",attrs:{src:e.formData.cover,alt:"封面"},on:{load:function(t){return e.handleImageLoad(t)}}}):e._e()]),e._v(" "),t("div",{staticClass:"cover-image-title"},[e._v(e._s(e.$t("CreativeCenterPopup25")))])]),e._v(" "),t("div",{staticClass:"content-main-text-box"},[t("div",{staticClass:"main-title"},[e._v(e._s(e.$t("CreativeCenterPopup26")))]),e._v(" "),t("div",{staticClass:"sub-title"},[e._v(e._s(e.$t("CreativeCenterPopup27")))])]),e._v(" "),t("div",{staticClass:"content-main-btn-box"},[t("div",{staticClass:"content-main-btn",on:{click:function(t){return t.stopPropagation(),e.openEditVideoCoverModal()}}},[t("span",{staticClass:"content-main-btn-text"},[e._v(e._s(e.$t("CreativeCenterPopup28")))])])])]),e._v(" "),t("post-form",{key:"videoPostForm",ref:"postForm",attrs:{from:"videoPost"}})],1),e._v(" "),t("div",{staticClass:"handle-text-edit-content-right"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:["pending"].includes(e.uploadingStatus),expression:"['pending'].includes(uploadingStatus)"}],staticClass:"video-preview-wrap"},[t("div",{staticClass:"progress-bar"}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.formData.url&&!["pending"].includes(e.uploadingStatus),expression:"!formData.url && !['pending'].includes(uploadingStatus)"}],staticClass:"empty-tips"},[e._m(0),e._v(" "),t("div",[e._v(e._s(e.$t("uploadError")))])]),e._v(" "),e.formData.url?t("video",{ref:"videoPlayer",staticClass:"video-preview-wrap-video",attrs:{src:e.formData.url,controlslist:"nofullscreen nodownload noremoteplayback noplaybackrate",controls:"",disablepictureinpicture:""}}):e._e()]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:["pending"].includes(e.uploadingStatus),expression:"['pending'].includes(uploadingStatus)"}],staticClass:"cancel-btn",on:{click:function(t){return t.stopPropagation(),e.cancelUploadVideo.apply(null,arguments)}}},[e._v("\n        "+e._s(e.$t("CreativeCenterPopup29"))+"\n      ")]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!["pending"].includes(e.uploadingStatus),expression:"!['pending'].includes(uploadingStatus)"}],staticClass:"refresh-btn",on:{click:function(t){return t.stopPropagation(),e.handleUploadClick.apply(null,arguments)}}},[t("span",{staticClass:"el-icon-refresh re-upload-icon"}),e._v(" "),t("span",{staticClass:"re-upload-text"},[e._v(e._s(e.$t("CreativeCenterPopup33")))])])])]),e._v(" "),t("el-upload",{ref:"UploadVideo",staticClass:"image-upload",staticStyle:{display:"none"},attrs:{action:"#",drag:"","before-upload":e.handleBeforeUpload,"show-file-list":!1}},[t("i",{staticClass:"iconfont icon-icon_Upload image-upload-icon"}),e._v(" "),t("div",{staticClass:"el-upload__text"},[t("div",{staticClass:"el-upload__text_1"},[e._v(e._s(e.$t("CreativeCenterPopup22")))]),e._v(" "),t("div",{staticClass:"el-upload__btn-box"},[t("div",{staticClass:"upload-box-btn"},[t("span",{staticClass:"el-icon-refresh re-upload-icon"}),e._v(" "),t("span",{staticClass:"re-upload-text"},[e._v(e._s(e.$t("CreativeCenterPopup33")))])])])])]),e._v(" "),t("video-cover-edit-modal",{ref:"videoCoverEditModal",on:{updateCover:e.handleUpdateCover}})],1)}),[function(){var e=this._self._c;return e("div",[e("span",{staticClass:"el-icon-warning"})])}],!1,null,"0fbbae2a",null)),de=ce.exports,ue=n(349),he=n(35),pe=n.n(he),me=n(671),ve={name:"handleArticleEdit",inject:["top"],components:{MyEditor:ue.a},data:function(){return{isLoading:!1,isUploading:!1,getTagLoading:!1,selectedImage:{},accept:".jpg,.jpeg,.png,.svg,.webp,.bmp,.tif",formData:{title:"",tags:[],content:""},tagList:[],intRmdTag:[],rules:{title:[{required:!0,message:this.$t("postFormTitleTips")}],tags:[{required:!0,message:this.$t("CreativeCenterPopup35"),trigger:["change","blur"]}]},toolbarConfig:{toolbarKeys:["header1","header2","header3","bold","underline","italic","through","color","insertLink","uploadImage","bulletedList","numberedList","undo","redo"]},editId:""}},mounted:function(){this.getTagList()},computed:{},methods:{getTagList:function(){var e=this;this.getTagLoading=!0,Object(z.a)({show_area:"post"}).then((function(t){var n=(null==t?void 0:t.data)||[];n.length&&n.forEach((function(t){return t.title=t[F.l[e.$i18n.locale]],t.label=t.title||t.id,t.searchLabel=(e.langOptions||[]).map((function(e){return t[e]?t[e]:""})).filter((function(e){return!!e})),t})),e.$set(e,"tagList",n),e.$set(e,"intRmdTag",n),e.getTagLoading=!1})).finally((function(){e.getTagLoading=!1}))},changeTag:function(e){var t=e.length-1;"string"==typeof e[t]&&(e[t]=e[t].slice(0,30)),this.formData.tags=e},setIntRmdTag:function(e){var t,n=this;e&&(this.tagList=[].concat(Object(B.a)(this.intRmdTag),Object(B.a)(null===(t=this.formData)||void 0===t?void 0:t.tags.filter((function(e){return!n.intRmdTag.find((function(t){return t.title===e.title}))})))))},remoteMethod:function(e){var t=this;e&&Object(U.f)({prefix:e,except_num:20,source_type:3}).then((function(e){var n;1e4==e.status.code&&(t.tagList=[],null==e||null===(n=e.data)||void 0===n||n.items.forEach((function(e){t.tagList.push({title:e.title,id:e.title,type:(null==e?void 0:e.type)||""})})))}))},filterMethod:function(){var e=this;this.$nextTick((function(){try{e.$refs.tagSelect.$el.querySelector(".el-select__input").setAttribute("maxlength",30)}catch(e){}}))},updateList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.selectedImage=(null==e?void 0:e[0])||""},updateImageFile:function(e){var t=this;this.$nextTick((function(){t.customUpload({file:e})}))},customUpload:function(e){var t=this;return Object(P.a)(regeneratorRuntime.mark((function n(){var o,l,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.isUploading=!0,!((o=e.file).size/1024/1024>2)){n.next=14;break}return n.prev=3,n.next=6,Object(j.a)(o,2097152);case 6:o=n.sent,n.next=14;break;case 9:return n.prev=9,n.t0=n.catch(3),console.error("Compression failed:",n.t0),t.isUploading=!1,n.abrupt("return");case 14:return n.next=16,t.checkImageSize(o);case 16:l=n.sent,(r=new M.a({type:2})).startUpload(o,{category:50,size:o.size}).then((function(e){var n={url:e,uploadStatus:100,ready:!0,file_id:r.fileId,width:l.width,height:l.height};t.selectedImage=n})).finally((function(){t.isUploading=!1}));case 19:case"end":return n.stop()}}),n,null,[[3,9]])})))()},checkImageSize:function(e){return new Promise((function(t,n){var o=new FileReader;o.onload=function(e){var img=new Image;img.onload=function(){var e=img.naturalWidth,n=img.naturalHeight;t({width:e,height:n})},img.onerror=function(){n(!1)},img.src=e.target.result},o.readAsDataURL(e)}))},handleCancel:function(){var e=this;this.isLoading||this.$confirm(this.$t("handleTextEditTips"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){e.resetData(),e.$emit("changeStep",1)})).catch((function(e){console.log("err",e)}))},handleConfirm:function(){var e=this;this.$refs.postForm.validate((function(t){t&&e.postArticle()}))},postArticle:function(){var e,t=this,n=pe()(this.formData);n.tags.forEach((function(e,i){e.title||(n.tags[i]={title:e});var t=Object.keys(e);2===t.length&&t.every((function(e){return["title","id"].includes(e)}))&&delete n.tags[i].id}));var o=this.selectedImage,l=o.url,r=o.width,c=o.height,d=o.id;if(d&&(n.art_id=d),n.cover={width:r,height:c,uri:l},null!=n&&null!==(e=n.cover)&&void 0!==e&&e.uri){this.isLoading=!0;var h=X.b;this.editId&&(h=X.a,n.id=this.editId),h(n).then((function(){t.$message.success(t.$t("CreativeCenterPopup30")),t.resetData(),t.$emit("changeStep",1),t.isLoading=!1})).catch((function(e){t.$message.error(e.message||t.$t("PostFailed")),t.isLoading=!1}))}else this.$message.warning(this.$t("PleaseSetCover"))},resetData:function(){this.selectedImage={},this.formData={title:"",tags:[],content:""},this.editId=""},handleEdit:function(e){var t=this,n=e.id;this.editId=n,this.isLoading=!0,Object(me.a)({id:n}).then((function(e){var n=e.data,o=n.portfolio,l=(n.author,o.cover),r=o.name,c=o.tag,content=o.content;t.formData.title=r,t.formData.tags=c,t.selectedImage={url:null==l?void 0:l.url,width:null==l?void 0:l.width,height:null==l?void 0:l.height},t.formData.content=content})).finally((function(){t.isLoading=!1}))}}},ge=ve,fe=(n(3174),Object(h.a)(ge,(function(){var e,t=this,n=t._self._c;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"handle-article-edit"},[n("div",{staticClass:"handle-article-edit-header"},[n("div",{staticClass:"header-item"},[n("span",{staticClass:"header-item-border"}),t._v(" "),n("span",{staticClass:"header-item-text"},[t._v(t._s(t.$t("PublishArticle")))])]),t._v(" "),n("div",{staticClass:"header-item"},[n("div",{staticClass:"header-item-btn",on:{click:function(e){return e.stopPropagation(),t.handleCancel.apply(null,arguments)}}},[t._v("\n\t\t\t\t"+t._s(t.$t("Cancel"))+"\n\t\t\t")]),t._v(" "),n("div",{staticClass:"header-item-btn header-item-btn-gradient",on:{click:function(e){return e.stopPropagation(),t.handleConfirm.apply(null,arguments)}}},[t._v("\n\t\t\t\t"+t._s(t.$t("Publish"))+"\n\t\t\t")])])]),t._v(" "),n("div",{staticClass:"handle-article-edit-content"},[n("div",{staticClass:"cover-title"},[t._v(t._s(t.$t("CoverImg")))]),t._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isUploading,expression:"isUploading"}],staticClass:"image-box"},[null!==(e=t.selectedImage)&&void 0!==e&&e.url?[n("img",{staticClass:"selected-image",attrs:{src:t.selectedImage.url,alt:"selected image"}}),t._v(" "),n("el-upload",{ref:"imageUpload",staticClass:"upload-image",attrs:{action:"/","http-request":t.customUpload,accept:t.accept,"show-file-list":!1}},[n("div",{staticClass:"hover-box flex-center"},[t._v("\n\t\t\t\t\t\t"+t._s(t.$t("Replace"))+"\n\t\t\t\t\t")])])]:n("el-upload",{ref:"imageUpload",staticClass:"upload-image-box",attrs:{action:"/","http-request":t.customUpload,accept:t.accept,"show-file-list":!1}},[n("i",{staticClass:"el-icon-plus"}),t._v(" "),n("div",{staticClass:"desc"},[t._v(t._s(t.$t("ArticleImageScale")))])])],2),t._v(" "),n("el-form",{ref:"postForm",staticClass:"article-post-form",attrs:{model:t.formData,rules:t.rules,"label-position":"top"}},[n("el-form-item",{attrs:{label:t.$t("Title"),prop:"title"}},[n("el-input",{staticClass:"title-input",attrs:{"show-word-limit":"",maxlength:"80",placeholder:t.$t("postFormTitleTips")},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),t._v(" "),n("el-form-item",{attrs:{label:t.$t("TagsAssociation"),prop:"tags"}},[n("el-select",{ref:"tagSelect",staticClass:"show-tag",staticStyle:{width:"100%"},attrs:{"value-key":"title",placeholder:t.$t("TagsAssociationTips"),multiple:"","multiple-limit":5,"popper-class":"show-tag-select post-show-tag-select",clearable:"",filterable:"","allow-create":"","default-first-option":"",remote:"","remote-method":t.remoteMethod},on:{"visible-change":t.setIntRmdTag,change:t.changeTag},nativeOn:{input:function(e){return t.filterMethod.apply(null,arguments)}},model:{value:t.formData.tags,callback:function(e){t.$set(t.formData,"tags",e)},expression:"formData.tags"}},t._l(t.tagList,(function(e,i){return n("el-option",{key:"tag_".concat(e.id+i),attrs:{label:e.title,value:e}},[t._v("\n\t\t\t\t\t\t"+t._s(e.title?e.title:e)+"\n\t\t\t\t\t\t"),n("span",{directives:[{name:"show",rawName:"v-show",value:[1,"1"].includes(null==e?void 0:e.type),expression:"[1, '1'].includes(v?.type)"}],staticClass:"label-flag"},[t._v(t._s(t.$t("official")))])])})),1)],1)],1),t._v(" "),n("div",{staticClass:"content-title"},[t._v(t._s(t.$t("Content")))]),t._v(" "),n("MyEditor",{ref:"MyEditorRef",attrs:{height:"auto",uploadCategory:50,toolbarConfig:t.toolbarConfig,defaultProps:{mode:"simple"}},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1)])}),[],!1,null,"4deb70ee",null)),_e=fe.exports,be={name:"CreativeCenterPopup",components:{headBar:m,CreativeCenterMenu:C,handleText:x,handleVideo:O,handleArticle:L,UploadImageItem:A,handleTextEdit:ee,pickWorkModal:K.a,handleVideoEdit:de,handleArticleEdit:_e},provide:function(){return{top:this}},data:function(){return{visible:!1,menuIndex:"textToImage",activeTab:"text",tabList:[{i18nKey:"GraphicSubmission",icon:"GraphicSubmission",label:"图文投稿",code:"text"},{i18nKey:"VideoSubmission",icon:"VideoSubmission",label:"视频投稿",code:"video"},{i18nKey:"ArticleSubmission",icon:"ArticleSubmission",label:"文章投稿",code:"article"}],step:1,type:"pick",saveParams:null,UPLOAD:new M.a({type:2}),source:""}},mounted:function(){var e=this;this.$EventBus.$on("openCreativeCenterModal",(function(t){e.openModal(t)}))},beforeDestroy:function(){this.$EventBus.$off("openCreativeCenterModal"),this.saveParams=null},methods:{openModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetData(),this.initData(e),this.visible=!0},initData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.saveParams=t;var n=t.list,o=void 0===n?[]:n,l=t.type,r=void 0===l?"text":l,c=t.source,source=void 0===c?"":c;this.activeTab=r,this.source=source,"text"===r&&o.length&&(this.handleStep(2),"swift_ai"!=source&&"face_swap_gif"!=source||(this.type="upload"),this.$nextTick((function(){var t=(o||[]).map((function(e){return e.type="check",e}));e.$refs.handleTextEdit.updateList(t)}))),"video"===r&&(this.handleStep(2),this.$nextTick((function(){var t=null==o?void 0:o[0];e.$refs.handleVideoEdit.remotePost(t)}))),"article"===r&&null!=t&&t.id&&(this.handleStep(2),this.$nextTick((function(){e.$refs.handleArticleEdit.handleEdit(t)})))},changeType:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.type=e},openPickWorkModal:function(){this.$refs.pickWorkModal.openModal()},resetData:function(){this.menuIndex="textToImage",this.activeTab="text",this.step=1,this.type="pick",this.saveParams=null},handleClose:function(){this.visible=!1},handleTabClick:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.activeTab=e.code||""},handleStep:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.step=e},handleSelectArtWork:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.handleStep(2),this.$nextTick((function(){"text"===e.activeTab?e.$refs.handleTextEdit.updateList(t):e.$refs.handleArticleEdit.updateList(t)}))},jumpToVideoEdit:function(e){var t=this;this.$nextTick((function(){t.$refs.handleVideoEdit.updateVideoFile(e)}))},jumpToTextEdit:function(e){var t=this;this.$nextTick((function(){t.$refs.handleTextEdit.updateImageFile(e)}))},jumpToArticleEdit:function(e){var t=this;this.$nextTick((function(){t.$refs.handleArticleEdit.updateImageFile(e)}))}}},ye=be,we=(n(3175),Object(h.a)(ye,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"c-creative-center-popup",attrs:{visible:e.visible,fullscreen:"","destroy-on-close":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"creative-center-body"},[t("head-bar",{on:{closePopup:e.handleClose}}),e._v(" "),t("div",{staticClass:"main-content"},[t("creative-center-menu",{ref:"creativeCenterMenu",attrs:{"menu-index":e.menuIndex}}),e._v(" "),t("div",{staticClass:"creative-center-content-container"},[t("div",{staticClass:"creative-center-content"},[1===e.step?[t("div",{staticClass:"container-header"},e._l(e.tabList,(function(n){return t("div",{key:n.code,staticClass:"tab-item",class:[e.activeTab===n.code?"tab-item-active":""],on:{click:function(t){return t.stopPropagation(),e.handleTabClick(n)}}},[e._v("\n                "+e._s(e.$t(n.i18nKey))+"\n              ")])})),0),e._v(" "),t("div",{staticClass:"uploader-container"},["text"===e.activeTab?t("handle-text",{on:{changeStep:e.handleStep,openPickWorkModal:e.openPickWorkModal}}):e._e(),e._v(" "),"video"===e.activeTab?t("handle-video",{on:{changeStep:e.handleStep}}):e._e(),e._v(" "),"article"===e.activeTab?t("handle-article",{on:{changeStep:e.handleStep,openPickWorkModal:e.openPickWorkModal}}):e._e()],1)]:e._e(),e._v(" "),2===e.step?["text"===e.activeTab?t("handle-text-edit",{ref:"handleTextEdit",on:{changeStep:e.handleStep}}):e._e(),e._v(" "),"video"===e.activeTab?t("handle-video-edit",{ref:"handleVideoEdit",on:{changeStep:e.handleStep}}):e._e(),e._v(" "),"article"===e.activeTab?t("handle-article-edit",{ref:"handleArticleEdit",on:{changeStep:e.handleStep}}):e._e()]:e._e()],2)])],1)],1),e._v(" "),["text","article"].includes(e.activeTab)?t("pick-work-modal",{ref:"pickWorkModal",attrs:{type:"contribute",maxNum:"text"==e.activeTab?20:1},on:{confirm:e.handleSelectArtWork}}):e._e()],1)}),[],!1,null,"f46ff43c",null));t.default=we.exports},3340:function(e,t,n){"use strict";n.r(t);var o=n(2);n(9),n(7),n(32),n(11),n(12),n(8),n(4),n(6),n(29);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c={data:function(){return{list:[],Timeing:null,typeKey:"",collectDotReportInfo:{}}},components:{CollectPopover:n(56).a},methods:{openTime:function(){var e=this,t=-1;this.list.length>0&&!this.Timeing&&(this.Timeing=setInterval((function(){var n;(t++,null!==(n=e.list[t])&&void 0!==n&&n.isChangeShow||t++,e.list[t])?(e.$refs.msgItem[t].style.opacity=0,setTimeout((function(){(e.list[t].show=!1,e.list.length-1<=t)&&(clearInterval(e.Timeing),e.Timeing=null,e.list.every((function(e){return!1===e.show}))&&(e.list=[]))}),300)):e.list.length-1<=t&&(clearInterval(e.Timeing),e.Timeing=null,e.list.every((function(e){return!1===e.show}))&&(e.list=[]))}),3e3))},permItem:function(e){this.list[e].isChangeShow=!1,clearTimeout(this.list[e].closeTime),this.list[e].closeTime=null,delete this.list[e].closeTime},closeItem:function(e){var t,n,o=this;null!==(t=this.$refs.collectPopover[e])&&void 0!==t&&t.visible||null!==(n=this.$refs.collectPopover[e])&&void 0!==n&&n.createShow||(this.list[e].isChangeShow=!0,this.list[e].closeTime=setTimeout((function(){var t;null!==(t=o.list[e])&&void 0!==t&&t.isChangeShow&&(o.list[e].show=!1),o.list.every((function(e){return!1===e.show}))&&(o.list=[])}),3e3))},setBottom:function(){var e=this;this.$nextTick((function(){setTimeout((function(){e.$refs.msgItem.forEach((function(t,n){t.style.bottom="".concat(60*(e.$refs.msgItem.length-1-n)+20,"px"),t.style.opacity=1}))}),100)}))}},mounted:function(){var e=this;this.$EventBus.$on("setCollectMsgBox",(function(t,n,o){e.typeKey=n,e.list.find((function(e){return e.id===t.id}))||(e.collectDotReportInfo=r(r({},o),{},{action:"collection",obj_no:t.id,obj_type:1}),e.$set(t,"show",!0),e.$set(t,"isChangeShow",!0),e.list.push(t),e.setBottom(),e.Timeing||e.openTime())}))}},d=(n(3176),n(0)),component=Object(d.a)(c,(function(){var e=this,t=e._self._c;return t("div",e._l(e.list,(function(n,o){return t("div",{directives:[{name:"show",rawName:"v-show",value:n.show,expression:"item.show"}],key:o,ref:"msgItem",refInFor:!0,staticClass:"CollectMsgBox",on:{mouseover:function(t){return e.permItem(o)},mouseout:function(t){return e.closeItem(o)}}},[t("div",{staticClass:"left"},[t("i",{staticClass:"el-icon-success"}),e._v(" "),t("span",[e._v(e._s(e.$t("CollectedSuccess")))])]),e._v(" "),t("CollectPopover",{ref:"collectPopover",refInFor:!0,attrs:{triggerMode:"click",hideBtn:!0,type:e.typeKey,folder:n,dotReportInfo:e.collectDotReportInfo,from:"waterfall"},on:{closeMask:function(t){return e.closeItem(o)}}},[t("div",{staticClass:"right"},[t("span",[e._v(e._s(e.$t("atb")))]),e._v(" "),t("i",{staticClass:"el-icon-arrow-right"})])])],1)})),0)}),[],!1,null,"174cf4e0",null);t.default=component.exports},340:function(e,t,n){"use strict";n(16),n(10),n(14);var o=n(3),l=n(15),r=n(2),c=(n(20),n(9),n(7),n(70),n(19),n(28),n(89),n(8),n(11),n(12),n(4),n(441),n(23),n(49),n(125),n(18),n(76),n(37),n(6),n(215)),d=n(86),h=n(26),m=n(65),v=n(154),f=n(272),_=n(35),y=n.n(_),w=n(1),C=n(22),k=n(5),S=n(207),x=n(13),I=(n(36),n(24)),O={name:"textOverflowArea",props:{lineNum:{type:Number,default:4},showExport:{type:Boolean,default:!0}},data:function(){return{key:Object(I.uniqueId)("text-overflow-area"),packUpStatus:!1,showExpBtn:!1,lineNumTemp:0,bottom:"-22px",maxHeight:""}},watch:{packUpStatus:{handler:function(e){e?(this.lineNumTemp=999,this.maxHeight="none"):(this.lineNumTemp=this.lineNum,this.maxHeight="calc(".concat(this.lineNum," * var(--base-size-20))"))},immediate:!0}},mounted:function(){this.lineNumTemp=this.lineNum,this.getBtnHeight();new MutationObserver(this.handleShowExp).observe(this.$refs.textContent,{attributes:!0,characterData:!0,childList:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0})},methods:{getBtnHeight:function(){var e=this.$refs.optBtn.offsetHeight;this.bottom="-".concat(e,"px")},handleShowExp:function(){try{var e=this.$refs.textContent;e.scrollHeight>e.clientHeight&&(this.showExpBtn=!0,this.getBtnHeight())}catch(e){}}}},T=(n(2882),n(0)),$=Object(T.a)(O,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-overflow-area"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.packUpStatus,expression:"packUpStatus"},{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"exp",attrs:{type:"checkbox",id:e.key},domProps:{checked:Array.isArray(e.packUpStatus)?e._i(e.packUpStatus,null)>-1:e.packUpStatus},on:{change:function(t){var n=e.packUpStatus,o=t.target,l=!!o.checked;if(Array.isArray(n)){var r=e._i(n,null);o.checked?r<0&&(e.packUpStatus=n.concat([null])):r>-1&&(e.packUpStatus=n.slice(0,r).concat(n.slice(r+1)))}else e.packUpStatus=l}}}),e._v(" "),t("div",{ref:"textContent",staticClass:"text",style:{"--bottom":e.bottom,"-webkit-line-clamp":e.lineNumTemp,"max-height":e.maxHeight}},[t("label",{directives:[{name:"show",rawName:"v-show",value:e.showExport&&e.showExpBtn,expression:"showExport && showExpBtn"}],ref:"optBtn",staticClass:"btn",attrs:{for:e.key,"data-content":e.packUpStatus?e.$t("PackUp"):e.$t("Unfold")}}),e._v(" "),e._t("default")],2)])}),[],!1,null,"c1c28232",null).exports;function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M={CONTAIN:{name:"contain",icon:"el-icon-full-screen"},ORIGINAL:{name:"original",icon:"el-icon-c-scale-to-original"}},j=Object(v.a)()?"DOMMouseScroll":"mousewheel",D={components:{ViewImage:S.a,AiChatCreteConfirm:c.a,textOverflowArea:$},name:"EasyTaskImageViewer",props:{operateNumber:{type:Number,default:function(){return 1}},urlList:{type:Array,default:function(){return[]}},zIndex:{type:Number,default:2e3},onSwitch:{type:Function,default:function(){}},onClose:{type:Function,default:function(){}},initialIndex:{type:Number,default:0},appendToBody:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},showOperateBtn:{type:Boolean,default:function(){return!1}},message:{type:Object,default:function(){return{}}},msgId:{type:String,default:""},loraModels:{type:Object,default:function(){}},hoverBtnRenderList:{type:Array,default:function(){return[]}},nsfw:{type:Number,default:2},customForm:{type:Boolean,default:!1}},filters:{formatDateTime:function(e){var t=new Date(e),n=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),r=t.getHours().toString().padStart(2,"0"),c=t.getMinutes().toString().padStart(2,"0"),d=t.getSeconds().toString().padStart(2,"0");return Object(k.u)(t,new Date)?"".concat(r,":").concat(c,":").concat(d):"".concat(n,"/").concat(o,"/").concat(l," ").concat(r,":").concat(c,":").concat(d)}},data:function(){return{showMask:!1,index:this.initialIndex,isShow:!1,infinite:!0,loading:!1,mode:M.CONTAIN,transform:{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1},isI18nToggled:!1,intLoraModel:[],getMetaLoading:!1,alreadySave:!1}},computed:P(P(P(P({},Object(w.c)(["isSupportWebp"])),Object(w.c)("user",["accountSettingsData","isCompanyAccount","userInfo"])),Object(w.c)("creation",["studioStyle","lab_styles"])),{},{getModelList:function(){var e,t,n,o=(null===(e=this.message)||void 0===e?void 0:e.art_model)||{};o=P(P({},o),{},{type:"Checkpoint"});var r=((null===(t=this.message.meta)||void 0===t?void 0:t.lora_models)||[]).map((function(e){return P(P(P({},e),(null==e?void 0:e.art_model)||{}),{},{type:"LORA"})}));return o&&null!==(n=o)&&void 0!==n&&n.id?[o].concat(Object(l.a)(r)):r},isMyMsg:function(){var e,t;return(null===(e=this.message)||void 0===e||null===(e=e.messageInfo)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id)===this.userInfo.id||!(null!==(t=this.message)&&void 0!==t&&t.messageInfo)},isShowSaveTo:function(){var e,t=this.message.img_uris,n=void 0===t?[]:t;return!!n.length&&(!(null!==(e=n[this.operateNumber-1])&&void 0!==e&&e.is_saved_personal)&&this.isMyMsg&&!this.alreadySave)},renderBtn:function(){var e=this,map={post:{type:"post",label:"Post",tip:"PostTips"},animGen:{type:"animGen",label:"AnimGen",tip:"AnimTips"},extraUpscale:{type:"extraUpscale",label:"ai_tools_1",tip:"ExtraUpscale"},upscale:{type:"upscale",label:"OriginalityUpscale",tip:"WorkUpscale"},variations:{type:"variations",label:"Variations",tip:"WorkVariations"},removeBackground:{type:"removeBackground",label:"RemoveBackground"},chat:{type:"chat",label:"gpt_tab_chat",tip:"createChartacterToChat"},aiGenerateVideo:{type:"aiGenerateVideo",label:"ImageToVideo",tip:"ImageToVideoTip"}},t=[],n=["deleteSingleImg","save","post","animGen","chat"],o=null,l=null,r=null;if(this.hoverBtnRenderList.forEach((function(c){var d=P(P({},c),map[c.code]);"upscale"===c.code&&e.isStudioMode&&d.tip&&d.tip.replace("2048*2048","3072*3072"),!n.includes(c.code)&&t.push(d),"post"===c.code&&(o=d),"animGen"===c.code&&(l=d),"chat"===c.code&&(r=d)})),l&&t.unshift(l),o&&t.unshift(o),r&&t.push(r),t.push({type:"download",label:"Download",icon:"modelDownload",tip:"SG_DownloadHover"}),this.isVideoUrl(this.currentImg)){var c=["chat","aiGenerateVideo"];t=t.filter((function(e){return!c.includes(e.type)}))}return t},studioRenderList:function(){var e=this;return(this.lab_styles||[]).map((function(t){var n="labStyle_".concat(t.value.replace(/\s/g,""));return{label:e.$t(n)||t.value,id:t.value}}))},getStudioStyle:function(){var e,t=(null===(e=this.message.meta)||void 0===e||null===(e=e.lab_base)||void 0===e?void 0:e.style_selections)||[];return(this.studioRenderList||[]).filter((function(e){return t.includes(e.id)})).map((function(e){return e.label})).join("、")||""},isSdModel:function(){var e,t;return[5,"5","sdxl"].includes(null==this||null===(e=this.message)||void 0===e?void 0:e.channel)||[5,"5","sdxl"].includes(null==this||null===(t=this.message)||void 0===t?void 0:t.category)},isStudioMode:function(){var e,t;return["studio",7,"7",11].includes(null==this||null===(e=this.message)||void 0===e?void 0:e.channel)||["studio",7,"7",11].includes(null==this||null===(t=this.message)||void 0===t?void 0:t.category)},isStudioFlux:function(){var e,t,n=(null===x.B||void 0===x.B?void 0:x.B.sa)||[];return(null===(e=this.message)||void 0===e?void 0:e.art_model_no)===x.h||n.includes(null===(t=this.message)||void 0===t||null===(t=t.ckpts)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.base_model_name)},isSingle:function(){return this.urlList.length<=1},isFirst:function(){return 0===this.index},isLast:function(){return this.index===this.urlList.length-1},currentImg:function(){return this.getImageUrl(this.urlList[this.index].url)},currentImgInfo:function(){return this.urlList[this.index]},imgStyle:function(){var e=this.transform,t=e.scale,n=e.deg,o=e.offsetX,l=e.offsetY,r=e.enableTransition,style={transform:"scale(".concat(t,") rotate(").concat(n,"deg)"),transition:r?"transform .3s":"","margin-left":"".concat(o,"px"),"margin-top":"".concat(l,"px")};return this.mode===M.CONTAIN&&(style.maxWidth=style.maxHeight="100%"),style},viewerZIndex:function(){var e=f.a.nextZIndex();return this.zIndex>e?this.zIndex:e},setI18nPrompt:function(){var e=this.message.local_prompt,t=this.message.meta?this.message.meta.prompt:"";return this.isI18nToggled?e:t},convertTaskType:function(){var e={1:"Txt2Img",2:"Upscaling",3:"Variations",4:"taskTabUpscale",5:"RemoveBackground",6:"GetDescriptors",7:"TaskUploadImage",8:"conditionToImage",10:"Preview",11:"Expansion",13:"taskTabUpscale"};return e[this.message.type]?e[this.message.type]:""}}),watch:{accountSettingsData:{handler:function(e){this.isI18nToggled=!e.is_off_localization},deep:!0},index:{handler:function(e){this.reset(),this.onSwitch(e)}},currentImg:function(e){var t=this;this.$nextTick((function(e){t.$refs.img[0].complete||(t.loading=!0)}))}},methods:{handleGenerate:function(){this.hide(),this.$emit("copyGenerationData")},handleJumpDetail:function(e){["",null,void 0].includes(null==e?void 0:e.id)||window.open("/models/detail/".concat(null==e?void 0:e.id),"_blank")},init:function(){var e,t=this;if(this.msgId){this.getMetaLoading=!0;var n=this.loraModels&&0===Object.keys(this.loraModels).length,o=["",null,void 0].includes(null===(e=this.message)||void 0===e?void 0:e.art_model_name),l=![this.loraModels&&this.loraModels[this.msgId]];[n,o,l].some((function(e){return e}))?Object(C.h)({id:this.msgId,task_flow_version:"v2"}).then((function(e){var o,l,r;if(1e4===e.status.code){t.intLoraModel=(null===(o=e.data.meta)||void 0===o?void 0:o.lora_models)||[];var c={};c[t.msgId]=t.intLoraModel;var d=(null==e||null===(l=e.data)||void 0===l?void 0:l.art_model_name)||"";if(t.$emit("uploadMate",null==e?void 0:e.data),["",null,void 0].includes(null===(r=t.message)||void 0===r?void 0:r.art_model_name)&&(t.$set(t.message,"art_model_name",d),null!=e&&e.data)){var h={},m=null==e?void 0:e.data;h.meta=(null==m?void 0:m.meta)||{},h.art_model=(null==m?void 0:m.art_model)||{},t.$emit("updateModelName",d,null==e?void 0:e.data)}n&&t.$emit("setLoraModel",c)}})).finally((function(){t.getMetaLoading=!1})):this.getMetaLoading=!1,this.intLoraModel&&!this.intLoraModel.length&&(this.intLoraModel=this.loraModels[this.msgId]||[])}},handleConfirm:function(){this.showMask=!1,this.handleChat()},viewImage:function(e){this.$refs.viewImage.show(e,this.$refs.img[0],2)},isVideoUrl:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return[".mp4",".mkv",".webm",".avi",".mov",".flv",".wmv"].some((function(t){return(e||"").toLowerCase().endsWith(t)}))},openLora:function(e){window.open("/models/detail/"+e.art_model.id)},hide:function(){this.deviceSupportUninstall(),this.onClose()},deviceSupportInstall:function(){var e=this;this._keyDownHandler=function(t){switch(t.stopPropagation(),t.keyCode){case 27:e.hide();break;case 32:e.toggleMode();break;case 37:e.prev();break;case 38:e.handleActions("zoomIn");break;case 39:e.next();break;case 40:e.handleActions("zoomOut")}},this._mouseWheelHandler=Object(v.b)((function(t){var n,o=t.wheelDelta?t.wheelDelta:-t.detail;["el-image-viewer__canvas task-image-viewer__canvas","el-image-viewer__img task-image-viewer__img"].includes(null==t||null===(n=t.target)||void 0===n?void 0:n.className)&&(o>0?e.handleActions("zoomIn",{zoomRate:.015,enableTransition:!1}):e.handleActions("zoomOut",{zoomRate:.015,enableTransition:!1}))})),Object(m.e)(document,"keydown",this._keyDownHandler),Object(m.e)(document,j,this._mouseWheelHandler)},deviceSupportUninstall:function(){Object(m.d)(document,"keydown",this._keyDownHandler),Object(m.d)(document,j,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},handleImgLoad:function(e){this.loading=!1},handleImgError:function(e){this.loading=!1,e.target.alt="加载失败"},handleMouseDown:function(e){var t=this;if(!this.loading&&0===e.button){var n=this.transform,o=n.offsetX,l=n.offsetY,r=e.pageX,c=e.pageY;this._dragHandler=Object(v.b)((function(e){t.transform.offsetX=o+e.pageX-r,t.transform.offsetY=l+e.pageY-c})),Object(m.e)(document,"mousemove",this._dragHandler),Object(m.e)(document,"mouseup",(function(e){Object(m.d)(document,"mousemove",t._dragHandler)})),e.preventDefault()}},handleMaskClick:function(){this.maskClosable&&this.hide()},reset:function(){this.transform={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}},toggleMode:function(){if(!this.loading){var e=Object.keys(M),t=(Object.values(M).indexOf(this.mode)+1)%e.length;this.mode=M[e[t]],this.reset()}},prev:function(){if(!this.isFirst||this.infinite){var e=this.urlList.length;this.index=(this.index-1+e)%e}},next:function(){if(!this.isLast||this.infinite){var e=this.urlList.length;this.index=(this.index+1)%e}},handleActions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.loading){var n=P({zoomRate:.2,rotateDeg:90,enableTransition:!0},t),o=n.zoomRate,l=n.rotateDeg,r=n.enableTransition,c=this.transform;switch(e){case"zoomOut":c.scale>.2&&(c.scale=parseFloat((c.scale-o).toFixed(3)));break;case"zoomIn":c.scale=parseFloat((c.scale+o).toFixed(3));break;case"clocelise":c.deg+=l;break;case"anticlocelise":c.deg-=l}c.enableTransition=r}},handleOperateBtnClick:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,d,m,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:c=(null===(o=t.urlList)||void 0===o||null===(o=o[t.index||0])||void 0===o?void 0:o.url)||"",t.handleLogEvent(null==e?void 0:e.type),n.t0=e.type,n.next="chat"===n.t0?5:"post"===n.t0?11:"animGen"===n.t0?13:"download"===n.t0?15:"aiGenerateVideo"===n.t0?17:23;break;case 5:return n.next=7,Object(h.D)({channel:"task",source_id:null===(l=t.message)||void 0===l?void 0:l.id});case 7:return d=n.sent,m=d.data.character_id,(void 0===m?"":m)?t.handleChat():t.showMask=!0,n.abrupt("break",25);case 11:return t.handlePost(),n.abrupt("break",25);case 13:return t.handleAnimate(),n.abrupt("break",25);case 15:return Object(k.z)(null===(r=t.urlList)||void 0===r||null===(r=r[t.index||0])||void 0===r?void 0:r.url),n.abrupt("break",25);case 17:if(v={cover:c},c){n.next=20;break}return n.abrupt("return");case 20:return v=JSON.stringify(v),window.open(t.localePath("/ai-tools/ai-video-generator?info=".concat(v))),n.abrupt("break",25);case 23:return t.$emit("imageOperate",e.type,y()(t.urlList[t.index])),n.abrupt("break",25);case 25:t.$emit("onClickBtns",e);case 26:case"end":return n.stop()}}),n)})))()},handleLogEvent:function(e){var t="";switch(e){case"download":t="click_download";break;case"chat":t="click_chat";break;case"upscale":t="click_creative_superscore";break;case"variations":t="click_variant"}t&&this.$logEvent("log_actions",{operation:t,behavior_info:"on_create_flow_work_detail_page"})},getImageUrl:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:""},handleChat:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,o,l,r,c,d,m,v,f,_,y,w;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return v={height:null===(n=e.message)||void 0===n||null===(n=n.banner)||void 0===n?void 0:n.height,width:null===(o=e.message)||void 0===o||null===(o=o.banner)||void 0===o?void 0:o.width,id:null===(l=e.message)||void 0===l?void 0:l.id,url:e.currentImg||(null===(r=e.message)||void 0===r||null===(r=r.banner)||void 0===r?void 0:r.url),source_account_id:(null===(c=e.message)||void 0===c||null===(c=c.messageInfo)||void 0===c||null===(c=c.author)||void 0===c?void 0:c.id)||(null===(d=e.userInfo)||void 0===d?void 0:d.id),channel:"task"},t.next=3,Object(h.D)({channel:"task",source_id:v.id});case 3:if(f=t.sent,_=(null==f?void 0:f.data)||{},y=_.can,2!==(void 0===y?2:y)){t.next=8;break}return e.$message.warning(e.$t("chatFail")),t.abrupt("return");case 8:if(!e.isShowSaveTo||1===e.nsfw){t.next=12;break}return t.next=11,e.handleSave(v);case 11:return t.abrupt("return");case 12:localStorage.setItem("createParams",JSON.stringify(v)),w="/cyberPubPage/".concat(null===(m=e.message)||void 0===m?void 0:m.id,"?quickChat=true&source=work"),window.open(e.localePath(w),"_blank");case 15:case"end":return t.stop()}}),t)})))()},handleSave:function(){var e=arguments,t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,l,r,c,h,m,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=e.length>0&&void 0!==e[0]?e[0]:null,console.log("handleSave"),l=t.message,r=l.id,c=void 0===r?"":r,h=l.img_uris,m=(void 0===h?[]:h)[t.operateNumber-1].index,v=void 0===m?"":m,Object(d.a)({folder_no:"default",id:c,index:v}).then((function(){if(t.$emit("saveSuccess"),o){var e;localStorage.setItem("createParams",JSON.stringify(o));var n="/cyberPubPage/".concat(null===(e=t.message)||void 0===e?void 0:e.id,"?quickChat=true&source=work");window.open(t.localePath(n),"_blank")}})).catch((function(e){console.log("saveFail",e)}));case 5:case"end":return n.stop()}}),n)})))()},handlePost:function(){var e={taskId:this.message.id,url:this.currentImg,index:this.currentImgInfo.index};this.$logEvent("log_actions",{operation:"click_post_picture_button",behavior_info:"on_creative_flow_details",behavior_info_sub:e.url}),this.$EventBus.$emit("openCreativeCenterModal",{list:[e],type:"text",source:"task"}),this.hide()},handleAnimate:function(){this.$emit("handleAnimate"),this.hide()},handleCopyAll:function(){var content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";["",null,void 0].includes(content)||(Object(k.d)(content),this.$message.success(this.$t("CopySuccess")))}},mounted:function(){this.init(),this.isI18nToggled=!this.accountSettingsData.is_off_localization,this.deviceSupportInstall(),this.appendToBody&&document.body.appendChild(this.$el),this.$refs["el-image-viewer__wrapper"].focus()},destroyed:function(){this.appendToBody&&this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)}},N=D,E=(n(2883),n(2884),Object(T.a)(N,(function(){var e,t,n,o,l,r,c,d,h,m,v,f=this,_=f._self._c;return _("transition",{attrs:{name:"viewer-fade"}},[_("div",{ref:"el-image-viewer__wrapper",staticClass:"el-image-viewer__wrapper c-easy-task-image-viewer",style:{"z-index":f.viewerZIndex},attrs:{tabindex:"-1"}},[_("div",{staticClass:"el-image-viewer__mask",on:{click:function(e){return e.target!==e.currentTarget?null:f.handleMaskClick.apply(null,arguments)}}}),f._v(" "),f.showOperateBtn?f._e():_("span",{staticClass:"el-image-viewer__btn el-image-viewer__chat",on:{click:f.handleChat}},[_("i",{staticClass:"iconfont icon-a-home-top-personl1"})]),f._v(" "),f.showOperateBtn?f._e():_("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:f.hide}},[_("i",{staticClass:"el-icon-close"})]),f._v(" "),f.showOperateBtn?f._e():_("span",{staticClass:"el-image-viewer__btn el-image-viewer__download",on:{click:function(e){return f.handleOperateBtnClick({type:"download"})}}},[_("i",{staticClass:"iconfont icon-icon-Download"})]),f._v(" "),f.showOperateBtn?f._e():_("div",{staticClass:"el-image-viewer__btn el-image-viewer__actions"},[_("div",{staticClass:"el-image-viewer__actions__inner"},[_("i",{staticClass:"el-icon-zoom-out",on:{click:function(e){return f.handleActions("zoomOut")}}}),f._v(" "),_("i",{staticClass:"el-icon-zoom-in",on:{click:function(e){return f.handleActions("zoomIn")}}}),f._v(" "),_("i",{staticClass:"el-image-viewer__actions__divider"}),f._v(" "),_("i",{class:f.mode.icon,on:{click:f.toggleMode}}),f._v(" "),_("i",{staticClass:"el-image-viewer__actions__divider"}),f._v(" "),_("i",{staticClass:"el-icon-refresh-left",on:{click:function(e){return f.handleActions("anticlocelise")}}}),f._v(" "),_("i",{staticClass:"el-icon-refresh-right",on:{click:function(e){return f.handleActions("clocelise")}}})])]),f._v(" "),_("div",{staticClass:"el-image-viewer__canvas task-image-viewer__canvas"},[f.isSingle?f._e():[_("span",{staticClass:"el-image-viewer__btn el-image-viewer__prev",class:{"is-disabled":!f.infinite&&f.isFirst},on:{click:f.prev}},[_("i",{staticClass:"el-icon-arrow-left"})]),f._v(" "),_("span",{staticClass:"el-image-viewer__btn el-image-viewer__next",class:{"is-disabled":!f.infinite&&f.isLast},on:{click:f.next}},[_("i",{staticClass:"el-icon-arrow-right"})])],f._v(" "),f._l(f.urlList,(function(e,i){return[i!==f.index||f.isVideoUrl(f.currentImg)?i===f.index?_("video",{key:i,staticClass:"el-image-viewer__img task-image-viewer__img",style:f.imgStyle,attrs:{src:f.currentImg,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0},on:{play:f.handleImgLoad}}):f._e():_("img",{directives:[{name:"webp",rawName:"v-webp",value:f.$imgH,expression:"$imgH"}],key:i,ref:"img",refInFor:!0,staticClass:"el-image-viewer__img task-image-viewer__img",style:f.imgStyle,attrs:{src:f.currentImg,referrerpolicy:"no-referrer"},on:{load:f.handleImgLoad,mousedown:f.handleMouseDown,click:function(e){return f.viewImage(f.currentImg)}}})]})),f._v(" "),f.isVideoUrl(f.currentImg)?f._e():_("i",{staticClass:"iconfont icon-icon-enlarge",on:{click:function(e){return f.viewImage(f.currentImg)}}}),f._v(" "),f.isSingle?f._e():[_("div",{staticClass:"indicator-box"},f._l(f.urlList,(function(e,i){return _("span",{key:"indicator_".concat(i),staticClass:"indicator-box-item",class:[f.index===i&&"indicator-box-item-active"]})})),0)]],2),f._v(" "),f.showOperateBtn?_("div",{staticClass:"task-image-viewer__side-bar"},[_("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:f.hide}},[_("i",{staticClass:"el-icon-close"})]),f._v(" "),_("div",{staticClass:"task-image-viewer__side-bar-box"},[_("div",{staticClass:"btn-box",class:(null===(e=f.renderBtn)||void 0===e?void 0:e.length)%2?"odd":"even"},[f._l(f.renderBtn,(function(e){return[_("el-tooltip",{key:e.type,attrs:{"popper-class":"task-image-viewer-popover",effect:"light",placement:"bottom",disabled:!(null!=e&&e.tip),content:f.$t(null==e?void 0:e.tip)}},[_("div",{staticClass:"button",on:{click:function(t){return t.stopPropagation(),f.handleOperateBtnClick(e)}}},[_("span",{staticClass:"icon"},[_("i",{staticClass:"iconfont",class:"icon-".concat(e.icon)})]),f._v(" "),_("span",{staticClass:"label"},[f._v(" "+f._s(f.$t(e.label)))])])])]}))],2),f._v(" "),_("div",{staticClass:"task-image-viewer__generation-data"},[f._v("\n            "+f._s(f.$t("GenerationData"))+"\n          ")]),f._v(" "),f.customForm?f._e():_("div",{staticClass:"task-image-viewer__prompt-box",class:[f.currentImgInfo&&[0,"0"].includes(f.currentImgInfo.operateNumber)?"task-image-viewer__prompt-box-margin-top":""]},[_("div",{staticClass:"task-image-viewer__prompt-title"},[_("span",{staticClass:"prompt-title-text"},[f._v(f._s(f.$t("Prompt")))]),f._v(" "),_("span",{staticClass:"iconfont icon-codeCopy1 prompt-title-copy",on:{click:function(e){return e.stopPropagation(),f.handleCopyAll(f.setI18nPrompt)}}})]),f._v(" "),_("text-overflow-area",{staticClass:"prompt-text-overflow"},[f._v(f._s(f.setI18nPrompt))]),f._v(" "),null!==(t=f.message)&&void 0!==t&&null!==(t=t.meta)&&void 0!==t&&t.negative_prompt?[_("div",{staticClass:"task-image-viewer__prompt-title"},[_("span",{staticClass:"prompt-title-text"},[f._v(f._s(f.$t("NegativePrompts")))]),f._v(" "),_("span",{staticClass:"iconfont icon-codeCopy1 prompt-title-copy",on:{click:function(e){var t;return e.stopPropagation(),f.handleCopyAll(null===(t=f.message)||void 0===t||null===(t=t.meta)||void 0===t?void 0:t.negative_prompt)}}})]),f._v(" "),_("text-overflow-area",{staticClass:"prompt-text-overflow"},[f._v(f._s((null===(n=f.message)||void 0===n||null===(n=n.meta)||void 0===n?void 0:n.negative_prompt)||""))])]:f._e(),f._v(" "),_("div",{staticClass:"easy-tooltip-wraper-params-box"},[_("div",{staticClass:"easy-tooltip-params-item"},[_("div",{staticClass:"easy-tooltip-params-item-title"},[f._v(f._s(f.$t("newGenerate27")))]),f._v(" "),_("div",{staticClass:"easy-tooltip-params-item-content"},[f._v(f._s(f.$t(f.convertTaskType)))])]),f._v(" "),_("div",{staticClass:"easy-tooltip-params-item"},[_("div",{staticClass:"easy-tooltip-params-item-title"},[f._v(f._s(f.$t("newGenerate26")))]),f._v(" "),_("div",{staticClass:"easy-tooltip-params-item-content"},[f._v(f._s(f._f("formatDateTime")(f.message.create_at)))])]),f._v(" "),_("div",{staticClass:"easy-tooltip-params-item"},[_("div",{staticClass:"easy-tooltip-params-item-title"},[f._v(f._s(f.$t("imageDimensions")))]),f._v(" "),_("div",{staticClass:"easy-tooltip-params-item-content"},[f._v(f._s("".concat(null===(o=f.message)||void 0===o||null===(o=o.components[0])||void 0===o?void 0:o.width," x ").concat(null===(l=f.message)||void 0===l||null===(l=l.components[0])||void 0===l?void 0:l.height))+" px")])]),f._v(" "),_("div",{staticClass:"easy-tooltip-params-item"},[_("div",{staticClass:"easy-tooltip-params-item-title"},[f._v(f._s(f.$t("Seed")))]),f._v(" "),_("div",{staticClass:"easy-tooltip-params-item-content"},[f._v(f._s(null===(r=f.message)||void 0===r||null===(r=r.meta)||void 0===r?void 0:r.seed))])]),f._v(" "),_("div",{directives:[{name:"show",rawName:"v-show",value:!f.isStudioFlux,expression:"!isStudioFlux"}],staticClass:"easy-tooltip-params-item"},[_("div",{staticClass:"easy-tooltip-params-item-title"},[f._v(f._s(f.$t("Sampler")))]),f._v(" "),_("div",{staticClass:"easy-tooltip-params-item-content"},[f._v(f._s(null===(c=f.message)||void 0===c||null===(c=c.meta)||void 0===c?void 0:c.sampler_name))])]),f._v(" "),_("div",{directives:[{name:"show",rawName:"v-show",value:!f.isStudioFlux,expression:"!isStudioFlux"}],staticClass:"easy-tooltip-params-item"},[_("div",{staticClass:"easy-tooltip-params-item-title"},[f._v(f._s(f.$t("Steps")))]),f._v(" "),_("div",{staticClass:"easy-tooltip-params-item-content"},[f._v(f._s(null===(d=f.message)||void 0===d||null===(d=d.meta)||void 0===d?void 0:d.steps))])]),f._v(" "),_("div",{directives:[{name:"show",rawName:"v-show",value:!f.isStudioFlux,expression:"!isStudioFlux"}],staticClass:"easy-tooltip-params-item"},[_("div",{staticClass:"easy-tooltip-params-item-title"},[f._v(f._s(f.$t("CFGScale")))]),f._v(" "),_("div",{staticClass:"easy-tooltip-params-item-content"},[f._v(f._s(null===(h=f.message.meta)||void 0===h?void 0:h.cfg_scale))])]),f._v(" "),_("div",{directives:[{name:"show",rawName:"v-show",value:!f.isStudioFlux,expression:"!isStudioFlux"}],staticClass:"easy-tooltip-params-item"},[_("div",{staticClass:"easy-tooltip-params-item-title"},[f._v(f._s(f.$t("clipSkip")))]),f._v(" "),_("div",{staticClass:"easy-tooltip-params-item-content"},[f._v(f._s((null===(m=f.message)||void 0===m||null===(m=m.meta)||void 0===m?void 0:m.clip_skip)||""))])])])],2),f._v(" "),f.customForm?f._e():[null!==(v=f.getModelList)&&void 0!==v&&v.length?_("div",{directives:[{name:"show",rawName:"v-show",value:!f.loading,expression:"!loading"}],staticClass:"easy-tooltip-wraper-model-box"},f._l(f.getModelList,(function(e,t){var n;return _("div",{key:"model_i_".concat(t),staticClass:"easy-tooltip-wraper-model-box-item",on:{click:function(t){return t.stopPropagation(),f.handleJumpDetail(e)}}},[_("div",{staticClass:"easy-tooltip-wraper-model-box-item-cover"},[_("img",{attrs:{src:null==e||null===(n=e.banner)||void 0===n?void 0:n.url,alt:""}})]),f._v(" "),_("div",{staticClass:"easy-tooltip-wraper-model-box-item-content"},[_("div",{staticClass:"easy-tooltip-model-box-model-type-box"},[_("span",{staticClass:"easy-tooltip-model-box-model-type"},[f._v(f._s(f.$t(null==e?void 0:e.type)))])]),f._v(" "),_("div",{staticClass:"easy-tooltip-model-box-model-name"},[f._v(f._s((null==e?void 0:e.name)||""))])])])})),0):f._e()],f._v(" "),f.customForm?[f._t("customContent")]:f._e()],2),f._v(" "),f.customForm?f._e():_("div",{staticClass:"bottom-generate-btn-box"},[_("div",{staticClass:"copyClass",on:{click:f.handleGenerate}},[f._v("\n            "+f._s(f.$t("Generate"))+"\n          ")])])]):f._e(),f._v(" "),_("view-image",{ref:"viewImage"}),f._v(" "),_("AiChatCreteConfirm",{attrs:{"dialog-visible":f.showMask,source:"task",fromPage:"newTask"},on:{"update:dialogVisible":function(e){f.showMask=e},"update:dialog-visible":function(e){f.showMask=e},confirm:f.handleConfirm}})],1)])}),[],!1,null,"5af747e4",null));t.a=E.exports},343:function(e,t,n){"use strict";n(36),n(14);var o=n(15),l=n(2),r=(n(1175),n(44),n(573)),c=n.n(r),d=(n(16),n(9),n(7),n(28),n(11),n(12),n(8),n(6),n(4),n(29),n(425)),h=n(39),m=n(1),v=n(24);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var _={13:{operation:"click_rating_star",behavior_info:"on_comfyui_detail_page"},2:{operation:"click_rating",behavior_info:"on_model_rating"}},y={components:{ElDrawer:c.a},data:function(){return{drawer:!1,score:0,list:[],offset:void 0,page:1,debounceHandleScroll:null,loading:!1}},props:{evaluateData:{type:Object,default:function(){return{stat:{},interaction:{}}}},width:{type:String,default:"410px"},title:{type:String,default:"rtl"},obj_type:{type:Number,default:13},from:{type:String,default:""}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(m.c)("user",["isLoggedIn","userInfo"])),mounted:function(){var e;this.score=(null===(e=this.evaluateData)||void 0===e||null===(e=e.interaction)||void 0===e?void 0:e.rating)||0,this.debounceHandleScroll=Object(v.debounce)(this.handleScroll,600),this.getList()},beforeDestroy:function(){this.debounceHandleScroll=null},methods:{handleClose:function(e){e()},handleScore:function(){this.drawer=!0,"comfyuiAppDetail"==this.from?this.$logEvent("log_actions",{operation:"click_rating_button",behavior_info:"on_comfyui_app_page"}):this.$logEvent("log_actions",{operation:_[this.obj_type].operation,behavior_info:_[this.obj_type].behavior_info})},handleScroll:function(){var e=this.$refs.scrollWrapper;try{e&&e.scrollTop+e.clientHeight>=e.scrollHeight-30&&this.getList()}catch(e){}},changeRate:function(e){var t,n=this;if(!this.isLoggedIn)return this.$EventBus.$emit("openLoginDialog"),void(this.score=0);"comfyuiAppDetail"==this.from&&this.$logEvent("log_actions",{operation:"click_stars",behavior_info:"on_comfyui_app_page"}),Object(d.a)({obj_account_id:null===(t=this.userInfo)||void 0===t?void 0:t.id,obj_id:this.evaluateData.id,obj_type:this.obj_type,rating:e}).then((function(e){1e4===e.status.code&&(n.$message.success(n.$t("evaluate_success")),setTimeout((function(){n.getList(!0)}),500))}))},handleDate:function(e){return Object(h.c)(e,Date.now())},getList:function(e){var t=this;this.loading||(this.loading=!0,e&&(this.list=[],this.page=1,this.offset=void 0),Object(d.b)({obj_id:this.evaluateData.id,obj_type:this.obj_type,offset:this.offset,page:this.page++,page_size:30}).then((function(e){e.data&&(t.offset=e.data.offset,t.list=[].concat(Object(o.a)(t.list),Object(o.a)(e.data.items)))})).finally((function(){t.loading=!1})))}}},w=y,C=(n(2510),n(0)),component=Object(C.a)(w,(function(){var e,t,n,o=this,l=o._self._c;return o.evaluateData.stat?l("div",{staticClass:"Evaluate"},[l("div",{staticClass:"score-box",on:{click:o.handleScore}},[l("div",{staticClass:"score"},[l("el-rate",{attrs:{disabled:""},model:{value:o.evaluateData.stat.rating,callback:function(e){o.$set(o.evaluateData.stat,"rating",e)},expression:"evaluateData.stat.rating"}}),o._v(" "),l("span",{staticClass:"fraction"},[o._v(o._s((null===(e=o.evaluateData.stat)||void 0===e?void 0:e.rating)||0))]),o._v(" "),l("div",{staticClass:"mask"})],1),o._v(" "),(null===(t=o.evaluateData.stat)||void 0===t?void 0:t.num_of_rating)>0?l("span",{staticClass:"score-evaluating"},[o._v(" "+o._s(null===(n=o.evaluateData.stat)||void 0===n?void 0:n.num_of_rating))]):o._e()]),o._v(" "),l("div",{staticClass:"content"},[l("el-drawer",{attrs:{title:o.$t("comfyui_evaluate"),visible:o.drawer,direction:o.title,size:o.width,"before-close":o.handleClose},on:{"update:visible":function(e){o.drawer=e}}},[l("div",{staticClass:"score-play"},[l("el-rate",{attrs:{"void-icon-class":"el-icon-star-on",colors:["#FFC224","#FFC224","#FF9900"]},on:{change:o.changeRate},model:{value:o.score,callback:function(e){o.score=e},expression:"score"}})],1),o._v(" "),l("div",{directives:[{name:"loading",rawName:"v-loading",value:o.loading,expression:"loading"}],ref:"scrollWrapper",staticClass:"user-score",on:{scroll:o.handleScroll}},o._l(o.list,(function(e,t){var n,r,c,d;return l("div",{key:t,staticClass:"list"},[l("el-rate",{attrs:{"void-icon-class":"el-icon-star-on",disabled:"",colors:["#FFC224","#FFC224","#FFC224"],"score-template":String(e.rating)},model:{value:e.rating,callback:function(t){o.$set(e,"rating",t)},expression:"item.rating"}}),o._v(" "),l("div",{staticClass:"info"},[null!==(n=e.account)&&void 0!==n&&n.head?l("img",{staticClass:"avatar",attrs:{src:null===(c=e.account)||void 0===c?void 0:c.head}}):l("div",{staticClass:"avatar-name"},[o._v("\n              "+o._s(null===(r=e.account)||void 0===r?void 0:r.name.slice(0,1).toUpperCase())+"\n            ")]),o._v(" "),l("div",{staticClass:"info-detail"},[l("span",{staticClass:"name"},[o._v(o._s(null===(d=e.account)||void 0===d?void 0:d.name))]),o._v(" "),l("span",{staticClass:"date"},[o._v(o._s(o.handleDate(null==e?void 0:e.update_at)))])])])],1)})),0)])],1)]):o._e()}),[],!1,null,"79ea69bc",null);t.a=component.exports},344:function(e,t,n){"use strict";var o={name:"HelpTip",props:{content:{type:String,default:""},color:{type:String,default:""}},computed:{getStyle:function(){return{color:this.color}}}},l=n(0),component=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"balance-tips"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticStyle:{"text-align":"center"}},[e._v(e._s(e.content))])]},proxy:!0}])},[e._v(" "),t("i",{staticClass:"iconfont icon-help-icon",style:e.getStyle,attrs:{slot:"reference"},slot:"reference"})])}),[],!1,null,null,null);t.a=component.exports},351:function(e,t,n){"use strict";n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),l=n(1);function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={inject:["top"],computed:c(c(c(c(c({},Object(l.c)("user",["isLoggedIn"])),Object(l.c)("payment",["paymentInfo"])),Object(l.e)("user",["userInfo"])),Object(l.c)("activity",["isShowActivityBanner"])),{},{isOldUser:function(){var e;return!!this.userInfo&&((new Date).getTime()-(null===(e=this.userInfo)||void 0===e?void 0:e.create_at))/1e3/3600>48},svipTxt:function(){var e;return this.isShowActivityBanner?"ChristmasGBanner":this.isOldUser||null!==(e=this.paymentInfo)&&void 0!==e&&e.svipExpiryTime?"Svip80Off":"SvipFreeTry"}}),methods:{toMall:function(){if(this.top.token){var e="".concat(location.origin,"/mall");window.open(e,"_blank")}else this.$EventBus.$emit("openLoginDialog",{callBack:function(){var e="".concat(location.origin,"/mall");window.open(e,"_blank")}})},handleClick:function(){this.isLoggedIn?this.$EventBus.$emit("openDailyDialog","createBanner"):this.$EventBus.$emit("openLoginDialog")},closeBanner:function(){var time=Date.now();localStorage.setItem("SubBannerTime",time),this.$emit("close")}}},h=(n(2617),n(0)),component=Object(h.a)(d,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"recharge-banner"},[t("div",{staticClass:"content"},[t("p",[e._v(e._s(e.$t(e.svipTxt)))]),e._v(" "),t("div",{staticClass:"sub-btn",on:{click:e.handleClick}},[e._v("\n      "+e._s(e.$t("seoEraser_btn_1"))+" \n      "),t("i",{staticClass:"iconfont icon-icon-right-circle",staticStyle:{color:"#2B1D07"}})])]),e._v(" "),t("i",{staticClass:"iconfont icon-close",on:{click:e.closeBanner}})])}),[],!1,null,"4a760464",null);t.a=component.exports},352:function(e,t,n){"use strict";n(28),n(8);var o={name:"generateRectItem",props:{item:{type:Object,default:function(){}},index:{type:Number,default:0},size:{type:Number,default:100}},data:function(){return{isDragging:!1,offset:{},draggable:null,container:null,parentW:0,intW:0,intH:0,intT:0,intL:0}},watch:{size:{handler:function(e){this.resizeChildElement()}}},mounted:function(){this.container=document.getElementById("draggable"),this.draggable=this.$refs["rectItem"+this.index],this.parentW=JSON.parse(JSON.stringify(this.container.offsetWidth)),this.intW=JSON.parse(JSON.stringify(parseInt(this.draggable.style.width))),this.intH=JSON.parse(JSON.stringify(parseInt(this.draggable.style.height))),this.intT=JSON.parse(JSON.stringify(parseInt(this.draggable.style.top))),this.intL=JSON.parse(JSON.stringify(parseInt(this.draggable.style.left)))},methods:{resizeChildElement:function(){var e=this.container.offsetWidth/this.parentW;this.draggable.style.top=this.intT*e+"px",this.draggable.style.left=this.intL*e+"px",this.draggable.style.width=this.intW*e+"px",this.draggable.style.height=this.intH*e+"px",this.$emit("change",{index:this.index,top:parseInt(this.draggable.style.top),left:parseInt(this.draggable.style.left),width:parseInt(this.draggable.style.width),height:parseInt(this.draggable.style.height)})},onMousedown:function(e){this.isDragging=!0;var t=this.draggable.getBoundingClientRect();this.offset.x=e.clientX-t.left,this.offset.y=e.clientY-t.top},onMousemove:function(e){if(this.isDragging){var t=e.clientX-this.offset.x-this.container.getBoundingClientRect().left,n=e.clientY-this.offset.y-this.container.getBoundingClientRect().top;t=Math.min(this.container.clientWidth-this.draggable.clientWidth,Math.max(0,t)),n=Math.min(this.container.clientHeight-this.draggable.clientHeight,Math.max(0,n)),this.draggable.style.left=t+"px",this.draggable.style.top=n+"px",this.draggable.style.zIndex=9999}},onMouseup:function(e){this.isDragging=!1,this.draggable.style.zIndex=2,this.intW=JSON.parse(JSON.stringify(parseInt(this.draggable.style.width))),this.intH=JSON.parse(JSON.stringify(parseInt(this.draggable.style.height))),this.intT=JSON.parse(JSON.stringify(parseInt(this.draggable.style.top))),this.intL=JSON.parse(JSON.stringify(parseInt(this.draggable.style.left))),this.$emit("change",{index:this.index,top:this.intT,left:this.intL,width:this.intW,height:this.intH})}}},l=(n(2641),n(0)),component=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{ref:"rectItem"+e.index,staticClass:"rectItem",style:{width:e.item.width+"px",height:e.item.height+"px",left:e.item.left+"px",top:e.item.top+"px"},on:{"&mousedown":function(t){return e.onMousedown.apply(null,arguments)},"&mousemove":function(t){return e.onMousemove.apply(null,arguments)},"&mouseup":function(t){return e.onMouseup.apply(null,arguments)},mouseleave:function(t){return t.preventDefault(),e.onMouseup.apply(null,arguments)}}},[t("div",{staticClass:"clear",on:{click:function(t){return e.$emit("delete",e.index)}}},[t("i",{staticClass:"el-icon-close"})])])}),[],!1,null,"6789ba2c",null);t.a=component.exports},356:function(e,t,n){"use strict";n(28);var o={name:"SwipeList",props:{iconBntWidth:{type:Number,default:40},scrollLeftnum:{type:Number,default:null},scrollChange:{type:Object,default:null},moveLeng:{type:Number,default:600}},data:function(){return{isShowLeft:!1,isShowRight:!1,savedScrollLeft:0}},mounted:function(){var e=this;this.$refs.scrollArea.addEventListener("scroll",this.setMoveBtnShow),this.$once("hook:beforeDestroy",(function(){e.$refs.scrollArea.removeEventListener("scroll",e.setMoveBtnShow)}))},updated:function(){var e=this;this.$nextTick((function(){e.setMoveBtnShow()}))},watch:{scrollLeftnum:{handler:function(e){e&&e>0&&(this.$refs.scrollArea.scrollLeft=e-this.$refs.scrollArea.getBoundingClientRect().left-this.$refs.scrollArea.offsetWidth/2+50)}},scrollChange:{handler:function(e){if(e.value){var t=e.value-this.$refs.scrollArea.getBoundingClientRect().left-this.$refs.scrollArea.offsetWidth/2+50;this.tagsMove(t)}}}},activated:function(){var e=this;this.$nextTick((function(){e.setMoveBtnShow()})),this.$refs.scrollArea.scrollLeft=this.savedScrollLeft},methods:{setMoveBtnShow:function(){var e=this.$refs.scrollArea;e<=this.$refs.tags.offsetWidth&&(this.isShowRight=!1),this.isShowLeft=0!==e.scrollLeft,this.isShowRight=e.scrollLeft+e.clientWidth!==e.scrollWidth,this.savedScrollLeft=this.$refs.scrollArea.scrollLeft},tagsMove:function(e){this.$refs.scrollArea.scrollBy({left:e,behavior:"smooth"})}}},l=(n(2586),n(0)),component=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{ref:"tags",staticClass:"c-swipe-list"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowLeft,expression:"isShowLeft"}],staticClass:"swipeab-icon-box swipeab-icon-box-left",style:{width:e.iconBntWidth+"px"}},[t("div",{staticClass:"icon-bnt",style:{width:e.iconBntWidth+"px",height:e.iconBntWidth+"px"},on:{click:function(t){return e.tagsMove("-"+e.moveLeng)}}},[t("i",{staticClass:"el-icon-arrow-left"})])]),e._v(" "),t("div",{ref:"scrollArea",staticClass:"scroll-area"},[t("div",{staticClass:"content"},[t("div",{staticClass:"list"},[e._t("default")],2)])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowRight,expression:"isShowRight"}],staticClass:"swipeab-icon-box swipeab-icon-box-right",style:{width:e.iconBntWidth+"px"}},[t("div",{staticClass:"icon-bnt",style:{width:e.iconBntWidth+"px",height:e.iconBntWidth+"px"},on:{click:function(t){return e.tagsMove(e.moveLeng)}}},[t("i",{staticClass:"el-icon-arrow-right"})])])])}),[],!1,null,"6e0f919d",null);t.a=component.exports},506:function(e,t,n){"use strict";n(14),n(10),n(18);var o=n(5),l=n(3),r=(n(20),n(1925)),c=n(41),d={components:{ModelBox:r.a},data:function(){return{isShow:!1,loraInfo:{}}},watch:{$route:function(e){this.show(!1)}},methods:{show:function(e,t,n){var o=this;return Object(l.a)(regeneratorRuntime.mark((function l(){var r,data;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(o.isShow=e,!t){l.next=8;break}return l.next=4,o.getModelInfo(t,n);case 4:r=l.sent,data=r.data,o.loraInfo=data,o.$set(o,"loraInfo",o.loraInfo);case 8:case"end":return l.stop()}}),l)})))()},getModelInfo:function(e,t){return Object(c.F)({id:e,version_id:t,summary:!0})},handleBeforeClose:function(){this.loraInfo={}}}},h=(n(2996),n(0)),m=Object(h.a)(d,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"lora-popup custom-dialog",attrs:{visible:e.isShow,top:"20px","append-to-body":!0},on:{"update:visible":function(t){e.isShow=t},close:e.handleBeforeClose}},[t("div",{staticClass:"lora-body"},[e.isShow?t("model-box",{ref:"modelBox",attrs:{modelInfo:e.loraInfo}}):e._e()],1)])}),[],!1,null,"e9f286d6",null).exports,v=n(82),f=n(13),_=n(271),y={props:{list:{type:Array,default:function(){return[]}},isStudioMode:{type:Boolean,default:!1},studioModelInfo:{type:Object,default:function(){return{}}}},components:{LoraPopup:m,modelPayNum:v.a,changeVerNew:_.a},data:function(){return{}},computed:{checkStudioLoraType:function(){var e=this;return function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).base_model,n=(e.studioModelInfo||{}).base_model_type,o=null===f.B||void 0===f.B?void 0:f.B.flux,l=["SD 3"],r=["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony"],c=["SD 1.5","SD 2.0","SD 1.4","SD 2.1 768","SD 2.1","SD 2.0 768","SD 1.5 LCM"],d=null===f.B||void 0===f.B?void 0:f.B.sd35,h=(null===f.B||void 0===f.B?void 0:f.B.sa)||[],m=o.includes(n)||(n||"").includes("Flux"),v=r.includes(n)||(n||"").includes("SDXL"),_=c.includes(n),y=l.includes(n),w=d.includes(n)||(n||"").includes("SD 3.5"),C=h.includes(n),k=r.includes(t)||(t||"").includes("SDXL"),S=c.includes(t),x=l.includes(t),I=o.includes(t),O=h.includes(t),T=d.includes(t)&&n===t;return v&&!k||_&&!S||y&&!x||m&&!I||C&&!O||w&&!T}}},methods:{handleOpenPopup:function(e){try{var t;null===(t=this.$refs)||void 0===t||null===(t=t[e])||void 0===t||t.openPopup()}catch(e){}},handleChangeLoraVersion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.$emit("updateLoraInfo",e,t)},changeUrl:function(e){return Object(o.x)(e,"high")},changeWeight:function(e,t){this.$emit("change","WEIGHT",t,e)},deleteModel:function(e){this.$emit("change","DEL",e)},viewLora:function(i){var e=this.list[i],t=this.localePath("/models/detail/".concat(e.id));window.open(t,"_blank")}}},w=y,C=(n(2998),Object(h.a)(w,(function(){var e,t=this,n=t._self._c;return n("div",{directives:[{name:"show",rawName:"v-show",value:null===(e=t.list)||void 0===e?void 0:e.length,expression:"list?.length"}],staticClass:"lora-list"},[n("lora-popup",{ref:"loraPopup"}),t._v(" "),t._l(t.list,(function(img,i){return n("div",{key:"selectMode_"+i,staticClass:"lora-item"},[n("div",{staticClass:"image-box",on:{click:function(e){return t.viewLora(i)}}},[img.is_agency_fee?n("div",{staticClass:"payNum"},[n("modelPayNum",{attrs:{number:img.agency_fee}})],1):t._e(),t._v(" "),img.banner.url?n("el-image",{attrs:{src:img.banner&&t.changeUrl(img.banner.url)}},[n("template",{slot:"placeholder"},[n("i",{staticClass:"el-icon-loading image-loading"})]),t._v(" "),n("template",{slot:"error"},[n("img",{staticClass:"select-model-image",attrs:{src:img&&img.banner?img.banner.url:"",alt:""}})])],2):n("p",{staticClass:"empty-img"},[t._v(t._s(t.$t("EmptyBannerText")))]),t._v(" "),n("div",{staticClass:"version-panel",on:{click:function(e){return e.stopPropagation(),t.handleOpenPopup("loraVersion_".concat(i))}}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:null==img?void 0:img.version_name,placement:"top"}},[n("div",{staticClass:"version-panel-text"},[t._v(t._s(null==img?void 0:img.version_name))])]),t._v(" "),n("div",{staticClass:"version-panel-icon el-icon-caret-bottom"}),t._v(" "),n("change-ver-new",{ref:"loraVersion_".concat(i),refInFor:!0,staticClass:"version-item",staticStyle:{opacity:"0 !important"},attrs:{from:"styleModal",item:img,base_models:[null==img?void 0:img.base_model]},on:{selectItem:function(e){return t.handleChangeLoraVersion(e,i)}}})],1),t._v(" "),t.isStudioMode?n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("studio25"),placement:"top-start"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.checkStudioLoraType(img),expression:"checkStudioLoraType(img)"}],staticClass:"lora-type-not-match"},[n("span",{staticClass:"iconfont icon-warn"})])]):t._e()],1),t._v(" "),n("div",{staticClass:"slider slider-item"},[n("p",{staticClass:"lora-name ellipsis",on:{click:function(e){return t.viewLora(i)}}},[t._v(t._s(img.name))]),t._v(" "),n("el-slider",{attrs:{value:img.weight,min:-1,max:2,step:.05,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(e){return t.changeWeight(e,i)}}})],1),t._v(" "),n("i",{staticClass:"el-icon-delete delete-icon",on:{click:function(e){return t.deleteModel(i)}}})])}))],2)}),[],!1,null,"8e557ae2",null));t.a=C.exports},517:function(e,t,n){"use strict";n(2132),n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),l=(n(16),n(10),n(1));function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={props:{fixed:{type:Boolean,default:!1}},data:function(){return{}},computed:c(c(c(c(c({},Object(l.c)("activity",["isShowActivityBanner"])),Object(l.c)("user",["isLoggedIn"])),Object(l.c)("payment",["paymentInfo"])),Object(l.e)("user",["cdnHost","userInfo"])),{},{isOldUser:function(){var e;return!!this.userInfo&&((new Date).getTime()-(null===(e=this.userInfo)||void 0===e?void 0:e.create_at))/1e3/3600>48},bannerUrl:function(){var e,t=this.$i18n.locale,n=(new Date).getTime(),o=new Date("2024-11-29T00:00:00Z"),l=new Date("2024-12-13T00:00:00Z");if(n>=o&&n<l)return"https://".concat(this.cdnHost,"/static/hengfu/blackfriday_extend/web_").concat(t,".webp");if(this.isShowActivityBanner)return"https://".concat(this.cdnHost,"/static/hengfu/christmas/web_").concat(t,".webp");var r=["zhCN","zhTW","en","ja","ar","ko","de","fr","ru","es","pt","th"].includes(t)?t:"en",c="https://".concat(this.cdnHost,"/static/banner/web_svip_freetry_").concat(r,".png");return(this.isOldUser||null!==(e=this.paymentInfo)&&void 0!==e&&e.svipExpiryTime)&&(c="https://".concat(this.cdnHost,"/static/banner/web_svip_").concat(r,".png")),c}}),methods:{closeBanner:function(){this.$emit("close")},toMall:function(){this.$logEvent("log_actions",{operation:"click_join_now_button",behavior_info:"top_banner"}),this.isShowActivityBanner?this.$router.push({path:this.localePath("/mall")}):this.isLoggedIn?this.$EventBus.$emit("openDailyDialog","topBanner"):this.$EventBus.$emit("openLoginDialog")}}},h=(n(2133),n(0)),component=Object(h.a)(d,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"top-banner",class:{"fixed-banner":e.fixed}},[t("a",{attrs:{href:"/mall?dotFrom=svip_banner"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.toMall.apply(null,arguments)}}},[t("img",{attrs:{src:e.bannerUrl,alt:""}})]),e._v(" "),t("span",{staticClass:"close-btn",on:{click:e.closeBanner}},[e._v("×")])])}),[],!1,null,"448bd57d",null);t.a=component.exports},524:function(e,t,n){"use strict";n(10),n(14),n(23),n(18),n(120);var o=n(3),l=n(2),r=(n(2486),n(44),n(1956)),c=n.n(r),d=(n(20),n(7),n(36),n(43),n(9),n(28),n(11),n(12),n(8),n(4),n(6),n(29),n(5)),h=n(21),m=n(35),v=n.n(m),f=n(1),_=n(33),y=n(214),w=n(73),C=n(136);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x={mixins:[_.a],components:{CollectionCreate:y.a,auditDialog:C.a,ElDatePicker:c.a},props:{isOpen:{type:Boolean,default:!0},account_no:{type:String,default:""},title:{type:String,default:""},type:{type:String,default:"artwork"},checkList:{type:Object,default:function(){return{ids:[],collectIds:[]}}},editShow:{type:Boolean,default:!0},backShow:{type:Boolean,default:!1},showSearch:{type:Boolean,default:!0},showFilter:{type:Boolean,default:!0},listLenth:{type:Number,default:0},titleSize:{type:Number,default:20},threshold:{type:Number,default:0},category:{type:Boolean,default:!0},isScreen:{type:Boolean,default:!1},collectionDetail:{type:Boolean,default:!1}},data:function(){return{replaceImageType:d.x,batchLoading:!1,isCheck:!1,openEdit:!1,openPost:!1,dialogVisible:!1,onloading:!1,isLoding:!1,inputBorderShow:!1,isCheckAll:!1,fromPath:"",keyword:"",Wh:"inherit",folderlist:[],createShow:!1,isTiemRow:!1,AworkBnt:this.$t("All"),titleBarData:{workType:[],searchKeyword:"",start_at:0,end_at:0},times:"",btnLoading:!1,orders:["New","Hot"],activeOrder:"New",activeType:"artwork",selectedStatus:[],status:[{key:"createSetting1",value:1},{key:"createSetting2",value:2}]}},computed:S(S(S(S({},Object(f.e)("user",["userInfo"])),Object(f.e)("payment",["paymentInfo"])),Object(f.c)("user",["isCompanyAccount"])),{},{types:function(){var e=[{name:this.$t("Explore"),value:"artwork"},{name:this.$t("AIModel"),value:"model"},{name:this.$t("digitalHuman"),value:"character"},{name:this.$t("AIAudio"),value:"ai_audio"},{name:this.$t("Post"),value:"post"},{name:this.$t("Canvas"),value:"palette"},{name:this.$t("Swtft_App"),value:"swtft_app"},{name:this.$t("WorkFlow"),value:"workflow"}];return this.$isChinaSite&&e.splice(2,2),e},isShowTimeRow:function(){return!this.account_no&&["artwork","model"].includes(this.type)},btnArr:function(){return[{key:"Post",icon:"icon-myPostIcon",show:this.category&&this.listLenth>0&&2!=this.titleBarData.workType&&!this.account_no},{key:"collectCreate7",icon:"icon-tupianji",show:!0},{key:"Download",icon:"icon-icon-Download",show:"artwork"===this.type},{key:"Delete",icon:"icon-moveDelete",show:!0},{key:"Cancel",icon:"icon-round-wrong",show:!0}]},getHeight:function(){var e=36==this.titleSize?144:123;return this.isCheck&&(e+=60),{height:e+"px"}},getTitleStyle:function(){var e=36==this.titleSize?144:123;return this.isCheck&&(e+=60),{width:this.Wh,height:e+"px"}},isVip:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},filteredList:function(){var e=this;return this.folderlist.filter((function(t){return t.name.includes(e.keyword)&&"all"!=t.id&&"default"!=t.id&&t.name!==e.$route.query.name}))},checkIsShowViewNsfw:function(){var e;return null==this||null===(e=this.userInfo)||void 0===e?void 0:e.enable_nsfw_plus},enableNsfwMode:function(){var e;return![2,"2"].includes(null==this||null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.nsfw_plus)},workBntList:function(){var e=[{label:this.$t("All"),value:[]},{label:this.$t("Grid"),value:[2]},{label:this.$t("Upscale"),value:[1,3]},{label:this.$t("ManualSave"),value:[4,6]},{label:this.$t("GIF"),value:[6]}];return this.isCompanyAccount&&(e=e.slice(0,3)),e}}),watch:{isOpen:function(e){var t=this;setTimeout((function(){t.setWh()}),1e3)},openPost:{handler:function(e){e?this.$emit("ImgTypeChange",[2]):this.$emit("ImgTypeChange",[])}},checkList:{handler:function(e){e.ids&&this.listLenth>0&&e.ids.length==this.listLenth?this.isCheckAll=!0:this.isCheckAll=!1},deep:!0},dialogVisible:{handler:function(e){this.keyword="",e?(this.onloading=!0,this.getCollectionList()):this.folderlist=[]}},isCheck:{handler:function(e){this.$emit("changeCheck",e)}}},updated:function(){"inherit"==this.Wh&&this.setWh()},mounted:function(){var e=this;this.setWh(),window.addEventListener("resize",this.setWh),window.addEventListener("scroll",this.onScroll),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",e.setWh),window.removeEventListener("scroll",e.onScroll)}))},beforeRouteEnter:function(e,t,n){n((function(e){e.fromPath=t.path}))},methods:S(S({},Object(f.b)("user",["getAccountInfo"])),{},{handleBtnClick:function(e){var t;if(null!==(t=this.checkList)&&void 0!==t&&null!==(t=t.ids)&&void 0!==t&&t.length||"Cancel"==e){switch(this.$logEvent("log_actions",{operation:{Post:"click_batch_post",collectCreate7:"click_batch_organize",Download:"click_batch_download",Delete:"click_batch_delete",Cancel:"click_cancel_button"}[e],behavior_info:this.collectionDetail?"on_collection_detail":"on_personal_center"}),e){case"Post":this.onPost();break;case"Download":this.batchDownload();break;case"Delete":this.onDelete();break;case"Cancel":this.isCheck=!1,this.openPost=!1}}},changeEditBnt:function(){var e=this;this.$logEvent("log_actions",{operation:"click_select",behavior_info:this.collectionDetail?"on_collection_detail":"on_personal_center"}),this.openEdit=!0,this.openPost=!1,this.$nextTick((function(){e.isCheck=!0}))},changePostBnt:function(){var e=this;this.$logEvent("log_actions",{operation:"click_post_picture_button",behavior_info:"on_self_work_quickpost"}),this.openEdit=!1,this.openPost=!0,this.isCheck=!1,this.$nextTick((function(){e.isCheck=!0}))},settingViewNsfw:function(){var e;this.$logEvent("log_actions",{operation:"click_NSFW_on_personalCenter"}),this.btnLoading||(this.enableNsfwMode||1===(null===(e=this.userInfo)||void 0===e?void 0:e.is_audit)?this.applyNsfw():this.$refs.auditDialog.showDialog())},applyNsfw:function(){var e=this;this.btnLoading=!0;var t={};t.nsfw_plus=this.enableNsfwMode?2:1,t.mode=1,t.age_confirm=!0,Object(w.b)(t).then((function(t){var n=(t||{}).status.code;["10000",1e4].includes(void 0===n?"":n)&&(e.$message.success(e.$t(e.enableNsfwMode?"ClosedSuccessfully":"OpenedSuccessfully")),e.btnLoading=!1,e.getAccountInfo())})).finally((function(){e.btnLoading=!1}))},downloadValidate:function(){var e,t;return!(null===(e=this.checkList)||void 0===e||null===(e=e.ids)||void 0===e||!e.length)&&(this.isVip||this.isCompanyAccount?(null===(t=this.checkList)||void 0===t||null===(t=t.ids)||void 0===t?void 0:t.length)>50?(this.$message.warning(this.$t("batchDownloadLimitNum",{num:50})),!1):!this.batchLoading:(this.$EventBus.$emit("showBreakDialog","DownloadLimitTipWeb","basic"),!1))},batchDownload:function(){var e=this;this.downloadValidate()&&(this.batchLoading=!0,Object(h.c)({artwork_ids:this.checkList.ids}).then((function(t){var n=t.data.task_id;e.loopCallDownload(n)})).catch((function(t){e.batchLoading=!1})))},loopCallDownload:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:l=setInterval(Object(o.a)(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(h.c)({task_id:e,artwork_ids:t.checkList.ids});case 3:o=n.sent,r=o.data.url,t.batchLoading=!1,r&&(clearInterval(l),t.downloadFile(r)),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(0),clearInterval(l),t.batchLoading=!1,console.log("error",n.t0);case 14:case"end":return n.stop()}}),n,null,[[0,9]])}))),3e3);case 2:case"end":return n.stop()}}),n)})))()},downloadFile:function(e){var link=document.createElement("a");link.href=e,link.click()},setTiemRow:function(){this.isTiemRow=!this.isTiemRow,0!=this.titleBarData.start_at&&0!=this.titleBarData.end_at&&(this.times="",this.setCheckTime(null)),this.$emit("changeTiemRow",this.isTiemRow)},setWorkType:function(e){this.titleBarData.workType=e,this.$emit("changeTitleBar",this.titleBarData)},handleOrder:function(e){this.activeOrder=e;this.$emit("changeTitleBar",{order_by:{New:"new",Hot:"hot"}[e]})},handleType:function(e){var label=e.label,t=e.value;this.AworkBnt=label,this.setWorkType(t)},handleStatus:function(e){var t;this.selectedStatus.includes(e)?this.selectedStatus=this.selectedStatus.filter((function(t){return t!==e})):this.selectedStatus.push(e),t=[0,2].includes(this.selectedStatus.length)?0:this.selectedStatus[0],this.$emit("changeTitleBar",{publish_status:t})},handleCollectType:function(e){this.$logEvent("log_actions",{operation:"click_select",behavior_info:"on_personal_center",behavior_info_sub:e}),this.activeType=e,this.$EventBus.$emit("changeCollectType",e)},filterReset:function(){this.activeOrder="New",this.AworkBnt=this.$t("All"),this.activeType="artwork",this.selectedStatus=[],this.category?this.$emit("changeTitleBar",{order_by:"new",workType:[],publish_status:0}):this.$EventBus.$emit("changeCollectType","artwork")},setCheckTime:function(e){e?(this.titleBarData.start_at=e[0],this.titleBarData.end_at=e[1]+86399e3):(this.titleBarData.start_at=0,this.titleBarData.end_at=0),this.$emit("changeTitleBar",this.titleBarData)},newCreate:function(){this.dialogVisible=!1,this.$emit("newCreate")},search:function(e){13===e.which&&this.$emit("changeTitleBar",this.titleBarData)},clear:function(){this.titleBarData.searchKeyword="",this.$emit("changeTitleBar",this.titleBarData)},backTo:function(){window.history.length>1&&"/"!=this.fromPath?this.$router.back():this.$router.push("/")},onDelete:function(){var e=this;this.$confirm(this.category?this.$t("newPortfolioBatchDelete"):this.$t("collectBatchDelete"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),customClass:"collectConfirm",type:"warning"}).then((function(){e.unBatchFavorite(e.checkList,e.category,(function(t){e.$emit("editSuccess")}))})).catch((function(){}))},onPost:function(){var e,t=this;if((null===(e=this.checkList)||void 0===e||null===(e=e.ids)||void 0===e?void 0:e.length)>20)this.$message.warning(this.$t("PostImageLimitNum",{num:20}));else{var n=[];this.checkList.ids.forEach((function(e,o){n.push({url:t.checkList.url[o],id:t.checkList.ids[o]})})),this.$EventBus.$emit("openCreativeCenterModal",{list:n,type:"text",source:"self"})}},moveCollect:function(e){var t=this,n=e||null;this.isLoding=!0,this.moveFavorite(this.checkList,n,this.category,(function(n){t.$emit("editSuccess"),t.$message.success(t.$t("collectCreate6",{name:null==e?void 0:e.name})),t.isLoding=!1,t.dialogVisible=!1}),(function(e){t.isLoding=!1}))},getCollectionList:function(){var e=this,t={type:{artwork:1,model:2,post:3,palette:4,workflow:5,swtft_app:6,character:7,ai_audio:9}[this.type],category:this.category?2:null};Object(h.B)(t).then((function(t){e.onloading=!1;var n=v()(t.data.items);n.forEach((function(element){element.imgList=[];var t={artwork:"artwork_items",model:"model_items",post:"post_items",palette:"tpl_items",comfy:"comfy_ui_items"},n=element[t[e.type]]?element[t[e.type]]:null;if(n){var o={url:1==n.status&&(2==n.primary||n.account_no==e.userInfo.id)&&n.banner&&n.banner.url?n.banner.url:null,nsfw:n.nsfw,id:n.id};element.imgList.push(o)}})),e.folderlist=n}))},setWh:function(){if(this.$refs.cnt){var e=this.$refs.cnt.offsetWidth;this.Wh=0==e?"inherit":this.$refs.cnt.offsetWidth+"px"}},onScroll:function(){var e=this.threshold,t=this.$refs.title,rect=this.$refs.cnt.getBoundingClientRect();if(t){var n="sticky";rect.top<e?(t.classList.add(n),t.style.top=e+"px"):(t.classList.remove(n),t.style.top=null)}}})},I=(n(2487),n(2488),n(2489),n(0)),component=Object(I.a)(x,(function(){var e,t,n=this,o=n._self._c;return o("div",{ref:"cnt",staticClass:"editTitle",style:n.getHeight},[o("div",{ref:"title",staticClass:"title",style:n.getTitleStyle},[o("div",{staticClass:"titleCnt"},[o("div",{staticClass:"titleName"},[n.backShow?o("div",{staticClass:"backIcon",on:{click:function(e){return e.stopPropagation(),n.backTo.apply(null,arguments)}}},[o("i",{staticClass:"el-icon-back"})]):n._e(),n._v(" "),o("span",{staticClass:"txt",style:{fontSize:"".concat(n.titleSize,"px")}},[n._v(n._s(n.title))])])]),n._v(" "),o("div",{staticClass:"inputBox"},[o("div",{staticClass:"inputLeft"},[n.showSearch?o("div",{staticClass:"input-search",class:{inputBorder:n.inputBorderShow}},[o("i",{staticClass:"iconfont icon-min-search"}),n._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:n.titleBarData.searchKeyword,expression:"titleBarData.searchKeyword"}],attrs:{type:"text",placeholder:n.$t("minSearch"),maxlength:"40"},domProps:{value:n.titleBarData.searchKeyword},on:{keypress:n.search,focus:function(e){n.inputBorderShow=!0},blur:function(e){n.inputBorderShow=!1},input:function(e){e.target.composing||n.$set(n.titleBarData,"searchKeyword",e.target.value)}}}),n._v(" "),n.titleBarData.searchKeyword.length>0?o("i",{staticClass:"el-icon-close",on:{click:n.clear}}):n._e()]):n._e(),n._v(" "),n.isTiemRow?o("el-date-picker",{attrs:{"popper-class":"checkTIme",type:"daterange","value-format":"timestamp","range-separator":"~","start-placeholder":n.$t("startDate"),"end-placeholder":n.$t("endDate")},on:{change:n.setCheckTime},model:{value:n.times,callback:function(e){n.times=e},expression:"times"}}):n._e()],1),n._v(" "),o("div",{staticClass:"manageGroup"},[o("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:!n.account_no&&n.category&&n.checkIsShowViewNsfw,expression:"!account_no && category && checkIsShowViewNsfw"}],staticClass:"item",attrs:{effect:"dark",content:n.enableNsfwMode?n.$t("hideAdultContent"):n.$t("showAdultContent"),placement:"top"}},[o("span",{staticClass:"edit nsfw-btn",on:{click:n.settingViewNsfw}},[o("i",{staticClass:"iconfont",class:n.enableNsfwMode?"icon-work-hide":"icon-work-show"})])]),n._v(" "),n.editShow&&n.listLenth>0?o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:n.$t("Manage"),placement:"top"}},[o("div",{staticClass:"edit-btn",class:{active:n.isCheck},on:{click:n.changeEditBnt}},[o("span",[n._v(n._s(n.$t("ManageSelect")))])])]):n._e(),n._v(" "),n.isShowTimeRow?o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:n.$t("timeline"),placement:"top"}},[o("span",{staticClass:"edit",on:{click:n.setTiemRow}},[o("i",{staticClass:"iconfont",class:n.isTiemRow?"icon-Waterfall":"icon-grid"})])]):n._e(),n._v(" "),n.showFilter?o("el-popover",{attrs:{placement:"bottom","popper-class":"waterfull-filter",trigger:"hover"}},[o("div",{staticClass:"filter-content"},[n.category?o("div",{staticClass:"title"},[n._v(n._s(n.$t("Sorting")))]):n._e(),n._v(" "),n.category?o("div",{staticClass:"filter"},n._l(n.orders,(function(e){return o("div",{key:e,staticClass:"item-filter",class:{active:n.activeOrder==e},on:{click:function(t){return n.handleOrder(e)}}},[n.activeOrder==e?o("i",{staticClass:"el-icon-check"}):n._e(),n._v("\n                  "+n._s(n.$t(e))+"\n                ")])})),0):n._e(),n._v(" "),n.category?[o("div",{staticClass:"title"},[n._v(n._s(n.$t("Type")))]),n._v(" "),o("div",{staticClass:"filter"},n._l(n.workBntList,(function(e){return o("div",{key:e.label,staticClass:"item-filter",class:{active:n.AworkBnt==e.label},on:{click:function(t){return n.handleType(e)}}},[n.AworkBnt==e.label?o("i",{staticClass:"el-icon-check"}):n._e(),n._v("\n                    "+n._s(e.label)+"\n                  ")])})),0)]:n._e(),n._v(" "),n.category&&!n.account_no?[o("div",{staticClass:"title"},[n._v(n._s(n.$t("status")))]),n._v(" "),o("div",{staticClass:"filter"},n._l(n.status,(function(e){return o("div",{key:e.value,staticClass:"item-filter",class:{active:n.selectedStatus.includes(e.value)},on:{click:function(t){return n.handleStatus(e.value)}}},[n.selectedStatus.includes(e.value)?o("i",{staticClass:"el-icon-check"}):n._e(),n._v("\n                    "+n._s(n.$t(e.key))+"\n                  ")])})),0)]:n._e(),n._v(" "),n.category||n.collectionDetail?n._e():[o("div",{staticClass:"title"},[n._v(n._s(n.$t("Type")))]),n._v(" "),o("div",{staticClass:"filter"},n._l(n.types,(function(e){return o("div",{key:e.value,staticClass:"item-filter",class:{active:n.activeType==e.value},on:{click:function(t){return n.handleCollectType(e.value)}}},[n.activeType==e.value?o("i",{staticClass:"el-icon-check"}):n._e(),n._v("\n                  "+n._s(e.name)+"\n                ")])})),0)],n._v(" "),o("div",{staticClass:"filter-reset",on:{click:n.filterReset}},[n._v("\n                "+n._s(n.$t("resetSelection"))+"\n              ")])],2),n._v(" "),o("div",{staticClass:"filter-box",attrs:{slot:"reference"},slot:"reference"},[o("div",[o("i",{staticClass:"iconfont icon-a-filterIcon"}),n._v(" "),o("span",[n._v(n._s(n.$t("Filter")))])]),n._v(" "),o("i",{staticClass:"el-icon-arrow-down"})])]):n._e()],1)]),n._v(" "),n.isCheck&&n.openEdit?o("div",{staticClass:"floating-box"},[o("div",{staticClass:"content"},[o("span",[n._v(n._s(n.$t("NumContentSelected",{num:(null===(e=n.checkList)||void 0===e||null===(e=e.ids)||void 0===e?void 0:e.length)||0})))])]),n._v(" "),o("div",{staticClass:"btn-box",class:{selected:null===(t=n.checkList)||void 0===t||null===(t=t.ids)||void 0===t?void 0:t.length}},[o("div",{staticClass:"item-btn",on:{click:function(e){return n.$emit("checkAll")}}},[o("div",{staticClass:"check-box flex-center"},[o("i",{directives:[{name:"show",rawName:"v-show",value:n.isCheckAll,expression:"isCheckAll"}],staticClass:"el-icon-check"})]),n._v(" "),o("span",[n._v(n._s(n.$t("SelectAll")))])]),n._v(" "),n._l(n.btnArr,(function(e){return o("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"item.show"}],key:e.key,staticClass:"item-btn",on:{click:function(t){return n.handleBtnClick(e.key)}}},["collectCreate7"!=e.key?[o("i",{staticClass:"iconfont",class:e.icon}),n._v(" "),o("span",[n._v(n._s(n.$t(e.key)))])]:[o("el-popover",{attrs:{disabled:!n.checkList.ids||0==n.checkList.ids.length,placement:"bottom-start",width:"309","popper-class":"folderList ".concat(n.createShow?"folderListHide":""),"visible-arrow":!1,title:n.$t("collectCreate7"),trigger:"click"},model:{value:n.dialogVisible,callback:function(e){n.dialogVisible=e},expression:"dialogVisible"}},[o("div",{staticClass:"cltpop-cent"},[o("div",{staticStyle:{padding:"0 10px"}},[o("div",{staticClass:"search"},[o("i",{staticClass:"iconfont icon-folder-search"}),n._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:n.keyword,expression:"keyword"}],attrs:{type:"text",placeholder:n.$t("Search")},domProps:{value:n.keyword},on:{input:function(e){e.target.composing||(n.keyword=e.target.value)}}})]),n._v(" "),o("div",{staticClass:"popTitle"},[n._v(n._s(n.$t(n.category?"collectCreate8":"collectCreate9")))]),n._v(" "),n.onloading?o("div",{directives:[{name:"loading",rawName:"v-loading",value:n.onloading,expression:"onloading"}],staticClass:"loadbox"}):n._e(),n._v(" "),o("div",{staticClass:"list"},n._l(n.filteredList,(function(e,t){return o("div",{key:t,staticClass:"itembox",on:{click:function(t){return n.moveCollect(e)}}},[o("div",{staticClass:"itemboxinfo"},[o("div",{staticClass:"itemboxinfoleft"},[e.imgList&&e.imgList[0]&&e.imgList[0].url?o("img",{attrs:{decoding:"async",loading:"lazy",src:n.replaceImageType(e.imgList[0].url,"high")}}):o("i",{staticClass:"iconfont icon-deff-collect"})]),n._v(" "),o("span",[n._v(n._s(e.name))])]),n._v(" "),o("el-button",{attrs:{loading:n.isLoding}},[n._v(n._s(n.$t("collectCreate7")))])],1)})),0)]),n._v(" "),o("div",{staticClass:"create"},[o("div",{staticClass:"itembox",on:{click:function(e){n.createShow=!0}}},[o("div",{staticClass:"itemboxinfo"},[o("div",{staticClass:"itemboxinfoleft"},[o("i",{staticClass:"el-icon-plus"})]),n._v(" "),o("span",[n._v(n._s(n.$t(n.category?"createPortfolio":"collectBox1")))])])])])]),n._v(" "),o("div",{staticClass:"moveBnt",attrs:{slot:"reference"},slot:"reference"},[o("i",{staticClass:"iconfont",class:e.icon}),n._v(" "),o("span",[n._v(n._s(n.$t(e.key)))])])])]],2)}))],2)]):n._e()]),n._v(" "),o("collection-create",{attrs:{category:n.category,width:"718px",checkList:n.checkList,type:n.type},on:{create:n.newCreate},model:{value:n.createShow,callback:function(e){n.createShow=e},expression:"createShow"}}),n._v(" "),o("auditDialog",{ref:"auditDialog",on:{confirm:n.applyNsfw}})],1)}),[],!1,null,"073a88dc",null);t.a=component.exports},533:function(e,t,n){"use strict";var o={props:{list:{type:Array,default:function(){return[]}}},data:function(){return{currentIndex:""}},methods:{handleCollapse:function(e){this.currentIndex!==e?this.currentIndex=e:this.currentIndex=""}}},l=(n(2608),n(0)),component=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",e._l(e.list,(function(n,o){return t("div",{key:o,staticClass:"collapse",on:{click:function(t){return e.handleCollapse(o)}}},[t("span",{staticClass:"tag"},[e._v(e._s(o===e.currentIndex?"-":"+"))]),e._v(" "),t("div",{staticClass:"label",class:{active:o===e.currentIndex}},[e._v("\n      "+e._s(e.$t(n.label))+"\n      "),e._l(n.value,(function(n){return t("div",{key:n,staticClass:"coll-value"},[t("span",[e._v(e._s(e.$t(n)))])])}))],2)])})),0)}),[],!1,null,"efa60546",null);t.a=component.exports},554:function(e,t,n){"use strict";n(10),n(14),n(18),n(232),n(44);var o=n(88),l=n.n(o),r=n(15),c=n(2),d=(n(16),n(7),n(47),n(70),n(19),n(36),n(43),n(28),n(9),n(11),n(12),n(8),n(4),n(23),n(49),n(118),n(76),n(6),n(29),n(5)),h=n(87),m=n(35),v=n.n(m),f=n(39),_=n(1),y=n(30),w=n(33),C=n(56),k=n(193),S=n(21),x=n(115),I=n(82);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){Object(c.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $={name:"waterFall",mixins:[w.a],components:{CollectPopover:C.a,listCheckbox:x.a,modelPayNum:I.a},props:{showNs:Boolean,list:{type:Array,default:function(){return[]}},containerForImg:{type:Object,default:null},container:{type:String,require:!0},gap:{type:Number,default:16},lazy:{type:Boolean,default:!1},type:{type:String,default:""},actived:{type:Boolean,default:!0},cols:{type:Number,default:7},fromPage:{type:String,default:""},isFromRelated:{type:Boolean,default:!1},isShowNullRelatedImg:{type:Boolean,default:!1},alreadyNoMoreData:{type:Boolean,default:!1},noSearchData:{type:Boolean,default:!1},isCheck:{type:Boolean,default:!1},dislikeShow:{type:Boolean,default:!1},hidethumbup:{type:Boolean,default:!1},hidecollect:{type:Boolean,default:!1},hoverShow:{type:Boolean,default:!1},imgQuality:{type:String,default:"low"},isTiemRow:{type:Boolean,default:!1},openWin:{type:Boolean,default:!1},checkMax:{type:Number,default:-1},category:{type:Boolean,default:!1},dotReportInfo:{type:Object,default:function(){return{category:"default",view_domain:"",batch_id:""}}},scrollContainerClassName:{type:String,default:""},scrollContentTop:{type:Number,default:0},selectList:{type:Array,default:function(){return[]}}},data:function(){var e=this;return{formatNumberForeign:d.i,copyTextToClipboard:d.d,saveImg:d.z,width:0,heights:[],dataList:[],resizeListener:Object(h.a)((function(){return e.resize(e.dataList)}),500),selfCols:4,isCollecting:!1,imagePopoverVisible:!1,reportLoading:!1,openWatch:!0,isDelete:!1,sharevisible:!1,popTime:0,itemShow:!1,itemShowId:"",checkList:{ids:[],collectIds:[],folderNos:[],url:[],info:[]},isCheckAll:!1,scrollTop:0,lastTime:null,appeaData:{obj_no:"",obj_type:1,remark:""},appealShow:!1,collectDotReportInfo:{}}},watch:{appealShow:{handler:function(e){e||(this.appeaData={obj_no:"",obj_type:1,remark:""})}},isCheck:{handler:function(e){this.isCheckAll=!1,this.dataList.forEach((function(e){e.isCheck=!1})),this.checkList={ids:[],collectIds:[],folderNos:[],url:[],info:[]},this.$emit("getChecList",this.checkList)}},list:{handler:function(e,t){this.updateList(e,t)}},WaterFallDeleteLits:{handler:function(e){this.isDelete=!0}},scrollContentTop:{handler:function(e){this.scrollTop=this.scrollContentTop||0},immediate:!0,deep:!0}},computed:T(T(T({},Object(_.c)("user",["isLoggedIn","accountSettingsData"])),Object(_.e)("user",["userInfo","accountData","adminOff"])),{},{greenMode:function(){var e;return 2!==(null==this||null===(e=this.accountData)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.green_mode)},enableGreenMode:function(){return this.greenMode&&!["/personal"].includes(this.$route.path)},checkIsShowViewNsfw:function(){var e;return null==this||null===(e=this.userInfo)||void 0===e?void 0:e.enable_nsfw_plus},enableNsfwMode:function(){var e;return![2,"2"].includes(null==this||null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.nsfw_plus)},isShowNsfw:function(){return function(e){return this.category&&this.checkIsShowViewNsfw&&!this.enableNsfwMode&&1!==e.nsfw&&(null==e?void 0:e.is_nsfw_plus)}},isPC:function(){return"PC"===localStorage.getItem("visitFrom")},setDeffBoxShow:function(){return function(e){return 2==e.status||5==e.status||((e.author&&e.author.id)!=this.userInfo.id&&"personal"!=this.fromPage?"artwork"==this.type&&1==e.primary:void 0)}},renderList:function(){return this.dynamicList(this.dataList)},setNsfwPlus:function(){return function(e){var t,n,o;return!(null==e||null===(t=e.banner)||void 0===t||!t.is_nsfw_plus)&&(null===(n=this.userInfo)||void 0===n||!n.enable_nsfw_plus||[2,"2"].includes(null===(o=this.userInfo)||void 0===o||null===(o=o.settings)||void 0===o?void 0:o.nsfw_plus))}}}),activated:function(){var e=this;this.openWatch=!0,this.resizeListener(),window.addEventListener("resize",this.resizeListener),this.lazy&&document.addEventListener("scroll",this.lazyLoad),this.$nextTick((function(){window.scrollTo(0,e.scrollTop)}))},deactivated:function(){this.openWatch=!1,window.removeEventListener("resize",this.resizeListener),window.removeEventListener("scroll",this.lazyLoad)},mounted:function(){var e=this;window.addEventListener("resize",this.resizeListener),this.lazy,this.$nextTick((function(){e.checkList.ids=e.selectList.map((function(e){return e.id})),e.checkList.url=e.selectList.map((function(e){return e.url})),(e.list||[]).forEach((function(t){var n;t.isCheck=e.checkList.url.includes(null==t||null===(n=t.banner)||void 0===n?void 0:n.url)})),(e.dataList||[]).forEach((function(t){var n;t.isCheck=e.checkList.url.includes(null==t||null===(n=t.banner)||void 0===n?void 0:n.url)})),e.updateList(e.list)}))},beforeDestroy:function(){window.removeEventListener("resize",this.resizeListener)},methods:T(T({},Object(_.b)("user",["getAccountInfo"])),{},{updateList:function(e,t){var n=this.openWatch,o=this.width;if(n){o&&0!=o||(this.width=this.getWidth());var l=v()(e);if(this.dataList.length<100)this.updateDataList(l,!1);else if(l.length>this.dataList.length){var c=Object(r.a)(l.slice(this.dataList.length));this.updateDataList(c,!0)}else l.length<=this.dataList.length&&(this.dataList=[],this.updateDataList(l,!1))}},goToDetail:function(e){e.name?window.open("/models/detail/".concat(e.id),"_blank"):window.open("/explore/detail/".concat(e.id),"_blank")},goToPersonal:function(e){var t;if(this.isLoggedIn){var n=e.author.id,o=null===(t=this.userInfo)||void 0===t?void 0:t.id,path="/user/"+encodeURIComponent(n);o==n&&(path="/personal"),window.open(path,"_blank")}else this.$EventBus.$emit("openLoginDialog")},dynamicList:function(e){var t=this.containerForImg||this.$parent.$refs[this.container]||document.querySelectorAll(".".concat(this.scrollContainerClassName,">.").concat(this.container))[0];if(!t)return e;var n=this.scrollTop-t.offsetTop;return e.filter((function(e){return n-e.top<1500&&e.top-n<2e3}))},getItemTime:function(e){var t=new Date(e),n=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0");return"".concat(n,"-").concat(o)},processTimeGroups:function(e){for(var i=0;i<e.length;i++){var t,n,o,l,r=e[i];if(null!=r&&null!==(t=r.folder_no)&&void 0!==t&&t.collect_at)if(this.getItemTime(null==r||null===(n=r.folder_no)||void 0===n?void 0:n.collect_at)!==this.lastTime)e.splice(i,0,{timeItem:this.getItemTime(null==r||null===(o=r.folder_no)||void 0===o?void 0:o.collect_at)}),this.lastTime=this.getItemTime(null==r||null===(l=r.folder_no)||void 0===l?void 0:l.collect_at)}return e},updateDataList:function(e,t){var n=this,o=this.dataList,l=this.isCheckAll,r=this.checkList,c=this.WaterFallDeleteLits,h=this.width;e.forEach((function(e){o.forEach((function(t){e.id==t.id&&(e.collect=t.collect,e.isCheck=t.isCheck,e.liked=t.liked)}))}));var m,v,_=e.filter((function(e){return!c.includes(e.id)}));this.isTiemRow&&(t||(this.lastTime=null),this.processTimeGroups(_));for(var i=0;i<_.length;i++){var y=_[i];if(y.timeItem)y.waterWidth=h,y.waterHeight=30;else{var w,C,k,S,x;if(this.$set(y,"hoverd",!1),this.$set(y,"propS",!1),this.$set(y,"rowIndex",-1),!l&&r.ids.includes(y.id)?this.$set(y,"isCheck",r.ids.includes(y.id)):this.$set(y,"isCheck",!!l),l&&!r.ids.includes(y.id))r.ids.push(y.id),null!=y&&null!==(k=y.collect)&&void 0!==k&&k.id&&r.collectIds.push(y.collect.id),null!=y&&null!==(S=y.folder_no)&&void 0!==S&&S.id&&r.folderNos.push(y.folder_no.id),null!=y&&null!==(x=y.banner)&&void 0!==x&&x.url&&r.url.push(y.banner.url),y&&r.info.push(y);y.timeDiff=Object(f.c)(y.created_at,Date.now()),y.waterWidth=h,this.isTiemRow||"gallery"===this.type?y.waterHeight=h:(m=y.banner&&y.banner.width?y.banner.width:308,v=y.banner&&y.banner.height?y.banner.height:308,y.waterHeight=parseInt(v*h/m),isNaN(y.waterHeight)&&(y.waterHeight=320)),null===(w=y.banner)||void 0===w||!w.url||null!==(C=y.banner)&&void 0!==C&&C.replaceUrl||(y.banner.replaceUrl=Object(d.x)(y.banner.url,this.imgQuality||"low")),y.errorTime=0}}t?_.forEach((function(e){n.dataList.push(e)})):this.dataList=_,this.waterfall()},checkAll:function(){var e=this;if(this.isCheck){var t=this.dataList.filter((function(e){return!e.timeItem}));this.checkList.ids.length<t.length?(t.forEach((function(t){t.isCheck=!0,e.checkChange(t)})),this.isCheckAll=!0):(t.forEach((function(t){t.isCheck=!1,e.checkChange(t)})),this.isCheckAll=!1)}},clearCheck:function(e){var t=this;e.forEach((function(e){t.dataList.forEach((function(t){e==t.id&&(t.isCheck=!1)})),t.checkList.ids.forEach((function(n,o){e!==n&&e.id!==n||(t.checkList.ids.splice(o,1),t.checkList.collectIds.splice(o,1),t.checkList.folderNos.splice(o,1),t.checkList.url.splice(o,1),t.checkList.info.splice(o,1))}))})),this.$emit("getChecList",this.checkList)},checkChange:function(e){if(e.isCheck){var t,n,o;if(!this.checkList.ids.includes(e.id))this.checkList.ids.push(e.id),null!=e&&null!==(t=e.collect)&&void 0!==t&&t.id&&this.checkList.collectIds.push(e.collect.id),null!=e&&null!==(n=e.folder_no)&&void 0!==n&&n.id&&this.checkList.folderNos.push(e.folder_no.id),null!=e&&null!==(o=e.banner)&&void 0!==o&&o.url&&this.checkList.url.push(e.banner.url),e&&this.checkList.info.push(e)}else{var l,r,c;if(-1==this.checkList.ids.indexOf(e.id))return;if(this.checkList.ids.splice(this.checkList.ids.indexOf(e.id),1),null!=e&&null!==(l=e.collect)&&void 0!==l&&l.id&&this.checkList.collectIds.splice(this.checkList.collectIds.indexOf(e.collect.id),1),null!=e&&null!==(r=e.folder_no)&&void 0!==r&&r.id&&this.checkList.folderNos.splice(this.checkList.folderNos.indexOf(e.folder_no.id),1),null!=e&&null!==(c=e.banner)&&void 0!==c&&c.url&&this.checkList.url.splice(this.checkList.url.indexOf(e.banner.url),1),e){var d=this.checkList.info.findIndex((function(t){return t.id===e.id}));this.checkList.info.splice(d,1)}}this.$emit("getChecList",this.checkList)},changeItemShow:function(e){this.itemShow=e.show,this.itemShowId=e.id,this.handleCollectPopoverClick(e)},moreActions:function(e,t){var n=this;switch(e){case"flag":this.reportArtwork(t.id);break;case"save":this.downloadImg(t);break;case"share":this.sharevisible=!0,this.popTime=setTimeout((function(){n.sharevisible=!1}),1e3);var o="".concat(window.location.origin,"/")+"explore/detail/".concat(t.id);this.$message.success(this.$t("CopiedURLToClipboard")),this.copyTextToClipboard(o);break;case"delete":this.handleWorkDelete(t);break;case"not_interested":Object(y.g)({items:[{action:"not_interested",obj_no:t.id,obj_type:1}]}).then((function(e){var o,l;1e4==(null==e||null===(o=e.status)||void 0===o?void 0:o.code)?(n.$message({message:n.$t("reduceWork"),type:"success"}),t.propS=!1,n.setWaterFallDeleteLits(t.id),n.resizeListener()):n.$message({message:(null==e||null===(l=e.status)||void 0===l?void 0:l.msg)||n.$t("ServerError"),type:"error"})}));break;case"setBg":Object(S.s)({id:t.id}).then((function(e){var o;if(1e4==(null==e||null===(o=e.status)||void 0===o?void 0:o.code))n.$message({message:n.$t("SetSuccess"),type:"success"}),t.propS=!1,n.getAccountInfo();else{var l,r,c=n.$t("ServerError");if(20309==(null==e||null===(l=e.status)||void 0===l?void 0:l.code))c=n.$t("SetBgLimit");else c=null==e||null===(r=e.status)||void 0===r?void 0:r.msg;n.$message({message:c,type:"error"})}}));break;case"appeal":this.appeaData.obj_no=t.id,this.appealShow=!0}},downloadImg:function(e){var t=this.getImageExtensionFromUrl(e.banner.url),n=(e.author?e.id:"image")+"".concat(t);this.saveImg(e.banner.url,n)},getImageExtensionFromUrl:function(e){var t=e.match(/\/([^/]+)$/);return t&&t[1].includes(".")?"."+t[1].split(".").pop().toLowerCase():".jpeg"},handleWorkDelete:function(e){var t=this;this.$confirm(this.$t("deleteConfirm"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){var n={id:e.id};t.globalLoading=!0,Object(k.a)(n).then((function(n){var o,l;1e4==(null==n||null===(o=n.status)||void 0===o?void 0:o.code)?(t.$message({message:t.$t("deleteSuccess"),type:"success"}),t.setWaterFallDeleteLits(e.id),t.resizeListener()):t.$message({message:(null==n||null===(l=n.status)||void 0===l?void 0:l.msg)||t.$t("ServerError"),type:"error"})})).finally((function(){t.globalLoading=!1}))})).catch((function(e){console.log("err",e)}))},handleContextMenu:function(e,t){1===t.nsfw&&e.preventDefault()},reportArtwork:function(e){var t=this;this.reportLoading||(this.reportLoading=!0,Object(y.o)({id:e}).then((function(e){var code=e&&e.status?e.status.code:"";[1e4].includes(code)&&l()({message:t.$t("ReportSuccess"),type:"success",duration:5e3})})).finally((function(){t.reportLoading=!1})))},handleClick:function(e,t,n){if(this.isLoggedIn){var o=this.list.findIndex((function(i){return i.id===e.id})),l=(o<10?this.list.slice(0,o):this.list.slice(o-10,o)).map((function(e){return e.id})).filter((function(e){return"banner"!=e&&"ai_tool"!=e}));switch(t){case"创作":Object(y.g)({items:[T(T({},this.dotReportInfo),{},{negative_ids:l,action:"task",obj_no:e.id,obj_type:1})]});var r=Object.assign({},e);"model"===this.type&&["explore","personal"].includes(this.fromPage)&&(r.taskSource=1),this.$EventBus.$emit("openGenerate",{action:1,data:{source:r}});break;case"收藏":Object(y.g)({items:[T(T({},this.dotReportInfo),{},{negative_ids:l,action:"collection",obj_no:e.id,obj_type:1})]}),this.setCollect(e,n)}}else this.$EventBus.$emit("openLoginDialog")},handleCollectPopoverClick:function(e){var t=this.list.findIndex((function(i){return i.id===e.id})),n=(t<10?this.list.slice(0,t):this.list.slice(t-10,t)).map((function(e){return e.id})).filter((function(e){return"banner"!=e&&"ai_tool"!=e}));this.collectDotReportInfo=T(T({},this.dotReportInfo),{},{negative_ids:n,action:"collection",obj_no:e.id,obj_type:1})},handleDetail:function(e,t){var n=this;if(this.isCheck){if(-1==this.checkMax||this.checkList.ids.length<this.checkMax)this.checkList.ids.length==this.dataList.length&&(this.isCheckAll=!0),t.isCheck&&(this.isCheckAll=!1),t.isCheck=!t.isCheck;else if(t.isCheck)this.checkList.ids.length==this.dataList.length&&(this.isCheckAll=!0),t.isCheck&&(this.isCheckAll=!1),t.isCheck=!t.isCheck;else{var o;if(1===this.checkMax)return((null===(o=this.checkList)||void 0===o?void 0:o.ids[0])||"")&&this.dataList.forEach((function(e){n.$set(e,"isCheck",!1)})),void(t.isCheck=!t.isCheck);this.$message({message:this.$t("已超过最大选择上限"),type:"warning"})}return!1}if(this.$logEvent("log_actions",{operation:{artwork:"click_image",model:"click_model",gallery:"click_gallery"}[this.type],behavior_info:t.id}),"activity"!==this.type)if("IMG"!==e.target.tagName&&"cltpop"!==e.target.className&&"img-content"!==e.target.className&&"statusZg"!==e.target.className&&"workInfo"!==e.target.className||"model"!==this.type)if("IMG"!==e.target.tagName&&"cltpop"!==e.target.className&&"img-content"!==e.target.className&&"statusZg"!==e.target.className&&"workInfo"!==e.target.className&&"green-mode-div"!==e.target.className||"artwork"!==this.type)"IMG"!==e.target.tagName&&"img-content"!==e.target.className&&"statusZg"!==e.target.className&&"workInfo"!==e.target.className||"gallery"!==this.type||(Object(y.g)({items:[{action:"view",obj_no:t.id,obj_type:4}]}),this.$router.push("/artWorkDetail/"+t.id));else{if(this.checkGreen(t))return void this.$EventBus.$emit("openLoginDialog",{redirect:"/explore/detail/"+t.id});var l=this.list.findIndex((function(i){return i.id===t.id})),r=(l<10?this.list.slice(0,l):this.list.slice(l-10,l)).map((function(e){return e.id})).filter((function(e){return"banner"!=e&&"ai_tool"!=e}));Object(y.g)({items:[T(T({},this.dotReportInfo),{},{negative_ids:r,action:"view",obj_no:t.id,obj_type:1})]}),this.openWin?window.open("/explore/detail/"+t.id,"_blank"):this.$router.push("/explore/detail/"+t.id)}else 3==t.status||4==t.status?this.$router.push({path:"/models/detail/".concat(t.id),query:{type:"other"}}):this.$router.push("/models/detail/".concat(t.id))},imgError:function(e){e.errorTime++,e.errorTime>=2||(this.$refs[e.id][0].src=e.banner.url)},waterfall:function(){var e=this;try{this.heights=[];for(var t=function(){var t=e.dataList[i],n=t.waterHeight,o="artwork"==e.type?40:70;if(t.timeItem){t.left=0;var l=e.getMaxIndex(e.heights);t.top=l>-1?e.heights[l]+e.gap:0,e.heights.forEach((function(l,r){e.heights[r]=t.top+n+o}))}else if(e.heights.length<e.selfCols)if(e.dataList[i-1]&&e.dataList[i-1].timeItem)if(t.left=0,t.top=e.dataList[i-1].top+e.dataList[i-1].waterHeight+e.gap,e.heights[0]){var r=e.heights[0]+n;e.heights=[r+e.gap]}else e.heights.push(t.top+n+o);else t.top=e.dataList[i-1]?e.dataList[i-1].top:0,t.left=e.heights.length*(e.width+e.gap),e.heights.push(t.top+n+o);else{var c=e.getMinIndex(e.heights),d=e.heights[c]+e.gap;t.top=d,t.left=c*(e.width+e.gap),e.heights[c]=d+n+o}},i=0;i<this.dataList.length;i++)t();this.setWaterFallRect()}catch(e){}},getWidth:function(){var e,t;this.selfCols=this.cols;var n=this.containerForImg?this.containerForImg.offsetWidth:(null===(e=this.$parent.$refs[this.container])||void 0===e?void 0:e.offsetWidth)||(null===(t=document.querySelectorAll(".".concat(this.scrollContainerClassName,">.").concat(this.container))[0])||void 0===t?void 0:t.offsetWidth);n||(n=1236),n<1700&&(this.selfCols=6),n<1500&&(this.selfCols=5),n<1240&&(this.selfCols=5),n<980&&(this.selfCols=4),n<730&&(this.selfCols=4),n<500&&this.isPC&&(this.selfCols=1);var o=~~((n-this.selfCols*this.gap-this.gap+32)/this.selfCols);return this.isPC,o>176?o:176},setWaterFallRect:function(){var e=this.containerForImg||this.$parent.$refs[this.container]||document.querySelectorAll(".".concat(this.scrollContainerClassName,">.").concat(this.container))[0],t=Math.max.apply(null,this.heights);this.list.length&&(e.style.height=t+"px",e.style.marginBottom="130px")},getMinIndex:function(e){var t=Math.min.apply(null,e);return e.indexOf(t)},getMaxIndex:function(e){var t=Math.max.apply(null,e);return e.indexOf(t)},resize:function(e){var t=this;if(this.openWatch){var n,o;if(this.containerForImg){if(this.containerForImg.offsetWidth<600)return}else if((null===(n=this.$parent.$refs[this.container])||void 0===n?void 0:n.offsetWidth)<600||(null===(o=document.querySelectorAll(".".concat(this.scrollContainerClassName,">.").concat(this.container))[0])||void 0===o?void 0:o.offsetWidth)<600)return;this.dataList=v()(e).filter((function(e){return!t.WaterFallDeleteLits.includes(e.id)})),this.width=this.getWidth(),this.dataList.forEach((function(e){if(e.timeItem)e.waterWidth=t.width,e.waterHeight=30;else{var n,o;if(t.$set(e,"hoverd",!1),e.timeDiff=Object(f.c)(e.created_at,Date.now()),e.waterWidth=t.width,t.isTiemRow||"gallery"===t.type)e.waterHeight=t.width;else null!=e&&null!==(o=e.banner)&&void 0!==o&&o.width&&(e.waterHeight=parseInt(t.width/(e.banner.width/e.banner.height))),isNaN(e.waterHeight)&&(e.waterHeight=320);null!=e&&null!==(n=e.banner)&&void 0!==n&&n.replaceUrl&&(e.banner.replaceUrl=Object(d.x)(e.banner.url,t.imgQuality||"low")),e.errorTime=0}})),this.waterfall()}},lazyLoad:function(){this.actived&&this.openWatch},initials:function(e){return e.split(" ").map((function(e){return e[0]})).join("")},otherUser:function(e,t){var path=t?"/user/"+encodeURIComponent(e.author.id)+"?type=gather":"/user/"+encodeURIComponent(e.author.id);this.userInfo.id==e.author.id&&(path="/personal?tab=gather"),this.openWin?window.open(path,"_blank"):this.$router.push(path)},getPersonalInfoUrl:function(e){var path="/user/"+encodeURIComponent(e.author.id);return this.userInfo.id==e.author.id&&(path="/personal"),path},checkGreen:function(e){return!this.isLoggedIn&&!(null==e||!e.green||![2,"2"].includes(e.green))}})},L=(n(2354),n(2355),n(0)),component=Object(L.a)($,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"waterfall-container"},[e._l(e.renderList,(function(n,o){var l,r;return t("a",{key:n.top+","+n.left,staticClass:"waterfall-item",class:{"waterfall-dialog":e.containerForImg},style:{top:n.top+"px",left:n.left+"px"},attrs:{href:"model"===e.type?"/models/detail/"+n.id:"gallery"==e.type?"/artWorkDetail/"+n.id:"/explore/detail/"+n.id,target:"_blank"},on:{click:function(t){return t.preventDefault(),e.handleDetail(t,n)},contextmenu:function(t){return e.handleContextMenu(t,n)}}},[e.setDeffBoxShow(n)?t("div",{staticClass:"deffBox",style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}},[t("div",[e._v(e._s(e.$t("PictureInvalid")))]),e._v(" "),t("div",[t("i",{staticClass:"el-icon-warning-outline"}),e._v(" "),t("span",[e._v(e._s(e.$t("PictureHidden")))])]),e._v(" "),"collect"==e.fromPage?t("i",{staticClass:"iconfont",class:e.setCollectData(n),on:{click:function(t){t.preventDefault(),e.handleClick(n,"收藏","artwork"),e.setWaterFallDeleteLits(n.id),e.resizeListener()}}}):e._e(),e._v(" "),e.isCheck&&n?t("listCheckbox",{on:{change:function(t){return e.checkChange(n)}},model:{value:n.isCheck,callback:function(t){e.$set(n,"isCheck",t)},expression:"item.isCheck"}}):e._e()],1):n.timeItem?t("div",{staticClass:"timeRow",style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}},[e._v("\n      "+e._s(n.timeItem)+"\n    ")]):t("div",{staticClass:"listCnt marking-item",class:[1===n.banner.nsfw||e.isShowNsfw(n.banner)?"bg-nsfw":""]},[[2,"2"].includes(n.green)&&e.enableGreenMode?t("div",{staticClass:"green-mode-div",staticStyle:{"backdrop-filter":"blur(19px) saturate(160%)",position:"absolute",left:"0",top:"0"},style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}}):e._e(),e._v(" "),t("div",{staticClass:"img-content",style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}},[6==n.type&&1!=n.banner.nsfw?t("video",{ref:"mainVideo",refInFor:!0,staticClass:"cntVideo",attrs:{src:null===(l=n.banner)||void 0===l?void 0:l.url,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0}}):1!=n.banner.nsfw?t("el-image",{staticClass:"cntImg",style:{transform:n.isCheck?"scale(0.85)":null,filter:e.setNsfwPlus(n)?"blur(19px) saturate(160%)":""},attrs:{src:null===(r=n.banner)||void 0===r?void 0:r.replaceUrl,fit:"cover",lazy:""}},[t("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture-outline"})])]):e._e()],1),e._v(" "),3==n.status||4==n.status?t("div",{staticClass:"statusCnt"},[t("div",{staticClass:"statusZg"}),e._v(" "),t("div",{staticClass:"statusBox",style:{color:4==n.status?"#EF3B3B":"#ffffff"}},[t("i",{staticClass:"iconfont icon-statusBox"}),e._v(" "),t("div",[e._v(e._s(4==n.status?e.$t("notApproved"):e.$t("underReview")))])])]):e._e(),e._v(" "),e.isCheck&&n?t("listCheckbox",{on:{change:function(t){return e.checkChange(n)}},model:{value:n.isCheck,callback:function(t){e.$set(n,"isCheck",t)},expression:"item.isCheck"}}):t("div",[t("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"shade"},[t("p",[e._v(e._s(e.$t("NotPass"))+" "+e._s(e.$t("Auditing")))])]),e._v(" "),("artwork"==e.type?3!=n.type:1==n.status&&"gallery"!==e.type&&"activity"!==e.type)?t("div",{staticClass:"waterfall-hover-try",class:{"prompt-show":!e.isLoggedIn},on:{click:function(t){return t.preventDefault(),e.handleClick(n,"创作")}}},[e._v("\n          "+e._s("artwork"==e.type?e.$t("Remix"):e.$t("Try"))+"\n        ")]):e._e(),e._v(" "),e.isLoggedIn&&1==n.status&&"gallery"!==e.type&&"activity"!==e.type?t("CollectPopover",{staticClass:"CollectPop",attrs:{type:e.type,folder:n,dotReportInfo:e.collectDotReportInfo,from:"waterfall"},on:{showChaneg:e.changeItemShow}}):e._e(),e._v(" "),e.isLoggedIn&&1==n.status&&"gallery"!==e.type&&"activity"!==e.type?t("div",{staticClass:"cltpop",style:{opacity:e.itemShow&&e.itemShowId==n.id?1:0}}):e._e(),e._v(" "),"artwork"===e.type&&n.waterHeight>200?t("div",[t("div",{staticClass:"waterfall-hover-photo"},[t("div",{staticClass:"hoverTop"},[t("span",[e._v(e._s(n.type&&1!=n.type&&3!=n.type?"/grid":"/upscale"))]),e._v(" "),n?t("div",{staticClass:"moreEdit"},[e.isLoggedIn?[t("el-popover",{key:o,ref:"myPopover",refInFor:!0,attrs:{placement:"top-end","popper-class":"water-fall-popover","append-to-body":!1,"visible-arrow":!1,"popper-options":{boundariesElement:"body"},width:"100",trigger:"click"},model:{value:n.propS,callback:function(t){e.$set(n,"propS",t)},expression:"item.propS"}},[t("div",{staticClass:"pop-btns flex"},[t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("flag",n)}}},[e._v("\n                        "+e._s(e.$t("Report"))+"\n                      ")]),e._v(" "),t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("save",n)}}},[e._v("\n                        "+e._s(e.$t("SaveImage"))+"\n                      ")]),e._v(" "),t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("share",n)}}},[e._v("\n                        "+e._s(e.$t("ShareLink"))+"\n                      ")]),e._v(" "),!e.dislikeShow||n.author&&n.author.id==e.userInfo.id?e._e():t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("not_interested",n)}}},[e._v("\n                        "+e._s(e.$t("dislike"))+"\n                      ")]),e._v(" "),n.author&&n.author.id==e.userInfo.id&&n.banner.a_a?t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("appeal",n)}}},[e._v("\n                        "+e._s(e.$t("appeal"))+"\n                      ")]):e._e(),e._v(" "),n.author&&n.author.id==e.userInfo.id?t("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("delete",n)}}},[e._v("\n                        "+e._s(e.$t("Delete"))+"\n                      ")]):e._e()]),e._v(" "),t("div",{class:{"login-waterFall-btn-icon":e.isLoggedIn,"noLogin-waterFall-collect-icon prompt-show":!e.isLoggedIn},attrs:{slot:"reference"},slot:"reference"},[t("i",{staticClass:"iconfont icon-more"})])])]:e._e()],2):e._e()]),e._v(" "),3!=n.type?t("div",{staticClass:"hoverMiddle"},[e._v("\n              "+e._s(n.prompt)+"\n            ")]):e._e()])]):e._e(),e._v(" "),"model"===e.type&&n.base_model.includes("SDXL")?t("div",{staticClass:"modelPoint"},[e._v("\n          "+e._s((null==n?void 0:n.type)+" | XL ")+"\n        ")]):"model"===e.type?t("div",{staticClass:"modelPoint"},[e._v(e._s(null==n?void 0:n.type))]):e._e()],1),e._v(" "),"activity"===e.type?t("div",{staticClass:"activity",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.goToDetail(n)}}},[n.name?t("div",{staticClass:"top-container"},[t("div",{staticClass:"name"},[e._v(e._s(n.name))])]):e._e(),e._v(" "),t("div",{staticClass:"personal-info"},[t("div",{staticClass:"left-info",style:{width:n.name?"100%":"calc(100% - 68px)"}},[n.author.head?t("img",{staticClass:"avatorClass",attrs:{decoding:"async",loading:"lazy",src:n.author.head,alt:""},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.goToPersonal(n)}}}):t("div",{staticClass:"avatorClass",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.goToPersonal(n)}}},[e._v("\n              "+e._s(e.initials(n.author.name||n.author.id))+"\n            ")]),e._v(" "),t("span",{staticClass:"ellipsis-text",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.goToPersonal(n)}}},[e._v("\n              "+e._s(n.author.name||n.author.id)+"\n            ")])])])]):e._e()],1),e._v(" "),"model"===e.type?t("div",{staticClass:"waterfall-hover-model"},[t("span",{staticClass:"ellipsis-text modelName"},[e._v(e._s(n.name))]),e._v(" "),t("div",{staticClass:"hoverBottom"},[n.author?t("div",{staticClass:"flex-center",staticStyle:{"max-width":"50%"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.otherUser(n)}}},[n.author.head?t("img",{staticClass:"avatorClass",attrs:{decoding:"async",loading:"lazy",src:n.author.head,alt:""}}):n.author?t("div",{staticClass:"avatorClass"},[e._v("\n            "+e._s(e.initials(n.author.name||n.author.id))+"\n          ")]):e._e(),e._v(" "),t("span",{staticClass:"ellipsis-text"},[e._v(e._s(n.author.name))])]):t("div"),e._v(" "),1==n.status?t("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center"}}):e._e()])]):e._e(),e._v(" "),"artwork"===e.type?t("div",{staticClass:"workInfo"},[n.author?t("div",{staticClass:"flex-center flex-center-image",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.otherUser(n)}}},[n.author.head?t("img",{staticClass:"avatorClass",attrs:{decoding:"async",loading:"lazy",src:n.author.head,alt:""}}):t("div",{staticClass:"avatorClass"},[e._v("\n          "+e._s(e.initials(n.author.name||n.author.id))+"\n        ")]),e._v(" "),t("span",{staticClass:"ellipsis-text",style:{"max-width":e.containerForImg?"3rem":""}},[e._v(e._s(n.author.name||n.author.id))])]):t("div"),e._v(" "),t("div",{staticClass:"numInfo",class:{"hover-show":e.hoverShow}})]):e._e()])})),e._v(" "),e.isShowNullRelatedImg?t("div",{staticClass:"null-data-container"},[t("img",{staticClass:"null-image",attrs:{src:n(289),alt:"null_related_image"},on:{load:function(t){return e.$emit("solveScrollbarStyle")}}}),e._v(" "),t("div",{staticClass:"null-tips"},[e._v(e._s(e.$t("NoRelatedWorks")))])]):e._e(),e._v(" "),e.alreadyNoMoreData?t("div",{staticClass:"at-bottom"},[t("div",{staticClass:"dashed-line"}),e._v(" "),t("div",{staticClass:"tips"},[e._v(e._s(e.$t("NoMoreData")))]),e._v(" "),t("div",{staticClass:"dashed-line"})]):e._e(),e._v(" "),e.noSearchData?t("div",{staticClass:"no-search-data-container"},[t("img",{staticClass:"no-search-image",attrs:{src:n(290),alt:"no search data"}}),e._v(" "),t("div",{staticClass:"null-tips"},[e._v(e._s(e.$t("NoSearchData")))])]):e._e(),e._v(" "),t("el-dialog",{attrs:{title:e.$t("appeal"),visible:e.appealShow,width:"500px","modal-append-to-body":!1,"close-on-click-modal":!1,"custom-class":"SaDialog"},on:{"update:visible":function(t){e.appealShow=t}}},[t("div",{staticClass:"appealCnt"},[t("el-input",{attrs:{type:"textarea",placeholder:e.$t("enterAppealCnt"),maxlength:"50","show-word-limit":""},model:{value:e.appeaData.remark,callback:function(t){e.$set(e.appeaData,"remark",t)},expression:"appeaData.remark"}})],1),e._v(" "),t("div",{staticClass:"bntitem",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.appealShow=!1}}},[e._v(e._s(e.$t("Cancel")))]),e._v(" "),t("el-button",{attrs:{loading:e.isAppealLoading},on:{click:function(t){return e.setResourceAppeal(e.appeaData)}}},[e._v(e._s(e.$t("Submit")))])],1)])],2)}),[],!1,null,"3a2dae53",null);t.a=component.exports},56:function(e,t,n){"use strict";n(14),n(9),n(11),n(12),n(8);var o=n(2),l=(n(7),n(10),n(4),n(18),n(6),n(21)),r=n(5),c=n(33),d=n(214),h=n(1),m=n(35),v=n.n(m),f=(n(30),n(40));function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w={mixins:[c.a],components:{CollectionCreate:d.a},props:{folder:{type:Object,default:function(){return{}}},type:{type:String,default:"artwork"},hideBtn:{type:Boolean,default:!1},triggerMode:{type:String,default:"click"},from:{type:String,default:""},dotReportInfo:{type:Object,default:function(){return{view_domain:"",batch_id:"",action:"",obj_no:"",obj_type:1,negative_ids:[],category:"default"}}}},data:function(){return{visible:!1,folderlist:[],keyword:"",folderCollectList:{artwork:[],model:[],post:[]},createShow:!1,onloading:!1,isLoding:!1,replaceImageType:r.x,collectTagList:[],typeKeys:{artwork:1,model:2,gallery:3,lookbook:3,palette:4,workflow:5,swtft_app:6,character:7,ai_video:15,ai_audio:9}}},computed:y(y(y({},Object(h.c)("user",["folderCollect","isLoggedIn"])),Object(h.e)("user",["userInfo","collectData"])),{},{setFolderName:function(){var e,t=this,n=this.collectData,o=function(e){var n=e&&e.collect?e.collect.collection_name:t.$t("collectCreate2");return"default"==n?t.$t("UnorganizedIdeas"):n||t.$t("UnorganizedIdeas")};return n&&n.ids&&n.ids.includes(null===(e=this.folder)||void 0===e?void 0:e.id)?o(n):o(this.folder)},filteredList:function(){var e,t=this;return null===(e=this.folderlist)||void 0===e?void 0:e.filter((function(e){return e.name.includes(t.keyword)&&"all"!=e.id&&"default"!=e.id&&e.id!==(t.folder.collect&&t.folder.collect.collection_id)}))}}),watch:{visible:{handler:function(e){e&&this.isLoggedIn&&("artwork"==this.type&&this.$logEvent("log_actions",{operation:"quick_collect",behavior_info:"favorites_pop",behavior_info_sub:this.folder.id}),this.folderCollectList=v()(this.folderCollect),this.onloading=!0,this.getCollectionList(),this.getCollectTagList()),e||this.$emit("closeMask")}}},methods:y(y({},Object(h.d)("user",["SET_FOLDER_COLLECT"])),{},{getCollectTagList:function(){var e,t=this,n={};console.log("this.type",this.type),n.obj_type={artwork:1,model:2,gallery:4,lookbook:5,character:9,palette:11,workflow:13,swtft_app:13,ai_video:15,ai_audio:16}[this.type]||"",n.obj_id=null===(e=this.folder)||void 0===e?void 0:e.id,Object(f.getCollectTagList)(n).then((function(e){var n,o,l;e&&1e4!==(null==e||null===(n=e.status)||void 0===n?void 0:n.code)||(t.collectTagList=Array.isArray(null==e||null===(o=e.data)||void 0===o?void 0:o.items)?null==e||null===(l=e.data)||void 0===l?void 0:l.items:[])})).finally((function(){}))},handleFastCreate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.createShow=!0;try{this.$refs.collectionCreate.formData.name=e.title||""}catch(e){}},handleShow:function(){this.$emit("showChaneg",{show:!0,id:this.folder.id})},newCreate:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.visible=!1,["",null,void 0].includes(null==data?void 0:data.name)||this.$message.success(this.$t("collectCreate4",{name:null==data?void 0:data.name})),this.$emit("newCreate")},getCollectionList:function(){var e=this,t={type:this.typeKeys[this.type]};Object(l.B)(t).then((function(t){var n;e.onloading=!1;var o=v()(t.data.items);o.forEach((function(element){element.imgList=[];var t={artwork:"artwork_items",model:"model_items",post:"post_items",palette:"tpl_items",comfy:"comfy_ui_items"},n=element[t[e.type]]?element[t[e.type]]:null;if(n){var o={url:1==n.status&&(2==n.primary||n.account_no==e.userInfo.id)&&n.banner&&n.banner.url?n.banner.url:null,nsfw:n.nsfw,id:n.id};element.imgList.push(o)}})),e.folderlist=o,e.folderCollectList[e.type]=(null===(n=e.folderCollectList[e.type])||void 0===n?void 0:n.filter((function(t){return e.folderlist.some((function(e){return t.id===e.id}))})))||[],e.folderCollectList[e.type].forEach((function(element){e.folderlist.forEach((function(e){element.id==e.id&&(element.imgList=e.imgList)}))}))}))},collect:function(e){var t=this;"artwork"==this.type&&this.$logEvent("log_actions",{operation:"quick_collect",behavior_info:"click_join_favorites",behavior_info_sub:this.folder.id});var n=e||null;this.isLoding=!0,this.addFavorite(this.folder,this.type,n,(function(o){if(n){var l=t.folderCollectList;l[t.type][0]&&n.id==l[t.type][0].id||l[t.type].unshift(n),l[t.type].length>2&&l[t.type].pop(),["",null,void 0].includes(null==e?void 0:e.name)||t.$message.success(t.$t("collectCreate4",{name:null==e?void 0:e.name})),t.SET_FOLDER_COLLECT(l)}t.$emit("onCollectionOk",o),t.isLoding=!1,t.visible=!1}),(function(e){t.isLoding=!1}),!0)}})},C=w,k=(n(2303),n(2304),n(0)),component=Object(k.a)(C,(function(){var e,t=this,n=t._self._c;return n("el-popover",{attrs:{placement:"bottom-start",width:"360","popper-class":"CollectPopover ".concat(t.createShow?"display_none":""),"visible-arrow":!1,title:t.$t("Collect"),trigger:t.triggerMode},on:{"after-enter":t.handleShow,hide:function(e){return t.$emit("showChaneg",{show:!1,id:t.folder.id})}},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[n("div",{staticClass:"cltpop-cent"},[n("div",{staticStyle:{padding:"0 10px"}},[n("div",{staticClass:"search"},[n("i",{staticClass:"iconfont icon-folder-search"}),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],attrs:{type:"text",placeholder:t.$t("Search")},domProps:{value:t.keyword},on:{input:function(e){e.target.composing||(t.keyword=e.target.value)}}})]),t._v(" "),t.onloading?n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.onloading,expression:"onloading"}],staticClass:"loadbox"}):t._e(),t._v(" "),n("div",{staticClass:"list"},[n("div",{directives:[{name:"show",rawName:"v-show",value:0==t.keyword.length,expression:"keyword.length == 0"}]},[n("div",{staticClass:"title"},[t._v(t._s(t.$t("collectCreate2")))]),t._v(" "),n("div",{staticClass:"itembox",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.collect()}}},[n("div",{staticClass:"itemboxinfo"},[n("div",{staticClass:"itemboxinfoleft"},[n("i",{staticClass:"iconfont icon-deff-mycollect"})]),t._v(" "),n("span",[t._v(t._s(t.$t("UnorganizedIdeas")))])]),t._v(" "),n("el-button",{attrs:{loading:t.isLoding}},[t._v(t._s(t.$t("Collect")))])],1)]),t._v(" "),n("div",{staticClass:"title"},[t._v(t._s(t.$t("myfolder")))]),t._v(" "),t._l(t.filteredList,(function(e,o){return n("div",{key:o,staticClass:"itembox",on:{click:function(n){return n.stopPropagation(),n.preventDefault(),t.collect(e)}}},[n("div",{staticClass:"itemboxinfo"},[n("div",{staticClass:"itemboxinfoleft"},[e.imgList&&e.imgList[0]&&e.imgList[0].url?n("img",{attrs:{decoding:"async",loading:"lazy",src:t.replaceImageType(e.imgList[0].url,"high")}}):n("i",{staticClass:"iconfont icon-deff-collect"})]),t._v(" "),n("span",[t._v(t._s(e.name))])]),t._v(" "),n("el-button",{attrs:{loading:t.isLoding}},[t._v(t._s(t.$t("Collect")))])],1)})),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:null===(e=t.collectTagList)||void 0===e?void 0:e.length,expression:"collectTagList?.length"}],staticClass:"title"},[t._v(t._s(t.$t("Recommend")))]),t._v(" "),t._l(t.collectTagList,(function(e,o){var l;return n("div",{directives:[{name:"show",rawName:"v-show",value:null===(l=t.collectTagList)||void 0===l?void 0:l.length,expression:"collectTagList?.length"}],key:"recommend_".concat(o),staticClass:"itembox",on:{click:function(n){return n.stopPropagation(),n.preventDefault(),t.handleFastCreate(e)}}},[n("div",{staticClass:"itemboxinfo"},[n("div",{staticClass:"itemboxinfoleft"},[e.cover?n("img",{attrs:{decoding:"async",loading:"lazy",src:t.replaceImageType(e.cover,"high")}}):n("i",{staticClass:"iconfont icon-deff-collect"})]),t._v(" "),n("span",[t._v(t._s(e.title))])]),t._v(" "),n("el-button",{attrs:{loading:t.isLoding}},[t._v(t._s(t.$t("Create")))])],1)}))],2)]),t._v(" "),n("div",{staticClass:"create"},[n("div",{staticClass:"itembox",on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.createShow=!0}}},[n("div",{staticClass:"itemboxinfo"},[n("div",{staticClass:"itemboxinfoleft"},[n("i",{staticClass:"el-icon-plus"})]),t._v(" "),n("span",[t._v(t._s(t.$t("collectBox1")))])])])])]),t._v(" "),t.hideBtn?t._t("default",null,{slot:"reference"}):n("div",{staticClass:"bnt",attrs:{slot:"reference"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),function(){}.apply(null,arguments)}},slot:"reference"},[n("div",{attrs:{title:t.setFolderName}},[t._v(t._s(t.setFolderName))]),t._v(" "),n("i",{staticClass:"el-icon-arrow-down",style:{transform:t.visible?"rotate(180deg)":null}})]),t._v(" "),n("collection-create",{ref:"collectionCreate",attrs:{dataToCollect:t.folder,type:t.type},on:{create:t.newCreate,closeMask:function(e){return t.$emit("closeMask")}},model:{value:t.createShow,callback:function(e){t.createShow=e},expression:"createShow"}})],2)}),[],!1,null,"624a665c",null);t.a=component.exports},562:function(e,t,n){"use strict";n(7),n(10),n(14),n(4),n(9),n(11),n(12),n(8);var o=n(15),l=n(2),r=(n(16),n(18),n(6),n(21)),c=n(5),d=n(214),h=n(127),m=n(40),v=n(41),f=n(1),_=n(33),y=n(524),w=n(55),C=n(139),k=n(39);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I={mixins:[_.a],name:"CollectionBookmarks",components:{CollectionCreate:d.a,WaterFallVue:h.a,EditTitle:y.a,homeList:w.a,NoData:C.a},props:{isOpen:{type:Boolean,default:!0},type:{type:String,default:"artwork"},account_no:{type:String,default:""},category:{type:Boolean,default:!0},wraperShow:{type:Boolean,default:!0}},computed:x(x(x(x({},Object(f.e)("user",["userInfo"])),Object(f.c)("user",["isLoggedIn"])),Object(f.e)("app",["topBanner"])),{},{getThreshold:function(){return this.topBanner?108:62},shutterOffset:function(){return function(e){return"-"+12*(5-e)}},isNoData:function(){return this.getReady&&0==this.list.length}}),data:function(){return{formatTime:k.b,noSearchData:!1,collectionList:[],createShow:!1,isTiemRow:!1,replaceImageType:c.x,filterImgType:[],checkMaxNum:-1,isFilterNSFW:!1,queryParam:{page:1,page_size:35,type:"bookmarks",order_by:"new",folder_no:"default",keyword:"",start_at:0,end_at:0,after:0,artwork_types:[]},formData:{type:""},list:[],isLoading:!0,isLock:!1,isReq:!1,isCheck:!1,editData:{},checkList:{},dotReportInfo:{category:"default",view_domain:"personal_center",batch_id:""},listDef:!1,getReady:!1}},watch:{type:{handler:function(e){this.intData()}},category:{handler:function(e){this.intData()}}},mounted:function(){this.intData()},activated:function(){this.list=Object(o.a)(this.list)},methods:{onChangeTitleBar:function(e){this.editSuccess(),this.$refs.WaterFallVue.isCheckAll=!1;var t=e.workType,n=e.searchKeyword,o=e.start_at,l=e.end_at,r=e.order_by,c=e.publish_status;t&&(this.queryParam.artwork_types=t),![void 0,void 0,null].includes(n)&&(this.queryParam.keyword=n),!["",void 0,void 0,null].includes(o)&&(this.queryParam.start_at=o),!["",void 0,void 0,null].includes(l)&&(this.queryParam.end_at=l),r&&(this.queryParam.order_by=r),!["",void 0,void 0,null].includes(c)&&(this.queryParam.publish_status=c),delete this.queryParam.time_to,this.list=[],this.isLock=!1,this.isReq=!1,this.queryParam.after=0,this.queryParam.page=1,this.getList()},checkAll:function(){this.$refs.WaterFallVue.checkAll()},getChecList:function(e){this.checkList=e},onEdit:function(e){"{}"===JSON.stringify(e)&&e.constructor===Object&&this.$logEvent("log_actions",{operation:"click_new_collection",behavior_info:"on_personal_center"}),this.editData=e,this.createShow=!0},editSuccess:function(){if(this.checkList.ids){var e=Object(o.a)(this.checkList.ids);this.$refs.WaterFallVue.clearCheck(e),this.queryParam.page=1}},intData:function(){this.queryParam.page=1,delete this.queryParam.time_to,this.list=[],this.isLock=!1,this.isReq=!1,this.queryParam.after=0,this.collectionList=[],this.$refs.editTitle&&(this.$refs.editTitle.isCheck=!1),this.getList(),this.getCollectionList()},getCollectionList:function(){var e=this;this.formData={type:{artwork:1,model:2,post:3,palette:4,workflow:5,swtft_app:6,character:7,ai_audio:9}[this.type]},this.account_no?this.formData.other_id=this.account_no:delete this.formData.other_id,this.category?this.formData.category=2:delete this.formData.category,Object(r.A)(this.formData).then((function(t){var n=t.data.items||[];n.forEach((function(element){if(1e4===t.status.code){element.imgList=[];var n={artwork:"artwork_items",model:"model_items",post:"post_items",palette:"tpl_items",workflow:"comfy_ui_items",swtft_app:"comfy_ui_items",character:"character_items",ai_audio:"timbre_items"},o=element[n[e.type]]?element[n[e.type]]:null;o&&o.forEach((function(t){var n={url:1==t.status&&(2==t.primary||t.account_no==e.userInfo.id)&&t.banner&&t.banner.url?t.banner.url:null,nsfw:t.nsfw,id:t.id};element.imgList.push(n)}))}})),e.collectionList=n,e.account_no&&0==e.collectionList.length?e.listDef=!0:e.listDef=!1}))},getList:function(e){var t=this;if(!this.isReq&&!this.isLock){this.isLoading=!0,this.isReq=!0,this.queryParam.type="bookmarks",delete this.queryParam.source_type,this.account_no?this.queryParam.account_no=this.account_no:delete this.queryParam.account_no,this.category?this.queryParam.category=2:delete this.queryParam.category;var n="";"artwork"==this.type?n=m.artworkList:"model"==this.type?n=this.account_no?v.s:v.r:"post"==this.type?(delete this.queryParam.type,this.account_no&&(this.queryParam.act_id=this.account_no),n=r.Y):"palette"==this.type?(n=r.Q,this.account_no&&(this.queryParam.act_id=this.account_no)):"swtft_app"==this.type||"workflow"==this.type?(n=r.q,this.queryParam.source_type=7,"swtft_app"==this.type&&(this.queryParam.source_type=8),this.account_no&&(this.queryParam.act_id=this.account_no)):"character"==this.type?(this.queryParam.type=0,n=r.e):"ai_audio"==this.type&&(this.queryParam.type=0,n=r.b),n(this.queryParam).then((function(n){if(n.status&&150002===n.status.code)t.noSearchData=!0;else{if(t.noSearchData=!1,n.data.has_more?t.isLock=!1:t.isLock=!0,t.list=e?t.list.concat(n.data.items||[]):n.data.items||[],t.isReq=!1,1===t.queryParam.page&&(t.queryParam.time_to=n.data.time_ms),n.data.items.length>0){var o,l,r=n.data.items[n.data.items.length-1];t.queryParam.after=(null==r||null===(o=r.folder_no)||void 0===o?void 0:o.collect_at)||(null==r||null===(l=r.collect)||void 0===l?void 0:l.collect_at)}t.$emit("getlistbanner",t.list),t.queryParam.page++,t.isLoading=!1}})).catch((function(e){var code=e.code;t.noSearchData=150002===code,t.isReq=!1,t.isLoading=!1})).finally((function(){t.getReady=!0}))}}}},O=(n(2490),n(0)),component=Object(O.a)(I,(function(){var e,t=this,o=t._self._c;return o("div",{staticClass:"CollectionBookmarks"},[o("div",{staticClass:"main"},[o("div",{staticClass:"collection"},[null!==(e=t.collectionList)&&void 0!==e&&e.length?o("div",{staticClass:"folder-title"},[o("div",{staticClass:"name"},[t._v("\n            "+t._s(t.$t(t.category?"portfolio":"Favorites"))+"\n            "),o("i",{staticClass:"el-icon-arrow-right"})]),t._v(" "),t.account_no?t._e():o("div",{staticClass:"create-btn flex-center",on:{click:function(e){return t.onEdit({})}}},[o("i",{staticClass:"el-icon-folder-add"}),t._v("\n            "+t._s(t.$t(t.category?"AddPortfolio":"AddFavorite"))+"\n          ")])]):t._e(),t._v(" "),t._l(this.collectionList.filter((function(i){return"default"!=i.id})),(function(e,l){return o("div",{key:l,staticClass:"collectionlist",on:{click:function(n){return t.$router.push({path:"/collectiondetail",query:{type:t.type,id:e.id,name:e.name,account_no:t.account_no?t.account_no:null,category:t.category?2:null}})}}},[o("div",{staticClass:"listItem"},["all"==e.id?o("div",{staticClass:"imgs"},t._l(5,(function(l,r){return o("div",{key:r,staticClass:"imgsitem",style:{transform:"translateX("+t.shutterOffset(l)+"%)",zIndex:5-l}},[e.imgList&&e.imgList[r]&&e.imgList[r].url?o("img",{staticClass:"imgslist",attrs:{decoding:"async",loading:"lazy",src:1==e.imgList[r].nsfw?n(171):t.replaceImageType(e.imgList[r].url,"low")}}):t._e()])})),0):o("div",{staticClass:"imgs"},[t._l(3,(function(l,r){return o("div",{key:r,staticClass:"myimgsitem"},[e.imgList&&e.imgList[r]&&e.imgList[r].url?o("img",{attrs:{decoding:"async",loading:"lazy",src:1==e.imgList[r].nsfw?n(171):t.replaceImageType(e.imgList[r].url,"low")}}):t._e()])})),t._v(" "),t.account_no?t._e():o("div",{staticClass:"edit",on:{click:function(n){return n.stopPropagation(),t.onEdit(e)}}},[o("i",{staticClass:"iconfont icon-icon-edit1"})])],2),t._v(" "),o("div",{staticClass:"infos"},[o("div",{staticClass:"name"},[o("span",[t._v(t._s(0!=l||t.account_no?e.name:t.category?t.$t("AllWorks"):t.$t("Allcollect")))]),t._v(" "),2==e.status?o("i",{staticClass:"iconfont icon-collectLock"}):t._e()]),t._v(" "),o("div",{staticClass:"count-time"},[o("div",{staticClass:"count"},[t._v(t._s(t.$t("NumContent",{num:(null==e?void 0:e.count)||0})))]),t._v(" "),o("div",{staticClass:"time"},[t._v(t._s(t.formatTime(null==e?void 0:e.update_at)))])])])])])}))],2),t._v(" "),t.wraperShow?o("EditTitle",{ref:"editTitle",attrs:{editShow:!t.account_no,title:t.category?t.$t("UnorganizedWorks"):t.$t("UnorganizedIdeas"),checkList:t.checkList,listLenth:t.account_no?t.list.length:t.category?t.setPortfolioList(t.list,"default").length:t.setCollectList(t.list,"default").length,threshold:t.getThreshold,titleSize:20,account_no:t.account_no,isOpen:t.isOpen,category:t.category,type:t.type,isScreen:t.category},on:{changeCheck:function(e){t.isCheck=e},checkAll:t.checkAll,editSuccess:function(e){return t.editSuccess()},changeTitleBar:t.onChangeTitleBar,newCreate:function(e){return t.getCollectionList()},changeTiemRow:function(e){return t.isTiemRow=e},ImgTypeChange:function(e){t.filterImgType=e,e.length>0?t.isFilterNSFW=!0:t.isFilterNSFW=!1,e.length>0?t.checkMaxNum=20:t.checkMaxNum=-1}}}):t._e(),t._v(" "),t.wraperShow?o("div",{ref:"wraper",staticClass:"wraper"},[["post","palette","swtft_app","workflow","character","ai_audio"].includes(t.type)?o("homeList",{ref:"WaterFallVue",attrs:{fromPage:"userPage",isOpen:t.isOpen,list:t.account_no?t.list:t.setCollectList(t.list,"default"),container:"wraper",dotReportInfo:t.dotReportInfo,isTiemRow:t.isTiemRow,isCheck:t.isCheck,cols:"swtft_app"==t.type||"workflow"==t.type?5:7},on:{load:function(e){return t.getList(!0)},getChecList:t.getChecList}}):o("WaterFallVue",{ref:"WaterFallVue",attrs:{noSearchData:t.noSearchData,fromPage:"userPage",type:"artwork"==t.type?"artwork":"model",container:"wraper",list:t.account_no?t.list:t.category?t.setPortfolioList(t.list,"default"):t.setCollectList(t.list,"default"),lazy:!0,isTiemRow:t.isTiemRow,isCheck:t.isCheck,category:t.category,alreadyNoMoreData:t.isLock&&t.list.length>0,dotReportInfo:t.dotReportInfo,filterImgType:t.filterImgType,isFilterNSFW:t.isFilterNSFW,checkMax:t.checkMaxNum,needGridSource:!0},on:{load:function(e){return t.getList(!0)},getChecList:t.getChecList,newCreate:function(e){return t.getCollectionList()}}})],1):t._e(),t._v(" "),t.isNoData&&t.listDef?o("NoData"):t._e()],1),t._v(" "),o("collection-create",{attrs:{editData:t.editData,category:t.category,type:t.type},on:{create:function(e){return t.getCollectionList()},delete:function(e){return t.getCollectionList()}},model:{value:t.createShow,callback:function(e){t.createShow=e},expression:"createShow"}})],1)}),[],!1,null,"2e148226",null);t.a=component.exports},91:function(e,t,n){"use strict";n(4);var o={name:"commonConfirmModal",data:function(){return{visible:!1,options:null,resolve:null,reject:null,fromPage:"",notNotice:!1,btnStyle:""}},methods:{show:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.resetData(),this.options=t,this.visible=!0,this.btnStyle=(null==t?void 0:t.btnStyle)||"",this.fromPage=(null==t?void 0:t.fromPage)||"",new Promise((function(t,n){e.resolve=t,e.reject=n}))},resetData:function(){this.options=null,this.resolve=null,this.reject=null,this.fromPage="",this.notNotice=!1},handleClose:function(){if(this.visible=!1,this.handleNotNoticeStatus(),this.reject)return this.reject(!1)},handleNotNoticeStatus:function(){"modelPreset"===this.fromPage&&this.notNotice&&(this.$store.dispatch("user/recordEnableUsePresetNotNotice"),localStorage.setItem("presetModelNotTips",this.notNotice?1:2))},handleConfirm:function(){if(this.visible=!1,this.handleNotNoticeStatus(),this.resolve)return this.resolve(!0)}}},l=o,r=(n(2940),n(0)),component=Object(r.a)(l,(function(){var e,t,n=this,o=n._self._c;return o("el-dialog",{attrs:{visible:n.visible,"custom-class":"easy-common-confirm-modal custom-dialog","destroy-on-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,modal:!0,"modal-append-to-body":"","append-to-body":"",width:"407px"},on:{"update:visible":function(e){n.visible=e}}},[o("div",{staticClass:"easy-select-model-confirm-modal-header"},[o("div",{staticClass:"modal-header-title"},[n._v(n._s(n.$t("Tip")))]),n._v(" "),o("span",{staticClass:"modal-header-close",on:{click:function(e){return e.stopPropagation(),n.handleClose()}}},[o("i",{staticClass:"el-icon-close"})])]),n._v(" "),o("div",{staticClass:"easy-select-model-confirm-modal-content"},[o("div",{staticClass:"modal-content-left"},[o("div",{staticClass:"warning-icon-box"},[o("i",{staticClass:"iconfont icon-warn"})])]),n._v(" "),o("div",{staticClass:"modal-content-right"},[o("div",{staticClass:"modal-content-right-title"},[n._v(n._s(n.$t("newGenerate38")))]),n._v(" "),n.options&&null!==(e=n.options)&&void 0!==e&&e.subTitle?o("div",{staticClass:"modal-content-right-sub-title"},[n._v(n._s(n.$t(null===(t=n.options)||void 0===t?void 0:t.subTitle)))]):n._e(),n._v(" "),"modelPreset"===n.fromPage?[o("div",{staticClass:"modal-content-no-notice-check"},[o("el-checkbox",{staticClass:"presets-model-option-checkbox",model:{value:n.notNotice,callback:function(e){n.notNotice=e},expression:"notNotice"}},[n._v("\n            "+n._s(n.$t("teach_video_tips"))+"\n          ")])],1)]:n._e()],2)]),n._v(" "),o("div",{staticClass:"easy-select-model-confirm-modal-footer"},[o("span",{staticClass:"modal-footer-btn",on:{click:function(e){return e.stopPropagation(),n.handleClose()}}},[n._v(n._s(n.$t("Cancel")))]),n._v(" "),o("span",{staticClass:"modal-footer-btn modal-footer-btn-confirm",style:n.btnStyle,on:{click:function(e){return e.stopPropagation(),n.handleConfirm()}}},[n._v(n._s(n.$t("Confirm")))])])])}),[],!1,null,null,null);t.a=component.exports},928:function(e,t,n){e.exports={}},929:function(e,t,n){e.exports={}},968:function(e,t,n){e.exports={}},969:function(e,t,n){e.exports={}},970:function(e,t,n){e.exports={}},971:function(e,t,n){e.exports={}},973:function(e,t,n){e.exports={}}}]);