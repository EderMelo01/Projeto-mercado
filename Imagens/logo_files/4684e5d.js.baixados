(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1004:function(t,e,n){t.exports={}},1042:function(t,e,n){t.exports={}},1043:function(t,e,n){t.exports={}},1044:function(t,e,n){t.exports={}},1045:function(t,e,n){t.exports={}},1046:function(t,e,n){t.exports={}},1047:function(t,e,n){t.exports={}},1049:function(t,e,n){t.exports={}},1050:function(t,e,n){t.exports={}},1053:function(t,e,n){t.exports={}},1054:function(t,e,n){t.exports={}},1074:function(t,e,n){t.exports={}},1161:function(t,e,n){t.exports={}},1195:function(t,e,n){t.exports={}},1196:function(t,e,n){t.exports={}},1197:function(t,e,n){t.exports={}},1199:function(t,e,n){t.exports={}},1200:function(t,e,n){t.exports={}},1201:function(t,e,n){t.exports={}},1202:function(t,e,n){t.exports={}},1203:function(t,e,n){t.exports={}},1208:function(t,e,n){t.exports={}},1209:function(t,e,n){t.exports={}},1212:function(t,e,n){t.exports={}},1217:function(t,e,n){t.exports={}},1218:function(t,e,n){t.exports={}},1219:function(t,e,n){t.exports={}},1220:function(t,e,n){t.exports={}},1221:function(t,e,n){t.exports={}},1222:function(t,e,n){t.exports={}},1223:function(t,e,n){t.exports={}},1224:function(t,e,n){t.exports={}},1225:function(t,e,n){t.exports={}},1226:function(t,e,n){t.exports={}},1227:function(t,e,n){t.exports={}},1228:function(t,e,n){t.exports={}},1229:function(t,e,n){t.exports={}},1274:function(t,e,n){t.exports={}},1322:function(t,e,n){t.exports={}},1323:function(t,e,n){t.exports={}},1330:function(t,e,n){t.exports={}},1331:function(t,e,n){t.exports={}},1336:function(t,e,n){t.exports={}},1337:function(t,e,n){t.exports={}},1339:function(t,e,n){t.exports={}},1340:function(t,e,n){t.exports={}},1341:function(t,e,n){t.exports={}},1342:function(t,e,n){t.exports={}},1343:function(t,e,n){t.exports={}},1344:function(t,e,n){t.exports={}},1345:function(t,e,n){t.exports={}},1346:function(t,e,n){t.exports={}},1347:function(t,e,n){t.exports={}},1348:function(t,e,n){t.exports={}},1349:function(t,e,n){t.exports={}},1350:function(t,e,n){t.exports={}},1351:function(t,e,n){t.exports={}},1352:function(t,e,n){t.exports={}},1353:function(t,e,n){t.exports={}},1354:function(t,e,n){t.exports={}},1355:function(t,e,n){t.exports={}},1356:function(t,e,n){t.exports={}},1357:function(t,e,n){t.exports={}},1358:function(t,e,n){t.exports={}},1359:function(t,e,n){t.exports={}},136:function(t,e,n){"use strict";var o={name:"auditConfirmDialog",props:{},computed:{},data:function(){return{dialogVisible:!1,isAgree:!1,confirmCallback:null}},mounted:function(){},methods:{showDialog:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.dialogVisible=!0,this.isAgree=!1,this.confirmCallback=t},close:function(){this.dialogVisible=!1},handleConfirm:function(){this.isAgree&&(this.confirmCallback&&"function"==typeof this.confirmCallback&&this.confirmCallback(!1),this.$emit("confirm")),this.close()}}},r=o,l=(n(2383),n(2384),n(0)),component=Object(l.a)(r,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"audit-dialog custom-dialog-canvas",attrs:{title:t.$t("Tip"),visible:t.dialogVisible,"modal-append-to-body":!0,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e},close:t.close}},[e("div",{staticClass:"audit-content flex"},[e("div",{staticClass:"audit-icon flex-center"},[e("i",{staticClass:"iconfont icon-a-icon-PrivacyPolicy"})]),t._v(" "),e("div",{staticClass:"audit-words"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t("agreement")))]),t._v(" "),e("div",{staticClass:"tip"},[t._v(t._s(t.$t("AuditDialogTip")))]),t._v(" "),e("div",{staticClass:"switch"},[e("span",[t._v(t._s(t.$t("Over18AndAgreeTerm")))]),t._v(" "),e("el-switch",{model:{value:t.isAgree,callback:function(e){t.isAgree=e},expression:"isAgree"}})],1)])]),t._v(" "),e("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.close}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{attrs:{disabled:!t.isAgree},on:{click:function(e){return t.handleConfirm()}}},[t._v(t._s(t.$t("Save"))+" ")])],1)])}),[],!1,null,"485a5e7b",null);e.a=component.exports},1360:function(t,e,n){t.exports={}},1361:function(t,e,n){t.exports={}},1362:function(t,e,n){t.exports={}},1363:function(t,e,n){t.exports={}},1364:function(t,e,n){t.exports={}},1365:function(t,e,n){t.exports={}},1366:function(t,e,n){t.exports={}},1367:function(t,e,n){t.exports={}},1368:function(t,e,n){t.exports={}},1369:function(t,e,n){t.exports={}},1370:function(t,e,n){t.exports={}},1371:function(t,e,n){t.exports={}},1372:function(t,e,n){t.exports={}},1373:function(t,e,n){t.exports={}},1374:function(t,e,n){t.exports={}},1375:function(t,e,n){t.exports={}},1376:function(t,e,n){t.exports={}},1377:function(t,e,n){t.exports={}},1378:function(t,e,n){t.exports={}},1379:function(t,e,n){t.exports={}},1380:function(t,e,n){t.exports={}},1438:function(t,e,n){t.exports={}},1439:function(t,e,n){t.exports={}},1440:function(t,e,n){t.exports={}},1441:function(t,e,n){t.exports={}},1442:function(t,e,n){t.exports={}},1443:function(t,e,n){t.exports={}},1444:function(t,e,n){t.exports={}},1445:function(t,e,n){t.exports={}},1446:function(t,e,n){t.exports={}},1447:function(t,e,n){t.exports={}},1448:function(t,e,n){t.exports={}},1449:function(t,e,n){t.exports={}},1450:function(t,e,n){t.exports={}},1451:function(t,e,n){t.exports={}},1452:function(t,e,n){t.exports={}},1453:function(t,e,n){t.exports={}},1454:function(t,e,n){t.exports={}},1455:function(t,e,n){t.exports={}},1456:function(t,e,n){t.exports={}},1457:function(t,e,n){t.exports={}},1458:function(t,e,n){t.exports={}},1459:function(t,e,n){t.exports={}},1460:function(t,e,n){t.exports={}},1461:function(t,e,n){t.exports={}},1462:function(t,e,n){t.exports={}},1463:function(t,e,n){t.exports={}},1464:function(t,e,n){t.exports={}},1465:function(t,e,n){t.exports={}},1466:function(t,e,n){t.exports={}},1467:function(t,e,n){t.exports={}},1468:function(t,e,n){t.exports={}},1469:function(t,e,n){t.exports={}},1470:function(t,e,n){t.exports={}},1471:function(t,e,n){t.exports={}},1472:function(t,e,n){t.exports={}},1473:function(t,e,n){t.exports={}},1474:function(t,e,n){t.exports={}},1475:function(t,e,n){t.exports={}},1477:function(t,e,n){t.exports={}},1478:function(t,e,n){t.exports={}},1479:function(t,e,n){t.exports={}},1480:function(t,e,n){t.exports={}},1481:function(t,e,n){t.exports={}},1482:function(t,e,n){t.exports={}},1483:function(t,e,n){t.exports={}},1484:function(t,e,n){t.exports={}},1485:function(t,e,n){t.exports={}},1486:function(t,e,n){t.exports={}},1487:function(t,e,n){t.exports={}},1488:function(t,e,n){t.exports={}},1489:function(t,e,n){t.exports={}},1490:function(t,e,n){t.exports={}},1491:function(t,e,n){t.exports={}},1492:function(t,e,n){t.exports={}},1494:function(t,e,n){t.exports={}},1495:function(t,e,n){t.exports={}},1496:function(t,e,n){t.exports={}},1497:function(t,e,n){t.exports={}},1498:function(t,e,n){t.exports={}},1499:function(t,e,n){t.exports={}},1500:function(t,e,n){t.exports={}},1501:function(t,e,n){t.exports={}},1503:function(t,e,n){t.exports={}},1504:function(t,e,n){t.exports={}},1505:function(t,e,n){t.exports={}},1506:function(t,e,n){t.exports={}},1507:function(t,e,n){t.exports={}},1508:function(t,e,n){t.exports={}},1509:function(t,e,n){t.exports={}},1510:function(t,e,n){t.exports={}},1511:function(t,e,n){t.exports={}},1512:function(t,e,n){t.exports={}},1513:function(t,e,n){t.exports={}},1514:function(t,e,n){t.exports={}},1515:function(t,e,n){t.exports={}},1516:function(t,e,n){t.exports={}},1517:function(t,e,n){t.exports={}},1518:function(t,e,n){t.exports={}},1519:function(t,e,n){t.exports={}},1557:function(t,e,n){t.exports={}},1558:function(t,e,n){t.exports={}},1559:function(t,e,n){t.exports={}},1560:function(t,e,n){t.exports={}},1563:function(t,e,n){t.exports={}},1571:function(t,e,n){t.exports={}},1623:function(t,e,n){t.exports={}},1624:function(t,e,n){t.exports={}},1625:function(t,e,n){t.exports={}},1626:function(t,e,n){t.exports={}},1627:function(t,e,n){t.exports={}},1788:function(t,e,n){t.exports={}},186:function(t,e,n){"use strict";n(4),n(29);var o=n(26),r={props:["aiChatId"],name:"AiChatReport",data:function(){return{isShowPopup:!1,remark:"",loading:!1,step:1}},methods:{report:function(t){""!==t?(this.remark=this.$t("AiChatReport"+t),this.submit()):this.step=2},open:function(){this.isShowPopup=!0},close:function(){var t=this;this.isShowPopup=!1,setTimeout((function(){t.step=1,t.remark="",t.loading=!1}),300)},submit:function(){var t=this;this.$logEvent("log_actions",{operation:"report_submit",behavior_info:this.remark}),this.loading=!0,Object(o.G)({id:this.aiChatId,remark:this.remark}).then((function(e){t.step=3})).finally((function(){t.loading=!1}))}}},l=(n(2322),n(0)),component=Object(l.a)(r,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"custom-dialog aichat-report",attrs:{visible:t.isShowPopup,title:t.$t("Report"),"before-close":t.close,"append-to-body":!0},on:{"update:visible":function(e){t.isShowPopup=e}}},[e("div",{staticClass:"report-body"},[1===t.step?e("div",{staticClass:"report-reason"},[e("p",{staticClass:"title"},[t._v(t._s(t.$t("AiChatReportTitle1")))]),t._v(" "),e("div",{staticClass:"reason-list"},[t._l(6,(function(n){return e("p",{key:"reason_"+n,on:{click:function(e){return t.report(n)}}},[t._v(t._s(t.$t("AiChatReport"+n)))])})),t._v(" "),e("p",{on:{click:function(e){return t.report("")}}},[t._v(t._s(t.$t("other")))])],2)]):2===t.step?e("div",{staticClass:"report-remark"},[e("p",{staticClass:"title"},[t._v(t._s(t.$t("AiChatReportTitle2")))]),t._v(" "),e("el-input",{attrs:{type:"textarea",autosize:{minRows:5,maxRows:7}},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1):3===t.step?e("div",{staticClass:"report-result"},[e("img",{attrs:{src:n(472),alt:""}}),t._v(" "),e("p",{staticClass:"result-text"},[t._v(t._s(t.$t("AiChatReportResult1")))]),t._v(" "),e("p",{staticClass:"result-tips"},[t._v(t._s(t.$t("AiChatReportResult2")))])]):t._e()]),t._v(" "),2===t.step?e("div",{staticClass:"handle-btn",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{staticClass:"cancel-btn",attrs:{type:"default"},on:{click:t.close}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{staticClass:"submit-btn",attrs:{type:"default",loading:t.loading},on:{click:t.submit}},[t._v(t._s(t.$t("Submit")))])],1):t._e()])}),[],!1,null,"054f33fd",null);e.a=component.exports},1890:function(t,e,n){"use strict";n(14),n(9),n(11),n(12),n(8),n(6);var o=n(2),r=(n(7),n(10),n(4),{data:function(){return{tagReplaceObj:{66:"aiapp",4:"Post",2:"motivatingTitle1",5:"Post",13:"aiapp",11:"Canvas",9:"digitalHuman",16:"AI_Audio"}}},props:{item:{type:Object,default:function(){}},name:{type:String,default:""}},computed:{isImg:function(t){return function(t){if(!t)return"";var e=t.split(".").pop();return["jpg","jpeg","png","webp","gif"].includes(e)}}}}),l=(n(2672),n(0)),c=Object(l.a)(r,(function(){var t,e=this,n=e._self._c;return n("div",{staticClass:"comfyUIitem"},[n("div",{directives:[{name:"lazyload",rawName:"v-lazyload"}],staticClass:"imgBox"},[e.tagReplaceObj[e.item.obj_type]?n("div",{staticClass:"tag-box"},[e._v("\n      "+e._s(e.$t(e.tagReplaceObj[e.item.obj_type]))+"\n    ")]):e._e(),e._v(" "),e.isImg(e.item.cover)?n("img",{attrs:{"data-src":e.item.cover,alt:e.name,loading:"lazy",width:"263",height:"219"}}):n("video",{attrs:{src:e.item.cover,autoplay:"",width:"263",height:"219",loop:"",muted:""},domProps:{muted:!0}})]),e._v(" "),n("div",{staticClass:"name overflow-ellipsis"},[e._v(e._s(e.$t((null===(t=e.item)||void 0===t?void 0:t.title)||e.name)))])])}),[],!1,null,"b8ecc85e",null).exports,d=n(92),h=n(5),v=n(186),m=n(33),f=n(1);function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var w={components:{ImgWaterFall:d.a,AiChatReport:v.a,AIitemSameStyleItem:c},mixins:[m.a],props:{item:{type:Object,default:function(){}},isForYouPage:Boolean,outerClass:{type:String,default:"recList"}},data:function(){return{formatNumberForeign:h.i,styleObj:{},moreActions:[{label:"Report",type:"report",icon:"task-report-icon"},{label:"Edit",type:"edit",icon:"icon-icon-edit"},{label:"Delete",type:"del",icon:"icon-moveDelete"}]}},computed:y(y(y(y({},Object(f.e)("user",["token"])),Object(f.c)("user",["isLoggedIn"])),Object(f.e)("user",["userInfo"])),{},{renderMoreActions:function(){return"myAiChat"!=this.outerClass?this.moreActions.filter((function(t){return!["del","edit"].includes(t.type)})):this.moreActions},renderItem:function(){var t,e;return y(y({},this.item),{},{stat:(null===(t=this.item)||void 0===t||null===(t=t.character)||void 0===t?void 0:t.stat)||(null===(e=this.item)||void 0===e?void 0:e.stat)})}}),mounted:function(){this.getWH(),window.addEventListener("resize",this.getWH)},beforeDestroy:function(){window.removeEventListener("resize",this.getWH)},methods:{handleClickToDetails:function(){var t;this.$router.push(this.localePath("/cyberPubPage/".concat(null===(t=this.item)||void 0===t?void 0:t.id)))},goCreatedSame:function(t){if(t){var e=this.localePath("/cyberPubPage/new-character?id=".concat(t,"&sameStyle=1"));this.isLoggedIn?this.$router.push(this.localePath(e)):this.$EventBus.$emit("openLoginDialog",{redirect:e})}},getWH:function(){var t=document.getElementById(this.outerClass);if(t){var e=t.offsetWidth;if(!e)return;var n=e>1600?6:5;e<1240&&(n=4);var o=~~((e-48)/n),r=o>230?o:230,l=parseInt(620*r/337);this.styleObj={width:r+"px",height:l+"px"}}},goChat:function(){var t;this.$router.push(this.localePath("/aiChat/".concat(null===(t=this.item)||void 0===t?void 0:t.id)))},handleActions:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""){case"report":try{this.$logEvent("log_actions",{operation:"tavern_on_square",behavior_info:"click_report"}),this.$refs.AiChatReport.open()}catch(t){}break;case"share":this.handleShare();break;case"edit":this.handleEdit();break;case"del":this.handleDel()}},handleShare:function(){this.$logEvent("log_actions",{operation:"tavern_on_square",behavior_info:"click_share"});var t=location.origin;Object(h.d)(t+"/cyberPubPage/".concat(this.item.id)),this.$message.success(this.$t("CopiedURLToClipboard"))},handleDel:function(){this.$emit("delete",this.item)},handleEdit:function(){var t;this.$router.push(this.localePath("/cyberPubPage/new-character?id="+(null===(t=this.item)||void 0===t?void 0:t.id)))},otherUser:function(t){var e,n,path="/user/"+encodeURIComponent(t.author.id);(null===(e=this.userInfo)||void 0===e?void 0:e.id)==(null===(n=t.author)||void 0===n?void 0:n.id)&&(path="/personal"),window.open(this.localePath(path),"_blank")}}},C=w,k=(n(2673),Object(l.a)(C,(function(){var t,e,n,o,r,l,c,d,h,v,m,f,_,y,w,C,k=this,O=k._self._c;return O("a",{attrs:{href:k.localePath("/cyberPubPage/".concat(null===(t=k.item)||void 0===t?void 0:t.id))},on:{click:function(t){return t.preventDefault(),k.goChat.apply(null,arguments)}}},[k.isForYouPage?O("AIitemSameStyleItem",{attrs:{name:null===(e=k.item.character)||void 0===e?void 0:e.name,item:k.item}}):O("div",{staticClass:"cyberBarItem",style:k.styleObj},[O("div",{staticClass:"name",attrs:{title:null===(n=k.item.character)||void 0===n?void 0:n.name},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),k.handleClickToDetails.apply(null,arguments)}}},[k._v("\n      "+k._s(null===(o=k.item.character)||void 0===o?void 0:o.name)+"\n    ")]),k._v(" "),O("div",{staticClass:"imgBox"},[k.item.nsfw?O("ImgWaterFall",{style:{transition:"all 0.3s ease-in-out"},attrs:{isHeight:!1,item:k.item}}):k._e(),k._v(" "),O("div",{staticClass:"imgBox-num"},[O("div",{staticClass:"imgBox-num-item"},[O("i",{staticClass:"iconfont icon-users-solid imgBox-num-item-icon"}),k._v(" "),O("span",{staticClass:"imgBox-num-item-text"},[k._v("\n            "+k._s(k.formatNumberForeign((null===(r=k.item)||void 0===r||null===(r=r.stat)||void 0===r?void 0:r.num_of_token)||(null===(l=k.item)||void 0===l||null===(l=l.character)||void 0===l||null===(l=l.stat)||void 0===l?void 0:l.num_of_token)||0))+"\n          ")])]),k._v(" "),O("div",{staticClass:"imgBox-num-item",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),k.setCollect(k.renderItem,"character")}}},[O("div",{staticClass:"imgBox-num-item-icon"},[O("i",{staticClass:"iconfont",class:k.setCollectData(k.renderItem)})]),k._v(" "),O("span",{staticClass:"imgBox-num-item-text"},[k._v("\n            "+k._s(k.formatNumberForeign((null===(c=k.renderItem)||void 0===c||null===(c=c.stat)||void 0===c?void 0:c.num_of_collection)||(null===(d=k.renderItem)||void 0===d||null===(d=d.character)||void 0===d||null===(d=d.stat)||void 0===d?void 0:d.num_of_collection)||0))+"\n          ")])])])],1),k._v(" "),O("el-tooltip",{attrs:{"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"bottom"}},[O("div",{staticClass:"tooltip-txt",attrs:{slot:"content"},slot:"content"},[k._v("\n        "+k._s(null===(h=k.item.character)||void 0===h?void 0:h.evaluation)+"\n      ")]),k._v(" "),O("div",{staticClass:"desc"},[k._v(k._s(null===(v=k.item.character)||void 0===v?void 0:v.evaluation))])]),k._v(" "),O("div",{staticClass:"item-content-tags"},k._l(null===(m=k.item.character)||void 0===m?void 0:m.categories,(function(t){return O("span",{key:t.id,staticClass:"item-content-tags-item"},[k._v("\n        "+k._s(t.name)+"\n      ")])})),0),k._v(" "),O("div",{staticClass:"author",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[O("div",{staticClass:"author-box",on:{click:function(t){return k.otherUser(k.item)}}},[null!==(f=k.item.author)&&void 0!==f&&f.head?O("div",{staticClass:"authorHead"},[O("img",{directives:[{name:"webp",rawName:"v-webp",value:k.$imgL,expression:"$imgL"}],attrs:{src:null===(_=k.item.author)||void 0===_?void 0:_.head,alt:null===(y=k.item.author)||void 0===y?void 0:y.name}})]):O("div",{staticClass:"authorHead"},[k._v("\n          "+k._s(null===(w=k.item.author)||void 0===w?void 0:w.name[0])+"\n        ")]),k._v(" "),O("div",{staticClass:"authorName"},[O("span",[k._v(k._s(null===(C=k.item.author)||void 0===C?void 0:C.name))])])]),k._v(" "),O("el-popover",{ref:"myPopover",attrs:{placement:"bottom-end","popper-class":"msg-item-more-popover","visible-arrow":!1,width:"120",trigger:"hover"}},[O("div",{staticClass:"pop-btns flex"},k._l(k.renderMoreActions,(function(t){return O("button",{key:t.type,on:{click:function(e){return k.handleActions(t.type)}}},[O("span",{staticClass:"pop-btns-text"},[k._v(k._s(k.$t(t.label)))]),k._v(" "),O("span",{staticClass:"pop-btns-icon"},[O("i",{staticClass:"iconfont",class:t.icon})])])})),0),k._v(" "),O("div",{staticClass:"item-cover-operate",attrs:{slot:"reference"},slot:"reference"},[O("i",{staticClass:"iconfont icon-more"})])])],1)],1),k._v(" "),O("ai-chat-report",{ref:"AiChatReport",attrs:{"ai-chat-id":k.item.id}})],1)}),[],!1,null,"3afdfcbc",null));e.a=k.exports},1900:function(t,e,n){"use strict";n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(3),r=n(2),l=(n(20),n(16),n(10),n(29),n(26)),c=n(215),d=n(1);function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var m={components:{AiChatCreteConfirm:c.a},props:{chatObj:{type:Object,default:function(){return{}}}},data:function(){return{showMask:!1,invitationTitle:"chatTip".concat(this.getRandomNumber()),showChatTip:!1,hideChatTip:!1,timer:null,hide:!1}},computed:v(v(v({},Object(d.c)("user",["isLoggedIn","isCompanyAccount"])),Object(d.e)("user",["userInfo","accountData"])),{},{showIconAlways:function(){var t,e,n;return!this.isCompanyAccount&&1!==(null===(t=this.chatObj)||void 0===t?void 0:t.nsfw)&&((null===(e=this.userInfo)||void 0===e?void 0:e.enable_tavern)||!this.isLoggedIn)&&(null===(n=this.chatObj)||void 0===n?void 0:n.id)&&!this.$isChinaSite&&!this.hide},greenMode:function(){var t;return 2!==(null==this||null===(t=this.accountData)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.green_mode)},hideIcon:function(){var t;return this.greenMode&&[2,"2"].includes(null===(t=this.chatObj)||void 0===t?void 0:t.green)}}),watch:{showChatTip:function(t){var e=this;this.timer&&clearTimeout(this.timer),this.timer2&&clearTimeout(this.timer2),this.timer2=t?setTimeout((function(){e.showChatTip=!1,e.hideChatTip=!0,e.timer2&&clearTimeout(e.timer2)}),5e3):null}},methods:{handleConfirm:function(){this.showMask=!1,this.startCreateChater()},getRandomNumber:function(){return Math.floor(20*Math.random())+1},isExceedance:function(){var t=localStorage.getItem("lastTriggerTime"),e=(new Date).getTime();(!t||e-t>864e5)&&(localStorage.setItem("lastTriggerTime",e),localStorage.setItem("triggerCount",0));var n=parseInt(localStorage.getItem("triggerCount"));n<3&&(this.initMsgBox(),n++,localStorage.setItem("triggerCount",n))},initMsgBox:function(){var t,e=this;null!==(t=this.chatObj)&&void 0!==t&&t.id&&(this.invitationTitle="chatTip".concat(this.getRandomNumber()),this.timer=setTimeout((function(){e.showChatTip=!0}),3e3))},isCanChat:function(){var t;null!==(t=this.chatObj)&&void 0!==t&&t.id},handleClickChat:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.$logEvent("log_actions",{operation:"go_to_one_click_chat",behavior_info:"on_work_detail_page"}),e.next=3,Object(l.D)({channel:"artwork",source_id:null===(n=t.chatObj)||void 0===n?void 0:n.id});case 3:o=e.sent,r=o.data.character_id,(c=void 0===r?"":r)?t.startCreateChater(c):t.showMask=!0;case 6:case"end":return e.stop()}}),e)})))()},startCreateChater:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,c,d,h,v,m,f,_,y,w,C,k,O;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=t.chatObj)&&void 0!==n&&n.id){e.next=3;break}return e.abrupt("return");case 3:return y={height:(null===(o=t.chatObj)||void 0===o?void 0:o.cover_height)||(null===(r=t.chatObj)||void 0===r||null===(r=r.banner)||void 0===r?void 0:r.height),width:(null===(c=t.chatObj)||void 0===c?void 0:c.cover_width)||(null===(d=t.chatObj)||void 0===d||null===(d=d.banner)||void 0===d?void 0:d.width),id:null===(h=t.chatObj)||void 0===h?void 0:h.id,url:(null===(v=t.chatObj)||void 0===v?void 0:v.cover)||(null===(m=t.chatObj)||void 0===m||null===(m=m.banner)||void 0===m?void 0:m.url),source_account_id:null===(f=t.chatObj)||void 0===f||null===(f=f.author)||void 0===f?void 0:f.id},e.next=6,Object(l.D)({channel:"artwork",source_id:y.id});case 6:if(w=e.sent,C=(null==w?void 0:w.data)||{},k=C.can,2!==(void 0===k?2:k)){e.next=11;break}return t.$message.warning(t.$t("chatFail")),e.abrupt("return");case 11:if(localStorage.setItem("createParams",JSON.stringify(y)),O="/cyberPubPage/".concat(null===(_=t.chatObj)||void 0===_?void 0:_.id,"?quickChat=true&redirect=").concat(t.$route.fullPath),t.isLoggedIn){e.next=18;break}return t.$EventBus.$emit("openLoginDialog",{redirect:t.localePath(O)}),e.abrupt("return");case 18:t.$router.push(t.localePath(O));case 19:case"end":return e.stop()}}),e)})))()}},beforeDestroy:function(){this.timer&&clearTimeout(this.timer),this.timer2&&clearTimeout(this.timer2)},mounted:function(){this.isExceedance()}},f=(n(2407),n(0)),component=Object(f.a)(m,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.showIconAlways,expression:"showIconAlways"}],staticClass:"ai-chat-by-details"},[e("div",{staticClass:"ai-chat-by-details-btn",on:{click:function(e){return e.stopPropagation(),t.handleClickChat.apply(null,arguments)}}},[e("img",{staticClass:"bubble",attrs:{src:n(619),alt:"chatIcon"}}),t._v(" "),e("div",{staticClass:"msg-box",class:{"fade-in":t.showChatTip,"fade-out":t.hideChatTip}},[t._v(t._s(t.$t(t.invitationTitle))+"\n            ")])]),t._v(" "),e("AiChatCreteConfirm",{attrs:{"dialog-visible":t.showMask},on:{"update:dialogVisible":function(e){t.showMask=e},"update:dialog-visible":function(e){t.showMask=e},confirm:t.handleConfirm}})],1)}),[],!1,null,"57ebcfc6",null);e.a=component.exports},1907:function(t,e,n){"use strict";n(14),n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),r=n(1);function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var c={name:"BookCard",mixins:[n(33).a],props:{videoBookData:{type:Object,default:function(){}}},components:{},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(r.c)("user",["isLoggedIn"])),data:function(){return{}},methods:{goReading:function(){var t;this.$logEvent("log_actions",{operation:"click_continue_reading",behavior_info:"on_ai_video_detail_page",behavior_info_sub:this.$route.params.id}),this.$emit("closePlayer"),this.$router.push(this.localePath("/book/reading/".concat(null===(t=this.videoBookData)||void 0===t||null===(t=t.related_ebooks[0])||void 0===t?void 0:t.id)))}}},d=c,h=(n(2919),n(0)),component=Object(h.a)(d,(function(){var t,e,n,o,r,l=this,c=l._self._c;return c("div",{staticClass:"book"},[c("div",{staticClass:"name"},[l._v(l._s(l.$t("Playing")))]),l._v(" "),c("div",{staticClass:"book-card"},[c("div",{staticClass:"content flex flex-col"},[c("div",{staticClass:"top flex"},[c("div",{staticClass:"left-img"},[null!==(t=l.videoBookData)&&void 0!==t&&null!==(t=t.related_ebooks[0])&&void 0!==t&&null!==(t=t.cover)&&void 0!==t&&t.url?c("img",{directives:[{name:"webp",rawName:"v-webp",value:l.$imgL,expression:"$imgL"}],attrs:{src:null===(e=l.videoBookData)||void 0===e||null===(e=e.related_ebooks[0])||void 0===e||null===(e=e.cover)||void 0===e?void 0:e.url,alt:"cover",loading:"lazy",width:"191",height:"107"}}):l._e()]),l._v(" "),c("div",{staticClass:"right-content flex flex-col"},[c("div",{staticClass:"right-top text-no-wrap"},[l._v(l._s(null===(n=l.videoBookData)||void 0===n||null===(n=n.related_ebooks[0])||void 0===n?void 0:n.name))]),l._v(" "),c("div",{staticClass:"right-middle flex flex-col"},[c("div",{staticClass:"text-no-wrap-2 desc"},[l._v(l._s(null===(o=l.videoBookData)||void 0===o||null===(o=o.related_ebooks[0])||void 0===o?void 0:o.desc))])])])]),l._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:null===(r=l.videoBookData)||void 0===r||null===(r=r.related_ebooks[0])||void 0===r?void 0:r.id,expression:"videoBookData?.related_ebooks[0]?.id"}],staticClass:"bottom flex"},[c("div",{staticClass:"btns-item",on:{click:l.goReading}},[l._v("\n          "+l._s(l.$t("continueRead"))+"\n        ")])])])])])}),[],!1,null,"3421d60f",null);e.a=component.exports},212:function(t,e,n){"use strict";n(10),n(36),n(14),n(18),n(9),n(85),n(101),n(75),n(11),n(12),n(8),n(23),n(49),n(50),n(48);var o=n(15),r=n(3),l=n(2),c=(n(670),n(44),n(395)),d=n.n(c),h=(n(20),n(16),n(7),n(32),n(19),n(43),n(4),n(6),n(51)),v=n(21),m=n(535),f=n(26),_=n(1),y=n(5),w=n(24),C=n(33),k=n(82),O=n(135),x=n(64),I=n(13),D=n(81);function S(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,a){if(t){if("string"==typeof t)return P(t,a);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?P(t,a):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw l}}}}function P(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,n=Array(a);e<a;e++)n[e]=t[e];return n}function L(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function j(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?L(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var $={name:"SelectSoundModel",mixins:[C.a],components:{modelPayNum:k.a,changeVer:O.a,SwipeableList:x.a,AiChatSoundItem:m.a,ElAutocomplete:d.a},props:{selectList:{type:Array,default:function(){return["1fb5d6c22a1d6803519a62be8006c8b2"]}}},data:function(){return{soundsTypeInfo:I.T,visible:!1,activeTab:"mine",timeName:"All",timeTypeOption:I.U,tagIndex:"hot",typeOption:I.S,tabList:[{label:"我的",type:"mine",id:"mine",order:1,i18nKey:"Mine"}],queryOptionsList:I.M,replaceKeyArr:I.P,queryParam:{order_by:"hot",keyword:""},filterQueryParams:{styles:[],model_types:[],list_b:[],list_a:[]},list:[],hotRecentUsedList:[],loading:!1,noMore:!1,pageInfo:{page:1,page_size:60,total:0},debounceHandleScroll:null,gridNum:3,modalWidth:"1286px",debounceResize:null,itemScroll:null,queryType:"comprehensive",soundAttrSelectAll:[]}},computed:j(j(j({},Object(_.c)("user",["isLoggedIn"])),{},{convertTabText:function(){return function(t){return t.title?t.title:this.$t(t.i18nKey)}}},Object(_.e)("user",["collectData","cdnHost","token"])),{},{showEmptyResult:function(){var t=!this.loading,e=!this.list.length&&!this.hotRecentUsedList.length;return t&&e},showRecommendText:function(){return!this.loading&&this.hotUsedList.length&&"mine"===this.activeTab&&"comprehensive"===this.queryType},isNoRecentUsed:function(){return!this.loading&&!this.list.length&&"recent"===this.queryType&&this.showRecommendText},nsfwUrl:function(){return"https://".concat(this.cdnHost,"/static/upload/20230401/62f66fbd-bc27-44f6-b744-5c5d7e5b18ee.webp")},activeTabClass:function(){return function(t){return t&&t===this.activeTab?"tab-active":""}},getImageUrl:function(){return function(t){var e="";return t.banner&&!["",null,void 0].includes(t.banner.url)?e=Object(y.x)(t.banner.url,this.$imgL):e}},activeSelectModel:function(){return function(t){return this.selectList.find((function(e){return t.id===e}))?"select-sound-active":""}},hotUsedList:function(){return this.hotRecentUsedList}}),beforeDestroy:function(){this.debounceHandleScroll=null},watch:{hotRecentUsedList:{handler:function(t){for(var i=0;i<this.hotRecentUsedList.length;i++)for(var e=0;e<this.selectList.length;e++)this.selectList[e].id,this.hotRecentUsedList[i].id}},list:{handler:function(t){for(var i=0;i<this.list.length;i++)for(var e=0;e<this.selectList.length;e++)if(this.selectList[e].id===this.list[i].id&&this.selectList[e].art_model_ver_no_name&&this.list[i].version_name){this.list[i].version_name=this.selectList[e].art_model_ver_no_name,this.list[i].banner.url=this.selectList[e].model_cover;break}}}},mounted:function(){var t=this;this.debounceHandleScroll=Object(w.debounce)(this.handleScroll,600),this.debounceResize=Object(w.debounce)(this.handleResize,500),window.addEventListener("resize",this.debounceResize),this.$nextTick((function(){t.handleResize()}))},methods:{newChat:function(){this.$emit("newChat")},querySearchAsync:function(t,e){var n=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var o,r,l,c,data,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={except_num:10,nsfw_plus:1,prefix:n.queryParam.keyword,source_type:16},t.next=3,Object(h.g)(o);case 3:r=t.sent,l=r.status,c=r.data,data=void 0===c?{}:c,1e4===l.code&&(d=data.items.map((function(t){return{value:t.title}}))).length&&e(d);case 6:case"end":return t.stop()}}),t)})))()},handleFilterChange:function(t){this.loading||(this.$logEvent("log_actions",{operation:"click_select_params",behavior_info:"on_voice_select_pop",behavior_info_sub:t}),-1!==this.soundAttrSelectAll.indexOf(t)?this.soundAttrSelectAll.splice(this.soundAttrSelectAll.indexOf(t),1):this.soundAttrSelectAll.push(t),"recommend"===this.queryType&&(this.tagIndex="hot"),this.checkGetList())},handleFilterReset:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loading||(this.soundAttrSelectAll=[],this.filterQueryParams.list_a=[],this.filterQueryParams.list_b=[],this.filterQueryParams.styles=[],this.filterQueryParams.model_types=[],t||this.checkGetList())},getParamsForAttr:function(){this.filterQueryParams.list_a=[],this.filterQueryParams.list_b=[],this.filterQueryParams.styles=[],this.filterQueryParams.model_types=[];var t,e=S(this.soundsTypeInfo);try{for(e.s();!(t=e.n()).done;){var n,o=t.value,r=S(o.value);try{for(r.s();!(n=r.n()).done;){var l=n.value;this.soundAttrSelectAll.includes(l.value)&&!this.filterQueryParams[o.paramsKey].includes(l.value)&&this.filterQueryParams[o.paramsKey].push(l.value)}}catch(t){r.e(t)}finally{r.f()}}}catch(t){e.e(t)}finally{e.f()}return this.filterQueryParams},loginAndChangeQuery:function(t){this.$emit("newChat"),this.changeQueryType(t)},changeQueryType:function(t){var e=this;this.$logEvent("log_actions",{operation:{collect:"click_my_collect",myAudio:"click_my_vioce",comprehensive:"click_recommendation",recent:"click_recent_use",recommend:"click_more_recommendation"}[t],behavior_info:"on_voice_select_pop"}),"myAudio"!==t&&"collect"!==t||this.isLoggedIn?(this.list=[],this.hotRecentUsedList=[],this.pageInfo={page:1,page_size:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:""},this.checkGetList()):this.$EventBus.$emit("openLoginDialog",{callBack:function(){return e.loginAndChangeQuery(t)}})},checkGetList:function(){"comprehensive"!==this.queryType?"recent"===this.queryType?this.handleGetRecentUsed():this.handleSearch():this.handleGetComList()},handleGetComList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,code,c,d,h,v,m,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("获取综合推荐",t.queryType),t.pageInfo.page=1,t.loading=!0,t.noMore=!1,t.loading=!0,{},n=t.getParamsForAttr(),e.prev=7,e.next=10,Object(f.F)(n);case 10:return o=e.sent,l=(r=o||{}).status.code,code=void 0===l?"":l,c=r.data,d=void 0===c?{}:c,[1e4,"10000"].includes(code)&&(h=Array.isArray(null==d?void 0:d.recently)?d.recently:[],t.noMore=!0,v=(h||[]).map((function(e){var n=(e||{}).nsfw;return[1,"1"].includes(void 0===n?0:n)&&(e.cover=t.nsfwUrl),e.timbre.cover=e.cover,e})),t.list="recent"===t.queryType?v.length<=10?v:v.slice(0,10):v,m=Array.isArray(null==d?void 0:d.items)&&"recent"!==t.queryType?d.items:[],_=t.list.map((function(t){return t.id})),t.hotRecentUsedList=(m||[]).filter((function(t){return!_.includes(t.id)})).map((function(e){var n=(e||{}).nsfw;[1,"1"].includes(void 0===n?0:n)&&(e.cover=t.nsfwUrl);var o=t.findSelectItem(e);return o&&(e=Object.assign(e,o)),e.timbre.cover=e.cover,e}))),e.abrupt("return",t.list);case 14:return e.prev=14,t.loading=!1,e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[7,,14,17]])})))()},setIcon:function(){var t=this,e="homeIcon1";return this.typeOption.forEach((function(n){t.tagIndex===n.id&&(e=n.icon)})),e},handleCommand:function(t){this.tagIndex=t,this.queryParam.order_by=this.tagIndex,this.handleSearch()},handleTimeCommand:function(t){this.timeName=t.name,this.queryParam.start_at=t.startTime,this.queryParam.end_at=t.endTime,this.handleSearch()},changeScroll:function(){var t=this;this.$refs.listItem.forEach((function(e,n){e.classList.contains("tab-active")&&(t.itemScroll={value:e.getBoundingClientRect().left,index:n})}))},getTag:function(){var t=this;Object(D.a)({show_area:"timbre"}).then((function(e){if(1e4===e.status.code){var n=e.data||[],r=[];n.forEach((function(e){e.title=e[I.l[t.$i18n.locale]],e.title&&r.push(e)})),console.log("resultArr",r),t.tabList=[].concat(Object(o.a)(t.tabList),r)}}))},changeType:function(t){this.list=[],this.pageInfo={page:1,page_size:60,total:0},this.handleSearch()},handleResize:function(){try{window.innerWidth>1400?(this.modalWidth="1286px",this.gridNum=3):(this.modalWidth="888px",this.gridNum=2)}catch(t){}},selectItem:function(t,e,n){var o,r;(e.model_ver_no=t.model_ver_id,e.version_name=t.version_no,e.base_model=t.base_model_name,e.modelTags=Array.isArray(null==t?void 0:t.tags)?null==t?void 0:t.tags:[],null!==(o=t.sample)&&void 0!==o&&null!==(o=o.banner)&&void 0!==o&&o.url)?e.banner.url=null===(r=t.sample)||void 0===r||null===(r=r.banner)||void 0===r?void 0:r.url:e.banner.url="";n&&this.$emit("selectModel",e)},openModal:function(){var t=this;if(this.resetData(),this.tabList=[{label:"我的",type:"mine",id:"mine",order:1,i18nKey:"Mine"}],this.activeTab="mine",this.queryType="comprehensive",this.getTag(),!this.token)return this.checkGetList(),void(this.visible=!0);this.$nextTick((function(){t.handleGetComList().finally((function(){t.loading=!1,t.list.length&&t.list.length>=10?(t.activeTab="mine",t.queryType="recent"):(t.activeTab="mine",t.queryType="comprehensive")})),t.visible=!0}))},handleClose:function(){this.visible=!1,this.resetData()},resetData:function(){this.pageInfo={page:1,page_size:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:""},this.activeTab="mine",this.queryType="comprehensive",this.loading=!1,this.noMore=!1,this.hotRecentUsedList=[],this.list=[],this.filterQueryParams.list_a=[],this.filterQueryParams.list_b=[],this.filterQueryParams.model_types=[],this.filterQueryParams.styles=[]},handleViewMore:function(){this.activeTab="",this.handleTabClick("mine","recommend")},handleTabClick:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.$logEvent("log_actions",{operation:"click_tab",behavior_info:"on_voice_select_pop",behavior_info_sub:t}),t===this.activeTab||this.loading||(this.activeTab=t,this.queryType="mine"===t?n||"comprehensive":"recommend",this.$nextTick((function(){e.changeScroll()})),this.list=[],this.hotRecentUsedList=[],this.pageInfo={page:1,page_size:60,total:0},this.tagIndex="hot",this.timeName="All",this.queryParam={order_by:"hot",keyword:""},this.checkGetList())},handleSearch:function(){if(this.$route.name.includes("AIAudioCreate")?this.$logEvent("log_actions",{operation:"click_search",behavior_info:"on_choose_audio_popup"}):this.$logEvent("log_actions",{operation:"click_search",behavior_info:"on_voice_select_pop"}),this.pageInfo.page=1,this.loading=!1,this.noMore=!1,this.list=[],"recent"===this.queryType)return this.queryType="recommend",void this.handleGetComList();"comprehensive"===this.queryType&&(this.queryType="recommend"),this.getList()},handleScroll:function(){var t=this.$refs.scrollWrapper;try{t&&t.scrollTop+t.clientHeight>=t.scrollHeight-30&&"recent"!==this.queryType&&this.getList(!0)}catch(t){}},getList:function(t){var e=this;if(console.log("getList"),!this.loading&&!this.noMore){this.loading=!0;var n={page:this.pageInfo.page,page_size:this.pageInfo.page_size};["mine"].includes(this.activeTab)||(n.tag=this.activeTab),Object.assign(n,this.queryParam,this.getParamsForAttr());var o=f.w;"myAudio"===this.queryType&&(o=f.t),"collect"===this.queryType&&(o=v.b),this.queryParam.keyword&&(o=f.x),o(n).then((function(n){var o=n||{},r=o.status,l=void 0===r?{}:r,c=o.data,data=void 0===c?{}:c,d=l.code;if([1e4,"10000"].includes(void 0===d?"":d)){if(e.noMore=!data.has_more,t){var h=e.list.map((function(t){return t.id})),v=(n.data.items||[]).filter((function(t){return!h.includes(t.id)})).map((function(t){var n=(t||{}).nsfw;return[1,"1"].includes(void 0===n?0:n)&&(t.cover=e.nsfwUrl),t.timbre.cover=t.cover,t}));e.list=e.list.concat(v)}else e.list=(n.data.items||[]).map((function(t){var n=(t||{}).nsfw;return[1,"1"].includes(void 0===n?0:n)&&(t.cover=e.nsfwUrl),t.timbre.cover=t.cover,t}));1===e.pageInfo.page&&(e.queryParam.time_to=n.data.time_ms),e.pageInfo.page++}})).catch((function(t){console.log(t)})).finally((function(){e.loading=!1}))}},findSelectItem:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.activeSelectModel(t)){var e=this.selectList.find((function(e){return t.id===e.id}));return t=e||t}return null},handleSelect:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.$message.warning(this.$t("CannotSelectedRepeatedly")):this.$emit("selectModel",t)},handleGetRecentUsed:function(){this.pageInfo.page=1,this.loading=!0,this.noMore=!1,this.handleGetComList()},handleDetail:function(t){(null==t?void 0:t.id)&&window.open("/models/detail/".concat(t.id))}}},T=$,B=(n(2665),n(0)),component=Object(B.a)(T,(function(){var t,e,n=this,o=n._self._c;return o("el-dialog",{ref:"styleModal",attrs:{title:n.$t("audioSelect"),visible:n.visible,width:n.modalWidth,height:"auto","custom-class":"c-style-modal c-style-modal-sound","modal-append-to-body":!1,"append-to-body":!0,"close-on-click-modal":!1,center:""},on:{"update:visible":function(t){n.visible=t},close:function(t){return n.handleFilterReset(!0)}}},[o("div",{staticClass:"style-content-wrapper-sound"},[o("div",{staticClass:"style-content__header"},[o("swipeable-list",{attrs:{scrollChange:n.itemScroll,top:"22px"}},[o("div",{staticClass:"style-content__header-tabs-sound"},n._l(n.tabList,(function(t,e){return o("div",{key:t.type+e},[o("div",{ref:"listItem",refInFor:!0,staticClass:"style-content__header-tabs-item-sound",class:[n.activeTabClass(t.id)],on:{click:function(e){return e.stopPropagation(),n.handleTabClick(t.id)}}},[n._v("\n              "+n._s(n.convertTabText(t))+"\n            ")])])})),0)])],1),n._v(" "),o("div",{staticClass:"style-content__search-box style-content__search-box-sound"},[o("div",{staticClass:"flex-a-center"},[o("el-autocomplete",{staticClass:"style-content__search-input-sound",attrs:{"popper-append-to-body":!1,"popper-class":"autocomplete-popper",placeholder:n.$t("searchMoreSounds"),"trigger-on-focus":!1,clearable:"","fetch-suggestions":n.querySearchAsync},on:{clear:n.handleSearch,select:n.handleSearch},model:{value:n.queryParam.keyword,callback:function(t){n.$set(n.queryParam,"keyword",t)},expression:"queryParam.keyword"}},[o("template",{slot:"prefix"},[o("i",{staticClass:"iconfont icon-search search-icon-sound",on:{click:n.handleSearch}})])],2),n._v(" "),o("div",{staticClass:"style-content__search-btn style-content__search-btn-gra-border",on:{click:n.handleSearch}},[o("span",[n._v(n._s(n.$t("Search")))])])],1),n._v(" "),o("div",{staticClass:"search-right"},[o("el-popover",{attrs:{placement:"bottom","popper-class":"homeFilter",trigger:"hover"}},[o("div",{staticClass:"filterCnt"},[n._l(n.soundsTypeInfo,(function(t,e){return o("div",{key:e},[o("div",{staticClass:"filterTit",staticStyle:{"margin-top":"16px"}},[n._v("\n                "+n._s(n.$t(t.i18Key))+"\n              ")]),n._v(" "),o("div",{staticClass:"filterList"},n._l(t.value,(function(e,r){return o("div",{key:r,staticClass:"filterItem",class:{AfilterItem:n.soundAttrSelectAll.includes(t)},on:{click:function(t){return n.handleFilterChange(e.value)}}},[n.soundAttrSelectAll.includes(e.value)?o("i",{staticClass:"el-icon-check"}):n._e(),n._v(" "),o("span",[n._v(n._s(n.$t(e.i18Key)))])])})),0)])})),n._v(" "),o("div",{staticClass:"filterReset graBorder",on:{click:function(t){return n.handleFilterReset(!1)}}},[n._v("\n              "+n._s(n.$t("resetSelection"))+"\n            ")])],2),n._v(" "),o("el-badge",{staticClass:"item",attrs:{slot:"reference",value:null===(t=n.soundAttrSelectAll)||void 0===t?void 0:t.length,hidden:0==(null===(e=n.soundAttrSelectAll)||void 0===e?void 0:e.length)},slot:"reference"},[o("div",{staticClass:"filterBox"},[o("div",[o("i",{staticClass:"iconfont icon-a-filterIcon"}),n._v(" "),o("span",[n._v(n._s(n.$t("Filter")))])]),n._v(" "),o("i",{staticClass:"el-icon-arrow-down"})])])],1),n._v(" "),"mine"===n.activeTab?o("el-select",{staticClass:"showType custom-select",class:n.$i18n.locale,attrs:{"popper-class":"custom-select"},on:{change:n.changeQueryType},model:{value:n.queryType,callback:function(t){n.queryType=t},expression:"queryType"}},n._l(n.queryOptionsList,(function(t){return o("el-option",{key:t.value,attrs:{label:n.$t(t.i18nKey),value:t.value}})})),1):n._e(),n._v(" "),["mine"].includes(n.activeTab)?n._e():o("div",{staticClass:"Screening"},[o("el-dropdown",{staticClass:"el-dropdown-sound",attrs:{trigger:"hover"},on:{command:n.handleTimeCommand}},[o("div",{staticClass:"el-dropdown-link selectTime"},[o("div",[o("i",{staticClass:"el-icon-time"}),n._v(" "),o("span",[n._v(n._s(n.$t(n.timeName)))])]),n._v(" "),o("i",{staticClass:"el-icon-arrow-down"})]),n._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},n._l(n.timeTypeOption,(function(t,e){return o("el-dropdown-item",{key:e,attrs:{command:t}},[o("div",{staticClass:"el-dropdown-item el-dropdown-item-time"},[o("span",[n._v(n._s(n.$t(t.name)))])])])})),1)],1),n._v(" "),o("el-dropdown",{staticClass:"el-dropdown-sound",attrs:{trigger:"hover"},on:{command:n.handleCommand}},[o("div",{staticClass:"el-dropdown-link"},[o("div",[o("i",{staticClass:"iconfont custom-iconfont",class:"icon-".concat(n.setIcon())}),n._v(" "),o("span",[n._v(n._s(n.$t(n.tagIndex.charAt(0).toUpperCase()+n.tagIndex.slice(1))))])]),n._v(" "),o("i",{staticClass:"el-icon-arrow-down"})]),n._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},n._l(n.typeOption,(function(t,e){return o("el-dropdown-item",{key:e,attrs:{command:t.id}},[o("div",{staticClass:"el-dropdown-item"},[o("i",{staticClass:"iconfont custom-iconfont",class:"icon-".concat(t.icon)}),n._v(" "),o("span",[n._v(n._s(n.$t(t.name)))])])])})),1)],1)],1)],1)]),n._v(" "),o("div",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],ref:"scrollWrapper",staticClass:"style-content__list-wrapper-sound",class:[n.isNoRecentUsed?"style-content__list-wrapper-no-margin":""],style:{gridTemplateColumns:"repeat(".concat(n.gridNum,", 1fr)")},on:{scroll:n.handleScroll}},[n.list.length?[n._l(n.list,(function(t){return o("AiChatSoundItem",{key:t.id,class:[n.activeSelectModel(t)],attrs:{item:t.timbre},on:{handleSelect:function(e){n.handleSelect(t,n.activeSelectModel(t))}}})})),n._v(" "),n.list.length>1&&n.list.length<9?n._l(9,(function(t){return o("div",{staticClass:"sound-item",attrs:{index:t}})})):n._e()]:n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.showRecommendText,expression:"showRecommendText"}],staticClass:"recommend-text",style:{gridColumn:"span ".concat(n.gridNum)}},[o("div",{staticClass:"recommend-text-line"}),n._v(" "),o("div",{staticClass:"recommend-text-main"},[n._v(n._s(n.$t("hotSoundsForYou")))]),n._v(" "),o("div",{staticClass:"recommend-text-line"})]),n._v(" "),!n.loading&&n.hotUsedList.length&&"mine"===n.activeTab&&["comprehensive"].includes(n.queryType)?[n._l(n.hotUsedList,(function(t){return o("AiChatSoundItem",{key:t.id,class:[n.activeSelectModel(t)],attrs:{item:t.timbre},on:{newChat:n.newChat,handleSelect:function(e){n.handleSelect(t,n.activeSelectModel(t))}}})})),n._v(" "),o("div",{staticClass:"show-more-item",style:{gridColumn:"span ".concat(n.gridNum)}},[o("span",{staticClass:"show-more-item-btn",on:{click:function(t){return t.stopPropagation(),n.handleViewMore()}}},[o("span",{staticClass:"show-more-item-btn-text"},[n._v(n._s(n.$t("viewMore")))]),n._v(" "),o("i",{staticClass:"iconfont icon-icon-direction-down show-more-item-btn-icon"})])])]:n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.showEmptyResult,expression:"showEmptyResult"}],staticClass:"style-content__list-empty"},[o("svg-icon",{staticClass:"style-content__list-empty-icon",attrs:{"icon-class":"style-empty-icon"}}),n._v(" "),"mine"===n.activeTab&&["recent"].includes(n.queryType)&&["",null,void 0].includes(n.queryParam.keyword)?[n._v("\n          "+n._s(n.$t("soundRecent"))+"\n        ")]:["collect"].includes(n.queryType)&&"mine"===n.activeTab&&["",null,void 0].includes(n.queryParam.keyword)?[n._v("\n          "+n._s(n.$t("soundCollect"))+"\n        ")]:[n._v(n._s(n.$t("NoResultsFound")))]],2)],2)])])}),[],!1,null,"6dc562f6",null);e.a=component.exports},215:function(t,e,n){"use strict";var o={props:{dialogVisible:{type:Boolean,default:!1},source:{type:String,default:"art_task"},fromPage:{type:String,default:""}},watch:{},data:function(){return{bodyScrollTop:null}},methods:{handleCancel:function(){this.$emit("update:dialogVisible",!1),this.$emit("closeDialog")},handleConfirm:function(){this.reportEvent({operation:"click_comfirm",behavior_info:"on_tavern_create_comfirm_pop",behavior_info_sub:this.source}),this.$emit("confirm")},reportEvent:function(data){this.$logEvent("log_actions",{operation:data.operation,behavior_info:data.behavior_info,behavior_info_sub:data.behavior_info_sub})}},mounted:function(){this.reportEvent({operation:"tavern_comfirm_pop_show",behavior_info:"on_tavern_create_comfirm_pop",behavior_info_sub:this.source})}},r=(n(2337),n(0)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.dialogVisible,title:t.$t("create_digital"),width:"462px","custom-class":"create-digital-dialog","close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":"","z-index":9999},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleCancel},scopedSlots:t._u([{key:"footer",fn:function(){return[e("span",{staticClass:"dialog-footer"},[e("el-button",{staticClass:"btn cancel",on:{click:t.handleCancel}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{staticClass:"btn query",class:["newTask"===t.fromPage&&"query-liner"],on:{click:t.handleConfirm}},[t._v(t._s(t.$t("Create")))])],1)]},proxy:!0}])},[e("div",{staticClass:"content-2"},[t._v("\n    "+t._s(t.$t("create_digital_human"))+"\n  ")])])}),[],!1,null,"33682469",null);e.a=component.exports},2308:function(t,e,n){"use strict";n(975)},2309:function(t,e,n){"use strict";n(976)},2310:function(t,e,n){"use strict";n(977)},2311:function(t,e,n){"use strict";n(978)},2312:function(t,e,n){"use strict";n(979)},2313:function(t,e,n){"use strict";n(980)},2314:function(t,e,n){"use strict";n(981)},2316:function(t,e,n){"use strict";n(983)},2317:function(t,e,n){"use strict";n(984)},2318:function(t,e,n){"use strict";n(985)},2319:function(t,e,n){"use strict";n(986)},2320:function(t,e,n){"use strict";n(987)},2321:function(t,e,n){"use strict";n(988)},2322:function(t,e,n){"use strict";n(989)},2323:function(t,e,n){"use strict";n(990)},2324:function(t,e,n){"use strict";n(991)},2325:function(t,e,n){"use strict";n(992)},2327:function(t,e,n){"use strict";n(994)},2328:function(t,e,n){"use strict";n(995)},2337:function(t,e,n){"use strict";n(1004)},2376:function(t,e,n){"use strict";n(1042)},2377:function(t,e,n){"use strict";n(1043)},2378:function(t,e,n){"use strict";n(1044)},2379:function(t,e,n){"use strict";n(1045)},2380:function(t,e,n){"use strict";n(1046)},2381:function(t,e,n){"use strict";n(1047)},2383:function(t,e,n){"use strict";n(1049)},2384:function(t,e,n){"use strict";n(1050)},2387:function(t,e,n){"use strict";n(1053)},2388:function(t,e,n){"use strict";n(1054)},2407:function(t,e,n){"use strict";n(1074)},2496:function(t,e,n){"use strict";n(1161)},2530:function(t,e,n){"use strict";n(1195)},2531:function(t,e,n){"use strict";n(1196)},2532:function(t,e,n){"use strict";n(1197)},2534:function(t,e,n){"use strict";n(1199)},2535:function(t,e,n){"use strict";n(1200)},2536:function(t,e,n){"use strict";n(1201)},2537:function(t,e,n){"use strict";n(1202)},2538:function(t,e,n){"use strict";n(1203)},2544:function(t,e,n){"use strict";n(1208)},2545:function(t,e,n){"use strict";n(1209)},2549:function(t,e,n){"use strict";n(1212)},2554:function(t,e,n){"use strict";n(1217)},2555:function(t,e,n){"use strict";n(1218)},2556:function(t,e,n){"use strict";n(1219)},2558:function(t,e,n){"use strict";n(1220)},2559:function(t,e,n){"use strict";n(1221)},2560:function(t,e,n){"use strict";n(1222)},2561:function(t,e,n){"use strict";n(1223)},2562:function(t,e,n){"use strict";n(1224)},2563:function(t,e,n){"use strict";n(1225)},2564:function(t,e,n){"use strict";n(1226)},2565:function(t,e,n){"use strict";n(1227)},2566:function(t,e,n){"use strict";n(1228)},2567:function(t,e,n){"use strict";n(1229)},2616:function(t,e,n){"use strict";n(1274)},2664:function(t,e,n){"use strict";n(1322)},2665:function(t,e,n){"use strict";n(1323)},2672:function(t,e,n){"use strict";n(1330)},2673:function(t,e,n){"use strict";n(1331)},2678:function(t,e,n){"use strict";n(1336)},2679:function(t,e,n){"use strict";n(1337)},268:function(t,e,n){"use strict";n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2);n(10),n(14);function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var c=n(3),d=(n(20),n(16),n(47),n(19),n(36),n(125),n(18),n(30)),h=n(92),v=n(106),m=n(33),f=n(5),_=n(115),y=n(1),w=n(129),C=n(21);function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var x={mixins:[m.a],components:{ImgWaterFall:h.a,listCheckbox:_.a,AdminTag:v.a},props:{fromPage:{type:String,default:""},item:{type:Object,default:function(){}},list:{type:Array,default:function(){return[]}},isCheck:{type:Boolean,default:!1},dotReportInfo:{type:Object,default:function(){return{category:"default",view_domain:"",batch_id:""}}},isOpenNewTab:{type:Boolean,default:!1},review:{type:Boolean,default:!1}},data:function(){var t;return{isPersonal:null===(t=this.$route.meta)||void 0===t?void 0:t.isPersonal,formatNumberForeign:f.i,cntShow:!0,deleteLoad:!1,hasHover:!1,videoBgShow:!0}},computed:O(O(O({},Object(y.c)("user",["isLoggedIn"])),Object(y.e)("user",["userInfo"])),{},{isMine:function(){var t,e;return(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)==(null===(e=this.userInfo)||void 0===e?void 0:e.id)},setNsfwPlus:function(){return function(t){var e,n;return!(null==t||!t.nsfw_plus)&&(null===(e=this.userInfo)||void 0===e||!e.enable_nsfw_plus||[2,"2"].includes(null===(n=this.userInfo)||void 0===n||null===(n=n.settings)||void 0===n?void 0:n.nsfw_plus))}}}),methods:{isMP4Link:function(){var link=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!link||link.toLowerCase().endsWith(".mp4")},isGifLink:function(){var link=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!link&&link.toLowerCase().endsWith(".gif")},onPlayFun:function(){this.$refs.myVideo&&(this.$refs.myVideo.play(),this.$refs.myVideo.style.opacity=1,this.$refs.myVideo.paused||(this.videoBgShow=!1)),!this.hasHover&&this.onPause()},onPlay:function(){this.hasHover=!0,this.onPlayFun()},onPause:function(){this.hasHover=!1,this.$refs.myVideo&&(this.$refs.myVideo.pause(),this.$refs.myVideo.currentTime=0,this.$refs.myVideo.style.opacity=0),this.videoBgShow=!0},moreActions:function(t){switch(t){case"delete":this.$emit("moreActions","delete",this.item);break;case"pinOrNot":this.$emit("moreActions","pinOrNot",this.item)}},handleReport:function(t){var e=this.list.findIndex((function(i){return i.id===t.id})),n=(e<10?this.list.slice(0,e):this.list.slice(e-10,e)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));Object(d.g)({items:[O(O({},this.dotReportInfo),{},{negative_ids:n,action:"view",obj_no:t.id,obj_type:t.obj_type})]})},handleMouseUp:function(t,e){2!==t.which&&1!==t.button||this.handleReport(e)},handleDetail:function(t,e){var n=this;return Object(c.a)(regeneratorRuntime.mark((function o(){var r,l,c,d,h,v;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:c="string"==typeof t.target.className&&(null===(r=t.target.className)||void 0===r?void 0:r.includes("boxItem")),d=["green-mode-div","ImgWaterFall","cnt","title","rate","numItem","user"],("IMG"===t.target.tagName||c||d.includes(t.target.className)||null!==(l=t.target.className)&&void 0!==l&&l.includes("jiedian"))&&(1!=(null===(h=e.comfy_ui)||void 0===h?void 0:h.type)&&2!=(null===(v=e.comfy_ui)||void 0===v?void 0:v.type)?(n.handleReport(e),n.isOpenNewTab?window.open("/workFlowAppDetail/"+e.id,"_blank"):n.$router.push(n.localePath("/workFlowAppDetail/"+e.id))):(n.handleReport(e),n.isOpenNewTab?window.open("/workFlowDetail/"+e.id,"_blank"):n.$router.push(n.localePath("/workFlowDetail/"+e.id))));case 3:case"end":return o.stop()}}),o)})))()},handleClick:function(t){var e,n;if(this.isLoggedIn)if(1!=(null===(e=t.comfy_ui)||void 0===e?void 0:e.type)&&2!=(null===(n=t.comfy_ui)||void 0===n?void 0:n.type))this.isOpenNewTab?window.open("/workFlowAppDetail/"+t.id,"_blank"):this.$router.push(this.localePath("/workFlowAppDetail/"+t.id));else{var o,r,source=4;this.userInfo&&(null===(o=this.userInfo)||void 0===o?void 0:o.id)==(null==t||null===(r=t.author)||void 0===r?void 0:r.id)&&(source=3),this.isOpenNewTab?window.open("/workflow?id=".concat(t.id,"&source=").concat(source),"_blank"):this.$router.push(this.localePath("/workflow?id="+t.id+"&source=".concat(source)));var l=t.id,c=t.obj_type,d=t.pt;this.$logEvent("log_actions",{operation:"same_create",behavior_info:l,obj_type:c,behavior_info_sub:d})}else this.$EventBus.$emit("openLoginDialog")},otherUser:function(t){var path="/user/"+encodeURIComponent(t.author.id);this.userInfo.id==t.author.id&&(path="/personal"),window.open(this.localePath(path),"_blank")},onDelete:function(t){var e=this;this.$confirm(this.$t("comfyDeleteErrTip"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){if(!e.deleteLoad){e.deleteLoad=!0;var n={id:t.id};Object(w.a)(n).then((function(n){if(1e4===n.status.code)e.setWaterFallDeleteLits(t.id),e.$emit("resizeListener"),e.$message({type:"success",message:e.$t("deleteSuccess")});else if(150006===n.status.code){var link="https://aihelp.net/questionnaire/#/?formId=9b11c5ac84f4482bae17e6a23df0ab37";"zhCN"==e.$i18n.locale&&(link="https://aihelp.net/questionnaire/#/?formId=9bc3744979f943dda31a09f7573f80d2"),window.open(link)}else e.$message.error(e.$t("ServerError"))})).finally((function(){e.deleteLoad=!1}))}})).catch((function(){}))},tagChange:function(){this.$emit("change")},handlePopoverShow:function(){var t=this;if("userPage"===this.fromPage){var e=this.item,n=e.id,o=e.obj_type;Object(C.M)({obj_id:n,obj_type:o}).then((function(e){var n,o;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&t.$set(t.item,"isTop",null==e||null===(o=e.data)||void 0===o?void 0:o.is_top)}))}}}},I=x,D=(n(2321),n(0)),component=Object(D.a)(I,(function(){var t,e,n,o,r,c,d,h,v,m,f,_,y,w,C,k,O,x,I,D,S,P,L,j,$,T,B,M=this,R=M._self._c;return R("a",{attrs:{href:1!=(null===(t=M.item.comfy_ui)||void 0===t?void 0:t.type)&&2!=(null===(e=M.item.comfy_ui)||void 0===e?void 0:e.type)?M.localePath("/workFlowAppDetail/"+M.item.id):M.localePath("/workFlowDetail/"+M.item.id),target:"_blank"},on:{click:function(t){t.preventDefault(),!M.isCheck&&M.handleDetail(t,M.item)},mouseup:function(t){return M.handleMouseUp(t,M.item)},mouseover:function(t){M.cntShow=!0}}},[R("div",{staticClass:"defBox",class:{"bg-nsfw":1===M.item.nsfw,boxItem:!M.setNsfwPlus(M.item)},style:{width:M.item.waterWidth+"px",height:M.item.waterHeight+"px"},on:{mouseenter:function(t){!M.isCheck&&M.onPlay()},mouseleave:function(t){!M.isCheck&&M.onPause()}}},[M.isCheck&&M.item?R("listCheckbox",{on:{change:function(t){return M.$emit("checkChange")}},model:{value:M.item.isCheck,callback:function(t){M.$set(M.item,"isCheck",t)},expression:"item.isCheck"}}):M._e(),M._v(" "),R("div",{directives:[{name:"show",rawName:"v-show",value:M.item.NSFWSHOW&&[2,"2"].includes(null===(n=M.userInfo)||void 0===n||null===(n=n.settings)||void 0===n?void 0:n.nsfw_plus),expression:"item.NSFWSHOW && [2, '2'].includes(userInfo?.settings?.nsfw_plus)"}],staticClass:"NSFWSHOW",style:{right:null!==(o=M.item)&&void 0!==o&&o.nsfw_plus?"10px":"75px",opacity:null!==(r=M.item)&&void 0!==r&&r.nsfw_plus?1:0},on:{click:function(t){var e;t.preventDefault(),t.stopPropagation(),M.item.nsfw_plus=!(null!==(e=M.item)&&void 0!==e&&e.nsfw_plus)}}},[R("i",{staticClass:"iconfont",class:null!==(c=M.item)&&void 0!==c&&c.nsfw_plus?"icon-work-show":"icon-work-hide"})]),M._v(" "),M.item.nsfw?R("ImgWaterFall",{directives:[{name:"show",rawName:"v-show",value:!M.isMP4Link(null===(d=M.item)||void 0===d||null===(d=d.comfy_ui)||void 0===d?void 0:d.cover)||M.isMP4Link(null===(h=M.item)||void 0===h||null===(h=h.comfy_ui)||void 0===h?void 0:h.cover)&&!M.hasHover&&M.videoBgShow,expression:"!isMP4Link(item?.comfy_ui?.cover) || (isMP4Link(item?.comfy_ui?.cover) && !hasHover && videoBgShow)"}],style:{transform:M.item.isCheck?"scale(0.85)":null,transition:"all 0.3s ease-in-out",filter:M.setNsfwPlus(M.item)?"blur(19px) saturate(160%)":""},attrs:{item:l(l({},M.item||{}),{},{replaceUrl:M.isGifLink(null===(v=M.item)||void 0===v||null===(v=v.comfy_ui)||void 0===v?void 0:v.cover)?null===(m=M.item)||void 0===m||null===(m=m.comfy_ui)||void 0===m?void 0:m.cover:""})}}):M._e(),M._v(" "),M.item.nsfw&&M.isMP4Link(null===(f=M.item)||void 0===f||null===(f=f.comfy_ui)||void 0===f?void 0:f.cover)?R("video",{ref:"myVideo",style:{filter:M.setNsfwPlus(M.item)?"blur(19px) saturate(160%)":""},attrs:{loop:"",muted:"",src:null===(_=M.item)||void 0===_||null===(_=_.comfy_ui)||void 0===_?void 0:_.cover,preload:"none"},domProps:{muted:!0}}):M._e(),M._v(" "),R("div",{staticClass:"waterfall-hover-try",on:{click:function(t){return t.preventDefault(),M.handleClick(M.item)}}},[M._v(M._s(M.$t("Try")))]),M._v(" "),R("div",{directives:[{name:"show",rawName:"v-show",value:M.isLoggedIn,expression:"isLoggedIn"}],staticClass:"cltpop"}),M._v(" "),[1,2].includes(null===(y=M.item.comfy_ui)||void 0===y?void 0:y.type)&&1==(null===(w=M.item.comfy_ui)||void 0===w?void 0:w.run_available)?R("i",{staticClass:"iconfont icon-icon_jiedian boxItemjidian"}):M._e(),M._v(" "),R("div",{staticClass:"cnt"},[R("div",{staticClass:"user"},[null!==(C=M.item.author)&&void 0!==C&&C.head?R("div",{staticClass:"authorHead",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),M.otherUser(M.item)}}},[R("img",{directives:[{name:"webp",rawName:"v-webp",value:M.$imgL,expression:"$imgL"}],attrs:{src:null===(k=M.item.author)||void 0===k?void 0:k.head,alt:""}})]):R("div",{staticClass:"authorHead",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),M.otherUser(M.item)}}},[M._v(M._s(null===(O=M.item.author)||void 0===O?void 0:O.name[0]))]),M._v(" "),R("span",{staticClass:"authorName",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),M.otherUser(M.item)}}},[M._v(M._s(null===(x=M.item.author)||void 0===x?void 0:x.name))])]),M._v(" "),R("div",{staticClass:"title"},[M._v(M._s(null===(I=M.item.comfy_ui)||void 0===I?void 0:I.name))]),M._v(" "),null!==(D=M.item)&&void 0!==D&&null!==(D=D.stat)&&void 0!==D&&D.rating?R("div",{staticClass:"rate"},[R("el-rate",{attrs:{disabled:""},model:{value:M.item.stat.rating,callback:function(t){M.$set(M.item.stat,"rating",t)},expression:"item.stat.rating"}}),M._v(" "),R("span",[M._v(M._s(M.item.stat.rating))])],1):M._e(),M._v(" "),R("div",{staticClass:"numItem"},[R("div",{staticClass:"play",on:{click:function(t){t.stopPropagation(),t.preventDefault(),!M.isCheck&&M.handleClick(M.item)}}},[R("i",{staticClass:"iconfont icon-play"}),M._v(" "),null!==(S=M.item.stat)&&void 0!==S&&S.num_of_task?R("span",[M._v(M._s(M.formatNumberForeign(null===(P=M.item.stat)||void 0===P?void 0:P.num_of_task)))]):M._e()]),M._v(" "),M.cntShow?R("div",{staticClass:"funItem",on:{click:function(t){var e,n;return t.stopPropagation(),t.preventDefault(),M.setCollect(M.item,1!=(null===(e=M.item.comfy_ui)||void 0===e?void 0:e.type)&&2!=(null===(n=M.item.comfy_ui)||void 0===n?void 0:n.type)?"swtft_app":"workflow")}}},[R("i",{staticClass:"iconfont",class:M.setCollectData(M.item)}),M._v(" "),null!==(L=M.item.stat)&&void 0!==L&&L.num_of_collection?R("span",[M._v(M._s(M.item.stat.num_of_collection))]):M._e()]):R("div",{staticClass:"funItem"},[R("i",{staticClass:"iconfont",class:M.item.collect?"icon-collect_selected":"icon-collect"}),M._v(" "),null!==(j=M.item.stat)&&void 0!==j&&j.num_of_collection?R("span",[M._v(M._s(M.item.stat.num_of_collection))]):M._e()]),M._v(" "),R("div",{staticClass:"funItem jiedian"},[R("i",{staticClass:"iconfont icon-icon_jiedian jiedian"}),M._v(" "),null!==($=M.item.comfy_ui)&&void 0!==$&&$.node_num?R("span",{staticClass:"jiedian"},[M._v(M._s(M.formatNumberForeign(null===(T=M.item.comfy_ui)||void 0===T?void 0:T.node_num)))]):M._e()]),M._v(" "),M.isPersonal?R("el-popover",{ref:"myPopover",attrs:{placement:"top-end","popper-class":"water-fall-popover","append-to-body":!0,"visible-arrow":!1,width:"100",trigger:"hover"},on:{show:M.handlePopoverShow}},[R("div",{staticClass:"pop-btns flex"},[R("button",{directives:[{name:"show",rawName:"v-show",value:"userPage"==M.fromPage&&M.isMine,expression:"fromPage == 'userPage' && isMine"}],on:{click:function(t){return t.preventDefault(),M.moreActions("pinOrNot")}}},[M._v("\n              "+M._s(M.$t(null!==(B=M.item)&&void 0!==B&&B.isTop?"UnpinOverview":"PinOverview"))+"\n            ")]),M._v(" "),R("button",{directives:[{name:"show",rawName:"v-show",value:3!=M.item.status&&M.isMine,expression:"item.status != 3 && isMine"}],on:{click:function(t){return t.preventDefault(),M.moreActions("delete")}}},[M._v("\n              "+M._s(M.$t("Delete"))+"\n            ")])]),M._v(" "),R("div",{staticClass:"funItem more-btn-opacity",attrs:{slot:"reference"},slot:"reference"},[R("i",{staticClass:"iconfont icon-more"})])]):M._e()],1)])],1),M._v(" "),R("admin-tag",{attrs:{id:M.item.id,item:M.item,type:M.item.obj_type,review:M.review},on:{change:M.tagChange}})],1)}),[],!1,null,"d998d1be",null);e.a=component.exports},2681:function(t,e,n){"use strict";n(1339)},2682:function(t,e,n){"use strict";n(1340)},2683:function(t,e,n){"use strict";n(1341)},2684:function(t,e,n){"use strict";n(1342)},2685:function(t,e,n){"use strict";n(1343)},2686:function(t,e,n){"use strict";n(1344)},2687:function(t,e,n){"use strict";n(1345)},2688:function(t,e,n){"use strict";n(1346)},2689:function(t,e,n){"use strict";n(1347)},2690:function(t,e,n){"use strict";n(1348)},2691:function(t,e,n){"use strict";n(1349)},2692:function(t,e,n){"use strict";n(1350)},2693:function(t,e,n){"use strict";n(1351)},2694:function(t,e,n){"use strict";n(1352)},2695:function(t,e,n){"use strict";n(1353)},2696:function(t,e,n){"use strict";n(1354)},2697:function(t,e,n){"use strict";n(1355)},2698:function(t,e,n){"use strict";n(1356)},2699:function(t,e,n){"use strict";n(1357)},2700:function(t,e,n){"use strict";n(1358)},2701:function(t,e,n){"use strict";n(1359)},2702:function(t,e,n){"use strict";n(1360)},2703:function(t,e,n){"use strict";n(1361)},2704:function(t,e,n){"use strict";n(1362)},2705:function(t,e,n){"use strict";n(1363)},2706:function(t,e,n){"use strict";n(1364)},2707:function(t,e,n){"use strict";n(1365)},2708:function(t,e,n){"use strict";n(1366)},2709:function(t,e,n){"use strict";n(1367)},2711:function(t,e,n){"use strict";n(1368)},2713:function(t,e,n){"use strict";n(1369)},2714:function(t,e,n){"use strict";n(1370)},2715:function(t,e,n){"use strict";n(1371)},2716:function(t,e,n){"use strict";n(1372)},2717:function(t,e,n){"use strict";n(1373)},2718:function(t,e,n){"use strict";n(1374)},2719:function(t,e,n){"use strict";n(1375)},2720:function(t,e,n){"use strict";n(1376)},2721:function(t,e,n){"use strict";n(1377)},2722:function(t,e,n){"use strict";n(1378)},2723:function(t,e,n){"use strict";n(1379)},2724:function(t,e,n){"use strict";n(1380)},2785:function(t,e,n){"use strict";n(1438)},2786:function(t,e,n){"use strict";n(1439)},2787:function(t,e,n){"use strict";n(1440)},2788:function(t,e,n){"use strict";n(1441)},2789:function(t,e,n){"use strict";n(1442)},2790:function(t,e,n){"use strict";n(1443)},2791:function(t,e,n){"use strict";n(1444)},2792:function(t,e,n){"use strict";n(1445)},2793:function(t,e,n){"use strict";n(1446)},2794:function(t,e,n){"use strict";n(1447)},2795:function(t,e,n){"use strict";n(1448)},2796:function(t,e,n){"use strict";n(1449)},2797:function(t,e,n){"use strict";n(1450)},2798:function(t,e,n){"use strict";n(1451)},2799:function(t,e,n){"use strict";n(1452)},2800:function(t,e,n){"use strict";n(1453)},2801:function(t,e,n){"use strict";n(1454)},2802:function(t,e,n){"use strict";n(1455)},2803:function(t,e,n){"use strict";n(1456)},2804:function(t,e,n){"use strict";n(1457)},2805:function(t,e,n){"use strict";n(1458)},2806:function(t,e,n){"use strict";n(1459)},2807:function(t,e,n){"use strict";n(1460)},2808:function(t,e,n){"use strict";n(1461)},2809:function(t,e,n){"use strict";n(1462)},2810:function(t,e,n){"use strict";n(1463)},2811:function(t,e,n){"use strict";n(1464)},2812:function(t,e,n){"use strict";n(1465)},2813:function(t,e,n){"use strict";n(1466)},2814:function(t,e,n){"use strict";n(1467)},2815:function(t,e,n){"use strict";n(1468)},2816:function(t,e,n){"use strict";n(1469)},2817:function(t,e,n){"use strict";n(1470)},2818:function(t,e,n){"use strict";n(1471)},2819:function(t,e,n){"use strict";n(1472)},2820:function(t,e,n){"use strict";n(1473)},2821:function(t,e,n){"use strict";n(1474)},2822:function(t,e,n){"use strict";n(1475)},2824:function(t,e,n){"use strict";n(1477)},2825:function(t,e,n){"use strict";n(1478)},2826:function(t,e,n){"use strict";n(1479)},2827:function(t,e,n){"use strict";n(1480)},2828:function(t,e,n){"use strict";n(1481)},2829:function(t,e,n){"use strict";n(1482)},2830:function(t,e,n){"use strict";n(1483)},2831:function(t,e,n){"use strict";n(1484)},2833:function(t,e,n){"use strict";n(1485)},2834:function(t,e,n){"use strict";n(1486)},2835:function(t,e,n){"use strict";n(1487)},2836:function(t,e,n){"use strict";n(1488)},2837:function(t,e,n){"use strict";n(1489)},2838:function(t,e,n){"use strict";n(1490)},2839:function(t,e,n){"use strict";n(1491)},2840:function(t,e,n){"use strict";n(1492)},2843:function(t,e,n){"use strict";n(1494)},2844:function(t,e,n){"use strict";n(1495)},2845:function(t,e,n){"use strict";n(1496)},2846:function(t,e,n){"use strict";n(1497)},2847:function(t,e,n){"use strict";n(1498)},2848:function(t,e,n){"use strict";n(1499)},2849:function(t,e,n){"use strict";n(1500)},2850:function(t,e,n){"use strict";n(1501)},2852:function(t,e,n){"use strict";n(1503)},2853:function(t,e,n){"use strict";n(1504)},2854:function(t,e,n){"use strict";n(1505)},2855:function(t,e,n){"use strict";n(1506)},2856:function(t,e,n){"use strict";n(1507)},2857:function(t,e,n){"use strict";n(1508)},2858:function(t,e,n){"use strict";n(1509)},2859:function(t,e,n){"use strict";n(1510)},2860:function(t,e,n){"use strict";n(1511)},2862:function(t,e,n){"use strict";n(1512)},2863:function(t,e,n){"use strict";n(1513)},2864:function(t,e,n){"use strict";n(1514)},2865:function(t,e,n){"use strict";n(1515)},2866:function(t,e,n){"use strict";n(1516)},2867:function(t,e,n){"use strict";n(1517)},2868:function(t,e,n){"use strict";n(1518)},2869:function(t,e,n){"use strict";n(1519)},2907:function(t,e,n){"use strict";n(1557)},2908:function(t,e,n){"use strict";n(1558)},2909:function(t,e,n){"use strict";n(1559)},2910:function(t,e,n){"use strict";n(1560)},2911:function(t,e,n){"use strict";n(1563)},2919:function(t,e,n){"use strict";n(1571)},2971:function(t,e,n){"use strict";n(1623)},2972:function(t,e,n){"use strict";n(1624)},2973:function(t,e,n){"use strict";n(1625)},2974:function(t,e,n){"use strict";n(1626)},2975:function(t,e,n){"use strict";n(1627)},3147:function(t,e,n){"use strict";n(1788)},3243:function(t,e,n){"use strict";n.r(e);n(9),n(11),n(12);var o=n(15),r=n(31),l=n(3),c=n(2),d=(n(20),n(16),n(7),n(32),n(47),n(10),n(19),n(36),n(43),n(14),n(28),n(8),n(4),n(23),n(49),n(18),n(50),n(118),n(318),n(37),n(71),n(6),n(48),n(29),n(208)),h=n(1),v=n(22),m=n(236),f={name:"importImageModal",inject:["top"],data:function(){return{visible:!1,linkInput:"",uploading:!1}},mounted:function(){},methods:{openModal:function(){this.resetData(),this.visible=!0,document.removeEventListener("keydown",this.top.handleKeydown)},handleClose:function(){this.resetData(),document.addEventListener("keydown",this.top.handleKeydown),this.visible=!1},handleConfirm:function(){},resetData:function(){this.linkInput="",this.uploading=!1},handleLinkUpload:function(){var t=this;if(!this.linkInput||!this.linkInput.includes("explore/detail/"))return this.$message.warning(this.$t("workLinkError"));this.uploading=!0;var e=this.linkInput.split("explore/detail/")[1];Object(m.a)({id:e}).then((function(e){var n;e.data.meta.lora_models=(null===(n=e.data.models)||void 0===n?void 0:n.filter((function(t){return"LORA"===t.type})))||[];var o={art_model_no:e.data.model_id,meta:e.data.meta,width:e.data.width,height:e.data.height};t.$emit("imageChange",{url:e.data.banner.url,params:o}),t.handleClose()})).catch((function(e){return t.$message.warning(t.$t("workLinkError"))})).finally((function(){t.uploading=!1}))}}},_=(n(2785),n(0)),y=Object(_.a)(f,(function(){var t=this,e=t._self._c;return e("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.uploading,expression:"uploading"}],attrs:{title:t.$t("importWork"),visible:t.visible,width:"441px","custom-class":"c-import-image-modal custom-modal","append-to-body":"","before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e}}},[e("div",{staticClass:"import-image-modal-describe"},[t._v(t._s(t.$t("importLink")))]),t._v(" "),e("div",{staticClass:"import-image-modal-input"},[e("el-input",{attrs:{placeholder:"https://seaart.com..."},model:{value:t.linkInput,callback:function(e){t.linkInput=e},expression:"linkInput"}})],1),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{staticClass:"cancel-btn",on:{click:t.handleClose}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{staticClass:"confirm-btn",attrs:{type:"primary"},on:{click:t.handleLinkUpload}},[t._v(t._s(t.$t("Confirm")))])],1)])}),[],!1,null,null,null).exports,w=n(38),C=n(45),k={inject:["top"],components:{importImageModal:y},props:{isAct:{type:Boolean,default:!1},isDisable:{type:Boolean,default:!1}},data:function(){return{UPLOAD:null}},watch:{"top.paintingBoardData.liveModel.show":{handler:function(t){var e=t?34:33;this.UPLOAD=new w.a({type:e})},immediate:!0}},mounted:function(){this.top.eventFn.uploadImg=this.uploadImg},methods:{uploadImg:function(t){var e=this,n=new FileReader,o=this.top.paintingBoardData.liveModel.show;this.top.processStep={step:"start",process:0,text:"uploading"},n.readAsDataURL(t.file),n.onload=Object(l.a)(regeneratorRuntime.mark((function r(){var l,c,d;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return l="",c="",r.prev=2,r.next=5,e.top.addLayerItem({type:o?"liveImgLayer":"imgLayer",loading:!0,imgSrc:n.result});case 5:if(c=r.sent,!((d=t.file).size/1024/1024>5)){r.next=18;break}return r.prev=8,r.next=11,Object(C.a)(d,5242880);case 11:d=r.sent,r.next=18;break;case 14:return r.prev=14,r.t0=r.catch(8),console.error("Compression failed:",r.t0),r.abrupt("return",!1);case 18:return r.next=20,e.UPLOAD.startUpload(d);case 20:l=r.sent,e.top.setLayerImg(c,l),e.top.processStep.step="end",r.next=31;break;case 25:r.prev=25,r.t1=r.catch(2),e.delLayer(c),e.top.changeLoadingStatus(!1),console.error("error:",r.t1),e.top.processStep.step="end";case 31:if(l){r.next=34;break}return e.top.changeLoadingStatus(!1),r.abrupt("return");case 34:e.top.eventFn.setBoardYesDage(),e.top.eventFn.setViewYesDage(!1),e.$emit("onClick",{type:"selectEments"}),e.top.changeLoadingStatus(!1),e.$logEvent("log_actions",{operation:"click_importArimg_page_operation",behavior_info:"on_canvas_detail_page"});case 39:case"end":return r.stop()}}),r,null,[[2,25],[8,14]])}))),n.onerror=function(t){console.error("文件读取失败:",t.target.error),e.top.changeLoadingStatus(!1)}},delLayer:function(t){var e=this.top.paintingBoardData,n=e.elementList,o=e.liveLayerList,r=n.filter((function(e){return e.layerId!=t})),l=o.filter((function(e){return e.layerId!=t}));this.top.changeData("elementList",r),this.top.changeData("liveLayerList",l)},handleOpenImportModal:function(){this.$refs.importImageModal.openModal()},handleAddImage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},param={type:this.top.paintingBoardData.liveModel.show?"liveImgLayer":"imgLayer",imgSrc:t.url||"",params:t.params};this.top.addLayerItem(param),this.top.eventFn.setBoardYesDage(),this.top.eventFn.setViewYesDage(!1),this.$emit("onClick",{type:"selectEments"}),this.$logEvent("log_actions",{operation:"click_linkArimg_page_operation",behavior_info:"on_canvas_detail_page"})}}},O=k,x=(n(2786),n(2787),Object(_.a)(O,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"action-item",class:[t.isAct&&"act-item",t.isDisable&&"disable-item"]},[e("el-popover",{attrs:{trigger:"click",disabled:t.isDisable}},[e("div",{staticClass:"top-select-list"},[e("div",{staticClass:"item flex_m"},[e("el-upload",{attrs:{accept:".jpeg, .png, .jpg, .bmp, .webp",action:"*","http-request":t.uploadImg,"show-file-list":!1}},[e("div",{staticClass:"upitem flex_m"},[e("i",{staticClass:"iconfont icon-icon_bendi"}),t._v(" "),e("p",[t._v(t._s(t.$t("canvas_import_tips")))])])])],1),t._v(" "),e("div",{staticClass:"item flex_m",on:{click:t.handleOpenImportModal}},[e("i",{staticClass:"iconfont icon-a-copylink"}),t._v(" "),e("p",[t._v(t._s(t.$t("canvas_SeaArt_tips")))])])]),t._v(" "),e("el-tooltip",{attrs:{slot:"reference",effect:"dark",content:t.$t("ImportImage"),placement:"bottom"},slot:"reference"},[e("div",{staticClass:"icon-box flex_c_m"},[e("i",{staticClass:"iconfont icon-icon_daoru"})])])],1),t._v(" "),e("import-image-modal",{ref:"importImageModal",on:{imageChange:t.handleAddImage}})],1)}),[],!1,null,"40a6801a",null).exports);function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var S={props:{placement:{type:String,default:"bottom"},content:{type:String,default:""},shortcutKey:{type:String,default:""},videoUrl:{type:String,default:""}},computed:D(D({},Object(h.c)("user",["cdnHostFun"])),{},{initVideoUrl:function(){if(this.videoUrl)return"https://".concat(this.cdnHostFun(),"/").concat(this.videoUrl)}})},P=(n(2788),n(2789),Object(_.a)(S,(function(){var t=this,e=t._self._c;return e("el-tooltip",{attrs:{effect:"dark",placement:t.placement,"open-delay":500}},[t._t("default"),t._v(" "),e("div",{staticClass:"tooltip-video",attrs:{slot:"content"},slot:"content"},[e("div",{staticClass:"tooltip-video-title"},[e("span",[t._v(t._s(t.$t(t.content)))]),t._v(" "),t.shortcutKey?e("span",{staticClass:"shortcut-key"},[t._v(t._s(t.shortcutKey))]):t._e()]),t._v(" "),t.videoUrl?e("video",{staticClass:"tooltip-video-item",attrs:{src:t.initVideoUrl,autoplay:"",loop:"",preload:"",muted:""},domProps:{muted:!0}}):t._e()])],2)}),[],!1,null,"55ea8a94",null).exports),L=n(34),j={components:{TopToolTips:P},inject:["top"],props:{isAct:{type:Boolean,default:!1},isDisable:{type:Boolean,default:!1}},data:function(){return{}},methods:{actBoard:function(){this.isDisable||(this.top.eventFn.setBoardYesDage(),this.top.eventFn.setViewYesDage(!1),L.a.emit("setLiveMoveable",{draggable:!0}),L.a.emit("setLiveViewer",{useMouseDrag:!1}),this.$emit("onClick",{type:"selectEments"}))}}},$=(n(2790),Object(_.a)(j,(function(){var t=this,e=t._self._c;return e("TopToolTips",{attrs:{content:"MoveSelect",shortcutKey:"V"}},[e("div",{staticClass:"action-item",class:[t.isAct&&"act-item",t.isDisable&&"disable-item"]},[e("div",{staticClass:"icon-box flex_c_m",attrs:{id:"event_selectEments"},on:{click:t.actBoard}},[e("i",{staticClass:"iconfont icon-a-icon_xuanzeStroke"})])])])}),[],!1,null,"17bafa12",null).exports),T={components:{TopToolTips:P},inject:["top"],props:{isAct:{type:Boolean,default:!1},isDisable:{type:Boolean,default:!1}},data:function(){return{}},methods:{setDragBoard:function(){this.isDisable||(this.top.eventFn.setBoardNoDage(),this.top.eventFn.setViewYesDage(!0),this.top.initLiveLayerActive(),L.a.emit("setLiveMoveable",{draggable:!1}),L.a.emit("setLiveViewer",{useMouseDrag:!0}),this.$emit("onClick",{type:"handBoardel"}))}}},B=(n(2791),Object(_.a)(T,(function(){var t=this,e=t._self._c;return e("TopToolTips",{attrs:{content:"HandTool",shortcutKey:"Space"}},[e("div",{staticClass:"action-item",class:[t.isAct&&"act-item",t.isDisable&&"disable-item"]},[e("div",{staticClass:"icon-box flex_c_m",attrs:{id:"event_handBoardel"},on:{click:t.setDragBoard}},[e("i",{staticClass:"iconfont icon-zhuashou-copy"})])])])}),[],!1,null,"77d78438",null).exports),M={components:{TopToolTips:P},inject:["top"],props:{isAct:{type:Boolean,default:!1},isDisable:{type:Boolean,default:!1}},data:function(){return{}},methods:{addImgAibox:function(){this.top.paintingBoardData.liveModel.show?this.$message.warning(this.$t("liveAiimgTips")):(this.initGanerateInfo(),this.top.eventFn.setBoardYesDage(),this.top.eventFn.setViewYesDage(!1),this.$emit("onClick",{type:"updateArimg"}))},initGanerateInfo:function(){var t=this.top.paintingBoardData.generateInfo;t.loading=!1,t.process=0}}},R=(n(2792),Object(_.a)(M,(function(){var t=this,e=t._self._c;return e("TopToolTips",{attrs:{content:"GenerateImage",shortcutKey:"G",videoUrl:"20240226/4a637f41-14d1-4755-b18c-d0d1710690db.mov"}},[e("div",{staticClass:"action-item",class:[t.isAct&&"act-item",t.isDisable&&"disable-item"]},[e("div",{staticClass:"icon-box flex_c_m",class:t.top.paintingBoardData.liveModel.show&&"disable-dom",attrs:{id:"event_updateArimg"},on:{click:t.addImgAibox}},[e("i",{staticClass:"iconfont icon-icon_shengtu"})])])])}),[],!1,null,"27873faf",null).exports),A=(n(1414),n(44),n(676)),E={inject:["top"],props:{type:{type:String,default:""},toolName:{type:String,default:"brushTool"},item:{type:Object,default:function(){return{}}},showColor:{type:Boolean,default:!0}},components:{ElColorPicker:n.n(A).a},data:function(){return{hasAct:"brush",sliderval:20,colorList:[{color:"#000000"},{color:"#E05634"},{color:"#FDA836"},{color:"#F7CF51"},{color:"#50AB64"},{color:"#4497F7"},{color:"#8D4BF6"},{color:"#FFFFFF"}],colorVal:"#409EFF",colorIndex:0}},mounted:function(){var t,e=this.top.paintingBoardData.topNav.tools[this.toolName],n=e&&(null===(t=e[this.type])||void 0===t?void 0:t.wide)||20;this.sliderval=n},computed:{isLiveMode:function(){return this.top.paintingBoardData.liveModel.show}},methods:{changVal:function(t){var e=isNaN(Number(t));this.sliderval=e?20:Number(t)>20?Number(t):20;var n="topNav.tools.".concat(this.toolName,".").concat(this.type,".wide");this.top.changeData(n,t)},changType:function(t){this.hasAct=t,"daubTool"===this.toolName&&this.isLiveMode&&"segment"===t&&(this.hasAct="brush"),"eraserTool"===this.toolName&&this.isLiveMode&&"eraser"===t&&(this.hasAct="brush");var e="topNav.tools.".concat(this.toolName,".").concat(this.type,".hasAct");this.top.changeData(e,this.hasAct),this.$emit("onChange",{type:t,toolName:this.type})},changeColor:function(t){var e="topNav.tools.".concat(this.toolName,".").concat(this.type,".color");this.top.changeData(e,t)},colorMark:function(){}}},N=(n(2793),n(2794),Object(_.a)(E,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"color-max-box"},[e("div",{staticClass:"top-item flex_c_m"},[e("div",{staticClass:"left flex"},["daubTool"===t.toolName?e("div",{staticClass:"item flex_c_m",class:"segment"===t.item.hasAct&&"act-item-top",on:{click:function(e){return t.changType("segment")}}},[e("el-tooltip",{attrs:{effect:"dark",content:t.$t("canvas_auto_hover"),placement:"bottom"}},[e("i",{staticClass:"iconfont icon-jianyiban",class:t.isLiveMode&&"disable-dom"})])],1):t._e(),t._v(" "),e("div",{staticClass:"item flex_c_m",class:"brush"===t.item.hasAct&&"act-item-top",on:{click:function(e){return t.changType("brush")}}},[["brushTool","eraserTool","daubTool"].includes(t.toolName)?e("el-tooltip",{attrs:{effect:"dark",content:"eraserTool"===t.toolName?t.$t("canvas_manualerase_hover"):t.$t("canvas_draw_hover"),placement:"bottom"}},[e("i",{staticClass:"iconfont icon-Brushhuabi"})]):t._e()],1),t._v(" "),e("div",{staticClass:"item flex_c_m",class:"eraser"===t.item.hasAct&&"act-item-top",on:{click:function(e){return t.changType("eraser")}}},[e("el-tooltip",{attrs:{effect:"dark",content:t.$t("canvas_erase_hover"),placement:"bottom"}},[["brushTool","daubTool"].includes(t.toolName)?e("i",{staticClass:"iconfont icon-a-xiangpicachuxiangpica"}):t._e()]),t._v(" "),e("el-tooltip",{attrs:{effect:"dark",content:t.$t("canvas_auto_hover"),placement:"bottom"}},["eraserTool"===t.toolName?e("i",{staticClass:"iconfont icon-jianyiban",class:t.isLiveMode&&"disable-dom"}):t._e()])],1)]),t._v(" "),e("div",{staticClass:"right flex_m"},[t._m(0),t._v(" "),e("div",{staticClass:"slider-item"},[e("el-slider",{attrs:{min:20,max:256},on:{change:t.changVal},model:{value:t.sliderval,callback:function(e){t.sliderval=e},expression:"sliderval"}})],1),t._v(" "),e("div",{staticClass:"slider-input flex_c_m"},[e("el-input",{staticClass:"item",on:{input:t.changVal},model:{value:t.sliderval,callback:function(e){t.sliderval=e},expression:"sliderval"}})],1)])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showColor,expression:"showColor"}],staticClass:"color-box flex_m"},[e("div",{staticClass:"left flex"},t._l(t.colorList,(function(n){return e("div",{key:n.color,staticClass:"item",class:t.item.color===n.color&&"act-item-top",style:{background:n.color},on:{click:function(e){return t.changeColor(n.color)}}})})),0),t._v(" "),e("div",{staticClass:"right flex"},[e("el-color-picker",{staticClass:"color-picker",attrs:{size:"mini"},on:{change:t.changeColor},model:{value:t.colorVal,callback:function(e){t.colorVal=e},expression:"colorVal"}})],1)])])}),[function(){var t=this._self._c;return t("div",{staticClass:"icon-huak flex_c_m"},[t("i",{staticClass:"iconfont icon-SVG1",attrs:{role:""}})])}],!1,null,"59961c80",null).exports),F={inject:["top"],props:{isAct:{type:Boolean,default:!1},isDisable:{type:Boolean,default:!1}},data:function(){return{visible:!1,brushType:"brushBoard",actItem:{}}},watch:{isAct:function(t){if(t){var e=this.top.paintingBoardData.topNav.tools.hasAct;this.brushType=e,this.actItem=this.top.paintingBoardData.topNav.tools.brushTool[e]}}},components:{ColorBoard:N,TopToolTips:P},computed:{liveInfo:function(){return this.top.paintingBoardData.liveModel},hasAct:function(){var t=this.top.paintingBoardData.topNav.tools.hasAct;return"brushBoard"===t||"brushImg"===t}},methods:{imgBrush:function(t){this.visible=!1,this.brushType=t;var e=this.top.paintingBoardData.topNav.tools.brushTool.brushImg;this.actItem=e,this.top.eventFn.setBoardNoDage(),this.top.eventFn.setViewYesDage(!1),this.$emit("onClick",{type:"brushImg"})},imgBoard:function(t){this.visible=!1,this.brushType=t;var e=this.top.paintingBoardData.topNav.tools.brushTool.brushBoard;this.actItem=e,this.top.eventFn.setBoardNoDage(),this.top.eventFn.setViewYesDage(!1),this.$emit("onClick",{type:"brushBoard"})},changeTool:function(t){var e=t.type,n=t.toolName;"eraser"===e&&"brushBoard"===n&&(L.a.emit("openEasyEraser"),L.a.emit("setLiveMoveable",{draggable:!1}),L.a.emit("setLiveViewer",{useMouseDrag:!1}))},handBrush:function(){if(!this.isDisable){this.top.eventFn.setBoardNoDage(),this.top.eventFn.setViewYesDage(!1);this.top.changeData("topNav.tools.brushTool.brushBoard.hasAct","brush"),this.$emit("onClick",{type:this.brushType})}}}},U=(n(2795),n(2796),Object(_.a)(F,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"action-item flex_c_m",class:[t.isAct&&"act-item",t.isDisable&&"disable-item"]},[e("i",{staticClass:"iconfont",class:"brushBoard"===t.brushType?"icon-icon_huabi":"icon-icon_gangbi",on:{click:t.handBrush}}),t._v(" "),e("el-popover",{attrs:{width:"196",trigger:"click",disabled:t.isDisable},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("div",{staticClass:"top-select-list"},[e("TopToolTips",{attrs:{placement:"right-end",content:"canvas_simple_pencil",shortcutKey:"P",videoUrl:"20240305/4c130217-6467-4ff5-b772-fb30d86d65be.mov"}},[e("div",{staticClass:"item flex_m",attrs:{id:"event_brushBoard"},on:{click:function(e){return t.imgBoard("brushBoard")}}},[e("i",{directives:[{name:"show",rawName:"v-show",value:"brushBoard"===t.brushType,expression:"brushType === 'brushBoard'"}],staticClass:"iconfont icon-gou"}),t._v(" "),e("i",{staticClass:"iconfont icon-icon_huabi"}),t._v(" "),e("p",{staticClass:"flex_m"},[e("span",[t._v(t._s(t.$t("canvas_simple_pencil")))]),t._v(" "),e("span",{staticClass:"shortcut-key"},[t._v("P")])])])]),t._v(" "),e("TopToolTips",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{placement:"right-end",content:"canvas_draw_edit",shortcutKey:"".concat(t.top.isMacOs," + P"),videoUrl:"20240305/e06f2cb4-3178-4746-8b97-e1957ef8293c.mov"}},[e("div",{staticClass:"item flex_m",attrs:{id:"event_brushImg"},on:{click:function(e){return t.imgBrush("brushImg")}}},[e("i",{directives:[{name:"show",rawName:"v-show",value:"brushImg"===t.brushType,expression:"brushType === 'brushImg'"}],staticClass:"iconfont icon-gou"}),t._v(" "),e("i",{staticClass:"iconfont icon-icon_gangbi"}),t._v(" "),e("p",{staticClass:"flex_m"},[e("span",[t._v(t._s(t.$t("canvas_draw_edit")))]),t._v(" "),e("span",{staticClass:"shortcut-key"},[t._v(t._s("".concat(t.top.isMacOs," + P"))+" ")])])])])],1),t._v(" "),e("div",{staticClass:"arrow-box flex_c_m",class:t.visible&&"icon-arrow_act",attrs:{slot:"reference"},slot:"reference"},[e("i",{staticClass:"el-icon-arrow-down"})])]),t._v(" "),!t.visible&&t.hasAct?e("div",{staticClass:"brush-style-box"},[e("color-board",{attrs:{type:t.brushType,item:t.actItem,toolName:"brushTool"},on:{onChange:t.changeTool}})],1):t._e()],1)}),[],!1,null,"90b26b90",null).exports),H={inject:["top"],props:{isAct:{type:Boolean,default:!1},isDisable:{type:Boolean,default:!1}},data:function(){return{visible:!1,brushType:"eraserBoard",actItem:{}}},watch:{isAct:function(t){if(t){var e=this.top.paintingBoardData.topNav.tools.hasAct;this.brushType=e,this.actItem=this.top.paintingBoardData.topNav.tools.eraserTool[e]}}},components:{ColorBoard:N,TopToolTips:P},computed:{hasAct:function(){var t=this.top.paintingBoardData.topNav.tools.hasAct;return"eraserBoard"===t||"eraserAiBoard"===t}},methods:{imgBrush:function(t){if(!this.top.token)return this.$EventBus.$emit("openLoginDialog",{callBack:function(){window.location.reload()}});this.visible=!1,this.brushType=t;var e=this.top.paintingBoardData.topNav.tools.eraserTool.eraserAiBoard;this.actItem=e,this.top.eventFn.setBoardNoDage(),this.top.eventFn.setViewYesDage(!1),this.top.changeData("topNav.tools.eraserTool.eraserBoard.hasAct","brush"),this.$emit("onClick",{type:"eraserAiBoard"}),this.$logEvent("log_actions",{operation:"click_smart_deletion",behavior_info:"on_canvas"}),L.a.emit("setLiveMoveable",{draggable:!1}),L.a.emit("setLiveViewer",{useMouseDrag:!1})},imgBoard:function(t){this.visible=!1,this.brushType=t;var e=this.top.paintingBoardData.topNav.tools.eraserTool.eraserBoard;this.actItem=e,this.top.eventFn.setBoardNoDage(),this.top.eventFn.setViewYesDage(!1),this.top.changeData("topNav.tools.eraserTool.eraserAiBoard.hasAct","brush"),L.a.emit("openEasyEraser"),L.a.emit("setLiveMoveable",{draggable:!1}),L.a.emit("setLiveViewer",{useMouseDrag:!1}),this.$emit("onClick",{type:"eraserBoard"})},changeTool:function(t){var e=t.type,n=t.toolName;"brush"===e&&"eraserBoard"===n&&(L.a.emit("openEasyEraser"),L.a.emit("setLiveMoveable",{draggable:!1}),L.a.emit("setLiveViewer",{useMouseDrag:!1}))},handBrush:function(){this.isDisable||(this.top.eventFn.setBoardNoDage(),this.top.eventFn.setViewYesDage(!1),L.a.emit("openEasyEraser"),L.a.emit("setLiveMoveable",{draggable:!1}),L.a.emit("setLiveViewer",{useMouseDrag:!1}),this.$emit("onClick",{type:this.brushType}))}}},z=(n(2797),n(2798),Object(_.a)(H,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"action-item flex_c_m"},[e("div",{staticClass:"action-item flex_c_m",class:[t.isAct&&"act-item",t.isDisable&&"disable-item"]},[e("i",{staticClass:"iconfont",class:"eraserBoard"===t.brushType?"icon-icon_zidongcachu":"icon-icon_zidongcachu1",on:{click:t.handBrush}})]),t._v(" "),e("el-popover",{attrs:{width:"196",trigger:"click"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("div",{staticClass:"top-select-list"},[e("TopToolTips",{attrs:{placement:"right-end",content:"easyEraser",shortcutKey:"E",videoUrl:"20240207/b4760699-c147-462c-bb69-92f0f97dfecf.mov"}},[e("div",{staticClass:"item flex_m",attrs:{id:"event_eraserBoard"},on:{click:function(e){return t.imgBoard("eraserBoard")}}},[e("i",{directives:[{name:"show",rawName:"v-show",value:"eraserBoard"===t.brushType,expression:"brushType === 'eraserBoard'"}],staticClass:"iconfont icon-gou"}),t._v(" "),e("i",{staticClass:"iconfont icon-icon_zidongcachu"}),t._v(" "),e("p",{staticClass:"flex_m"},[e("span",[t._v(t._s(t.$t("easyEraser")))]),t._v(" "),e("span",{staticClass:"shortcut-key"},[t._v("E")])])])]),t._v(" "),e("TopToolTips",{attrs:{placement:"right-end",content:"aiEraser",shortcutKey:"".concat(t.top.isMacOs," + E"),videoUrl:"20240226/2ab1675f-a52f-498e-a03a-8ae903f71fb0.mov"}},[e("div",{staticClass:"item flex_m",attrs:{id:"event_eraserAiBoard"},on:{click:function(e){return t.imgBrush("eraserAiBoard")}}},[e("i",{directives:[{name:"show",rawName:"v-show",value:"eraserAiBoard"===t.brushType,expression:"brushType === 'eraserAiBoard'"}],staticClass:"iconfont icon-gou"}),t._v(" "),e("i",{staticClass:"iconfont icon-icon_zidongcachu1"}),t._v(" "),e("p",{staticClass:"flex_m"},[e("span",[t._v(t._s(t.$t("aiEraser")))]),t._v(" "),e("span",{staticClass:"shortcut-key"},[t._v(t._s("".concat(t.top.isMacOs," + E"))+" ")])])])])],1),t._v(" "),e("div",{staticClass:"arrow-box flex_c_m",class:t.visible&&"icon-arrow_act",attrs:{slot:"reference"},slot:"reference"},[e("i",{staticClass:"el-icon-arrow-down"})])]),t._v(" "),!t.visible&&t.hasAct?e("div",{staticClass:"brush-style-box"},[e("color-board",{attrs:{type:t.brushType,item:t.actItem,toolName:"eraserTool",showColor:!1},on:{onChange:t.changeTool}})],1):t._e()],1)}),[],!1,null,"94bf75bc",null).exports),V={inject:["top"],props:{isAct:{type:Boolean,default:!1},isDisable:{type:Boolean,default:!1}},data:function(){return{visible:!1,brushType:"redrawBoard",actItem:{}}},components:{ColorBoard:N,TopToolTips:P},computed:{hasAct:function(){return"daubBoard"===this.top.paintingBoardData.topNav.tools.hasAct}},methods:{addImgAibox:function(t){if(!this.isDisable){this.brushType=t;var e=this.top.paintingBoardData.topNav.tools.daubTool.redrawBoard;this.actItem=e,this.top.eventFn.setBoardNoDage(),this.top.eventFn.setViewYesDage(!1),L.a.emit("setLiveMoveable",{draggable:!1}),L.a.emit("setLiveViewer",{useMouseDrag:!1}),this.$emit("onClick",{type:"daubBoard"})}},onChangeType:function(t){"brush"===t.type&&L.a.emit("closeRedrawEraser"),"eraser"===t.type&&L.a.emit("openRedrawEraser")}}},W=(n(2799),Object(_.a)(V,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"action-item",class:[t.isAct&&"act-item",t.isDisable&&"disable-item"]},[e("TopToolTips",{attrs:{content:"PartialRedrawing",shortcutKey:"I",videoUrl:"20240206/041f5963-b551-4ddd-89e9-a0a03c1caa28.mov"}},[e("div",{staticClass:"icon-box flex_c_m",attrs:{id:"event_daubBoard"},on:{click:function(e){return t.addImgAibox("redrawBoard")}}},[e("i",{staticClass:"iconfont icon-icon_gangbi"})])]),t._v(" "),!t.visible&&t.hasAct?e("div",{staticClass:"brush-style-box"},[e("color-board",{attrs:{type:t.brushType,item:t.actItem,toolName:"daubTool",showColor:!1},on:{onChange:t.onChangeType}})],1):t._e()],1)}),[],!1,null,"ddae60be",null).exports),G=n(350),Y=n(108),J={inject:["top"],data:function(){return{disableBtn:!1}},methods:{handleStepUndo:function(){var t=this;if(!this.disableBtn){var data=Y.a.cancel(),e=data.item.otherObj,n=void 0===e?{}:e;this.disableBtn=!0,this.top.paintingBoardData.liveLayerList=data.item.liveLayerList,this.top.paintingBoardData.liveModel=data.item.liveModel,this.top.initLiveLayerActive(),L.a.emit("hideLayerTopArea"),n.call&&n.call(),setTimeout((function(){L.a.emit("initBgCanvas")}),500),setTimeout((function(){t.disableBtn=!1}),1e3)}},handleStepRedo:function(){var t=this;if(!this.disableBtn){var data=Y.a.restore(),e=data.item.otherObj,n=void 0===e?{}:e;this.disableBtn=!0,this.top.paintingBoardData.liveLayerList=data.item.liveLayerList,this.top.paintingBoardData.liveModel=data.item.liveModel,this.top.initLiveLayerActive(),L.a.emit("hideLayerTopArea"),n.call&&n.call(),setTimeout((function(){L.a.emit("initBgCanvas")}),500),setTimeout((function(){t.disableBtn=!1}),1e3)}}}},K=(n(2800),Object(_.a)(J,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"reset-action flex"},[e("div",{staticClass:"item flex_c_m",class:t.disableBtn&&"disable-sta",attrs:{id:"handleStepUndoId"},on:{click:t.handleStepUndo}},[e("i",{staticClass:"iconfont icon-chehui1"})]),t._v(" "),e("div",{staticClass:"item flex_c_m",class:t.disableBtn&&"disable-sta",attrs:{id:"handleStepRedoId"},on:{click:t.handleStepRedo}},[e("i",{staticClass:"iconfont icon-SVG"})])])}),[],!1,null,"429a88b0",null).exports),X=n(185),Q=n(54),Z=n(35),tt=n.n(Z);function et(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function it(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?et(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var nt={inject:["top"],data:function(){return{actTool:"",popovervisible:!1,currentStep:0,canvasSnapshot:[[]],modeType:"generate",modeList:[{label:this.$t("generateCanvas"),value:"generate"},{label:this.$t("realtimeCanvas"),value:"live"},{label:this.$t("designCanvas"),value:"poster"}]}},watch:{"top.paintingBoardData.topNav.tools.hasAct":{handler:function(t){this.actTool=t},immediate:!0},"top.paintingBoardData.liveModel.show":{handler:function(t){var e=t?"live":"generate";this.modeType=e},immediate:!0},eleAttrListener:function(t,e){if(this.top.normalUpdate)if(this.currentStep===this.canvasSnapshot.length-1){var n=tt()(t);this.canvasSnapshot.length>=25&&this.canvasSnapshot.shift(),this.canvasSnapshot.push(n),this.currentStep=this.canvasSnapshot.length-1}else{this.canvasSnapshot=this.canvasSnapshot.slice(0,this.currentStep+1);var o=tt()(t);this.canvasSnapshot.push(o),this.currentStep=this.canvasSnapshot.length-1}}},components:{ImportArimg:x,SelectEments:$,HandBoardel:B,UpdateArimg:R,BrushBoard:U,EraserBoard:z,DaubBoard:W,AddOrEditCanvas:G.a,UserPopover:X.a,StepAction:K},computed:it(it({},Object(h.e)("user",["userInfo"])),{},{isGenerateLoading:function(){var t,e,n="updateArimg"===(null==this||null===(t=this.top)||void 0===t||null===(t=t.paintingBoardData)||void 0===t||null===(t=t.topNav)||void 0===t||null===(t=t.tools)||void 0===t?void 0:t.hasAct),o=null==this||null===(e=this.top)||void 0===e||null===(e=e.paintingBoardData)||void 0===e||null===(e=e.generateInfo)||void 0===e?void 0:e.loading;return n&&o},getLabel:function(){var t=this;return function(e){return 1==e.type?t.$t("PrivateCanvas"):e.name}},eleAttrListener:function(){var t;return null===(t=this.top.paintingBoardData)||void 0===t?void 0:t.elementList.map((function(t){var e=t.layerId,n=t.imgSrc,o=t.width,r=t.height;return{layerId:e,imgSrc:n,renderWidth:t.renderWidth,renderHeight:t.renderHeight,width:o,height:r,x:t.x,y:t.y,z:t.z,zoom:t.zoom,rotate:t.rotate,show:t.show,lock:t.lock,cropping:t.cropping,freeDeformation:t.freeDeformation,flipHorizontal:t.flipHorizontal,flipVertical:t.flipVertical,opacity:t.opacity,hue:t.hue,saturation:t.saturation,brightness:t.brightness}}))},isLiveMode:function(){var t;return null==this||null===(t=this.top)||void 0===t||null===(t=t.paintingBoardData)||void 0===t||null===(t=t.liveModel)||void 0===t?void 0:t.show},showPublish:function(){var t,e=this.top.paintingBoardData.elementList,n=void 0===e?[]:e,o=null==this||null===(t=this.top)||void 0===t||null===(t=t.paintingBoardData)||void 0===t||null===(t=t.liveModel)||void 0===t?void 0:t.show,r=n.some((function(t){return t.active}));return o&&!r},handleBtnStyle:function(){var t=this.top.paintingBoardData.liveModel;return t.loading||!t.result}}),mounted:function(){this.actTool=this.top.paintingBoardData.topNav.tools.hasAct,this.canvasSnapshot[0]=tt()(this.top.paintingBoardData.elementList)},methods:{handleBack:function(){var t=this.top.fromPath;"Home"!==t&&"/"!==t&&t?this.$router.back():this.$router.push(this.localePath("/"))},getList:function(){this.$emit("getCanvasList")},selectedChange:function(t){if(!this.top.token)return this.$EventBus.$emit("openLoginDialog",{callBack:function(){window.location.reload()}});"add"!==t?this.$emit("changeCanvas",t):this.$refs.addOrEditCanvas.openDialog("add")},handleMoreOperation:function(t,e){var n=this;switch(t){case"edit":this.$refs.addOrEditCanvas.openDialog("edit",e);break;case"delete":this.$confirm(this.$t("deleteConfirm"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){n.handleDeleteCanvas(e.id)}))}},handleDeleteCanvas:function(t){var e=this;Object(Q.l)({id:t}).then((function(){e.$message.success(e.$t("deleteSuccess")),e.top.currentCanvas==t?e.getList():e.$emit("frontendDelCanvas",t)}))},changeTool:function(t){var e=t.type;this.actTool=e;this.top.changeData("topNav.tools.hasAct",this.actTool),this.top.changeData("noMove",this.actTool),this.top.paintingBoardData.elementList.forEach((function(em,t){em.active=!1,em.hasDrawLine=!1,em.hasRedraw=!1})),"selectEments"!==e&&(document.querySelector("#layerBtnsId").style.left="0px",document.querySelector("#layerBtnsId").style.top="0px",this.top.initLayerActive(),this.top.initLiveLayerActive(),L.a.emit("hideLayerTopArea")),"eraserBoard"!==e&&L.a.emit("closeEasyEraser"),"daubBoard"!==e&&(this.top.changeData("liveModel.mask",""),this.top.changeData("liveModel.pmask","")),this.top.layerFooterRef.setPositionBox(),this.$logEvent("log_actions",{operation:"click_".concat(e,"_page_operation"),behavior_info:"on_canvas_detail_page"}),this.top.eventFn.controlNetDisable&&this.top.eventFn.controlNetDisable("daubBoard"===e)},changeModel:function(t){if(!this.top.token)return this.openLogin();var e=this.top.paintingBoardData.liveModel;e.show=!e.show,this.$logEvent("log_actions",{operation:"click_live_mode",behavior_info:"on_canvas",behavior_info_sub:e.show?"open":"close"}),e.show&&(this.top.initLayerActive(),e.active=!0),"updateArimg"===this.actTool&&e.show&&this.changeTool({type:"selectEments"}),t||(this.top.changeData("topNav.tools.hasAct","updateArimg"),this.top.eventFn.setBoardYesDage(),this.top.eventFn.setViewYesDage(!1))},handleStep:function(t){var e=this;if("undo"===t){if(!(this.currentStep>0))return;this.currentStep--}else{if(!(this.currentStep<this.canvasSnapshot.length-1))return;this.currentStep++}this.$logEvent("log_actions",{operation:"click_".concat(t),behavior_info:"on_canvas_detail_page"});var n=this.top.paintingBoardData.elementList,o=tt()(this.canvasSnapshot[this.currentStep]).map((function(t){var o=n.find((function(e){return e.layerId==t.layerId}));return it(o?it({},o):{name:e.$t("Layer"),type:"imgLayer",dragItem:{},conetent:"base64",params:{},cutUrl:"",prompt:"",mask:"",loading:!1,hasDrawLine:!1},t)}));this.top.changeData("elementList",o,"step"),this.top.initLayerActive(),this.$nextTick((function(){e.$EventBus.$emit("stepUpdate")}))},openLogin:function(){this.$EventBus.$emit("openLoginDialog",{callBack:function(){window.location.reload()}})},submitPublish:function(){L.a.emit("hideLayerTopArea"),this.top.initLiveLayerActive(),this.top.eventFn.submitPublish()},toFeedback:function(){var map={zhCN:"https://aihelp.net/questionnaire/#/?formId=11a4d6a06c7c4fdd893e8e0e4d680d9b",zhTW:"https://aihelp.net/questionnaire/#/?formId=11a4d6a06c7c4fdd893e8e0e4d680d9b",en:"https://aihelp.net/questionnaire/#/?formId=6c101e48f801480eb2e97fd9d4fe5f0f",ja:"https://aihelp.net/questionnaire/#/?formId=09b048bd88484208bebfc1a820d4397c",pt:"https://aihelp.net/questionnaire/#/?formId=ed9956d92d614c36975c65a12aa4e6d8"},t=map[this.$i18n.locale]||map.en;window.open(t,"_blank")},changeModeType:function(t){if(!this.top.token)return this.openLogin();if(this.$logEvent("log_actions",{operation:"click_switch_type",behavior_info:"on_canvas_fuction_page",behavior_info_sub:t}),["live","generate"].includes(t)){var e="live"===t;this.top.changeData("liveModel.show",e);var n=this.top.paintingBoardData.liveModel;this.$logEvent("log_actions",{operation:"click_live_mode",behavior_info:"on_canvas",behavior_info_sub:n.show?"open":"close"}),n.show&&(this.top.initLayerActive(),n.active=!0),"updateArimg"===this.actTool&&n.show&&this.changeTool({type:"selectEments"}),"live"!==t&&(this.top.changeData("topNav.tools.hasAct","updateArimg"),this.top.eventFn.setBoardYesDage(),this.top.eventFn.setViewYesDage(!1))}if("poster"===t){var o=this.top.currentCanvas;this.$router.push({path:this.localePath("/posterBoard"),query:{id:o,live:"no"}})}},toTeach:function(){var t=this.$i18n.locale.includes("zh")?"https://kvrbeskjhpg.feishu.cn/docx/VqXBdza69olCYexouetcglKCn6e#part-XoyfdciaEoCUfTxzYQccI4Jinbb":"https://seaart.notion.site/Canvas-Guide-741024f4ee514bc799689504228df2f7";window.open(t,"_blank")}}},at=(n(2801),n(2802),Object(_.a)(nt,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"topnav-box flex"},[e("div",{staticClass:"left flex"},[e("div",{staticClass:"back-icon flex_c_m",on:{click:t.handleBack}},[e("i",{staticClass:"iconfont icon-back"})]),t._v(" "),e("el-select",{staticClass:"custom-select-transparent my-el-select",attrs:{value:t.modeType,"popper-class":"painting-board-select select-canvas my-el-option"},on:{change:t.changeModeType}},t._l(t.modeList,(function(t){return e("el-option",{key:t.value,attrs:{value:t.value,label:t.label}})})),1),t._v(" "),e("el-select",{staticClass:"custom-select-transparent",attrs:{value:t.top.currentCanvas,"popper-class":"painting-board-select select-canvas",placeholder:"","popper-append-to-body":!0},on:{change:t.selectedChange}},[e("el-option",{staticClass:"add-canvas-option",attrs:{value:"add"}},[e("i",{staticClass:"el-icon-plus"}),t._v(" "),e("span",[t._v(t._s(t.$t("Canvas")))])]),t._v(" "),t._l(t.top.canvasList,(function(n){return e("el-option",{key:n.id,attrs:{label:t.getLabel(n),value:n.id}},[e("span",{staticClass:"label"},[t._v(t._s(t.getLabel(n)))]),t._v(" "),1!=n.type?e("el-dropdown",{staticClass:"more-btn",attrs:{trigger:"click"},on:{command:function(e){return t.handleMoreOperation(e,n)}}},[e("i",{staticClass:"el-icon-more more-icon",on:{click:function(t){t.stopPropagation()}}}),t._v(" "),e("el-dropdown-menu",{staticClass:"custom-dropdown-canvas",attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"edit"}},[t._v(t._s(t.$t("Edit")))]),t._v(" "),e("el-dropdown-item",{attrs:{command:"delete"}},[t._v(t._s(t.$t("Delete")))])],1)],1):t._e()],1)}))],2)],1),t._v(" "),e("div",{staticClass:"center flex_c_m"},[e("div",{staticClass:"options-list flex"},[e("import-arimg",{attrs:{isAct:"importArimg"===t.actTool,isDisable:t.isGenerateLoading},on:{onClick:t.changeTool}}),t._v(" "),e("select-ements",{attrs:{isAct:"selectEments"===t.actTool,isDisable:t.isGenerateLoading},on:{onClick:t.changeTool}}),t._v(" "),e("hand-boardel",{attrs:{isAct:"handBoardel"===t.actTool,isDisable:t.isGenerateLoading||t.isLiveMode},on:{onClick:t.changeTool}}),t._v(" "),e("update-arimg",{attrs:{isAct:"updateArimg"===t.actTool,isDisable:t.isLiveMode},on:{onClick:t.changeTool}}),t._v(" "),e("brush-board",{attrs:{isAct:"brushBoard"===t.actTool||"brushImg"===t.actTool,isDisable:t.isGenerateLoading},on:{onClick:t.changeTool}}),t._v(" "),e("eraser-board",{attrs:{isAct:"eraserBoard"===t.actTool||"eraserAiBoard"===t.actTool,isDisable:t.isGenerateLoading},on:{onClick:t.changeTool}}),t._v(" "),e("daub-board",{attrs:{isAct:"daubBoard"===t.actTool,isDisable:t.isGenerateLoading},on:{onClick:t.changeTool}})],1)]),t._v(" "),e("div",{staticClass:"right flex_m"},[t.isLiveMode?t._e():[e("div",{staticClass:"reset-action flex"},[e("div",{staticClass:"item flex_c_m",class:{forbidden:0===t.currentStep},on:{click:function(e){return t.handleStep("undo")}}},[e("i",{staticClass:"iconfont icon-chehui1"})]),t._v(" "),e("div",{staticClass:"item flex_c_m",class:{forbidden:t.currentStep===t.canvasSnapshot.length-1},on:{click:function(e){return t.handleStep("redo")}}},[e("i",{staticClass:"iconfont icon-SVG"})])])],t._v(" "),t.isLiveMode?[e("step-action")]:t._e(),t._v(" "),e("div",{staticClass:"feed-back flex_c_m",on:{click:t.toTeach}},[e("i",{staticClass:"iconfont icon-tagTips"}),t._v(" "),e("span",[t._v(t._s(t.$t("Guides")))])]),t._v(" "),e("div",{staticClass:"feed-back flex_c_m",on:{click:t.toFeedback}},[e("i",{staticClass:"iconfont icon-icon_wenjuan"}),t._v(" "),e("span",[t._v(t._s(t.$t("Feedback")))])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showPublish,expression:"showPublish"}],staticClass:"publish-btn",class:{publish_disabled:t.handleBtnStyle},on:{click:t.submitPublish}},[e("i",{staticClass:"iconfont icon-share-icon"}),t._v(" "),e("span",[t._v(t._s(t.$t("releaseName")))])]),t._v(" "),t.top.token?e("UserPopover"):e("el-button",{staticClass:"login-btn",on:{click:t.openLogin}},[t._v("\n      "+t._s(t.$t("Login"))+"\n    ")])],2),t._v(" "),e("AddOrEditCanvas",{ref:"addOrEditCanvas",on:{updateList:t.getList}})],1)}),[],!1,null,"3bb28b58",null).exports);function ot(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var st={props:["value"],name:"ControlNetPopup",data:function(){return{visible:!1,module:2,modelInfo:null}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ot(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(h.c)("creation",["editBoardControlNetConfig"])),methods:{openModal:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.resetData(),this.modelInfo=t||null,t&&(this.module=t.module),this.visible=!0},close:function(){this.visible=!1},changeModel:function(t){this.module=t;var e=null;this.modelInfo&&((e=JSON.parse(JSON.stringify(this.modelInfo))).module=t),this.$emit("inputChange",t,e),this.close()},resetData:function(){this.module=2,this.modelInfo=null}}},lt=st,ct=(n(2803),n(2804),Object(_.a)(lt,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"controlnet-popup custom-dialog big-body-dialog",attrs:{visible:t.visible,"append-to-body":!0},on:{"update:visible":function(e){t.visible=e}}},[e("div",{staticClass:"controlnet-body"},[e("i",{staticClass:"el-icon-close",on:{click:t.close}}),t._v(" "),e("div",{staticClass:"controlnet-grid"},t._l(t.editBoardControlNetConfig,(function(n,i){return e("div",{key:"model_"+i,staticClass:"grid-item",class:{active:t.module===n.value},on:{click:function(e){return t.changeModel(n.value)}}},[e("div",{staticClass:"cover zoom-box",style:{"background-image":"url(".concat(null==n?void 0:n.cover,")")}},[e("span",{staticClass:"name"},[t._v(t._s(t.$t(n.name)))])]),t._v(" "),e("el-tooltip",{attrs:{"popper-class":"custom-tips-popper controlnet",effect:"dark",content:t.$t(n.name+"_Tips"),placement:"top-start"}},[e("p",{staticClass:"tips-info ellipsis-text"},[t._v(t._s(t.$t(n.name+"_Tips")))])])],1)})),0)])])}),[],!1,null,"1025fe17",null).exports),ut=n(24),ht=n(63);function pt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function vt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?pt(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var mt={inject:["top"],props:["value"],components:{ControlNetPopup:ct,TopToolTips:P},data:function(){return{optionList:[],optionTemplate:{enable:!1,show:!1,module:"",id:0,weight:1,input_image:"",rawWidth:0,rawHeight:0,openPoseData:{people:[{pose_keypoints_2d:[]}]}},activeIndex:-1,defaultModule:2,isUploading:!1,accept:".jpg,.jpeg,.png,.webp",UPLOAD:new w.a({type:33}),imgUrl:"",hasDisable:!1}},computed:vt(vt({},Object(h.c)("creation",["editBoardControlNetConfig"])),{},{isDisableImageToImage:function(){var t,e=!this.isLiveMode,n=![3,"3"].includes(null==this||null===(t=this.top)||void 0===t?void 0:t.generateType),o="updateArimg"===this.top.paintingBoardData.topNav.tools.hasAct,r=this.getImageUrl;return e&&n&&o&&r},isLiveMode:function(){return this.top.paintingBoardData.liveModel.show},getControlNetMap:function(){var map={};return(this.editBoardControlNetConfig||[]).forEach((function(t){map[t.value]=t})),map},getModelCoverUrl:function(){var t=this;return function(e){var n;return t.getControlNetMap[e]?null===(n=t.getControlNetMap[e])||void 0===n?void 0:n.cover:""}},getModelDescribe:function(){var t=this;return function(e){var n,o=t.getControlNetMap[e]?null===(n=t.getControlNetMap[e])||void 0===n?void 0:n.name:"";return t.$t(o)}},getImageUrl:function(){var t;return(null===(t=this.top)||void 0===t||null===(t=t.paintingBoardData)||void 0===t||null===(t=t.imageToImage)||void 0===t?void 0:t.imgUrl)||""}}),mounted:function(){this.top.eventFn.controlNetDisable=this.controlNetDisable},methods:{handleDeleteImage:function(){this.imgUrl="",this.updateImageUrl("")},changeConfig:function(t,e){var n=JSON.parse(JSON.stringify(this.value)),o=n.activeIndex,r=n.controlnet_units;"activeIndex"!==e?r[(r||[]).findIndex((function(t){return t.id===o}))][e]=t:n.activeIndex=t;this.$emit("input",n)},showControlNetPopup:function(){this.$refs.controlNetPopup.openModal()},changeEnableStatus:function(t,e){var n=JSON.parse(JSON.stringify(this.value)),o=(this.value.controlnet_units||[]).findIndex((function(t){return t.id===e.id}));-1!==o&&(n.controlnet_units[o].enable=t),this.$emit("input",n)},changeActive:function(t){var e=t.id;this.value.activeIndex===t.id&&(e=""),this.changeConfig(e,"activeIndex"),this.top.hideOtherControlNet(t.id)},handleDelete:function(t){var e=JSON.parse(JSON.stringify(this.value)),n=(this.value.controlnet_units||[]).findIndex((function(e){return e.id===t.id}));if(-1!==n){var o=this.top.paintingBoardData.elementList.find((function(e){return(null==e?void 0:e.controlNetId)===t.id}));(null==o?void 0:o.layerId)&&this.top.deleteImageLayer(o.layerId),e.controlnet_units.splice(n,1),this.$emit("input",e)}},handleChangeOptions:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultModule,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=JSON.parse(JSON.stringify(this.value));if(e)(n.controlnet_units||[]).forEach((function(t){t.id===e.id&&(t.module=e.module)}));else{if(n.controlnet_units.length>=3)return;var o=JSON.parse(JSON.stringify(this.optionTemplate));o.module=t;var r=(n.controlnet_units||[]).map((function(t){return t.id}));o.id=this.generateNonConflictUniqueId(r),n.activeIndex=o.id,o.show=!1,o.enable=!0,n.controlnet_units.push(o)}this.$emit("input",n)},generateNonConflictUniqueId:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];do{t=Object(ut.uniqueId)("controlNetOption_")}while(e.includes(t));return t},handleBeforeUpload:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,r,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=["image/jpeg","image/png","image/jpg","image/webp"],!e.isUploading){n.next=3;break}return n.abrupt("return");case 3:if(o.includes(t.type)){n.next=6;break}return e.$message.error(e.$t("AllowImageFiles")),n.abrupt("return",!1);case 6:if(!(r=t)||r.size){n.next=9;break}return n.abrupt("return",!1);case 9:if(!(r.size/1024/1024>5)){n.next=20;break}return n.prev=10,n.next=13,Object(C.a)(r,5242880);case 13:r=n.sent,n.next=20;break;case 16:return n.prev=16,n.t0=n.catch(10),console.error("Compression failed:",n.t0),n.abrupt("return",!1);case 20:return n.next=22,e.checkImageSize(t);case 22:if(l=n.sent,e.imgUrl=l.url||"",!e.isUploading){n.next=26;break}return n.abrupt("return");case 26:return e.isUploading=!0,e.UPLOAD.startUpload(r,{category:33}).then((function(t){e.isUploading=!1,e.updateImageUrl(t,l.realWidth,l.realHeight)})).catch((function(t){e.isUploading=!1,e.imgUrl="",e.updateImageUrl("")})),n.abrupt("return",!1);case 30:case"end":return n.stop()}}),n,null,[[10,16]])})))()},updateImageUrl:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.top.changeData("imageToImage.imgUrl",t)},checkImageSize:function(t){return new Promise((function(e,n){var o=new FileReader;o.onload=function(t){var img=new Image;img.onload=function(){var t={width:img.width,height:img.height,realWidth:img.naturalWidth,realHeight:img.naturalHeight};t.url=img.src,e(t)},img.onerror=function(){n(!1)},img.src=t.target.result},o.readAsDataURL(t)}))},controlNetDisable:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.hasDisable=t}}},ft=mt,gt=(n(2805),Object(_.a)(ft,(function(){var t,e,n=this,o=n._self._c;return o("div",{staticClass:"generate-panel",class:n.hasDisable&&"disable-panle"},[o("div",{directives:[{name:"show",rawName:"v-show",value:!n.isLiveMode,expression:"!isLiveMode"}],staticClass:"panel-item",class:[n.isDisableImageToImage&&"panel-item-disable"]},[o("div",{staticClass:"panel-item__title"},[n._v(n._s(n.$t("ImgToImg")))]),n._v(" "),o("div",{staticClass:"panel-item__subtitle"},[n._v("\n        "+n._s(n.$t("UploadOrSelectAsInspiration"))+"\n      ")]),n._v(" "),o("div",{directives:[{name:"loading",rawName:"v-loading",value:n.isUploading,expression:"isUploading"}],staticClass:"panel-item__upload-area"},[n.getImageUrl?n._e():o("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:n.isUploading,expression:"isUploading"}],key:"backgroundUpload",ref:"backgroundUpload",staticClass:"image-upload",attrs:{action:"#","before-upload":n.handleBeforeUpload,disabled:n.isUploading,accept:n.accept,"http-request":function(){},"show-file-list":!1}},[o("span",{staticClass:"el-icon-circle-plus-outline upload-area-box-icon",attrs:{slot:"trigger"},slot:"trigger"})]),n._v(" "),n.getImageUrl?o("img",{staticClass:"upload-area-result-image",class:[n.isDisableImageToImage&&"panel-item-disable-gray"],attrs:{src:n.getImageUrl,alt:""}}):n._e(),n._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:n.getImageUrl&&!n.isUploading,expression:"getImageUrl && !isUploading"}],staticClass:"image-operate-btn-box"},[n.getImageUrl&&!n.isUploading?o("span",{staticClass:"image-operate-btn el-icon-delete",on:{click:function(t){return t.stopPropagation(),n.handleDeleteImage()}}}):n._e()])],1)]),n._v(" "),o("div",{staticClass:"panel-item"},[o("div",{staticClass:"panel-item__title"},[n._v("\n        "+n._s(n.$t("ControlNet"))+"\n        "),o("top-tool-tips",{attrs:{content:"ControlNet",placement:"right",videoUrl:"20240322/9c9ea84b-c992-4ef4-9995-661182b2f896.mov"}},[o("i",{staticClass:"iconfont icon-help"})])],1),n._v(" "),o("div",{staticClass:"panel-item__subtitle"},[n._v("\n        "+n._s(n.$t("ControlGeneratedProperties"))+"\n      ")]),n._v(" "),o("div",{staticClass:"option-box"},[n._l((null===(t=n.value)||void 0===t?void 0:t.controlnet_units)||[],(function(t,e){return o("div",{key:t.id,staticClass:"option-box-item",class:n.value.activeIndex===t.id?"option-box-item-active":""},[o("div",{staticClass:"option-box-item-content",on:{click:function(e){return e.stopPropagation(),n.changeActive(t)}}},[o("div",{staticClass:"content-img-box"},[o("img",{attrs:{src:(null==t?void 0:t.input_image)||n.getModelCoverUrl(t.module),alt:""}})]),n._v(" "),o("span",{staticClass:"content-img-box-text"},[n._v(n._s(n.getModelDescribe(t.module)))])]),n._v(" "),o("span",{staticClass:"el-icon-delete",on:{click:function(e){return e.stopPropagation(),n.handleDelete(t)}}})])})),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:(null===(e=n.value)||void 0===e||null===(e=e.controlnet_units)||void 0===e?void 0:e.length)<3,expression:"value?.controlnet_units?.length < 3"}],staticClass:"option-box-item option-box-item-add",on:{click:n.showControlNetPopup}},[o("span",{staticClass:"el-icon-plus option-box-item-add-icon"}),n._v(" "),o("span",{staticClass:"option-box-item-add-text"},[n._v(n._s(n.$t("AddControl")))])])],2)]),n._v(" "),o("control-net-popup",{ref:"controlNetPopup",on:{inputChange:n.handleChangeOptions}})],1)}),[],!1,null,"015b1b54",null).exports),bt=(n(120),n(5)),_t={name:"ReplaceTemplateDialog",inject:["top"],data:function(){return{isShowDialog:!1,templateId:null,isDrawSame:!1}},beforeDestroy:function(){clearTimeout()},methods:{openDialog:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.templateId=t,this.isShowDialog=!0,this.isDrawSame=e},handleRepelace:function(){this.top.getTplDetailHttp(this.templateId),this.isShowDialog=!1},handleSave:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.isShowDialog=!1,t.top.changeLoadingStatus(!0),setTimeout((function(){Object(ht.a)({tagArea:{x:0,y:0,width:1920,height:800},hasDwon:!1,upload:!0}).then((function(e){t.savePublishBorad(1920,800,e)}))}),500);case 3:case"end":return e.stop()}}),e)})))()},savePublishBorad:function(t,e,n){var o=this;return Object(l.a)(regeneratorRuntime.mark((function r(){var l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return l={name:Object(bt.B)((new Date).getTime()),category:"",intro:"",publish_type:3,type:3,cover:{width:t,height:e,uri:n},id:o.top.currentCanvas},r.next=3,Object(Q.F)(l);case 3:o.top.getTplDetailHttp(o.templateId),o.top.changeLoadingStatus(!1),o.isDrawSame&&o.top.changeLeftMenu("Template"),o.$emit("publishSuccess");case 7:case"end":return r.stop()}}),r)})))()},closed:function(){this.$route.query.remix_id&&this.top.clearRouterQuery()}}},yt=_t,wt=(n(2806),Object(_.a)(yt,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"add-or-edit-canvas custom-dialog-canvas",attrs:{width:"475px","append-to-body":"",title:t.$t("Tip"),visible:t.isShowDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.isShowDialog=e},close:t.closed}},[e("div",{staticClass:"label"},[t._v(t._s(t.$t("canvas_repelace_title")))]),t._v(" "),e("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.handleSave}},[t._v("\n      "+t._s(t.$t("canvas_save_repelace"))+"\n    ")]),t._v(" "),e("el-button",{on:{click:t.handleRepelace}},[t._v(t._s(t.$t("canvas_repelace")))])],1)])}),[],!1,null,"55500810",null).exports),Ct={props:{category:{type:Array,default:function(){return[]}},currentCategory:{type:String,default:"all"}},data:function(){return{categoryMoreName:"more"}},methods:{changeTag:function(t){var e,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.$emit("changeTag",t),this.categoryMoreName=n?null===(e=this.category.find((function(e){return e.value===t})))||void 0===e?void 0:e.label:"more"}}},kt=Ct,Ot=(n(2807),Object(_.a)(kt,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"category"},[t._l(t.category.filter((function(t){return null==t?void 0:t.isMore})),(function(n){return e("div",{key:n.value,staticClass:"item-category flex-center",class:{active:t.currentCategory===n.value},on:{click:function(e){return t.changeTag(n.value,!1)}}},[t._v("\n    "+t._s(t.$t(n.label))+"\n  ")])})),t._v(" "),e("el-dropdown",{attrs:{trigger:"click"},on:{command:t.changeTag}},[e("div",{staticClass:"item-category flex-center",class:{active:"more"!=t.categoryMoreName}},[t._v("\n      "+t._s(t.$t("".concat(t.categoryMoreName)))+"\n    ")]),t._v(" "),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.category.filter((function(t){return!(null!=t&&t.isMore)})),(function(n){return e("el-dropdown-item",{key:n.value,attrs:{command:n.value}},[t._v("\n        "+t._s(t.$t(null==n?void 0:n.label))+"\n      ")])})),1)],1)],2)}),[],!1,null,"1670de6a",null).exports);function xt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var It={components:{ReplaceTemplateDialog:wt,CategoryTags:Ot},inject:["top"],data:function(){return{typeList:[{label:"canvas_Official_Template",value:1},{label:"canvas_Personal_Template",value:2},{label:"canvas_Favorite_Template",value:4},{label:"canvas_Cache_Template",value:3}],currentType:"",templateList:[],currentTemplateId:null,categoryList:[],currentCategory:"all",paramsData:{ids:[],other_id:"",name:"",category:"",page:1,page_size:15,type:1,with_author:!1,with_palette:!1},isHaveMore:!1,loading:!1}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?xt(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(h.c)("user",["cdnHostFun"])),mounted:function(){this.top.isDrawSame&&(this.paramsData.type=3),this.getList(),this.getCategoryList()},methods:{handleCommand:function(t){this.paramsData.type=t,this.getList(),this.$logEvent("log_actions",{operation:"click_".concat(t,"_template"),behavior_info:"on_canvas_detail_page"})},chooseTml:function(t){if(1!==t.publish_type){if(!this.top.isChangeBoardData&&this.top.isAlreadyRepelaceTemplate||0===this.top.paintingBoardData.elementList.length)return this.top.getTplDetailHttp(t.id);this.$refs.replaceDialog.openDialog(t.id)}else{this.top.changeData("topNav.tools.hasAct","selectEments");var e=this.top.paintingBoardData.liveModel.show;this.top.addLayerItem({type:e?"liveImgLayer":"imgLayer",imgSrc:(null==t?void 0:t.cover)||""})}},handleDelete:function(t,e){var n=this;this.$confirm(this.$t("canvas_delete_tips"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel")}).then((function(){try{Object(Q.m)({id:t.id}).then((function(t){n.$message({type:"success",message:n.$t("deleteSuccess")}),n.templateList.splice(e,1)}))}catch(t){console.log(t)}})).catch((function(){n.$message({type:"info",message:n.$t("Cancel")})}))},getList:function(){var t=arguments,e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,d,h,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.length>0&&void 0!==t[0]&&t[0],n.prev=1,e.top.token){n.next=4;break}return n.abrupt("return");case 4:return e.loading=!0,o||(e.paramsData.page=1),r=4===e.paramsData.type?Q.w:Q.D,n.next=9,r(e.paramsData);case 9:l=n.sent,c=l.data,d=c.has_more,h=c.items,v=void 0===h?[]:h,e.isHaveMore=d,e.templateList=o?e.templateList.concat(v):v;case 16:return n.prev=16,e.loading=!1,n.finish(16);case 19:case"end":return n.stop()}}),n,null,[[1,,16,19]])})))()},getCategoryList:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(Q.B)(t.paramsData);case 3:n=e.sent,o=n.data.Items,r=void 0===o?[]:o,t.categoryList=r.map((function(t,e){return{value:t,label:"canvas_".concat(t),isMore:e<5}})),t.categoryList.unshift({value:"all",label:"All",isMore:!0});case 8:return e.prev=8,t.loading=!1,e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[0,,8,11]])})))()},changeTag:function(t){this.$logEvent("log_actions",{operation:"click_".concat(t,"_template"),behavior_info:"on_canvas_detail_page"}),this.currentCategory=t,this.paramsData.category="all"===t?"":t,this.paramsData.type=1,this.getList()},keywordsChange:function(t){!t.target.value&&(this.type="normal")},search:function(){this.getList()},clear:function(){this.paramsData.name="",this.paramsData.category="",this.templateList=[],this.getList()},isScrollBottom:function(){if(this.isHaveMore){var t=this.$refs.templatePanel,e=t.clientHeight;t.scrollTop+e>=t.scrollHeight&&(this.paramsData.page+=1,this.getList(!0))}}}},Dt=It,St=(n(2808),Object(_.a)(Dt,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"templatePanel",staticClass:"template-panel",on:{scroll:t.isScrollBottom}},[e("div",{staticClass:"flex-center template-panel-search"},[e("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleCommand}},[e("div",{staticClass:"icon-box flex-center"},[e("i",{staticClass:"icon-loudou iconfont"})]),t._v(" "),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.typeList,(function(n){return e("el-dropdown-item",{key:n.value,class:{"drop-active":n.value===t.paramsData.type},attrs:{command:n.value}},[t._v("\n          "+t._s(t.$t(null==n?void 0:n.label))+"\n        ")])})),1)],1),t._v(" "),e("div",{staticClass:"input-search"},[e("i",{staticClass:"iconfont icon-min-search",on:{click:t.search}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.paramsData.name,expression:"paramsData.name"}],attrs:{type:"text",placeholder:t.$t("minSearch")},domProps:{value:t.paramsData.name},on:{change:t.keywordsChange,keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)},input:function(e){e.target.composing||t.$set(t.paramsData,"name",e.target.value)}}}),t._v(" "),t.paramsData.name.length>0?e("i",{staticClass:"el-icon-close",on:{click:t.clear}}):t._e()])],1),t._v(" "),1===t.paramsData.type?e("CategoryTags",{attrs:{currentCategory:t.currentCategory,category:t.categoryList},on:{changeTag:t.changeTag}}):t._e(),t._v(" "),t.templateList.length>0?e("div",{staticClass:"template-panel-list"},t._l(t.templateList,(function(n,o){return e("div",{key:n.id,staticClass:"template-panel-list-item",on:{click:function(e){return t.chooseTml(n)}}},[e("div",{staticClass:"image flex-center"},[e("img",{attrs:{src:(null==n?void 0:n.cover)||"",alt:"image",align:"“center"}}),t._v(" "),[2,3].includes(t.paramsData.type)?e("div",{staticClass:"image-icon flex-center",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleDelete(n,o)}}},[e("i",{staticClass:"iconfont icon-shanchu3"})]):t._e()]),t._v(" "),e("span",{staticClass:"template-panel-list-item-name"},[t._v("\n        "+t._s(n.name)+"\n      ")])])})),0):t._e(),t._v(" "),0!==t.templateList.length||t.loading?t._e():e("div",{staticClass:"empty-box"},[e("img",{staticClass:"empty-img",attrs:{src:"https://".concat(t.cdnHostFun(),"/static/upload/20240125/8b9a3975-7433-44ce-8244-5cb21cfe920c.webp"),alt:"empty image"}}),t._v(" "),e("div",{staticClass:"empty-tip"},[t._v(t._s(t.$t("NoSearchResultsTip")))])]),t._v(" "),e("ReplaceTemplateDialog",{ref:"replaceDialog",on:{publishSuccess:t.getList}})],1)}),[],!1,null,"509e9100",null)),Pt=St.exports;function Lt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function jt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Lt(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var $t={components:{CategoryTags:Ot},inject:["top"],data:function(){return{list:[],currentCategory:"all",category:[],categoryMoreName:"more",type:"normal",keywords:"",searchList:[],isHaveMore:!1,moreList:[],moreLoading:!1,paramsData:{page:1,page_size:50,category:"",type:1}}},mounted:function(){this.getList()},computed:jt(jt({},Object(h.c)("user",["cdnHostFun"])),{},{isShowClassify:function(){var t=this;return function(e){return(null==e?void 0:e.items.length)&&(t.currentCategory===e.category||"all"===t.currentCategory)}}}),methods:{getList:function(){var t=this;this.top.token&&(this.moreLoading=!0,Object(Q.y)({type:1}).then((function(e){var n=e.data.items,o=void 0===n?[]:n;t.list=o.map((function(e){return e.label=t.initCategoryName(e.category),e})),t.initCategory(o),t.moreLoading=!1})))},initCategory:function(t){this.category=t.map((function(t,e){return{value:t.category,label:null==t?void 0:t.label,isMore:e<4}})),this.category.unshift({value:"all",label:"All",isMore:!0})},changeTag:function(t){this.currentCategory=t,this.$logEvent("log_actions",{operation:"click_".concat(t,"_material"),behavior_info:"on_canvas_detail_page"})},getMore:function(t){var e=this;this.moreLoading=!0,this.type="more",t&&(this.paramsData.category=t.category),Object(Q.y)(this.paramsData).then((function(n){var data=n.data;e.isHaveMore?e.moreList=[{items:e.paramsData.page>1?e.moreList[0].items.concat(data):data,label:t?null==t?void 0:t.label:e.moreList[0].label}]:e.moreList=[{items:data,label:t.label}],e.isHaveMore=!(data.length<50),e.moreLoading=!1}))},closeSeeMore:function(){this.type="normal",this.moreList=[],this.paramsData.page=1,this.isHaveMore=!1},isScrollBottom:function(){if(this.isHaveMore){var t=this.$refs.material,e=t.clientHeight;t.scrollTop+e>=t.scrollHeight&&(this.paramsData.page+=1,this.getMore())}},initCategoryName:function(t){return"use"===t?"recentlyUsed":t.includes("/")?"canvas_".concat(t.split("/")[0]):"canvas_".concat(t)},keywordsChange:function(t){!t.target.value&&(this.type="normal")},search:function(){var t=this;this.keywords&&Object(Q.y)({type:1,name:this.keywords}).then((function(e){t.type="search",t.searchList=(null==e?void 0:e.data)||[]}))},clear:function(){this.keywords="",this.searchList=[],this.type="normal"},handleUse:function(t){var e,n=this;if(!t)return this.$message.error();var o=t.id,r=void 0===o?"":o,param={type:this.top.paintingBoardData.liveModel.show?"liveImgLayer":"imgLayer",imgSrc:(null==t?void 0:t.image)||""},l=null===(e=this.list.find((function(t){return"use"==t.category})))||void 0===e?void 0:e.items;l.find((function(t){return(null==t?void 0:t.id)==r}))?Object(Q.G)({id:r}).then((function(){n.top.changeData("topNav.tools.hasAct","selectEments"),n.top.addLayerItem(param);var e=l.filter((function(t){return(null==t?void 0:t.id)!=r}));e.unshift(t),n.$set(n.list[0],"items",e)})):Object(Q.G)({id:r}).then((function(){n.top.changeData("topNav.tools.hasAct","selectEments"),n.top.addLayerItem(param),l.unshift(t)})),L.a.emit("setLiveMoveable",{draggable:!0}),L.a.emit("setLiveViewer",{useMouseDrag:!1}),this.top.eventFn.setBoardYesDage(),this.top.eventFn.setViewYesDage(!1)}}},Tt=(n(2809),Object(_.a)($t,(function(){var t=this,e=t._self._c;return e("div",{ref:"material",staticClass:"material-panel",on:{scroll:t.isScrollBottom}},[e("div",{directives:[{name:"show",rawName:"v-show",value:"more"!=t.type,expression:"type != 'more'"}],staticClass:"input-search"},[e("i",{staticClass:"iconfont icon-min-search",on:{click:t.search}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.keywords,expression:"keywords"}],attrs:{type:"text",placeholder:t.$t("minSearch")},domProps:{value:t.keywords},on:{change:t.keywordsChange,keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)},input:function(e){e.target.composing||(t.keywords=e.target.value)}}}),t._v(" "),t.keywords.length>0?e("i",{staticClass:"el-icon-close",on:{click:t.clear}}):t._e()]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"search"==t.type,expression:"type == 'search'"}],staticClass:"search-box"},[t.searchList.length?e("div",{staticClass:"search-content"},[e("div",{staticClass:"label"},[t._v(t._s(t.$t("SearchResults")))]),t._v(" "),e("div",{staticClass:"content-box"},t._l(t.searchList,(function(n){return e("div",{key:null==n?void 0:n.id,staticClass:"item-content",on:{click:function(e){return t.handleUse(n)}}},[e("img",{staticClass:"image",attrs:{src:(null==n?void 0:n.image)||"",alt:"image"}})])})),0)]):e("div",{staticClass:"empty-box"},[e("img",{staticClass:"empty-img",attrs:{src:"https://".concat(t.cdnHostFun(),"static/upload/20240125/8b9a3975-7433-44ce-8244-5cb21cfe920c.webp"),alt:"empty image"}}),t._v(" "),e("div",{staticClass:"empty-tip"},[t._v(t._s(t.$t("NoSearchResultsTip")))])])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"more"==t.type,expression:"type == 'more'"},{name:"loading",rawName:"v-loading",value:t.moreLoading,expression:"moreLoading"}],staticClass:"normal-box"},[e("div",{staticClass:"classify-container"},t._l(t.moreList,(function(n){return e("div",{key:n.category,staticClass:"item-classify"},[e("div",{staticClass:"label"},[e("span",{on:{click:t.closeSeeMore}},[e("i",{staticClass:"iconfont icon-back"}),t._v(t._s(t.$t(null==n?void 0:n.label)))])]),t._v(" "),e("div",{staticClass:"content-box"},t._l(n.items,(function(content){return e("div",{key:null==content?void 0:content.id,staticClass:"item-content",on:{click:function(e){return t.handleUse(content)}}},[e("img",{staticClass:"image",attrs:{src:(null==content?void 0:content.image)||"",alt:"image"}})])})),0)])})),0)]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"normal"==t.type,expression:"type == 'normal'"},{name:"loading",rawName:"v-loading",value:t.moreLoading,expression:"moreLoading"}],staticClass:"normal-box"},[e("CategoryTags",{attrs:{currentCategory:t.currentCategory,category:t.category},on:{changeTag:t.changeTag}}),t._v(" "),e("div",{staticClass:"classify-container"},t._l(t.list,(function(n,o){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowClassify(n),expression:"isShowClassify(classify)"}],key:n.category,staticClass:"item-classify"},[e("div",{staticClass:"label"},[e("span",[t._v(t._s(t.$t(null==n?void 0:n.label)))]),t._v(" "),"use"!=n.category?e("span",{staticClass:"text",on:{click:function(e){return t.getMore(n,o)}}},[t._v(t._s(t.$t("viewMore")))]):t._e()]),t._v(" "),n.isHaveMore?t._e():e("div",{staticClass:"content-box"},t._l(n.items.filter((function(t){return null==t?void 0:t.id})),(function(content){return e("div",{key:null==content?void 0:content.id,staticClass:"item-content",on:{click:function(e){return t.handleUse(content)}}},[e("img",{staticClass:"image",attrs:{src:(null==content?void 0:content.image)||"",alt:"image"}})])})),0)])})),0)],1)])}),[],!1,null,"5ba4ef61",null)),Bt=Tt.exports;function Mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var Rt={inject:["top"],data:function(){return{list:[],loading:!1,paramsData:{page:1,page_size:50,category:"mine",type:2},isHaveMore:!1}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(h.c)("user",["cdnHostFun"])),mounted:function(){var t=this;this.top.token&&(this.getList(),this.$EventBus.$on("updateMine",(function(){setTimeout((function(){t.getList()}),1500)})))},beforeDestroy:function(){this.$EventBus.$off("updateMine")},methods:{getList:function(){var t=this;this.loading=!0,Object(Q.y)(this.paramsData).then((function(e){var data=e.data;t.list=t.paramsData.page>1?t.list.concat(data):data,t.isHaveMore=!(data.length<50),t.loading=!1}))},handleUse:function(t){var param={type:this.top.paintingBoardData.liveModel.show?"liveImgLayer":"imgLayer",imgSrc:t.image};this.top.changeData("topNav.tools.hasAct","selectEments"),L.a.emit("setLiveMoveable",{draggable:!0}),L.a.emit("setLiveViewer",{useMouseDrag:!1}),this.top.addLayerItem(param),this.top.eventFn.setBoardYesDage(),this.top.eventFn.setViewYesDage(!1)},handleDelete:function(t,e){var n=this;this.$confirm(this.$t("canvas_delete_tips"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel")}).then((function(){try{Object(Q.k)({id:t.id}).then((function(t){n.$message({type:"success",message:n.$t("deleteSuccess")}),n.list.splice(e,1)}))}catch(t){console.log(t)}})).catch((function(){n.$message({type:"info",message:n.$t("Cancel")})}))},isScrollBottom:function(){if(this.isHaveMore){var t=this.$refs.minematerial,e=t.clientHeight;t.scrollTop+e>=t.scrollHeight&&(this.paramsData.page+=1,this.getList())}}}},At=Rt,Et=(n(2810),Object(_.a)(At,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"minematerial",staticClass:"mine-panel",on:{scroll:t.isScrollBottom}},[t.list.length?e("div",{staticClass:"content"},[e("div",{staticClass:"label"},[t._v(t._s(t.$t("All")))]),t._v(" "),e("div",{staticClass:"materials"},t._l(t.list,(function(n,o){return e("div",{key:n.id,staticClass:"item-material",on:{click:function(e){return t.handleUse(n)}}},[e("img",{staticClass:"image",attrs:{src:n.image,alt:"image"}}),t._v(" "),e("div",{staticClass:"item-material-icon",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleDelete(n,o)}}},[e("i",{staticClass:"el-icon-close"})])])})),0)]):t._e(),t._v(" "),0!==t.list.length||t.loading?t._e():e("div",{staticClass:"empty-box"},[e("img",{staticClass:"empty-img",attrs:{src:"https://".concat(t.cdnHostFun(),"/static/upload/20240125/8b9a3975-7433-44ce-8244-5cb21cfe920c.webp"),alt:"empty image"}}),t._v(" "),e("div",{staticClass:"empty-tip"},[t._v(t._s(t.$t("no_data")))])])])}),[],!1,null,"1c576434",null).exports),Nt=(n(165),n(196));function Ft(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Ut(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ft(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ft(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ht={inject:["top"],data:function(){return{}},computed:Ut(Ut({},Object(h.c)("user",["cdnHostFun"])),{},{operationBtns:function(){return[{type:"copy",hoverTips:"copy",icon:"el-icon-document-copy"},{type:"down",hoverTips:"MoveDown",icon:"el-icon-arrow-down",hide:1!=this.selectedLayer.length},{type:"up",hoverTips:"MoveUp",icon:"el-icon-arrow-up",hide:1!=this.selectedLayer.length},{type:"delete",hoverTips:"canvas_delete_hover",icon:"el-icon-delete"}]},renderLayer:function(){var t=this.top.paintingBoardData.elementList.filter((function(t){return["brushLayer","imgLayer"].includes(t.type)}))||[];return t.sort((function(a,b){return b.z-a.z})),t},getActiveList:function(){return this.top.paintingBoardData.elementList.filter((function(t){return t.active}))||[]},selectedLayer:function(){return this.getActiveList.map((function(t){return t.layerId}))}}),methods:{showOrNot:function(t){t.show=!t.show},lockOrNot:function(t){t.lock=!t.lock},handleOperations:function(t){var e=this;switch(t){case"copy":var n=this.getActiveList.map((function(t){return t.z})),r=this.getActiveList.length?Math.max.apply(Math,Object(o.a)(n)):0,l=this.top.paintingBoardData.liveModel.show;this.getActiveList.forEach((function(t){var param={type:l?"liveImgLayer":"imgLayer",imgSrc:t.imgSrc||"",z:r+t.z};e.top.addLayerItem(param)}));break;case"down":this.handleOrder("down");break;case"up":this.handleOrder("up");break;case"delete":var c=this.top.paintingBoardData.elementList.filter((function(t){return!1===t.active}));this.top.changeData("elementList",c),document.querySelector("#layerBtnsId").style.left="0px",document.querySelector("#layerBtnsId").style.top="0px"}},handleOrder:function(t){var e=this;if(1==this.selectedLayer.length){var n=this.top.paintingBoardData.elementList,r=n.map((function(t){return t.z})),l=Math.max.apply(Math,Object(o.a)(r)),c=Math.min.apply(Math,Object(o.a)(r)),d=this.top.getEleInfo(this.selectedLayer[0],"z"),h=0,v=0,m=this.top.paintingBoardData.elementList.findIndex((function(t){return t.layerId==e.selectedLayer[0]}))||0;if("up"===t){if(h=(r=r.sort((function(a,b){return a-b}))).findIndex((function(t){return t==d})),d!=l){var f=r[h+1];v=n.findIndex((function(t){return t.z===f})),this.top.changeData("elementList[".concat(m,"].z"),f),this.top.changeData("elementList[".concat(v,"].z"),d)}}else if(h=(r=r.sort((function(a,b){return a-b}))).findIndex((function(t){return t==d})),d!=c){var _=r[h-1];v=n.findIndex((function(t){return t.z===_})),this.top.changeData("elementList[".concat(m,"].z"),_),this.top.changeData("elementList[".concat(v,"].z"),d)}}},handleClick:function(t){Object(Nt.a)("ctrlOrCmd").active?t.active=!t.active:(this.top.initLayerActive(),t.active=!0),this.top.eventFn.layerBtnsSetPoin()}}},zt=(n(2811),Object(_.a)(Ht,(function(){var t,e=this,n=e._self._c;return n("div",{staticClass:"layer-panel"},[null!==(t=e.renderLayer)&&void 0!==t&&t.length?n("div",{staticClass:"content"},[n("div",{staticClass:"title"},[e._v(e._s(e.$t("Layer")))]),e._v(" "),n("div",{staticClass:"layer-box"},e._l(e.renderLayer,(function(t,o){return n("div",{key:o,staticClass:"item-layer",class:{selected:e.selectedLayer.includes(t.layerId)},on:{click:function(n){return e.handleClick(t)}}},[n("div",{staticClass:"left"},[n("div",{staticClass:"eyes-box",on:{click:function(n){return n.stopPropagation(),e.showOrNot(t)}}},[n("i",{staticClass:"iconfont",class:t.show?"icon-work-show":"icon-work-hide"})]),e._v(" "),n("img",{staticClass:"layer",attrs:{src:t.imgSrc,alt:"layer"}}),e._v(" "),n("div",{staticClass:"name",attrs:{title:t.name}},[e._v(e._s(t.name))])]),e._v(" "),n("div",{staticClass:"right lock-box",on:{click:function(n){return n.stopPropagation(),e.lockOrNot(t)}}},[n("i",{class:t.lock?"el-icon-lock":"el-icon-unlock"})])])})),0),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.top.paintingBoardData.leftMenu.showLeftDrawer&&e.selectedLayer.length,expression:"\n\t\t\t\ttop.paintingBoardData.leftMenu.showLeftDrawer && selectedLayer.length\n\t\t\t"}],staticClass:"bottom-btns"},e._l(e.operationBtns,(function(t){return n("div",{directives:[{name:"show",rawName:"v-show",value:!t.hide,expression:"!item.hide"}],key:t.type,staticClass:"item-btn",on:{click:function(n){return e.handleOperations(t.type)}}},[n("el-tooltip",{attrs:{effect:"dark",disabled:!t.hoverTips,content:e.$t(t.hoverTips)}},[n("i",{class:t.icon})])],1)})),0)]):n("div",{staticClass:"empty-box"},[n("img",{staticClass:"empty-img",attrs:{src:"https://".concat(e.cdnHostFun(),"/static/upload/20240125/8b9a3975-7433-44ce-8244-5cb21cfe920c.webp"),alt:"empty image"}}),e._v(" "),n("div",{staticClass:"empty-tip"},[e._v(e._s(e.$t("no_data")))])])])}),[],!1,null,"5ff7c672",null).exports);function Vt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Wt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Vt(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Vt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var qt={inject:["top"],data:function(){return{}},computed:Wt(Wt({},Object(h.c)("user",["cdnHostFun"])),{},{operationBtns:function(){return[{type:"copy",hoverTips:"copy",icon:"el-icon-document-copy"},{type:"down",hoverTips:"MoveDown",icon:"el-icon-arrow-down",hide:1!=this.selectedLayer.length},{type:"up",hoverTips:"MoveUp",icon:"el-icon-arrow-up",hide:1!=this.selectedLayer.length},{type:"delete",hoverTips:"canvas_delete_hover",icon:"el-icon-delete"}]},renderLayer:function(){var t=this.top.paintingBoardData.liveLayerList.filter((function(t){return["liveBrushLayer","liveImgLayer"].includes(t.type)}))||[];return t.sort((function(a,b){return b.z-a.z})),t},getActiveList:function(){return this.top.paintingBoardData.liveLayerList.filter((function(t){return t.active}))||[]},selectedLayer:function(){return this.getActiveList.map((function(t){return t.layerId}))}}),methods:{showOrNot:function(t){t.show=!t.show,t.show||(t.active=!1,L.a.emit("hideLayerTopArea"))},lockOrNot:function(t){t.lock=!t.lock},handleOperations:function(t){var e=this;switch(t){case"copy":var n=this.getActiveList.map((function(t){return t.z})),r=this.getActiveList.length?Math.max.apply(Math,Object(o.a)(n)):0,l=this.top.paintingBoardData.liveModel.show;this.getActiveList.forEach((function(t){var param={type:l?"liveImgLayer":"imgLayer",imgSrc:t.imgSrc||"",z:r+t.z};e.top.addLayerItem(param)}));break;case"down":this.handleOrder("down");break;case"up":this.handleOrder("up");break;case"delete":var c=this.top.paintingBoardData.liveLayerList.filter((function(t){return!1===t.active}));this.top.changeData("liveLayerList",c),document.querySelector("#layerBtnsId").style.left="0px",document.querySelector("#layerBtnsId").style.top="0px"}},handleOrder:function(t){var e=this;if(1==this.selectedLayer.length){var n=this.top.paintingBoardData.liveLayerList,r=n.map((function(t){return t.z})),l=Math.max.apply(Math,Object(o.a)(r)),c=Math.min.apply(Math,Object(o.a)(r)),d=this.top.getEleInfo(this.selectedLayer[0],"z","liveLayerList"),h=0,v=0,m=n.findIndex((function(t){return t.layerId==e.selectedLayer[0]}))||0;if("up"===t){if(h=(r=r.sort((function(a,b){return a-b}))).findIndex((function(t){return t==d})),d!=l){var f=r[h+1];v=n.findIndex((function(t){return t.z===f})),this.top.changeData("liveLayerList[".concat(m,"].z"),f),this.top.changeData("liveLayerList[".concat(v,"].z"),d)}}else if(h=(r=r.sort((function(a,b){return a-b}))).findIndex((function(t){return t==d})),d!=c){var _=r[h-1];v=n.findIndex((function(t){return t.z===_})),this.top.changeData("liveLayerList[".concat(m,"].z"),_),this.top.changeData("liveLayerList[".concat(v,"].z"),d)}}},handleClick:function(t){Object(Nt.a)("ctrlOrCmd").active?t.active=!t.active:(this.top.initLiveLayerActive(),t.active=!0),L.a.emit("setLayerTopLocation")}}},Gt=(n(2812),Object(_.a)(qt,(function(){var t,e=this,n=e._self._c;return n("div",{staticClass:"layer-panel"},[null!==(t=e.renderLayer)&&void 0!==t&&t.length?n("div",{staticClass:"content"},[n("div",{staticClass:"title"},[e._v(e._s(e.$t("Layer")))]),e._v(" "),n("div",{staticClass:"layer-box"},e._l(e.renderLayer,(function(t,o){return n("div",{key:o,staticClass:"item-layer",class:{selected:e.selectedLayer.includes(t.layerId)},on:{click:function(n){return e.handleClick(t)}}},[n("div",{staticClass:"left"},[n("div",{staticClass:"eyes-box",on:{click:function(n){return n.stopPropagation(),e.showOrNot(t)}}},[n("i",{staticClass:"iconfont",class:t.show?"icon-work-show":"icon-work-hide"})]),e._v(" "),n("img",{staticClass:"layer",attrs:{src:t.imgSrc,alt:"layer"}}),e._v(" "),n("div",{staticClass:"name",attrs:{title:t.name}},[e._v(e._s(t.name))])]),e._v(" "),n("div",{staticClass:"right lock-box",on:{click:function(n){return n.stopPropagation(),e.lockOrNot(t)}}},[n("i",{class:t.lock?"el-icon-lock":"el-icon-unlock"})])])})),0),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.top.paintingBoardData.leftMenu.showLeftDrawer&&e.selectedLayer.length,expression:"\n        top.paintingBoardData.leftMenu.showLeftDrawer && selectedLayer.length\n      "}],staticClass:"bottom-btns"},e._l(e.operationBtns,(function(t){return n("div",{directives:[{name:"show",rawName:"v-show",value:!t.hide,expression:"!item.hide"}],key:t.type,staticClass:"item-btn",on:{click:function(n){return e.handleOperations(t.type)}}},[n("el-tooltip",{attrs:{effect:"dark",disabled:!t.hoverTips,content:e.$t(t.hoverTips)}},[n("i",{class:t.icon})])],1)})),0)]):n("div",{staticClass:"empty-box"},[n("img",{staticClass:"empty-img",attrs:{src:"https://".concat(e.cdnHostFun(),"/static/upload/20240125/8b9a3975-7433-44ce-8244-5cb21cfe920c.webp"),alt:"empty image"}}),e._v(" "),n("div",{staticClass:"empty-tip"},[e._v(e._s(e.$t("no_data")))])])])}),[],!1,null,"66fdb158",null).exports);function Yt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Jt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Yt(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Yt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Kt={inject:["top"],data:function(){return{list:[],loading:!1,paramsData:{page:1,page_size:20,category:"product",type:2},isHaveMore:!1,isUploading:!1,loopInterval:null,UPLOAD:new w.a({type:45})}},mounted:function(){this.top.token&&this.getList()},beforeDestroy:function(){clearInterval(this.loopInterval),this.loopInterval=null,clearTimeout()},methods:{getList:function(){var t=this;this.loading=!0,Object(Q.y)(this.paramsData).then((function(e){var data=e.data,n=t.paramsData,o=n.page,r=n.page_size;t.list=o>1?t.list.concat(data):data,t.isHaveMore=!(data.length<r),t.loading=!1}))},addProductImg:function(t){var e=this,image=t.image,n=this.top.paintingBoardData,o=n.liveModel,r=n.liveLayerList;null!=o&&o.show||this.top.changeData("liveModel.show",!0),this.$nextTick((function(){e.top.paintingBoardData.liveLayerList=r.filter((function(t){return t.z<1e4}));var param={type:"liveProductImgLayer",imgSrc:image,isProduct:!0};e.top.changeData("topNav.tools.hasAct","selectEments"),L.a.emit("setLiveMoveable",{draggable:!0}),L.a.emit("setLiveViewer",{useMouseDrag:!1}),e.top.eventFn.setBoardYesDage(),e.top.eventFn.setViewYesDage(!1),e.top.addLayerItem(param)}))},handleUse:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var image,o,r,l,c,d,h,v,m,f,_,y,w,param,C;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return image=t.image,o=e.top.paintingBoardData,r=o.liveModel,l=o.liveLayerList,null!=r&&r.show||(e.top.changeData("liveModel.show",!0),e.top.setLiveLocal(),e.top.paintingBoardData.liveModel=Jt(Jt({},r),{},{width:1024,height:1024})),e.top.paintingBoardData.liveLayerList=l.filter((function(t){return t.z<1e4})),n.next=6,Object(bt.l)(image);case 6:return c=n.sent,d=c.width,h=c.height,v=e.top.paintingBoardData.liveModel,v.x,v.y,m=v.width,f=v.height,y=f-10>0?f-10:f,(d>(_=m-10>0?m-10:m)||h>y)&&(w=Math.min(_/d,y/h),d*=w,h*=w),e.top.paintingBoardData.liveModel.show,param={type:"liveProductImgLayer",imgSrc:image,isProduct:!0},e.top.changeData("topNav.tools.hasAct","selectEments"),L.a.emit("setLiveMoveable",{draggable:!0}),L.a.emit("setLiveViewer",{useMouseDrag:!1}),e.top.eventFn.setBoardYesDage(),e.top.eventFn.setViewYesDage(!1),n.next=22,e.top.addLayerItem(param);case 22:C=n.sent,e.top.paintingBoardData.liveModel.productLayerId=C,setTimeout((function(){null!=r&&r.show&&e.top.handleWatchLiveGenerate()}),500);case 25:case"end":return n.stop()}}),n)})))()},handleBeforeUpload:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,r,l,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.$logEvent("log_actions",{operation:"click_upload_product",behavior_info:"on_canvas"}),o=["image/jpeg","image/png","image/jpg","image/webp"],!e.isUploading){n.next=4;break}return n.abrupt("return");case 4:if(o.includes(t.type)){n.next=7;break}return e.$message.error(e.$t("AllowImageFiles")),n.abrupt("return",!1);case 7:if(!t||t.size){n.next=9;break}return n.abrupt("return",!1);case 9:if(!(t.size/1024/1024>5)){n.next=20;break}return n.prev=10,n.next=13,Object(C.a)(t,5242880);case 13:t=n.sent,n.next=20;break;case 16:return n.prev=16,n.t0=n.catch(10),console.error("Compression failed:",n.t0),n.abrupt("return",!1);case 20:return n.prev=20,e.isUploading=!0,n.next=24,e.UPLOAD.startUpload(t);case 24:return r=n.sent,n.next=27,Object(Q.r)({image_url:r});case 27:l=n.sent,(c=l.data.id)&&e.loopGetResult(c),n.next=35;break;case 32:n.prev=32,n.t1=n.catch(20),e.isUploading=!1;case 35:return n.abrupt("return",!1);case 36:case"end":return n.stop()}}),n,null,[[10,16],[20,32]])})))()},loopGetResult:function(t){var e=this;this.loopInterval=setInterval(Object(l.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,d,h,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(v.a)({scene:1,task_ids:[t]});case 3:if(r=n.sent,null!=(l=r.data.items)&&l[0]){n.next=8;break}return e.isUploading=!1,n.abrupt("return");case 8:c=l[0],d=c.status_desc,h=c.img_uris,m=(null==h||null===(o=h[0])||void 0===o?void 0:o.url)||"",n.t0=d,n.next="finish"===n.t0?13:"sysCancelDesc"===n.t0?17:"sysTimeoutDesc"===n.t0?21:25;break;case 13:return e.saveToList(m),clearInterval(e.loopInterval),e.isUploading=!1,n.abrupt("break",26);case 17:return e.$message.warning(e.$t("systemCancel")),clearInterval(e.loopInterval),e.isUploading=!1,n.abrupt("break",26);case 21:return e.$message.warning(e.$t("systemTimeoutCancel")),clearInterval(e.loopInterval),e.isUploading=!1,n.abrupt("break",26);case 25:return n.abrupt("break",26);case 26:n.next=33;break;case 28:n.prev=28,n.t1=n.catch(0),e.isUploading=!1,clearInterval(e.loopInterval),console.log("error",n.t1);case 33:case"end":return n.stop()}}),n,null,[[0,28]])}))),3e3)},saveToList:function(image){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Q.I)({items:[{category:"product",image:image,name:""}]});case 2:e.sent&&(t.$message.success(t.$t("UploadSuccess")),setTimeout((function(){t.isUploading=!1,t.getList()}),1e3));case 4:case"end":return e.stop()}}),e)})))()},handleDelete:function(t,e){var n=this;this.$confirm(this.$t("canvas_delete_tips"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel")}).then((function(){try{Object(Q.k)({id:t.id}).then((function(t){n.$message({type:"success",message:n.$t("deleteSuccess")}),n.list.splice(e,1)}))}catch(t){console.log(t)}})).catch((function(){n.$message({type:"info",message:n.$t("Cancel")})}))},handleDownload:function(t){var img=new Image;img.crossOrigin="anonymous",img.src=t,img.onload=function(){var canvas=document.createElement("canvas");canvas.width=img.width,canvas.height=img.height,canvas.getContext("2d").drawImage(img,0,0);var t=canvas.toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download="product.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)},this.$message.success(this.$t("OperateSuccess"))},isScrollBottom:function(){if(this.isHaveMore){var t=this.$refs.product,e=t.clientHeight;t.scrollTop+e>=t.scrollHeight&&(this.paramsData.page+=1,this.getList())}}}},Xt=(n(2813),{components:{GeneratePanel:gt,TemplatePanel:Pt,MaterialPanel:Bt,MinePanel:Et,LayerPanel:zt,LayerLivePanel:Gt,Product:Object(_.a)(Kt,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"product",staticClass:"product",on:{scroll:t.isScrollBottom}},[e("div",{staticClass:"product-tips"},[t._v(t._s(t.$t("canvas_product_tips")))]),t._v(" "),e("div",{staticClass:"product-list"},[e("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:t.isUploading,expression:"isUploading"}],key:"backgroundUpload",ref:"backgroundUpload",staticClass:"product-list-item",attrs:{action:"#","before-upload":t.handleBeforeUpload,disabled:t.isUploading,accept:".jpg, .jpeg, .png, .webp","http-request":function(){},"show-file-list":!1}},[e("div",{attrs:{slot:"trigger"},slot:"trigger"},[e("i",{staticClass:"el-icon-plus"}),t._v(" "),e("span",{staticClass:"upload-text"},[t._v(t._s(t.$t("canvas_upload_product")))])])]),t._v(" "),t._l(t.list,(function(n,o){return e("div",{key:n.id,staticClass:"product-list-item",on:{click:function(e){return t.addProductImg(n)}}},[e("img",{attrs:{src:n.image,alt:"image"}}),t._v(" "),e("div",{staticClass:"product-list-item-icon image-icon right36",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleDelete(n,o)}}},[e("i",{staticClass:"el-icon-delete"})]),t._v(" "),e("div",{staticClass:"product-list-item-icon image-icon",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleDownload(n.image)}}},[e("i",{staticClass:"el-icon-download"})])])}))],2)])}),[],!1,null,"7e36059b",null).exports},inject:["top"],props:{currentMenu:{type:String,default:""}},data:function(){return{}},computed:{showLiveLayer:function(){return"Layer"===this.currentMenu&&this.top.paintingBoardData.liveModel.show},showControLayer:function(){return"Layer"===this.currentMenu&&!this.top.paintingBoardData.liveModel.show}},methods:{showMenu:function(){this.top.changeData("leftMenu.showLeftDrawer",!0)},toggleMenuBard:function(){this.top.changeData("leftMenu.showLeftDrawer",!this.top.paintingBoardData.leftMenu.showLeftDrawer)},changeMenuToLayer:function(){this.$emit("changeMenu",{label:"Layer"})}}}),Qt=(n(2814),{components:{LeftDrawer:Object(_.a)(Xt,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"left-drawer",class:t.top.paintingBoardData.leftMenu.showLeftDrawer?"show-menu":"hide-menu"},[e("div",{staticClass:"content"},[e("Product",{directives:[{name:"show",rawName:"v-show",value:"Product"===t.currentMenu,expression:"currentMenu === 'Product'"}]}),t._v(" "),e("GeneratePanel",{directives:[{name:"show",rawName:"v-show",value:"Generate"===t.currentMenu,expression:"currentMenu === 'Generate'"}],model:{value:t.top.paintingBoardData.controlNet,callback:function(e){t.$set(t.top.paintingBoardData,"controlNet",e)},expression:"top.paintingBoardData.controlNet"}}),t._v(" "),"Template"===t.currentMenu?e("TemplatePanel"):t._e(),t._v(" "),"Material"===t.currentMenu?e("MaterialPanel"):t._e(),t._v(" "),"Mine"===t.currentMenu?e("MinePanel"):t._e(),t._v(" "),t.showControLayer?e("LayerPanel"):t._e(),t._v(" "),t.showLiveLayer?e("LayerLivePanel"):t._e()],1),t._v(" "),e("div",{staticClass:"open-btn",on:{click:t.toggleMenuBard}},[e("i",{class:t.top.paintingBoardData.leftMenu.showLeftDrawer?"el-icon-arrow-left":"el-icon-arrow-right"})]),t._v(" "),e("div",{staticClass:"layer-btn",on:{click:t.changeMenuToLayer}},[e("el-tooltip",{attrs:{effect:"dark",content:t.$t("Layer")}},[e("i",{staticClass:"iconfont icon-icon_tuceng"})])],1)])}),[],!1,null,"daef3f88",null).exports},inject:["top"],data:function(){return{menuList:[{label:"Product",icon:"icon-tiaojiecanshu"},{label:"Generate",icon:"icon-tiaojiecanshu"},{label:"Template",icon:"icon-icon_moban"},{label:"Material",icon:"icon-icon_sucai"},{label:"Mine",icon:"icon-icon_wode"}],currentMenu:"Product"}},methods:{changeMenu:function(t){this.currentMenu=t.label,this.top.leftActiveTab=t.label,this.$refs.leftDrawer.showMenu()}}}),Zt=(n(2815),Object(_.a)(Qt,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"left-menu-box"},[e("div",{staticClass:"menu-list"},t._l(t.menuList,(function(n){return e("div",{key:n.label,staticClass:"item",class:{active:t.currentMenu===n.label},on:{click:function(e){return t.changeMenu(n)}}},[e("div",{staticClass:"icon"},[e("i",{staticClass:"iconfont",class:n.icon})]),t._v(" "),e("div",{staticClass:"text"},[t._v(t._s(t.$t(n.label)))])])})),0),t._v(" "),e("LeftDrawer",{ref:"leftDrawer",attrs:{currentMenu:t.currentMenu},on:{changeMenu:t.changeMenu}})],1)}),[],!1,null,"2a873c04",null).exports),te=n(151);function ee(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function ie(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ee(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ne={name:"addOrEditParamsDialog",data:function(){return{isShowDialog:!1,btnLoading:!1,paramName:"",type:"",info:{}}},computed:{},methods:{openDialog:function(t,e){this.type=t,this.info=e,"edit"==t&&(this.paramName=(null==e?void 0:e.name)||""),this.isShowDialog=!0},closeDialog:function(){this.type="",this.info={},this.paramName="",this.isShowDialog=!1,this.btnLoading=!1},handleConfirm:function(){var t=this;if(this.btnLoading=!0,!this.paramName.length)return this.$message.warning(this.$t("ParamNameWarning")),void(this.btnLoading=!1);if("add"==this.type){var e=this.info.lora_models,n=void 0===e?[]:e;Object(Q.i)(ie(ie({},this.info),{},{lora_models:n,name:this.paramName})).then((function(e){var n,o=(null==e||null===(n=e.data)||void 0===n?void 0:n.id)||"";t.$message.success(t.$t("CreateSuccess")),t.closeDialog(),t.$emit("updateList",o)})).finally((function(){t.btnLoading=!1}))}else Object(Q.p)({id:this.info.value,name:this.paramName}).then((function(){t.$message.success(t.$t("SuccessfullyModified")),t.closeDialog(),t.$emit("updateList")})).finally((function(){t.btnLoading=!1}))}}},ae=(n(2816),Object(_.a)(ne,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"add-params custom-dialog-canvas",attrs:{width:"475px","append-to-body":"",title:t.$t("add"==t.type?"AddPresetParam":"ModifyPresetParamName"),visible:t.isShowDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.isShowDialog=e}}},[e("div",{staticClass:"label"},[t._v(t._s(t.$t("ParamName")))]),t._v(" "),e("el-input",{staticClass:"canvas-name-input",attrs:{placeholder:"",maxlength:"15"},model:{value:t.paramName,callback:function(e){t.paramName=e},expression:"paramName"}}),t._v(" "),e("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.closeDialog}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{attrs:{loading:t.btnLoading},on:{click:t.handleConfirm}},[t._v("\n\t\t\t"+t._s(t.$t("Confirm"))+"\n\t\t")])],1)],1)}),[],!1,null,"57acec7c",null).exports);function oe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function se(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?oe(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var re={components:{StyleModal:te.a,addOrEditParamsDialog:ae},inject:["top"],props:{showCell:{type:Boolean,default:!1}},data:function(){return{extraSelectedModel:[],styleModalType:"Checkpoint",isHideAdvanced:!0,defParamsArr:[],defParamsValueArr:[],customizeParamsArr:[],baseModelArr:[],vaeArr:[],defSamplerMethodArr:[],liveSamplerMethodArr:[],defParams:{},defaultTemplate:{}}},mounted:function(){this.getConfig(),this.getRandomNumber(),this.getCusDefParams(),this.top.eventFn.submitPublish=this.submit},computed:se(se(se({},Object(h.c)("payment",["paymentInfo"])),Object(h.c)("user",["isCompanyAccount"])),{},{isVipFun:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)||this.isCompanyAccount},isCheckPoint:function(){return"Checkpoint"===this.styleModalType},isLoRA:function(){return"LORA"===this.styleModalType},isSdModel:function(){var t;return!(null===(t=this.selectedModelInfo)||void 0===t||!t.base_model)&&(this.selectedModelInfo.base_model.includes("sdxl")||this.selectedModelInfo.base_model.includes("SDXL"))},renderModelList:function(){return this.extraSelectedModel.length?[].concat(Object(o.a)(this.baseModelArr),Object(o.a)(this.extraSelectedModel)):Object(o.a)(this.baseModelArr)},selectedModelInfo:function(){var t=this;return this.renderModelList.find((function(e){return e.id==t.advancedParams.modelInfo.id}))},styleModalSelectIds:function(){var t,e,n;return this.isCheckPoint?[{id:null===(t=this.selectedModelInfo)||void 0===t?void 0:t.id,art_model_ver_no_name:null===(e=this.selectedModelInfo)||void 0===e?void 0:e.model_ver_no,model_cover:null===(n=this.selectedModelInfo)||void 0===n?void 0:n.cover}]:[]},advancedParams:function(){return this.top.paintingBoardData.currentParams||{}},renderParamsList:function(){return[].concat(Object(o.a)(this.defParamsArr),Object(o.a)(this.customizeParamsArr))},isDefParams:function(){return this.defParamsValueArr.includes(this.top.paintingBoardData.selectedParams)},basicParams:function(){var t=this.top.paintingBoardData.basicParams;return t},disabledNum:function(){var t=this.top.paintingBoardData.topNav.tools.hasAct;return[1,2].includes(this.top.generateType)&&"updateArimg"===t},handleBtnStyle:function(){var t=this.top.paintingBoardData.liveModel;return t.loading||!t.result},showBrushWerght:function(){var t=this.top.paintingBoardData,e=t.liveLayerList,n=t.liveModel,o=t.topNav,r=e.some((function(t){return"liveBrushLayer"===t.type})),l=n.show,c="brushBoard"===o.tools.hasAct;return r&&l||c}}),watch:{isSdModel:{handler:function(){this.changeAdvancedParams([],"selectedLora")}}},methods:se(se({},Object(h.b)("creation",["setEditBoardGenerateOptions"])),{},{getConfig:function(){var t=this;this.top.token?(this.top.paramsLoading=!0,Object(Q.v)().then((function(e){var n,o=e.data,r=o.templates,l=o.base_model,c=o.vaes,d=o.ge_sampler,h=o.live_sampler,v=o.default_template;t.setEditBoardGenerateOptions(null==e?void 0:e.data),t.defaultTemplate=v,t.saveDefParams(v),t.baseModelArr=l.map((function(t){return se({model_ver_no:"",model_ver_name:""},t)})),t.vaeArr=c,t.defSamplerMethodArr=d,t.liveSamplerMethodArr=h,t.defParamsArr=t.formatParams(r,"def");var m=(null==r||null===(n=r[0])||void 0===n?void 0:n.id)||"";t.changeData(m,"selectedParams");var f=t.renderParamsList.find((function(t){return(null==t?void 0:t.value)==m})),_=tt()(f.params);t.changeData(_,"currentParams"),setTimeout((function(){t.top.paramsLoading=!1}),200)}))):this.dataReady=!0},saveDefParams:function(t){var e=t.model_no,n=t.model_name,o=t.model_ver_name,r=t.model_ver_no,l=t.model_cover,c=t.base_model,d=void 0===c?"":c,h=t.prompt,v=t.negative_prompt,m=t.vae,f=t.ge_setting,_=f.sampler,y=f.steps,w=f.cfg_scale,C=t.live_setting,k=C.sampler,O=C.steps,x=C.cfg_scale;this.defParams={modelInfo:{id:e,name:n,model_ver_no:r,model_ver_name:o,cover:l,base_model:d},selectedLora:[],stylePrompt:h,negativePrompt:v,vae:m,samplerSettingsDefault:{samplingMethod:_,samplingSteps:y,upscaling:15,CFGScale:w},samplerSettingsLive:{samplingMethod:k,samplingSteps:O,CFGScale:x}}},getCusDefParams:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.top.token&&Object(Q.x)().then((function(n){var o=n.data.items;t.customizeParamsArr=t.formatParams(o),e&&t.changeData(e,"selectedParams")}))},formatParams:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null!=t&&t.length?t.map((function(t){var o=t.name,r=t.id,l=t.model_no,c=t.model_name,d=t.model_ver_name,h=t.model_ver_no,v=t.model_cover,m=t.loras,f=t.prompt,_=t.negative_prompt,y=t.vae,w=t.ge_setting,C=w.sampler,k=w.steps,O=w.cfg_scale,x=t.live_setting,I=x.sampler,D=x.steps,S=x.cfg_scale,P={id:l,name:c,model_ver_no:h,model_ver_name:d,cover:v,base_model:(null==t?void 0:t.base_model)||""},L=m?m.map((function(t){return{cover:t.model_cover,id:t.model_no,name:t.model_name,model_ver_name:"",model_ver_no:t.model_ver_no,weights:t.weight}})):[];return"def"==n&&e.defParamsValueArr.push(r),!e.renderModelList.find((function(t){return t.id==l}))&&e.extraSelectedModel.push(P),{name:o,value:r,params:{modelInfo:P,selectedLora:L,stylePrompt:f,negativePrompt:_,vae:y,samplerSettingsDefault:{samplingMethod:C,samplingSteps:k,upscaling:15,CFGScale:O},samplerSettingsLive:{samplingMethod:I,samplingSteps:D,CFGScale:S}}}})):[]},changeUrl:function(t){return Object(bt.x)(t,"high")},handleAddOrEditParam:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t){case"add":this.$logEvent("log_actions",{operation:"click_new_addition",behavior_info:"on_canvas_parameters"});break;case"saveAs":this.$logEvent("log_actions",{operation:"click_save_as",behavior_info:"on_canvas_parameters"})}var n="saveAs"==t?"add":t;this.$refs.addOrEditParam.openDialog(n,e)},handleModifyParams:function(t){var e=this,n=this.top.paintingBoardData.selectedParams,o=this.customizeParamsArr.find((function(t){return t.value==n})),r=this.advancedParams,l=r.samplerSettingsDefault,c=l.CFGScale,d=l.samplingMethod,h=l.samplingSteps,v=r.samplerSettingsLive,m=v.CFGScale,f=v.samplingMethod,_=v.samplingSteps,y=r.modelInfo,w=y.id,C=y.model_ver_no,k=r.selectedLora,O=r.stylePrompt,x=r.negativePrompt,I=r.vae;k=k.map((function(t){return{model_id:t.id,model_ver_no:t.model_ver_no,weight:t.weights}}));var D={name:(null==o?void 0:o.name)||"",id:n,ge_setting:{cfg_scale:c,sampler:d,steps:h},live_setting:{cfg_scale:m,sampler:f,steps:_},model_no:w,model_ver_no:C,lora_models:k,prompt:O,negative_prompt:x,vae:I};"save"==t?(this.$logEvent("log_actions",{operation:"click_save",behavior_info:"on_canvas_parameters"}),Object(Q.o)(D).then((function(t){e.$message.success(e.$t("SaveSuccess")),e.getCusDefParams()}))):this.handleAddOrEditParam("saveAs",D)},handleDeletParam:function(t){var e=this;Object(Q.j)({id:t}).then((function(n){if(e.$message.success(e.$t("deleteSuccess")),e.top.paintingBoardData.selectedParams==t){var o,r=(null===(o=e.defParamsArr)||void 0===o?void 0:o[0])||{},l=r.value,c=r.params;e.changeData(l,"selectedParams");var d=tt()(c);e.changeData(d,"currentParams")}e.customizeParamsArr=e.customizeParamsArr.filter((function(e){return e.value!=t}))}))},selectModelChange:function(t){if("MoreModel"==t)this.openModelSelect("Checkpoint");else{var e=this.renderModelList.find((function(e){return e.id===t}));this.changeAdvancedParams(e,"modelInfo")}},openModelSelect:function(t){var e=this;this.styleModalType=t,this.$nextTick((function(){e.$refs.styleModal.openModal()}))},handleSelectModel:function(t){var e=t.banner.url,n=void 0===e?"":e,o=t.id,r=void 0===o?"":o,l=t.name,c=void 0===l?"":l,d=t.model_ver_no,h=void 0===d?"":d,v=t.version_name,m=void 0===v?"":v,f=t.base_model,_=void 0===f?"":f;if(this.isCheckPoint){!this.extraSelectedModel.find((function(t){return t.id==r}))&&this.extraSelectedModel.push({cover:n,id:r,model_ver_name:m,model_ver_no:h,name:c,base_model:_}),this.changeAdvancedParams(t,"modelInfo")}else{var y;if(!this.isVipFun&&(null===(y=this.advancedParams)||void 0===y||null===(y=y.selectedLora)||void 0===y?void 0:y.length)>=3)return void this.$EventBus.$emit("showBreakDialog","LoRALimit5TipWeb","basic");var w=this.advancedParams.selectedLora.find((function(t){return t.id==r})),C=this.advancedParams.selectedLora;w||(C.push({cover:n,id:r,model_ver_name:m,model_ver_no:h,name:c,weights:1}),this.changeAdvancedParams(C,"selectedLora"))}this.$refs.styleModal.handleClose()},deleteSelectedLora:function(t){var e=this.advancedParams.selectedLora.filter((function(e){return e.id!=t}));this.changeAdvancedParams(e,"selectedLora")},getRandomNumber:function(){var t=Math.floor(65538*Math.random())-1;this.changeData(t,"basicParams.randomSeed")},changeCurrentParams:function(t){this.changeData(t,"selectedParams");var e=this.renderParamsList.find((function(e){return(null==e?void 0:e.value)==t})),n=tt()(e.params);this.changeData(n,"currentParams")},handleResetParams:function(){var t=tt()(this.defParams);this.changeData(t,"currentParams")},changeWeights:function(t,e){e.weights=t},changeAdvancedParams:function(t,e){this.changeData(t,"currentParams.".concat(e))},changeData:function(t,e){this.top.changeData(e,t)},submit:function(){if(!this.top.token)return this.$EventBus.$emit("openLoginDialog",{callBack:function(){window.location.reload()}});var t=this.top.paintingBoardData.liveModel;t.params.taskId&&t.result&&!t.loading&&this.top.publishPop({width:t.width,height:t.height,url:t.result,task_id:t.params.taskId})}})},le=re,ce=(n(2817),Object(_.a)(le,(function(){var t,e,n,o,r,l,c,d,h=this,v=h._self._c;return v("div",{staticClass:"right-params-page no-snapshot"},[v("div",{staticClass:"right-params-box"},[v("div",{staticClass:"basic-params"},[v("div",{staticClass:"denoising-strength item-param"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("DenoisingStrength")))]),h._v(" "),v("el-slider",{attrs:{value:null===(t=h.basicParams)||void 0===t?void 0:t.denoisingStrength,min:.01,max:1,step:.05,"show-input":!0,"show-input-controls":!1},on:{input:function(t){return h.changeData(t,"basicParams.denoisingStrength")}}})],1),h._v(" "),v("div",{directives:[{name:"show",rawName:"v-show",value:h.showBrushWerght,expression:"showBrushWerght"}],staticClass:"denoising-strength item-param",staticStyle:{"margin-top":"8px"}},[v("div",{staticClass:"label brush-werght-name"},[h._v("\n\t\t\t\t\t"+h._s(h.$t("ControlWeight"))+"\n\t\t\t\t\t"),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("controlWeightTipsRight"),placement:"top-start"}},[v("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),v("el-slider",{attrs:{value:null===(e=h.basicParams)||void 0===e?void 0:e.brushWeight,min:0,max:2,step:.1,"show-input":!0,"show-input-controls":!1},on:{input:function(t){return h.changeData(t,"basicParams.brushWeight")}}})],1),h._v(" "),v("div",{staticClass:"random-seed item-param l-r"},[v("div",{staticClass:"left"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("Seed")))]),h._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("ASendCTOOARNG"),placement:"top-start"}},[v("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),v("div",{staticClass:"right"},[v("el-input-number",{staticClass:"number",attrs:{value:null===(n=h.basicParams)||void 0===n?void 0:n.randomSeed,size:"mini",min:-1,max:65536,controls:!1},on:{input:function(t){return h.changeData(t,"basicParams.randomSeed")}}}),h._v(" "),v("i",{staticClass:"iconfont icon-dice-square dice",on:{click:h.getRandomNumber}})],1)]),h._v(" "),v("div",{staticClass:"images-number item-param l-r"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("QuantityOfImages")))]),h._v(" "),v("el-select",{staticClass:"custom-select-transparent",attrs:{value:null===(o=h.basicParams)||void 0===o?void 0:o.imagesNumber,"popper-class":"painting-board-select",disabled:h.disabledNum,"popper-append-to-body":!1},on:{change:function(t){return h.changeData(t,"basicParams.imagesNumber")}}},h._l(4,(function(t){return v("el-option",{key:"quantity-of-images"+t,attrs:{label:t,value:t}})})),1)],1)]),h._v(" "),v("div",{staticClass:"default-params item-param"},[v("div",{staticClass:"top"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("DefaultParams")))]),h._v(" "),v("i",{staticClass:"el-icon-plus",on:{click:function(t){return h.handleAddOrEditParam("add",h.defaultTemplate)}}})]),h._v(" "),v("div",{staticClass:"bottom"},[v("el-select",{ref:"paramSelect",attrs:{value:h.top.paintingBoardData.selectedParams,"popper-class":"painting-board-select",placeholder:h.$t("PlsSelectDefaultParams"),"popper-append-to-body":!1},on:{change:h.changeCurrentParams}},h._l(h.renderParamsList,(function(t){return v("el-option",{key:t.value,attrs:{label:t.name,value:t.value}},[h.defParamsValueArr.includes(t.value)?v("div",{staticClass:"show-params-name"},[v("div",{staticClass:"param-name"},[h._v("\n\t\t\t\t\t\t\t\t"+h._s(t.name)+"\n\t\t\t\t\t\t\t")])]):v("div",{staticClass:"show-params-name"},[v("div",{staticClass:"param-name"},[h._v("\n\t\t\t\t\t\t\t\t"+h._s(t.name)+"\n\t\t\t\t\t\t\t")]),h._v(" "),v("div",{staticClass:"operations",class:{alwaysShow:t.value===h.top.paintingBoardData.selectedParams}},[v("i",{staticClass:"el-icon-edit",on:{click:function(e){return e.stopPropagation(),h.handleAddOrEditParam("edit",t)}}}),h._v(" "),v("i",{staticClass:"el-icon-delete",on:{click:function(e){return e.stopPropagation(),h.handleDeletParam(t.value)}}})])])])})),1)],1)]),h._v(" "),v("div",{staticClass:"advanced-params"},[v("div",{staticClass:"title",on:{click:function(t){h.isHideAdvanced=!h.isHideAdvanced}}},[v("div",{staticClass:"label"},[v("i",{staticClass:"iconfont icon-gaojishezhi"}),h._v("\n\t\t\t\t\t"+h._s(h.$t("AdvancedConfig"))+"\n\t\t\t\t")]),h._v(" "),v("i",{staticClass:"el-icon-caret-bottom",class:{reverse:h.isHideAdvanced}})]),h._v(" "),v("div",{staticClass:"content",class:{hide:h.isHideAdvanced}},[v("div",{staticClass:"select-model item-param"},[v("div",{staticClass:"top"},[v("div",{staticClass:"label"},[h._v("\n\t\t\t\t\t\t\t"+h._s(h.$t("Model"))+"\n\t\t\t\t\t\t")]),h._v(" "),v("el-select",{staticClass:"custom-select-transparent",attrs:{value:h.advancedParams.modelInfo.id,placeholder:"","popper-class":"painting-board-select","popper-append-to-body":!1},on:{change:h.selectModelChange}},[h._l(h.renderModelList,(function(t,i){return v("el-option",{key:"model_"+i,attrs:{label:null==t?void 0:t.name,value:null==t?void 0:t.id}})})),h._v(" "),v("el-option",{attrs:{label:h.$t("selectMoreModel"),value:"MoreModel"}})],2)],1),h._v(" "),v("div",{staticClass:"bottom"},[null!==(r=h.selectedModelInfo)&&void 0!==r&&r.cover?v("el-image",{attrs:{src:h.changeUrl(null===(l=h.selectedModelInfo)||void 0===l?void 0:l.cover)}},[v("template",{slot:"placeholder"},[v("i",{staticClass:"el-icon-loading image-loading"})])],2):v("p",{staticClass:"empty-img"},[h._v(h._s(h.$t("EmptyBannerText")))]),h._v(" "),v("div",{staticClass:"name",attrs:{title:null===(c=h.selectedModelInfo)||void 0===c?void 0:c.name}},[h._v("\n\t\t\t\t\t\t\t"+h._s(null===(d=h.selectedModelInfo)||void 0===d?void 0:d.name)+"\n\t\t\t\t\t\t")]),h._v(" "),v("div",{staticClass:"swap",on:{click:function(t){return h.openModelSelect("Checkpoint")}}},[v("i",{staticClass:"iconfont icon-select-model-icon"}),h._v(" "),v("span",{staticClass:"text"},[h._v(h._s(h.$t("switch")))])])],1)]),h._v(" "),v("div",{staticClass:"select-style item-param"},[v("div",{staticClass:"top",on:{click:function(t){return h.openModelSelect("LORA")}}},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("LoRA")))]),h._v(" "),v("i",{directives:[{name:"show",rawName:"v-show",value:h.advancedParams.selectedLora.length<5,expression:"advancedParams.selectedLora.length < 5"}],staticClass:"el-icon-circle-plus"})]),h._v(" "),v("div",{directives:[{name:"show",rawName:"v-show",value:h.advancedParams.selectedLora.length,expression:"advancedParams.selectedLora.length"}],staticClass:"bottom"},h._l(h.advancedParams.selectedLora,(function(t){return v("div",{key:t.id,staticClass:"item-lora"},[t.cover?v("el-image",{attrs:{src:h.changeUrl(t.cover)}},[v("template",{slot:"placeholder"},[v("i",{staticClass:"el-icon-loading image-loading"})])],2):v("p",{staticClass:"empty-img"},[h._v(h._s(h.$t("EmptyBannerText")))]),h._v(" "),v("div",{staticClass:"right"},[v("div",{staticClass:"top"},[v("div",{staticClass:"name",attrs:{title:t.name}},[h._v(h._s(t.name))]),h._v(" "),v("i",{staticClass:"el-icon-delete",on:{click:function(e){return h.deleteSelectedLora(t.id)}}})]),h._v(" "),v("div",{staticClass:"bottom"},[v("el-slider",{attrs:{value:t.weights,min:-1,max:2,step:.05,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(e){return h.changeWeights(e,t)}}})],1)])],1)})),0)]),h._v(" "),v("div",{staticClass:"style-prompt item-param"},[v("div",{staticClass:"top"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("Prompt")))]),h._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("PromptTip"),placement:"top-start"}},[v("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),v("div",{staticClass:"bottom"},[v("el-input",{staticClass:"style-prompt-input",attrs:{type:"textarea",value:h.advancedParams.stylePrompt},on:{input:function(t){return h.changeAdvancedParams(t,"stylePrompt")}}})],1)]),h._v(" "),v("div",{staticClass:"negative-prompt item-param"},[v("div",{staticClass:"top"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("NegativePrompts")))]),h._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("NegativePromptTip"),placement:"top-start"}},[v("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),v("div",{staticClass:"bottom"},[v("el-input",{staticClass:"negative-prompt-input",attrs:{type:"textarea",value:h.advancedParams.negativePrompt},on:{input:function(t){return h.changeAdvancedParams(t,"negativePrompt")}}})],1)]),h._v(" "),v("div",{staticClass:"vae item-param"},[v("div",{staticClass:"left"},[v("div",{staticClass:"label"},[h._v("VAE")]),h._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("newVaeTip"),placement:"top-start"}},[v("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),v("div",{staticClass:"right"},[v("el-select",{staticClass:"custom-select-transparent",attrs:{value:h.advancedParams.vae,"popper-append-to-body":!1,"popper-class":"painting-board-select"},on:{change:function(t){return h.changeAdvancedParams(t,"vae")}}},h._l(h.vaeArr,(function(t,i){return v("el-option",{key:"method_"+i,attrs:{label:t,value:t}},[v("el-tooltip",{attrs:{content:t,placement:"left"}},[v("span",[h._v(h._s(t))])])],1)})),1)],1)]),h._v(" "),v("div",{staticClass:"default-type"},[v("div",{staticClass:"title"},[h._v(h._s(h.$t("SamplerSettingsDefault")))]),h._v(" "),v("div",{staticClass:"sampling-method item-param"},[v("div",{staticClass:"left"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("SamplingMethod")))]),h._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("SamplingMethodDefaultTip"),placement:"top-start"}},[v("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),v("div",{staticClass:"right"},[v("el-select",{staticClass:"custom-select-transparent",attrs:{value:h.advancedParams.samplerSettingsDefault.samplingMethod,"popper-append-to-body":!1,"popper-class":"painting-board-select"},on:{change:function(t){return h.changeAdvancedParams(t,"samplerSettingsDefault.samplingMethod")}}},h._l(h.defSamplerMethodArr,(function(t,i){return v("el-option",{key:"method_"+i,attrs:{label:t,value:t}},[v("el-tooltip",{attrs:{content:t,placement:"left"}},[v("span",[h._v(h._s(t))])])],1)})),1)],1)]),h._v(" "),v("div",{staticClass:"sampling-steps item-param t-b"},[v("div",{staticClass:"top"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("SamplingSteps")))]),h._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("SamplingStepsDefaultTip"),placement:"top-start"}},[v("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),v("div",{staticClass:"bottom"},[v("el-slider",{attrs:{value:h.advancedParams.samplerSettingsDefault.samplingSteps,min:10,max:40,step:1,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(t){return h.changeAdvancedParams(t,"samplerSettingsDefault.samplingSteps")}}})],1)]),h._v(" "),v("div",{staticClass:"cfg-scale item-param t-b"},[v("div",{staticClass:"top"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("CFGScale")))]),h._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("CFGScaleDefaultTip"),placement:"top-start"}},[v("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),v("div",{staticClass:"bottom"},[v("el-slider",{attrs:{value:h.advancedParams.samplerSettingsDefault.CFGScale,min:3,max:15,step:1,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(t){return h.changeAdvancedParams(t,"samplerSettingsDefault.CFGScale")}}})],1)])]),h._v(" "),v("div",{staticClass:"live-type"},[v("div",{staticClass:"title"},[h._v(h._s(h.$t("SamplerSettingsLive")))]),h._v(" "),v("div",{staticClass:"sampling-method item-param"},[v("div",{staticClass:"left"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("SamplingMethod")))]),h._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("SamplingMethodLiveTip"),placement:"top-start"}},[v("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),v("div",{staticClass:"right"},[v("el-select",{staticClass:"custom-select-transparent",attrs:{value:h.advancedParams.samplerSettingsLive.samplingMethod,"popper-append-to-body":!1,"popper-class":"painting-board-select"},on:{change:function(t){return h.changeAdvancedParams(t,"samplerSettingsLive.samplingMethod")}}},h._l(h.liveSamplerMethodArr,(function(t,i){return v("el-option",{key:"method_"+i,attrs:{label:t,value:t}},[v("el-tooltip",{attrs:{content:t,placement:"left"}},[v("span",[h._v(h._s(t))])])],1)})),1)],1)]),h._v(" "),v("div",{staticClass:"sampling-steps item-param t-b"},[v("div",{staticClass:"top"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("SamplingSteps")))]),h._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("SamplingStepsLiveTip"),placement:"top-start"}},[v("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),v("div",{staticClass:"bottom"},[v("el-slider",{attrs:{value:h.advancedParams.samplerSettingsLive.samplingSteps,min:1,max:50,step:1,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(t){return h.changeAdvancedParams(t,"samplerSettingsLive.samplingSteps")}}})],1)]),h._v(" "),v("div",{staticClass:"cfg-scale item-param t-b"},[v("div",{staticClass:"top"},[v("div",{staticClass:"label"},[h._v(h._s(h.$t("CFGScale")))]),h._v(" "),v("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:h.$t("CFGScaleLiveTip"),placement:"top-start"}},[v("span",{staticClass:"el-icon-warning custom-tips"})])],1),h._v(" "),v("div",{staticClass:"bottom"},[v("el-slider",{attrs:{value:h.advancedParams.samplerSettingsLive.CFGScale,min:.1,max:14,step:.1,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(t){return h.changeAdvancedParams(t,"samplerSettingsLive.CFGScale")}}})],1)])])])]),h._v(" "),v("div",{directives:[{name:"show",rawName:"v-show",value:!h.showCell,expression:"!showCell"}],staticClass:"bottom-btns"},[v("div",{staticClass:"reset",on:{click:h.handleResetParams}},[h._v("\n\t\t\t\t"+h._s(h.$t("S_ResetPrompt"))+"\n\t\t\t")]),h._v(" "),v("div",{directives:[{name:"show",rawName:"v-show",value:h.isDefParams,expression:"isDefParams"}],staticClass:"save",on:{click:function(t){return h.handleModifyParams("saveAs")}}},[h._v("\n\t\t\t\t"+h._s(h.$t("SaveAs"))+"\n\t\t\t")]),h._v(" "),v("div",{directives:[{name:"show",rawName:"v-show",value:!h.isDefParams,expression:"!isDefParams"}],staticClass:"save",on:{click:function(t){return h.handleModifyParams("save")}}},[h._v("\n\t\t\t\t"+h._s(h.$t("Save"))+"\n\t\t\t")])]),h._v(" "),v("StyleModal",{ref:"styleModal",attrs:{inTask:!0,modelType:h.styleModalType,selectList:h.styleModalSelectIds,isPaintingBoard:!0,isSDXL:h.isSdModel&&h.isLoRA},on:{selectModel:h.handleSelectModel}}),h._v(" "),v("addOrEditParamsDialog",{ref:"addOrEditParam",on:{updateList:h.getCusDefParams}})],1)])}),[],!1,null,"6fe8cb7e",null).exports);function ue(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function de(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ue(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ue(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var he={model:{prop:"modelvalue",event:"change"},props:{modelvalue:{type:Number,default:0},width:{type:Number,default:120},max:{type:Number,default:180},type:{type:String,default:"hue"},name:{type:String,default:"name"}},watch:{modelvalue:function(t){this.inputVal=t,this.getProgress()}},data:function(){return{isDragging:!1,progress:50,inputVal:this.modelvalue}},mounted:function(){this.inputVal=this.modelvalue,this.getProgress()},methods:{handleChange:function(t){this.inputVal=t||0,this.getProgress(),this.$emit("change",this.inputVal),this.$emit("changeItem",{value:this.inputVal,type:this.type})},startDrag:function(t){this.isDragging=!0,document.addEventListener("mousemove",this.onDrag),document.addEventListener("mouseup",this.endDrag)},onDrag:function(t){if(this.isDragging){var e=this.$refs.adjustRef.getBoundingClientRect().left,n=t.clientX-e,o=parseInt(n/this.width*100);this.progress=o,o<0?this.progress=0:o>100&&(this.progress=100),this.getInputVal()}},endDrag:function(){this.isDragging=!1,this.$emit("change",this.inputVal),this.$emit("changeItem",{value:this.inputVal,type:this.type}),document.removeEventListener("mousemove",this.onDrag),document.removeEventListener("mouseup",this.endDrag)},clickDrag:function(t){this.isDragging=!0,document.addEventListener("mousemove",this.onDrag),document.addEventListener("mouseup",this.endDrag),this.onDrag(t)},getInputVal:function(){var progress=this.progress,t=0,e=this.max/50;progress>50&&(t=parseInt((progress-50)*e)),progress<50&&(t=-parseInt((50-progress)*e)),50===progress&&(t=0),this.inputVal=t},getProgress:function(){var t=this.inputVal,e=0,n=this.max/50;if(t>0&&(e=parseInt(50+t/n)),t<0){var o=Math.abs(t);e=parseInt(50-o/n)}0===t&&(e=50),this.progress=e}}},pe=(n(2818),Object(_.a)(he,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"adjust-box flex_m"},[e("div",{staticClass:"left"},[e("span",[t._v(t._s(t.name))])]),t._v(" "),e("div",{staticClass:"center"},[e("div",{ref:"adjustRef",staticClass:"adjust-item",class:[t.type],style:{width:t.width+"px"},on:{mousedown:function(e){return e.preventDefault(),t.clickDrag.apply(null,arguments)}}},[e("div",{staticClass:"target-flag flex",style:{left:t.progress+"%"},on:{selectstart:function(t){t.preventDefault()},mousedown:function(e){return e.preventDefault(),t.startDrag.apply(null,arguments)}}},[e("i",{staticClass:"iconfont icon-a-Vector2900"})])])]),t._v(" "),e("div",{staticClass:"right"},[e("el-input-number",{staticClass:"my-el-input-number",attrs:{value:t.inputVal,min:-t.max,max:t.max,size:"mini"},on:{change:t.handleChange}})],1)])])}),[],!1,null,"f2efff4c",null));function ve(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function me(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ve(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var fe={components:{MyAdjust:pe.exports},data:function(){return{formData:{opacity:0,prompt:"",negative_prompt:"",hue:0,saturation:0,brightness:0},list:[{key:"cfg_scale",label:"CFGScale",value:""},{key:"sampler_name",label:"SamplingMethod",value:""},{key:"steps",label:"Steps",value:""},{key:"RandomSeed",label:"RandomSeed",value:""},{key:"widHeiRatio",label:"imageDimensions",value:""},{key:"denoising_strength",label:"DenoisingStrength",value:""},{key:"art_model_no",label:"Checkpoint",value:"",path:"https://aiart-openresty.dev.seaart.ai/models/detail/",flag:!0},{key:"lora_models",label:"OPS_style",value:"",path:"https://aiart-openresty.dev.seaart.ai/models/detail/",flag:!0}],isShow:!0}},props:{id:{type:[Number,String],default:""},paramsData:{type:Object,default:function(){return{}}},currentIndex:{type:Number,default:0},selectNum:{type:Number,default:0},showCell:{type:Boolean,default:!1}},inject:["top"],watch:{"paramsData.params":function(t){var e=this;if(this.list.forEach((function(t){t.value=""})),this.formData={opacity:0,prompt:"",negative_prompt:"",hue:0,saturation:0,brightness:0},this.selectNum>1){this.list.find((function(t){return"widHeiRatio"===t.key})).value=this.top.selectSize}else{var data={};data=null!=t&&t.meta?me(me({},t.meta),{},{art_model_no:t.art_model_no,art_model_ver_no:t.art_model_ver_no,taskId:t.taskId||"",widHeiRatio:this.paramsData.widHeiRatio}):{widHeiRatio:this.paramsData.widHeiRatio},this.isShow=data.taskId,this.formData.opacity=this.paramsData.opacity,this.formData.hue=this.paramsData.hue,this.formData.saturation=this.paramsData.saturation,this.formData.brightness=this.paramsData.brightness,this.formData.prompt=data.prompt,this.formData.negative_prompt=data.negative_prompt;var n=function(t){e.list.forEach((function(e){e.key===t&&(e.value="widHeiRatio"===e.key?data.widHeiRatio:data[t])}))};for(var o in me(me({},data),data.meta))n(o)}}},computed:{handleSelect:function(){return 1===this.selectNum},handleSize:function(){return this.selectSize},liveInfo:function(){return this.top.paintingBoardData.liveModel}},methods:{submit:function(){if(!this.top.token)return this.$EventBus.$emit("openLoginDialog",{callBack:function(){window.location.reload()}});if(this.selectNum>1||!this.paramsData.params.taskId){var t=this.selectNum>1?"canvas_publish_multiple_toast":"canvas_publish_toast";return this.$message.warning(this.$t(t))}this.top.publishPop({width:this.paramsData.realWidth,height:this.paramsData.realHeight,url:this.paramsData.imgSrc,task_id:this.paramsData.params.taskId})},handleOpacity:function(t){var e=this;if(this.top.paintingBoardData.liveModel.show){var n=this.top.paintingBoardData.liveLayerList.find((function(t){return t.active}));this.top.setEleItem({id:n.layerId,type:"liveLayerList",item:{opacity:t}},(function(){L.a.emit("filterColor",me(me({},n),{},{opacity:t})),Y.a.add(e.top.paintingBoardData)}))}else this.top.changeData("elementList[".concat(this.currentIndex,"].opacity"),t)},changeFilter:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.top.paintingBoardData.liveModel.show){var n=this.top.paintingBoardData.liveLayerList.find((function(t){return t.active}));this.top.setEleItem({id:n.layerId,type:"liveLayerList",item:Object(c.a)({},e.type,e.value)},(function(){L.a.emit("filterColor",me(me({},n),{},Object(c.a)({},e.type,e.value))),Y.a.add(t.top.paintingBoardData)}))}else this.top.changeData("elementList[".concat(this.currentIndex,"].").concat(e.type),e.value)},copyMsg:function(t){Object(bt.d)(this.formData[t]),this.$message.success(this.$t("CopySuccess"))},copyImg:function(){this.top.handleRightMenuClick("copy")},download:function(){this.top.handleRightMenuClick("download")},goPage:function(t){var path="";path="art_model_no"===t.key?t.path+t.value:t.path+(t.model_id||t.id),window.open(path,"_blank")},handleDownload:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.handleDownloadUrl(t);case 2:(o=n.sent).includes("http")?(r=document.getElementById("img-".concat(e.paramsData.layerId)),Object(bt.z)(o,e.paramsData.layerId,null,{target:r})):Object(bt.f)(o,e.paramsData.layerId);case 4:case"end":return n.stop()}}),n)})))()},handleDownloadUrl:function(t){return 100==this.paramsData.opacity?t:new Promise((function(e){var img=new Image;img.crossOrigin="Anonymous",img.src=t,img.onload=function(){var canvas=document.createElement("canvas"),n=canvas.getContext("2d");canvas.width=img.width,canvas.height=img.height,n.drawImage(img,0,0),t=canvas.toDataURL(),e(t)}}))}}},ge=fe,be=(n(2819),Object(_.a)(ge,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"selectParams no-snapshot"},[t.formData.prompt?e("div",{staticClass:"prompt common-bg"},[e("p",{staticClass:"line flex"},[e("span",{staticClass:"label"},[t._v(t._s(t.$t("Prompt")))]),t._v(" "),e("i",{staticClass:"iconfont icon-copy-template",on:{click:function(e){return t.copyMsg("prompt")}}})]),t._v(" "),e("el-input",{staticClass:"my-input",attrs:{type:"textarea",rows:2,disabled:!0},model:{value:t.formData.prompt,callback:function(e){t.$set(t.formData,"prompt",e)},expression:"formData.prompt"}})],1):t._e(),t._v(" "),t.formData.negative_prompt?e("div",{staticClass:"negative-prompt common-bg"},[e("p",{staticClass:"line flex"},[e("span",{staticClass:"label"},[t._v(t._s(t.$t("NegativePrompts")))]),t._v(" "),e("i",{staticClass:"iconfont icon-copy-template",on:{click:function(e){return t.copyMsg("negative_prompt")}}})]),t._v(" "),e("el-input",{staticClass:"my-input",attrs:{type:"textarea",rows:2,disabled:!0},model:{value:t.formData.negative_prompt,callback:function(e){t.$set(t.formData,"negative_prompt",e)},expression:"formData.negative_prompt"}})],1):t._e(),t._v(" "),e("div",{staticClass:"params common-bg"},[e("p",{staticClass:"params-title"},[t._v(t._s(t.$t("Params")))]),t._v(" "),t._l(t.list,(function(n,o){return e("div",{key:o},[n.value&&"lora_models"!==n.key?e("p",{staticClass:"params-line"},[e("span",{staticClass:"label"},[t._v(" "+t._s(t.$t(n.label))+" ")]),t._v(" "),n.flag?e("span",{staticClass:"line_txt",on:{click:function(e){return t.goPage(n)}}},[t._v(t._s(n.value))]):e("span",{staticClass:"value"},[t._v("\n          "+t._s("widHeiRatio"===n.key&&t.selectNum>1?t.top.selectSize:n.value)+"\n        ")])]):t._e(),t._v(" "),"lora_models"===n.key&&n.value?t._l(n.value,(function(o,r){return e("p",{key:r,staticClass:"params-line"},[e("span",{staticClass:"label"},[t._v(" "+t._s(t.$t(n.label))+" ")]),t._v(" "),e("span",{staticClass:"line_txt",on:{click:function(e){return t.goPage(de(de({},o),{},{path:n.path}),r)}}},[t._v("\n            "+t._s(o.model_id||o.id)+"\n          ")])])})):t._e()],2)}))],2),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.handleSelect,expression:"handleSelect"}],staticClass:"hsv-bord"},[e("div",{staticClass:"title-name"},[t._v(t._s(t.$t("filterHsv")))]),t._v(" "),e("my-adjust",{attrs:{type:"hue",name:t.$t("hue"),max:180},on:{changeItem:t.changeFilter},model:{value:t.formData.hue,callback:function(e){t.$set(t.formData,"hue",e)},expression:"formData.hue"}}),t._v(" "),e("my-adjust",{attrs:{type:"saturation",name:t.$t("saturation"),max:100},on:{changeItem:t.changeFilter},model:{value:t.formData.saturation,callback:function(e){t.$set(t.formData,"saturation",e)},expression:"formData.saturation"}}),t._v(" "),e("my-adjust",{attrs:{type:"brightness",name:t.$t("brightness"),max:100},on:{changeItem:t.changeFilter},model:{value:t.formData.brightness,callback:function(e){t.$set(t.formData,"brightness",e)},expression:"formData.brightness"}}),t._v(" "),e("div",{staticClass:"sampling-steps common-bg"},[e("div",{staticClass:"top"},[e("div",{staticClass:"label"},[t._v(t._s(t.$t("canvas_opacity")))])]),t._v(" "),e("div",{staticClass:"bottom"},[e("el-slider",{attrs:{min:0,max:100,step:1,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{change:t.handleOpacity},model:{value:t.formData.opacity,callback:function(e){t.$set(t.formData,"opacity",e)},expression:"formData.opacity"}})],1)])],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.liveInfo.show&&!t.showCell,expression:"!liveInfo.show && !showCell"}],staticClass:"footer"},[e("i",{staticClass:"iconfont icon-copy-template copy pointer",on:{click:t.copyImg}}),t._v(" "),e("i",{staticClass:"iconfont icon-icon_xiazai download pointer",on:{click:t.download}}),t._v(" "),e("div",{staticClass:"confirm pointer",on:{click:t.submit}},[e("i",{staticClass:"iconfont icon-share-icon"}),t._v(" "),e("span",[t._v(t._s(t.$t("releaseName")))])])])])}),[],!1,null,"2a82fe4f",null).exports),_e={inject:["top"],data:function(){return{min:20,max:200,step:10}},computed:{zoom:function(){var t=this.top.paintingBoardData.boardInfo.zoom;return parseInt(100*t)}},mounted:function(){var t=this;this.$nextTick((function(){t.initBordPoin()})),this.top.eventFn.initBordPoin=this.initBordPoin},methods:{initBordPoin:function(){var t=this.top.viewerClass,e=this.top.paintingBoardData.boardInfo,n=e.scrollLeft,o=e.scrollTop,r=e.zoom;t.setZoom(r),t.scrollTo(n,o)},handleBackCenter:function(){var t=this.top.viewerClass;if(0===(this.top.paintingBoardData.elementList.filter((function(t){return"imgLayer"===t.type}))||[]).length)return this.changeZoom(100),void t.scrollTo(0,0);var e=this.getViewAxis(),n=e.x,o=e.y,r=e.width,l=e.height,c=e.x2,d=e.y2;console.log("获取视图大容器信息:","x: "+n,"y: "+o,"width: "+r,"height: "+l,"x2: "+c,"y2: "+d),this.setBoardZoom(e),t.scrollTo(n,o)},setBoardZoom:function(t){var e=document.querySelector("#canvas-container").getBoundingClientRect(),n=e.width,o=e.height,r=t.width,l=t.height,c=1;c=(c=1/(c=r/l>1?r/(n-290):l/o))<.2?.2:c,c=10*parseInt(Math.ceil(10*c)),this.changeZoom(c)},getViewAxis:function(){var t=this.top.paintingBoardData.elementList,e=Number.MAX_VALUE,n=Number.MAX_VALUE,o=Number.MIN_VALUE,r=Number.MIN_VALUE;return t.forEach((function(element){var t=element.x,l=element.y,c=element.width,d=element.height;e=Math.min(e,t),n=Math.min(n,l),o=Math.max(o,t+c),r=Math.max(r,l+d)})),{x:e,y:n,width:o-e,height:r-n,x2:o,y2:r}},changeZoom:function(t){var e=this.top.viewerClass;t>this.max||t<this.min||(e.setZoom(t/100),this.top.changeData("boardInfo.zoom",e.getZoom()),this.$emit("onZoom",{val:t,zoom:e.getZoom()}))}}},ye=(n(2820),Object(_.a)(_e,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"action-btn-box flex"},[e("div",{staticClass:"fitin-box flex_c_m",on:{click:function(e){return e.stopPropagation(),t.handleBackCenter.apply(null,arguments)}}},[e("el-tooltip",{attrs:{effect:"dark",content:t.$t("canvas_self_hover")}},[e("i",{staticClass:"iconfont icon-Union2"})])],1),t._v(" "),e("div",{staticClass:"input-nuber"},[e("el-input-number",{staticClass:"my-input-number",attrs:{value:t.zoom,size:"mini",min:t.min,max:t.max,step:t.step,precision:0},on:{change:t.changeZoom}})],1)])}),[],!1,null,"7751e5d0",null)),we=ye.exports,Ce={inject:["top"],data:function(){return{min:20,max:200,step:10,zoomVal:50}},computed:{liveInfo:function(){return this.top.paintingBoardData.liveModel}},watch:{"liveInfo.zoom":{handler:function(t){t&&this.initBordPoin()}}},mounted:function(){var t=this;this.$nextTick((function(){t.initBordPoin()}))},methods:{initBordPoin:function(){var t=this.liveInfo,e=t.zoom,n=t.scrollLeft,o=t.scrollTop;L.a.emit("getViewerRef",(function(t){t&&(L.a.emit("setHasActiveHistory",!0),t.setZoom(e/100),t.scrollTo(n,o))}))},handleBackCenter:function(){L.a.emit("getViewerRef",(function(t){t.scrollTo(0,0)}))},changeZoom:function(t){t>this.max||t<this.min||(this.top.initLiveLayerActive(),Y.a.add(this.top.paintingBoardData),L.a.emit("liveCreateAiImg"))}}},ke=(n(2821),Object(_.a)(Ce,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"action-btn-box flex"},[e("div",{staticClass:"input-nuber"},[e("el-input-number",{staticClass:"my-input-number",attrs:{size:"mini",min:t.min,max:t.max,step:t.step,precision:0},on:{change:t.changeZoom},model:{value:t.top.paintingBoardData.liveModel.zoom,callback:function(e){t.$set(t.top.paintingBoardData.liveModel,"zoom",e)},expression:"top.paintingBoardData.liveModel.zoom"}})],1)])}),[],!1,null,"4b25c4bd",null).exports),Oe={name:"right-params",inject:["top"],data:function(){return{paramsData:{},currentIndex:0,selectNum:0,showCell:!1}},props:{elementList:{type:Array,default:function(){return[]}}},components:{DefParams:ce,SelectParams:be,ZoomPoin:we,ZoomPoinLive:ke},computed:{handleRight:function(){var t=this,e=0,i=0;return this.elementList.forEach((function(n,o){n.active&&(t.paramsData=n,i=o,e++)})),this.currentIndex=i,this.selectNum=e,!(this.elementList.length<=0)&&this.elementList.some((function(t){return!0===t.active}))}},methods:{onZoom:function(t){this.$emit("onZoom",t)},toggleMenuBard:function(t){this.showCell=!t}}},xe=(n(2822),Object(_.a)(Oe,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"right-bard-box",class:t.showCell&&"hide-bard"},[e("DefParams",{directives:[{name:"show",rawName:"v-show",value:!t.handleRight,expression:"!handleRight"}],attrs:{showCell:t.showCell}}),t._v(" "),e("SelectParams",{directives:[{name:"show",rawName:"v-show",value:t.handleRight,expression:"handleRight"}],attrs:{paramsData:t.paramsData,currentIndex:t.currentIndex,selectNum:t.selectNum,showCell:t.showCell}}),t._v(" "),e("zoom-poin",{directives:[{name:"show",rawName:"v-show",value:!t.top.paintingBoardData.liveModel.show,expression:"!top.paintingBoardData.liveModel.show"}],on:{onZoom:t.onZoom}}),t._v(" "),e("div",{staticClass:"open-btn",on:{click:function(e){return t.toggleMenuBard(t.showCell)}}},[e("i",{class:t.showCell?"el-icon-arrow-left":"el-icon-arrow-right"})])],1)}),[],!1,null,"1c11e38d",null).exports),Ie=(n(75),n(2009)),De=n(177),Se=n(107),Pe=(n(85),n(101),n(3227),n(70),n(3228),n(142),n(143),n(112),n(437)),Le=n(155);function je(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,a){if(t){if("string"==typeof t)return $e(t,a);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?$e(t,a):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw l}}}}function $e(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,n=Array(a);e<a;e++)n[e]=t[e];return n}var Te={name:"openPoseEditor",inject:["top"],props:{fromPage:{type:String,default:function(){return""}},uniqueId:{type:[Number,String],default:function(){return Object(ut.uniqueId)("openPoseEditor_")}},imgInfo:{type:Object,default:function(){return{}}},sourceInfo:{type:Object,default:function(){return{}}},openPoseData:{type:Object,default:function(){return{people:[]}}}},data:function(){return{svgId:"vis_".concat(this.uniqueId),PERSON_CONFIG:Pe.b,pointIDPairs:Pe.e,COLORS:Pe.c,DOT_SIZE:6,LOCK_COLOR:"blue",lockPairs:Pe.d,DEFAULTGROUPS:{},DEFAULTGROUPTOID:{head:[0,15,16,17,18],rfoot:[11],lfoot:[14],hips:[8,9,12]},lockEngaged:!1,lockId:-1,lockPairId:-1,lockLength:-1,pointData:[],svgRef:null,isDefaultGroup:!1,imgUrl:"",pointColor:"#409EFF",observer:null,debounceUpdate:null}},watch:{"sourceInfo.openPoseData":{handler:function(t){var e;t&&null!=t&&null!==(e=t.people)&&void 0!==e&&e.length},deep:!0}},mounted:function(){this.debounceUpdate=Object(ut.debounce)(this.saveImageUrl,400),"openPoseModal"===this.fromPage&&this.initObserver();var t=this.sourceInfo,e=t.rawWidth,n=t.rawHeight,o=t.width,r=t.height;if(!o&&"openPoseModal"===this.fromPage){var l=this.getImageInfo({rawWidth:e,rawHeight:n});if(o=null==l?void 0:l.width,r=null==l?void 0:l.height,!o)return;this.$emit("updateImageInfo",{width:o,height:r,rawWidth:e,rawHeight:n})}this.svgRef=Le.c("#".concat(this.svgId)),this.init()},beforeDestroy:function(){this.svgRef=null,this.canvas2=null,this.bgCtx=null,this.observer=null,this.debounceUpdate=null},methods:{initObserver:function(){var t=this,e=this.sourceInfo,n=e.rawWidth,o=e.rawHeight;this.observer=new ResizeObserver((function(e){var r,l=je(e);try{for(l.s();!(r=l.n()).done;){var c=r.value.contentRect,d=c.width,h=c.height;if(0===d||0===h)return;if(!d)return;var v=t.getImageInfo({rawWidth:n,rawHeight:o}),m=null==v?void 0:v.width,f=null==v?void 0:v.height;t.$emit("updateImageInfo",{currentWidth:m,currentHeight:f,rawWidth:n,rawHeight:o}),t.init()}}catch(t){l.e(t)}finally{l.f()}})),this.observer.observe(this.$refs.viewBox)},init:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.pointData=t.loadPointData(),t.setBackground(),t.drawLines(),t.drawPoints(),t.initBgCanvas();case 5:case"end":return e.stop()}}),e)})))()},updatePointDataConfig:function(){var t=this,e=this.top.paintingBoardData.controlNet.controlnet_units.findIndex((function(e){var n;return(null===(n=t.sourceInfo)||void 0===n?void 0:n.id)&&e.id===t.sourceInfo.id})),n=this.sourceInfo,o=n.rawWidth,r=n.rawHeight,l=n.width;n.height;if(!l&&"openPoseModal"===this.fromPage){var c=this.getImageInfo({rawWidth:o,rawHeight:r});l=null==c?void 0:c.width,null==c?void 0:c.height}var d=this.imgInfo.width/this.imgInfo.rawWidth;if(isNaN(d)&&(d=l/o),-1!==e){var data=(this.pointData||[]).map((function(t){return[t.x/d,t.y/d,1]}));data=data.flat()}},getImageInfo:function(t){var e,n,o,r,l=t.rawWidth,c=t.rawHeight,d=document.querySelectorAll(".generation-frame-area-content")[0],h=null===(e=d)||void 0===e?void 0:e.offsetWidth,v=null===(n=d)||void 0===n?void 0:n.offsetHeight;h||(h=(null===(o=window)||void 0===o||null===(o=o.screen)||void 0===o?void 0:o.width)<=1440?470:570,v=(null===(r=window)||void 0===r||null===(r=r.screen)||void 0===r?void 0:r.width)<=1440?400:570);return d=null,this.getContainedSize({width:h,height:v,naturalWidth:l,naturalHeight:c})},getContainedSize:function(img){try{var t=img.naturalWidth/img.naturalHeight,e=img.height*t,n=img.height;return e>img.width&&(e=img.width,n=img.width/t),{width:e,height:n}}catch(t){}},handleGroup:function(){this.isDefaultGroup=!this.isDefaultGroup,this.DEFAULTGROUPS=this.isDefaultGroup?JSON.parse(JSON.stringify(Pe.a)):{}},resetOpenPose:function(){this.saveImageUrl()},loadPointData:function(){var t=this.sourceInfo,e=t.rawWidth,n=t.rawHeight,o=t.width,r=t.height,l=this.imgInfo.width/this.imgInfo.rawWidth;if(!o&&"openPoseModal"===this.fromPage){var c=this.getImageInfo({rawWidth:e,rawHeight:n});o=null==c?void 0:c.width,r=null==c?void 0:c.height,this.$emit("updateImageInfo",{width:o,height:r,rawWidth:e,rawHeight:n})}isNaN(l)&&(l=o/e);for(var d=[],h=0,v=0,m=this.sourceInfo.openPoseData,f=(m=JSON.parse(JSON.stringify(m))).people[0].pose_keypoints_2d,i=0;i<f.length/3;i+=1){var _=3*i,y={x:f[_]*l+h,y:f[_+1]*l+v,id:i};d.push(y)}return d},setBackground:function(){var t="openPoseModal"===this.fromPage?"black":"transparent";this.svgRef.append("rect").attr("width","100%").attr("height","100%").attr("fill",t)},drawLines:function(){for(var t=this,e=[],i=0;i<this.pointIDPairs.length;i++){var n,o,r=this.pointIDPairs[i],l=[this.pointData[r[0]],this.pointData[r[1]]],c=0===(null===(n=l[0])||void 0===n?void 0:n.x)&&0===l[0].y,d=0===(null===(o=l[1])||void 0===o?void 0:o.x)&&0===l[1].y||!l[1];c||d||e.push(l)}this.svgRef.selectAll(".lines").data(e,(function(t){return t.id})).join((function(e){return e.append("line").attr("class","lines").attr("stroke",(function(e,i){return t.COLORS[i]})).attr("stroke-width",5).attr("x1",(function(t){return t[0].x})).attr("y1",(function(t){return t[0].y})).attr("x2",(function(t){return t[1].x})).attr("y2",(function(t){return t[1].y}))}))},drawPoints:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this;this.svgRef.selectAll(".points").data(this.pointData,(function(t){return t.id})).join((function(e){e.append("circle").attr("id",(function(t){return"circle_".concat(n.uniqueId)+t.id})).attr("class","points").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",t.DOT_SIZE).style("cursor","pointer").style("fill",n.pointColor).style("display",(function(t){var e="";return null!=t&&t.x||null!=t&&t.y||(e="none"),e})).on("click",(function(t){n.lockEngaged&&(n.lockId!=t.id?(n.lockId=t.id,n.lockLength=n.getLockLength(t.id),Le.c(this).style("fill",n.LOCK_COLOR)):(Le.c(this).style("fill",n.pointColor),n.lockId=-1,n.lockLength=-1))})).on("mouseover",(function(t){n.lockEngaged?Le.c(this).style("fill",n.LOCK_COLOR):Le.c(this).style("fill",n.COLORS[1])})).on("mouseout",(function(t){Le.c(this).style("fill",n.pointColor)})).call(Le.a().on("drag",n.dragCallback)),e.append("text").attr("class",(function(t){return"label"+t.id})).style("text-anchor","middle").style("user-select","none").attr("x",(function(t){return t.x-2*n.DOT_SIZE})).attr("y",(function(t){return t.y-n.DOT_SIZE})).style("stroke","white").style("opacity",0).text((function(t,i){return i}))}),(function(t){n.svgRef.selectAll(".points").attr("cx",(function(t){return!e&&n.updatePointInfo(t),t.x})).attr("cy",(function(t){return!e&&n.updatePointInfo(t),t.y})),n.svgRef.selectAll("text").attr("x",(function(t){return t.x-2*n.DOT_SIZE})).attr("y",(function(t){return t.y-n.DOT_SIZE})),t.raise()})),"function"==typeof this.debounceUpdate&&this.debounceUpdate()},initBgCanvas:function(){var t=this;this.canvas2=this.$refs["canvas_".concat(this.svgId)],this.bgCtx=this.canvas2.getContext("2d"),this.bgCtx.fillStyle="black",this.bgCtx.fillRect(0,0,this.canvas2.width,this.canvas2.height);var element=document.getElementById("".concat(this.svgId)),e=(new XMLSerializer).serializeToString(element),n=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),o=window.URL||window.webkitURL||window,r=o.createObjectURL(n),img=new Image;img.onload=function(){t.bgCtx.drawImage(img,0,0,t.canvas2.width,t.canvas2.height),t.imgUrl=t.canvas2.toDataURL("image/png",.05),t.updatePoseImage(t.imgUrl||""),o.revokeObjectURL(r),img=null},img.src=r},saveImageUrl:function(){this.initBgCanvas()},updatePoseImage:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.top.paintingBoardData.controlNet.controlnet_units.findIndex((function(e){var n;return(null===(n=t.sourceInfo)||void 0===n?void 0:n.id)&&e.id===t.sourceInfo.id}));-1!==n&&this.top.changeData("controlNet.controlnet_units[".concat(n,"].input_image"),e)},updatePointInfo:function(){var t=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pointData.forEach((function(e){e.id===source.id&&(t.$set(e,"x",source.x),t.$set(e,"y",source.y))})),this.updatePointDataConfig()},getLockLength:function(t){return this.lockPairId=this.lockPairs[t],this.euclideanDist(this.pointData[this.lockPairId],this.pointData[t])},euclideanDist:function(a,b){return Math.pow(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2),.5)},dragCallback:function(t){var e=this;Le.c("#circle_".concat(this.uniqueId)+t.id).attr("cx",(function(t){return e.dragGroupX(t)})).attr("cy",(function(t){return e.dragGroupY(t)})),Le.c(".label"+t.id).attr("x",(function(t){return t.x-2*e.DOT_SIZE})).attr("y",(function(t){return t.y-e.DOT_SIZE})),e.drawLines(),e.drawPoints()},dragGroupX:function(t){var e=this.getTranslation(t).x;if(t.id in this.DEFAULTGROUPS){var n,o=this.DEFAULTGROUPS[t.id],r=je(this.DEFAULTGROUPTOID[o]);try{for(r.s();!(n=r.n()).done;){var l=n.value;this.pointData[l].x+=e}}catch(t){r.e(t)}finally{r.f()}return Le.b.x}return t.x+=e,t.x},dragGroupY:function(t){var e=this.getTranslation(t).y;if(t.id in this.DEFAULTGROUPS){var n,o=this.DEFAULTGROUPS[t.id],r=je(this.DEFAULTGROUPTOID[o]);try{for(r.s();!(n=r.n()).done;){var l=n.value;this.pointData[l].y+=e}}catch(t){r.e(t)}finally{r.f()}return Le.b.y}return t.y+=e,t.y},getTranslation:function(t){if(this.lockEngaged&&this.lockId===t.id){var e=this.pointData[this.lockPairId],n=this.euclideanDist(e,Le.b),o=this.lockLength/n*(Le.b.x-e.x)+e.x,r=this.lockLength/n*(Le.b.y-e.y)+e.y;return{x:o-t.x,y:r-t.y}}return{x:Le.b.x-t.x,y:Le.b.y-t.y}}}},Be=Te,Me=(n(2824),Object(_.a)(Be,(function(){var t=this,e=t._self._c;return e("div",{ref:"viewBox",staticClass:"c-open-pose-editor"},[e("div",{staticClass:"open-pose-editor-wrap",style:{width:"".concat(t.imgInfo.width,"px")}},[e("svg",{staticClass:"open-pose-editor-svg",attrs:{id:t.svgId}})]),t._v(" "),e("canvas",{ref:"canvas_".concat(t.svgId),staticStyle:{display:"none"},attrs:{width:t.imgInfo.width,height:t.imgInfo.height}}),t._v(" "),t.imgUrl?e("img",{staticStyle:{display:"none"},attrs:{src:t.imgUrl,alt:""}}):t._e()])}),[],!1,null,"6f47a3d0",null).exports),Re=n(227),Ae=n(219);function Ee(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Ne(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ee(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Fe={name:"generationFrame",inject:["top"],props:["value"],components:{SliderItem:Se.a,ControlNetPopup:ct,openPoseEditor:Me},watch:{value:{handler:function(t){this.imgUrl=t.input_image||"",this.rawImgUrl=t.rawImgUrl||""},immediate:!0,deep:!0},list:{handler:function(t){var e;null!=this&&null!==(e=this.userInfo)&&void 0!==e&&e.id&&((t||[]).filter((function(t){return[1,2,"1","2"].includes(t.status)})).map((function(t){return t.id})).length&&this.mockProcessTask())},immediate:!0,deep:!0},userInfo:{handler:function(t){var e=(t||{}).id;!(void 0===e?"":e)&&this.endPoll()},immediate:!0,deep:!0},"top.paintingBoardData.liveModel.show":{handler:function(t){var e=t?34:33;this.UPLOAD=new w.a({type:e})},immediate:!0}},data:function(){return{imgUrl:"",rawImgUrl:"",imgInfo:{width:0,height:0,rawWidth:0,rawHeight:0},isUploading:!1,accept:".jpg,.jpeg,.png,.webp",UPLOAD:new w.a({type:2}),list:[]}},computed:Ne(Ne(Ne({},Object(h.e)("user",["userInfo"])),Object(h.c)("creation",["editBoardControlNetConfig"])),{},{getControlNetMap:function(){var map={};return(this.editBoardControlNetConfig||[]).forEach((function(t){map[t.value]=t})),map},getModelDescribe:function(){var t=this;return function(e){var n,o=t.getControlNetMap[e]?null===(n=t.getControlNetMap[e])||void 0===n?void 0:n.name:"";return t.$t(o)}},isLiveMode:function(){return this.top.paintingBoardData.liveModel.show},showOpenPoseEditor:function(){var t=!1;try{var e,n;t=null===(n=(null===(e=this.value)||void 0===e||null===(e=e.openPoseData)||void 0===e?void 0:e.people)[0])||void 0===n?void 0:n.pose_keypoints_2d.length}catch(e){t=!1}return t}}),beforeCreate:function(){var t=this;this.pollingMiddleware=new Ae.a(2e3,(function(){t.fetchTaskData()}))},beforeDestroy:function(){this.pollingMiddleware&&this.pollingMiddleware.stop(),this.pollingMiddleware=null},methods:{handleDeleteImage:function(){var t=this;this.list=[],this.endPoll(),this.imgUrl="",this.rawImgUrl="",this.isUploading=!1;var e=this.top.paintingBoardData.controlNet.controlnet_units.findIndex((function(e){return e.id===t.value.id}));this.top.changeData("controlNet.controlnet_units[".concat(e,"].input_image"),""),this.top.changeData("controlNet.controlnet_units[".concat(e,"].rawImgUrl"),""),this.top.changeData("controlNet.controlnet_units[".concat(e,"].openPoseData"),{people:{pose_keypoints_2d:[]}});var n=this.top.paintingBoardData.elementList.find((function(e){return(null==e?void 0:e.controlNetId)===t.value.id}));(null==n?void 0:n.layerId)&&this.top.deleteImageLayer(n.layerId)},changeConfig:function(t,e){var n,o=JSON.parse(JSON.stringify(this.value));"activeIndex"!==e?o[e]=t:(o.activeIndex=t,null==this||null===(n=this.top)||void 0===n||n.changeActiveControlNet(t));this.$emit("input",o)},handleChangeOptions:function(){var t=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=JSON.parse(JSON.stringify(this.value));if(e){var o;if(n.module!==e.module)n.module=e.module,this.$emit("input",n),n.openPoseData={people:[{pose_keypoints_2d:[]}]},n.input_image="",this.imgUrl="",this.list=[],this.isUploading=!1,this.deleteControlNetLayer(),null!==(o=this.value)&&void 0!==o&&o.rawImgUrl&&(this.isUploading=!0,n.input_image=this.value.rawImgUrl,this.imgUrl=this.value.rawImgUrl,setTimeout((function(){t.handleUploadNext(t.value.rawImgUrl)}),0));n.module=e.module}this.$emit("input",n)},deleteControlNetLayer:function(){var t=this,e=this.top.paintingBoardData.elementList.find((function(e){return(null==e?void 0:e.controlNetId)===t.value.id}));(null==e?void 0:e.layerId)&&this.top.deleteImageLayer(e.layerId)},showControlNetPopup:function(){if(!this.isUploading){var t=JSON.parse(JSON.stringify(this.value));this.$refs.controlNetModal.openModal(t)}},handleBeforeUpload:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=["image/jpeg","image/png","image/jpg","image/webp"],!e.isUploading){n.next=3;break}return n.abrupt("return");case 3:if(o.includes(t.type)){n.next=6;break}return e.$message.error(e.$t("AllowImageFiles")),n.abrupt("return",!1);case 6:if(!(r=t)||r.size){n.next=9;break}return n.abrupt("return",!1);case 9:if(!(r.size/1024/1024>5)){n.next=20;break}return n.prev=10,n.next=13,Object(C.a)(r,5242880);case 13:r=n.sent,n.next=20;break;case 16:return n.prev=16,n.t0=n.catch(10),console.error("Compression failed:",n.t0),n.abrupt("return",!1);case 20:return n.next=22,e.checkImageSize(t);case 22:if(l=n.sent,e.imgUrl=l.url||"",e.imgInfo.rawWidth=l.realWidth||0,e.imgInfo.rawHeight=l.realHeight||0,e.updateImageUrl(e.imgUrl,l.realWidth,l.realHeight),!e.isUploading){n.next=29;break}return n.abrupt("return");case 29:return e.list=[],e.isUploading=!0,c=e.UPLOAD,d=e.top.paintingBoardData.liveModel.show?34:33,c.startUpload(r,{category:d}).then((function(t){return e.handleUploadNext(t)})).catch((function(t){e.isUploading=!1,e.imgUrl="",e.updateImageUrl("")})),n.abrupt("return",!1);case 35:case"end":return n.stop()}}),n,null,[[10,16]])})))()},addControlNetLayer:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.top.paintingBoardData.controlNet.activeIndex;t=this.value.id===n&&this.isLiveMode,this.top.addLayerItem({type:"controlNetLayer",imgSrc:e,customConfig:{controlNetId:this.value.id,show:t,realWidth:this.imgInfo.rawWidth,realHeight:this.imgInfo.rawHeight}})},handleUploadNext:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.rawImgUrl=e;var n=JSON.parse(JSON.stringify(this.value));n.rawImgUrl=e,this.$emit("input",n);var o=this.getProcessInfo(e),r=this.getControlNetMap[this.value.module]||1;if([2,"2"].includes(null==r?void 0:r.category))return Object(Re.a)(o).then((function(e){var n=e.data.id||"";t.list.push({status:1,process:0,id:n})})).catch((function(t){}));this.isUploading=!1},getProcessInfo:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e={};return e.image_url=t,e.preprocess_mode=this.value.module,e.mode=this.isLiveMode?2:1,e},updateImageUrl:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,o=JSON.parse(JSON.stringify(this.value));o.input_image=t||"",o.rawWidth=e||0,o.rawHeight=n||0,t||(o.rawImgUrl="",this.rawImgUrl=""),this.$emit("input",o)},updateControlNetConfig:function(t,e){var n=JSON.parse(JSON.stringify(this.value));n[t]=e,this.$emit("input",n)},checkImageSize:function(t){var e=this;return new Promise((function(n,o){var r=new FileReader;r.onload=function(t){var img=new Image;img.onload=function(){var t={width:img.width,height:img.height,realWidth:img.naturalWidth,realHeight:img.naturalHeight};e.getImageInfo({boxWidth:570,boxHeight:570,rawWidth:img.naturalWidth,rawHeight:img.naturalHeight}),t.url=r.result,n(t)},img.onerror=function(){o(!1)},img.src=t.target.result},r.readAsDataURL(t)}))},getImageInfo:function(t){var e=t.boxWidth,n=t.boxHeight,o=t.rawWidth,r=t.rawHeight,l=this.getContainedSize({width:e,height:n,naturalWidth:o,naturalHeight:r});this.imgInfo.width=l.width,this.imgInfo.height=l.height,this.imgInfo.rawWidth=o,this.imgInfo.rawHeight=r},getContainedSize:function(img){try{var t=img.naturalWidth/img.naturalHeight,e=img.height*t,n=img.height;return e>img.width&&(e=img.width,n=img.width/t),{width:e,height:n}}catch(t){}},mockProcessTask:function(){var t=this.list.filter((function(t){return[1,2,"1","2"].includes(t.status)})).map((function(t){return t.id}));t.length?this.startPoll(t):this.endPoll()},startPoll:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.pollingMiddleware&&this.pollingMiddleware.checkStart(t)},endPoll:function(){this.pollingMiddleware&&this.pollingMiddleware.stop()},fetchTaskData:function(){var t=this.list.filter((function(t){return[1,2,"1","2"].includes(t.status)})).map((function(t){return t.id}));t.length?this.getTaskInfo(t):this.endPoll()},getTaskInfo:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n={};return n.task_ids=e,n.scene=1,Object(v.a)(n).then((function(e){var n=(e&&e.data?e.data:{}).items;((void 0===n?[]:n)||[]).forEach((function(e){if(e&&[3,4].includes(e.status)){var n;if(t.isUploading=!1,[3].includes(e.status))t.imgUrl=(null==e||null===(n=e.img_uris[0])||void 0===n?void 0:n.url)||"",t.updateImageUrl(t.imgUrl,t.imgInfo.rawWidth,t.imgInfo.rawHeight),(null==e?void 0:e.openpose)&&t.handleOpenPoseData((null==e?void 0:e.openpose)||[]);[4].includes(e.status)&&(t.$message.error(t.$t("uploadError")),t.imgUrl="",t.updateImageUrl(""),t.updateControlNetConfig("openPoseData",{people:{pose_keypoints_2d:[]}}))}t.updateData(e,e.task_id)}))}))},handleOpenPoseData:function(source){try{var t,e={people:[{pose_keypoints_2d:(null===(t=JSON.parse(source)[0])||void 0===t?void 0:t.people[0].pose_keypoints_2d)||[]}]};this.updateControlNetConfig("openPoseData",e)}catch(t){console.log(t)}},updateData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.list.forEach((function(o){if(n===o.id){if([4,"4"].includes(e.status)&&0===e.process)return void t.$set(o,"status",e.status);if(![0,100].includes(e.process)&&o.process>=e.process)return void t.$set(o,"status",e.status);t.$set(o,"process",e.process>100?100:e.process),t.$set(o,"status",e.status),t.$set(o,"img_uris",(e.img_uris||[]).filter((function(t){return null==t?void 0:t.url}))),t.$set(o,"openPoseData",(null==e?void 0:e.openpose)||[])}}))},updateImageInfo:function(t){var e=t.width,n=t.height,o=t.rawWidth,r=t.rawHeight;this.imgInfo.width=e,this.imgInfo.height=n,this.imgInfo.rawWidth=o,this.imgInfo.rawHeight=r}}},Ue=Fe,He=(n(2825),Object(_.a)(Ue,(function(){var t,e=this,n=e._self._c;return n("div",{staticClass:"generation-frame no-snapshot",style:{transform:"translateX(".concat(null!==(t=e.top)&&void 0!==t&&t.paintingBoardData.leftMenu.showLeftDrawer?"340px":"40px",")")}},[n("div",{staticClass:"generation-frame-head"},[n("span",{staticClass:"head-title"},[e._v(e._s(e.$t("ControlNet")))]),e._v(" "),n("span",{staticClass:"el-icon-close head-close-btn",on:{click:function(t){return t.stopPropagation(),e.changeConfig("","activeIndex")}}})]),e._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isUploading,expression:"isUploading"}],staticClass:"generation-frame-area"},[n("div",{staticClass:"generation-frame-area-content"},[n("el-upload",{directives:[{name:"show",rawName:"v-show",value:!e.imgUrl,expression:"!imgUrl"},{name:"loading",rawName:"v-loading",value:e.isUploading,expression:"isUploading"}],key:"backgroundUpload",ref:"backgroundUpload",staticClass:"image-upload",attrs:{action:"#","before-upload":e.handleBeforeUpload,disabled:e.isUploading,accept:e.accept,"http-request":function(){},"show-file-list":!1}},[n("div",{staticClass:"image-upload-trigger",attrs:{slot:"trigger"},slot:"trigger"},[n("div",{staticClass:"upload-box-btn"},[e._v(e._s(e.$t("UploadImg")))])])]),e._v(" "),e.imgUrl?n("img",{directives:[{name:"show",rawName:"v-show",value:![8,"8"].includes(e.value.module)||[8,"8"].includes(e.value.module)&&!e.showOpenPoseEditor,expression:"![8,'8'].includes(value.module) || ([8,'8'].includes(value.module) && !showOpenPoseEditor)"}],staticClass:"generation-frame-area-content-image",attrs:{src:e.imgUrl,alt:""}}):e._e(),e._v(" "),n("div",{staticClass:"image-operate-btn-box"},[n("span",{directives:[{name:"show",rawName:"v-show",value:e.imgUrl,expression:"imgUrl"}],staticClass:"image-operate-btn el-icon-delete",on:{click:function(t){return t.stopPropagation(),e.handleDeleteImage()}}})]),e._v(" "),e.imgUrl&&[8,"8"].includes(e.value.module)&&e.showOpenPoseEditor?n("open-pose-editor",{attrs:{uniqueId:e.value.id,"img-info":e.imgInfo,"source-info":e.value,fromPage:"openPoseModal"},on:{updateImageInfo:e.updateImageInfo}}):e._e()],1)]),e._v(" "),n("div",{staticClass:"generation-frame-bottom"},[n("div",{staticClass:"generation-frame-bottom-item"},[n("div",{staticClass:"option-item-label"},[e._v("\n        "+e._s(e.$t("Type"))+"\n      ")]),e._v(" "),n("div",{staticClass:"option-item-content",on:{click:function(t){return t.stopPropagation(),e.showControlNetPopup.apply(null,arguments)}}},[n("div",{staticClass:"el-selects"},[n("span",[e._v(e._s(e.getModelDescribe(e.value.module)))]),e._v(" "),n("i",{staticClass:"el-icon-arrow-down"})])])]),e._v(" "),n("div",{staticClass:"generation-frame-bottom-item"},[n("slider-item",{attrs:{value:e.value.weight,min:0,max:2,step:.1,label:e.$t("ControlWeight"),tips:e.$t("ControlWeightTips")},on:{change:function(t){return e.changeConfig(t,"weight")}}})],1)]),e._v(" "),n("control-net-popup",{ref:"controlNetModal",on:{inputChange:e.handleChangeOptions}})],1)}),[],!1,null,"8ddcdb3a",null)),ze=He.exports,Ve=n(122),We=null,qe={inject:["top"],data:function(){return{}},watch:{"top.paintingBoardData.topNav.tools.brushTool.brushBoard":{handler:function(t){We&&this.setBrushStyle(t)},deep:!0,immediate:!0}},mounted:function(){this.initBoard()},methods:{initBoard:function(){var t=document.querySelector("#boardMaxBox").offsetWidth,e=document.querySelector("#boardMaxBox").offsetHeight;We=new Ve.fabric.Canvas("baseCanvasBox",{width:t,height:e});var n=this.top.paintingBoardData.topNav.tools.brushTool.brushBoard;We.isDrawingMode=!0,We.freeDrawingBrush.color=n.color,We.freeDrawingBrush.width=n.wide/10,this.brushToImg(We)},setBrushStyle:function(t){We.freeDrawingBrush.color=t.color,We.freeDrawingBrush.width=t.wide/10},brushToImg:function(canvas){var t,e=this,n=!1;canvas.on("mouse:down",(function(e){n=!0,t=canvas.getPointer(e.e)})),canvas.on("mouse:up",(function(){n=!1;var t=canvas.getObjects().filter((function(t){return t.isType("path")}));if(t.length>0){var o=new Ve.fabric.Group(t),r=o.getBoundingRect(),l=document.createElement("canvas");e.top.paintingBoardData.boardInfo.zoom;l.width=r.width,l.height=r.height;var c=l.getContext("2d"),d=-r.left,h=-r.top;c.translate(d,h),o.render(c);var param={type:"brushLayer",imgSrc:l.toDataURL("image/png"),cursorX:r.left,cursorY:r.top};e.top.addLayerItem(param)}setTimeout((function(){canvas.clear()}),500)})),canvas.on("mouse:move",(function(e){if(n){var o=canvas.getPointer(e.e),path=new Ve.fabric.Path("M ".concat(t.x," ").concat(t.y," L ").concat(o.x," ").concat(o.y));canvas.add(path),t={x:o.x,y:o.y}}}))}}},Ge=(n(2826),Object(_.a)(qe,(function(){this._self._c;return this._m(0)}),[function(){var t=this._self._c;return t("div",{staticClass:"board-max-box",attrs:{"data-drag":"no",id:"boardMaxBox"}},[t("canvas",{staticClass:"base-canvas-box",attrs:{"data-drag":"no",id:"baseCanvasBox",width:"100%",height:"100%"}})])}],!1,null,"16f4f1a7",null).exports),Ye=n(144);function Je(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Ke(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Je(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Xe={inject:["top"],components:{VueMoveable:Ye.a},data:function(){return{}},computed:{liveItemBoxRef:function(){return this.top.paintingBoardData.liveModel.active?this.$refs.liveItemBoxRef:null},isDraggable:function(){var t=!0;return["daubBoard"].includes(this.top.paintingBoardData.topNav.tools.hasAct)&&(t=!1),t},liveItemInfo:function(){return this.top.paintingBoardData.liveModel},isChangeSize:function(){var t=this.liveItemInfo;return t.width+t.height}},mounted:function(){var t=this;this.$nextTick((function(){t.top.liveBoxRef=t.$refs.liveMoveable}))},methods:{resizeStart:function(t){t.setMin([256,256]),t.setMax([1024,1024])},handleDrag:function(t){var e=this.top.paintingBoardData,n=e.liveModel,o=(e.moveing,this.top.paintingBoardData.topNav.tools.hasAct);if("selectEments"===o||"updateArimg"===o){if(this.isDraggable){t.target.style.transform=t.transform;var l=t.translate||[],c=Object(r.a)(l,2),d=c[0],h=c[1];n.x=d,n.y=h,n.moveing=!0}}else t.stop()},dragEnd:function(t){if(this.isDraggable){var e=t.target.getBoundingClientRect();this.changeData(Ke(Ke({},this.transformInfo),{},{moveing:!1})),this.$emit("onDragEnd",{event:t,boxPoin:e})}},onResize:function(t){var e=t.width,n=t.height;t.target.style.width="".concat(e,"px"),t.target.style.height="".concat(n,"px"),t.target.style.transform=t.drag.transform;var o=Object(r.a)(t.drag.translate,2),l=o[0],c=o[1];this.changeData({width:e,height:n,x:l,y:c})},validZoom:function(t){var e=this.top.paintingBoardData.liveModel,n=e.width,o=e.min,r=e.max,l=o/n,c=r/n;return console.log(t,c,r,n),t<l?l:t>c?c:t},changeData:function(t){var e=this.top.paintingBoardData.liveModel;Object.keys(t).forEach((function(n){e[n]=t[n]}))}}};n(2827);function Qe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var Ze={components:{LiveMove:Object(_.a)(Xe,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"live-max bel-item"},[e("div",{ref:"liveItemBoxRef",staticClass:"live-item-box bel-item",style:{zIndex:-999999},attrs:{id:"liveItemBox"}},[t._t("default")],2),t._v(" "),e("vue-moveable",{ref:"liveMoveable",attrs:{target:t.liveItemBoxRef,resizable:!0,draggable:t.isDraggable,origin:!1,keepRatio:!1,snappable:!0},on:{dragEnd:t.dragEnd,drag:t.handleDrag,resize:t.onResize,resizeStart:t.resizeStart}})],1)}),[],!1,null,null,null).exports},inject:["top"],props:{isPauseLiveGenerate:{type:Boolean,default:!1}},data:function(){return{oldVal:{elementList:[],liveModel:{}},oldParams:{}}},computed:{liveInfo:function(){return this.top.paintingBoardData.liveModel},watchInfo:function(){var t=this.top.paintingBoardData,e=t.liveModel,n=t.elementList;return{liveModel:{x:e.x,y:e.y,width:e.width,height:e.height,show:e.show,moveing:e.moveing},elementList:n.map((function(t){return{x:t.x,y:t.y,z:t.z,width:t.width,height:t.height,layerId:t.layerId,moveing:t.moveing}}))}},inverseStyle:function(){var t=this.liveInfo,e=t.zoom,n=t.width,o=t.height,l=e.split(","),c=Object(r.a)(l,2),d=c[0],h=c[1];return{right:(1-(d=Number(d)))*n+"px",top:-((1-(h=Number(h)))*o/2)+"px",width:(d>1?n*d:n)+"px"}},watchParams:function(){var t=this.top.paintingBoardData;return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Qe(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({basicParams:t.basicParams},t.currentParams)}},watch:{watchInfo:{handler:function(t){this.watchLive(t)},deep:!0},watchParams:{handler:function(t){this.paramsChange(t)},deep:!0}},methods:{paramsChange:function(t){var e,n=this.isWhite(),o=this.getChangeType(t),r=this.top.paramsLoading,l=n&&"default"===o||!n&&"live"===o;this.oldParams=JSON.parse(JSON.stringify(t)),null!==(e=this.liveInfo)&&void 0!==e&&e.show&&(!l&&""!==o||r||this.cutImg())},getChangeType:function(t){var e=t.samplerSettingsDefault,n=t.samplerSettingsLive,o=this.oldParams||{},r=o.samplerSettingsDefault,l=o.samplerSettingsLive;return l?JSON.stringify(e)!==JSON.stringify(r)?"default":JSON.stringify(n)!==JSON.stringify(l)?"live":"":"first"},watchLive:function(t,e){if(!this.isPauseLiveGenerate){var n=this.getIsDetecte(t),o=this.isMoveing(),r=this.isWhite(),l=this.top.paintingBoardData,c=l.liveModel,d=l.elementList;if(e&&d.length)return this.cutImg();n&&!o&&d.length?this.cutImg():r&&!c.loading&&(c.result="",c.prompt=""),this.oldVal=JSON.parse(JSON.stringify(t))}},isWhite:function(){var t=this,e=this.top.paintingBoardData,n=e.liveModel;return e.elementList.every((function(e){return!t.isColliding(n,e)}))},isMoveing:function(){var t=this.top.paintingBoardData,e=t.liveModel;return t.elementList.some((function(t){return t.moveing}))||e.moveing},getActive:function(){var t=this.top.paintingBoardData,e=t.liveModel,n=t.elementList;e.active||(e.active=!0,n.forEach((function(t){t.active=!1})))},getIsDetecte:function(t){var e=this,n=t.elementList,o=t.liveModel,r=this.oldVal,l=r.elementList,c=r.liveModel;if(null==l||!l.length||null==o||!o.show||(null==l?void 0:l.length)>(null==n?void 0:n.length))return!1;var d=this.compareInfo(o,c),h=n.find((function(t,i){return e.compareInfo(t,l[i])})),v=d?o:h;return this.detecteChange(v)},compareInfo:function(t,e){return!(!t||!e)&&Object.keys(t).some((function(n){return t[n]!==e[n]}))},cutImg:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,d,h,v,m,f,_,y,canvas,w,C,k,O,x,I,D,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isPauseLiveGenerate){e.next=2;break}return e.abrupt("return");case 2:if(o=t.top.paintingBoardData,r=o.liveModel,l=o.elementList,c=document.querySelector("#liveItemBox").getBoundingClientRect(),d=c.x,h=c.y,v=c.width,m=c.height,!r.loading){e.next=7;break}return e.abrupt("return");case 7:return r.loading=!0,e.prev=8,e.next=11,Object(ht.a)({tagArea:{x:d,y:h,width:v,height:m},upload:!1});case 11:if(!(f=e.sent)){e.next=16;break}return e.next=15,Object(ht.d)(f,r,!0);case 15:f=e.sent;case 16:r.cutUrl=f,console.log("截图上传成功~！时间： "+(new Date).getTime()),e.next=24;break;case 20:return e.prev=20,e.t0=e.catch(8),r.loading=!1,e.abrupt("return");case 24:if(!(_=null===(n=t.top.paintingBoardData.liveModel)||void 0===n?void 0:n.productLayerId)){e.next=44;break}if(!(y=l.find((function(t){return t.layerId===_})))||!t.isColliding(y,r)){e.next=42;break}return canvas=document.querySelector("#".concat(_)),w=canvas.getBoundingClientRect(),C=w.width,k=w.height,O=w.x,x=w.y,I=O-d,D=x-h,r.mask=Object(ht.f)({width:v,height:m,b_w:C,b_h:k,b_x:I,b_y:D}),e.prev=33,e.next=36,Object(ht.s)(canvas.toDataURL());case 36:S=e.sent,r.product_image_url=S||"",e.next=42;break;case 40:e.prev=40,e.t1=e.catch(33);case 42:e.next=45;break;case 44:r.product_image_url="";case 45:t.top.generateTask("live",t.liveInfo);case 46:case"end":return e.stop()}}),e,null,[[8,20],[33,40]])})))()},detecteChange:function(t){var e=this;if(!t)return!1;var n=this.top.paintingBoardData.elementList,o=!1;return(o=t.layerId?this.isColliding(this.liveInfo,t):n.some((function(n){return e.isColliding(t,n)})))||this.initLiveView(),o},initLiveView:function(){var t=this.top.paintingBoardData.liveModel;t.cutUrl="",t.loading=!1},isColliding:function(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y},changeSize:function(t,e){var n=t/this.liveInfo[e],o="width"===e?0:1,r=this.top.paintingBoardData.liveModel.zoom.split(",");r[o]=n,this.top.paintingBoardData.liveModel.zoom=r.toString()}}},ti=Ze,ei=(n(2828),Object(_.a)(ti,(function(){var t=this._self._c;return t("live-move",{ref:"liveMove"},[t("div",{staticClass:"live-panel",on:{click:this.getActive}},[t("div",{staticClass:"live-win",attrs:{"data-drag":"no"}})])])}),[],!1,null,"01a14202",null).exports),ii={inject:["top"],data:function(){return{leftX:0,topY:0,width:"",list:[],size:"1024x1024"}},mounted:function(){this.top.eventFn.layerBtnsSetPoin=this.setPoin},computed:{isShow:function(){return this.top.paintingBoardData.elementList.some((function(t){return t.active}))},getActiveList:function(){return this.top.paintingBoardData.elementList.filter((function(t){return t.active}))||[]},isShowClip:function(){return 1===this.getActiveList.length&&this.getActiveList[0].cropping}},methods:{handleEvent:function(t,e){"del"===t&&(this.leftX=0,this.topY=0),this.$emit("topBtnsClick",t,e)},setPoin:function(data){var t=this,e=this.top.paintingBoardData,n=(e.elementList,e.boardInfo.zoom);if(0===this.getActiveList.length)return this.leftX=0,void(this.topY=0);if(this.getActiveList.length>1)this.list=[{icon:"icon-icon_xiazai",type:"download",hoverTips:"Download"},{icon:"icon-icon_tushengtu",type:"imgToImg",hoverTips:"canvas_send_hover",size:"20px"},{icon:"icon-shanchu1",type:"del",hoverTips:"canvas_delete_hover"},{icon:"icon-icon_more",type:"more",hoverTips:""}],setTimeout((function(){var e=document.querySelector(".moveable-area").getBoundingClientRect();t.leftX=e.left,t.topY=e.top-50,t.top.handleSelectSize(parseInt(e.width/n),parseInt(e.height/n),"multiple")}),100),this.size="";else{var o=Object(r.a)(this.getActiveList,1)[0],l=document.querySelector("#img-"+o.layerId).getBoundingClientRect();this.list=[{icon:"icon-icon_xiazai",type:"download",hoverTips:"Download",size:"14px"},{icon:"icon-icon_qubeijing",type:"removeBg",hoverTips:"ai_tools_2"},{icon:"icon-icon_tushengtu",type:"imgToImg",hoverTips:"canvas_send_hover",size:"20px"},{icon:"icon-icon_caiqie",type:"clip",hoverTips:"canvas_tailor_hover"},{icon:"icon-shanchu1",type:"del",hoverTips:"canvas_delete_hover",size:"17px"},{icon:"icon-icon_more",type:"more",hoverTips:"",size:"14px"}],this.leftX=l.left,this.width=l.width,this.size=parseInt(l.width/n)+"x"+parseInt(l.height/n),this.top.handleSelectSize(parseInt(l.width/n),parseInt(l.height/n)),this.topY=l.top-50}},hideBtn:function(){this.leftX=0,this.topY=0},handleClipDone:function(){var t=this.getActiveList[0].layerId,e=document.querySelector("#img-".concat(t));this.getActiveList[0].clipPath=e.style.clipPath,this.getActiveList[0].cropping=!1}}},ni=(n(2829),Object(_.a)(ii,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],staticClass:"top-menu no-snapshot",class:t.width<290&&"no-sizetext",style:{top:t.topY+"px",left:t.leftX+"px",width:t.width+"px"},attrs:{id:"layerBtnsId","data-size":t.size}},[t.isShowClip?e("div",{staticClass:"clip-box"},[t._m(0),t._v(" "),e("div",{staticClass:"right",on:{click:t.handleClipDone}},[t._v(t._s(t.$t("Done")))])]):e("div",{staticClass:"top-action-nav"},[e("div",{staticClass:"action-list flex"},t._l(t.list,(function(n){return e("div",{key:n.icon,staticClass:"item flex_c_m",class:"top-btn-".concat(n.type),on:{click:function(e){return t.handleEvent(n.type,e)}}},[e("el-tooltip",{attrs:{effect:"dark",disabled:!n.hoverTips,content:t.$t(n.hoverTips),placement:"bottom"}},[e("i",{staticClass:"iconfont",class:n.icon,style:{fontSize:n.size}})])],1)})),0)])])}),[function(){var t=this._self._c;return t("div",{staticClass:"left"},[t("i",{staticClass:"iconfont icon-icon_caiqie"})])}],!1,null,"7c65398c",null).exports),ai={inject:["top"],data:function(){return{title:"",leftX:-500,topY:-500,leftX1:-500,topY1:-500,zoomWidth:256,showSize:!1}},watch:{sizeInfo:{handler:function(t){this.initPoin()},deep:!0},"top.paintingBoardData.imageToImage.imgUrl":function(){this.setTitle()}},computed:{screenshotInfo:function(){var t;return(null===(t=this.top.paintingBoardData)||void 0===t?void 0:t.generateInfo)||{}},width:function(){var t;return(null===(t=this.screenshotInfo)||void 0===t?void 0:t.width)||256},height:function(){var t;return(null===(t=this.screenshotInfo)||void 0===t?void 0:t.height)||256},sizeInfo:function(){var t=this.screenshotInfo;return{width:t.width,height:t.height,x:t.x,y:t.y,zoom:this.top.paintingBoardData.boardInfo.zoom}}},mounted:function(){this.initPoin(),this.setTitle()},methods:{inputFocus:function(){this.top.paintingBoardData.elementList.forEach((function(t){return t.active=!1}))},changePrompt:function(t){this.top.paintingBoardData.generateInfo.prompt=t},initPoin:function(){var t=document.querySelector("#aiimgItemBoxId");if(t){var e=t.getBoundingClientRect();this.leftX=e.left-70,this.topY=e.top+e.height-30,this.zoomWidth=e.width,this.initTitlePoin(),this.setTitle()}},initTitlePoin:function(){var t=document.querySelector("#aiimgItemBoxId");if(t){var e=t.getBoundingClientRect(),n=e.left,o=e.top;this.leftX1=n-70,this.topY1=o-82,this.showSize=!1}},changSizeW:function(t){var e=document.querySelector("#aiimgItemBoxId"),n=this.top.paintingBoardData.generateInfo,o=t||256;e.style.width=o+"px",this.top.aiimgBoxRef.updateRect(),n.width=o},changSizeH:function(t){var e=this.top.paintingBoardData.generateInfo,n=t||256;document.querySelector("#aiimgItemBoxId").style.height=n+"px",this.top.aiimgBoxRef.updateRect(),e.height=n},setTitle:function(){var title=this.getTitle();this.title=title||this.$t("Txt2Img")},getTitle:function(){var t=this.top.paintingBoardData,e=t.elementList,n=t.imageToImage.imgUrl,o=this.isColliding(e);o=0===o&&n?3:o,this.top.updateAiImgStatus(o);var r=[2,1].includes(o);return this.top.eventFn.controlNetDisable&&this.top.eventFn.controlNetDisable(r),this.$t(["Txt2Img","Expansion","PartialRedrawing","ImgToImg"][o])},isColliding:function(t){var e=document.querySelector("#aiimgItemBoxId");if(!e)return 0;var n=e.getBoundingClientRect(),o=n.left,r=n.top,l=n.right,c=n.bottom,d=0;return t.forEach((function(t){var e=document.querySelector('[data-id="'+t.layerId+'"]'),n=(null==e?void 0:e.getBoundingClientRect())||{},h=n.left,v=n.top,m=n.right,f=n.bottom;d=(m<o||h>l||f<r||v>c)&&0===d?0:h<=o&&v<=r&&m>=l&&f>=c||2===d?2:1})),d},aiHtmlImg:function(t){if(!this.top.token)return this.$EventBus.$emit("openLoginDialog",{callBack:function(){window.location.reload()}});L.a.emit("$E_updateAiBoxSize"),this.$emit("onSubmit",t)}}},oi=(n(2830),Object(_.a)(ai,(function(){var t,e=this,n=e._self._c;return n("div",{staticClass:"prompt-panel"},[n("div",{staticClass:"edit-content",style:{top:e.topY+"px",left:e.leftX+"px"},attrs:{id:"aiImageTipsId"}},[n("div",{staticClass:"btn-input",attrs:{"data-drag":"no"}},[n("el-input",{attrs:{"data-drag":"no",type:"textarea",resize:"none",value:null===(t=e.screenshotInfo)||void 0===t?void 0:t.prompt},on:{focus:e.inputFocus,input:e.changePrompt},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.aiHtmlImg.apply(null,arguments))}}})],1),e._v(" "),n("div",{staticClass:"btn-box flex_m",attrs:{"data-drag":"no"}},[e.screenshotInfo.loading?n("el-button",{staticClass:"btn-item cancel-btn",attrs:{"data-drag":"no",size:"small",type:"primary"},on:{click:function(t){return e.aiHtmlImg("cancel")}}},[n("span",{attrs:{"data-drag":"no"}},[e._v(e._s(e.$t("Cancel")))])]):n("el-button",{staticClass:"btn-item",attrs:{"data-drag":"no",size:"small",type:"primary",loading:e.screenshotInfo.loading},on:{click:e.aiHtmlImg}},[n("span",{attrs:{"data-drag":"no"}},[e._v(e._s(e.title))])])],1)]),e._v(" "),n("div",{staticClass:"aibox-title-info flex",style:{top:e.topY1+"px",left:e.leftX1+"px",width:e.zoomWidth+"px"},attrs:{id:"aiboxTitleId"}},[n("div",{staticClass:"left"},[n("span",[e._v(e._s(e.title))])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.zoomWidth>160,expression:"zoomWidth>160"}],staticClass:"right"},[e.showSize?e._e():n("span",{on:{click:function(t){e.showSize=!0}}},[e._v(e._s(parseInt(e.width))+"x"+e._s(parseInt(e.height)))]),e._v(" "),e.showSize?n("div",[n("el-input-number",{staticClass:"my-el-input-number",attrs:{value:parseInt(e.width),min:256,max:1024},on:{change:e.changSizeW}}),e._v(" "),n("span",[e._v("x")]),e._v(" "),n("el-input-number",{staticClass:"my-el-input-number",attrs:{value:parseInt(e.height),min:256,max:1024},on:{change:e.changSizeH}})],1):e._e()])])])}),[],!1,null,"e2e43aa0",null)),si=oi.exports,ri={inject:["top"],data:function(){return{tipsVal:"",leftX:-500,topY:-500,currentItem:{}}},watch:{"top.paintingBoardData.boardInfo.zoom":{handler:function(){this.setPositionBox()}},"top.paintingBoardData.liveModel.show":{handler:function(t){t&&(this.leftX=-500,this.topY=-500)}}},mounted:function(){this.top.setLayerFooterRef(this)},methods:{setPositionBox:function(){var t=this.top.paintingBoardData.elementList.find((function(t){return t.hasDrawLine||t.hasRedraw}));if(!t)return this.leftX=-500,void(this.topY=-500);this.currentItem=t;var e=this.currentItem,n=document.querySelector("#img-"+e.layerId).getBoundingClientRect();this.leftX=n.left-70,this.topY=n.top+n.height-30},tipsSubmit:function(){this.$emit("onSubmit",this.tipsVal)}}},ci=(n(2831),Object(_.a)(ri,(function(){var t=this,e=t._self._c;return e("div",{ref:"layerFooterRef",staticClass:"edit-content no-snapshot",style:{top:t.topY+"px",left:t.leftX+"px"}},[e("div",{staticClass:"btn-input",attrs:{"data-drag":"no"}},[e("el-input",{attrs:{"data-drag":"no",type:"textarea",resize:"none"},model:{value:t.tipsVal,callback:function(e){t.tipsVal=e},expression:"tipsVal"}})],1),t._v(" "),e("div",{staticClass:"btn-box flex_m",attrs:{"data-drag":"no"}},[e("el-button",{staticClass:"btn-item",attrs:{"data-drag":"no",size:"small",type:"primary",loading:t.currentItem.loading},on:{click:t.tipsSubmit}},[e("span",{attrs:{"data-drag":"no"}},[t._v(t._s(t.$t("Submit")))])])],1)])}),[],!1,null,"65529d99",null).exports);function ui(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function di(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ui(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ui(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var hi=n(2832),pi={components:{VueMoveable:Ye.a},props:{moveConfig:{type:Object,default:function(){return hi.a}}},data:function(){return{targetRef:null}},mounted:function(){this.targetRef=this.$refs.targetRef},methods:{handClick:function(){this.$emit("onClick",this.targetRef)},handDragStart:function(){this.$emit("onDragStart",this.targetRef)},handleDrag:function(t){var e=t.target,n=t.transform;e.style.transform=n},handleResize:function(t){var e=t.target,n=t.width,o=t.height,r=t.delta;r[0]&&(e.style.width="".concat(n,"px")),r[1]&&(e.style.height="".concat(o,"px"))},handleScale:function(t){var e=t.target,n=t.transform;t.scale;e.style.transform=n},handleRotate:function(t){var e=t.target,n=(t.dist,t.transform);e.style.transform=n},handleWarp:function(t){var e=t.target,n=t.transform;e.style.transform=n},handlePinch:function(t){t.target}}},vi=(n(2833),Object(_.a)(pi,(function(){var t=this,e=t._self._c;return e("div",[e("div",{ref:"targetRef",staticClass:"item-box"},[t._t("default")],2),t._v(" "),e("vue-moveable",t._b({attrs:{target:t.targetRef},on:{click:t.handClick,drag:t.handleDrag,dragStart:t.handDragStart,resize:t.handleResize,scale:t.handleScale,rotate:t.handleRotate,warp:t.handleWarp,pinch:t.handlePinch}},"vue-moveable",di(di({},t.moveConfig),t.$attrs),!1))],1)}),[],!1,null,null,null).exports);function mi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function fi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?mi(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var gi={inject:["top"],props:{targets:{type:Array,default:function(){return[]}},selectoRef:{type:Object,default:function(){return{}}}},data:function(){return{moveableRef:null,draggable:!0,scalable:!0,rotatable:!0,resizable:!1,keepRatio:!1,clipRelative:!1,clipArea:!1,borderW:1,renderDirections:["nw","n","ne","w","e","sw","s","se"],translateInfo:{x:0,y:0},timer:null}},watch:{"top.paintingBoardData.boardInfo.zoom":{handler:function(t){var e=1/t;this.borderW=e},immediate:!0}},components:{VueSelecto:De.a,VueMoveable:Ye.a},mounted:function(){this.moveableRef=this.$refs.moveableRef,this.top.moveableRef=this.$refs.moveableRef},computed:{getActiveList:function(){return this.top.paintingBoardData.elementList.filter((function(t){return t.active}))||[]},clippable:function(){var t=Object(r.a)(this.getActiveList,1)[0],e=void 0===t?{}:t;return 1==this.getActiveList.length&&(this.keepRatio=!1,e.cropping)},warpable:function(){var t=Object(r.a)(this.getActiveList,1)[0],e=void 0===t?{}:t;return 1==this.getActiveList.length&&(this.scalable=!e.freeDeformation,e.freeDeformation)}},methods:{onClickGroup:function(t){this.selectoRef.clickTarget(t.inputEvent,t.inputTarget)},onRenderGroup:function(t){t.events.forEach((function(t){t.target.style.cssText+=t.cssText})),this.$emit("renderGroup",t)},renderGroupEnd:function(t){var e=this,n=this.top.paintingBoardData.boardInfo.zoom;t.events.forEach((function(t){var o=t.target.getAttribute("data-id"),r=document.querySelector("#"+o).getBoundingClientRect(),l=t.transformObject,c=l.translate,d=l.scale,h=void 0===d?[1,1,1]:d,v=Object(ht.r)(t.transform).rotate,m=parseInt(r.width/n),f=parseInt(r.height/n),_={x:c[0],y:c[1],zoom:h,rotate:v,renderWidth:m,renderHeight:f};e.changeData(_,o)})),this.$emit("actionEnd",t)},onRender:function(t){t.target.style.cssText+=t.cssText},onScale:function(t){var e=this,n=Object(r.a)(t.drag.translate,2);n[0],n[1];t.target.style.transform=t.drag.transform;t.target.getAttribute("data-id");var o=t.scale||[];Object(r.a)(o,1)[0];this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((function(){clearTimeout(e.timer),e.timer=null}),300),this.$emit("scale",t)},onResize:function(t){var e=t.target.getAttribute("data-id"),n=this.top.paintingBoardData.elementList,o=n.findIndex((function(em){return em.layerId===e}));this.top.changeData("elementList[".concat(o,"]"),fi(fi({},n[o]),{},{width:t.width,height:t.height}))},onRotate:function(t){t.target.style.transform=t.drag.transform},onRotateEnd:function(t){if(t.lastEvent){var e=t.target.getAttribute("data-id"),n=t.lastEvent.rotate;this.changeData({rotate:n},e)}},scaleStart:function(t){var e=t.direction.join("");this.keepRatio=["-1-1","1-1","11","-11"].includes(e);var n=t.target.getAttribute("data-id");this.top.getEleInfo(n,"lock")&&t.stop()},scaleGroupStart:function(t){var e=t.direction.join(""),n=this.targets.length>1;this.keepRatio=["-1-1","1-1","11","-11"].includes(e)&&n},scaleEnd:function(t){if(t.lastEvent){var e=this.top.paintingBoardData.boardInfo.zoom,n=t.lastEvent.scale||[],o=t.target.getAttribute("data-id"),r=document.querySelector("#"+o).getBoundingClientRect(),l=parseInt(r.width/e),c=parseInt(r.height/e),d={x:t.clientX,y:t.clientY,renderWidth:l,renderHeight:c,zoom:n};this.changeData(d,o),this.$emit("actionEnd",t)}},rotateStart:function(t){var e=t.target.getAttribute("data-id");this.top.getEleInfo(e,"lock")&&t.stop()},dragStart:function(t){if(t.target){var e=t.target.getAttribute("data-id");this.top.getEleInfo(e,"lock")&&t.stop()}},dragMove:function(t){this.$emit("drag",t)},clickItem:function(t){},dragEnd:function(t){if(t.lastEvent){var e=t.target.getAttribute("data-id"),n=Object(r.a)(t.lastEvent.translate,2),o=n[0],l=void 0===o?0:o,c=n[1],d=void 0===c?0:c;this.changeData({x:l,y:d},e),this.$emit("actionEnd",t)}},warpEnd:function(t){var e=t.target.style.transform.match(/matrix3d\((.*?)\)/),n="";e&&e.length>1&&(n=e[1]);var o=t.target.getAttribute("data-id");this.changeData({x:t.clientX,y:t.clientY,matrix3d:n},o)},changeData:function(t,e){var n=this.top.paintingBoardData.elementList,o=n.findIndex((function(em){return em.layerId===e})),r=JSON.parse(JSON.stringify(n[o]));r=fi(fi({},r),t),this.top.changeData("elementList[".concat(o,"]"),r)}}},bi=Object(_.a)(gi,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"move-box bel-item"},[e("vue-moveable",{ref:"moveableRef",attrs:{target:t.targets,draggable:t.draggable,rotatable:t.rotatable,origin:!1,resizable:t.resizable,keepRatio:t.keepRatio,scalable:t.scalable,checkInput:!0,clippable:t.clippable,clipRelative:t.clipRelative,clipArea:t.clipArea,warpable:t.warpable,renderDirections:t.renderDirections,rotationPosition:"bottom",zoom:t.borderW},on:{dragStart:t.dragStart,scaleStart:t.scaleStart,scale:t.onScale,scaleEnd:t.scaleEnd,scaleGroupStart:t.scaleGroupStart,rotateStart:t.rotateStart,drag:t.dragMove,dragEnd:t.dragEnd,clickGroup:t.onClickGroup,render:t.onRender,renderGroup:t.onRenderGroup,renderGroupEnd:t.renderGroupEnd,rotate:t.onRotate,rotateEnd:t.onRotateEnd,resize:t.onResize,click:t.clickItem,warpEnd:t.warpEnd}}),t._v(" "),t._t("default")],2)}),[],!1,null,"3c4f8bf7",null).exports,_i={data:function(){return{itemList:[{actItem:!1}],actIndex:-1}},components:{MoveItem:vi,Selecto:De.a},methods:{handClick:function(t,e){this.actIndex=e,this.itemList.forEach((function(t){return t.actItem=!1})),t.actItem=this.actIndex===e}}},yi=Object(_.a)(_i,(function(){var t=this,e=t._self._c;return e("div",t._l(t.itemList,(function(n,o){return e("move-item",{key:o,attrs:{scalable:n.actItem,rotatable:n.actItem},on:{onDragStart:function(e){return t.handClick(n,o)}}},[e("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:"https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg"}})],1)})),1)}),[],!1,null,"023ad110",null).exports,wi={components:{Moveable:Ye.a,Selecto:De.a},data:function(){for(var t=[],i=0;i<30;++i)t.push(i);return{hitRate:0,selectByClick:!0,selectFromInside:!1,toggleContinueSelect:["shift"],ratio:0,cubes:t,targets:[],moveableRef:null,selectoRef:null}},methods:{onClickGroup:function(t){this.$refs.selectoRef.clickTarget(t.inputEvent,t.inputTarget)},onRender:function(t){t.target.style.cssText+=t.cssText},onRenderGroup:function(t){t.events.forEach((function(t){t.target.style.cssText+=t.cssText}))},onDragStart:function(t){var e=t.inputEvent.target;(this.$refs.moveableRef.isMoveableElement(e)||this.targets.some((function(t){return t===e||t.contains(e)})))&&t.stop()},onSelectEnd:function(t){this.targets=t.selected}},mounted:function(){this.moveableRef=this.$refs.moveableRef,this.selectoRef=this.$refs.selectoRef}},Ci=(n(2834),{data:function(){return{selectoRef:null,moveableRef:null,targets:[]}},components:{MoveItem:vi,MoveItems:bi,GroupMoveItem:yi,demo:Object(_.a)(wi,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"group-select-box moveable app"},[e("Moveable",{ref:"moveableRef",attrs:{target:t.targets,draggable:!0},on:{clickGroup:t.onClickGroup,render:t.onRender,renderGroup:t.onRenderGroup}}),t._v(" "),e("Selecto",{ref:"selectoRef",attrs:{dragContainer:".elements",selectableTargets:[".target"],hitRate:t.hitRate,selectByClick:t.selectByClick,selectFromInside:t.selectFromInside,toggleContinueSelect:t.toggleContinueSelect,ratio:t.ratio,keyContainer:t.window},on:{dragStart:t.onDragStart,selectEnd:t.onSelectEnd}}),t._v(" "),e("div",{staticClass:"elements selecto-area"},t._l(t.cubes,(function(i){return e("div",{key:i,staticClass:"cube target"})})),0),t._v(" "),e("div",{staticClass:"empty elements"})],1)}),[],!1,null,"37ce073a",null).exports,VueSelecto:De.a,VueMoveable:Ye.a},mounted:function(){this.moveableRef=this.$refs.moveableRef,this.selectoRef=this.$refs.selectoRef},methods:{onDragStart:function(t){var e=t.inputEvent.target,n=this.$refs.moveableRef.isMoveableElement(e),o=this.targets.some((function(t){return t===e||t.contains(e)}));(n||o)&&t.stop()},onSelectEnd:function(t){this.targets=t.selected},onSelect:function(t){},onClickGroup:function(t){this.$refs.selectoRef.clickTarget(t.inputEvent,t.inputTarget)},onRender:function(t){t.target.style.cssText+=t.cssText},onRenderGroup:function(t){t.events.forEach((function(t){t.target.style.cssText+=t.cssText}))}}}),ki=(n(2835),Object(_.a)(Ci,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"move-box"},[e("vue-selecto",{ref:"selectoRef",attrs:{dragContainer:".move-container",selectableTargets:[".move-item"],hitRate:0},on:{dragStart:t.onDragStart,selectEnd:t.onSelectEnd,select:t.onSelect}}),t._v(" "),e("vue-moveable",{ref:"moveableRef",attrs:{target:t.targets,draggable:!0,scalable:!0,rotatable:!0,origin:!1,keepRatio:!0},on:{clickGroup:t.onClickGroup,render:t.onRender,renderGroup:t.onRenderGroup}}),t._v(" "),t._m(0)],1)}),[function(){var t=this,e=t._self._c;return e("div",{staticClass:"move-container flex_c_m"},[e("div",{staticClass:"move-item"},[t._v("1")]),t._v(" "),e("div",{staticClass:"move-item"},[t._v("2")]),t._v(" "),e("div",{staticClass:"move-item"},[t._v("3")]),t._v(" "),e("div",{staticClass:"move-item"},[t._v("4")]),t._v(" "),e("div",{staticClass:"move-item"},[t._v("5")])])}],!1,null,"89b8bf6c",null).exports);function Oi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function xi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Oi(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Oi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ii={inject:["top"],props:{item:{type:Object,default:function(){return{}}}},data:function(){return{brushCanvas:null}},mounted:function(){var t=this,e=this.item;this.$nextTick((function(){t.initBoard(e)}))},watch:{"top.paintingBoardData.topNav.tools":{handler:function(){this.brushCanvas?this.brushDraw():this.initBoard(this.item)},deep:!0}},methods:{initBoard:function(t){this.brushCanvas=new Ve.fabric.Canvas("mack-"+t.layerId,{width:t.width,height:t.height,selectable:!1,evented:!1}),this.brushDraw()},brushDraw:function(){var t=this,e=this.top.paintingBoardData.topNav.tools,n=e.brushTool.brushImg,o=("brush"===n.hasAct&&e.hasAct,this.brushCanvas);if("brushImg"===e.hasAct){var r="source-over";o.freeDrawingBrush.color=n.color,o.freeDrawingBrush.width=n.wide/10,o.isDrawingMode=!0,"brush"===n.hasAct?(r="source-over",o.freeDrawingBrush.globalCompositeOperation=r):(r="destination-out",o.freeDrawingBrush.color="#000",o.freeDrawingBrush.globalCompositeOperation=r),o.on("path:created",(function(e){var n=null,l=t.top.paintingBoardData.elementList.map((function(em,e){return em.layerId===t.item.layerId&&(n=e),xi(xi({},em),{},{hasDrawLine:!1})}));t.top.paintingBoardData.liveModel.show||(l[n].hasDrawLine=!0),t.top.changeData("elementList",l),o.isDrawingMode&&(e.path.globalCompositeOperation=r),t.top.layerFooterRef.setPositionBox()}))}else o.isDrawingMode=!1,o.clear();o.selection=!1,o.forEachObject((function(t){t.selectable=!1,t.lockUniScaling=!0,t.lockRotation=!0}))}}},Di=(n(2836),Object(_.a)(Ii,(function(){var t=this._self._c;return t("div",{staticClass:"page-box"},[t("canvas",{attrs:{"data-drag":"no",id:"mack-"+this.item.layerId}})])}),[],!1,null,"746198d8",null).exports);function Si(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Pi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Si(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Si(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Li={inject:["top"],data:function(){return{leftX:-500,topY:-500}},watch:{"top.paintingBoardData.boardInfo.zoom":{handler:function(){this.initPoin()}},"top.paintingBoardData.liveModel.show":{handler:function(t){t&&(this.leftX=-500,this.topY=-500)}}},props:{item:{type:Object,default:function(){return{}}}},methods:{initPoin:function(){var t=this.item,e=document.querySelector("#img-"+t.layerId).getBoundingClientRect();this.leftX=e.left-70,this.topY=e.top-100},handleSubmit:function(){var t,e=this;null!==(t=this.item)&&void 0!==t&&t.loading||(this.item.loading=!0,this.top.generateTask("generate",this.item,(function(img){e.$emit("updateImageSize",img[0])}),"intelligentEraser"))},handleCancel:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.top.cancelTask(t.item);case 2:n=t.top.paintingBoardData.elementList.map((function(em,t){return Pi(Pi({},em),{},{hasEraserDraw:!1,mask:""})})),t.top.changeData("elementList",n),t.top.changeData("topNav.tools.eraserTool.eraserAiBoard.hasAct","brush");case 5:case"end":return e.stop()}}),e)})))()}}},ji=(n(2837),Object(_.a)(Li,(function(){var t,e,n=this,o=n._self._c;return o("div",{staticClass:"top-action-nav",style:{top:n.topY+"px",left:n.leftX+"px"},attrs:{id:"EraserBottonsId"}},[o("div",{staticClass:"action-list flex"},[o("div",{staticClass:"item flex_c_m"},[o("i",{staticClass:"iconfont",class:[n.item.loading?"el-icon-loading":"icon-icon_zidongcachu1"]})]),n._v(" "),null!==(t=n.item)&&void 0!==t&&t.loading?n._e():o("div",{staticClass:"item-btn flex_c_m",on:{click:n.handleSubmit}},[n._v("\n      "+n._s(n.$t("canvas_erase_hover"))+"\n    ")]),n._v(" "),null!==(e=n.item)&&void 0!==e&&e.loading?o("div",{staticClass:"item-btn item-btn-gray flex_c_m",on:{click:n.handleCancel}},[n._v("\n      "+n._s(n.$t("Cancel"))+"\n    ")]):n._e()])])}),[],!1,null,"30a900e0",null).exports);function $i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Ti(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$i(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Bi={name:"generateModeRedraw",inject:["top"],props:{sourceInfo:{type:Object,default:function(){return{}}}},watch:{toolsType:{handler:function(){this.setDrawType(),this.setCanvasStyle()}},eraserSize:{handler:function(){this.setCanvasStyle()}},brushSize:{handler:function(){this.setCanvasStyle()}},"sourceInfo.mask":{handler:function(t,e){t!==this.imgUrl&&!/^(http|https):\/\//.test(t)&&this.displayMaskToCanvas(t)},deep:!0}},computed:{toolsType:function(){return"eraser"===this.top.paintingBoardData.topNav.tools.daubTool.redrawBoard.hasAct?"ERASER":"PEN"},brushSize:function(){var t=this.top.paintingBoardData.topNav.tools.daubTool.redrawBoard.wide;return isNaN(t/4)?100:t/4},eraserSize:function(){var t=this.top.paintingBoardData.topNav.tools.daubTool.redrawBoard.wide;return isNaN(t/4)?100:t/4}},data:function(){return{canvasStyle:{},blankCanvas:"",brushColor:"rgb(255,255,255)",isDrawing:!1,lastX:0,lastY:0,blankBgCanvas:"",imageData:null,imgUrl:"",autoStyle:{width:500,height:500,rawWidth:500,rawHeight:500}}},mounted:function(){this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),this.initBgCanvas(),this.ctx.strokeStyle=this.brushColor,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.lineWidth="ERASER"===this.toolsType?this.eraserSize:this.brushSize,document.addEventListener("mouseup",this.stopDrawing),this.canvas.addEventListener("mousedown",this.startDrawing),this.canvas.addEventListener("mousemove",this.draw),this.canvas.addEventListener("mouseup",this.stopDrawing),this.blankCanvas=this.canvas.toDataURL(),this.saveBackgroundCanvas()},beforeDestroy:function(){this.canvas.removeEventListener("mousedown",this.startDrawing),this.canvas.removeEventListener("mousemove",this.draw),this.canvas.removeEventListener("mouseup",this.stopDrawing),document.removeEventListener("mouseup",this.stopDrawing),this.clearMaskImg()},methods:{clearMaskImg:function(){this.imgUrl="",this.$emit("updateMask",this.imgUrl),this.displayMaskToCanvas("")},displayMaskToCanvas:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.imgUrl=e;var img=new Image,n=this.ctx,o=this.canvas.width,r=this.canvas.height;if(["",null,void 0].includes(e))return n.clearRect(0,0,o,r),void(this.imgUrl="");img.onload=function(){n.clearRect(0,0,o,r),n.drawImage(img,0,0,o,r);for(var e=n.getImageData(0,0,o,r),data=e.data,i=0;i<data.length/4;i++){var l=4*i,c=data[l],g=data[l+1],b=data[l+2],d=(data[l+3],Math.max(c,g,b));data[l+3]=d,0==c&&0==g&&0==b&&(data[l+3]=0)}n.putImageData(e,0,0),t.updateBgMask()},img.onerror=function(t){},img.src=e},setCanvasStyle:function(){var t="ERASER"===this.toolsType?this.eraserSize:this.brushSize,e='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="'.concat(t,'" height="').concat(t,'" viewBox="0 0 ').concat(t," ").concat(t,'">\n    <circle cx="').concat(t/2,'" cy="').concat(t/2,'" r="').concat(t/2,'" fill="purple" fill-opacity="0.5" />\n  </svg>'),n=btoa(e),o="data:image/svg+xml;base64,".concat(n);this.canvasStyle={cursor:"url(".concat(o,") ").concat(t/2," ").concat(t/2,", auto")}},saveCurrentDraw:function(){this.imageData=this.canvas.toDataURL()},initBgCanvas:function(){this.canvas2=this.$refs.canvas2,this.bgCtx=this.canvas2.getContext("2d"),this.bgCtx.fillStyle="black",this.bgCtx.fillRect(0,0,this.canvas2.width,this.canvas2.height)},saveBackgroundCanvas:function(){try{this.bgCtx.clearRect(0,0,this.canvas2.width,this.canvas2.height),this.bgCtx.fillStyle="black",this.bgCtx.fillRect(0,0,this.canvas2.width,this.canvas2.height),this.bgCtx.drawImage(this.canvas,0,0,this.canvas2.width,this.canvas2.height),this.blankBgCanvas=this.canvas2.toDataURL("image/png",.05)}catch(t){}},setDrawType:function(){this.ctx&&(this.ctx.strokeStyle=this.brushColor,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.globalCompositeOperation="ERASER"===this.toolsType?"destination-out":"source-over")},startDrawing:function(t){this.isDrawing=!0,this.setDrawType();var e=[t.offsetX,t.offsetY];this.lastX=e[0],this.lastY=e[1],this.ctx.beginPath(),this.ctx.moveTo(t.offsetX,t.offsetY),this.setInputShowStatus()},setInputShowStatus:function(){var t=this,e=-1,n=this.top.paintingBoardData.elementList.map((function(em,n){var mask=em.mask||"";return em.layerId===t.sourceInfo.layerId&&(e=n),em.layerId!==t.sourceInfo.layerId&&(mask=""),Ti(Ti({},em),{},{hasRedraw:!1,mask:mask})}));n[e].hasRedraw=!0,this.top.changeData("elementList",n),this.top.layerFooterRef.setPositionBox()},draw:function(t){if(this.isDrawing){this.ctx.lineWidth="ERASER"===this.toolsType?this.eraserSize:this.brushSize,this.ctx.strokeStyle=this.brushColor,this.ctx.lineTo(t.offsetX,t.offsetY),this.ctx.stroke();var e=[t.offsetX,t.offsetY];this.lastX=e[0],this.lastY=e[1]}},stopDrawing:function(){this.isDrawing=!1,this.ctx.closePath();try{this.saveDrawingToBase64()}catch(t){}},clearCanvas:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},updateBgMask:function(){this.bgCtx.clearRect(0,0,this.canvas2.width,this.canvas2.height),this.bgCtx.fillStyle="black",this.bgCtx.fillRect(0,0,this.canvas2.width,this.canvas2.height),this.bgCtx.drawImage(this.canvas,0,0,this.canvas2.width,this.canvas2.height);var t=this.bgCtx.getImageData(0,0,this.canvas2.width,this.canvas2.height);this.bgCtx.putImageData(t,0,0);var e=this.canvas2.toDataURL("image/png",.1);this.imgUrl=e},saveDrawingToBase64:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=1,t.bgCtx.clearRect(0,0,t.canvas2.width,t.canvas2.height),t.bgCtx.fillRect(0,0,t.canvas2.width,t.canvas2.height),t.bgCtx.drawImage(t.canvas,0,0,t.canvas2.width,t.canvas2.height),n=t.bgCtx.getImageData(0,0,t.canvas2.width,t.canvas2.height),t.bgCtx.putImageData(n,0,0),o=t.canvas2.toDataURL("image/png",.1),t.canvas.toDataURL()!==t.blankCanvas){e.next=12;break}return t.imgUrl="",t.$emit("updateMask",t.imgUrl),e.abrupt("return");case 12:if(o!==t.blankBgCanvas){e.next=16;break}return t.imgUrl="",t.$emit("updateMask",t.imgUrl),e.abrupt("return");case 16:t.imgUrl=o,t.$emit("updateMask",t.imgUrl),e.next=22;break;case 20:e.prev=20,e.t0=e.catch(1);case 22:case"end":return e.stop()}}),e,null,[[1,20]])})))()}}},Mi=Bi,Ri=(n(2838),Object(_.a)(Mi,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-generate-mode-redraw"},[e("canvas",{ref:"canvas",staticClass:"generate-mode-redraw-canvas",style:t.canvasStyle,attrs:{"data-drag":"no",width:t.sourceInfo.width,height:t.sourceInfo.height}}),t._v(" "),e("canvas",{ref:"canvas2",staticStyle:{display:"none"},attrs:{width:t.sourceInfo.realWidth,height:t.sourceInfo.realHeight}}),t._v(" "),t.imgUrl?e("img",{staticStyle:{display:"none"},attrs:{src:t.imgUrl,alt:""}}):t._e()])}),[],!1,null,"5e879486",null).exports),Ai=n(74),Ei=n(94),Ni=n.n(Ei),Fi=n(706);function Ui(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Hi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ui(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ui(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var zi={name:"segmentCmp",inject:["top"],props:["autoStyle","sourceInfo","segmentType"],mixins:[Fi.a],data:function(){return{selectList:[],blankCanvas:null,blankBgCanvas:null,maskList:[],imgSegmentUrlList:[],maskImg:"",hoverMaskUrl:"",imagesList:[],debounceHandleMouseMove:null,borderWidth:2,borderColor:"#fff",hasHover:!0,list:[],loading:!1,retryCount:0}},beforeDestroy:function(){this.debounceHandleMouseMove=null,this.loading=!1,this.list=[],this.retryCount=0,this.clearMaskImg()},created:function(){var t=this;this.pollingMiddleware=new Ae.a(2e3,(function(){t.fetchTaskData()})),this.debounceHandleMouseMove=Object(Ai.throttle)(this.handleMouseMove,300),this.initCallBack(this.handleLoadMaskData)},mounted:function(){},watch:{"sourceInfo.mask":{handler:function(t,e){t!==this.maskImg&&"eraser"!==(null==this?void 0:this.segmentType)&&!/^(http|https):\/\//.test(t)&&this.displayMaskToCanvas(t)},deep:!0}},computed:{enableRedraw:function(){return["daubBoard"].includes(this.top.paintingBoardData.topNav.tools.hasAct)||"eraser"===(null==this?void 0:this.segmentType)}},methods:{clearMaskImg:function(){this.maskImg="",this.$emit("updateMask",this.maskImg),this.displayMaskToCanvas("")},getSegmentMaskData:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,d,h,v,m,f,pattern;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loading&&!t.imgSegmentUrlList.length){e.next=2;break}return e.abrupt("return");case 2:return t.loading=!0,e.next=5,t.getCacheSegmentMaskData(null==t||null===(n=t.sourceInfo)||void 0===n?void 0:n.imgSrc);case 5:if(!(l=e.sent)||!l.imgSegmentUrlList.length){e.next=12;break}return d=(c=l||{}).imgSegmentUrlList,h=void 0===d?[]:d,v=c.imagesList,m=void 0===v?[]:v,t.imgSegmentUrlList=h,t.imagesList=m,t.loading=!1,e.abrupt("return");case 12:if(f={image_url:t.sourceInfo.imgSrc,width:null==t||null===(o=t.sourceInfo)||void 0===o?void 0:o.realWidth,height:null==t||null===(r=t.sourceInfo)||void 0===r?void 0:r.realHeight},pattern=/^(http|https):\/\//,f.image_url&&pattern.test(null==f?void 0:f.image_url)){e.next=17;break}return t.$message.error("图层图片未成功上传，无法使用此功能"),e.abrupt("return");case 17:Object(Re.b)(f).then((function(e){var n=e.data.id||"";t.list.push({status:1,process:0,id:n})})).catch((function(e){t.loading=!1}));case 18:case"end":return e.stop()}}),e)})))()},handleLoadMaskData:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";[3,"3"].includes(t)?this.loadJsonFile(e):this.$message.error(this.$t("ServerError"))},loadJsonFile:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return fetch(e).then((function(t){if(!t.ok)throw new Error("Network response was not ok");return t.json()})).then(function(){var e=Object(l.a)(regeneratorRuntime.mark((function e(data){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.initCanvas(null==data?void 0:data.result);case 2:t.loading=!1;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(n){console.error("There has been a problem with your fetch operation:",n),0===t.retryCount?(t.loadJsonFile(e).finally((function(){t.loading=!1})),t.retryCount++):t.$message.error(t.$t("ServerError"))}))},getCacheSegmentMaskData:function(){var t=arguments;return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!["",null,void 0].includes(n=t.length>0&&void 0!==t[0]?t[0]:"")){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,Ni.a.getItem("editBoardSegmentList");case 5:if(!(o=e.sent)||!o[n]){e.next=8;break}return e.abrupt("return",o[n]);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))()},displayMaskToCanvas:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",img=new Image,canvas=this.$refs.segmentCanvas3,n=canvas.getContext("2d"),o=(this.$refs.segmentCanvas3,this.autoStyle.width),r=this.autoStyle.height;if(["",null,void 0].includes(e))return n.clearRect(0,0,o,r),void(this.maskImg="");img.onload=function(){n.clearRect(0,0,o,r),n.drawImage(img,0,0,o,r);for(var e=n.getImageData(0,0,o,r),data=e.data,i=0;i<data.length/4;i++){var l=4*i,c=data[l],g=data[l+1],b=data[l+2],d=(data[l+3],Math.max(c,g,b));data[l+3]=d,0==c&&0==g&&0==b&&(data[l+3]=0)}n.putImageData(e,0,0),t.maskImg=canvas.toDataURL()},img.onerror=function(t){},img.src=e},initCanvas:function(){var t=arguments,e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var data,o,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return data=t.length>0&&void 0!==t[0]?t[0]:[],e.imgSegmentUrlList=data.map((function(t){return"data:image/png;base64,".concat(t.mask_png)})),n.next=4,e.loadAllMask(e.imgSegmentUrlList);case 4:if(e.imagesList=n.sent,!e.imagesList.length){n.next=13;break}return n.next=8,Ni.a.getItem("editBoardSegmentList");case 8:return o=n.sent,(r=Object.assign({},o||{}))[e.sourceInfo.imgSrc]={imgSegmentUrlList:e.imgSegmentUrlList,imagesList:e.imagesList},n.next=13,Ni.a.setItem("editBoardSegmentList",r);case 13:case"end":return n.stop()}}),n)})))()},loadAllMask:function(){var t=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.autoStyle||{},n=e.width,o=e.height,r=(source||[]).map((function(t){return new Promise((function(e,n){var img=new Image;img.onload=function(){return e(img)},img.onerror=function(t){return n(t)},img.src=t}))}));return Promise.all(r).then((function(e){for(var r=[],i=0;i<e.length;i++){var img=e[i],l=document.createElement("canvas");l.width=n,l.height=o;var c=l.getContext("2d");c.drawImage(img,0,0,t.autoStyle.width,t.autoStyle.height);for(var d=c.getImageData(0,0,t.autoStyle.width,t.autoStyle.height),data=d.data,h=0;h<data.length;h+=4)255===data[h]&&255===data[h+1]&&255===data[h+2]||(data[h+3]=0);c.putImageData(d,0,0);var v=l.toDataURL();t.$set(t.imgSegmentUrlList,i,v);var m=c.getImageData(0,0,t.autoStyle.width,t.autoStyle.height);r.push(m),l=null,c=null}return r}))},handleMouseEnter:function(t){this.hasHover=!0,!this.enableRedraw||this.loading||this.imgSegmentUrlList.length||this.getSegmentMaskData()},handleMouseLeave:function(t){this.hoverMaskUrl="",this.hasHover=!1},handleMouseDown:function(t){this.selectRegion(t)},handleMouseMove:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.iscoordinate(t.offsetX,t.offsetY,e.imagesList);case 2:-1==(o=n.sent)||e.hasHover&&e.setHoverMask(o);case 4:case"end":return n.stop()}}),n)})))()},setInputShowStatus:function(){var t=this,e=-1,n=this.top.paintingBoardData.elementList.map((function(em,n){var mask=em.mask||"";return em.layerId===t.sourceInfo.layerId&&(e=n),em.layerId!==t.sourceInfo.layerId&&(mask=""),Hi(Hi({},em),{},{hasRedraw:!1,mask:mask})}));n[e].hasRedraw=!0,this.top.changeData("elementList",n),this.top.layerFooterRef.setPositionBox()},setHoverMask:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,r,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!["",null,void 0,-1].includes(t)){n.next=3;break}return e.hoverMaskUrl="",n.abrupt("return");case 3:(o=new Image).src=e.imgSegmentUrlList[t],r=e.borderWidth,c=e.borderColor,o.onload=Object(l.a)(regeneratorRuntime.mark((function t(){var n,l,d,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=e.$refs.segmentCanvas2,(l=n.getContext("2d")).clearRect(0,0,e.autoStyle.width,e.autoStyle.height),d=[-1,-1,0,-1,1,-1,-1,0,1,0,-1,1,0,1,1,1],i=0;i<d.length;i+=2)l.drawImage(o,0+d[i]*r,0+d[i+1]*r,e.autoStyle.width,e.autoStyle.height);l.globalCompositeOperation="source-in",l.fillStyle=c,l.fillRect(0,0,e.autoStyle.width,e.autoStyle.height),l.globalCompositeOperation="source-over",l.drawImage(o,0,0,e.autoStyle.width,e.autoStyle.height),e.hoverMaskUrl=n.toDataURL(),l.clearRect(0,0,e.autoStyle.width,e.autoStyle.height);case 12:case"end":return t.stop()}}),t)})));case 8:case"end":return n.stop()}}),n)})))()},checkPixelTransparency:function(t,e,n){return 0!==t.data[4*(e+n*t.width)+3]},selectRegion:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("点击事件",t.offsetX,t.offsetY),e.setInputShowStatus(),n.next=4,e.iscoordinate(t.offsetX,t.offsetY,e.imagesList);case 4:-1==(o=n.sent)||e.selectSegmentMask(o);case 6:case"end":return n.stop()}}),n)})))()},selectSegmentMask:function(t){var e=this,n=new Image,canvas=this.$refs.segmentCanvas3,o=canvas.getContext("2d"),r=this.$refs.segmentCanvas2,l=r.getContext("2d"),c=this.autoStyle,d=c.width,h=c.height,v=c.realWidth,m=c.realHeight,f=this.borderWidth,_=this.borderColor;n.src=this.imgSegmentUrlList[t],n.onload=function(){l.clearRect(0,0,d,h);for(var t=[-1,-1,0,-1,1,-1,-1,0,1,0,-1,1,0,1,1,1],i=0;i<t.length;i+=2)l.drawImage(n,0+t[i]*f,0+t[i+1]*f,d,h);if(l.globalCompositeOperation="source-in",l.fillStyle=_,l.fillRect(0,0,d,h),l.globalCompositeOperation="source-over",l.drawImage(n,0,0,d,h),"eraser"!==(null==e?void 0:e.segmentType)){o.drawImage(r,0,0,d,h),e.maskImg=canvas.toDataURL();var c=document.createElement("canvas"),y=c.getContext("2d");c.width=v,c.height=m,y.drawImage(canvas,0,0,c.width,c.height);var w=c.toDataURL();e.maskImg=w,e.$emit("updateMask",w)}else{var C=r.toDataURL();e.$emit("updateEraserMask",C)}}},iscoordinate:function(t,e,n){var o=this;return Object(l.a)(regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=o.detectClickedImage(t,e,n),r.abrupt("return",i);case 2:case"end":return r.stop()}}),r)})))()},detectClickedImage:function(t,e,n){n.width,n.height,n.data;for(var i=n.length-1;i>=0;i--){var o=n[i],r=t-0,l=e-0;if(r>=0&&l>=0&&r<o.width&&l<o.height&&this.checkPixelTransparency(o,r,l))return i}}}},Vi=zi,Wi=(n(2839),Object(_.a)(Vi,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"c-segment-cmp"},[e("canvas",{ref:"segmentCanvas",staticClass:"segment-cmp-canvas",attrs:{width:t.autoStyle.width,height:t.autoStyle.height},on:{mouseenter:t.handleMouseEnter,mouseleave:t.handleMouseLeave,mousemove:t.debounceHandleMouseMove,mousedown:t.selectRegion}}),t._v(" "),e("canvas",{ref:"segmentCanvas2",staticClass:"segment-cmp-canvas",staticStyle:{display:"none"},attrs:{width:t.autoStyle.width,height:t.autoStyle.height}}),t._v(" "),e("canvas",{ref:"segmentCanvas3",staticClass:"segment-cmp-canvas",staticStyle:{display:"none"},attrs:{width:t.autoStyle.width,height:t.autoStyle.height}}),t._v(" "),t.hoverMaskUrl?e("img",{staticClass:"segment-image-draw-img-hover-mask",style:{width:"".concat(t.autoStyle.width,"px"),height:"".concat(t.autoStyle.height,"px")},attrs:{src:t.hoverMaskUrl}}):t._e(),t._v(" "),e("svg",{staticClass:"segment-cmp-svg",staticStyle:{filter:"opacity(60%) brightness(0) saturate(100%) invert(14%) sepia(81%) saturate(6216%) hue-rotate(352deg) brightness(91%) contrast(118%)"}},[e("g",{staticClass:"segment-cmp-g"},[e("image",{style:{width:"".concat(t.autoStyle.width,"px"),height:"".concat(t.autoStyle.height,"px")},attrs:{href:t.maskImg}}),t._v(" "),e("clipPath",[e("rect",{attrs:{x:"0",y:"0",width:t.autoStyle.width,height:t.autoStyle.height}})])])])])}),[],!1,null,"6315c930",null).exports);function qi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Gi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?qi(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Yi={name:"imageRedrawTools",mixins:[Fi.a],inject:["top"],props:{sourceInfo:{type:Object,default:function(){return{}}},eraserSize:{type:[Number,String],default:function(){return 20}},brushSize:{type:[Number,String],default:function(){return 20}},toolsType:{type:String,default:"PEN"},brushType:{type:String,default:"brush"}},watch:{toolsType:{handler:function(){this.setDrawType(),this.setCanvasStyle()}},eraserSize:{handler:function(){this.setCanvasStyle()}},brushSize:{handler:function(){this.setCanvasStyle()}},brushType:{handler:function(t,e){["brush"].includes(t)&&this.displayMaskToCanvas(this.maskImg),["eraser"].includes(t)&&this.displayMaskSegmentToCanvas(this.imgUrl)}},"sourceInfo.mask":{handler:function(t,e){""===t&&!/^(http|https):\/\//.test(t)&&(this.displayMaskToCanvas(t),this.displayMaskSegmentToCanvas(t))},deep:!0}},data:function(){return{brushColor:"rgb(255,255,255)",canvasStyle:{},blankCanvas:"",isDrawing:!1,lastX:0,lastY:0,maskImg:null,imgUrl:"",hoverMaskUrl:"",debounceHandleMouseMove:null,imgSegmentUrlList:[],imagesList:[],borderWidth:2,borderColor:"#fff",hasHover:!0,list:[],loading:!1,retryCount:0}},created:function(){var t=this;this.pollingMiddleware=new Ae.a(2e3,(function(){t.fetchTaskData()})),this.debounceHandleMouseMove=Object(Ai.throttle)(this.handleMouseMove,300),this.initCallBack(this.handleLoadMaskData)},mounted:function(){this.initBrush()},beforeDestroy:function(){this.debounceHandleMouseMove=null,this.loading=!1,this.list=[],this.retryCount=0,this.canvas.removeEventListener("mousedown",this.startDrawing),this.canvas.removeEventListener("mousemove",this.draw),this.canvas.removeEventListener("mouseup",this.stopDrawing),document.removeEventListener("mouseup",this.stopDrawing),this.clearMaskImg()},methods:{displayMaskToCanvas:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",img=new Image,n=this.ctx,canvas=this.$refs.segmentCanvas3,o=this.canvas.width,r=this.canvas.height;if(["",null,void 0].includes(e))return n.clearRect(0,0,o,r),void(this.imgUrl="");img.onload=function(){n.clearRect(0,0,o,r),n.drawImage(canvas,0,0,o,r);for(var e=n.getImageData(0,0,o,r),data=e.data,i=0;i<data.length/4;i++){var l=4*i,c=data[l],g=data[l+1],b=data[l+2],d=(data[l+3],Math.max(c,g,b));data[l+3]=d,0==c&&0==g&&0==b&&(data[l+3]=0)}n.putImageData(e,0,0),t.updateBgMask()},img.onerror=function(t){},img.src=e},displayMaskSegmentToCanvas:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",img=new Image,canvas=this.$refs.segmentCanvas3,n=canvas.getContext("2d"),o=canvas.width,r=canvas.height;if(["",null,void 0].includes(e))return n.clearRect(0,0,o,r),void(this.maskImg="");img.onload=function(){n.clearRect(0,0,o,r),n.drawImage(t.canvas,0,0,o,r);for(var e=n.getImageData(0,0,o,r),data=e.data,i=0;i<data.length/4;i++){var l=4*i,c=data[l],g=data[l+1],b=data[l+2],d=(data[l+3],Math.max(c,g,b));data[l+3]=d,0==c&&0==g&&0==b&&(data[l+3]=0)}n.putImageData(e,0,0),t.maskImg=canvas.toDataURL()},img.onerror=function(t){},img.src=e},updateBgMask:function(){var t=this.canvas.width,e=this.canvas.height;this.bgCtx.clearRect(0,0,t,e),this.bgCtx.fillStyle="black",this.bgCtx.fillRect(0,0,t,e),this.bgCtx.drawImage(this.canvas,0,0,t,e);var n=this.bgCtx.getImageData(0,0,t,e);this.bgCtx.putImageData(n,0,0);var o=this.canvas2.toDataURL("image/png",.1);this.imgUrl=o},clearMaskImg:function(){this.maskImg="",this.hoverMaskUrl="",this.$emit("updateMask",this.maskImg)},initBrush:function(){this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),this.initBgCanvas(),this.ctx.strokeStyle=this.brushColor,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.lineWidth="ERASER"===this.toolsType?this.eraserSize:this.brushSize,document.addEventListener("mouseup",this.stopDrawing),this.canvas.addEventListener("mousedown",this.startDrawing),this.canvas.addEventListener("mousemove",this.draw),this.canvas.addEventListener("mouseup",this.stopDrawing),this.blankCanvas=this.canvas.toDataURL(),this.saveBackgroundCanvas(),this.setCanvasStyle()},startDrawing:function(t){this.isDrawing=!0,this.setDrawType();var e=[t.offsetX,t.offsetY];this.lastX=e[0],this.lastY=e[1],this.ctx.beginPath(),this.ctx.moveTo(t.offsetX,t.offsetY),this.setInputShowStatus()},saveBackgroundCanvas:function(){try{this.bgCtx.clearRect(0,0,this.canvas2.width,this.canvas2.height),this.bgCtx.fillStyle="black",this.bgCtx.fillRect(0,0,this.canvas2.width,this.canvas2.height),this.bgCtx.drawImage(this.canvas,0,0,this.canvas2.width,this.canvas2.height),this.blankBgCanvas=this.canvas2.toDataURL("image/png",.05)}catch(t){}},setCanvasStyle:function(){var t="ERASER"===this.toolsType?this.eraserSize:this.brushSize,e='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="'.concat(t,'" height="').concat(t,'" viewBox="0 0 ').concat(t," ").concat(t,'">\n    <circle cx="').concat(t/2,'" cy="').concat(t/2,'" r="').concat(t/2,'" fill="purple" fill-opacity="0.5" />\n  </svg>'),n=btoa(e),o="data:image/svg+xml;base64,".concat(n);this.canvasStyle={cursor:"url(".concat(o,") ").concat(t/2," ").concat(t/2,", auto")}},setDrawType:function(){this.ctx&&(this.ctx.strokeStyle=this.brushColor,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.globalCompositeOperation="ERASER"===this.toolsType?"destination-out":"source-over")},initBgCanvas:function(){this.canvas2=this.$refs.canvas2,this.bgCtx=this.canvas2.getContext("2d"),this.bgCtx.fillStyle="black",this.bgCtx.fillRect(0,0,this.canvas2.width,this.canvas2.height)},draw:function(t){if(this.isDrawing){this.ctx.lineWidth="ERASER"===this.toolsType?this.eraserSize:this.brushSize,this.ctx.strokeStyle=this.brushColor,this.ctx.lineTo(t.offsetX,t.offsetY),this.ctx.stroke();var e=[t.offsetX,t.offsetY];this.lastX=e[0],this.lastY=e[1]}},stopDrawing:function(){if(!["eraser"].includes(this.brushType)){this.isDrawing=!1,this.ctx.closePath();try{this.saveDrawingToBase64()}catch(t){}}},saveDrawingToBase64:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=1,t.bgCtx.clearRect(0,0,t.canvas2.width,t.canvas2.height),t.bgCtx.fillRect(0,0,t.canvas2.width,t.canvas2.height),t.bgCtx.drawImage(t.canvas,0,0,t.canvas2.width,t.canvas2.height),n=t.bgCtx.getImageData(0,0,t.canvas2.width,t.canvas2.height),t.bgCtx.putImageData(n,0,0),o=t.canvas2.toDataURL("image/png",.1),t.canvas.toDataURL()!==t.blankCanvas){e.next=12;break}return t.imgUrl="",t.$emit("updateMask",t.imgUrl),e.abrupt("return");case 12:if(o!==t.blankBgCanvas){e.next=16;break}return t.imgUrl="",t.$emit("updateMask",t.imgUrl),e.abrupt("return");case 16:t.imgUrl=o,t.$emit("updateMask",t.imgUrl),e.next=22;break;case 20:e.prev=20,e.t0=e.catch(1);case 22:case"end":return e.stop()}}),e,null,[[1,20]])})))()},setHoverMask:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,r,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!["",null,void 0,-1].includes(t)){n.next=3;break}return e.hoverMaskUrl="",n.abrupt("return");case 3:(o=new Image).src=e.imgSegmentUrlList[t],r=e.borderWidth,c=e.borderColor,o.onload=Object(l.a)(regeneratorRuntime.mark((function t(){var n,l,d,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=e.$refs.segmentCanvas2,(l=n.getContext("2d")).clearRect(0,0,e.sourceInfo.width,e.sourceInfo.height),d=[-1,-1,0,-1,1,-1,-1,0,1,0,-1,1,0,1,1,1],i=0;i<d.length;i+=2)l.drawImage(o,0+d[i]*r,0+d[i+1]*r,e.sourceInfo.width,e.sourceInfo.height);l.globalCompositeOperation="source-in",l.fillStyle=c,l.fillRect(0,0,e.sourceInfo.width,e.sourceInfo.height),l.globalCompositeOperation="source-over",l.drawImage(o,0,0,e.sourceInfo.width,e.sourceInfo.height),e.hoverMaskUrl=n.toDataURL(),l.clearRect(0,0,e.sourceInfo.width,e.sourceInfo.height);case 12:case"end":return t.stop()}}),t)})));case 8:case"end":return n.stop()}}),n)})))()},handleMouseEnter:function(t){this.hasHover=!0,"eraser"!==this.brushType||this.loading||this.imgSegmentUrlList.length||this.getSegmentMaskData()},handleMouseLeave:function(t){this.hoverMaskUrl="",this.hasHover=!1},handleMouseDown:function(t){this.selectRegion(t)},handleMouseMove:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.checkCoordinate(t.offsetX,t.offsetY,e.imagesList);case 2:-1==(o=n.sent)||e.hasHover&&e.setHoverMask(o);case 4:case"end":return n.stop()}}),n)})))()},getSegmentMaskData:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,d,h,v,m,f,pattern;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loading&&!t.imgSegmentUrlList.length){e.next=2;break}return e.abrupt("return");case 2:return t.loading=!0,e.next=5,t.getCacheSegmentMaskData(null==t||null===(n=t.sourceInfo)||void 0===n?void 0:n.imgSrc);case 5:if(!(l=e.sent)||!l.imgSegmentUrlList.length){e.next=12;break}return d=(c=l||{}).imgSegmentUrlList,h=void 0===d?[]:d,v=c.imagesList,m=void 0===v?[]:v,t.imgSegmentUrlList=h,t.imagesList=m,t.loading=!1,e.abrupt("return");case 12:if(f={image_url:t.sourceInfo.imgSrc,width:null==t||null===(o=t.sourceInfo)||void 0===o?void 0:o.realWidth,height:null==t||null===(r=t.sourceInfo)||void 0===r?void 0:r.realHeight},pattern=/^(http|https):\/\//,f.image_url&&pattern.test(null==f?void 0:f.image_url)){e.next=17;break}return t.$message.error("图层图片未成功上传，无法使用此功能"),e.abrupt("return");case 17:Object(Re.b)(f).then((function(e){var n=e.data.id||"";t.list.push({status:1,process:0,id:n})})).catch((function(e){t.loading=!1}));case 18:case"end":return e.stop()}}),e)})))()},initCanvas:function(){var t=arguments,e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var data,o,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return data=t.length>0&&void 0!==t[0]?t[0]:[],e.imgSegmentUrlList=data.map((function(t){return"data:image/png;base64,".concat(t.mask_png)})),n.next=4,e.loadAllMask(e.imgSegmentUrlList);case 4:if(e.imagesList=n.sent,!e.imagesList.length){n.next=13;break}return n.next=8,Ni.a.getItem("editBoardSegmentList");case 8:return o=n.sent,(r=Object.assign({},o||{}))[e.sourceInfo.imgSrc]={imgSegmentUrlList:e.imgSegmentUrlList,imagesList:e.imagesList},n.next=13,Ni.a.setItem("editBoardSegmentList",r);case 13:case"end":return n.stop()}}),n)})))()},loadAllMask:function(){var t=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.sourceInfo||{},n=e.width,o=e.height,r=(source||[]).map((function(t){return new Promise((function(e,n){var img=new Image;img.onload=function(){return e(img)},img.onerror=function(t){return n(t)},img.src=t}))}));return Promise.all(r).then((function(e){for(var r=[],i=0;i<e.length;i++){var img=e[i],l=document.createElement("canvas");l.width=n,l.height=o;var c=l.getContext("2d");c.drawImage(img,0,0,t.sourceInfo.width,t.sourceInfo.height);for(var d=c.getImageData(0,0,t.sourceInfo.width,t.sourceInfo.height),data=d.data,h=0;h<data.length;h+=4)255===data[h]&&255===data[h+1]&&255===data[h+2]||(data[h+3]=0);c.putImageData(d,0,0);var v=l.toDataURL();t.$set(t.imgSegmentUrlList,i,v);var m=c.getImageData(0,0,t.sourceInfo.width,t.sourceInfo.height);r.push(m),l=null,c=null}return r}))},handleLoadMaskData:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";[3,"3"].includes(t)?this.loadJsonFile(e):this.$message.error(this.$t("ServerError"))},loadJsonFile:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return fetch(e).then((function(t){if(!t.ok)throw new Error("Network response was not ok");return t.json()})).then(function(){var e=Object(l.a)(regeneratorRuntime.mark((function e(data){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.initCanvas(null==data?void 0:data.result);case 2:t.loading=!1;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(n){console.error("There has been a problem with your fetch operation:",n),0===t.retryCount?(t.loadJsonFile(e).finally((function(){t.loading=!1})),t.retryCount++):t.$message.error(t.$t("ServerError"))}))},getCacheSegmentMaskData:function(){var t=arguments;return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!["",null,void 0].includes(n=t.length>0&&void 0!==t[0]?t[0]:"")){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,Ni.a.getItem("editBoardSegmentList");case 5:if(!(o=e.sent)||!o[n]){e.next=8;break}return e.abrupt("return",o[n]);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))()},selectRegion:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("点击事件",t.offsetX,t.offsetY),e.setInputShowStatus(),n.next=4,e.checkCoordinate(t.offsetX,t.offsetY,e.imagesList);case 4:-1===(o=n.sent)||e.selectSegmentMask(o);case 6:case"end":return n.stop()}}),n)})))()},selectSegmentMask:function(t){var e=this,n=new Image,canvas=this.$refs.segmentCanvas3,o=canvas.getContext("2d"),r=this.$refs.segmentCanvas2,l=r.getContext("2d"),c=this.sourceInfo,d=c.width,h=c.height,v=c.realWidth,m=c.realHeight,f=this.borderWidth,_=this.borderColor;n.src=this.imgSegmentUrlList[t],n.onload=function(){l.clearRect(0,0,d,h);for(var t=[-1,-1,0,-1,1,-1,-1,0,1,0,-1,1,0,1,1,1],i=0;i<t.length;i+=2)l.drawImage(n,0+t[i]*f,0+t[i+1]*f,d,h);if(l.globalCompositeOperation="source-in",l.fillStyle=_,l.fillRect(0,0,d,h),l.globalCompositeOperation="source-over",l.drawImage(n,0,0,d,h),"eraser"!==(null==e?void 0:e.segmentType)){o.drawImage(r,0,0,d,h),e.maskImg=canvas.toDataURL();var c=document.createElement("canvas"),y=c.getContext("2d");c.width=v,c.height=m,y.drawImage(canvas,0,0,c.width,c.height);var w=c.toDataURL();e.maskImg=w,e.$emit("updateMask",w)}else{var C=r.toDataURL();e.$emit("updateEraserMask",C)}}},checkCoordinate:function(t,e,n){var o=this;return Object(l.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",o.detectClickedImage(t,e,n));case 1:case"end":return r.stop()}}),r)})))()},checkPixelTransparency:function(t,e,n){return 0!==t.data[4*(e+n*t.width)+3]},detectClickedImage:function(t,e,n){n.width,n.height,n.data;for(var i=n.length-1;i>=0;i--){var o=n[i],r=t-0,l=e-0;if(r>=0&&l>=0&&r<o.width&&l<o.height&&this.checkPixelTransparency(o,r,l))return i}},setInputShowStatus:function(){var t=this,e=-1,n=this.top.paintingBoardData.elementList.map((function(em,n){var mask=em.mask||"";return em.layerId===t.sourceInfo.layerId&&(e=n),em.layerId!==t.sourceInfo.layerId&&(mask=""),Gi(Gi({},em),{},{hasEraserDraw:!1,mask:mask})}));n[e].hasEraserDraw=!0,this.top.changeData("elementList",n)}}},Ji=Yi,Ki=(n(2840),Object(_.a)(Ji,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"c-image-redraw-tools"},[e("div",{directives:[{name:"show",rawName:"v-show",value:["brush"].includes(t.brushType),expression:"['brush'].includes(brushType)"}]},[e("canvas",{ref:"canvas",staticClass:"generate-mode-redraw-canvas",style:t.canvasStyle,attrs:{"data-drag":"no",width:t.sourceInfo.width,height:t.sourceInfo.height}}),t._v(" "),e("canvas",{ref:"canvas2",staticStyle:{display:"none"},attrs:{width:t.sourceInfo.realWidth,height:t.sourceInfo.realHeight}})]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:["eraser"].includes(t.brushType),expression:"['eraser'].includes(brushType)"}]},[e("canvas",{ref:"segmentCanvas",staticClass:"segment-cmp-canvas",attrs:{width:t.sourceInfo.width,height:t.sourceInfo.height},on:{mouseenter:t.handleMouseEnter,mouseleave:t.handleMouseLeave,mousemove:t.debounceHandleMouseMove,mousedown:t.selectRegion}}),t._v(" "),e("canvas",{ref:"segmentCanvas2",staticClass:"segment-cmp-canvas",staticStyle:{display:"none"},attrs:{width:t.sourceInfo.width,height:t.sourceInfo.height}}),t._v(" "),e("canvas",{ref:"segmentCanvas3",staticClass:"segment-cmp-canvas",staticStyle:{display:"none"},attrs:{width:t.sourceInfo.width,height:t.sourceInfo.height}}),t._v(" "),t.hoverMaskUrl?e("img",{staticClass:"segment-image-draw-img-hover-mask",style:{width:"".concat(t.sourceInfo.width,"px"),height:"".concat(t.sourceInfo.height,"px")},attrs:{src:t.hoverMaskUrl,alt:""}}):t._e(),t._v(" "),e("svg",{staticClass:"segment-cmp-svg",staticStyle:{filter:"opacity(60%) brightness(0) saturate(100%) invert(14%) sepia(81%) saturate(6216%) hue-rotate(352deg) brightness(91%) contrast(118%)"}},[e("g",{staticClass:"segment-cmp-g"},[e("image",{style:{width:"".concat(t.sourceInfo.width,"px"),height:"".concat(t.sourceInfo.height,"px")},attrs:{href:t.maskImg}}),t._v(" "),e("clipPath",[e("rect",{attrs:{x:"0",y:"0",width:t.sourceInfo.width,height:t.sourceInfo.height}})])])])])])}),[],!1,null,"3479f09f",null).exports),Xi=n(2841),Qi={inject:["top"],components:{SpinLoading:n(1923).a},props:{mode:{type:String,default:"normal"}},computed:{zoomv:function(){var t=this.mode;return"live"===t?2:"normal"===t?1/this.top.paintingBoardData.boardInfo.zoom:"no"===t?1:void 0}},data:function(){return{}}},Zi=(n(2843),Object(_.a)(Qi,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"ai-loading-box flex_c_m"},[e("div",{staticClass:"loading-content",style:{transform:"scale(".concat(t.zoomv,")")}},[e("div",{staticClass:"spin-icon"},[e("spin-loading")],1),t._v(" "),"start"===t.top.processStep.step?[e("p",{staticClass:"text-str"},[t._v(t._s(t.$t(t.top.processStep.text))+"...")])]:[e("p",{staticClass:"text-str"},[t._v(t._s(t.top.processStep.process)+"%")])]],2)])}),[],!1,null,"d573285e",null).exports);function tn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function en(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tn(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var nn={inject:["top"],components:{openPoseEditor:Me,ImgMoveMack:Di,EraserBottons:ji,generateModeRedraw:Ri,segmentCmp:Wi,imageRedrawTools:Ki,AiLoading:Zi},props:{item:{type:Object,default:function(){return{}}},comKey:{type:String,default:""}},data:function(){return{tipsVal:"",canvas:null,uploading:!1,UPLOAD:null,loopInterval:null,base64Pattern:/^data:image\/\w+;base64,/}},watch:{"top.paintingBoardData.topNav.tools":{handler:function(t,pre){var e=this;(null==t?void 0:t.hasAct)!==(null==pre?void 0:pre.hasAct)&&this.resetDrawStatus(),this.canvas?this.brushDraw():this.initBoard(this.item),"brushImg"!==t.hasAct&&"daubBoard"!==t.hasAct||this.$nextTick((function(){var t=e.top.paintingBoardData.boardInfo.zoom;e.setTipSize(t)}))},deep:!0},"top.paintingBoardData.boardInfo.zoom":{handler:function(t){this.setTipSize(t)}},"top.paintingBoardData.liveModel.show":{handler:function(t){var e=t?34:33;this.UPLOAD=new w.a({type:e})},immediate:!0},"item.imgSrc":function(t,e){null!=e&&e.includes("data:image/")||this.initImg(t)},"item.flipHorizontal":{handler:function(t){var e=this;this.$nextTick((function(){e.flipHorizontalFn(t)}))},immediate:!0},"item.flipVertical":{handler:function(t){var e=this;this.$nextTick((function(){e.flipVerticalFn(t)}))},immediate:!0},"item.rotate":{handler:function(t){var e=this;this.$nextTick((function(){e.handleRotate(t)}))},immediate:!0},"item.opacity":function(t){this.filterColor({type:"opacity",val:t})},"item.hue":function(t){this.filterColor({type:"hue",val:t})},"item.saturation":function(t){this.filterColor({type:"saturation",val:t})},"item.brightness":function(t){this.filterColor({type:"brightness",val:t})},"item.clipPath":{handler:function(t){var e=this;this.$nextTick((function(){e.handleClip(t)}))},immediate:!0},"item.matrix3d":{handler:function(t){var e=this;this.$nextTick((function(){e.handleFreeDeformation(t)}))},immediate:!0}},computed:{showInputArea:function(){return[["brushImg"].includes(this.top.paintingBoardData.topNav.tools.hasAct)&&this.item.hasDrawLine,["daubBoard"].includes(this.top.paintingBoardData.topNav.tools.hasAct)&&this.item.hasRedraw].some((function(t){return t}))},showImageCanvas:function(){return["imgLayer","brushLayer","controlNetLayer"].includes(this.item.type)},showGenerateModeRedraw:function(){return["imgLayer","controlNetLayer"].includes(this.item.type)&&"daubBoard"===this.top.paintingBoardData.topNav.tools.hasAct&&!this.showOpenPose&&!this.isLiveMode},redrawBoardType:function(){return{eraser:"ERASER",brush:"PEN",segment:"SEGMENT"}[this.top.paintingBoardData.topNav.tools.daubTool.redrawBoard.hasAct]||""},showEraserSegment:function(){this.top.paintingBoardData.topNav.tools.eraserTool;var t=this.top.paintingBoardData.topNav.tools.hasAct,e=["imgLayer"].includes(this.item.type),n=["eraserBoard","eraserAiBoard"].includes(t);return e&&n},showEraserSegmentCmp:function(){var t,e=this.top.paintingBoardData.topNav.tools.eraserTool;return"eraser"===(null==e||null===(t=e.eraserBoard)||void 0===t?void 0:t.hasAct)},showEraserClear:function(){var t=this.top.paintingBoardData.topNav.tools.hasAct,e=["imgLayer"].includes(this.item.type),n=["eraserAiBoard"].includes(t);return e&&n},eraserClearBrush:function(){var t=this.top.paintingBoardData.topNav.tools.eraserTool.eraserAiBoard.wide;return isNaN(t/4)?100:t/4},eraserClearBrushType:function(){return this.top.paintingBoardData.topNav.tools.eraserTool.eraserAiBoard.hasAct},isLiveMode:function(){return this.top.paintingBoardData.liveModel.show},showOpenPose:function(){var t;return["controlNetLayer"].includes(this.item.type)&&[8,"8"].includes(null===(t=this.getControlNetInfo)||void 0===t?void 0:t.module)},getControlNetInfo:function(){var t=this.item.controlNetId||"";return this.top.paintingBoardData.controlNet.controlnet_units.find((function(e){return e.id===t}))},getImageInfo:function(){var t=this.getContainedSize({width:this.item.width,height:this.item.height,naturalWidth:this.item.realWidth,naturalHeight:this.item.realHeight});return{width:t.width,height:t.height,rawWidth:this.item.realWidth,rawHeight:this.item.realHeight}},showDrawTips:function(){var t="imgLayer"===this.item.type,e=["daubBoard","brushImg"].includes(this.top.paintingBoardData.topNav.tools.hasAct);return t&&e},showBrushCanvas:function(){var t="imgLayer"===this.item.type,e="brushImg"===this.top.paintingBoardData.topNav.tools.hasAct;return t&&e},eleIndex:function(){var t,e=this;return(null===(t=this.top.paintingBoardData)||void 0===t||null===(t=t.elementList)||void 0===t?void 0:t.findIndex((function(t){return t.layerId==e.item.layerId})))||0},layerItem:function(){var t;return null===(t=this.top.paintingBoardData)||void 0===t?void 0:t.elementList[this.eleIndex]},loading:function(){return this.uploading||this.layerItem.loading},getActiveList:function(){return this.top.paintingBoardData.elementList.filter((function(t){return t.active}))||[]},isClip:function(){var t;return!!(null!==(t=this.item)&&void 0!==t&&t.clipPath?this.item.clipPath.match(/-?\d+(\.\d+)?/g).map(Number):[]).find((function(t){return t}))},process:function(){var t=this.layerItem.process;return t?t+"%":""},isGenerate:function(){var t=this.layerItem,e=t.loading,n=t.imgSrc;return e&&n.includes("https://")}},mounted:function(){var t=this,e=this.item,n=this.top.paintingBoardData.boardInfo.zoom;e&&this.showImageCanvas&&this.$nextTick((function(){t.initBoard(e),t.setTipSize(n)})),this.$EventBus.$on("stepUpdate",(function(){t.initLayerPoin(),t.initLayerZoom(),t.filterColor()})),this.filterColor()},beforeDestroy:function(){this.$EventBus.$off("stepUpdate"),clearInterval(this.loopInterval),this.loopInterval=null},methods:{resetDrawStatus:function(){var t=this,e=this.top.paintingBoardData.elementList.map((function(em,e){return em.layerId===t.item.layerId&&e,en(en({},em),{},{hasRedraw:!1,hasDrawLine:!1,hasEraserDraw:!1,mask:""})}));this.top.changeData("elementList",e)},getContainedSize:function(img){try{var t=img.naturalWidth/img.naturalHeight,e=img.height*t,n=img.height;return e>img.width&&(e=img.width,n=img.width/t),{width:e,height:n}}catch(t){}},initBoard:function(t){this.canvas=new Ve.fabric.Canvas(t.layerId,{width:t.width,height:t.height,selectable:!1,selection:!1,crossOrigin:"anonymous"}),this.initEraser(),this.initLayerPoin(),this.initLayerZoom()},initImg:function(t){var canvas=this.canvas,e=this.item,n=e.width,o=e.height;canvas.clear(),canvas.setDimensions({width:n,height:o}),Ve.fabric.Image.fromURL(t,(function(img){img.scaleToWidth(canvas.width),img.scaleToHeight(canvas.height),img.set({left:0,top:0,selectable:!1}),canvas.add(img),canvas.renderAll()}),{crossOrigin:""})},filterColor:function(){var t=this.item.layerId,e=document.querySelector("#"+t),style=Object(Xi.a)(this.item);e.style.filter=style},hdInit:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.top.getEleInfo(this.item.layerId),n=t.img_uris[0],o=n.url,r=n.width,l=n.height,c=en(en({},e),{},{imgSrc:o,realWidth:r,realHeight:l});this.top.changeData("elementList[".concat(this.eleIndex,"]"),c)},removeBginit:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},canvas=this.canvas,n=e.img_uris[0],o=n.url,r=n.width,l=n.height,c=600,d=l/(r/600),h=en(en({},this.top.getEleInfo(this.item.layerId)),{},{imgSrc:o,width:c,height:d,renderWidth:c,renderHeight:d,realWidth:r,realHeight:l});Ve.fabric.Image.fromURL(o,(function(img){img.scaleToWidth(c),img.scaleToHeight(d),canvas.setBackgroundImage(img,canvas.renderAll.bind(canvas)),canvas.setDimensions({width:c,height:d}),t.top.changeData("elementList[".concat(t.eleIndex,"]"),h),t.top.initLayerActive(!0)}))},updateOnEraser:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.top.getEleInfo(this.item.layerId),n=t.url,o=t.width,r=t.height,l=en(en({},e),{},{url:n,realWidth:o,realHeight:r,loading:!1,mask:""});this.top.changeData("elementList[".concat(this.eleIndex,"]"),l),this.initImg(n)},initEraser:function(){var t=this,canvas=this.canvas,e=this.item;e.canvasJson&&Object.keys(e.canvasJson).length?canvas.loadFromJSON(e.canvasJson,(function(){canvas.forEachObject((function(t){t.selectable=!1})),canvas.renderAll(),t.initImg(e.imgSrc)})):(this.initImg(e.imgSrc),this.brushDraw())},initLayerPoin:function(){var em=this.item,style="translate(".concat(em.x,"px, ").concat(em.y,"px)"),t=document.querySelector("#img-"+em.layerId);if(t){var e=t.style.transform.replace(/translate[XYZ3d]*\([^)]+\)\s*/g,"");t.style.transform=style+e}},initLayerZoom:function(){var t=this.item,e=t.layerId,n=t.zoom,o=Array.isArray(n)?n:[n,n],style="scale(".concat(o[0]||1,", ").concat(o[1]||1,")"),r=document.querySelector("#img-"+e);if(r){var l=r.style.transform.replace(/scale[XYZ3d]*\([^)]+\)\s*/g,"");r.style.transform=l+style}},brushDraw:function(){var t=this,e=this.top.paintingBoardData.topNav.tools,n=e.eraserTool.eraserBoard,o=e.brushTool.brushBoard,canvas=this.canvas,r="eraser"===e.brushTool.brushBoard.hasAct;"eraserBoard"===e.hasAct&&(canvas.isDrawingMode="imgLayer"===this.item.type),"brushBoard"===e.hasAct&&r&&(canvas.isDrawingMode="brushLayer"===this.item.type),"eraserBoard"===e.hasAct||"brushBoard"===e.hasAct&&r?(canvas.freeDrawingBrush.color="#000","eraserBoard"===e.hasAct&&(canvas.freeDrawingBrush.width=n.wide/10),"brushBoard"===e.hasAct&&r&&(canvas.freeDrawingBrush.width=o.wide/10),"brush"===n.hasAct||"brush"===o.hasAct?canvas.on("path:created",(function(t){t.path.globalCompositeOperation="destination-out"})):(canvas.isDrawingMode=!1,canvas.globalCompositeOperation="source-over")):canvas.isDrawingMode=!1,canvas.selection=!1,canvas.forEachObject((function(t){t.selectable=!1,t.lockUniScaling=!0,t.lockRotation=!0})),canvas.on("after:render",(function(){var e=canvas.toJSON(),n=t.getElementIndex();t.top.changeData("elementList[".concat(n,"].canvasJson"),e)}))},getElementIndex:function(){var t=this.item.layerId;return this.top.paintingBoardData.elementList.findIndex((function(e){return e.layerId===t}))},clickItem:function(t){this.$emit("onClick",{item:t})},topBtnsClick:function(t,e){var n=this;return Object(l.a)(regeneratorRuntime.mark((function o(){var r,l;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:r=n.item.imgSrc,o.t0=t,o.next="download"===o.t0?4:"removeBg"===o.t0?6:"imgToImg"===o.t0?8:"del"===o.t0?16:"clip"===o.t0?18:"more"===o.t0?20:22;break;case 4:return n.handleDownload(),o.abrupt("break",23);case 6:return n.handleRemoveBg(),o.abrupt("break",23);case 8:if(l=r,!n.isClip){o.next=13;break}return o.next=12,Object(ht.m)(r,n.item);case 12:l=o.sent;case 13:return n.top.changeLeftMenu("Generate"),n.top.changeData("imageToImage.imgUrl",l),o.abrupt("break",23);case 16:return n.delLayer(),o.abrupt("break",23);case 18:return n.toggleCropping(),o.abrupt("break",23);case 20:return n.showMore(e),o.abrupt("break",23);case 22:return o.abrupt("break",23);case 23:n.$logEvent("log_actions",{operation:"click_".concat(t,"_image_operation"),behavior_info:"on_canvas_detail_page"});case 24:case"end":return o.stop()}}),o)})))()},handleRemoveBg:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.top.token){e.next=2;break}return e.abrupt("return",t.$EventBus.$emit("openLoginDialog",{callBack:function(){window.location.reload()}}));case 2:if(n=t.top.getEleInfo(t.item.layerId,"imgSrc"),t.uploading=!0,!t.base64Pattern.test(n)){e.next=17;break}return o=Object(bt.c)(n,t.item.layerId),e.prev=6,e.next=9,t.UPLOAD.startUpload(o);case 9:r=e.sent,n=r||"",e.next=17;break;case 13:e.prev=13,e.t0=e.catch(6),console.log("error",e.t0),t.uploading=!1;case 17:t.top.processStep={step:"start",process:0,text:"TaskStatusPreparing"},Object(Q.r)({image_url:n,mode:1}).then((function(e){var n=e.data.id;n&&t.loopGetResult(n,"removeBg")}));case 19:case"end":return e.stop()}}),e,null,[[6,13]])})))()},delLayer:function(){var t=this,e=this.top.paintingBoardData.elementList.filter((function(e){return e.z>1e4&&e.active&&t.top.changeData("liveModel.productLayerId",null),!1===e.active}));this.top.changeData("elementList",e)},showMore:function(t){this.$emit("showRightMenu",t,"more")},closeRightMenu:function(){this.$emit("closeRightMenu")},toggleCropping:function(){var t=this,e=this.top.paintingBoardData.elementList,n=e.findIndex((function(e){return e.layerId===t.item.layerId})),o=e[n].cropping;this.top.changeData("elementList[".concat(n,"].cropping"),!o)},rightMenuClick:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,d,h,v,m,f,_,y,param;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=e.item,r=o.imgSrc,l=o.layerId,c=o.freeDeformation,d=o.flipHorizontal,h=o.flipVertical,v=o.rotate,n.t0=t,n.next="saveToMyGallery"===n.t0?4:"upscale"===n.t0?11:"toTop"===n.t0?13:"toBottom"===n.t0?15:"moveUp"===n.t0?17:"moveDown"===n.t0?19:"lockImage"===n.t0?21:"unlockImage"===n.t0?23:"freeDeformation"===n.t0?25:"horizontalFlip"===n.t0?27:"verticalFlip"===n.t0?29:"clockwise90Deg"===n.t0?31:"counterclockwise90Deg"===n.t0?34:"restoreFaces"===n.t0?37:"copy"===n.t0?39:"download"===n.t0?43:"publish"===n.t0?45:47;break;case 4:if(m=r,!e.isClip){n.next=9;break}return n.next=8,Object(ht.m)(r,e.item);case 8:m=n.sent;case 9:return e.handleSaveMaterial(m,l),n.abrupt("break",48);case 11:return e.handleUpscale(r,l),n.abrupt("break",48);case 13:return e.handleLayer("top"),n.abrupt("break",48);case 15:return e.handleLayer("bottom"),n.abrupt("break",48);case 17:return e.handleLayer("up"),n.abrupt("break",48);case 19:return e.handleLayer("down"),n.abrupt("break",48);case 21:return e.top.changeData("elementList[".concat(e.eleIndex,"].lock"),!0),n.abrupt("break",48);case 23:return e.top.changeData("elementList[".concat(e.eleIndex,"].lock"),!1),n.abrupt("break",48);case 25:return e.top.changeData("elementList[".concat(e.eleIndex,"].freeDeformation"),!c),n.abrupt("break",48);case 27:return e.top.changeData("elementList[".concat(e.eleIndex,"].flipHorizontal"),!d),n.abrupt("break",48);case 29:return e.top.changeData("elementList[".concat(e.eleIndex,"].flipVertical"),!h),n.abrupt("break",48);case 31:return f=v+90,e.top.changeData("elementList[".concat(e.eleIndex,"].rotate"),f),n.abrupt("break",48);case 34:return _=v-90,e.top.changeData("elementList[".concat(e.eleIndex,"].rotate"),_),n.abrupt("break",48);case 37:return e.handleRestoreFaces(r,l),n.abrupt("break",48);case 39:return y=e.top.paintingBoardData.liveModel.show,param=en(en({type:y?"liveImgLayer":"imgLayer"},e.item),{},{x:e.item.x-10,y:e.item.y+10}),e.top.addLayerItem(param),n.abrupt("break",48);case 43:return e.handleDownload(),n.abrupt("break",48);case 45:return e.top.publishPop({width:e.item.realWidth,height:e.item.realHeight,url:e.item.imgSrc,task_id:e.item.params.taskId}),n.abrupt("break",48);case 47:return n.abrupt("break",48);case 48:e.$logEvent("log_actions",{operation:"click_".concat(t,"_image_operation"),behavior_info:"on_canvas_detail_page"}),!["adjustOrder","transformTool"].includes(t)&&e.closeRightMenu();case 50:case"end":return n.stop()}}),n)})))()},handleLayer:function(t){var e=this.top.paintingBoardData.elementList,n=e.map((function(t){return t.z})),r=Math.max.apply(Math,Object(o.a)(n)),l=Math.min.apply(Math,Object(o.a)(n)),c=this.top.getEleInfo(this.item.layerId,"z"),d=0;switch(t){case"top":this.top.changeData("elementList[".concat(this.eleIndex,"].z"),r+1);break;case"bottom":this.top.changeData("elementList[".concat(this.eleIndex,"].z"),l-1);break;case"up":if(d=(n=n.sort((function(a,b){return a-b}))).findIndex((function(t){return t==c})),c!=r){var h=n[d+1],v=e.findIndex((function(t){return t.z===h}));this.top.changeData("elementList[".concat(this.eleIndex,"].z"),h),this.top.changeData("elementList[".concat(v,"].z"),c)}break;case"down":if(d=(n=n.sort((function(a,b){return a-b}))).findIndex((function(t){return t==c})),c!=l){var m=n[d-1],f=e.findIndex((function(t){return t.z===m}));this.top.changeData("elementList[".concat(this.eleIndex,"].z"),m),this.top.changeData("elementList[".concat(f,"].z"),c)}}},handleRestoreFaces:function(t,e){var n=this;return Object(l.a)(regeneratorRuntime.mark((function o(){var r,l,c;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(r=t,n.uploading=!0,!n.base64Pattern.test(r)){o.next=15;break}return l=Object(bt.c)(r,e),o.prev=4,o.next=7,n.UPLOAD.startUpload(l);case 7:c=o.sent,r=c||"",o.next=15;break;case 11:o.prev=11,o.t0=o.catch(4),console.log("error",o.t0),n.uploading=!1;case 15:n.top.processStep={step:"start",process:0,text:"TaskStatusPreparing"},Object(Q.s)({image_url:r}).then((function(t){var e=t.data.id;e&&n.loopGetResult(e,"restoreFaces")}));case 17:case"end":return o.stop()}}),o,null,[[4,11]])})))()},handleUpscale:function(t,e){var n=this;return Object(l.a)(regeneratorRuntime.mark((function o(){var r,l,c,d,h,v,img;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(r=n.item,l=r.realHeight,c=r.realWidth,!(l>3072||c>3072)){o.next=4;break}return n.$message.warning(n.$t("ImageTooLarge")),o.abrupt("return");case 4:if(d=t,n.uploading=!0,!n.base64Pattern.test(t)){o.next=19;break}return h=Object(bt.c)(t,e),o.prev=8,o.next=11,n.UPLOAD.startUpload(h);case 11:v=o.sent,d=v||"",o.next=19;break;case 15:o.prev=15,o.t0=o.catch(8),console.log("error",o.t0),n.uploading=!1;case 19:(img=new Image).src=d,n.top.processStep={step:"start",process:0,text:"TaskStatusPreparing"},img.onload=function(){var t=img.width,e=img.height;Object(Q.q)({image_url:d,mode:1,width:t,height:e}).then((function(t){var e=t.data.id;e&&n.loopGetResult(e,"hd")})).catch((function(t){console.log("err",t),n.uploading=!1}))};case 23:case"end":return o.stop()}}),o,null,[[8,15]])})))()},loopGetResult:function(t,e){var n=this;this.loopInterval=setInterval(Object(l.a)(regeneratorRuntime.mark((function o(){var r,l,c,d,h,m,f,_;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,Object(v.a)({scene:1,task_ids:[t]});case 3:if(l=o.sent,null!=(c=l.data.items)&&c[0]){o.next=7;break}return o.abrupt("return");case 7:d=c[0],h=d.status_desc,m=d.img_uris,f=d.process,_=(null==m||null===(r=m[0])||void 0===r?void 0:r.url)||"",o.t0=h,o.next="finish"===o.t0?12:"sysCancelDesc"===o.t0?19:"sysTimeoutDesc"===o.t0?24:"processing"===o.t0?29:31;break;case 12:return"restoreFaces"==e&&n.top.changeData("elementList[".concat(n.eleIndex,"].imgSrc"),_),"hd"==e&&n.hdInit(c[0]),"removeBg"==e&&n.removeBginit(c[0]),clearInterval(n.loopInterval),n.uploading=!1,n.top.processStep={step:"end",process:f,text:"TaskStatusPreparing"},o.abrupt("break",32);case 19:return clearInterval(n.loopInterval),n.$message.warning(n.$t("systemCancel")),n.uploading=!1,n.top.processStep={step:"end",process:f,text:"TaskStatusPreparing"},o.abrupt("break",32);case 24:return clearInterval(n.loopInterval),n.$message.warning(n.$t("systemTimeoutCancel")),n.uploading=!1,n.top.processStep={step:"end",process:f,text:"TaskStatusPreparing"},o.abrupt("break",32);case 29:return n.top.processStep={step:"ing",process:f,text:"TaskStatusPreparing"},o.abrupt("break",32);case 31:return o.abrupt("break",32);case 32:o.next=40;break;case 34:o.prev=34,o.t1=o.catch(0),console.log("error",o.t1),clearInterval(n.loopInterval),n.top.processStep={step:"end",process:0,text:"TaskStatusPreparing"},n.uploading=!1;case 40:case"end":return o.stop()}}),o,null,[[0,34]])}))),3e3)},handleSaveMaterial:function(t,e){var n=this;return Object(l.a)(regeneratorRuntime.mark((function o(){var r,l,c;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(r=t,!n.base64Pattern.test(t)){o.next=16;break}return l=Object(bt.c)(t,e),o.prev=3,n.uploading=!0,o.next=7,n.UPLOAD.startUpload(l);case 7:c=o.sent,r=c||"",n.uploading=!1,o.next=16;break;case 12:o.prev=12,o.t0=o.catch(3),n.uploading=!1,console.log("error",o.t0);case 16:Object(Q.I)({items:[{category:"mine",image:r,name:""}]}).then((function(t){n.$message.success(n.$t("SaveSuccess")),n.$EventBus.$emit("updateMine"),setTimeout((function(){n.top.changeLeftMenu("Mine")}),100)}));case 17:case"end":return o.stop()}}),o,null,[[3,12]])})))()},handleUpdateMask:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.top.paintingBoardData.elementList.findIndex((function(e){return e.layerId===t.item.layerId}));-1!==n&&this.top.changeData("elementList[".concat(n,"].mask"),e)},handleEraserClearMaskUrl:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.top.paintingBoardData.elementList.findIndex((function(e){return e.layerId===t.item.layerId}));-1!==n&&this.top.changeData("elementList[".concat(n,"].mask"),e)},handleUpdateEraserMask:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";["",null,void 0].includes(t)||this.clearMaskContent(t)},clearMaskContent:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",canvas=this.canvas;Ve.fabric.Image.fromURL(t,(function(img){img.scaleToWidth(canvas.width),img.scaleToHeight(canvas.height),img.globalCompositeOperation="destination-out",canvas.add(img),canvas.renderAll(),img.on("rendered",(function(){canvas.remove(img)}))}),{})},handleMixGenerateMask:function(){},handleDownload:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.item,o=n.imgSrc,r=n.layerId,e.next=3,t.handleDownloadUrl(o,r);case 3:o=e.sent,t.base64Pattern.test(o)?Object(bt.f)(o,r):t.downloadCdnUrl(o,r);case 5:case"end":return e.stop()}}),e)})))()},handleDownloadUrl:function(t,e){var n=this,o=this.item,r=o.flipHorizontal,c=o.flipVertical,d=o.rotate,h=o.hue,v=o.saturation,m=o.brightness,f=document.querySelector("#"+e);return r||c||d%360!=0||this.isClip||0!==h||0!==v||0!==m?new Promise((function(e){var img=new Image;img.crossOrigin="Anonymous",img.src=t,img.onload=Object(l.a)(regeneratorRuntime.mark((function o(){var canvas,l,h,v,m,_;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(canvas=document.createElement("canvas"),l=canvas.getContext("2d"),canvas.width=img.width,canvas.height=img.height,l.filter=window.getComputedStyle(f).filter||"",l.drawImage(img,0,0),(r||c)&&(h=r?-1:1,v=c?-1:1,m=r?img.width:0,_=c?img.height:0,l.translate(m,_),l.scale(h,v),l.drawImage(img,0,0)),d%360!=0&&n.rotateImage(img,canvas,l,d),t=canvas.toDataURL(),!n.isClip){o.next=13;break}return o.next=12,Object(ht.m)(t,n.item);case 12:t=o.sent;case 13:e(t);case 14:case"end":return o.stop()}}),o)})))})):t},rotateImage:function(t,canvas,e,n){var o=n*Math.PI/180,r=Math.sin(o),l=Math.cos(o),c=t.naturalWidth,d=t.naturalHeight;canvas.width=Math.abs(l)*c+Math.abs(r)*d,canvas.height=Math.abs(r)*c+Math.abs(l)*d,e.translate(canvas.width/2,canvas.height/2),e.rotate(o),e.drawImage(t,-c/2,-d/2,c,d)},downloadCdnUrl:function(t,e){var img=new Image;img.crossOrigin="anonymous",img.src=t,img.onload=function(){var canvas=document.createElement("canvas");canvas.width=img.width,canvas.height=img.height,canvas.getContext("2d").drawImage(img,0,0);var t=canvas.toDataURL("image/png"),n=document.createElement("a");n.href=t,n.download="".concat(e,".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}},updateControlNetConfig:function(){if("controlNetLayer"===this.item.type)(this.item||{}).controlNetId},getDrawImg:function(t){var e=this;this.$nextTick((function(){var n,o=null===(n=e.$refs)||void 0===n||null===(n=n.imgMoveMackRef)||void 0===n?void 0:n.brushCanvas,r=e.canvas.toDataURL("image/jpeg"),l=null==o?void 0:o.toDataURL("image/jpeg"),canvas=document.createElement("canvas"),c=canvas.getContext("2d"),d=new Image,h=new Image;d.src=r,h.src=l,d.onload=function(){canvas.width=d.width,canvas.height=d.height,c.drawImage(d,0,0),o?h.onload=function(){c.drawImage(h,0,0);var n=canvas.toDataURL("image/jpeg");t&&t(e.showGenerateModeRedraw?r:n)}:t&&t(r)}}))},tipsSubmit:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(o=e.top.paintingBoardData.elementList[e.eleIndex]).loading){n.next=3;break}return n.abrupt("return");case 3:if(o.loading=!0,o.prompt=t||e.tipsVal,e.isLiveMode||!e.showGenerateModeRedraw){n.next=9;break}return o.cutUrl=o.imgSrc,e.top.generateTask("generate",o,(function(img){o.imgSrc=img[0].url,o.mask=""}),"layerRedraw"),n.abrupt("return");case 9:e.getDrawImg(function(){var t=Object(l.a)(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(ht.s)(n);case 2:r=t.sent,o.cutUrl=r,e.top.generateTask("generate",o,(function(img){o.imgSrc=img[0].url}));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 10:case"end":return n.stop()}}),n)})))()},flipHorizontalFn:function(t){var e=document.querySelector("#css-".concat(this.item.layerId)),n=e.style.transform.replace("scaleX(-1)","").replace("scaleX(1)","");e.style.cssText+="transform: ".concat(n," scaleX(").concat(t?"-1":"1",")")},flipVerticalFn:function(t){var e=document.querySelector("#css-".concat(this.item.layerId)),n=e.style.transform.replace("scaleY(-1)","").replace("scaleY(1)","");e.style.cssText+="transform: ".concat(n," scaleY(").concat(t?"-1":"1",")")},handleRotate:function(t){var e=document.querySelector("#img-".concat(this.item.layerId)),n=e.style.transform.replace(/rotate\([-+]?\d+(\.\d+)?deg\)/g,"");e.style.transform="".concat(n," rotate(").concat(t,"deg)"),this.top.changeData("elementList[".concat(this.eleIndex,"].active"),!1)},handleClip:function(t){document.querySelector("#img-".concat(this.item.layerId)).style.clipPath=t},handleFreeDeformation:function(t){var e=document.querySelector("#img-".concat(this.item.layerId)),n=e.style.transform.replace(/matrix3d\((.*?)\)/,"");e.style.transform="".concat(n," matrix3d(").concat(t,")")},setTipSize:function(t){var e=380,n=160,o=document.querySelector("#drawimg-".concat(this.item.layerId)),r=1/t;if(o){if(o.style.transform="scale(".concat(r,")"),1===t)return o.style.left="".concat(0,"px"),void(o.style.top="calc(100% + 10px)");if(t<1){var l=(e*r-e)/2,c=this.item.height+10*r+(n*r-n)/2;o.style.left="".concat(Math.abs(l),"px"),o.style.top="".concat(c,"px")}else{var d=(e-e*r)/2,h=this.item.height+10*r-(n-n*r)/2;o.style.left="".concat(-d,"px"),o.style.top="".concat(h,"px")}}}}},an=nn,on=(n(2844),Object(_.a)(an,(function(){var t,e,n,o=this,r=o._self._c;return o.showImageCanvas?r("div",{staticClass:"bel-item img-move-page",class:[o.showOpenPose&&"no-snapshot"],style:{zIndex:o.item.z,width:o.item.width+"px",height:o.item.height+"px"},attrs:{id:"img-".concat(o.item.layerId),"data-id":o.item.layerId},on:{click:function(t){return o.clickItem(o.item)}}},[r("div",{staticClass:"img-content-box",style:{width:o.item.width+"px",height:o.item.height+"px"},attrs:{"data-drag":"no",id:"css-".concat(o.item.layerId)}},[o.showOpenPose?r("open-pose-editor",{attrs:{uniqueId:o.item.layerId,"img-info":o.getImageInfo,"source-info":o.getControlNetInfo}}):o._e(),o._v(" "),r("canvas",{directives:[{name:"show",rawName:"v-show",value:!o.showOpenPose,expression:"!showOpenPose"}],staticClass:"base-canvas",attrs:{"data-drag":"no",id:o.item.layerId}}),o._v(" "),o.showBrushCanvas?r("img-move-mack",{directives:[{name:"show",rawName:"v-show",value:!o.showOpenPose,expression:"!showOpenPose"}],ref:"imgMoveMackRef",staticClass:"mack-canvas",attrs:{item:o.item}}):o._e(),o._v(" "),o.showGenerateModeRedraw?[r("generate-mode-redraw",{directives:[{name:"show",rawName:"v-show",value:["ERASER","PEN"].includes(o.redrawBoardType),expression:"\n\t\t\t\t\t\t['ERASER', 'PEN'].includes(redrawBoardType)\n\t\t\t\t\t"}],staticClass:"mack-canvas",attrs:{"source-info":o.item},on:{updateMask:function(t){return o.handleUpdateMask(t,"redraw")}}}),o._v(" "),r("segment-cmp",{directives:[{name:"show",rawName:"v-show",value:"SEGMENT"===o.redrawBoardType,expression:"redrawBoardType === 'SEGMENT'"}],key:"redrawSegment_".concat(null===(t=o.item)||void 0===t?void 0:t.layerId),attrs:{"auto-style":o.item,"source-info":o.item},on:{updateMask:function(t){return o.handleUpdateMask(t,"segment")}}})]:o._e(),o._v(" "),o.showEraserSegment?[r("segment-cmp",{directives:[{name:"show",rawName:"v-show",value:o.showEraserSegmentCmp,expression:"showEraserSegmentCmp"}],key:"eraserSegment_".concat(null===(e=o.item)||void 0===e?void 0:e.layerId),attrs:{"auto-style":o.item,"source-info":o.item,"segment-type":"eraser"},on:{updateEraserMask:function(t){return o.handleUpdateEraserMask(t,"eraser")}}})]:o._e(),o._v(" "),o.showEraserClear?[r("image-redraw-tools",{key:"eraserAutoClear_".concat(null===(n=o.item)||void 0===n?void 0:n.layerId),attrs:{"eraser-size":o.eraserClearBrush,"brush-size":o.eraserClearBrush,"tools-type":"PEN","brush-type":o.eraserClearBrushType,"source-info":o.item},on:{updateMask:o.handleEraserClearMaskUrl}})]:o._e(),o._v(" "),r("ai-loading",{directives:[{name:"show",rawName:"v-show",value:o.loading,expression:"loading"}]})],2)]):o._e()}),[],!1,null,"08f449c6",null).exports),sn={inject:["top"],components:{VueMoveable:Ye.a,AiLoading:Zi},props:{AiImageTipsRef:{type:Object,default:function(){return null}}},data:function(){return{aiimgItemBoxRef:null,editRef:null,aiImgBorder:{},borderW:1}},computed:{screenshotInfo:function(){var t;return(null===(t=this.top.paintingBoardData)||void 0===t?void 0:t.generateInfo)||{}},generateNum:function(){var t;return((null===(t=this.top.paintingBoardData)||void 0===t?void 0:t.basicParams)||{}).imagesNumber-1||0},width:function(){var t;return null===(t=this.screenshotInfo)||void 0===t?void 0:t.width},height:function(){var t;return null===(t=this.screenshotInfo)||void 0===t?void 0:t.height},process:function(){var t=this.screenshotInfo.process;return t?t+"%":""}},watch:{"top.paintingBoardData.boardInfo.zoom":{handler:function(t){this.setBorderw(t)},immediate:!0}},mounted:function(){var t=this;this.aiimgItemBoxRef=this.$refs.aiimgItemBoxRef,this.editRef=this.$refs.editRef,this.AiImageTipsRef&&this.AiImageTipsRef.initPoin(),this.$nextTick((function(){t.aiBoxPoin(),t.setBorderw(),t.top.aiimgBoxRef=t.$refs.aiimgBoxRef})),L.a.on("$E_updateAiBoxSize",this.updateAiBoxSize)},methods:{clearActive:function(){this.top.paintingBoardData.elementList.forEach((function(t){return t.active=!1}))},resizeStart:function(t){var e=0===this.top.generateType?[1024,1024]:[1536,1536];t.setMin([256,256]),t.setMax(e)},aiBoxPoin:function(){var t=this,e=this.top.paintingBoardData.generateInfo,n=e.width,o=e.height,r=this.top.paintingBoardData.boardInfo,l=r.viewW,c=r.viewH,d=r.scrollLeft,h=r.scrollTop,v=r.zoom,m=d+l/v/2-n/2,f=h+c/v/2-o/2,style="transform: translate(".concat(m,"px, ").concat(f,"px);width:").concat(n,"px;height:").concat(o,"px");e.x=m,e.y=f,document.querySelector("#aiimgItemBoxId").style.cssText+=style,this.$nextTick((function(){t.AiImageTipsRef&&t.AiImageTipsRef.initPoin()}))},updateAiBoxSize:function(){var t=this,e=this.top.paintingBoardData.generateInfo,n=this.top.generateType,o=document.querySelector("#aiimgItemBoxId");0===n&&e.width>1024&&(e.width=1024,o.style.width="".concat(e.width,"px")),0===n&&e.height>1024&&(e.height=1024,o.style.height="".concat(e.height,"px")),this.$nextTick((function(){t.$refs.aiimgBoxRef&&t.$refs.aiimgBoxRef.updateRect()}))},handleDrag:function(t){this.clearActive(),t.target.style.transform=t.transform;var e=t.translate||[],n=Object(r.a)(e,2),o=n[0],l=n[1],c=this.top.paintingBoardData.generateInfo;c.x=o,c.y=l},dragEnd:function(t){var e=t.target.getBoundingClientRect();this.aiImgBorder=e;var n=this.top.paintingBoardData.generateInfo,o=this.top.generateType;0===o&&n.width>1024&&(n.width=1024,t.target.style.width="".concat(n.width,"px")),0===o&&n.height>1024&&(n.height=1024,t.target.style.height="".concat(n.height,"px"))},onResize:function(t){var e=this.top.paintingBoardData.generateInfo,n=t.width,o=t.height;t.target.style.width="".concat(n,"px"),t.target.style.height="".concat(o,"px"),t.target.style.transform=t.drag.transform,e.width=n,e.height=o},resizeEnd:function(t){var e=this.top.paintingBoardData.generateInfo,n=this.top.generateType;0===n&&e.width>1024&&(e.width=1024,t.target.style.width="".concat(e.width,"px")),0===n&&e.height>1024&&(e.height=1024,t.target.style.height="".concat(e.height,"px"))},aiHtmlImg:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,d,h,v,m,f,_,y;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e.top.paintingBoardData,r=o.generateInfo,l=o.boardInfo.zoom,c=o.imageToImage.imgUrl,"cancel"!==t){n.next=4;break}return e.top.cancelTask(r),n.abrupt("return");case 4:if(!r.loading){n.next=6;break}return n.abrupt("return");case 6:return d=null,r.loading=!0,h=e.$refs.aiimgItemBoxRef.getBoundingClientRect(),v=h.x,m=h.y,f=h.width,_=h.height,e.top.processStep={step:"start",process:0,text:"TaskStatusPreparing"},n.next=12,Object(ht.a)({tagArea:{x:v,y:m,width:f,height:_},scale:1/l});case 12:if(y=n.sent){n.next=18;break}return r.cutUrl=c,r.mask="",e.createTask(),n.abrupt("return");case 18:return n.next=20,Object(ht.b)(y,[255,255,255]);case 20:if(!n.sent){n.next=25;break}return n.next=24,Object(ht.h)(y,[255,255,255]);case 24:r.mask=n.sent;case 25:if(!(d=e.getIncludeLayer())){n.next=33;break}return n.next=29,Object(ht.d)(d.imgSrc,d,!0);case 29:r.cutUrl=n.sent,r.mask=e.getBoxMask(d),n.next=36;break;case 33:return n.next=35,Object(ht.s)(y);case 35:r.cutUrl=n.sent;case 36:e.createTask(d);case 37:case"end":return n.stop()}}),n)})))()},createTask:function(t){var e=this,n=this.top.paintingBoardData.generateInfo;this.top.generateTask("generate",n,(function(img){t?img[0].url&&(t.imgSrc=img[0].url):[0,3].includes(e.top.generateType)?e.addLayer(img):e.generateLayer(img[0].url)}),"aiProdImg")},generateLayer:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var r,l,c,d,h,v,m,f,_,y,w,C;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return l=e.top.paintingBoardData.generateInfo.params,c=e.getRelateLayer(),d=null===(r=e.top.paintingBoardData)||void 0===r?void 0:r.boardInfo,h=d.zoom,c=[].concat(Object(o.a)(c),[e.getGenerateImgBoxInfo(t)]),n.prev=4,n.next=7,Object(ht.n)(c,h);case 7:v=n.sent,m=v.width,f=v.height,_=v.base64,y=e.getCompositeImgInfo(c),w=y.x,C=y.y,Object(ht.s)(_).then((function(t){e.removeLayer(c),e.top.addLayerItem({x:w,y:C,width:m,height:f,imgSrc:t,params:l})})),n.next=15;break;case 13:n.prev=13,n.t0=n.catch(4);case 15:case"end":return n.stop()}}),n,null,[[4,13]])})))()},removeLayer:function(t){var e=this.top.paintingBoardData.elementList;this.top.paintingBoardData.elementList=e.filter((function(e){return!t.some((function(t){return(null==t?void 0:t.layerId)===e.layerId}))}))},getCompositeImgInfo:function(t){var e={x:0,y:0};return t.forEach((function(t){var n=t.x,o=t.y,r=t._x,l=t._y,c=t.width,d=t.height,h=t.zoom;n=r||n,o=l||o,n=h?n+c*(1-h[0])/2:n,o=h?o+d*(1-h[1])/2:o,e.x=e.x?Math.min(e.x,r||n):r||n,e.y=e.y?Math.min(e.y,l||o):l||o})),e},getGenerateImgBoxInfo:function(t){var e=document.querySelector("#aiimgItemBoxId").getBoundingClientRect(),n=e.width,o=e.height,r=e.x,l=e.y,c=this.top.paintingBoardData,d=c.generateInfo,h=c.boardInfo.zoom;return{width:n,height:o,renderWidth:n/h,renderHeight:o/h,x:r,y:l,_x:d.x,_y:d.y,imgSrc:t,z:9999999999,id:"aiimgItemBoxId"}},getRelateLayer:function(){var t=this.top.paintingBoardData.elementList,e=document.querySelector("#aiimgItemBoxId").getBoundingClientRect(),n=e.x,o=e.y,r=e.width,l=e.height,c=t.filter((function(t){var e=document.querySelector('[data-id="'+t.layerId+'"]'),c=(null==e?void 0:e.getBoundingClientRect())||{},d=n>=c.x+c.width||n+r<=c.x,h=o>=c.y+c.height||o+l<=c.y;return!d&&!h}));return c.length?c:null},addLayer:function(t){var e=this,n=this.top.paintingBoardData.generateInfo,o=n.x,r=n.y,l=n.width,c=n.height,d=n.params,h=t.length;t.forEach((function(t,i){e.top.addLayerItem({x:(null==t?void 0:t.x)||o+(h>1?i*(l+10):0),y:(null==t?void 0:t.y)||r-(h>1?c:0),width:(null==t?void 0:t.width)||l,height:(null==t?void 0:t.height)||c,imgSrc:t.url,params:d})}))},getBoxMask:function(t){var e,n=this.top.paintingBoardData.boardInfo.zoom,o=document.querySelector("#aiimgItemBoxId").getBoundingClientRect(),r=o.left,l=o.top,c=o.width,d=o.height,h=document.querySelector('[data-id="'+t.layerId+'"]').getBoundingClientRect(),v=(null===(e=t.zoom)||void 0===e?void 0:e.length)>1?t.zoom:[1,1];return Object(ht.f)({width:parseInt(t.width*v[0]),height:parseInt(t.height*v[1]),b_x:(r-h.left)/n,b_y:(l-h.top)/n,b_w:parseInt(c/n),b_h:parseInt(d/n)})},getIncludeLayer:function(){var t=this.top.paintingBoardData.elementList,e=document.querySelector("#aiimgItemBoxId").getBoundingClientRect(),n=e.x,o=e.y,r=e.width,l=e.height,c=t.filter((function(t){var e=document.querySelector('[data-id="'+t.layerId+'"]').getBoundingClientRect(),c=n>e.x&&n+r<e.x+e.width;return o>e.y&&o+l<e.y+e.height&&c}));if(null==c||!c.length)return"";var d=c[0];return c.forEach((function(t){d.z<t.z&&(d=t)})),d},setBorderw:function(t){var e=1/(this.top.paintingBoardData.boardInfo||t).zoom;this.borderW=e;var n=document.querySelector("#aiimgItemBoxId");n&&(n.style.borderWidth=2*e+"px")}}},rn=(n(2845),Object(_.a)(sn,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"aiimg-page-box bel-item no-snapshot",style:{zIndex:9999},on:{click:t.clearActive}},[e("div",{ref:"aiimgItemBoxRef",staticClass:"aiimg-box bel-item",attrs:{id:"aiimgItemBoxId"}},[e("div",{staticClass:"ai-content",attrs:{"data-drag":"no"}},[e("ai-loading",{directives:[{name:"show",rawName:"v-show",value:t.screenshotInfo.loading,expression:"screenshotInfo.loading"}]})],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.generateNum>0,expression:"generateNum > 0"}],staticClass:"result-list no-snapshot",attrs:{"data-drag":"no"}},t._l(t.generateNum,(function(n,i){return e("div",{key:"generateNum_"+i,staticClass:"result",style:{width:t.width+"px",height:t.height+"px"},attrs:{"data-drag":"no"}})})),0)]),t._v(" "),e("vue-moveable",{ref:"aiimgBoxRef",attrs:{target:t.aiimgItemBoxRef,resizable:!t.screenshotInfo.loading,scalable:!1,draggable:!t.screenshotInfo.loading,keepRatio:!1,origin:!1,checkInput:!0,minScale:.5,zoom:t.borderW},on:{dragEnd:t.dragEnd,drag:t.handleDrag,resize:t.onResize,resizeStart:t.resizeStart,resizeEnd:t.resizeEnd}})],1)}),[],!1,null,"47cd2a9e",null).exports),ln={name:"liveModeRedraw",inject:["top"],props:{},watch:{toolsType:{handler:function(){this.setDrawType(),this.setCanvasStyle()}},eraserSize:{handler:function(){this.setCanvasStyle()}},brushSize:{handler:function(){this.setCanvasStyle()}}},computed:{toolsType:function(){return"eraser"===this.top.paintingBoardData.topNav.tools.daubTool.redrawBoard.hasAct?"ERASER":"PEN"},brushSize:function(){var t=this.top.paintingBoardData.topNav.tools.daubTool.redrawBoard.wide;return isNaN(t/4)?100:t/4},eraserSize:function(){var t=this.top.paintingBoardData.topNav.tools.daubTool.redrawBoard.wide;return isNaN(t/4)?100:t/4},liveItemInfo:function(){return this.top.paintingBoardData.liveModel}},data:function(){return{canvasStyle:{},blankCanvas:"",brushColor:"rgb(255,255,255)",isDrawing:!1,lastX:0,lastY:0,blankBgCanvas:"",imageData:null,imgUrl:"",autoStyle:{width:500,height:500,rawWidth:500,rawHeight:500}}},mounted:function(){this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),this.initBgCanvas(),this.ctx.strokeStyle=this.brushColor,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.lineWidth="ERASER"===this.toolsType?this.eraserSize:this.brushSize,document.addEventListener("mouseup",this.stopDrawing),this.canvas.addEventListener("mousedown",this.startDrawing),this.canvas.addEventListener("mousemove",this.draw),this.canvas.addEventListener("mouseup",this.stopDrawing),this.blankCanvas=this.canvas.toDataURL(),this.saveBackgroundCanvas()},beforeDestroy:function(){this.canvas.removeEventListener("mousedown",this.startDrawing),this.canvas.removeEventListener("mousemove",this.draw),this.canvas.removeEventListener("mouseup",this.stopDrawing),document.removeEventListener("mouseup",this.stopDrawing)},methods:{setCanvasStyle:function(){var t="ERASER"===this.toolsType?this.eraserSize:this.brushSize,e='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="'.concat(t,'" height="').concat(t,'" viewBox="0 0 ').concat(t," ").concat(t,'">\n    <circle cx="').concat(t/2,'" cy="').concat(t/2,'" r="').concat(t/2,'" fill="purple" fill-opacity="0.5" />\n  </svg>'),n=btoa(e),o="data:image/svg+xml;base64,".concat(n);this.canvasStyle={cursor:"url(".concat(o,") ").concat(t/2," ").concat(t/2,", auto")}},saveCurrentDraw:function(){this.imageData=this.canvas.toDataURL()},initBgCanvas:function(){this.canvas2=this.$refs.canvas2,this.bgCtx=this.canvas2.getContext("2d"),this.bgCtx.fillStyle="black",this.bgCtx.fillRect(0,0,this.canvas2.width,this.canvas2.height)},saveBackgroundCanvas:function(){try{this.bgCtx.clearRect(0,0,this.canvas2.width,this.canvas2.height),this.bgCtx.fillStyle="black",this.bgCtx.fillRect(0,0,this.canvas2.width,this.canvas2.height),this.bgCtx.drawImage(this.canvas,0,0,this.canvas2.width,this.canvas2.height),this.blankBgCanvas=this.canvas2.toDataURL("image/png",.05)}catch(t){}},setDrawType:function(){this.ctx&&(this.ctx.strokeStyle=this.brushColor,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.globalCompositeOperation="ERASER"===this.toolsType?"destination-out":"source-over")},startDrawing:function(t){this.isDrawing=!0,this.setDrawType();var e=[t.offsetX,t.offsetY];this.lastX=e[0],this.lastY=e[1],this.ctx.beginPath(),this.ctx.moveTo(t.offsetX,t.offsetY)},draw:function(t){if(this.isDrawing){this.ctx.lineWidth="ERASER"===this.toolsType?this.eraserSize:this.brushSize,this.ctx.strokeStyle=this.brushColor,this.ctx.lineTo(t.offsetX,t.offsetY),this.ctx.stroke();var e=[t.offsetX,t.offsetY];this.lastX=e[0],this.lastY=e[1]}},stopDrawing:function(){this.isDrawing=!1,this.ctx.closePath();try{this.saveDrawingToBase64()}catch(t){}},clearCanvas:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},saveDrawingToBase64:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=1,t.bgCtx.clearRect(0,0,t.canvas2.width,t.canvas2.height),t.bgCtx.fillStyle="black",t.bgCtx.fillRect(0,0,t.canvas2.width,t.canvas2.height),t.bgCtx.drawImage(t.canvas,0,0,t.canvas2.width,t.canvas2.height),n=t.bgCtx.getImageData(0,0,t.canvas2.width,t.canvas2.height),t.bgCtx.putImageData(n,0,0),o=t.canvas2.toDataURL("image/png",.1),t.canvas.toDataURL()!==t.blankCanvas){e.next=14;break}return t.imgUrl="",t.top.updateLiveModeMask(t.imgUrl),t.$emit("updateMask",""),e.abrupt("return");case 14:if(o!==t.blankBgCanvas){e.next=18;break}return t.imgUrl="",t.top.updateLiveModeMask(t.imgUrl),e.abrupt("return");case 18:t.imgUrl=o,t.top.updateLiveModeMask(t.imgUrl),e.next=24;break;case 22:e.prev=22,e.t0=e.catch(1);case 24:case"end":return e.stop()}}),e,null,[[1,22]])})))()}}},cn=(n(2846),Object(_.a)(ln,(function(){var t,e,n,o,r=this,l=r._self._c;return l("div",{staticClass:"c-live-mode-redraw no-snapshot",style:{width:(null===(t=r.liveItemInfo)||void 0===t?void 0:t.width)+"px",height:(null===(e=r.liveItemInfo)||void 0===e?void 0:e.height)+"px",transform:"translate(".concat(null===(n=r.liveItemInfo)||void 0===n?void 0:n.x,"px, ").concat(null===(o=r.liveItemInfo)||void 0===o?void 0:o.y,"px)")}},[l("canvas",{ref:"canvas",staticClass:"live-mode-redraw-canvas",style:r.canvasStyle,attrs:{"data-drag":"no",width:r.liveItemInfo.width,height:r.liveItemInfo.height}}),r._v(" "),l("canvas",{ref:"canvas2",staticStyle:{display:"none"},attrs:{width:r.liveItemInfo.width,height:r.liveItemInfo.height}}),r._v(" "),r.imgUrl?l("img",{staticStyle:{display:"none"},attrs:{src:r.imgUrl,alt:""}}):r._e()])}),[],!1,null,"83d3058a",null).exports),un=n(99),dn={inject:["top"],props:["liveRef"],components:{LineLoading:un.a},data:function(){return{styleInfo:{}}},computed:{liveInfo:function(){return this.top.paintingBoardData.liveModel},size:function(){var t=this.liveInfo,e=t.x,n=t.y,o=t.width,r=t.height,l=t.show;return{x:e,y:n,width:o,height:r,zoom:(this.top.paintingBoardData.boardInfo||{}).zoom,show:l}}},watch:{size:{handler:function(t){var e=this;this.$nextTick((function(){e.styleInfo=e.getStyle(t)}))},deep:!0,immediate:!0},"liveInfo.result":function(t){t&&this.setLoading(!0)}},methods:{changePrompt:function(t){this.top.paintingBoardData.liveModel.prompt=t},setLoading:function(t){this.top.paintingBoardData.liveModel.loading=t},generateTextToText:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.liveRef.cutImg();case 1:case"end":return e.stop()}}),e)})))()},saveLayer:function(){var t=this.liveInfo,e=t.x,n=t.y,o=t.width,r=t.height,l=t.result,c=t.params,data={type:this.top.paintingBoardData.liveModel.show?"liveImgLayer":"imgLayer",imgSrc:l,x:e,y:n,width:o,height:r,params:c};this.top.addLayerItem(data)},downloadImg:function(){var t=this.liveInfo.result;Object(bt.z)(t)},getStyle:function(){var t=document.querySelector("#liveItemBox"),e=(null==t?void 0:t.getBoundingClientRect())||{},n=e.x,o=e.y,r=e.width;return{left:n+r+15+"px",top:o+"px",width:r+"px",height:e.height+"px"}}}},hn=(n(2847),Object(_.a)(dn,(function(){var t,e=this,n=e._self._c;return n("div",{staticClass:"live-view",style:e.styleInfo,attrs:{"data-title":e.$t("Preview"),"data-drag":"no"}},[n("div",{staticClass:"live-show"},[n("img",{directives:[{name:"show",rawName:"v-show",value:e.liveInfo.result,expression:"liveInfo.result"}],staticClass:"result-img",attrs:{src:e.liveInfo.result,alt:""},on:{load:function(t){return e.setLoading(!1)}}}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.liveInfo.result,expression:"liveInfo.result"}],staticClass:"handle"},[n("el-tooltip",{attrs:{effect:"dark",content:e.$t("canvas_save_hover")}},[n("i",{staticClass:"iconfont icon-icon_yijianxintuceng",on:{click:e.saveLayer}})]),e._v(" "),n("el-tooltip",{attrs:{effect:"dark",content:e.$t("Download")}},[n("i",{staticClass:"iconfont icon-icon_xiazai",on:{click:e.downloadImg}})])],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.liveInfo.loading,expression:"liveInfo.loading"}],staticClass:"loading no-snapshot"},[n("line-loading")],1)]),e._v(" "),n("div",{staticClass:"live-prompt"},[n("el-input",{ref:"textarea",attrs:{type:"textarea",value:null===(t=e.liveInfo)||void 0===t?void 0:t.prompt,placeholder:e.$t("PromptNotEmpty"),rows:2,resize:"none"},on:{change:e.generateTextToText,input:e.changePrompt},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.generateTextToText.apply(null,arguments))}}})],1)])}),[],!1,null,"551646d3",null)),pn=hn.exports,vn={inject:["top"],props:{info:{type:Object,default:function(){return{width:0,height:0,min:256,max:1024}}},isRatio:{type:Boolean,default:!0},isPauseLiveGenerate:{type:Boolean,default:!1}},data:function(){return{styleInfo:{}}},computed:{liveInfo:function(){return this.top.paintingBoardData.liveModel},liveSize:function(){var t=this.liveInfo;return{x:t.x,y:t.y,width:t.width,height:t.height,zoom:(this.top.paintingBoardData.boardInfo||{}).zoom}}},watch:{liveSize:{handler:function(t){var e=this;this.$nextTick((function(){e.setStyle(t)}))},deep:!0,immediate:!0}},methods:{changeSize:function(t,e){var n=this;this.top.paintingBoardData.liveModel[e]=t,document.querySelector("#liveItemBox").style[e]=t+"px",this.top.changeData("liveModel."+e,t),this.$nextTick((function(){n.top.liveBoxRef.updateRect()}))},setStyle:function(t){var e=document.querySelector("#liveItemBox"),n=(null==e?void 0:e.getBoundingClientRect())||{},o=n.x,r=n.y,l=n.width;this.styleInfo={left:o-70+"px",top:r-82+"px",width:l+"px"}},pauseLiveGenerate:function(){this.$emit("pauseLiveGenerate")}}},mn=(n(2848),Object(_.a)(vn,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"live-size",style:t.styleInfo},[e("div",{staticClass:"width box"},[e("span",{staticClass:"words"},[t._v("W")]),t._v(" "),e("el-input-number",{staticClass:"input",attrs:{value:t.liveInfo.width,step:1,precision:0,controls:!1,min:t.liveInfo.min,max:t.liveInfo.max},on:{change:function(e){return t.changeSize(e,"width")}}})],1),t._v(" "),e("div",{staticClass:"height box"},[e("span",{staticClass:"words"},[t._v("H")]),t._v(" "),e("el-input-number",{staticClass:"input",attrs:{value:t.liveInfo.height,step:1,precision:0,controls:!1,min:t.liveInfo.min,max:t.liveInfo.max},on:{change:function(e){return t.changeSize(e,"height")}}})],1),t._v(" "),e("div",{staticClass:"box box-right"},[e("span",{staticClass:"box-tips"},[t._v(t._s(t.isPauseLiveGenerate?t.$t("canvas_stop"):t.$t("canvas_start")))]),t._v(" "),e("i",{staticClass:"iconfont",class:t.isPauseLiveGenerate?"icon-a-bofang1":"icon-a-zanting11",on:{click:t.pauseLiveGenerate}})])])}),[],!1,null,"87ade2ea",null).exports),fn={name:"RightClickMenu",inject:["top"],props:{needMenu:{type:Boolean,default:!0},layerList:{type:Array,default:function(){return[]}},actionType:{type:String,default:"elementList"}},data:function(){return{isShowMenu:!1,menuTop:0,menuLeft:0}},computed:{getMenuPosition:function(){return{top:"".concat(this.menuTop,"px"),left:"".concat(this.menuLeft,"px")}},getActiveList:function(){return this.layerList.filter((function(t){return t.active}))||[]},renderMenuList:function(){var t=!1,e=!1,n=!1;if(1==this.getActiveList.length){var o,r,l,c=(null===(o=this.getActiveList)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.layerId)||"";t=!!c&&this.top.getEleInfo(c,"lock",this.actionType),e=!!((null===(r=this.getActiveList)||void 0===r||null===(r=r[0])||void 0===r||null===(r=r.params)||void 0===r?void 0:r.taskId)||""),n=(null===(l=this.getActiveList)||void 0===l||null===(l=l[0])||void 0===l?void 0:l.z)>1e4}var d=[{label:"SaveToMyGallery",value:"saveToMyGallery"},{label:"taskTabUpscale",value:"upscale"},{label:"AdjustOrder",value:"adjustOrder",rightIcon:"el-icon-arrow-right",children:[{label:"ToTop",value:"toTop"},{label:"ToBottom",value:"toBottom"},{label:"MoveUp",value:"moveUp"},{label:"MoveDown",value:"moveDown"}]},{label:"LockImage",value:"lockImage",hide:t},{label:"UnlockPicture",value:"unlockImage",hide:!t},{label:"TransformTool",value:"transformTool",rightIcon:"el-icon-arrow-right",children:[{label:"FreeDeformation",value:"freeDeformation",hide:n},{label:"HorizontalFlip",value:"horizontalFlip"},{label:"VerticalFlip",value:"verticalFlip"},{label:"Clockwise90Deg",value:"clockwise90Deg"},{label:"Counterclockwise90Deg",value:"counterclockwise90Deg"}]},{label:"RestoreFaces",value:"restoreFaces"},{label:"copy",value:"copy"},{label:"Download",value:"download"},{label:"Publish",value:"publish",hide:!e}];return this.getActiveList.length>1?[{label:"SaveToMyGallery",value:"saveToMyGallery"},{label:"copy",value:"copy"},{label:"Download",value:"download"}]:d}},mounted:function(){document.body.appendChild(this.$refs.menu),document.addEventListener("click",this.handleClickOutside)},beforeDestroy:function(){document.body.removeChild(this.$refs.menu),document.removeEventListener("click",this.handleClickOutside)},methods:{showMenu:function(t,e){var n=this.getActiveList.length>1;if(this.getActiveList.length>0)if(n){var o=document.querySelector(".moveable-area");this.isShowMenu=o.contains(t.target)}else{var r,l=null===(r=this.getActiveList)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.layerId,c=document.querySelector("#img-".concat(l)),d=document.querySelector("#live-layer-".concat(l)),h=c&&c.contains(t.target),v=d&&d.contains(t.target);this.isShowMenu=h||v}"more"==e&&(this.isShowMenu=!0),this.menuTop=t.pageY,this.menuLeft=t.pageX;this.$refs.menu;var m=t.clientX,f=t.clientY,_=n?212:418,y=window.innerWidth;m+_>y&&(this.menuLeft=y-_-20);var w=n?110:308,C=window.innerHeight;f+w>C&&(this.menuTop=C-w)},closeMenu:function(){this.isShowMenu=!1},handleClickOutside:function(t){var e,n=null===(e=document.getElementsByClassName("top-btn-more"))||void 0===e?void 0:e[0];this.$refs.menu.contains(t.target)||(n?!n.contains(t.target)&&(this.isShowMenu=!1):this.isShowMenu=!1)},handleMenuClick:function(t){if(!this.top.token&&["saveToMyGallery","upscale","restoreFaces"].includes(t))return this.$EventBus.$emit("openLoginDialog",{callBack:function(){window.location.reload()}});this.$emit("rightMenuClick",t)}}},gn=(n(2849),Object(_.a)(fn,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"right-click-menu-container",on:{contextmenu:function(e){return e.preventDefault(),t.showMenu(e)}}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowMenu&&t.needMenu,expression:"isShowMenu && needMenu"}],ref:"menu",staticClass:"right-click-menu",style:t.getMenuPosition},t._l(t.renderMenuList,(function(n){return e("div",{directives:[{name:"show",rawName:"v-show",value:!n.hide,expression:"!item.hide"}],key:n.value,staticClass:"item-menu",class:{"have-children":n.children}},[e("div",{staticClass:"label",on:{click:function(e){return t.handleMenuClick(n.value)}}},[t._v("\n\t\t\t\t"+t._s(t.$t(n.label))+"\n\t\t\t\t"),e("i",{staticClass:"ri-icon",class:n.rightIcon})]),t._v(" "),n.children?e("div",{staticClass:"sub-menu"},t._l(n.children,(function(sub){return e("div",{directives:[{name:"show",rawName:"v-show",value:!sub.hide,expression:"!sub.hide"}],key:sub.value,staticClass:"item-sub-menu",on:{click:function(e){return t.handleMenuClick(sub.value)}}},[t._v("\n\t\t\t\t\t"+t._s(t.$t(sub.label))+"\n\t\t\t\t")])})),0):t._e()])})),0),t._v(" "),t._t("default")],2)}),[],!1,null,"1c03e003",null).exports);function bn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function _n(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?bn(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var yn=null,wn={components:{generationFrame:ze,BaseCanvas:Ge,LiveBox:ei,MoveContainer:ki,VueSelecto:De.a,MoveItems:bi,MoveItem:vi,ImgMove:on,AiPordImg:rn,liveModeRedraw:cn,LayerBtns:ni,AiImageTips:si,LayerFooter:ci,LiveView:pn,LiveSize:mn,RightClickMenu:gn,EraserBottons:ji},inject:["top"],data:function(){return{layerList:[],AiImageTipsRef:null,liveRef:null,isPauseLiveGenerate:!1,isGripper:!1}},watch:{},computed:{showControlNetModal:function(){var t=this;return function(e){if(!t.top.paintingBoardData.liveModel.show)return e.id===t.top.paintingBoardData.controlNet.activeIndex;var n=t.top.paintingBoardData.elementList.findIndex((function(t){return(null==t?void 0:t.controlNetId)===e.id}));return t.top.paintingBoardData.liveModel.show&&-1===n&&e.id===t.top.paintingBoardData.controlNet.activeIndex}},showLiveModeRedraw:function(){return this.top.paintingBoardData.liveModel.show&&"daubBoard"===this.top.paintingBoardData.topNav.tools.hasAct},hasAct:function(){return this.top.paintingBoardData.topNav.tools.hasAct},showCanvasBox:function(){var t,e=this.top.paintingBoardData.topNav.tools,n="brushBoard"===(null==e?void 0:e.hasAct),o="brush"===(null==e||null===(t=e.brushTool)||void 0===t||null===(t=t.brushBoard)||void 0===t?void 0:t.hasAct),r=this.top.paintingBoardData.liveModel.show;return n&&o&&!r},targets:function(){var t=this.top.paintingBoardData.elementList,e=[];return t.forEach((function(t){var n=t.active,o=t.layerId,r=document.querySelector('[data-id="'+o+'"]');n&&r&&e.push(r)})),e},liveInfo:function(){return this.top.paintingBoardData.liveModel},getActiveList:function(){return this.top.paintingBoardData.elementList.filter((function(t){return t.active}))||[]},getDarwList:function(){return this.top.paintingBoardData.elementList.filter((function(t){return t.hasDrawLine||t.hasRedraw}))||[]},aiEraserItem:function(){return this.top.paintingBoardData.elementList.find((function(t){return t.hasEraserDraw}))},showEraserBtn:function(){var t=this,e=this.top.paintingBoardData.elementList.find((function(t){return t.hasEraserDraw}));if(!e)return!1;var n=this.top.paintingBoardData.topNav.tools.hasAct,o=["imgLayer","brushLayer"].includes(e.type),r=["eraserBoard","eraserAiBoard"].includes(n),l=e.hasEraserDraw,c=!["",null,void 0].includes(null==e?void 0:e.mask),d=o&&r&&l&&c;return this.$nextTick((function(){t.$refs.eraserBottonsRef&&t.$refs.eraserBottonsRef.initPoin()})),d}},mounted:function(){this.infiniteBoard(),this.dragimgTowork(),this.top.eventFn.setBoardNoDage=this.setBoardNoDage,this.top.eventFn.setBoardYesDage=this.setBoardYesDage,this.top.eventFn.setViewYesDage=this.setViewYesDage,this.AiImageTipsRef=this.$refs.AiImageTipsRef,this.liveRef=this.$refs.liveBox},beforeDestroy:function(){clearTimeout()},methods:{pauseLiveGenerate:function(){this.isPauseLiveGenerate=!this.isPauseLiveGenerate,this.isPauseLiveGenerate||this.handleWatchLiveGenerate();var t=this.isPauseLiveGenerate?"click_stop":"click_start";this.$logEvent("log_actions",{operation:t,behavior_info:"on_canvas"})},handleWatchLiveGenerate:function(){var t=this;setTimeout((function(){t.liveRef.watchLive(t.top.paintingBoardData.liveModel,!0)}),1e3)},infiniteBoard:function(){var t=this,e=document.querySelector("#canvas-container").offsetWidth,n=document.querySelector("#canvas-container").offsetHeight;yn=new Ie.e(document.querySelector("#canvas-container"),document.querySelector("#canvas"),{zoom:.5,useMouseDrag:!1,useWheelScroll:!0,useAutoZoom:!1,zoomRange:[.1,10],margin:0}),this.top.setViewer(yn),this.top.changeData("boardInfo.viewW",e),this.top.changeData("boardInfo.viewH",n),yn.on("scroll",(function(e){var n=Object(ht.l)(),o=n.x,r=n.y,l={zoom:e.zoomX,inViewX:o,inViewY:r,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop},c=t.top.paintingBoardData.boardInfo;t.top.changeData("boardInfo",_n(_n({},c),l)),document.querySelector("#layerBtnsId").style.left="0px",document.querySelector("#layerBtnsId").style.top="0px",t.$nextTick((function(){t.$refs.eraserBottonsRef&&t.$refs.eraserBottonsRef.initPoin(),t.top.layerFooterRef.setPositionBox()})),t.top.initLayerActive()}))},onDragStart:function(t){var e=t.inputEvent.target,n=this.$refs.moveRef.moveableRef.isMoveableElement(e),o=this.targets.some((function(t){return t===e||t.contains(e)})),r=e.getAttribute("data-drag"),l=e.className,c=e.tagName,d=this.top.paintingBoardData.topNav.tools.hasAct,h=["upper-canvas base-canvas-box","brushBoard","brushImg","eraserBoard","eraserAiBoard","daubBoard"];(yn.useMouseDrag||n||o||h.includes(l)||h.includes(c)||h.includes(d)||r&&"no"===r)&&t.stop()},onSelectEnd:function(t){var e=this.top.paintingBoardData.elementList,n=this.$refs.moveRef.moveableRef,o=Object(Nt.a)("ctrlOrCmd").active;if(t.isDragStart&&(t.inputEvent.preventDefault(),n.waitToChangeTarget().then((function(){n.dragStart(t.inputEvent)}))),o){var l=Object(r.a)(t.selected,1)[0];if(l){var c=l.getAttribute("data-id"),d=this.top.getEleInfo(c),h=e.findIndex((function(t){return t.layerId===c}));this.top.changeData("elementList[".concat(h,"].active"),!d.active)}else this.top.initLayerActive()}else this.top.initLayerActive(),t.selected.forEach((function(t){var n=t.dataset.id,o=e.find((function(t){return t.layerId===n}));o&&(o.active=!0)}));this.$refs.layerBtnsRef.setPoin()},onSelect:function(t){},clickLayerItem:function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).item},setBoardNoDage:function(){this.$refs.moveRef.draggable=!1,this.$refs.moveRef.scalable=!1},setBoardYesDage:function(){this.$refs.moveRef.draggable=!0,this.$refs.moveRef.scalable=!0},setViewYesDage:function(t){yn.useMouseDrag=t,this.isGripper=t},handContainer:function(){var t=this.top.paintingBoardData.elementList.map((function(em){return _n(_n({},em),{},{active:!1})}));this.top.changeData("elementList",t)},dragMove:function(){this.$refs.layerBtnsRef.hideBtn()},scaleIng:function(){this.$refs.layerBtnsRef.hideBtn()},renderGroup:function(){this.$refs.layerBtnsRef.hideBtn()},actionEnd:function(){this.$refs.layerBtnsRef.setPoin()},handleGroup:function(t){var e=this;this.$logEvent("log_actions",{operation:"click_".concat(t,"_image_operation"),behavior_info:"on_canvas_detail_page"});var canvas=document.createElement("canvas"),n=window,o=n.innerWidth,r=n.innerHeight;canvas.width=o,canvas.height=r;var c=canvas.getContext("2d");this.imagesLoaded=0,this.getActiveList.sort((function(a,b){return a.z-b.z}));var d=this.getActiveList.map((function(t){return e.loadImage(t).then((function(img){return _n({img:img},t)}))}));Promise.all(d).then((function(n){var o=e.top.paintingBoardData.boardInfo.zoom;n.forEach(function(){var n=Object(l.a)(regeneratorRuntime.mark((function n(r){var l,d,h,v,m,f,_,rect,y,w,C,k,O,x,I,D,param;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l=r.layerId,d=r.renderWidth,h=r.renderHeight,v=document.querySelector("#".concat(l)).getBoundingClientRect(),m=v.left,f=v.top,c.drawImage(r.img,m,f,d*o,h*o),e.imagesLoaded++,e.imagesLoaded!==e.getActiveList.length){n.next=35;break}return _=document.querySelector(".moveable-area"),rect=_.getBoundingClientRect(),y=rect.left,w=rect.top,C=_.offsetWidth,k=_.offsetHeight,O=c.getImageData(y,w,C,k),(x=document.createElement("canvas")).width=C*o,x.height=k*o,x.getContext("2d").putImageData(O,0,0),I=x.toDataURL(),n.next=20,Object(ht.s)(I);case 20:I=n.sent,n.t0=t,n.next="imgToImg"===n.t0?24:"saveToMyGallery"===n.t0?26:"download"===n.t0?28:"copy"===n.t0?30:34;break;case 24:return e.handleGroupImgToImg(I),n.abrupt("break",35);case 26:return e.handleGroupSaveToMine(I),n.abrupt("break",35);case 28:return e.handleGroupDownload(I),n.abrupt("break",35);case 30:return D=e.top.paintingBoardData.liveModel.show,param={type:D?"liveImgLayer":"imgLayer",imgSrc:I},e.top.addLayerItem(param),n.abrupt("break",35);case 34:return n.abrupt("break",35);case 35:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())})).catch((function(t){console.error("加载图像时出错：",t)}))},loadImage:function(t){return new Promise((function(e,n){var img=new Image;img.crossOrigin="Anonymous",img.onload=function(){e(img)},img.onerror=n,img.src=t.imgSrc}))},handleGroupImgToImg:function(t){this.top.changeLeftMenu("Generate"),this.top.changeData("imageToImage.imgUrl",t)},handleGroupSaveToMine:function(t){var e=this;Object(Q.I)({items:[{category:"mine",image:t,name:""}]}).then((function(t){e.$message.success(e.$t("SaveSuccess")),e.$EventBus.$emit("updateMine"),e.top.changeLeftMenu("Mine")}))},handleGroupDownload:function(t){var img=new Image;img.crossOrigin="anonymous",img.src=t,img.onload=function(){var canvas=document.createElement("canvas");canvas.width=img.width,canvas.height=img.height,canvas.getContext("2d").drawImage(img,0,0);var t=canvas.toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download="layer-group.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)}},topBtnsClick:function(t,e){var n=this;this.groupToOneImage(t)?this.handleGroup(t):this.getActiveList.forEach((function(o){var r=n.$refs.imgMoveRef.findIndex((function(t){return t.comKey===o.layerId}));n.$refs.imgMoveRef[r].topBtnsClick(t,e)}))},layerFooterBtn:function(t){var e=this;this.getDarwList.forEach((function(n){var o=e.$refs.imgMoveRef.findIndex((function(t){return t.comKey===n.layerId}));e.$refs.imgMoveRef[o].tipsSubmit(t)}))},rightMenuClick:function(t){var e=this;if(this.groupToOneImage(t))return this.handleGroup(t),void this.closeRightMenu();this.getActiveList.forEach((function(n){var o=e.$refs.imgMoveRef.findIndex((function(t){return t.comKey===n.layerId}));e.$refs.imgMoveRef[o].rightMenuClick(t)}))},groupToOneImage:function(t){return this.getActiveList.length>1&&!["del","more"].includes(t)},showRightMenu:function(t,e){this.$refs.rightClickMenu.showMenu(t,e)},closeRightMenu:function(){this.$refs.rightClickMenu.closeMenu()},dragimgTowork:function(){var t=this,e=document.getElementById("canvas-container");["dragenter","dragover","dragleave","drop"].forEach((function(t){e.addEventListener(t,(function(t){t.preventDefault(),t.stopPropagation()}),!1)})),e.addEventListener("drop",(function(e){var dt=e.dataTransfer,n=Array.from(dt.files)[0];n&&n.type.includes("image")&&t.top.eventFn.uploadImg({file:n})}),!1)},updateOnEraser:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.top.paintingBoardData.elementList.filter((function(t){return t.hasEraserDraw})).forEach((function(n){var o=t.$refs.imgMoveRef.findIndex((function(t){return t.comKey===n.layerId}));t.$refs.imgMoveRef[o].updateOnEraser(e)}))}}},Cn=wn,kn=(n(2850),Object(_.a)(Cn,(function(){var t=this,e=t._self._c;return e("RightClickMenu",{ref:"rightClickMenu",attrs:{layerList:t.top.paintingBoardData.elementList},on:{rightMenuClick:t.rightMenuClick}},[e("div",{staticClass:"board-page wh100"},[e("div",{staticClass:"wh100",class:("handBoardel"===t.hasAct||t.isGripper)&&"gripper",attrs:{id:"canvas-container"}},[e("div",{staticClass:"flex_c_m",attrs:{id:"canvas"}},[e("move-items",{ref:"moveRef",attrs:{targets:t.targets,selectoRef:t.$refs.selectoRef},on:{actionEnd:t.actionEnd,drag:t.dragMove,scale:t.scaleIng,renderGroup:t.renderGroup}},[t._l(t.top.paintingBoardData.elementList||[],(function(n){return[e("img-move",{directives:[{name:"show",rawName:"v-show",value:n.show,expression:"e.show"}],key:n.layerId,ref:"imgMoveRef",refInFor:!0,staticClass:"move-item",attrs:{item:n,comKey:n.layerId},on:{showRightMenu:t.showRightMenu,closeRightMenu:t.closeRightMenu,onClick:t.clickLayerItem}})]}))],2),t._v(" "),"updateArimg"!==t.hasAct||t.liveInfo.show?t._e():e("ai-pord-img",{ref:"aiPordImgRef",attrs:{AiImageTipsRef:t.AiImageTipsRef}})],1),t._v(" "),t.showCanvasBox?e("base-canvas"):t._e()],1),t._v(" "),e("vue-selecto",{ref:"selectoRef",attrs:{dragContainer:"#canvas-container",selectableTargets:[".move-item"],hitRate:0,ratio:0,hitTest:0,selectByClick:!0,selectFromInside:!1,toggleContinueSelect:["shift"]},on:{dragStart:t.onDragStart,selectEnd:t.onSelectEnd,select:t.onSelect}}),t._v(" "),e("layer-btns",{ref:"layerBtnsRef",on:{topBtnsClick:t.topBtnsClick}}),t._v(" "),t.showEraserBtn?e("eraser-bottons",{ref:"eraserBottonsRef",staticClass:"no-snapshot",attrs:{item:t.aiEraserItem},on:{updateImageSize:t.updateOnEraser}}):t._e(),t._v(" "),e("ai-image-tips",{directives:[{name:"show",rawName:"v-show",value:"updateArimg"===t.hasAct&&!t.liveInfo.show,expression:"hasAct === 'updateArimg' && !liveInfo.show"}],ref:"AiImageTipsRef",on:{onSubmit:function(e){t.$refs.aiPordImgRef.aiHtmlImg(e)}}}),t._v(" "),t._l(t.top.paintingBoardData.controlNet.controlnet_units||[],(function(n,o){return e("generation-frame",{directives:[{name:"show",rawName:"v-show",value:t.showControlNetModal(n),expression:"showControlNetModal(item)"}],key:n.id,model:{value:t.top.paintingBoardData.controlNet.controlnet_units[o],callback:function(e){t.$set(t.top.paintingBoardData.controlNet.controlnet_units,o,e)},expression:"top.paintingBoardData.controlNet.controlnet_units[index]"}})})),t._v(" "),e("layer-footer",{on:{onSubmit:t.layerFooterBtn}})],2)])}),[],!1,null,"457cb333",null).exports),On=n(497),xn=n(715),In=n(677);function Dn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var Sn={data:function(){return{}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Dn(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Dn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(h.c)("user",["cdnHostFun"])),methods:{handelClose:function(t){this.$emit("handelClose"),"neverRemind"!==t?localStorage.setItem("CanvasTeachVideo",(new Date).getTime()):localStorage.setItem("CanvasTeachVideo",t)}}},Pn=Sn,Ln=(n(2852),Object(_.a)(Pn,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"video-box flex-center"},[e("div",{staticClass:"video-box-item flex-center",style:{backgroundImage:"url(https://".concat(t.cdnHostFun(),"/static/upload/20240206/8011a9fd-b1ad-4885-81d5-53b6255605c0.png)")}},[e("video",{staticClass:"video",attrs:{src:"https://".concat(t.cdnHostFun(),"/20240227/6edef9af-7839-4e77-88b2-4ffb1b404720.mov"),autoplay:"",loop:"",preload:"",muted:"",width:"100%",height:"100%"},domProps:{muted:!0}})]),t._v(" "),e("div",{staticClass:"btn flex-center"},[e("div",{staticClass:"btn-item flex-center",on:{click:function(e){return t.handelClose("neverRemind")}}},[t._v("\n      "+t._s(t.$t("teach_video_tips"))+"\n    ")]),t._v(" "),e("div",{staticClass:"btn-item flex-center",on:{click:function(e){return t.handelClose("todayClose")}}},[t._v("\n      "+t._s(t.$t("Off_10"))+"\n    ")])])])}),[],!1,null,"17f698d2",null).exports),jn={inject:["top"],props:{switchLive:{type:Boolean,default:!1}},data:function(){return{styleInfo:{}}},computed:{liveInfo:function(){return this.top.paintingBoardData.liveModel},isShowText:function(){var t=this.liveInfo,e=t.height;return t.width/e>.52},isClearDisabled:function(){return 0===this.top.paintingBoardData.liveLayerList.length}},methods:{changeSize:function(t,e){this.top.changeData("liveModel.".concat(e),t),Y.a.add(this.top.paintingBoardData),L.a.emit("liveCreateAiImg")},toggleSwitch:function(){this.$emit("toggleSwitch")},showSizeInput:function(t){var e=document.querySelector("#liveSizeId");t<=this.liveInfo.min+250?e.style.display="none":e.style.display="block"},clearLiveBoard:function(){var t=this;this.isClearDisabled||(this.top.changeData("liveLayerList",[]),this.top.changeData("liveModel.prompt",""),this.top.changeData("liveModel.result",""),this.top.changeData("liveModel.product_image_url",""),this.top.changeData("liveModel.pmask",""),setTimeout((function(){Y.a.add(t.top.paintingBoardData)}),0))}}},$n=(n(2853),Object(_.a)(jn,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"live-size",style:t.styleInfo},[e("div",{staticClass:"box-left",attrs:{id:"liveSizeId"}},[e("div",{staticClass:"flex_m"},[e("div",{staticClass:"box"},[e("span",{staticClass:"words"},[t._v("W")]),t._v(" "),e("el-input-number",{staticClass:"input",attrs:{value:t.liveInfo.width,step:1,precision:0,controls:!1,min:t.liveInfo.min,max:t.liveInfo.max},on:{change:function(e){return t.changeSize(e,"width")}}})],1),t._v(" "),e("div",{staticClass:"box",attrs:{id:"liveSizeHeightId"}},[e("span",{staticClass:"words"},[t._v("H")]),t._v(" "),e("el-input-number",{staticClass:"input",attrs:{value:t.liveInfo.height,step:1,precision:0,controls:!1,min:t.liveInfo.min,max:t.liveInfo.max},on:{change:function(e){return t.changeSize(e,"height")}}})],1)])]),t._v(" "),e("div",{staticClass:"box box-right"},[e("div",{staticClass:"box-clear",class:{disabled:t.isClearDisabled},on:{click:t.clearLiveBoard}},[e("i",{staticClass:"iconfont icon-delete-gpt"}),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:t.isShowText,expression:"isShowText"}],staticClass:"box-tips"},[t._v(t._s(t.$t("workFlow13")))])]),t._v(" "),e("i",{staticClass:"iconfont",class:t.switchLive?"icon-a-bofang1":"icon-a-zanting11",on:{click:t.toggleSwitch}}),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:t.isShowText,expression:"isShowText"}],staticClass:"box-tips"},[t._v(t._s(t.switchLive?t.$t("canvas_stop"):t.$t("canvas_start")))])])])}),[],!1,null,"57250b56",null).exports),Tn=n(2861),Bn={inject:["top"],props:{item:{type:Object,default:function(){return{}}}},data:function(){return{baseCanvas:null,mask:""}},watch:{eraserAiBoard:{handler:function(t){this.baseCanvas&&this.setBrushStyle(t)},deep:!0,immediate:!0},"item.loading":function(t){t||this.baseCanvas.clear()}},computed:{eraserAiBoard:function(){return this.top.paintingBoardData.topNav.tools.eraserTool.eraserAiBoard}},mounted:function(){this.initBoard()},methods:{initBoard:function(){var t=this,e=this.item,n=document.querySelector("#aiEraserBox_"+e.layerId);this.baseCanvas=new Ve.fabric.Canvas("aiEraserCanvas_"+e.layerId,{width:n.offsetWidth,height:n.offsetHeight});var o=this.eraserAiBoard,r=this.baseCanvas;r.isDrawingMode=!0,r.freeDrawingBrush.color="#fff",r.freeDrawingBrush.width=o.wide/5,r.on("path:created",(function(){setTimeout((function(){var n=r.lowerCanvasEl.toDataURL();t.updateMask(n,(function(n){t.top.setEleItem({id:e.layerId,type:"liveLayerList",item:{hasEraserDraw:!0}}),t.mask=n,t.$emit("drawEnd",{mask:n,item:e})}))}),100)}))},setBrushStyle:function(t){var e=this.baseCanvas;e.freeDrawingBrush.color="#fff",e.freeDrawingBrush.width=t.wide/5},updateMask:function(t,e){var n=this.item,o=n.realWidth,r=n.realHeight,img=new Image,canvas=document.createElement("canvas"),l=canvas.getContext("2d");canvas.width=o,canvas.height=r,img.src=t,img.onload=function(){l.drawImage(img,0,0,o,r);var t=canvas.toDataURL();e&&e(t)}}}},Mn=(n(2854),{inject:["top"],components:{AiEraserBox:Object(_.a)(Bn,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"board-max-box",attrs:{"data-drag":"no",id:"aiEraserBox_".concat(t.item.layerId)}},[e("canvas",{staticClass:"base-canvas-box",attrs:{"data-drag":"no",id:"aiEraserCanvas_".concat(t.item.layerId),width:"100%",height:"100%"}})])}),[],!1,null,"5880da5c",null).exports,LineLoading:un.a,AiLoading:Zi},props:{item:{type:Object,default:function(){return{}}}},data:function(){return{canvas:null}},computed:{matrix3dVal:function(){return this.item.matrix3d||"1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1"},scaleFn:function(){var t=this.item.zoom;return Array.isArray(t)?t.join():[t,t].join()},showAiEraser:function(){var t=this.top.paintingBoardData.topNav.tools,e="eraserAiBoard"===t.hasAct,n="brush"===t.eraserTool.eraserAiBoard.hasAct;return e&&n}},watch:{"top.paintingBoardData.topNav.tools.brushTool.brushBoard":{handler:function(t){this.canvas&&this.setBrushStyle(t)},deep:!0,immediate:!0}},mounted:function(){var t=this;this.initBgCanvas(),L.a.on("openEasyEraser",this.openEasyEraser),L.a.on("closeEasyEraser",this.closeEasyEraser),L.a.on("filterColor",this.filterColor),L.a.on("initBgCanvas",this.initBgCanvas),window.addEventListener("focus",(function(){t.initBgCanvas()}))},methods:{initBgCanvas:function(){var t=this,e=this.item,n=e.layerId,o=e.width,r=e.height,l=e.canvasJson,c=l&&Object.keys(l).length;this.canvas||(this.canvas=new Ve.fabric.Canvas("live-bgcanvas-".concat(n),{width:o,height:r,selectable:!1,selection:!1,crossOrigin:"anonymous"})),c&&this.canvas.loadFromJSON(l,(function(){t.noPperateCanvas(),t.canvas.renderAll()})),this.initImg({hasProdImg:!1}),this.filterColor()},initImg:function(){var canvas=this.canvas,t=this.item.imgSrc;Ve.fabric.Image.fromURL(t,(function(img){canvas.setBackgroundImage(img,canvas.renderAll.bind(canvas),{scaleX:canvas.width/img.width,scaleY:canvas.height/img.height})}),{crossOrigin:"anonymous"})},openEasyEraser:function(){var t=this,canvas=this.canvas,e=this.item.layerId,n=this.top.paintingBoardData.topNav.tools.brushTool.brushBoard.wide;canvas.isDrawingMode=!0,canvas.freeDrawingBrush.color="#000",canvas.freeDrawingBrush.width=n/5,canvas.on("path:created",(function(n){n.path.globalCompositeOperation="destination-out";var o=canvas.toJSON();t.top.setEleItem({id:e,type:"liveLayerList",item:{canvasJson:o}}),Y.a.add(t.top.paintingBoardData),L.a.emit("liveCreateAiImg")})),this.noPperateCanvas()},setBrushStyle:function(t){console.log(t),this.canvas.freeDrawingBrush.width=t.wide/5},closeEasyEraser:function(){var canvas=this.canvas;canvas.isDrawingMode=!1,canvas.globalCompositeOperation="source-over",this.noPperateCanvas()},filterColor:function(data){var t=data||this.item,e=t.layerId,n=document.querySelector("#live-bgcanvas-"+e),style=Object(ht.i)(t);n&&(n.style.filter=style)},noPperateCanvas:function(){this.canvas.forEachObject((function(t){t.selectable=!1,t.lockUniScaling=!0,t.lockRotation=!0}))},aiEraserDrawEnd:function(t){t.item;var mask=t.mask;L.a.emit("setAiEraserLocation",{theItem:this.item,mask:mask})}}}),Rn=Mn,An=(n(2855),Object(_.a)(Rn,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.item.show,expression:"item.show"}],staticClass:"live-layer-box",style:{zIndex:t.item.z,width:t.item.width+"px",height:t.item.height+"px",transform:"translate(".concat(t.item.x,"px, ").concat(t.item.y,"px) rotate(").concat(t.item.rotate,"deg) scale(").concat(t.scaleFn,") matrix3d(").concat(t.matrix3dVal,")"),clipPath:t.item.clipPath},attrs:{id:"live-layer-".concat(t.item.layerId),"data-id":t.item.layerId,"data-type":t.item.type}},[e("div",{staticClass:"base-canvas-bg"},[e("canvas",{attrs:{id:"live-bgcanvas-".concat(t.item.layerId)}})]),t._v(" "),t.showAiEraser?e("div",{staticClass:"ai-eraser-box"},[e("ai-eraser-box",{attrs:{item:t.item},on:{drawEnd:t.aiEraserDrawEnd}})],1):t._e(),t._v(" "),e("ai-loading",{directives:[{name:"show",rawName:"v-show",value:t.item.loading,expression:"item.loading"}],attrs:{mode:"live"}})],1)}),[],!1,null,"a7e0ab78",null).exports),En=null,Nn={inject:["top"],data:function(){return{}},watch:{"top.paintingBoardData.topNav.tools.brushTool.brushBoard":{handler:function(t){En&&this.setBrushStyle(t)},deep:!0,immediate:!0}},mounted:function(){this.initBoard()},methods:{initBoard:function(){var t=document.querySelector("#liveBoardMaxBox").offsetWidth,e=document.querySelector("#liveBoardMaxBox").offsetHeight;En=new Ve.fabric.Canvas("liveBaseCanvasBox",{width:t,height:e});var n=this.top.paintingBoardData.topNav.tools.brushTool.brushBoard;En.isDrawingMode=!0,En.freeDrawingBrush.color=n.color,En.freeDrawingBrush.width=n.wide/5,this.brushToImg(En)},setBrushStyle:function(t){En.freeDrawingBrush.color=t.color,En.freeDrawingBrush.width=t.wide/5},brushToImg:function(canvas){var t,e=this,n=!1;canvas.on("mouse:down",(function(e){n=!0,t=canvas.getPointer(e.e)})),canvas.on("mouse:up",(function(){n=!1;var t=canvas.getObjects().filter((function(t){return t.isType("path")}));if(t.length>0){var o=new Ve.fabric.Group(t),r=o.getBoundingRect(),l=document.createElement("canvas");e.top.paintingBoardData.boardInfo.zoom;l.width=r.width,l.height=r.height;var c=l.getContext("2d"),d=-r.left,h=-r.top;c.translate(d,h),o.render(c);var v=l.toDataURL("image/png"),param={type:e.top.paintingBoardData.liveModel.show?"liveBrushLayer":"brushLayer",imgSrc:v,cursorX:r.left,cursorY:r.top};e.top.addLayerItem(param)}setTimeout((function(){canvas.clear()}),500)})),canvas.on("mouse:move",(function(e){if(n){var o=canvas.getPointer(e.e),path=new Ve.fabric.Path("M ".concat(t.x," ").concat(t.y," L ").concat(o.x," ").concat(o.y));canvas.add(path),t={x:o.x,y:o.y}}}))}}},Fn=(n(2856),Object(_.a)(Nn,(function(){this._self._c;return this._m(0)}),[function(){var t=this._self._c;return t("div",{staticClass:"board-max-box",attrs:{"data-drag":"no",id:"liveBoardMaxBox"}},[t("canvas",{staticClass:"base-canvas-box",attrs:{"data-drag":"no",id:"liveBaseCanvasBox",width:"100%",height:"100%"}})])}],!1,null,"4b792e9f",null).exports),Un={inject:["top"],data:function(){return{leftX:-5e3,topY:-5e3,width:0,activeList:[]}},mounted:function(){L.a.on("setLayerTopLocation",this.setLocation),L.a.on("hideLayerTopArea",this.hideArea)},methods:{setLocation:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.type,o=void 0===n?"live":n,l=e.eleKey,c=void 0===l?"liveLayerList":l,d=(this.top.paintingBoardData.boardInfo.zoom,this.top.paintingBoardData[c]);this.activeList=d.filter((function(t){return t.active}))||[];var h=this.activeList;if(0!==h.length){if(1===h.length){var v=Object(r.a)(this.activeList,1)[0],m=document.querySelector("#".concat({general:"img-",live:"live-layer-"}[o]).concat(v.layerId));if(m){var f=m.getBoundingClientRect();this.leftX=f.left,this.topY=f.top-50,this.width=f.width}}h.length>1&&setTimeout((function(){var e=document.querySelector(".moveable-area").getBoundingClientRect();t.leftX=e.left,t.topY=e.top-50,t.width=e.width}),100)}else this.hideArea()},hideArea:function(){this.leftX=-5e3,this.topY=-5e3},setAreaTop:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.topY=this.topY-t}}},Hn=Un,zn=(n(2857),Object(_.a)(Hn,(function(){var t=this;return(0,t._self._c)("div",{staticClass:"layer-top-area",style:{top:t.topY+"px",left:t.leftX+"px",width:t.width+"px"}},[t._t("default",null,{item:{width:t.width,activeList:t.activeList}})],2)}),[],!1,null,"66952cac",null).exports),Vn=n(1885),Wn={inject:["top"],props:{areaItem:{type:Object,default:function(){return{}}}},data:function(){return{size:"1024x1024"}},computed:{list:function(){var t=this.areaItem.activeList.length,e=Vn.a;return t>1&&(e=Vn.a.filter((function(t){return t.show.includes("multiple")}))),e}},watch:{areaItem:{handler:function(){this.sizeText()},deep:!0}},methods:{handleEvent:function(t,e){var n=this.areaItem.activeList;this.$emit("topBtnsClick",{event:e,type:t,list:n})},sizeText:function(){var t=this,e=this.top.paintingBoardData.liveModel.zoom,n=this.areaItem.activeList;if(n.length>1){var o=e/100;setTimeout((function(){var e=document.querySelector(".moveable-area").getBoundingClientRect(),n=parseInt(e.width/o),r=parseInt(e.height/o);t.size="".concat(n," * ").concat(r),t.top.actLayerSize=[n,r],t.top.handleSelectSize(n,r,"multiple")}),100)}if(1===n.length){var l=Object(r.a)(n,1)[0],c=parseInt(l.renderWidth),d=parseInt(l.renderHeight);this.size="".concat(c," * ").concat(d),this.top.actLayerSize=[c,d],this.top.handleSelectSize(c,d)}}}},qn=(n(2858),Object(_.a)(Wn,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"top-action-nav flex"},[e("div",{staticClass:"action-list flex",attrs:{"data-active":"no"}},t._l(t.list,(function(n){return e("div",{key:n.icon,staticClass:"item-box",attrs:{"data-active":"no"}},[e("div",{staticClass:"item flex_c_m",class:"top-btn-".concat(n.type),attrs:{"data-active":"no"},on:{click:function(e){return t.handleEvent(n.type,e)}}},[e("el-tooltip",{attrs:{effect:"dark",disabled:!n.hoverTips,content:t.$t(n.hoverTips),placement:"bottom"}},[e("i",{staticClass:"iconfont",class:n.icon,style:{fontSize:n.size},attrs:{"data-active":"no"}})])],1)])})),0)])])}),[],!1,null,"4181c3ea",null).exports),Gn={props:{icon:{type:String,default:"icon-icon_caiqie"},areaItem:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{handleClipDone:function(){var t=this.areaItem.activeList;this.$emit("topConfirm",{list:t,type:"clipOk"})}}},Yn=(n(2859),Object(_.a)(Gn,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"clip-box"},[e("div",{staticClass:"left"},[e("i",{staticClass:"iconfont",class:t.icon})]),t._v(" "),e("div",{staticClass:"right",on:{click:t.handleClipDone}},[t._v(t._s(t.$t("Done")))])])])}),[],!1,null,"0ba6c442",null).exports),Jn={inject:["top"],props:{icon:{type:String,default:"icon-icon_caiqie"}},data:function(){return{leftX:-5e3,topY:-5e3,mask:"",drawItem:{},loading:!1,taskId:""}},mounted:function(){L.a.on("setAiEraserLocation",this.setLocation),L.a.on("hideAiEraserTopArea",this.hideArea),L.a.on("setEraserLoading",this.setEraserLoading),L.a.on("setEraserTaskId",this.setEraserTaskId)},methods:{setLocation:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.type,n=void 0===e?"live":e,o=t.theItem,mask=t.mask,r=o.layerId,l=document.querySelector("#".concat({general:"img-",live:"live-layer-"}[n]).concat(r)).getBoundingClientRect();this.leftX=l.left,this.topY=l.top-50,this.width=l.width,this.drawItem=o,this.mask=mask},setEraserLoading:function(t){this.loading=t,!t&&this.hideArea()},setEraserTaskId:function(t){this.taskId=t},hideArea:function(){this.leftX=-5e3,this.topY=-5e3},handleSubmit:function(){this.$emit("onSubmit",{item:this.drawItem,maskUrl:this.mask})},handleCancel:function(){var t=this,e={action:5,task_id:this.taskId},n=this.drawItem.layerId;this.loading=!1,this.top.setEleItem({id:n,type:"liveLayerList",item:{loading:!1}}),this.hideArea(),Object(Q.h)(e).finally((function(){t.$emit("onCancel",{item:t.drawItem,maskUrl:t.mask})}))}}},Kn=Jn,Xn=(n(2860),Object(_.a)(Kn,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"top-aieraser-area",style:{top:t.topY+"px",left:t.leftX+"px"}},[e("div",{staticClass:"clip-box"},[e("div",{staticClass:"left"},[e("i",{staticClass:"iconfont",class:[t.loading?"el-icon-loading":"icon-icon_zidongcachu1"]})]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}],staticClass:"right btn-init",on:{click:t.handleSubmit}},[t._v("\n      "+t._s(t.$t("canvas_erase_hover"))+"\n    ")]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"right btn-gray",on:{click:t.handleCancel}},[t._v("\n      "+t._s(t.$t("Cancel"))+"\n    ")])])])}),[],!1,null,"f77e593a",null).exports),Qn=n(87),Zn=n(123);function ta(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function ea(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ta(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ta(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ia={inject:["top"],components:{VueInfiniteViewer:Tn.a,Moveable:Ye.a,Selecto:De.a,ImgLayer:An,RightClickMenu:gn,LayerTopArea:zn,LayerTopBtns:qn,LayerTopConfirm:Yn,TopAiEraserConfirm:Xn,MaxCanvas:Fn},props:{width:{type:String,default:"128px"},height:{type:String,default:"128px"}},data:function(){return{viewerScrollFn:Object(Qn.a)(this.viewerScrollEnd,200),viewerProps:{useMouseDrag:!1,useWheelScroll:!0,useAutoZoom:!1,zoomRange:[.1,10],margin:0},moveableProps:{draggable:!0,rotatable:!0,origin:!1,scalable:!0,resizable:!1,rotationPosition:"bottom"},keepRatio:!1,navSizeInfo:{x:0,y:0},moveableRef:null,selectoRef:null,loopInterval:null}},computed:{targets:function(){var t=this.top.paintingBoardData.liveLayerList,e=[];return t.forEach((function(t){var n=t.active,o=t.layerId,r=document.querySelector("#live-layer-".concat(o));n&&r&&e.push(r)})),e},liveInfo:function(){return this.top.paintingBoardData.liveModel},getActiveList:function(){return this.top.paintingBoardData.liveLayerList.filter((function(t){return t.active}))||[]},showTopBtn:function(){return this.getActiveList.every((function(t){return!t.cropping}))},clippable:function(){var t=Object(r.a)(this.getActiveList,1)[0],e=void 0===t?{}:t;return 1==this.getActiveList.length&&(this.keepRatio=!1,e.cropping)},showAiEraser:function(){var t=this.top.paintingBoardData.topNav.tools,e="eraserAiBoard"===t.hasAct,n="brush"===t.eraserTool.eraserAiBoard.hasAct,o=this.top.paintingBoardData.liveModel.show;return e&&n&&o},warpable:function(){var t=Object(r.a)(this.getActiveList,1)[0],e=void 0===t?{}:t;return 1==this.getActiveList.length&&(this.moveableProps.scalable=!e.freeDeformation,e.freeDeformation)},showLiveMaxCanvas:function(){var t,e=this.top.paintingBoardData.topNav.tools,n="brushBoard"===(null==e?void 0:e.hasAct),o="brush"===(null==e||null===(t=e.brushTool)||void 0===t||null===(t=t.brushBoard)||void 0===t?void 0:t.hasAct),r=this.top.paintingBoardData.liveModel.show;return n&&o&&r}},mounted:function(){this.eventAdd()},beforeDestroy:function(){clearInterval(this.loopInterval),this.loopInterval=null},methods:{initBoard:function(){var t=this;this.moveableRef=this.$refs.moveableRef,this.selectoRef=this.$refs.selectoRef,this.$nextTick((function(){t.setLiveViewer()}))},eventAdd:function(){L.a.on("setLiveMoveable",this.setLiveMoveable),L.a.on("setLiveViewer",this.setLiveViewer)},setLiveMoveable:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.top.paintingBoardData.liveModel.show){var e=this.moveableProps;this.moveableProps=ea(ea({},e),t)}},setLiveViewer:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.top.paintingBoardData.liveModel.show){var e=this.viewerProps;this.viewerProps=ea(ea({},e),t)}},viewerScroll:function(t){var e=this.top.paintingBoardData.liveModel,n=t.currentTarget._viewportElement,o=Object(ht.l)(n),r={inViewX:o.x,inViewY:o.y,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop};this.top.initLiveLayerActive(),this.$refs.liveRightClickMenu.closeMenu(),L.a.emit("hideLayerTopArea");var l=ea(ea({},e),r);this.viewerScrollFn({liveInfo:l})},viewerScrollEnd:function(t){this.top.changeData("liveModel",t.liveInfo),this.top.hasActiveHistory},onSelectStart:function(t){var e=this.top.paintingBoardData.topNav,n=this.$refs.moveableRef,o=t.inputEvent.target,r=n.isMoveableElement(o),l=this.targets.some((function(t){return t===o||t.contains(o)})),c=["selectEments"].includes(e.tools.hasAct);(r||l||!c)&&t.stop()},onSelectEnd:function(t){var e=this.$refs.moveableRef,n=Object(Nt.a)("ctrlOrCmd").active,o=this.top.paintingBoardData.liveLayerList;t.isDragStart&&(t.inputEvent.preventDefault(),e.waitToChangeTarget().then((function(){e.dragStart(t.inputEvent)}))),"no"===t.inputEvent.target.getAttribute("data-active")||(!n&&this.top.initLiveLayerActive(),t.selected.forEach((function(t){var e=t.getAttribute("data-id"),r=o.find((function(t){return t.layerId===e}));n?r&&(r.active=!r.active):r&&(r.active=!0)})),L.a.emit("setLayerTopLocation"))},onClickGroup:function(t){this.$refs.selectoRef.clickTarget(t.inputEvent,t.inputTarget)},onRenderGroup:function(t){t.events.forEach((function(t){t.target.style.cssText+=t.cssText})),L.a.emit("hideLayerTopArea"),this.$refs.liveRightClickMenu.closeMenu()},renderGroupEnd:function(t){var e=this.top.paintingBoardData.liveLayerList,n=this.liveInfo.zoom/100,o=t.events.map((function(t){var e=t.target.getAttribute("data-id"),o=document.querySelector("#live-layer-"+e).getBoundingClientRect(),l=Object(ht.r)(t.transform),c=l.translate,d=l.rotate,h=l.scale,v=Object(r.a)(c,2);return{layerId:e,x:v[0],y:v[1],rotate:d,zoom:h,renderWidth:parseInt(o.width/n),renderHeight:parseInt(o.height/n)}})),l=e.map((function(t){var e=o.find((function(em){return em.layerId===t.layerId}));return ea(ea({},t),e)}));L.a.emit("setLayerTopLocation"),this.top.changeData("liveLayerList",l),L.a.emit("liveCreateAiImg"),t.isDrag&&Y.a.add(this.top.paintingBoardData)},onDragStart:function(t){if(t.target){var e=t.target.getAttribute("data-id");this.top.getEleInfo(e,"lock","liveLayerList")&&t.stop()}},onDrag:function(t){t.target.style.transform=t.transform,this.$refs.liveRightClickMenu.closeMenu(),L.a.emit("hideLayerTopArea")},onDragEnd:function(t){if(t.lastEvent){var e=t.target.getAttribute("data-id"),n=Object(r.a)(t.lastEvent.translate,2),o=n[0],l=n[1];this.top.setEleItem({id:e,type:"liveLayerList",item:{x:o,y:l}}),L.a.emit("setLayerTopLocation"),L.a.emit("liveCreateAiImg"),Y.a.add(this.top.paintingBoardData)}},scaleGroupStart:function(t){var e=t.direction.join(""),n=this.targets.length>1;this.keepRatio=["-1-1","1-1","11","-11"].includes(e)&&n},onScaleStart:function(t){var e=t.direction.join("");this.keepRatio=["-1-1","1-1","11","-11"].includes(e);var n=t.target.getAttribute("data-id");this.top.getEleInfo(n,"lock","liveLayerList")&&t.stop()},onScale:function(t){t.target.style.transform=t.drag.transform,L.a.emit("hideLayerTopArea"),this.$refs.liveRightClickMenu.closeMenu()},onScaleEnd:function(t){if(t.lastEvent){var e=this.liveInfo.zoom,n=t.target.getAttribute("data-id"),o=t.lastEvent.scale||[],l=document.querySelector("#live-layer-"+n).getBoundingClientRect(),c=Object(r.a)(Object(ht.r)(t.lastEvent.afterTransform).translate,2),d=c[0],h=c[1],v=parseInt(l.width/(e/100)),m=parseInt(l.height/(e/100));this.top.setEleItem({id:n,type:"liveLayerList",item:{renderWidth:v,renderHeight:m,x:d,y:h,zoom:o}}),L.a.emit("setLayerTopLocation"),L.a.emit("liveCreateAiImg"),Y.a.add(this.top.paintingBoardData)}},rotateStart:function(t){var e=t.target.getAttribute("data-id");this.top.getEleInfo(e,"lock","liveLayerList")&&t.stop()},onRotate:function(t){t.target.style.transform=t.drag.transform,L.a.emit("hideLayerTopArea"),this.$refs.liveRightClickMenu.closeMenu()},onRotateEnd:function(t){if(t.lastEvent){var e=t.target.getAttribute("data-id"),n=t.lastEvent.rotate,o=Object(r.a)(Object(ht.r)(t.lastEvent.transform).translate,2),l=o[0],c=o[1];this.top.setEleItem({id:e,type:"liveLayerList",item:{rotate:n,x:l,y:c}}),L.a.emit("setLayerTopLocation"),L.a.emit("liveCreateAiImg"),Y.a.add(this.top.paintingBoardData)}},onClip:function(t){t.target.style.clipPath=t.clipStyle},onWarp:function(t){t.target.style.transform=t.transform},onWarpEnd:function(t){if(t.lastEvent){var e=t.target.getAttribute("data-id"),n=Object(ht.r)(t.lastEvent.transform).matrix3d;this.top.setEleItem({id:e,type:"liveLayerList",item:{matrix3d:n}}),L.a.emit("liveCreateAiImg"),Y.a.add(this.top.paintingBoardData)}},topBtnsClick:function(){var t=this,data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=data.event,n=data.type,o=data.list,r=!0,l=this;"more"===n&&(this.$refs.liveRightClickMenu.showMenu(e,n),setTimeout((function(){t.$refs.liveRightClickMenu.isShowMenu=!0}),0)),"del"===n&&(Zn.delLayer({that:l,isLive:r,list:o}),L.a.emit("hideLayerTopArea"),this.$refs.liveRightClickMenu.closeMenu()),"download"===n&&Zn.downLayerImg({list:o,event:e,isLive:r}),"removeBg"===n&&Zn.removeLayerBg({that:l,list:o,event:e,isLive:r}),"clip"===n&&Zn.toggleCropping({that:l,list:o,event:e,isLive:r})},topConfirm:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=data.type,e=data.list,n=!0;"clipOk"===t&&(Zn.toggleCropping({that:this,list:e,isLive:n}),Zn.croppingOk({that:this,list:e,isLive:n}))},aiEraserSubmit:function(t){Zn.aiEraserSubmit({that:this,theitem:t,isLive:!0})},aiEraserCancel:function(t){Zn.aiEraserCancel({that:this,theitem:t,isLive:!0})},rightMenuClick:function(t){var e=this.getActiveList,n=!0,o=this;"saveToMyGallery"===t&&Zn.handleSaveMaterial({that:o,list:e,isLive:n}),"upscale"===t&&Zn.handleUpscale({that:o,list:e,isLive:n}),"lockImage"===t&&Zn.toggleLockImage({that:o,list:e,isLive:n,lock:!0}),"unlockImage"===t&&Zn.toggleLockImage({that:o,list:e,isLive:n,lock:!1}),"restoreFaces"===t&&Zn.handleRestoreFaces({that:o,list:e,isLive:n}),"copy"===t&&Zn.copyLayer({that:o,list:e,isLive:n}),"freeDeformation"===t&&Zn.freeDeformation({that:o,list:e,isLive:n});["horizontalFlip","verticalFlip","clockwise90Deg","counterclockwise90Deg"].includes(t)&&(Zn.changeRunLayer({that:o,list:e,isLive:n,rightType:t}),L.a.emit("hideLayerTopArea"));["toTop","toBottom","moveUp","moveDown"].includes(t)&&Zn.changOrderLayer({that:o,list:e,isLive:n,rightType:t}),"download"===t&&Zn.downLayerImg({list:e,isLive:n}),["adjustOrder","transformTool"].includes(t)||this.$refs.liveRightClickMenu.closeMenu()},handleWheel:function(t){var e=t.ctrlKey,n=t.metaKey;t.deltaY;if(e||n){t.preventDefault()}},handleChangeZoom:function(t){var e=this.liveInfo.zoom;t?e-=10:e+=10,this.top.changeData("liveModel.zoom",e)}}},na=ia,aa=(n(2862),Object(_.a)(na,(function(){var t=this,e=t._self._c;return e("div",{style:{width:t.width,height:t.height,position:"relative"},on:{wheel:t.handleWheel}},[e("RightClickMenu",{ref:"liveRightClickMenu",attrs:{layerList:t.top.paintingBoardData.liveLayerList,actionType:"liveLayerList"},on:{rightMenuClick:t.rightMenuClick}},[e("div",{staticClass:"works-max-box",attrs:{id:"viewerAmxBoxId"}},[e("div",{staticClass:"viewport-box",attrs:{id:"viewportCanvasId"}},[t._l(t.top.paintingBoardData.liveLayerList||[],(function(n){return[["liveImgLayer","liveBrushLayer","liveProductImgLayer"].includes(n.type)?e("img-layer",{key:n.layerId,staticClass:"live-layer-item",attrs:{item:n}}):t._e()]}))],2),t._v(" "),t.showLiveMaxCanvas?e("max-canvas"):t._e()],1),t._v(" "),e("Moveable",t._b({ref:"moveableRef",attrs:{target:t.targets,keepRatio:t.keepRatio,clippable:t.clippable,warpable:t.warpable},on:{clickGroup:t.onClickGroup,renderGroup:t.onRenderGroup,renderGroupEnd:t.renderGroupEnd,dragStart:t.onDragStart,drag:t.onDrag,dragEnd:t.onDragEnd,scaleStart:t.onScaleStart,scale:t.onScale,scaleEnd:t.onScaleEnd,scaleGroupStart:t.scaleGroupStart,rotateStart:t.rotateStart,rotate:t.onRotate,rotateEnd:t.onRotateEnd,clip:t.onClip,warp:t.onWarp,warpEnd:t.onWarpEnd}},"Moveable",t.moveableProps,!1))],1),t._v(" "),e("Selecto",{ref:"selectoRef",attrs:{dragContainer:"#viewerAmxBoxId",selectableTargets:[".viewport-box .live-layer-item"],hitRate:0,selectByClick:!0,selectFromInside:!1,toggleContinueSelect:["shift"],ratio:0},on:{dragStart:t.onSelectStart,selectEnd:t.onSelectEnd}}),t._v(" "),e("layer-top-area",{directives:[{name:"show",rawName:"v-show",value:t.showTopBtn,expression:"showTopBtn"}],scopedSlots:t._u([{key:"default",fn:function(n){var o=n.item;return[e("layer-top-btns",{attrs:{areaItem:o},on:{topBtnsClick:t.topBtnsClick}})]}}])}),t._v(" "),e("layer-top-area",{directives:[{name:"show",rawName:"v-show",value:t.clippable,expression:"clippable"}],scopedSlots:t._u([{key:"default",fn:function(n){var o=n.item;return[e("layer-top-confirm",{attrs:{areaItem:o,icon:"icon-icon_caiqie"},on:{topConfirm:t.topConfirm}})]}}])}),t._v(" "),e("top-ai-eraser-confirm",{directives:[{name:"show",rawName:"v-show",value:t.showAiEraser,expression:"showAiEraser"}],attrs:{icon:"icon-icon_caiqie"},on:{onSubmit:t.aiEraserSubmit,onCancel:t.aiEraserCancel}})],1)}),[],!1,null,"4e2274aa",null).exports),oa=null,sa={inject:["top"],data:function(){return{}},watch:{redrawBoard:{handler:function(t){oa&&this.setBrushStyle(t)},deep:!0,immediate:!0}},computed:{redrawBoard:function(){return this.top.paintingBoardData.topNav.tools.daubTool.redrawBoard}},mounted:function(){this.initBoard(),L.a.on("openRedrawEraser",this.openRedrawEraser),L.a.on("closeRedrawEraser",this.closeRedrawEraser)},methods:{initBoard:function(){var t=this,e=document.querySelector("#RedrawingAreaId").offsetWidth,n=document.querySelector("#RedrawingAreaId").offsetHeight;oa=new Ve.fabric.Canvas("liveRedrawingBox",{width:e,height:n});var o=this.redrawBoard;oa.isDrawingMode=!0,oa.freeDrawingBrush.color="#fff",oa.freeDrawingBrush.width=o.wide/5,"eraser"===o.hasAct?this.openRedrawEraser():this.closeRedrawEraser(),oa.on("after:render",(function(e){setTimeout((function(){var e=oa.lowerCanvasEl.toDataURL("image/png");Object(ht.q)(e,(function(e){var n=e.replace("data:image/png;base64,","");t.top.paintingBoardData.liveModel.product_image_url?t.top.changeData("liveModel.pmask",n):t.top.changeData("liveModel.mask",n),L.a.emit("getProductMask")}))}),0)}))},openRedrawEraser:function(){oa.on("path:created",(function(t){t.path.globalCompositeOperation="destination-out"}))},closeRedrawEraser:function(){oa.on("path:created",(function(t){t.path.globalCompositeOperation="source-over"}))},setBrushStyle:function(t){oa.freeDrawingBrush.color="#fff",oa.freeDrawingBrush.width=t.wide/5}}},ra=(n(2863),Object(_.a)(sa,(function(){this._self._c;return this._m(0)}),[function(){var t=this._self._c;return t("div",{staticClass:"board-max-box",attrs:{"data-drag":"no",id:"RedrawingAreaId"}},[t("canvas",{staticClass:"base-canvas-box",attrs:{"data-drag":"no",id:"liveRedrawingBox",width:"100%",height:"100%"}})])}],!1,null,"7e019434",null).exports);function la(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var ca={inject:["top"],components:{AiLoading:Zi},data:function(){return{oldParams:{}}},computed:{liveInfo:function(){return this.top.paintingBoardData.liveModel},size:function(){var t=this.liveInfo,e=t.x,n=t.y,o=t.width,r=t.height,l=t.show;return{x:e,y:n,width:o,height:r,zoom:(this.top.paintingBoardData.boardInfo||{}).zoom,show:l}},liveLoading:function(){return this.top.liveProdLoading},watchParams:function(){var t=this.top.paintingBoardData;return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?la(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):la(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({basicParams:t.basicParams},t.currentParams)}},watch:{"liveInfo.result":function(t){t&&this.setLoading(!0)},watchParams:{handler:function(t){this.paramsChange(t)},deep:!0}},methods:{paramsChange:function(t){var e,n=this.getChangeType(t),o=this.top.paramsLoading,r="default"===n||"live"===n||""===n;this.oldParams=JSON.parse(JSON.stringify(t)),null!==(e=this.liveInfo)&&void 0!==e&&e.show&&r&&!o&&(L.a.emit("setHasActiveHistory",!1),L.a.emit("liveCreateAiImg"))},getChangeType:function(t){var e=t.samplerSettingsDefault,n=t.samplerSettingsLive,o=this.oldParams||{},r=o.samplerSettingsDefault,l=o.samplerSettingsLive;return l?JSON.stringify(e)!==JSON.stringify(r)?"default":JSON.stringify(n)!==JSON.stringify(l)?"live":"":"first"},setLoading:function(t){this.top.liveProdLoading=t},saveLayer:function(){var t=this.liveInfo,e=t.width,n=t.height,o=t.result,data={type:this.top.paintingBoardData.liveModel.show?"liveImgLayer":"imgLayer",imgSrc:o,width:e,height:n,aiCreateImg:!1};this.top.addLayerItem(data)},downloadImg:function(){var t=this.liveInfo.result;Object(bt.z)(t)},layerActiveFalse:function(){L.a.emit("hideLayerTopArea"),this.top.initLiveLayerActive()}}},ua=ca,da=(n(2864),Object(_.a)(ua,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"live-result-box"},[e("div",{staticClass:"resultimg-box",on:{click:t.layerActiveFalse}},[e("img",{directives:[{name:"show",rawName:"v-show",value:t.liveInfo.result,expression:"liveInfo.result"}],staticClass:"result-img",attrs:{src:t.liveInfo.result,alt:"",draggable:"false"},on:{load:function(e){return t.setLoading(!1)},error:function(e){return t.setLoading(!1)}}})]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.liveInfo.result,expression:"liveInfo.result"}],staticClass:"handle"},[e("el-tooltip",{attrs:{effect:"dark",content:t.$t("canvas_save_hover")}},[e("i",{staticClass:"iconfont icon-icon_yijianxintuceng",on:{click:t.saveLayer}})]),t._v(" "),e("el-tooltip",{attrs:{effect:"dark",content:t.$t("Download")}},[e("i",{staticClass:"iconfont icon-icon_xiazai",on:{click:t.downloadImg}})])],1),t._v(" "),e("ai-loading",{directives:[{name:"show",rawName:"v-show",value:t.liveLoading,expression:"liveLoading"}],attrs:{mode:"no"}})],1)}),[],!1,null,"f27f009a",null).exports),ha=n(2010),pa=n(1886);function va(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function ma(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?va(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):va(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var fa={inject:["top"],components:{LiveSize:$n,Moveable:Ye.a,LiveBoard:aa,RedrawingArea:ra,ResultImg:da,LineLoading:un.a},data:function(){return{liveTargetRef:null,resultImgRef:null,drawLiveLeftRef:null,loopInterval:null,liveCreateAiImgFn:Object(Qn.a)(this.liveCreateAiImg,500),stopLiveProd:!1,screenshotIng:!1,liveY:0}},computed:{liveInfo:function(){return this.top.paintingBoardData.liveModel},liveW:function(){var t=this.top.paintingBoardData.liveModel.width,e=this.getRatio(),n=parseInt(t/e);return"".concat(n,"px")},liveH:function(){var t=this.top.paintingBoardData.liveModel.height,e=this.getRatio(),n=parseInt(t/e);return"".concat(n,"px")},showLiveRedrawing:function(){var t=this.top.paintingBoardData.topNav.tools,e="daubBoard"===(null==t?void 0:t.hasAct),n=this.top.paintingBoardData.liveModel.show;return e&&n}},watch:{"liveInfo.width":function(){this.updateRect()},"liveInfo.height":function(){this.updateRect()}},mounted:function(){this.liveTargetRef=this.$refs.liveTargetRef,this.resultImgRef=this.$refs.resultImgRef,this.drawLiveLeftRef=this.$refs.drawLiveLeftRef,L.a.on("liveCreateAiImg",this.liveCreateAiImgFn),L.a.on("setScreenshotIng",this.setScreenshotIng),L.a.on("getProductMask",this.getProductMask),document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyUp),this.setLiveY(),this.stopLiveProd="yes"===window.localStorage.getItem("stopLiveProd")},beforeDestroy:function(){clearInterval(this.loopInterval),this.loopInterval=null,document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyUp)},methods:{setLiveY:function(){var t=document.querySelector("#liveMaxboxId").clientHeight,e=(document.querySelector("#liveModelViewId").clientHeight-t)/2;this.liveY=e},getRatio:function(){var t=this.top.paintingBoardData.liveModel,e=t.width,n=t.height;return Math.max.apply(Math,[e,n])/568},onResizeStart:function(t){var e=this.liveInfo,n=parseInt(e.min/this.top.liveBoxRatio),o=parseInt(e.max/this.top.liveBoxRatio);t.setMin([n,n]),t.setMax([o,o]),this.top.initLiveLayerActive()},onResize:function(t){var e=t.width,n=t.height,o="".concat(e,"px"),r="".concat(n,"px");t.target.style.width=o,t.target.style.height=r,this.resultImgRef.style.width=o,this.resultImgRef.style.height=r,this.drawLiveLeftRef.style.width=o,this.$refs.liveSizeRef.showSizeInput(parseInt(e*this.top.liveBoxRatio))},updateRect:function(){var t=this;this.$nextTick((function(){t.$refs.liveMaxMoveableRef.updateRect()}))},onResizeEnd:function(t){if(t.lastEvent){var e=t.lastEvent,n=e.width,o=e.height;this.top.changeData("liveModel.width",parseInt(n*this.top.liveBoxRatio)),this.top.changeData("liveModel.height",parseInt(o*this.top.liveBoxRatio)),Y.a.add(this.top.paintingBoardData),this.liveCreateAiImgFn()}},prodAiImg:function(){Y.a.add(this.top.paintingBoardData),this.liveCreateAiImgFn()},toggleSwitch:function(){this.stopLiveProd=!this.stopLiveProd;var t=this.stopLiveProd?"yes":"no";window.localStorage.setItem("stopLiveProd",t),this.stopLiveProd||this.liveCreateAiImg()},setScreenshotIng:function(t){this.screenshotIng=t},whereProdImg:function(t){var meta=t.meta,e=Q.t;return t.product_image_url&&!meta.inpaint_mask&&(e=Q.d),t.product_image_url&&meta.inpaint_mask&&(e=Q.e),!t.product_image_url&&meta.mask&&(e=Q.f),((this.top.paintingBoardData.liveLayerList||[]).filter((function(t){return"liveBrushLayer"===t.type}))||[]).length&&(e=Q.c),e},liveCreateAiImg:function(){var t=this,e=this.stopLiveProd;if(!e){var n=this.top.paintingBoardData.liveLayerList,o=this.top,r=o.liveProdLoading,c=o.hasActiveHistory,d=r||c||e,h=this.liveInfo;if(!d){this.top.liveProdLoading=!0,this.top.processStep={step:"start",process:0,text:"TaskStatusPreparing"};var v=document.querySelector("#viewerAmxBoxId");Object(ht.e)({element:v,openSize:!0},(function(e){var o={width:h.width,height:h.height,imgUrl:e};Object(ht.o)(o,function(){var o=Object(l.a)(regeneratorRuntime.mark((function o(r){var l,c,d,h,v,m,f,_;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(ht.s)(r);case 2:return l=o.sent,t.top.paintingBoardData.liveModel.cutUrl=l,c=t.getParams(),o.next=7,t.handleParamsMask(c,t.liveInfo);case 7:return o.next=9,Object(ht.c)(e);case 9:if(d=o.sent,h=t.whereProdImg(c),d&&(h=Q.u,c.image_url=""),v=n.some((function(t){return"liveImgLayer"===t.type})),m=n.some((function(t){return"liveBrushLayer"===t.type})),!v||!m){o.next=22;break}return o.next=17,t.getBrushMaskFn();case 17:return f=o.sent,o.next=20,Object(ht.s)(f);case 20:_=o.sent,c.brush_url=_;case 22:if(!d||t.liveInfo.prompt){o.next=25;break}return t.top.liveProdLoading=!1,o.abrupt("return");case 25:h(c).then((function(e){var data=e.data;t.liveInfo.params=ma(ma({},c),{},{taskId:data.id}),t.liveInfo.taskId=data.id,Object(ha.b)({task_id:data.id,that:t},{success:function(data){t.liveInfo.result=data.img_uris[0].url,t.top.liveProdLoading=!1},error:function(){t.top.liveProdLoading=!1}})})).catch((function(){t.top.liveProdLoading=!1}));case 26:case"end":return o.stop()}}),o)})));return function(t){return o.apply(this,arguments)}}())}))}}},getBrushMaskFn:function(){var t=this.top.paintingBoardData,e=t.liveLayerList,n=t.liveModel,o=e.filter((function(t){return"liveBrushLayer"===t.type}));return Object(ht.g)(o,n)},getParams:function(){var t=this.top.paintingBoardData,e=t.selectedParams,n=t.currentParams,o=t.basicParams,r=o.denoisingStrength,l=o.imagesNumber,c=o.randomSeed,d=o.brushWeight,h=t.imageToImage.imgUrl,v=n.modelInfo,m=v.id,f=v.model_ver_no,_=n.selectedLora,y=n.stylePrompt,w=n.negativePrompt,C=n.vae;this.getProductMask();var k=this.liveInfo,O=(null==k?void 0:k.cutUrl)||h,x=n.samplerSettingsLive,I=x.CFGScale,D=x.samplingSteps,S=x.samplingMethod,P=this.getLoraParams(_),mask=null==k?void 0:k.mask,L=null==k?void 0:k.pmask,j={width:parseInt(k.width),height:parseInt(k.height)},$=this.getPrompt(y,k),T=mask?[]:this.getControlNetParams(),B={template_id:e,art_model_no:m,art_model_ver_no:f,mode:2,product_image_url:null==k?void 0:k.product_image_url,brush_url:"",meta:ma({control_nets:T,cfg_scale:I,denoising_strength:r,brush_weight:d,lora_models:P,mask:mask,inpaint_mask:L,n_iter:l,negative_prompt:w,prompt:$,sampler_name:S,steps:D,vae:C,seed:c},j)};return O&&(B.image_url=O),B},getLoraParams:function(t){return null!=t&&t.length?t.map((function(t){return{model_id:t.id,model_ver_no:t.model_ver_no,weight:t.weights}})):[]},getPrompt:function(t,e){return(null==t?void 0:t.includes("{prompt}"))?t.replace("{prompt}",null==e?void 0:e.prompt):null!=e&&e.prompt?t+","+e.prompt:t},getControlNetParams:function(){var t=this.top.paintingBoardData.controlNet.controlnet_units||[];return"Generate"!==this.top.leftActiveTab?[]:t.filter((function(t){return t.enable&&t.input_image})).map((function(t){return{image_url:t.input_image,mode:t.module,strength:t.weight,id:t.id}}))},handleParamsMask:function(t,e){var n=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.meta.control_nets,r=[],o.forEach((function(t){var e=t.image_url,o=t.id;e.startsWith("data:image")?r.push(Object(ht.s)(e).then((function(e){t.image_url=e,n.uploadControlNets(o,e),delete t.id}))):delete t.id})),e.abrupt("return",Promise.all(r));case 4:case"end":return e.stop()}}),e)})))()},uploadControlNets:function(t,e){var n=this.top.paintingBoardData.controlNet.controlnet_units.find((function(e){return e.id===t}));n&&(n.image_url=e)},getProductMask:function(){var t=this.top.paintingBoardData,e=t.liveLayerList,n=t.liveModel,o=e.find((function(t){return"liveProductImgLayer"===t.type}));n.width,n.height,n.zoom;if(o){var r=document.querySelector("#viewerAmxBoxId").getBoundingClientRect(),l=document.querySelector("#live-layer-"+o.layerId).getBoundingClientRect(),c=l.left-r.left,d=l.top-r.top,param={width:r.width,height:r.height,b_w:l.width,b_h:l.height,b_x:c,b_y:d},mask=Object(ht.f)(param).replace("data:image/png;base64,","");this.top.changeData("liveModel.product_image_url",o.imgSrc),this.top.changeData("liveModel.mask",mask)}},handleKeydown:function(t){var param={that:this,event:t,RM:Zn,EventEmitterNew:L.a};Object(pa.b)(param)},handleKeyUp:function(t){if(this.liveInfo.show){var param={that:this,event:t,RM:Zn,EventEmitterNew:L.a};Object(pa.a)(param)}},focusPrompt:function(){L.a.emit("hideLayerTopArea"),this.top.initLiveLayerActive()},clickMask:function(){L.a.emit("hideLayerTopArea"),this.top.initLiveLayerActive()},goPosterPage:function(){var t=this.top.currentCanvas;this.$logEvent("log_actions",{operation:"click_add_text",behavior_info:"on_canvas_fuction_page"}),this.$router.push({path:this.localePath("/posterBoard"),query:{id:t,live:"yes"}})},handleMouseWheel:function(t){t.preventDefault(),t.deltaY<0?this.liveY+=50:this.liveY-=50}}},ga=fa,ba=(n(2865),Object(_.a)(ga,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"live-model-box flex_c",attrs:{id:"liveModelViewId"},on:{wheel:t.handleMouseWheel}},[e("div",{staticClass:"mask-box",class:{"mask-box-black":t.top.paintingBoardData.liveModel.show},on:{click:t.clickMask}}),t._v(" "),e("div",{staticClass:"live-box",style:{top:t.liveY+"px"},attrs:{id:"liveMaxboxId"}},[e("div",{staticClass:"head-nav flex"},[e("div",{staticClass:"left"},[e("live-size",{ref:"liveSizeRef",attrs:{switchLive:t.stopLiveProd},on:{toggleSwitch:t.toggleSwitch}})],1),t._v(" "),e("div",{staticClass:"right flex_lr_m"},[e("div",{staticClass:"left"},[e("span",{staticClass:"title"},[t._v(t._s(t.$t("preview")))])]),t._v(" "),e("div",{staticClass:"right flex"},[e("div",{staticClass:"item flex_m",on:{click:t.goPosterPage}},[t._m(0),t._v(" "),e("span",[t._v(t._s(t.$t("addText")))])])])])]),t._v(" "),e("div",{staticClass:"draw-canvas-box flex"},[e("div",{ref:"drawLiveLeftRef",staticClass:"left",style:{width:t.liveW}},[e("div",{ref:"liveTargetRef",staticClass:"live-canvas-box",style:{width:t.liveW,height:t.liveH}},[e("live-board",{attrs:{width:t.liveW,height:t.liveH}}),t._v(" "),t.showLiveRedrawing?e("redrawing-area"):t._e()],1),t._v(" "),e("div",{staticClass:"live-prompt"},[e("el-input",{attrs:{type:"textarea",placeholder:t.$t("PromptNotEmpty"),rows:2,resize:"none"},on:{focus:t.focusPrompt,change:t.prodAiImg,blur:t.prodAiImg},model:{value:t.liveInfo.prompt,callback:function(e){t.$set(t.liveInfo,"prompt",e)},expression:"liveInfo.prompt"}})],1),t._v(" "),e("line-loading",{directives:[{name:"show",rawName:"v-show",value:t.screenshotIng,expression:"screenshotIng"}],staticClass:"screenshot-lod"})],1),t._v(" "),e("div",{staticClass:"line"}),t._v(" "),e("div",{ref:"resultImgRef",staticClass:"right",style:{width:t.liveW,height:t.liveH}},[e("result-img")],1)])]),t._v(" "),e("Moveable",{ref:"liveMaxMoveableRef",attrs:{resizable:!0,keepRatio:!1,origin:!1,throttleResize:1},on:{resizeStart:t.onResizeStart,resize:t.onResize,resizeEnd:t.onResizeEnd}})],1)}),[function(){var t=this._self._c;return t("div",{staticClass:"add-icon flex_c_m"},[t("i",{staticClass:"el-icon-plus"})])}],!1,null,"c87411e2",null).exports);function _a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function ya(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_a(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var wa={components:{LoadingStatus:d.a,TopNav:at,LeftMenu:Zt,RightParams:xe,BoardBox:kn,ReplaceTemplateDialog:wt,TeachViedoPop:Ln,LiveModel:ba},provide:function(){return{top:this}},data:function(){return{dataReady:!1,paramsLoading:!0,dataUpdated:!0,isChangeBoardData:!1,isAlreadyRepelaceTemplate:!1,currentCanvas:"",canvasList:[],viewerClass:null,layerFooterRef:null,eventFn:{setBoardNoDage:null,setBoardYesDage:null,setViewYesDage:null,uploadImg:null,layerBtnsSetPoin:null,initBordPoin:null,submitPublish:null,controlNetDisable:null},paintingBoardData:ya({},On.b),pollingTimer:null,canvasLoading:!1,normalUpdate:!0,loopInterval:null,loopTime:0,isVipExpired:!1,liveBoxRef:null,moveableRef:null,aiimgBoxRef:null,isDrawSame:!1,selectSize:"",isShowTeachVideo:!1,generateType:-1,oldImgNum:0,fromPath:"",liveProdLoading:!1,hasActiveHistory:!1,actLayerSize:[0,0],liveBoxRatio:2.7,processStep:{step:"start",process:0,text:"TaskStatusPreparing"},leftActiveTab:"Product",token:""}},beforeRouteEnter:function(t,e,n){n((function(t){t.fromPath=e.name}))},computed:ya(ya({},Object(h.c)("user",["cdnHostFun"])),{},{isMacOs:function(){return navigator.platform.includes("Mac")?"⇧":"Shift"},rightElementList:function(){var t=this.paintingBoardData.liveModel.show;return this.paintingBoardData[t?"liveLayerList":"elementList"]},NEZoom:function(){return 1/this.paintingBoardData.boardInfo.zoom}}),mounted:function(){var t=this;this.token=this.$cookies.get("T"),this.getIsShowTeachVideo();var e=this.$route.query.id,n=void 0===e?"":e,o="";n&&(o=n,this.clearRouterQuery()),this.token,this.getCanvasList(o),this.loopInterval=setInterval((function(){t.loopTime++,360==t.loopTime&&t.saveCanvasCover(),t.saveCanvas()}),5e3),document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyUp),L.a.on("setHasActiveHistory",this.setHasActiveHistory)},beforeDestroy:function(){clearInterval(this.loopInterval),this.loopInterval=null,clearTimeout(),document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyUp),Object(Nt.b)()},watch:{dataReady:function(t){var e=this;t&&this.$nextTick((function(){e.init()}))},paintingBoardData:{handler:function(t){this.dataUpdated=!0,this.isChangeBoardData=!0,this.isAlreadyRepelaceTemplate=!1},deep:!0},"paintingBoardData.liveModel.show":{handler:function(t){this.changeControlNetShowStatus(t),this.checkRedrawStatus(t)}}},methods:ya(ya({},Object(h.b)("creation",["getTaskOptionsInfo"])),{},{sameStyleGenerate:function(t){Object(Q.H)({tpl_id:t}).then((function(t){}))},checkRedrawStatus:function(t){this.paintingBoardData.topNav.tools.hasAct;var e=this.paintingBoardData.topNav.tools.daubTool.redrawBoard.hasAct;t?(this.paintingBoardData.elementList||[]).forEach((function(t){t.mask="",t.hasRedraw=!1})):this.paintingBoardData.liveModel.mask="",t&&["segment"].includes(e)&&this.changeData("topNav.tools.daubTool.redrawBoard.hasAct","brush")},clearRouterQuery:function(){var t=window.location.href.split("?")[0],path=this.$route.path;this.$router.replace(path),window.history.replaceState(null,"",t)},frontendDelCanvas:function(t){this.canvasList=this.canvasList.filter((function(e){return e.id!=t}))},getCanvasList:function(t){var e=this;if(!this.token)return this.dataReady=!0,void(this.canvasList=[{id:"",locking:!1,name:"default",select:!1,type:1}]);var n=this.$route.query.remix_id,o=void 0===n?"":n;Object(Q.A)({id:t}).then((function(t){var n=t.data.items;e.canvasList=n||[],e.currentCanvas=n.find((function(t){return o?"default"===t.name:t.select})).id,1===n.length&&n[0].use_template?e.getTplDetailHttp(n[0].use_template):e.getCanvasDetail(e.currentCanvas)}))},getCanvasDetail:function(t){var e,n=this;this.dataReady=!1,this.currentCanvas=t,this.isVipExpired=null===(e=this.canvasList.find((function(e){return t===e.id})))||void 0===e?void 0:e.locking,Object(Q.z)({id:t}).then((function(t){var e=t.data.json_str;n.repalceCanvasJsonStr(e),n.fromDrawSame()}))},repalceCanvasJsonStr:function(t){var e,n=this,o="string"==typeof t?JSON.parse(t):t,r=ya(ya({},On.b),o);r.liveLayerList=r.liveLayerList||[],r.topNav.tools.hasAct=r.liveModel.show?"selectEments":"updateArimg",Object(xn.b)(r.liveModel),Object(xn.a)(r),r.basicParams.brushWeight=null!==(e=o.basicParams.brushWeight)&&void 0!==e?e:1,this.paintingBoardData=r,Y.a.add(r),this.dataReady=!0,this.$forceUpdate(),setTimeout((function(){n.isChangeBoardData=!1,n.isAlreadyRepelaceTemplate=!0,n.eventFn.setBoardYesDage&&(n.eventFn.setBoardYesDage(),n.eventFn.setViewYesDage(!1))}),500)},fromDrawSame:function(){var t=this.$route.query,e=t.remix_id,n=void 0===e?"":e,o=t.publish_type,r=void 0===o?"":o;if(n){if(this.isDrawSame=!1,this.sameStyleGenerate(n),1==r||0===this.paintingBoardData.elementList.length)return this.getTplDetailHttp(n);this.$refs.replaceDialog.openDialog(n,!0)}},getTplDetailHttp:function(t){var e=this;this.paramsLoading=!0;var n=this.paintingBoardData.liveModel.show;Object(Q.C)({id:t}).then((function(t){var o=t.data,r=o.json_str,l=o.publish_type,c=o.cover;if(1===l)e.changeData("topNav.tools.hasAct","selectEments"),e.addLayerItem({type:n?"liveImgLayer":"imgLayer",imgSrc:c});else if(r){var d=Object(xn.c)(t);e.repalceCanvasJsonStr(d),e.$nextTick((function(){e.init()}))}else e.$message.error("模板暂不可用");e.$route.query.remix_id&&e.clearRouterQuery(),e.dataReady=!0}))},getIsShowTeachVideo:function(){var t=localStorage.getItem("CanvasTeachVideo");if(!t)return this.isShowTeachVideo=!0;if("neverRemind"!==t&&t){var e=(new Date).getTime();this.isShowTeachVideo=e-t>864e5}},saveCanvas:function(){var t=this;this.token&&this.dataUpdated&&Object(Q.J)({id:this.currentCanvas,json_str:this.handleSaveData(this.paintingBoardData)}).then((function(){t.dataUpdated=!1}))},saveCanvasCover:function(){var t=this,element=document.querySelector("#canvas-box"),e=window,o=e.innerWidth,r=e.innerHeight;n(569)(element,{width:o,height:r,useCORS:!0,allowTaint:!1}).then(function(){var e=Object(l.a)(regeneratorRuntime.mark((function e(canvas){var n,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=canvas.toDataURL(),l=n,e.prev=2,e.next=5,Object(ht.s)(n);case 5:l=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log("error",e.t0);case 11:return e.abrupt("return",Object(Q.J)({id:t.currentCanvas,cover:{uri:l,width:o,height:r}}));case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()).then((function(){t.loopTime=0})).catch((function(e){console.log("err",e),t.loopTime=0}))},handleSaveData:function(data){var t=JSON.parse(JSON.stringify(data)),e=t.liveModel,n=t.elementList,o=t.generateInfo;return e.loading=!1,o.loading=!1,e.active=!1,t.elementList=n.map((function(t){return t.loading=!1,t})),JSON.stringify(t)},init:function(){var t,e=(null===(t=this.paintingBoardData)||void 0===t?void 0:t.liveModel)||{};e.x,e.y;this.getTaskOptionsInfo(),localStorage.removeItem("uploadPathList")},setLiveLocal:function(t){var e=this,n=this.paintingBoardData,o=n.liveModel,r=n.boardInfo,l=r.scrollLeft,c=r.scrollTop,d=r.zoom,h=(r.inViewX,r.inViewY,o.width),v=o.height,m=o.x,f=o.y,_=document.getElementById("canvas-container");if(_){var y=_.offsetWidth,w=_.offsetHeight,C=document.querySelector("#liveItemBox");m=t?(y/d-h)/2+l-290:m,f=t?(w/d-v)/2+c:f,o.x=m,o.y=f,C.style="transform: translate(".concat(m,"px, ").concat(f,"px); width: ").concat(h,"px; height:").concat(v,"px;z-index: -9999"),this.$nextTick((function(){var t;null===(t=e.liveBoxRef)||void 0===t||t.updateRect()}))}},changeActiveControlNet:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.paintingBoardData.controlNet.activeIndex=t},changeControlNetShowStatus:function(t){var e=this,n=this.paintingBoardData.controlNet.controlnet_units.map((function(t){return t.id})).filter((function(t){return!!t})),o=this.paintingBoardData.controlNet.activeIndex||"";(n||[]).forEach((function(t){e.paintingBoardData.elementList.forEach((function(n){if(n&&n.controlNetId&&n.controlNetId===t){var r=n.controlNetId===o&&e.paintingBoardData.liveModel.show;e.$set(n,"show",r)}}))}))},hideOtherControlNet:function(t){var e=this,n=this.paintingBoardData.controlNet.controlnet_units.map((function(t){return t.id})).filter((function(t){return!!t})),o=this.paintingBoardData.controlNet.activeIndex||"";(n||[]).forEach((function(n){e.paintingBoardData.elementList.forEach((function(r){if(r&&r.controlNetId&&r.controlNetId===n){var l=r.controlNetId===t&&e.paintingBoardData.liveModel.show&&r.controlNetId===o;e.$set(r,"show",l)}}))}))},deleteImageLayer:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.paintingBoardData.elementList.findIndex((function(e){return e.layerId===t}));this.normalUpdate=!0,-1!==e&&this.paintingBoardData.elementList.splice(e,1)},changeData:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";if(this.normalUpdate="normal"===n,"string"==typeof t)if(t.includes(".")){var o=t.split(".");this.recursionModify(o,this.paintingBoardData,e)}else{var l=Object.keys(this.paintingBoardData);if(t.includes("[")){var c=this.splitString(t,"["),d=Object(r.a)(c,2),h=d[0],v=d[1],m=l.includes(h),f=v.match(/\d+/g),_=0;f?_=Number(f[0]):this.logError("paintingBoardData没有该属性"),m?this.$set(this.paintingBoardData[h],_,e):this.logError("paintingBoardData没有该属性")}else{l.includes(t)?this.$set(this.paintingBoardData,t,e):this.logError("paintingBoardData没有该属性")}}else this.logError("key必须是字符串")},recursionModify:function(t,data,e){var n=t.shift(),o=Object.keys(data);if(n.includes("[")){var l=this.splitString(n,"["),c=Object(r.a)(l,2),d=c[0],h=c[1],v=o.includes(d),m=h.match(/\d+/g),f=0;return m?(f=Number(m[0]),v?0===t.length?void(data[d][f]=e):this.recursionModify(t,data[d][f],e):void this.logError("key中子属性错误")):void this.logError("key中子属性错误")}return o.includes(n)?0===t.length?void(data[n]=e):this.recursionModify(t,data[n],e):void this.logError("key中子属性错误")},splitString:function(t,e){var n=t.indexOf(e);return-1!==n?[t.slice(0,n),t.slice(n)]:[t,""]},logError:function(t){},updateLayerList:function(t){this.normalUpdate=!0,this.paintingBoardData.elementList=t},brushMax:function(t){var e=1;e=this.paintingBoardData.liveModel.show?this.paintingBoardData.liveModel.zoom/100:this.paintingBoardData.boardInfo.zoom;var n=0;return t<1&&(n=t+(t-t*e)),t>1&&(n=t/e),n},addLayerItem:function(){var t=arguments,e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var r,l,c,d,h,v,m,f,_,y,w,C,k,O,x,I,D,S,P,j,$,T,B,M,R,A,E,N,F,U,H,z,V,W,G,J,K,X,Q,Z;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return l=(r=t.length>0&&void 0!==t[0]?t[0]:{}).type,c=void 0===l?"imgLayer":l,d=r.imgSrc,h=void 0===d?"":d,v=r.cursorX,m=r.cursorY,f=r.x,_=r.y,y=r.z,w=void 0===y?"":y,C=r.width,k=r.height,O=r.zoom,x=void 0===O?1:O,I=r.customConfig,D=void 0===I?{}:I,S=r.loading,P=void 0!==S&&S,j=r.params,$=void 0===j?{}:j,T=r.isProduct,B=void 0!==T&&T,M=r.aiCreateImg,R=void 0===M||M,A=t.length>1?t[1]:void 0,E=[],N=["liveImgLayer","liveBrushLayer","liveProductImgLayer"].includes(c),E=N?e.paintingBoardData.liveLayerList||[]:e.paintingBoardData.elementList||[],n.next=7,Object(bt.l)(h);case 7:return F=n.sent,U=F.width,H=F.height,z={width:C||U,height:k||H,realWidth:U,realHeight:H,renderWidth:C||0,renderHeight:k||0},C||(z=e.getLayerSize(c,ya(ya({},z),{},{width:U,height:H}))),V=e.paintingBoardData[N?"liveModel":"boardInfo"],W=Object(ht.k)(ya(ya({},V),{},{type:c,cursorX:v,cursorY:m,imgW:z.width,imgH:z.height})),G=W.layerX,J=W.layerY,K=E.map((function(t){return t.z})),K=B?K.filter((function(t){return t>1e4})):K.filter((function(t){return t<1e4})),X=E.length&&K.length?Math.max.apply(Math,Object(o.a)(K)):B?1e4:0,Q=X+1,Z=ya(ya(ya(ya({},On.a),{},{type:c,imgSrc:h,layerId:Object(ht.j)(),name:e.$t("Layer")+Q,z:w||Q},z),{},{mask:""},D),{},{x:void 0!==f?f:G,y:void 0!==_?_:J,loading:P,params:$,zoom:x,moveing:!1}),e.normalUpdate=!0,["liveImgLayer","liveBrushLayer","liveProductImgLayer"].includes(c)?(e.$set(e.paintingBoardData.liveLayerList,E.length,Z),e.$nextTick((function(){Y.a.add(e.paintingBoardData),R&&L.a.emit("liveCreateAiImg")}))):e.$set(e.paintingBoardData.elementList,E.length,Z),A&&A(Z),n.abrupt("return",Z.layerId);case 23:case"end":return n.stop()}}),n)})))()},setLayerImg:function(t,e){var n=this.paintingBoardData.liveModel.show?"liveLayerList":"elementList",o=this.paintingBoardData[n].find((function(e){return e.layerId===t}));o.imgSrc=e,o.loading=!1},getLayerSize:function(t,e){var n=e.width,o=e.height,r=this.paintingBoardData.liveModel.show?600:800,l=["imgLayer","controlNetLayer","liveImgLayer","liveProductImgLayer"].includes(t)?r:this.brushMax(n),c=["imgLayer","controlNetLayer","liveImgLayer","liveProductImgLayer"].includes(t)?o/(n/r):this.brushMax(o);return ya(ya({},e),{},{width:l,height:c,renderWidth:l,renderHeight:c})},setViewer:function(data){this.viewerClass=data},handleParamsMask:function(t,e){var n=this;return Object(l.a)(regeneratorRuntime.mark((function o(){var r,l;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return r=t.meta.control_nets,l=[],e.mask&&e.mask.startsWith("data:image")&&(t.meta.mask=e.mask.split("data:image/png;base64,")[1]),r.forEach((function(t){var e=t.image_url,o=t.id;e.startsWith("data:image")?l.push(Object(ht.s)(e).then((function(e){t.image_url=e,n.uploadControlNets(o,e),delete t.id}))):delete t.id})),o.abrupt("return",Promise.all(l));case 5:case"end":return o.stop()}}),o)})))()},uploadControlNets:function(t,e){var n=this.paintingBoardData.controlNet.controlnet_units.find((function(e){return e.id===t}));n&&(n.image_url=e)},generateTask:function(t,e,n){var o=arguments,r=this;return Object(l.a)(regeneratorRuntime.mark((function l(){var c,d,h,v,m,f;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return c=o.length>3&&void 0!==o[3]?o[3]:"",d=r.getParams(t,e,c),l.next=4,r.handleParamsMask(d,e,c);case 4:return h=d.image_url||d.meta.mask?Q.t:Q.u,"intelligentEraser"===c&&(h=Re.c,d={image_url:(null===(v=d)||void 0===v?void 0:v.image_url)||(null==e?void 0:e.imgSrc),mask:d.meta.mask,width:(null==e?void 0:e.renderWidth)||d.meta.width,height:(null==e?void 0:e.renderHeight)||d.meta.height}),"aiProdImg"===c&&1===r.generateType&&(h=Q.g),"aiProdImg"===c&&2===r.generateType&&(h=Q.f),"layerRedraw"===c&&(h=Q.f),r.processStep={step:"start",process:0,text:"TaskStatusPreparing"},l.prev=10,l.next=13,h(d);case 13:m=l.sent,f=m.data.id,e.params=ya(ya({},d),{},{taskId:f}),e.taskId=f,r.pollingTask(f,e,n),l.next=23;break;case 20:l.prev=20,l.t0=l.catch(10),r.clearPolltime(e);case 23:case"end":return l.stop()}}),l,null,[[10,20]])})))()},pollingTask:function(t,e,n){var o=this,r=1===e.params.mode?3e3:1e3;this.pollingTimer=setTimeout((function(){Object(v.a)({task_ids:[t],scene:1}).then((function(r){o.handlePollResult(r.data.items[0],t,e,n)})).catch((function(t){o.processStep={step:"end",process:0,text:"TaskStatusPreparing"},o.clearPolltime(e)}))}),r)},getControlNetParams:function(){var t=this.paintingBoardData.controlNet.controlnet_units||[];return"Generate"!==this.leftActiveTab?[]:t.filter((function(t){return t.enable&&t.input_image})).map((function(t){return{image_url:t.input_image,mode:t.module,strength:t.weight,id:t.id}}))},handlePollResult:function(t,e,n,o){var r=t.status,l=t.process,c=t.img_uris;n.process=l,r<3?(this.processStep={step:"ing",process:l,text:"TaskStatusPreparing"},this.pollingTask(e,n,o)):3===r?(n.result=c[0].url,null!=n&&n.layerId&&(n.imgSrc=n.result),this.processStep={step:"end",process:l,text:"TaskStatusPreparing"},o&&o(c),this.clearPolltime(n)):(this.processStep={step:"end",process:0,text:"TaskStatusPreparing"},this.clearPolltime(n),this.$message.error(this.$t("ServerError")))},clearPolltime:function(t){clearTimeout(this.pollingTimer),this.pollingTimer=null,t.loading=!1,t.process=0,t.taskId="",null!=t&&t.layerId&&(this.normalUpdate=!0)},getParams:function(t,e){var n=this.paintingBoardData,o=n.selectedParams,r=n.currentParams,l=n.basicParams,c=l.denoisingStrength,d=l.imagesNumber,h=l.randomSeed,v=n.imageToImage.imgUrl,m=r.modelInfo,f=m.id,_=m.model_ver_no,y=r.selectedLora,w=r.stylePrompt,C=r.negativePrompt,k=r.vae,O=(null==e?void 0:e.cutUrl)||("live"!==t?v:""),x=r["live"===t&&O?"samplerSettingsLive":"samplerSettingsDefault"],I=x.CFGScale,D=x.samplingSteps,S=x.samplingMethod,P=this.getLoraParams(y),mask=null==e?void 0:e.mask,L=this.getParamsSize(t,e),j=this.getPrompt(w,e),$=mask?[]:this.getControlNetParams(),T={template_id:o,art_model_no:f,art_model_ver_no:_,mode:"live"===t&&O?2:1,product_image_url:null==e?void 0:e.product_image_url,meta:ya({control_nets:$,cfg_scale:I,denoising_strength:c,lora_models:P,mask:mask,n_iter:d,negative_prompt:C,prompt:j,sampler_name:S,steps:D,vae:k,seed:h},L)};return O&&(T.image_url=O),T},getPrompt:function(t,e){return(null==t?void 0:t.includes("{prompt}"))?t.replace("{prompt}",null==e?void 0:e.prompt):null!=e&&e.prompt?t+","+e.prompt:t},getParamsSize:function(t,e){var n=null==e?void 0:e.zoom,o=e.width,r=e.height,l={width:parseInt(o),height:parseInt(r)};return"live"!==t&&n&&(l.width=parseInt(n*o),l.height=parseInt(n*r)),l},cancelTask:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.taskId){n.next=3;break}return e.clearPolltime(t),n.abrupt("return");case 3:return n.abrupt("return",Object(v.r)({action:5,task_id:t.taskId}).then((function(n){t.loading=!1,e.clearPolltime(t)})));case 4:case"end":return n.stop()}}),n)})))()},updateLiveModeMask:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$set(this.paintingBoardData.liveModel,"mask",t)},getLoraParams:function(t){return null!=t&&t.length?t.map((function(t){return{model_id:t.id,model_ver_no:t.model_ver_no,weight:t.weights}})):[]},validParams:function(t){return!1},getEleInfo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"elementList",o=this.paintingBoardData[n].find((function(em){return em.layerId===t})),r=e?o[e]:o;return null==r?{}:r},setEleItem:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,n=t.type,o=void 0===n?"elementList":n,r=t.item,l=arguments.length>1?arguments[1]:void 0,c=this.paintingBoardData[o]||[],d=0,h=c.find((function(em,t){return d=t,em.layerId===e}));h&&(this.changeData("".concat(o,"[").concat(d,"]"),ya(ya({},h),r)),l&&l())},initLayerActive:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.paintingBoardData,n=e.elementList,o=e.liveModel;this.normalUpdate=t,n.forEach((function(t){(t.active=!1,t.cropping)&&(document.querySelector("#img-".concat(t.layerId)).style.clipPath=t.clipPath,t.cropping=!1);t.freeDeformation=!1})),o.active=!1},initLiveLayerActive:function(){var t=this.paintingBoardData.liveLayerList;t.filter((function(t){return t.active})).length>0&&t.forEach((function(t){(t.active=!1,t.freeDeformation=!1,t.cropping)&&(document.querySelector("#live-layer-".concat(t.layerId)).style.clipPath=t.clipPath,t.cropping=!1)}))},changeLoadingStatus:function(t){this.canvasLoading=t},publishPop:function(t){var e=this;In.a.open({type:"./PublishPop",options:ya(ya({},t),{},{id:this.currentCanvas,$t:function(text){return e.$t(text)},copySuccess:function(){e.$message.success(e.$t("CopySuccess"))}})})},handleWheel:function(t){var e=t.ctrlKey,n=t.metaKey,o=t.deltaY;if(e||n){var r=o>0,l=o<0;this.handleChangeZoom(r,l),t.preventDefault()}},handleChangeZoom:function(t,e){var n=this.paintingBoardData.boardInfo.zoom;if(!this.paintingBoardData.liveModel.show&&!(2===n&&t||.2===n&&e)){n=t?(10*n+1)/10:(10*n-1)/10;var o=this.viewerClass;o.setZoom(n),this.changeData("boardInfo.zoom",o.getZoom())}},handleKeydown:function(t){if(!this.paintingBoardData.liveModel.show){var e=t.key,n=t.keyCode,o=t.target;if("INPUT"!==o.tagName&&"TEXTAREA"!==o.tagName&&!o.isContentEditable){var r=t.ctrlKey||t.metaKey,l=t.shiftKey;if(r&&"c"===e)this.copyLayer();else if(r&&l&&("z"===e||"Z"===e))this.revocation("redo");else if(r&&"x"===e);else if(r&&"z"===e)this.revocation("undo");else if("Delete"===e||"Backspace"===e&&!t.target.isContentEditable&&!["INPUT","TEXTAREA"].includes(t.target.tagName))this.delLayer(),t.preventDefault();else if(r&&[187,189].includes(n)){var c=187===n,d=189===n;this.handleChangeZoom(c,d),t.preventDefault()}else if(l&&80==n)document.getElementById("event_brushImg").click();else if(l&&69==n)document.getElementById("event_eraserAiBoard").click();else{var h={86:"selectEments",32:"handBoardel",71:"updateArimg",80:"brushBoard",69:"eraserBoard",73:"daubBoard"};if(Object.keys(h).includes(n.toString())){if(t.repeat)return;if(32===n){if("daubBoard"===this.paintingBoardData.topNav.tools.hasAct)return;return this.eventFn.setBoardNoDage(),this.eventFn.setViewYesDage(!0),void t.preventDefault()}return document.getElementById("event_".concat(h[n])).click()}switch(e){case"ArrowUp":this.moveLayer("y",-1),t.preventDefault();break;case"ArrowDown":this.moveLayer("y",1),t.preventDefault();break;case"ArrowLeft":this.moveLayer("x",-1),t.preventDefault();break;case"ArrowRight":this.moveLayer("x",1),t.preventDefault()}}var v=!("Meta"!==t.key&&"Control"!==t.key||t.altKey||t.shiftKey);Object(Nt.c)("ctrlOrCmd",v)}}},handleKeyUp:function(t){var e=t.keyCode;if([91,17].includes(e)&&Object(Nt.c)("ctrlOrCmd",!1),32===e){if("daubBoard"===this.paintingBoardData.topNav.tools.hasAct)return;this.eventFn.setViewYesDage(!1);var n=this.paintingBoardData.topNav.tools.hasAct;document.getElementById("event_".concat(n)).click()}},getActiveLayer:function(t){var e=this,n=this.paintingBoardData,o=n.elementList,r=n.liveModel,l=o.filter((function(t){return t.z>1e4&&t.active&&e.changeData("liveModel.productLayerId",null),t.active}));return t&&r.active&&(l=[r]),l},delLayer:function(){var t=this,e=this.paintingBoardData.elementList;this.getActiveLayer().forEach((function(n){var o=n.layerId,r=e.findIndex((function(t){return t.layerId===o}));r>-1&&e.splice(r,1),n.z>1e4&&n.active&&t.changeData("liveModel.productLayerId",null)})),this.normalUpdate=!0},copyLayer:function(){var t=this,e=this.getActiveLayer(),n=this.paintingBoardData.liveModel.show;e.forEach((function(e){var o=e.imgSrc,r=e.x,l=e.y,c=e.zoom;t.addLayerItem({type:n?"liveImgLayer":"imgLayer",x:r-10,y:l+10,active:!0,imgSrc:o,params:e.params,zoom:c})})),this.normalUpdate=!0},revocation:function(t){this.$refs.topNav.handleStep(t)},moveLayer:function(t,e){var n=this;this.getActiveLayer(!0).forEach((function(o){var r=o.layerId?'[data-id="'.concat(o.layerId,'"]'):"#liveItemBox",l=document.querySelector(r);o[t]=Number(o[t])+e,l.style.transform="translate(".concat(o.x,"px, ").concat(o.y,"px) scale(").concat(o.zoom,", ").concat(o.zoom,")"),n.$nextTick((function(){(o.layerId?n.moveableRef:n.liveBoxRef).updateRect()}))}))},changeLeftMenu:function(t){this.$refs.leftMenu.changeMenu({label:t})},handleRightMenuClick:function(t){this.$refs.boardBox.rightMenuClick(t)},handleWatchLiveGenerate:function(){this.$refs.boardBox.handleWatchLiveGenerate()},handleSelectSize:function(t,e,n){var o=this.paintingBoardData.liveModel.show?"liveLayerList":"elementList";if("multiple"===n)this.selectSize=t+"x"+e;else{var r=this.paintingBoardData[o];if(1===this.getActiveLayer().length){var l=r.findIndex((function(t){return t.active}));return void(r[l].widHeiRatio=t+"x"+e)}}},updateAiImgStatus:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.paintingBoardData.basicParams;t!==this.generateType&&([1,2].includes(t)?(this.oldImgNum=[1,2].includes(this.generateType)?this.oldImgNum:e.imagesNumber,e.imagesNumber=1):this.oldImgNum&&(e.imagesNumber=this.oldImgNum),this.generateType=t)},setLayerFooterRef:function(data){this.layerFooterRef=data},setHasActiveHistory:function(t){this.hasActiveHistory=t}}),head:function(){return{title:this.$t("editBoardTitle"),meta:[{hid:"description",name:"description",content:this.$t("editBoardDesc")},{hid:"og:title",name:"og:title",content:this.$t("editBoardTitle")},{hid:"og:description",name:"og:description",content:this.$t("editBoardDesc")}]}}},Ca=wa,ka=(n(2866),n(2867),Object(_.a)(Ca,(function(){var t=this,e=t._self._c;return e("div",{on:{wheel:t.handleWheel}},[t.dataReady?e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.canvasLoading,expression:"canvasLoading"}],staticClass:"canvas",attrs:{id:"canvas-box"}},[t.isVipExpired?e("div",{staticClass:"vip-mask"},[e("img",{attrs:{src:"https://".concat(t.cdnHostFun(),"/static/upload/20240202/5ac2a22a-4711-465b-a814-4df904ccac36.png"),alt:"image"}}),t._v(" "),e("span",{domProps:{innerHTML:t._s(t.$t("canvas_expired"))},on:{click:function(e){t.$router.push(t.localePath("/mall"))}}})]):t._e(),t._v(" "),e("div",{staticClass:"top-nav-box no-snapshot",class:{"z-index1000":!t.isVipExpired}},[e("top-nav",{ref:"topNav",on:{getCanvasList:t.getCanvasList,frontendDelCanvas:t.frontendDelCanvas,changeCanvas:t.getCanvasDetail}})],1),t._v(" "),e("div",{staticClass:"content-box flex"},[e("div",{staticClass:"left-menu no-snapshot"},[e("left-menu",{ref:"leftMenu"})],1),t._v(" "),e("div",{staticClass:"board-box"},[e("board-box",{ref:"boardBox"})],1)]),t._v(" "),e("right-params",{attrs:{elementList:t.rightElementList}})],1):e("LoadingStatus",{attrs:{bgColor:"#02050e"}}),t._v(" "),e("ReplaceTemplateDialog",{ref:"replaceDialog",staticClass:"no-snapshot"}),t._v(" "),t.paintingBoardData.liveModel.show?e("live-model"):t._e()],1)}),[],!1,null,"b7a398c2",null));e.default=ka.exports},3246:function(t,e,n){"use strict";n.r(e);n(9),n(7),n(11),n(12),n(6);var o=n(3),r=n(2),l=(n(20),n(16),n(10),n(19),n(8),n(4),n(29),n(1)),c=n(39),d=n(5),h=n(2548),v=(n(70),n(23),n(49),n(18),n(37),n(66));function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var _={name:"PaymentTypeDialog",inject:["top"],props:{type:{type:String,default:"VIP_Card"},language:{type:String,default:"en"}},data:function(){return{isShowDialog:!1,goodsInfo:null,diamondBtnLoading:!1,cashBtnLoading:!1}},computed:{},watch:{},methods:f(f({},Object(l.b)("payment",["getPaymentInfo"])),{},{showDialog:function(t){this.goodsInfo=t,this.isShowDialog=!0},closed:function(){this.isShowDialog=!1,this.goodsInfo=null,this.diamondBtnLoading=!1,this.cashBtnLoading=!1},diamondPay:function(){var t=this;this.diamondBtnLoading=!0,Object(v.b)({product_id:this.goodsInfo.cp_product_id}).then((function(e){1e4===e.status.code&&(t.$message.success(t.$t("SuccessfulExchange")),t.getPaymentInfo()),t.diamondBtnLoading=!1,t.closed()})).catch((function(e){t.diamondBtnLoading=!1}))},cashPay:function(){var t=this,e={cp_product_id:this.goodsInfo.cp_product_id,os:"1",quantity:1,third_plat_type:1,from:this.top.dotFrom};this.cashBtnLoading=!0,Object(v.m)(e).then((function(e){var n=e.data.PaymentUrl;n&&window.open(n),t.cashBtnLoading=!1,t.closed()})).catch((function(e){t.cashBtnLoading=!1}))}})},y=(n(2549),n(0)),w=Object(y.a)(_,(function(){var t,e,o,r,l,c,d=this,h=d._self._c;return h("el-dialog",{staticClass:"payment-type-dialog custom-dialog",attrs:{visible:d.isShowDialog,"destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){d.isShowDialog=t},closed:d.closed}},[h("div",{staticClass:"tip",attrs:{title:d.$t("paymentTypeTip")}},[d._v("\n\t\t"+d._s(d.$t("paymentTypeTip"))+"\n\t")]),d._v(" "),h("div",{staticClass:"bg-image",style:{backgroundImage:"url(".concat(n(3213)("./".concat("VIP_Card"===d.type?"payment-type-vipcard":"payment-type-diamond",".webp")),")")}},["VIP_Card"===d.type?h("div",{staticClass:"VIP_Card",attrs:{title:d.$t("vip_card_name",{number:null===(t=d.goodsInfo)||void 0===t?void 0:t.day_num})}},[d._v("\n\t\t\t"+d._s(d.$t("vip_card_name",{number:null===(e=d.goodsInfo)||void 0===e?void 0:e.day_num}))+"\n\t\t")]):h("div",{staticClass:"mall-credits"},[h("span",{staticClass:"words"},[d._v("\n\t\t\t\t"+d._s(null===(o=d.goodsInfo)||void 0===o?void 0:o.calculate_coins)+"\n\t\t\t")]),d._v(" "),h("img",{staticClass:"icon",attrs:{src:n(121),alt:"credits"}})])]),d._v(" "),h("div",{staticClass:"btns"},[h("el-button",{staticClass:"diamond-btn",attrs:{loading:d.diamondBtnLoading},on:{click:function(t){return d.diamondPay()}}},[h("img",{staticClass:"icon",attrs:{src:n(414),alt:"diamond"}}),d._v("\n\t\t\t"+d._s(null===(r=d.goodsInfo)||void 0===r?void 0:r.buy_paid_coins)+"\n\t\t")]),d._v(" "),h("el-button",{staticClass:"cash-btn",attrs:{loading:d.cashBtnLoading},on:{click:function(t){return d.cashPay()}}},[d._v("\n\t\t\t"+d._s("en"===d.language?"$ ".concat(null===(l=d.goodsInfo)||void 0===l?void 0:l.price):"￥ ".concat(null===(c=d.goodsInfo)||void 0===c?void 0:c.price_cn))+"\n\t\t")])],1)])}),[],!1,null,null,null).exports,C=n(137),k=n(138),O=n(275),x={name:"PaymentFormDialog",props:{},components:{RightPart:C.a,PaymentForm:k.a},computed:{},data:function(){return{isShowDialog:!1,goodsId:"",loading:!1,defaultOptions:{animationData:O}}},created:function(){},mounted:function(){},methods:{showPaymentFormDialog:function(t){this.goodsId=(null==t?void 0:t.cp_product_id)||(null==t?void 0:t.id),this.isShowDialog=!0},showLoading:function(t){this.loading=t},success:function(){this.$EventBus.$emit("getMallGoodsData"),this.isShowDialog=!1}}},I=(n(2554),Object(y.a)(x,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"PaymentFormDialog flex-center",attrs:{visible:t.isShowDialog,"destroy-on-close":!0,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.isShowDialog=e}}},[t.loading?e("lottie",{staticClass:"loading-anime",attrs:{options:t.defaultOptions,height:110,width:110}}):t._e(),t._v(" "),t.isShowDialog?e("PaymentForm",t._g(t._b({attrs:{goodsId:t.goodsId,from:"mall",backToCheck:!0},on:{"in-pay-back":function(e){t.isShowDialog=!1},"pay-success":t.success,"in-loading":function(e){return t.showLoading(e)}}},"PaymentForm",t.$attrs,!1),t.$listeners),[e("right-part",{attrs:{showBg:!0,showText:!0,showStep:!1,showAvatar:!0}})],1):t._e()],1)}),[],!1,null,"bb00b496",null).exports),D=(n(32),n(344));n(89);function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function P(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var L={name:"UpOrDownDialog",props:{language:{type:String,default:"en"},nowPlan:{type:String,default:""},SubscriptionType:{type:String,default:""},paymentData:{type:Object,default:function(){}}},components:{PaymentFormDialog:I},data:function(){return{isShowDialog:!1,type:"upgrade",effectiveMode:"",priceObj:{amount:0,balance:0,newPrice:0,unit:""},confirmBtnLoading:!1,paymentDlgUpgrade:!1}},computed:P(P({},Object(l.e)("payment",["paymentInfo","activeSvipInfo","subThirdType"])),{},{getStyle:function(){return{height:this.isNowEffective?"72px":"44px"}},getTime:function(){var t,e=(new Date).getTime();return this.isNowEffective?Object(c.h)(e,"yyyy.MM.dd"):Object(c.h)(null===(t=this.paymentInfo)||void 0===t?void 0:t.svipExpiryTime,"yyyy.MM.dd")},getOriginPrice:function(){if(this.isNowEffective)return this.priceObj.balance;var t,data=this.activeSvipInfo,e=(null==data||null===(t=data.local_price_web)||void 0===t?void 0:t.price)||0;return this.isYearly?(12*e).toFixed(2):e.toFixed(2)},getNowPrice:function(){if(this.isNowEffective)return this.priceObj.newPrice;var t,e=(null===(t=this.paymentData)||void 0===t||null===(t=t.local_price_web)||void 0===t?void 0:t.price)||0;return this.isYearly?(12*e).toFixed(2):e.toFixed(2)},getAmount:function(){if(this.isNowEffective)return this.priceObj.amount;var t,e=(null===(t=this.paymentData)||void 0===t||null===(t=t.local_price_web)||void 0===t?void 0:t.price)||0;return this.isYearly?(12*e).toFixed(2):e.toFixed(2)},getUnit:function(){var t;return(null===(t=this.priceObj)||void 0===t?void 0:t.unit)||"$"},isSubscription:function(){var t;return 2===(null===(t=this.paymentInfo)||void 0===t?void 0:t.purchaseType)},isNowEffective:function(){return"now"===this.effectiveMode},isUpgrade:function(){return"upgrade"===this.type},isShowNext:function(){return!this.isUpgrade||this.isSubscription},isYearly:function(){return"yearly"===this.SubscriptionType},originPlay:function(){var t;return["ToB_beginnerPlan","StandardPlan","ToB_professionalPlan","MasterPlan"][(null===(t=this.paymentInfo)||void 0===t?void 0:t.productLevel)-1]}}),mounted:function(){this.subThirdType||this.getSubUrlAndThirdType()},methods:P(P({},Object(l.b)("payment",["getSubUrlAndThirdType","setAdyenFailed"])),{},{showDialog:function(t){this.isShowDialog=!0,this.type=t,this.effectiveMode=this.isUpgrade?"now":"next",this.isUpgrade&&this.getPrices()},getPrices:function(){var t=this;Object(v.j)({is_cn:"zhCN"===this.language,product_id:this.paymentData.id,type:this.isSubscription?"sub":"base"}).then((function(e){var n=e.data,o=n.balance_local,r=n.new_price_local,l=n.price_local,c=n.currency;t.priceObj.balance=o,t.priceObj.newPrice=r,t.priceObj.amount=l,t.priceObj.unit=c}))},handleConfirm:function(){var t=this;if(console.log("this.subThirdType",this.subThirdType),this.isSubscription){if(8==this.subThirdType)return void this.$message.warning(this.$t("bandStripe"));this.confirmBtnLoading=!0,Object(v.o)({change_type:"now"===this.effectiveMode?1:2,cp_product_id:this.paymentData.id,third_plat_type:this.subThirdType}).then((function(e){var n=e.data,o=n.PaymentUrl;n.ThirdOrderId;o?window.open(o):(t.$message.success(t.$t("OperateSuccess")),t.isShowDialog=!1,"now"===t.effectiveMode&&setTimeout((function(){location.reload()}),3e3))})).catch((function(e){if(console.log("res",e),80213===(null==e?void 0:e.code)){t.setAdyenFailed(),t.paymentDlgUpgrade=!0;var n=setTimeout((function(){t.$refs.paymentFormDialog.showPaymentFormDialog(t.paymentData),clearTimeout(n)}),1e3)}})).finally((function(){t.confirmBtnLoading=!1}))}else this.$refs.paymentFormDialog.showPaymentFormDialog(this.paymentData)}})},j=(n(2555),Object(y.a)(L,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"up-or-down-dialog custom-dialog",attrs:{visible:t.isShowDialog,"destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.isShowDialog=e}}},[e("div",{staticClass:"container"},[e("i",{staticClass:"el-icon-close close-icon",on:{click:function(e){t.isShowDialog=!1}}}),t._v(" "),e("div",{staticClass:"title"},[t._v("\n\t\t\t\t"+t._s(t.$t(t.isUpgrade?"UpgradePlan":"DowngradePlan"))+"\n\t\t\t")]),t._v(" "),e("div",{staticClass:"desc"},[e("div",{staticClass:"select-time"},[t._v(t._s(t.$t("SelectTimeRange")))]),t._v(" "),e("div",{staticClass:"tip"},[t._v(t._s(t.$t("SelectTimeRangeTip")))])]),t._v(" "),e("div",{staticClass:"select-area"},[t.isUpgrade?e("div",{staticClass:"right-now",on:{click:function(e){t.effectiveMode="now"}}},[t._v("\n\t\t\t\t\t"+t._s(t.$t("RightNowEffective"))+"\n\t\t\t\t\t"),e("i",{directives:[{name:"show",rawName:"v-show",value:t.isNowEffective,expression:"isNowEffective"}],staticClass:"icon el-icon-check"})]):t._e()]),t._v(" "),e("div",{staticClass:"detail"},[e("div",{staticClass:"origin-plan",style:t.getStyle},[e("div",{staticClass:"left"},[e("div",{staticClass:"line-one"},[e("span",{staticClass:"word"},[t._v(t._s(t.$t("taskRankFrom")))]),t._v(" "),e("span",{staticClass:"plan"},[t._v(t._s(t.$t(t.originPlay)))])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isNowEffective,expression:"isNowEffective"}],staticClass:"line-two"},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.$t("NotUseDays"))+"\n\t\t\t\t\t\t")])]),t._v(" "),e("div",{staticClass:"right"},[t._v(t._s(t.getUnit)+t._s(t.getOriginPrice))])]),t._v(" "),e("div",{staticClass:"now-plan",style:t.getStyle},[e("div",{staticClass:"left"},[e("div",{staticClass:"line-one"},[e("span",{staticClass:"word"},[t._v(t._s(t.$t("SubscribeTo")))]),t._v(" "),e("span",{staticClass:"plan"},[t._v(t._s(t.$t(t.nowPlan)))])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isNowEffective,expression:"isNowEffective"}],staticClass:"line-two"},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.$t("PlanPrice"))+"\n\t\t\t\t\t\t")])]),t._v(" "),e("div",{staticClass:"right"},[t._v(t._s(t.getUnit)+t._s(t.getNowPrice))])])]),t._v(" "),e("div",{staticClass:"payment-info"},[e("div",{staticClass:"amount"},[t._v("\n\t\t\t\t\t"+t._s(t.$t("DealWith"))+": "+t._s(t.getUnit)+t._s(t.getAmount)+"\n\t\t\t\t")]),t._v(" "),e("div",{staticClass:"time"},[t._v(t._s(t.getTime))])]),t._v(" "),e("div",{staticClass:"bottom"},[e("el-button",{staticClass:"cancel",on:{click:function(e){t.isShowDialog=!1}}},[t._v("\n\t\t\t\t\t"+t._s(t.$t("Cancel"))+"\n\t\t\t\t")]),t._v(" "),e("el-button",{staticClass:"confirm",attrs:{loading:t.confirmBtnLoading},on:{click:t.handleConfirm}},[t._v(t._s(t.$t("Confirm")))])],1),t._v(" "),e("PaymentFormDialog",{ref:"paymentFormDialog",attrs:{initMount:!0,upgrade:t.paymentDlgUpgrade,isSubscription:!1},on:{"pay-success":function(e){t.isShowDialog=!1}}})],1)])}),[],!1,null,null,null).exports);function $(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function T(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var B={primary:1,standard:2,professional:3,master:4},M={name:"SubscriptionItem",inject:["top"],props:{content:{type:Object,default:function(){}},SubscriptionType:{type:String,default:""},paymentData:{type:Object,default:function(){}},language:{type:String,default:"en"}},components:{HelpTip:D.a,UpOrDownDialog:j,PaymentFormDialog:I},data:function(){return{btnLoading:!1,useFree:!1,executedSubType:!0}},computed:T(T(T({},Object(l.e)("payment",["paymentInfo","subThirdType","subscriptionUrl"])),Object(l.e)("user",["cdnHost"])),{},{getBg:function(){return{backgroundImage:"url(https://".concat(this.cdnHost,"/static/upload/20241123/3294f806-3035-48e7-8317-b151096b09af.webp)")}},isFreeTry:function(){var t;return null===(t=this.paymentData)||void 0===t?void 0:t.with_trial},getLanguage:function(){return{"zh-CN":"zhCN"===this.language,en:"en"===this.language}},isMonthly:function(){return"monthly"===this.SubscriptionType},isYearly:function(){return"yearly"===this.SubscriptionType},isSubscription:function(){var t;return 2===(null===(t=this.paymentInfo)||void 0===t?void 0:t.purchaseType)},getOriginalAmount:function(){var t,e=null===(t=this.paymentData)||void 0===t?void 0:t.local_price_web;if(e){var n=null==e?void 0:e.currency,o=null==e?void 0:e.price_old;return"".concat(n).concat(o)}return""},getNowAmount:function(){var t,e=null===(t=this.paymentData)||void 0===t?void 0:t.local_price_web;if(e){var n=null==e?void 0:e.currency,o=null==e?void 0:e.price;return"".concat(n).concat(o)}return""},getStamina:function(){return this.$t("GetStaminaPerDay",{param:this.paymentData.every_day_temp_coins})},getSubscriptionBtnDisabled:function(){var t,e=this.paymentInfo,n=e.payRange,o=e.productLevel;return!(!e.svipActiveState||null!==(t=this.top)&&void 0!==t&&t.inCancelSub)&&(!(3!==n||!this.isMonthly)||B[this.content.value]<o)},getBtnName:function(){var t;return null!==(t=this.top)&&void 0!==t&&t.inCancelSub?this.$t("SubscribeNow"):this.isRenewal?this.$t("Renewal"):this.isUpgradePlan?this.$t("UpgradePlan"):this.$t("SubscribeNow")},isRenewal:function(){var t=this.paymentInfo,e=t.svipActiveState,n=t.productLevel;return e&&this.getMatch&&B[this.content.value]===n},isUpgradePlan:function(){var t=this.paymentInfo,e=t.svipActiveState,n=t.productLevel,o=t.payRange;return e&&(2===o&&n<B[this.content.value]||3===o&&n<B[this.content.value]&&this.isYearly||n===B[this.content.value]&&2===o&&this.isYearly)},getMatch:function(){var t=this.paymentInfo.payRange,e=void 0===t?0:t,n=2===e&&this.isMonthly,o=3===e&&this.isYearly;return n||o},txtWithHtml:function(){var t=this;return function(e){return e.param?t.$t(e.i18nKey,{param:e.param}):t.$t(e.i18nKey)}}}),methods:T(T({},Object(l.b)("payment",["setSubscriptionUrl","setSubThirdType","getSubUrlAndThirdType"])),{},{handleSwitch:function(){this.$emit("changeMethods",this.isYearly?"monthly":"yearly")},handlePurchase:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o={operation:"svip_card_page",behavior_info:"".concat({primary:"starter",standard:"standard",professional:"profession",master:"master"}[t.content.value],"_button"),behavior_info_sub:""},t.subThirdType){e.next=5;break}return e.next=5,t.getSubUrlAndThirdType();case 5:null!==(n=t.top)&&void 0!==n&&n.inCancelSub?t.openSubscrptionPayment():t.isRenewal?(o.behavior_info_sub="click_subscribe_button",t.handleMangeSubs()):t.isUpgradePlan?(o.behavior_info_sub="click_up_button",t.$refs.upOrDownDialog.showDialog("upgrade")):t.openSubscrptionPayment(),o.behavior_info_sub&&t.$logEvent("log_actions",o);case 7:case"end":return e.stop()}}),e)})))()},handleMangeSubs:function(){var t;this.openSubscrptionPayment(1==(null===(t=this.paymentInfo)||void 0===t?void 0:t.purchaseType))},openSubscrptionPayment:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.log("this.paymentData",this.paymentData,this.SubscriptionType),this.executedSubType=t,this.$refs.paymentFormDialog.showPaymentFormDialog(this.paymentData)}})},R=M,A=(n(2556),Object(y.a)(R,(function(){var t,e=this,o=e._self._c;return e.paymentData?o("div",{staticClass:"subscription-item"},[o("div",{staticClass:"header"},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.isFreeTry,expression:"isFreeTry"}],staticClass:"free-try"},[e._v("\n\t\t\t\t"+e._s(e.$t("FreeToTry"))+"\n\t\t\t")]),e._v(" "),"black_sale"==(null===(t=e.paymentData)||void 0===t?void 0:t.activity)?o("div",{staticClass:"black-friday-discount flex-center",style:e.getBg},[e._v("50% OFF")]):e._e(),e._v(" "),o("div",{staticClass:"category"},[o("span",{staticClass:"category-tag"},[e._v(e._s(e.$t(e.content.label)))])]),e._v(" "),o("div",{staticClass:"price",class:e.getLanguage},[e.isYearly?o("span",{staticClass:"original-amount"},[e._v("\n\t\t\t\t\t"+e._s(e.getOriginalAmount)+"\n\t\t\t\t")]):e._e(),e._v(" "),o("span",{staticClass:"now-amount"},[e._v("\n\t\t\t\t\t"+e._s(e.getNowAmount)+"\n\t\t\t\t")]),e._v(" "),o("span",[e._v("/")]),e._v(" "),o("span",{staticClass:"type"},[e._v("\n\t\t\t\t\t"+e._s(e.$t("Month"))+"\n\t\t\t\t")])]),e._v(" "),o("div",{staticClass:"tip"},[e._v("\n\t\t\t\t"+e._s(e.$t(e.isYearly?"SubscriptionYearlyTip":"SubscriptionMonthlyTip"))+"\n\t\t\t")]),e._v(" "),o("el-button",{staticClass:"subscription-btn",attrs:{disabled:e.getSubscriptionBtnDisabled,loading:e.btnLoading},on:{click:e.handlePurchase}},[e._v("\n\t\t\t\t"+e._s(e.getBtnName)+"\n\t\t\t")])],1),e._v(" "),o("div",{staticClass:"explanation"},[e.paymentData.is_first?o("div",{staticClass:"discount"},[o("div",{staticClass:"words"},[e._v(e._s(e.$t("FirstChargePresent")))]),e._v(" "),o("div",{staticClass:"number"},[e._v("\n\t\t\t\t\t"+e._s(e.paymentData.first_give_calculate_coins)+"\n\t\t\t\t\t"),o("img",{staticClass:"icon",attrs:{alt:"credits",src:n(121)}})])]):e._e(),e._v(" "),o("div",{staticClass:"top"},[o("div",{staticClass:"stamina"},[e._v("\n\t\t\t\t\t"+e._s(e.getStamina)+"\n\t\t\t\t\t"),o("HelpTip",{staticClass:"help",attrs:{color:"rgba(255, 255, 255, 0.6)",content:e.$t("SubsStaminaTip")}})],1)]),e._v(" "),o("div",{staticClass:"content"},[e._l(e.content.benefits,(function(t){return[o("div",{key:t.i18nKey,staticClass:"item-terms"},[o("div",{staticClass:"icon-div"},[o("i",{staticClass:"icon",class:t.correct?"el-icon-check":"el-icon-close"})]),e._v(" "),o("div",{staticClass:"words-div"},[o("span",{domProps:{innerHTML:e._s(e.txtWithHtml(t))}}),e._v(" "),t.comingSoon?o("span",{staticClass:"coming-soon"},[e._v("\n\t\t\t\t\t\t\t\t("+e._s(e.$t("ComingSoon"))+")\n\t\t\t\t\t\t\t")]):e._e()]),e._v(" "),t.helpI18nKey?o("div",{staticClass:"help-div"},[o("HelpTip",{staticClass:"help",attrs:{color:"rgba(177, 183, 204,0.6)",content:e.$t(t.helpI18nKey)}})],1):e._e()])]}))],2)]),e._v(" "),o("el-button",{staticClass:"subscription-btn",attrs:{disabled:e.getSubscriptionBtnDisabled,loading:e.btnLoading},on:{click:e.handlePurchase}},[e._v("\n\t\t\t"+e._s(e.getBtnName)+"\n\t\t")]),e._v(" "),o("PaymentFormDialog",{ref:"paymentFormDialog",attrs:{initMount:!0,upgrade:!1,isSubscription:e.executedSubType,isFreeTry:e.isFreeTry}}),e._v(" "),o("up-or-down-dialog",{ref:"upOrDownDialog",attrs:{language:e.language,paymentData:e.paymentData,nowPlan:e.content.label,SubscriptionType:e.SubscriptionType}})],1):e._e()}),[],!1,null,null,null).exports),E=n(2557);function N(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?N(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var U={name:"Subscription",components:{SubscriptionItem:A},data:function(){return{language:"",activeTab:"yearly",yearlData:[],monthData:[],contents:E.a,btnLoading:!1}},created:function(){this.$EventBus.$on("getMallGoodsData",this.getGoodsData)},beforeDestroy:function(){this.$EventBus.$off("getMallGoodsData")},mounted:function(){this.getPaymentInfo();this.language=["zhCN","en"].includes(this.$i18n.locale)?localStorage.getItem("language")||this.$i18n.locale:"en",this.getGoodsData(),this.getSubUrlAndThirdType()},computed:F(F({},Object(l.e)("payment",["paymentInfo","subThirdType","subscriptionUrl"])),{},{getDiscount:function(){var t="SubsDiscount",e=this.yearlData.filter((function(i){return"black_sale"==(null==i?void 0:i.activity)}));return null!=e&&e.length&&(t="SubsDiscount50"),this.$t(t)},isSubscription:function(){var t=this.paymentInfo,e=t.svipActiveState,n=t.purchaseType;return e&&2===n},getSubLevel:function(){var t,e=null===(t=this.paymentInfo)||void 0===t?void 0:t.productLevel;return this.$t(["ToB_beginnerPlan","StandardPlan","ToB_professionalPlan","MasterPlan"][e-1])}}),methods:F(F({},Object(l.b)("payment",["getPaymentInfo","getSubUrlAndThirdType","setActiveSvipInfo"])),{},{changeMethods:function(t){this.activeTab=t},getGoodsData:function(){var t=this;Object(v.l)().then((function(e){var n=e.data,o=void 0===n?{}:n,r=o.month,l=void 0===r?[]:r,c=o.year,d=void 0===c?[]:c;localStorage.setItem("goodsInfo",JSON.stringify((null==e?void 0:e.data)||"")),t.monthData=l,t.yearlData=d.map((function(t,e){return F(F({},t),{},{original_price:l[e].price,original_price_cn:l[e].price_cn})}));var h,v=t.paymentInfo,m=v.svipActiveState,f=v.recentPlan,_=v.payRange;h=2===(void 0===_?0:_)?t.monthData.find((function(t){return t.id===f})):t.yearlData.find((function(t){return t.id===f})),m&&t.setActiveSvipInfo(h)}))},handleManage:function(){this.subscriptionUrl&&9!==this.subThirdType&&window.open(this.subscriptionUrl,"_blank"),9===this.subThirdType&&this.$message({message:this.$t("Contact_customer"),type:"warning"})}})};n(2558);function H(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function z(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?H(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var V={name:"GoodsContainer",components:{PaymentTypeDialog:w,Subscription:Object(y.a)(U,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"subscription"},[e("div",{staticClass:"top"},[e("div",{staticClass:"subscription-methods"},[e("div",{staticClass:"yearly",class:{active:"yearly"===this.activeTab},on:{click:function(e){return t.changeMethods("yearly")}}},[t._v("\n\t\t\t\t\t"+t._s(t.$t("PayYearly"))+"\n\t\t\t\t\t"),e("div",{staticClass:"discount"},[t._v("\n\t\t\t\t\t\t"+t._s(t.getDiscount)+"\n\t\t\t\t\t\t"),e("img",{staticClass:"img",attrs:{src:n(641),alt:"fire"}})])]),t._v(" "),e("div",{staticClass:"monthly",class:{active:"monthly"===this.activeTab},on:{click:function(e){return t.changeMethods("monthly")}}},[t._v("\n\t\t\t\t\t"+t._s(t.$t("PayMonthly"))+"\n\t\t\t\t")])])]),t._v(" "),e("div",{staticClass:"bottom"},[e("div",{staticClass:"subscription-contents"},[t._l(t.contents,(function(content,n){return[e("subscription-item",{key:n,attrs:{content:content,SubscriptionType:t.activeTab,language:t.language,paymentData:"yearly"===t.activeTab?t.yearlData[n]:t.monthData[n]},on:{changeMethods:t.changeMethods}})]}))],2)])])}),[],!1,null,null,null).exports,PaymentFormDialog:I},filters:{thousandsSeparator:function(t){if("number"!=typeof t)return t;var e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}},props:{type:{type:String,default:"VIP_Card"},language:{type:String,default:"en"},goodsData:{type:Object,default:function(){}}},data:function(){return{}},computed:z(z(z({},Object(l.e)("payment",["paymentInfo"])),Object(l.c)("user",["userInfo"])),{},{getItemGoodsStyle:function(){return function(t){return{backgroundImage:"url(".concat(n(258)("./".concat(t.bgUrl)),")")}}},getVIPCardName:function(){var t=this;return function(e){return t.$t(t.isLite(e)?"vip_lite_card_name":"vip_card_name",{number:e.day_num})}},isLite:function(){return function(t){return t.cp_product_id.includes("lite")}}}),watch:{},methods:{getPrice:function(t){var e,n;return(null==t||null===(e=t.local_price_web)||void 0===e?void 0:e.currency)+(null==t||null===(n=t.local_price_web)||void 0===n?void 0:n.price)},handlePurchase:function(t){t.buy_paid_coins,this.paymentInfo.paidCoins,["http://localhost:8080","https://www.seaart.ai","https://seaart.ai","https://aiart-web.dev.seaart.ai","https://aiart-openresty.dev.seaart.ai"].includes(location.origin);this.$refs.paymentFormDialog.showPaymentFormDialog(t)}}},W=(n(2559),Object(y.a)(V,(function(){var t,e,o=this,r=o._self._c;return r("div",{staticClass:"goods-container",class:[["VIP_Card","Credit"].includes(o.type)?"goods-container-spacial":""]},[r("div",{directives:[{name:"show",rawName:"v-show",value:["VIP_Card","Credit"].includes(o.type),expression:"['VIP_Card', 'Credit'].includes(type)"}],staticClass:"old-mall"},[r("div",{staticClass:"top-desc"},[r("i",{staticClass:"iconfont icon-mall-desc tip"}),o._v(" "),r("span",{staticClass:"words"},[o._v(o._s(o.$t(null===(t=o.goodsData)||void 0===t?void 0:t.describe)))])]),o._v(" "),r("div",{staticClass:"goods"},[o._l(null===(e=o.goodsData)||void 0===e?void 0:e.data,(function(t,e){return[r("div",{key:t.id,staticClass:"item-goods",style:o.getItemGoodsStyle(t),on:{click:function(e){return o.handlePurchase(t)}}},["Credit"===o.type?r("div",{directives:[{name:"show",rawName:"v-show",value:t.give_calculate_coins||0===e,expression:"item.give_calculate_coins || index === 0"}],staticClass:"discount-simple"},[r("span",[o._v("+"+o._s(null==t?void 0:t.web_give_ratio)+"%")])]):r("div",{directives:[{name:"show",rawName:"v-show",value:t.is_first,expression:"item.is_first"}],staticClass:"discount-simple"},[r("div",{staticClass:"words"},[o._v(o._s(o.$t("FirstChargePresent"))+" +")]),o._v(" "),r("div",{staticClass:"number-new"},[o._v("\n\t\t\t\t\t\t\t\t"+o._s(t.calculate_coins)+"\n\t\t\t\t\t\t\t")])]),o._v(" "),"day1_try"===t.cp_product_id?r("div",{staticClass:"purchase-limit"},[r("div",{staticClass:"words"},[o._v(o._s(o.$t("limit_1_purchase")))])]):o._e(),o._v(" "),o.isLite(t)?r("div",{staticClass:"discount-simple discount-simple-vip-lite"},[o._v("\n              "+o._s(o.$t("mall_new"))+"\n\t\t\t\t\t\t")]):o._e(),o._v(" "),r("div",{staticClass:"goods-info",class:o.type},["VIP_Card"===o.type?r("div",{staticClass:"VIP_Card",attrs:{title:o.getVIPCardName(t)}},[o._v("\n\t\t\t\t\t\t\t\t"+o._s(o.getVIPCardName(t))+"\n\t\t\t\t\t\t\t")]):r("div",{class:"mall-"+o.type},[r("div",{staticClass:"words flex-center"},[o._v("\n\t\t\t\t\t\t\t\t\t"+o._s(o._f("thousandsSeparator")(t.calculate_coins))+"\n\t\t\t\t\t\t\t\t")]),o._v(" "),r("div",{staticClass:"detail flex-center"},[r("span",{staticClass:"num-1"},[o._v(o._s(t.calculate_coins-t.give_calculate_coins))]),o._v(" "),r("span",[o._v("+")]),o._v(" "),r("span",{staticClass:"num-2"},[o._v(o._s(t.give_calculate_coins))])]),o._v(" "),r("img",{staticClass:"icon",attrs:{src:n(3212)("./".concat(t.iconUrl)),alt:o.type}})])]),o._v(" "),r("el-button",{staticClass:"purchase-btn",attrs:{loading:t.btnLoad}},[o._v("\n              "+o._s(o.getPrice(t))+"\n\t\t\t\t\t\t")])],1)]}))],2)]),o._v(" "),r("Subscription",{directives:[{name:"show",rawName:"v-show",value:"Subscription"===o.type,expression:"type === 'Subscription'"}]}),o._v(" "),r("payment-type-dialog",{ref:"paymentTypeDialog",attrs:{type:o.type,language:o.language}}),o._v(" "),r("PaymentFormDialog",{ref:"paymentFormDialog",attrs:{initMount:!0,upgrade:!1,isSubscription:!1}})],1)}),[],!1,null,null,null).exports),G={name:"MemberBenefits",props:{},data:function(){return{container:["FREE","VIP LITE","VIP"],benefitTermsArr:["GetStaminaPerDay","SubsBottomTerms2","SameTimeTaskQueue","daily_rights_2","WorkPrivacyRights","WorkBatchDownload","BenefitTaskHistory","Paintboard","daily_rights_15","Use5LoRAs","modelTrainLimit","daily_rights_14","GetCreditsGive","AiVideoAllPlay"],notVipTerms:[1,3,4,5,8,9,10,11,12,13],notVipLiteTerms:[3,11,13],notVipCardTerms:[11,13],needParamTerms:[{key:0,params_free:150,params_vip_lite:300,params_vip:700},{key:2,params_free:2,params_vip_lite:5,params_vip:5},{key:6,params_free:14,params_vip_lite:30,params_vip:30},{key:7,params_free:1,params_vip_lite:2,params_vip:5}]}},computed:{getIcon:function(){return function(t){return n("VIP"===t?162:642)}},getTermIconClass:function(){var t=this;return function(e,n){var o;switch(e){case"FREE":o=t.notVipTerms.includes(n)?"el-icon-close":"el-icon-check";break;case"VIP LITE":o=t.notVipLiteTerms.includes(n)?"el-icon-close":"el-icon-check";break;case"VIP":o=t.notVipCardTerms.includes(n)?"el-icon-close":"el-icon-check";break;default:o="el-icon-close"}return o}},getI18nKey:function(){var t=this;return function(e,n,o){var r=t.needParamTerms.find((function(t){return t.key===o}));return r?t.$t(n,{param:r[{FREE:"params_free","VIP LITE":"params_vip_lite",VIP:"params_vip"}[e]]}):t.$t(n)}}},methods:{}},Y=(n(2560),Object(y.a)(G,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"member-benefits"},[e("div",{staticClass:"tip"},[e("i",{staticClass:"iconfont icon-mall-desc icon"}),t._v(" "),e("span",{staticClass:"words"},[t._v(t._s(t.$t("MemberBenefitsTip")))])]),t._v(" "),e("div",{staticClass:"benefits-container"},t._l(t.container,(function(n){return e("div",{key:n,staticClass:"item-container",class:n},[e("div",{staticClass:"sloganBg"},["FREE"!=n?e("img",{staticClass:"vip-icon",attrs:{src:t.getIcon(n),alt:"vip-icon"}}):t._e(),t._v(" "),e("div",{staticClass:"words"},[t._v(t._s(n))])]),t._v(" "),e("div",{staticClass:"terms-container"},[t._l(t.benefitTermsArr,(function(o,r){return[e("div",{key:r,staticClass:"item-term"},[e("i",{staticClass:"term-icon",class:t.getTermIconClass(n,r)}),t._v(" "),e("span",{staticClass:"term-words"},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.getI18nKey(n,o,r))+"\n\t\t\t\t\t\t")])])]}))],2)])})),0)])}),[],!1,null,null,null).exports),J=(n(665),n(44),n(422)),K=n.n(J),X=(n(666),n(423)),Q=n.n(X),Z=(n(71),{name:"CommonQuestions",components:{ElCollapse:Q.a,ElCollapseItem:K.a},props:{language:{type:String,default:"en"}},data:function(){return{collapseActiveArr:[],collapses:[{title:"SubsCollapseTitle19",content:"SubsCollapseContent19"},{title:"SubsCollapseTitle1",content:"SubsCollapseContent1"},{title:"SubsCollapseTitle2",content:"SubsCollapseContent2"},{title:"SubsCollapseTitle3",content:"SubsCollapseContent3"},{title:"SubsCollapseTitle4",content:"SubsCollapseContent4_new"},{title:"SubsCollapseTitle14",content:"SubsCollapseContent14"},{title:"SubsCollapseTitle18",content:"SubsCollapseContent18"},{title:"SubsCollapseTitle5",content:"SubsCollapseContent5"},{title:"SubsCollapseTitle15",content:"SubsCollapseContent15"},{title:"SubsCollapseTitle7",content:"SubsCollapseContent7"},{title:"SubsCollapseTitle8",content:"SubsCollapseContent8"},{title:"SubsCollapseTitle9",content:"SubsCollapseContent9_new"},{title:"SubsCollapseTitle20",content:"SubsCollapseContent20"},{title:"SubsCollapseTitle12",content:"SubsCollapseContent12_new"},{title:"SubsCollapseTitle13",content:"SubsCollapseContent13"}],activityCollaspesLen:0}},computed:{getEmail:function(){var t;return null!==(t=this.language)&&void 0!==t&&t.startsWith("zh")?"customer@haiyiai.com":"customer@seaart.ai"}},methods:{handleCollapseChange:function(t){var e=t.length>this.activityCollaspesLen;if(this.activityCollaspesLen=t.length,e){var n=t[t.length-1];this.$logEvent("log_actions",{operation:"click_mall_Q&A",behavior_info:"Q"+n})}}}}),tt=(n(2561),Object(y.a)(Z,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"common-questions"},[e("div",{staticClass:"title"},[t._v("\n\t\t"+t._s(t.$t("FrequentlyAskedQuestions"))+"\n\t")]),t._v(" "),e("div",{staticClass:"sub-title"},[t._v("\n\t\t"+t._s(t.$t("FrequentlyAskedQuestionsTip"))+"\n\t")]),t._v(" "),e("el-collapse",{staticClass:"collapse",on:{change:t.handleCollapseChange},model:{value:t.collapseActiveArr,callback:function(e){t.collapseActiveArr=e},expression:"collapseActiveArr"}},[t._l(t.collapses,(function(n,o){return[e("el-collapse-item",{key:o,attrs:{title:t.$t(n.title),name:o}},[e("div",{staticClass:"content"},[t._v("\n\t\t\t\t\t"+t._s(n.needParams?t.$t(n.content,{email:t.getEmail}):t.$t(n.content))+"\n\t\t\t\t")])])]}))],2)],1)}),[],!1,null,null,null)),et=tt.exports,it=(n(1071),n(669)),nt={name:"PurchaseRecordDialog",components:{ElPagination:n.n(it).a},props:{language:{type:String,default:"en"}},data:function(){return{timestampToTime:c.h,isShowDialog:!1,tableDate:{page:1,page_size:6},total:0,recordData:[],loading:!1}},computed:{getIconSrc:function(){return function(t){if(t)return n(922)("./".concat({2:"purchase-record-vip",3:"purchase-record-vip",5:"purchase-record-vip",6:"diamond_2x",7:"credits_2x"}[t],".png"))}},getConsumptionInfo:function(){return function(t){if([1,24].includes(t.source)){var e,n,o=null===(e=t.product_info)||void 0===e||null===(e=e.local_price_web)||void 0===e?void 0:e.currency,r=null===(n=t.product_info)||void 0===n||null===(n=n.local_price_web)||void 0===n?void 0:n.price;return"".concat(o," ").concat(r)}return t.product_info.buy_paid_coins}},getVIPCardName:function(){var t=this;return function(e){return t.$t(t.isLite(e)?"vip_lite_card_name":"vip_card_name",{number:e.product_info.day_num})}},getSVIPCardName:function(){var t=this;return function(e){var n=e.product_info,o=n.level,r=n.type;return"".concat(t.$t(["ToB_beginnerPlan","StandardPlan","ToB_professionalPlan","MasterPlan"][o-1])," /\n\t\t\t\t").concat(t.$t(2===r?"Month":"year"))}},isLite:function(){return function(t){var e;return null==t||null===(e=t.product_info)||void 0===e?void 0:e.id.includes("lite")}}},methods:{showDialog:function(){this.getData(),this.isShowDialog=!0},closed:function(){this.isShowDialog=!1},wordsCopy:function(t){Object(d.d)(t),this.$message.success(this.$t("CopySuccess"))},getData:function(){var t=this;this.loading=!0,Object(v.k)(this.tableDate).then((function(e){var n=e.data,o=n.items,r=n.total;t.loading=!1,t.total=r,t.recordData=null==o?void 0:o.filter((function(t){return[2,3,5,6,7].includes(t.product_info.type)}))})).catch((function(e){t.loading=!1}))},pageChange:function(t){this.tableDate.page=t,this.getData()}}},at=(n(2562),Object(y.a)(nt,(function(){var t,e=this,o=e._self._c;return o("el-dialog",{staticClass:"purchase-record-dialog custom-dialog",attrs:{width:"900px",title:e.$t("PurchaseRecord"),visible:e.isShowDialog,"destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.isShowDialog=t},closed:e.closed}},[o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"container"},[null!==(t=e.recordData)&&void 0!==t&&t.length?o("ul",{staticClass:"rows"},[o("li",{staticClass:"row row-header"},[o("div",{staticClass:"goods-name"},[e._v(e._s(e.$t("ProductName")))]),e._v(" "),o("div",{staticClass:"goods-consumption"},[e._v(e._s(e.$t("Price")))]),e._v(" "),o("div",{staticClass:"goods-number"},[e._v(e._s(e.$t("OrderNumber")))]),e._v(" "),o("div",{staticClass:"goods-time"},[e._v(e._s(e.$t("Time")))])]),e._v(" "),e._l(e.recordData,(function(t){return[o("li",{key:t.id,staticClass:"row"},[o("div",{staticClass:"goods-name"},[o("img",{staticClass:"icon",class:{"vip-icon":5===t.product_info.type},attrs:{src:e.getIconSrc(t.product_info.type),alt:"icon"}}),e._v(" "),o("span",{staticClass:"star"},[e._v("*")]),e._v(" "),5===t.product_info.type?o("span",{staticClass:"words"},[e._v("\n\t\t\t\t\t\t\t"+e._s(e.getVIPCardName(t))+"\n\t\t\t\t\t\t")]):[2,3].includes(t.product_info.type)?o("span",{staticClass:"words"},[e._v("\n\t\t\t\t\t\t\t"+e._s(e.getSVIPCardName(t))+"\n\t\t\t\t\t\t")]):o("span",{staticClass:"number"},[e._v("\n\t\t\t\t\t\t\t"+e._s(6===t.product_info.type?t.product_info.paid_coins:t.product_info.calculate_coins)+"\n\t\t\t\t\t\t")])]),e._v(" "),o("div",{staticClass:"goods-consumption"},[17===t.source?o("img",{staticClass:"icon",attrs:{src:n(414),alt:"diamond"}}):e._e(),e._v(" "),o("span",{staticClass:"words",class:{cash:1===t.source}},[e._v("\n\t\t\t\t\t\t\t"+e._s(e.getConsumptionInfo(t))+"\n\t\t\t\t\t\t")])]),e._v(" "),o("div",{staticClass:"goods-number"},[e._v("\n\t\t\t\t\t\t"+e._s(t.order_sn)+"\n\t\t\t\t\t\t\t"),o("i",{staticClass:"iconfont icon-copy copy-icon",on:{click:function(n){return e.wordsCopy(t.order_sn)}}})]),e._v(" "),o("div",{staticClass:"goods-time"},[e._v("\n\t\t\t\t\t\t"+e._s(e.timestampToTime(t.create_at,"yyyy-MM-dd hh:mm:ss"))+"\n\t\t\t\t\t")])])]}))],2):o("div",{staticClass:"no-data-tip"},[e._v("\n\t\t\t"+e._s(e.$t("no_data"))+"\n\t\t")]),e._v(" "),o("el-pagination",{attrs:{layout:"total, prev, pager, next, jumper",background:"","page-size":7,"current-page":e.tableDate.page,total:e.total},on:{"update:currentPage":function(t){return e.$set(e.tableDate,"page",t)},"update:current-page":function(t){return e.$set(e.tableDate,"page",t)},"current-change":e.pageChange}})],1)])}),[],!1,null,null,null).exports),ot=n(131);function st(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function lt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?st(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):st(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ct={name:"MallCheckinDialog",props:{},data:function(){return{isShowDialog:!1,checkinBtnLoading:!1,checkinArrs:[{title:"FirstDay"},{title:"SecondDay"},{title:"ThirdDay"},{title:"FourthDay"},{title:"FifthDay"},{title:"SixthDay"},{title:"SeventhDay"}],renderCheckinArrs:[],activityTime:""}},mounted:function(){},methods:lt(lt({},Object(l.b)("payment",["getPaymentInfo"])),{},{getData:function(){var t=this;Object(ot.g)().then((function(e){var n=e.data,o=n.list,r=n.activity_time;null!=o&&o.length&&(t.activityTime=r,o.forEach((function(e,n){var o=Object.assign({},e,t.checkinArrs[n]);o=lt(lt({},o),{},{icon:"mall-checkin-".concat(1===e.assets_type?"credit":"vipcard",".png"),expired_icon:"mall-checkin-".concat(1===e.assets_type?"credit":"vipcard","-expired.png"),desc:"x".concat(1===e.assets_type?e.num:e.num+"day")}),t.renderCheckinArrs.push(o)})))})).catch((function(t){console.log("err",t)}))},showDialog:function(){this.getData(),this.isShowDialog=!0},close:function(){localStorage.setItem("MALL_DIALOG_SHOW_2",!0),this.isShowDialog=!1,this.renderCheckinArrs=[],this.checkinBtnLoading=!1,this.activityTime=""},checkIn:function(){var t=this;this.checkinBtnLoading=!0,Object(ot.j)().then((function(e){t.$message.success(t.$t("SignInSuccess")),t.getPaymentInfo(),t.isShowDialog=!1,t.checkinBtnLoading=!1})).catch((function(e){console.log("err",e),t.checkinBtnLoading=!1}))}})},ut=(n(2563),Object(y.a)(ct,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"mall-checkin-dialog",attrs:{visible:t.isShowDialog,"destroy-on-close":!0,"close-on-click-modal":!0},on:{"update:visible":function(e){t.isShowDialog=e},close:t.close}},[t.renderCheckinArrs.length?e("div",{staticClass:"container"},[e("i",{staticClass:"el-icon-close close-icon",on:{click:function(e){t.isShowDialog=!1}}}),t._v(" "),e("div",{staticClass:"title"},[e("span",{staticClass:"words"},[t._v(t._s(t.$t("DayCheckIn")))])]),t._v(" "),e("div",{staticClass:"desc"},[e("div",{staticClass:"line-one"},[e("div",[t._v("\n\t\t\t\t\t"+t._s(t.$t("AnniversarySpecialEvents"))+"\n\t\t\t\t")]),t._v(" "),e("div",[e("span",{staticClass:"symbol-one"},[t._v(">")]),t._v(" "),e("span",{staticClass:"symbol-two"},[t._v(">")]),t._v(" "),e("span",{staticClass:"symbol-three"},[t._v(">")])])]),t._v(" "),e("div",{staticClass:"line-two"},[t._v(t._s(t.$t("AnniversarySpecialEventsDesc")))])]),t._v(" "),e("div",{staticClass:"checkin-container"},[t._l(t.renderCheckinArrs,(function(o){return[e("div",{key:o.id,staticClass:"item-checkin",class:{"is-current":o.current,received:o.is_sign,"not-received":o.is_over&&!o.is_sign}},[o.is_sign?e("div",{staticClass:"received-mask"},[e("img",{staticClass:"received-icon",attrs:{src:n(631),alt:"received icon"}})]):t._e(),t._v(" "),e("div",{staticClass:"top"},[e("img",{staticClass:"img",attrs:{src:n(258)("./".concat(o.is_over&&!o.is_sign?o.expired_icon:o.icon))}}),t._v(" "),e("div",{staticClass:"goods-desc"},[t._v("\n\t\t\t\t\t\t\t"+t._s(o.desc)+"\n\t\t\t\t\t\t")])]),t._v(" "),e("div",{staticClass:"title"},[t._v(t._s(t.$t(o.title)))])])]}))],2),t._v(" "),e("div",{staticClass:"btn"},[e("el-button",{staticClass:"btn-div",attrs:{loading:t.checkinBtnLoading},on:{click:t.checkIn}},[t._v("\n\t\t\t\t"+t._s(t.$t("CheckInNow"))+"\n\t\t\t")])],1)]):t._e()])}),[],!1,null,null,null).exports);function ht(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function pt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ht(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ht(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var vt={name:"PaymentStatusDialog",inject:["top"],components:{},data:function(){return{isShowDialog:!1,isLoading:!0,intervalId:null,paymentData:{},third_type:1,defaultOptions:{animationData:O}}},mounted:function(){var t=this;this.$EventBus.$on("openPaymentStatusDialog",(function(e){t.isShowDialog=!0,t.isLoading=!1,t.paymentData=e}))},beforeDestroy:function(){this.$EventBus.$off("openPaymentStatusDialog")},computed:{getContainerStyle:function(){return{height:this.isLoading?"248px":"336px"}},getExpiryTime:function(){return Object(c.h)(this.paymentData.payment_at,"yyyy-MM-dd hh:mm:ss")},getVIPCardName:function(){var t;return this.$t(this.isLite?"vip_lite_card_name":"vip_card_name",{number:null===(t=this.paymentData)||void 0===t||null===(t=t.Product)||void 0===t?void 0:t.day_num})},getSVIPCardName:function(){var t=this;return function(e){var n=e.Product,o=n.level,r=n.type;return"".concat(t.$t(["ToB_beginnerPlan","StandardPlan","ToB_professionalPlan","MasterPlan"][o-1])," /\n\t\t\t\t").concat(t.$t(2===r?"Month":"year"))}},isLite:function(){var t;return null===(t=this.paymentData)||void 0===t||null===(t=t.Product)||void 0===t||null===(t=t.cp_product_id)||void 0===t?void 0:t.includes("lite")},getPrice:function(){var t;if(null!==(t=this.paymentData)&&void 0!==t&&null!==(t=t.Product)&&void 0!==t&&t.local_price_web){var e,n,o,r=null===(e=this.paymentData)||void 0===e?void 0:e.Product;return(null==r||null===(n=r.local_price_web)||void 0===n?void 0:n.currency)+(null==r||null===(o=r.local_price_web)||void 0===o?void 0:o.price)}return""}},methods:pt(pt({},Object(l.b)("payment",["getPaymentInfo"])),{},{close:function(){this.isShowDialog=!1,this.isLoading=!0,this.paymentData={},this.third_type=1,clearInterval(this.intervalId);var t=window.location.href.split("?")[0];window.history.replaceState(null,"",t)},showDialog:function(t,e){this.third_type=t,this.isShowDialog=!0,this.pollGetPaymentStatus(t,e)},pollGetPaymentStatus:function(t,e){var n=this;this.intervalId=setInterval(Object(o.a)(regeneratorRuntime.mark((function o(){var r,data;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,Object(v.i)({third_type:t,order_id:e});case 3:r=o.sent,null!=(data=r.data)&&data.is_paid&&(clearInterval(n.intervalId),n.isLoading=!1,n.paymentData=data,null!=data&&data.renewal_sub_url&&window.open(data.renewal_sub_url),n.getPaymentInfo(),n.top.getGoodsList(),n.top.getLimitDiscounts({is_first:!1}),n.$EventBus.$emit("getMallGoodsData")),o.next=12;break;case 8:o.prev=8,o.t0=o.catch(0),clearInterval(n.intervalId),console.log("error",o.t0);case 12:case"end":return o.stop()}}),o,null,[[0,8]])}))),2e3)},handleDone:function(){this.$logEvent("web_purchase");gtag("event","purchase",{transaction_id:this.paymentData.order_no,affiliation:{1:"payermax",4:"alipay",5:"wechatpay",6:"paypal",8:"stripe"}[this.third_type],value:this.paymentData.Product.price,currency:"USD"}),this.isShowDialog=!1}})},mt=(n(2564),Object(y.a)(vt,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"payment-status-dialog",attrs:{top:"calc(50vh - 168px)",width:"416px",visible:t.isShowDialog,"destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){t.isShowDialog=e},closed:t.close}},[e("div",{staticClass:"container",style:t.getContainerStyle},[t.isLoading?t._e():e("img",{staticClass:"icon",attrs:{src:n(636),alt:"success icon"}}),t._v(" "),t.isLoading?e("div",{staticClass:"loading"},[e("lottie",{attrs:{options:t.defaultOptions,height:110,width:110}}),t._v(" "),e("div",{staticClass:"words"},[t._v("\n\t\t\t\t\t"+t._s(t.$t("CheckingPaymentResult"))+"\n\t\t\t\t")]),t._v(" "),e("el-button",{staticClass:"cancel-btn",on:{click:function(e){t.isShowDialog=!1}}},[t._v("\n\t\t\t\t\t"+t._s(t.$t("Cancel"))+"\n\t\t\t\t")])],1):e("div",{staticClass:"finish"},[e("div",{staticClass:"tip"},[t._v(t._s(t.$t("PaymentSuccessful"))+" !")]),t._v(" "),e("div",{staticClass:"amount"},[t._v("\n          "+t._s(t.getPrice)+"\n\t\t\t\t")]),t._v(" "),e("div",{staticClass:"content"},[e("div",{staticClass:"item-content purchase-detail"},[e("div",{staticClass:"label"},[t._v(t._s(t.$t("PurchaseDetail"))+":")]),t._v(" "),e("div",{staticClass:"detail"},[5===t.paymentData.Product.type?e("div",{staticClass:"vipcard detail-div"},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.getVIPCardName)+"\n\t\t\t\t\t\t\t\t"),e("img",{staticClass:"icon",attrs:{src:n(478),alt:"vip icon"}})]):[2,3].includes(t.paymentData.Product.type)?e("div",{staticClass:"words"},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.getSVIPCardName(t.paymentData))+"\n\t\t\t\t\t\t\t")]):e("div",{staticClass:"credits detail-div"},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.paymentData.Product.calculate_coins)+"\n\t\t\t\t\t\t\t\t"),e("img",{staticClass:"icon",attrs:{src:n(121),alt:"credits icon"}})])])]),t._v(" "),e("div",{staticClass:"item-content order-number"},[e("div",{staticClass:"label"},[t._v(t._s(t.$t("OrderNumber"))+":")]),t._v(" "),e("div",{staticClass:"detail"},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.paymentData.order_no)+"\n\t\t\t\t\t\t")])]),t._v(" "),e("div",{staticClass:"item-content payment-time"},[e("div",{staticClass:"label"},[t._v(t._s(t.$t("PaymentTime"))+":")]),t._v(" "),e("div",{staticClass:"detail"},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.getExpiryTime)+"\n\t\t\t\t\t\t")])])]),t._v(" "),e("el-button",{staticClass:"done-btn",on:{click:t.handleDone}},[t._v("\n\t\t\t\t\t"+t._s(t.$t("Done"))+"\n\t\t\t\t")])],1)])])}),[],!1,null,null,null).exports);function ft(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function gt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ft(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ft(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var bt={name:"DiscountDialog",props:{discountData:{type:Object,default:function(){}},times:{type:Object,default:function(){}},language:{type:String,default:"en"}},data:function(){return{isShowDialog:!1}},methods:{showDialog:function(){this.isShowDialog=!0},close:function(){this.isShowDialog=!1},buyGoods:function(){var t=gt(gt({},this.discountData.product_info),{},{cp_product_id:this.discountData.product_info.id});location.href.includes("haiyiai.com")?this.$EventBus.$emit("showHaiyiPaymentMethodDialog",t,"Credit"):this.$EventBus.$emit("showSeaartPaymentMethodDialog",t,"Credit")}}},_t=(n(2565),Object(y.a)(bt,(function(){var t,e,n,o,r=this,l=r._self._c;return l("el-dialog",{staticClass:"discount-dialog",attrs:{visible:r.isShowDialog,"destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){r.isShowDialog=t},close:r.close}},[l("div",{staticClass:"container"},[l("i",{staticClass:"el-icon-close close-icon",on:{click:function(t){r.isShowDialog=!1}}}),r._v(" "),l("div",{staticClass:"title"},[r._v("\n\t\t\t"+r._s(r.$t("LimitedTimeBenefits"))+"\n\t\t")]),r._v(" "),l("div",{staticClass:"number"},[l("div",{staticClass:"number-new"},[r._v("\n\t\t\t\t"+r._s(null===(t=r.discountData)||void 0===t||null===(t=t.product_info)||void 0===t?void 0:t.calculate_coins)+"\n\t\t\t")]),r._v(" "),l("div",{staticClass:"number-old"},[r._v("\n\t\t\t\t"+r._s(null===(e=r.discountData)||void 0===e||null===(e=e.product_info)||void 0===e?void 0:e.calculate_coins_old)+"\n\t\t\t")])]),r._v(" "),l("div",{staticClass:"remaining"},[l("div",{staticClass:"words"},[r._v("\n\t\t\t\t"+r._s(r.$t("ValidTimeRemaining"))+"\n\t\t\t")]),r._v(" "),l("div",{staticClass:"times"},[l("div",{staticClass:"hours"},[r.times.hours<10?l("span",[r._v("0")]):r._e(),r._v("\n\t\t\t\t\t"+r._s(r.times.hours)+"\n\t\t\t\t")]),r._v(" "),l("span",{staticClass:"colon"},[r._v(":")]),r._v(" "),l("div",{staticClass:"minutes"},[r.times.minutes<10?l("span",[r._v("0")]):r._e(),r._v("\n\t\t\t\t\t"+r._s(r.times.minutes)+"\n\t\t\t\t")]),r._v(" "),l("span",{staticClass:"colon"},[r._v(":")]),r._v(" "),l("div",{staticClass:"second"},[r.times.seconds<10?l("span",[r._v("0")]):r._e(),r._v("\n\t\t\t\t\t"+r._s(r.times.seconds)+"\n\t\t\t\t")])])]),r._v(" "),l("div",{staticClass:"btn",on:{click:r.buyGoods}},[r._v("\n\t\t\t"+r._s("en"===r.language?"$ ".concat(null===(n=r.discountData)||void 0===n||null===(n=n.product_info)||void 0===n?void 0:n.price):"￥ ".concat(null===(o=r.discountData)||void 0===o||null===(o=o.product_info)||void 0===o?void 0:o.price_cn))+"\n\t\t")])])])}),[],!1,null,null,null).exports),yt=n(21),wt=n(517);n(14);function Ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function kt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ct(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ct(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ot={name:"MallTopBar",data:function(){return{formatNumberForeign:d.i,logoUrl:n(124),vipIconUrl:n(319),coins:[{name:"credit",icon:n(279),type:"calculateCoins",desc:"new_credit_desc"},{name:"stamina",icon:n(280),type:"tempCoins",desc:"new_stamina_desc"}],characterInfo:null}},computed:kt(kt(kt(kt({},Object(l.e)("payment",["paymentInfo","activeState","liteActiveState","subThirdType","subscriptionUrl"])),Object(l.e)("user",["userInfo"])),Object(l.c)("user",["isLoggedIn"])),{},{isSubscription:function(){var t=this.paymentInfo,e=t.svipActiveState,n=t.purchaseType;return e&&2===n},isVip:function(){return this.activeState||this.liteActiveState},getCoinTitle:function(){var t=this;return function(e){return t.$t(e.type)+"："+t.$t("balance")+" "+(t.paymentInfo[e.type]||0)+", "+t.$t(e.desc)}}}),mounted:function(){},methods:kt(kt(kt({},Object(l.b)("user",["getAccountInfo"])),Object(l.d)("user",["SET_USER_INFO"])),{},{handleBack:function(){history.length>1?this.$router.back():this.$router.push(this.localePath("/"))},handleManage:function(){this.subscriptionUrl&&9!==this.subThirdType&&window.open(this.subscriptionUrl,"_blank"),9===this.subThirdType&&this.$message({message:this.$t("Contact_customer"),type:"warning"})},toHome:function(){this.$router.push(this.localePath("/"))},openLogin:function(){this.$EventBus.$emit("openLoginDialog")},initials:function(t){return(t||"").split(" ").map((function(t){return t[0]})).join("")},handleOpenRecord:function(){this.$emit("openRecord")}})},xt=(n(2566),Object(y.a)(Ot,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-mall-top-bar"},[e("div",{staticClass:"mall-top-bar-left"},[e("div",{staticClass:"back-preview-btn",on:{click:function(e){return e.stopPropagation(),t.handleBack.apply(null,arguments)}}},[e("i",{staticClass:"el-icon-back"})]),t._v(" "),e("a",{staticClass:"mall-top-bar-logo",attrs:{href:t.localePath("/")},on:{click:function(e){return e.preventDefault(),t.toHome.apply(null,arguments)}}},[e("div",{staticClass:"mall-top-bar-logo-img"},[e("img",{attrs:{src:t.logoUrl,alt:""}})]),t._v(" "),e("div",{staticClass:"mall-top-bar-logo-text"},[t._v(t._s(t.$t("SeaArt")))])])]),t._v(" "),e("div",{staticClass:"mall-top-bar-right"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isLoggedIn,expression:"isLoggedIn"}],staticClass:"mall-top-bar-info"},[e("div",{staticClass:"vip-info"},[t._l(t.coins,(function(n){return[e("div",{key:n.name,staticClass:"item-coin",class:n.name,attrs:{title:t.getCoinTitle(n)}},[e("img",{staticClass:"icon",attrs:{src:n.icon,alt:n.name}}),t._v(" "),e("div",{staticClass:"number"},[t._v("\n              "+t._s(t.formatNumberForeign(t.paymentInfo[n.type])||0)+"\n            ")])])]}))],2)]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isSubscription,expression:"isSubscription"}],staticClass:"mall-top-btn",on:{click:t.handleManage}},[t._v(t._s(t.$t("ManageSubscription")))]),t._v(" "),e("div",{staticClass:"mall-top-btn",on:{click:function(e){return t.handleOpenRecord()}}},[t._v(t._s(t.$t("PurchaseRecord")))])])])}),[],!1,null,"14728e5a",null)),It=xt.exports;function Dt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function St(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Dt(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Pt={name:"Mall",components:{GoodsContainer:W,MemberBenefits:Y,CommonQuestions:et,PurchaseRecordDialog:at,MallCheckinDialog:ut,PaymentStatusDialog:mt,DiscountDialog:_t,Banner:wt.a,MallTopBar:It},provide:function(){return{top:this}},data:function(){return{formatNumberForeign:d.i,language:"",dataAlready:!1,paymentInfoAlready:!1,coins:[{name:"credits",icon:n(121),type:"calculateCoins",desc:"credit_desc"},{name:"stamina",icon:n(226),type:"tempCoins",desc:"new_stamina_desc"}],currentTab:"Subscription",goodsData:{VIP_Card:{describe:"vip_card_desc",data:[]},Credit:{describe:"credit_recharge_desc",data:[]}},discountData:{},times:{hours:0,minutes:0,seconds:0},timer:null,endTime:0,currentTime:0,intervalTime:0,showCheckin:!1,isShowBanner:!1,isShowActivity:!1,dotFrom:"",paymentMethods:[],isShowVipCard:!0,inCancelSub:!1}},mounted:function(){var t;this.dotFrom=(null===(t=this.$route)||void 0===t||null===(t=t.query)||void 0===t?void 0:t.dotFrom)||"",this.getPaymentInfo(),this.getGoodsList(),this.isShowPaymentStatusDialog();this.language=["zhCN","en"].includes(this.$i18n.locale)?localStorage.getItem("language")||this.$i18n.locale:"en";var e=this.$route.query;null!=e&&e.openTab&&this.changeTab({key:null==e?void 0:e.openTab}),this.setBannerHidden(),this.getPaymentMethods()},beforeDestroy:function(){clearInterval(this.timer)},computed:St(St(St(St({},Object(l.e)("payment",["paymentInfo","maxRecharge"])),Object(l.c)("user",["isCompanyAccount","userInfo"])),Object(l.c)("activity",["isShowActivityBanner"])),{},{tabs:function(){var t=[{key:"Subscription",label:"subscription_tab",icon:n(730)},{key:"Credit",label:"credits_recharge",icon:n(729)}];return this.isShowVipCard&&t.push({key:"VIP_Card",label:"vip_card",icon:n(731)}),t},isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)},isShowDiscount:function(){return Object.keys(this.discountData).length&&this.discountData.is_show},getExpiryTime:function(){var t;return Object(c.h)(null===(t=this.paymentInfo)||void 0===t?void 0:t.expiryTime,"yyyy-MM-dd hh:mm:ss")},getLiteExpiryTime:function(){var t;return Object(c.h)(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteExpiryTime,"yyyy-MM-dd hh:mm:ss")},getSVIPExpiryTime:function(){var t;return Object(c.h)(null===(t=this.paymentInfo)||void 0===t?void 0:t.svipExpiryTime,"yyyy-MM-dd hh:mm:ss")},getCoinTitle:function(){var t=this;return function(e){return t.$t(e.type)+"："+t.$t("balance")+" "+(t.paymentInfo[e.type]||0)+", "+t.$t(e.desc)}},isSale:function(){return this.goodsData.Credit.data.some((function(t){return t.discount_price}))}}),watch:{maxRecharge:{handler:function(t){var e="computingPower"==this.$route.query.dotFrom;e?this.$logEvent("log_actions",{operation:"mall_page_show",behavior_info:"calculate"}):this.$logEvent("log_actions",{operation:"mall_page_show",behavior_info:"svip"}),t&&(e&&(this.currentTab="Credit"),console.log(this.currentTab),this.getLimitDiscounts({is_first:e}))},immediate:!0},paymentInfo:{handler:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Object.keys(t).length&&(e.paymentInfoAlready=!0),null==t||!t.latestSubSysOrderId){n.next=6;break}return n.next=4,Object(v.i)({order_id:null==t?void 0:t.latestSubSysOrderId});case 4:r=n.sent,e.inCancelSub=3===(null==r||null===(o=r.data)||void 0===o?void 0:o.status);case 6:case"end":return n.stop()}}),n)})))()},deep:!0},isCompanyAccount:function(t){this.setBannerHidden()}},methods:St(St({},Object(l.b)("payment",["getPaymentInfo"])),{},{setBannerHidden:function(){var t=localStorage.getItem("HideTopBanner"),e=localStorage.getItem("HideTopBannerTime");(e||(e=Date.now()),this.isShowBanner)||(t?Date.now()-e>864e5&&(this.isShowBanner=!this.isCompanyAccount&&!this.isVip&&!this.isShowActivityBanner,localStorage.removeItem("HideTopBanner")):this.isShowBanner=!this.isCompanyAccount&&!this.isVip&&!this.isShowActivityBanner);this.isShowActivity=!this.isCompanyAccount&&!localStorage.getItem("HideActivityBanner")&&this.isShowActivityBanner},closeBanner:function(){this.isShowActivity?(this.isShowActivity=!1,this.isShowBanner=!1,localStorage.setItem("HideActivityBanner",!0)):(this.isShowBanner=!1,localStorage.setItem("HideTopBanner",!0),localStorage.setItem("HideTopBannerTime",Date.now()))},backTo:function(){history.length>1?this.$router.back():this.$router.push(this.localePath("/"))},showPurchaseRecordDialog:function(){this.$refs.purchaseRecordDialog.showDialog()},changeTab:function(t){var e=t.key;this.currentTab=e;null==this||this.$logEvent("log_actions",{operation:"mall_page_show",behavior_info:{Subscription:"svip",Credit:"calculate",VIP_Card:"vip"}[e]})},getLimitDiscounts:function(t){var e=this;Object(v.g)(t).then((function(n){var data=n.data;e.discountData=data||{},data.is_show&&(e.timer=setInterval(e.getRemainingTime,1e3),e.endTime=data.end_at,e.currentTime=data.current_at,e.intervalTime=e.endTime-e.currentTime,t.is_first&&e.$refs.discountDialog.showDialog())})).catch((function(t){}))},getGoodsList:function(){var t=this;Object(v.f)().then((function(e){var n=e.data,o=n.day,r=n.calculate,l=(n.paid_coins,n.can_sign),c=n.show_old_vip;t.isShowVipCard=c,t.showCheckin=l,t.goodsData.VIP_Card.data=o.map((function(t){return St(St({},t),{},{btnLoad:!1,bgUrl:"mall/mall-vip-bg.webp"})})),t.goodsData.Credit.data=r.map((function(t){var e,n=t.cp_product_id,o={calculate1:"mall_credit_1.webp",calculate4:"mall_credit_2.webp",calculate5:"mall_credit_3.webp",calculate7:"mall_credit_4.webp",calculate10:"mall_credit_5.webp",calculate11:"mall_credit_5.webp"};return e=(null==o?void 0:o[n])||"credits_2x.png",St(St({},t),{},{btnLoad:!1,bgUrl:"mall/vip-credit-bg-new.webp",iconUrl:e})})),t.dataAlready=!0})).catch((function(e){t.dataAlready=!0}))},openCheckinDialog:function(){this.$refs.mallCheckinDialog.showDialog()},isShowPaymentStatusDialog:function(){var t=window.location.href,e=Object(h.a)(t),n=e.x_type,o=e.outTradeNo,r=e.token,l=e.out_trade_no,c=e.ba_token,d=e.session_id,v=e.adyen_order_id,m=e.orderNo,f=o||c||r||l||d||v||m,_=0;o&&(_=1),(c||r)&&(_=6),l&&(_=4),d&&(_=8),v&&(_=9),m&&(_=10),"change-sub"!==n?_&&this.openPaymentStatusDialog(_,f):this.$message.success(this.$t("ChangeSubSuccess"))},openPaymentStatusDialog:function(t,e){this.$refs.paymentStatusDialog.showDialog(t,e)},openDiscountDialog:function(){this.$refs.discountDialog.showDialog()},getRemainingTime:function(){if(this.intervalTime-=1e3,this.intervalTime>0){var t=Math.floor(this.intervalTime%864e5/36e5),e=Math.floor(this.intervalTime%36e5/6e4),n=Math.floor(this.intervalTime%6e4/1e3);this.times.hours=t,this.times.minutes=e,this.times.seconds=n}else clearInterval(this.timer)},getPaymentMethods:function(){var t=this,e={},n=this.userInfo.invite_user_code;e.target_host="".concat(window.location.origin,"/"),e.url="".concat(window.location.origin,"/login?u_code=").concat(n),Object(yt.p)(e).then((function(e){var n,o;(t.paymentMethods=(null==e||null===(n=e.data)||void 0===n?void 0:n.payment_method)||[],1e4===(null==e?void 0:e.code))&&t.$cookies.set("enable_tavern_visitor",null==e||null===(o=e.data)||void 0===o?void 0:o.filter_mode)}))}})},Lt=(n(2567),Object(y.a)(Pt,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.dataAlready&&t.paymentInfoAlready,expression:"dataAlready && paymentInfoAlready"}],staticClass:"seaart-mall",class:[t.isShowBanner||t.isShowActivity?"seaart-mall-pd50":""]},[t.isShowBanner||t.isShowActivity?e("banner",{attrs:{fixed:!0},on:{close:t.closeBanner}}):t._e(),t._v(" "),e("mall-top-bar",{on:{openRecord:t.showPurchaseRecordDialog}}),t._v(" "),e("div",{staticClass:"container"},[t.showCheckin?e("div",{staticClass:"checkin-btn",on:{click:t.openCheckinDialog}},[e("img",{staticClass:"icon",attrs:{src:n(629),alt:"checkin btn"}}),t._v(" "),e("div",{staticClass:"words"},[t._v("\n\t\t\t\t\t"+t._s(t.$t("CheckIn"))+"\n\t\t\t\t")])]):t._e(),t._v(" "),t.isShowDiscount?e("div",{staticClass:"discount-btn",on:{click:t.openDiscountDialog}},[e("img",{staticClass:"icon",attrs:{src:n(630),alt:"discount btn"}}),t._v(" "),e("div",{staticClass:"words"},[t._v("\n\t\t\t\t\t"+t._s(t.$t("vip_invite_dialog_limit"))+"\n\t\t\t\t")]),t._v(" "),e("div",{staticClass:"times"},[e("div",{staticClass:"hours"},[t.times.hours<10?e("span",[t._v("0")]):t._e(),t._v("\n\t\t\t\t\t\t"+t._s(t.times.hours)+"\n\t\t\t\t\t")]),t._v(" "),e("span",{staticClass:"colon"},[t._v(":")]),t._v(" "),e("div",{staticClass:"minutes"},[t.times.minutes<10?e("span",[t._v("0")]):t._e(),t._v("\n\t\t\t\t\t\t"+t._s(t.times.minutes)+"\n\t\t\t\t\t")]),t._v(" "),e("span",{staticClass:"colon"},[t._v(":")]),t._v(" "),e("div",{staticClass:"second"},[t.times.seconds<10?e("span",[t._v("0")]):t._e(),t._v("\n\t\t\t\t\t\t"+t._s(t.times.seconds)+"\n\t\t\t\t\t")])])]):t._e(),t._v(" "),e("div",{staticClass:"goods-tabs"},[e("div",{staticClass:"goods-type-tab-box"},[t._l(t.tabs,(function(n){return[e("div",{key:n.key,staticClass:"goods-type-tab",class:{active:t.currentTab===n.key,"sale-tab":!t.isSale},on:{click:function(e){return t.changeTab(n)}}},[e("img",{staticClass:"goods-type-tab-icon",attrs:{src:null==n?void 0:n.icon,alt:t.$t(n.label)}}),t._v(" "),e("span",{staticClass:"goods-type-tab-text"},[t._v(t._s(t.$t(n.label)))]),t._v(" "),"VIP_Card"===n.key?e("div",{staticClass:"tag"},[t._v(t._s(t.$t("delist")))]):t._e()])]}))],2)]),t._v(" "),e("div",{staticClass:"goods-slogan"},[e("div",{staticClass:"goods-slogan-main"},[t._v(t._s(t.$t("mall1")))]),t._v(" "),e("div",{staticClass:"goods-slogan-sub"},[t._v(t._s(t.$t("SeaArt")))])]),t._v(" "),e("div",{staticClass:"goods-content"},[e("goods-container",{attrs:{type:t.currentTab,language:t.language,goodsData:t.goodsData[t.currentTab]}})],1)]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"VIP_Card"==t.currentTab,expression:"currentTab == 'VIP_Card'"}],staticClass:"comparison-of-membership-benefits"},[e("member-benefits")],1),t._v(" "),e("div",{staticClass:"common-questions-container"},[e("common-questions",{attrs:{language:t.language}})],1),t._v(" "),e("purchase-record-dialog",{ref:"purchaseRecordDialog",attrs:{language:t.language}}),t._v(" "),e("mall-checkin-dialog",{ref:"mallCheckinDialog"}),t._v(" "),e("payment-status-dialog",{ref:"paymentStatusDialog",attrs:{language:t.language}}),t._v(" "),e("discount-dialog",{ref:"discountDialog",attrs:{discountData:t.discountData,times:t.times,language:t.language}})],1)}),[],!1,null,null,null));e.default=Lt.exports},3247:function(t,e,n){"use strict";n.r(e);var o=n(2),r=n(3),l=(n(20),n(16),n(7),n(10),n(8),n(9),n(11),n(12),n(4),n(6),n(23),n(18),n(37),n(85),n(101),n(75),n(49),n(50),n(48),n(69)),c=n(15),d=n(31),h=(n(47),n(19),n(36),n(43),n(14),n(28),n(118),n(110),n(29),n(26)),v=n(38),m=n(45),f=n(1),_=n(13),y=n(24);function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function C(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var k={name:"AiChatCardUpdatePopup",data:function(){var t=this;return{genderOption:[{key:"male",label:"informationDialog5"},{key:"femail",label:"informationDialog6"},{key:"anime",label:"informationDialog7"}],loading:!1,coverImageLoading:!1,UPLOAD:new v.a({type:51}),accept:".jpg,.jpeg,.png,.webp",isCoverLoading:!1,visible:!1,options:{title:"新增消息",syncTitle:"informationDialog13"},ruleForm:{username:"",like:"",is_default:"",gender:"",extra:"",dislike:"",avatar:{url:"",width:0,height:0},age:"",account_id:""},rules:{username:[{required:!0,message:this.$t("informationDialog19"),trigger:"blur"}],age:[{validator:function(e,n,o){Number(n<18)?o(new Error(t.$t("cardEditAgeError"))):o()},trigger:"blur"}]}}},computed:C({},Object(f.c)("user",["userInfo"])),props:{needSetDefaultUse:Boolean,dialogWidth:{type:Number,default:560},useCardId:{type:String,default:""}},methods:C(C({},Object(f.d)("user",["SET_USER_INFO"])),{},{changeDefault:function(t){var e;this.$logEvent("log_actions",{operation:"informationDialog13"===(null===(e=this.options)||void 0===e?void 0:e.syncTitle)?"click_defalut":"click_update_profile",behavior_info:"on_tarven_detail_page",behavior_info_sub:1===t?"open":"close"})},bindChat:function(data){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=t.$route.query)&&void 0!==n&&n.s_id&&data.id){e.next=2;break}return e.abrupt("return");case 2:o={session_id:t.$route.query.s_id,data_card_id:data.id},Object(h.c)(o).then((function(e){var n;1e4===(null===(n=e.status)||void 0===n?void 0:n.code)&&t.$EventBus.$emit("updateCurrentCard",data)}));case 4:case"end":return e.stop()}}),e)})))()},show:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetData(),null!=t&&t.data&&(Object.assign(this.ruleForm,null==t?void 0:t.data),0===this.ruleForm.age&&(this.ruleForm.age=""),0===this.ruleForm.is_default&&(this.ruleForm.is_default="")),this.options=t,this.visible=!0},resetData:function(){this.resetForm(),this.options=null},handleClose:function(){this.resetData(),this.visible=!1},submitForm:function(t){var e=this;this.loading?this.$message.warning(this.$t("code_10405")):this.$refs[t].validate((function(t){if(!t)return console.log("error submit!!"),!1;var n;e.loading=!0,null!==(n=e.options)&&void 0!==n&&n.data?e.editnformationFn():e.addInformationFn()}))},resetForm:function(){this.ruleForm={username:"",like:"",is_default:"",gender:"",extra:"",dislike:"",avatar:{url:"",width:0,height:0},age:"",account_id:""},this.$refs.ruleForm&&this.$refs.ruleForm.resetFields()},handleDelAvatar:function(){this.ruleForm.avatar.url=""},handleRoleCoverBeforeUpload:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e.UPLOAD,r=["image/jpeg","image/png","image/jpg","image/gif","image/webp"],!e.isCoverLoading){n.next=4;break}return n.abrupt("return");case 4:if(r.includes(t.type)){n.next=7;break}return e.$message.error(e.$t("AllowImageFiles")),n.abrupt("return",!1);case 7:if(!(l=t)||l.size){n.next=10;break}return n.abrupt("return",!1);case 10:if(!(t.size/1024/1024>10)){n.next=21;break}return n.prev=11,n.next=14,Object(m.a)(t,10485760);case 14:l=n.sent,n.next=21;break;case 17:return n.prev=17,n.t0=n.catch(11),console.error("Compression failed:",n.t0),n.abrupt("return");case 21:return n.next=23,e.checkImageSize(l);case 23:if(c=n.sent,e.ruleForm.avatar.url=c.url||"",e.ruleForm.avatar.width=c.realWidth||0,e.ruleForm.avatar.height=c.realHeight||0,!e.isCoverLoading){n.next=29;break}return n.abrupt("return");case 29:return e.isCoverLoading=!0,o.startUpload(l).then((function(t){e.isCoverLoading=!1,e.coverImageLoading=!0,e.ruleForm.avatar.url=t||""})).catch((function(t){e.isCoverLoading=!1,e.coverImageLoading=!1,e.ruleForm.avatar.url="",e.ruleForm.avatar.width=0,e.ruleForm.avatar.height=0,e.$message.error(e.$t("uploadError"))})),n.abrupt("return",!1);case 32:case"end":return n.stop()}}),n,null,[[11,17]])})))()},checkImageSize:function(t){return new Promise((function(e,n){var o=new FileReader;o.onload=function(t){var img=new Image;img.onload=function(){var t={width:img.width,height:img.height,realWidth:img.naturalWidth,realHeight:img.naturalHeight};t.url=img.src,e(t)},img.onerror=function(){n(!1)},img.src=t.target.result},o.readAsDataURL(t)}))},addInformationFn:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,d,data,v,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=Object(_.N)(t.ruleForm)).account_id=null===(n=t.userInfo)||void 0===n?void 0:n.id,o.age&&(o.age=Number(o.age)),console.log("新增参数-",o),e.prev=4,e.next=7,Object(h.a)(o);case 7:if(r=e.sent,l=r.status,c=void 0===l?{}:l,d=r.data,data=void 0===d?{}:d,10619!==(null==c?void 0:c.code)){e.next=13;break}return t.$message.warning(t.$t("addMore")),t.loading=!1,e.abrupt("return");case 13:if(1e4!==(null==c?void 0:c.code)){e.next=23;break}if(t.$message.success(t.$t("informationDialog17")),!t.needSetDefaultUse){e.next=20;break}return v={id:data.id},Object.assign(v,o),e.next=20,t.bindChat(v);case 20:1===o.is_default&&((m=Object(y.cloneDeep)(t.userInfo)).character_setting.default_card=data.id,t.SET_USER_INFO(m)),t.handleClose(),t.$emit("updateList");case 23:t.loading=!1,e.next=29;break;case 26:e.prev=26,e.t0=e.catch(4),t.loading=!1;case 29:case"end":return e.stop()}}),e,null,[[4,26]])})))()},editnformationFn:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,d,v,m,f,w,C,k,O,x,I;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d="datacard"===(null===(n=t.options)||void 0===n?void 0:n.type)||!1,v=h.n,d&&(v=h.p),m=Object(_.N)(t.ruleForm),f=d?{card:m,session_id:null===(o=t.$route)||void 0===o||null===(o=o.query)||void 0===o?void 0:o.s_id,sync_main_card:t.ruleForm.is_default||2}:m,null!==(r=t.options)&&void 0!==r&&r.hideAsync&&delete f.sync_main_card,f.age&&(f.age=Number(f.age)),null!==(l=f.card)&&void 0!==l&&l.age&&(f.card.age=Number(f.card.age)),f.account_id=null===(c=t.userInfo)||void 0===c?void 0:c.id,console.log("编辑参数-",f),e.prev=10,e.next=13,v(f);case 13:w=e.sent,C=w.status,k=void 0===C?{}:C,O=w.data,1e4===(null==k?void 0:k.code)&&(t.$message.success(t.$t("informationDialog17")),t.useCardId===(null===(x=f.card)||void 0===x?void 0:x.id)&&d&&t.$EventBus.$emit("updateCurrentCard",f.card),1!==f.is_default||d||(console.log("手动进行新聊天默认的绑定",f.id),(I=Object(y.cloneDeep)(t.userInfo)).character_setting.default_card=f.id,t.SET_USER_INFO(I)),t.handleClose(),t.$emit("updateList")),t.loading=!1,e.next=22;break;case 19:e.prev=19,e.t0=e.catch(10),t.loading=!1;case 22:case"end":return e.stop()}}),e,null,[[10,19]])})))()}})},O=k,x=(n(2686),n(0)),component=Object(x.a)(O,(function(){var t,e,n,o,r,l=this,c=l._self._c;return c("el-dialog",{attrs:{top:"3vh","close-on-click-modal":!1,"close-on-press-escape":!1,visible:l.visible,"custom-class":"aichat-information-modal","lock-scroll":"","destroy-on-close":!1,"modal-append-to-body":"","append-to-body":"",width:l.dialogWidth+"px"},on:{"update:visible":function(t){l.visible=t}}},[c("div",{staticClass:"popup-content"},[c("div",{staticClass:"popup-content-header"},[c("div",{staticClass:"top"},[c("div",{staticClass:"popup-content-header-title overflow-ellipsis"},[l._v(l._s(null===(t=l.options)||void 0===t?void 0:t.title))]),l._v(" "),c("span",{staticClass:"popup-content-header-close",on:{click:function(t){return t.stopPropagation(),l.handleClose.apply(null,arguments)}}},[c("i",{staticClass:"el-icon-close"})])]),l._v(" "),c("div",{staticClass:"popup-content-header-description"},[l._v("\n        "+l._s(l.$t("informationDialog2"))+"\n      ")])]),l._v(" "),c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.loading,expression:"loading"}],staticClass:"popup-content-form-box hide-scrollbar"},[c("el-form",{ref:"ruleForm",staticClass:"popup-content-form",attrs:{"label-position":"top",inline:"",model:l.ruleForm,rules:l.rules,"label-width":"100px"}},[c("el-form-item",{attrs:{prop:"username"}},[c("template",{slot:"label"},[c("div",{staticClass:"custom-label"},[c("div",{staticClass:"symbol"},[l._v("*")]),l._v(" "),c("div",{staticClass:"label"},[c("span",[l._v(l._s(l.$t("informationDialog3")))]),l._v(" "),c("span",[l._v(l._s(l.$t("informationDialog18")))])])])]),l._v(" "),c("el-input",{attrs:{maxlength:"40",placeholder:l.$t("informationDialog19")},model:{value:l.ruleForm.username,callback:function(t){l.$set(l.ruleForm,"username",t)},expression:"ruleForm.username"}},[c("template",{slot:"append"},[l._v(l._s(l.ruleForm.username.length)+"/40")])],2)],2),l._v(" "),c("el-form-item",{attrs:{label:l.$t("informationDialog4")}},[c("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{maxlength:"40"},model:{value:l.ruleForm.avatar.url,callback:function(t){l.$set(l.ruleForm.avatar,"url",t)},expression:"ruleForm.avatar.url"}}),l._v(" "),null!==(e=l.ruleForm.avatar)&&void 0!==e&&e.url?c("div",{staticClass:"img-box"},[c("img",{staticClass:"avatar-img",attrs:{loading:"lazy",src:l.ruleForm.avatar.url,alt:null===(n=l.options)||void 0===n?void 0:n.title},on:{load:function(t){l.coverImageLoading=!1},error:function(t){l.coverImageLoading=!1}}}),l._v(" "),c("i",{staticClass:"del-icon el-icon-error",on:{click:function(t){return t.stopPropagation(),l.handleDelAvatar.apply(null,arguments)}}})]):c("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:l.isCoverLoading,expression:"isCoverLoading"}],key:"add-role-avatar",staticClass:"image-upload",attrs:{action:"#","before-upload":l.handleRoleCoverBeforeUpload,disabled:l.isCoverLoading,accept:l.accept,"http-request":function(){},"show-file-list":!1}},[c("div",{staticClass:"handle-upload",attrs:{slot:"trigger"},slot:"trigger"},[c("i",{staticClass:"iconfont icon-add-tag"})])])],1),l._v(" "),c("el-form-item",{attrs:{label:l.$t("gender"),prop:"gender"}},[c("el-radio-group",{model:{value:l.ruleForm.gender,callback:function(t){l.$set(l.ruleForm,"gender",t)},expression:"ruleForm.gender"}},l._l(l.genderOption,(function(t,e){return c("el-radio",{key:e,attrs:{label:t.key}},[l._v("\n              "+l._s(l.$t(t.label))+"\n            ")])})),1)],1),l._v(" "),c("el-form-item",{attrs:{label:l.$t("informationDialog8"),prop:"age"}},[c("el-input",{attrs:{placeholder:l.$t("inputAge"),maxlength:"8"},on:{input:function(t){l.ruleForm.age=t.replace(/[^\d]/g,"")}},model:{value:l.ruleForm.age,callback:function(t){l.$set(l.ruleForm,"age",t)},expression:"ruleForm.age"}},[c("template",{slot:"append"},[l._v(l._s(String(l.ruleForm.age).length||0)+"/8")])],2)],1),l._v(" "),c("el-form-item",{attrs:{label:l.$t("informationDialog9"),prop:"like"}},[c("el-input",{attrs:{autosize:"",type:"textarea",maxlength:"40","show-word-limit":"",placeholder:l.$t("pleaseEnte")},model:{value:l.ruleForm.like,callback:function(t){l.$set(l.ruleForm,"like",t)},expression:"ruleForm.like"}})],1),l._v(" "),c("el-form-item",{attrs:{label:l.$t("informationDialog10"),prop:"dislike"}},[c("el-input",{attrs:{autosize:"",type:"textarea",maxlength:"40","show-word-limit":"",placeholder:l.$t("pleaseEnte")},model:{value:l.ruleForm.dislike,callback:function(t){l.$set(l.ruleForm,"dislike",t)},expression:"ruleForm.dislike"}})],1),l._v(" "),c("el-form-item",{staticClass:"other-info-form-item",attrs:{label:l.$t("informationDialog11"),prop:"extra"}},[c("el-input",{attrs:{autosize:"",type:"textarea",placeholder:l.$t("informationDialog12"),maxlength:"1000","show-word-limit":""},model:{value:l.ruleForm.extra,callback:function(t){l.$set(l.ruleForm,"extra",t)},expression:"ruleForm.extra"}})],1)],1)],1)]),l._v(" "),c("div",{staticClass:"popup-footer"},[c("div",{staticClass:"default-box"},[null!==(o=l.options)&&void 0!==o&&o.hideAsync?l._e():c("el-checkbox",{attrs:{"true-label":1,"false-label":2,label:l.$t(null===(r=this.options)||void 0===r?void 0:r.syncTitle)},on:{change:l.changeDefault},model:{value:l.ruleForm.is_default,callback:function(t){l.$set(l.ruleForm,"is_default",t)},expression:"ruleForm.is_default"}})],1),l._v(" "),c("span",{staticClass:"popup-footer-btn popup-footer-btn-confirm",on:{click:function(t){return t.stopPropagation(),l.submitForm("ruleForm")}}},[l._v(l._s(l.$t("Save")))])])])}),[],!1,null,"a08d70fc",null),I=component.exports,D=(n(32),n(353));function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function P(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var L={name:"AiChatCardListPopup",components:{AiChatCardUpdatePopup:I,ConfirmModal:D.a},props:{useCardId:{type:String,default:""}},data:function(){return{modalWidth:740,useCardIdSelf:"",genderEnum:{male:"informationDialog5",femail:"informationDialog6",anime:"informationDialog7"},loading:!1,listData:[],manageMenu:[{title:"Edit",icon:"icon-icon-edit2",key:"editCard"},{title:"informationListDialog3",icon:"icon-a-icon-Usethiscard",key:"useCard"},{title:"informationListDialog4",icon:"icon-a-icon-SetasDefault",key:"setDefaultCard"},{title:"Delete",icon:"icon-icon-delete",key:"deleteCard"}],visible:!1,options:{},curIndex:null}},watch:{$route:{handler:function(){}},useCardId:{handler:function(t){this.useCardIdSelf=t},immediate:!0},listData:{handler:function(t){t&&t.length>2&&(this.modalWidth=1088),t&&t.length<3&&(this.modalWidth=740)},deep:!0,immediate:!0}},computed:P(P({},Object(f.c)("user",["userInfo","isLoggedIn"])),{},{accountId:function(){var t;return null===(t=this.userInfo)||void 0===t?void 0:t.id},default_card_id:function(){var t;return(null===(t=this.userInfo)||void 0===t||null===(t=t.character_setting)||void 0===t?void 0:t.default_card)||""},titleComputed:function(){var t=this;return function(e){var n=e.action,o=e.item;return"icon-a-icon-SetasDefault"===n.icon?o.id===t.default_card_id?"informationListDialog5":"informationListDialog4":n.title}}}),methods:P(P({},Object(f.d)("user",["SET_USER_INFO"])),{},{handleClickItem:function(t){this.useCardIdSelf=t},handleSave:function(){var t=this;if(this.useCardIdSelf!==this.useCardId){var e,n={data_card_id:this.useCardIdSelf,session_id:null===(e=this.$route.query)||void 0===e?void 0:e.s_id},data=this.listData.find((function(e){return e.id===t.useCardIdSelf}));this.bindChat(n,data)}this.handleClose()},bindChat:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&Object(h.c)(e).then((function(e){var n;1e4===(null===(n=e.status)||void 0===n?void 0:n.code)&&(t.$message.success(t.$t("informationDialog17")),t.$EventBus.$emit("updateCurrentCard",data))}))},setDefault:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-";Object(h.I)({default_card_id:e}).then((function(n){var o;if(1e4===(null===(o=n.status)||void 0===o?void 0:o.code)){t.$message.success(t.$t("informationDialog17"));var r=Object(y.cloneDeep)(t.userInfo);r.character_setting.default_card="-"===e?"":e,t.SET_USER_INFO(r)}}))},confirm:function(data){console.log("confirm",data);var t=data.type,e=void 0===t?"":t,n=data.id,o=void 0===n?"":n;if("Del"===e)this.delInformationFn({id:o})},handleActions:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.key;if("icon-a-icon-SetasDefault"===e.icon)return data.id===this.default_card_id?void this.setDefault():data.id!==this.default_card_id?void this.setDefault(null==data?void 0:data.id):void 0;switch(n){case"editCard":this.$refs.AiChatCardUpdatePopup.show({data:data,title:this.$t("informationDialog20"),syncTitle:"informationDialog13",hideAsync:data.id===this.default_card_id});break;case"useCard":var o={data_card_id:null==data?void 0:data.id,session_id:null===(t=this.$route.query)||void 0===t?void 0:t.s_id};this.bindChat(o,data);break;case"deleteCard":this.$refs.confirmModal.show({subTitle:this.$t("delInformationDesc"),mainTitle:this.$t("delInformationTitle"),handleMethods:"Del",id:null==data?void 0:data.id})}},handleAdd:function(){this.$logEvent("log_actions",{operation:"click_create_new_profile",behavior_info:"on_tarven_detail_page"}),this.$refs.AiChatCardUpdatePopup.show({data:null,title:this.$t("informationDialog16"),syncTitle:"informationDialog13"})},delInformationFn:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,Object(h.i)(t);case 4:o=n.sent,r=o.status,1e4===(null==(l=void 0===r?{}:r)?void 0:l.code)&&(e.getList(),e.$message.success(e.$t("informationDialog17")),e.$emit("updateList"));case 7:case"end":return n.stop()}}),n)})))()},getList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,data,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLoggedIn){e.next=2;break}return e.abrupt("return");case 2:return t.loading=!0,e.next=5,Object(h.z)({account_id:t.accountId});case 5:n=e.sent,o=n.status,r=void 0===o?{}:o,l=n.data,data=void 0===l?{}:l,1e4===(null==r?void 0:r.code)&&(t.listData=(null==data||null===(c=data.items)||void 0===c?void 0:c.reverse())||[]),t.loading=!1;case 9:case"end":return e.stop()}}),e)})))()},show:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t,this.visible=!0,this.getList()},handleClose:function(){this.listData=[],this.visible=!1}})},j=L,$=(n(2687),Object(x.a)(j,(function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{top:"5vh",visible:t.visible,"custom-class":"aichat-information-modal","lock-scroll":"","destroy-on-close":"","modal-append-to-body":"","append-to-body":"","close-on-press-escape":!1,"close-on-click-modal":!1,width:t.modalWidth+"px"},on:{"update:visible":function(e){t.visible=e}}},[e("div",{staticClass:"popup-content-manage"},[e("div",{staticClass:"custom-header"},[e("i",{staticClass:"el-icon-close custom-header-close",on:{click:t.handleClose}}),t._v(" "),e("div",{staticClass:"custom-header-description"},[e("span",{staticClass:"left"},[t._v(t._s(t.$t("informationListDialog1")))]),t._v(" "),e("span",{staticClass:"right",on:{click:t.handleAdd}},[e("i",{staticClass:"el-icon-plus"}),t._v(" "),e("span",[t._v(t._s(t.$t("informationDialog16")))])])])]),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"conintar-box hide-scrollbar"},[t.listData.length?t._l(t.listData,(function(n,o){var r,l,c;return e("div",{key:o,staticClass:"item-box",class:{"item-box-active":n.id===t.useCardIdSelf},on:{click:function(e){return t.handleClickItem(n.id)}}},[e("div",{staticClass:"info-top"},[[null,void 0,""].includes(null==n||null===(r=n.avatar)||void 0===r?void 0:r.url)?e("span",{staticClass:"avatar name-avatar"},[t._v(" "+t._s(n.username.slice(0,1)))]):e("img",{staticClass:"avatar",attrs:{loading:"lazy",src:null==n||null===(l=n.avatar)||void 0===l?void 0:l.url,alt:null==n?void 0:n.username},on:{click:function(e){return t.handleClickItem(n.id)}}}),t._v(" "),[null,void 0,""].includes(null==n||null===(c=n.avatar)||void 0===c?void 0:c.url)?t._e():[e("div",{staticClass:"avatar-background",style:{backgroundImage:"url(".concat(n.avatar.url,")")}},[e("div",{staticClass:"gradient-overlay"})])],t._v(" "),e("div",{staticClass:"left"},[n.id===t.default_card_id&&n.id===t.useCardId?[n.id===t.default_card_id?e("span",{staticClass:"tag"},[t._v(t._s(t.$t("createModeType1")))]):t._e(),t._v(" "),n.id===t.useCardId?e("span",{staticClass:"tag tag-use"},[t._v(t._s(t.$t("useIng")))]):t._e()]:[n.id===t.default_card_id||n.id===t.useCardId?e("span",{staticClass:"tag",class:{"tag-use":n.id===t.useCardId}},[t._v("\n                                    "+t._s(t.$t(n.id===t.default_card_id?"createModeType1":"useIng"))+"\n                                ")]):t._e()]],2),t._v(" "),t.useCardId!==n.id?e("el-popover",{ref:"myPopover",refInFor:!0,attrs:{trigger:"hover",placement:"bottom-end","popper-class":"popover-information","append-to-body":!1,"visible-arrow":!1,"popper-options":{boundariesElement:"body"},width:"167"}},[e("div",{staticClass:"pop-btns"},t._l(t.manageMenu,(function(o){return e("div",{key:o.key,staticClass:"pop-btns-item",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.handleActions(o,n)}}},[e("i",{staticClass:"iconfont",class:o.icon}),t._v(" "),e("span",{staticClass:"pop-btns-text"},[t._v(t._s(t.$t(t.titleComputed({action:o,item:n}))))])])})),0),t._v(" "),e("i",{staticClass:"el-icon-more",attrs:{slot:"reference"},on:{click:function(t){t.preventDefault(),t.stopPropagation()}},slot:"reference"})]):t._e()],2),t._v(" "),e("div",{staticClass:"info-box"},[e("div",{staticClass:"info-box-1"},[e("div",{staticClass:"info-box-1-name"},[e("el-tooltip",{attrs:{content:n.username,"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"bottom"}},[e("span",{staticClass:"name overflow-ellipsis"},[t._v(t._s(n.username))])])],1),t._v(" "),e("div",{staticClass:"info-box-1-dec"},[e("div",{staticClass:"info-box-1-dec-item"},[e("span",{staticClass:"gender"},[t._v(t._s(t.$t("gender")))]),t._v(" "),e("span",[t._v("\n                                        "+t._s(t.genderEnum[n.gender]?t.$t(t.genderEnum[n.gender]):"-")+"\n                                    ")])]),t._v(" "),e("div",{staticClass:"info-box-1-dec-item"},[e("span",{staticClass:"gender"},[t._v(t._s(t.$t("AI_person_age")))]),t._v(" "),e("span",[t._v(t._s(n.age||"-"))])])])]),t._v(" "),e("div",{staticClass:"info-box-2"},[e("div",{staticClass:"like-item"},[e("span",[t._v(t._s(t.$t("like")))]),t._v(" "),e("span",{staticClass:"txt txt-over2"},[t._v("\n                                    "+t._s(n.like||"-")+"\n                                ")])]),t._v(" "),e("div",{staticClass:"like-item like-item-2"},[e("span",[t._v(t._s(t.$t("disLike")))]),t._v(" "),e("span",{staticClass:"txt overflow-ellipsis"},[t._v("\n                                    "+t._s(n.dislike||"-")+"\n                                ")])])])])])})):t._e()],2)]),t._v(" "),e("div",{staticClass:"manage-list-popup-footer"},[e("span",{staticClass:"manage-list-popup-footer-btn",on:{click:function(e){return e.stopPropagation(),t.handleClose.apply(null,arguments)}}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("span",{staticClass:"manage-list-popup-footer-btn manage-list-popup-footer-btn-confirm",on:{click:function(e){return e.stopPropagation(),t.handleSave()}}},[t._v("\n            "+t._s(t.$t("Save"))+"\n        ")])]),t._v(" "),e("AiChatCardUpdatePopup",{ref:"AiChatCardUpdatePopup",on:{updateList:t.getList}}),t._v(" "),e("ConfirmModal",{ref:"confirmModal",on:{confirm:t.confirm}})],1)}),[],!1,null,"7768725a",null)),T=$.exports;function B(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function M(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?B(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var R={name:"AiChatCardManagePopup",components:{ConfirmModal:D.a,AiChatCardUpdatePopup:I,AiChatCardListPopup:T},data:function(){return{isShowHandle:!1,manageMenu:[{title:"Edit",icon:"icon-icon-edit2"},{title:"Replace",icon:"icon-icon-replace"},{title:"Remove",icon:"icon-icon-Remove"}],listData:[]}},props:{useCard:{type:Object,default:function(){return{}}}},computed:M(M({},Object(f.c)("user",["userInfo","isLoggedIn"])),{},{useCardComputed:function(){return this.useCard||{}},needSetDefaultUse:function(){return!this.listData.length}}),mounted:function(){this.getList()},methods:{handleAddInformation:function(){this.listData.length?(console.log("挑选"),this.$refs.myInformationPopup.show()):(this.$logEvent("log_actions",{operation:"click_create_profile",behavior_info:"on_tarven_detail_page"}),console.log("新增！"),this.$refs.AiChatCardUpdatePopup.show({data:null,title:this.$t("informationDialog1"),syncTitle:"informationDialog13"}))},getList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,data,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLoggedIn){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Object(h.z)({account_id:t.accountId});case 4:n=e.sent,o=n.status,r=void 0===o?{}:o,l=n.data,data=void 0===l?{}:l,1e4===(null==r?void 0:r.code)&&(t.listData=(null==data||null===(c=data.items)||void 0===c?void 0:c.reverse())||[]);case 7:case"end":return e.stop()}}),e)})))()},handleEditInformation:function(){var t,e=this;this.$logEvent("log_actions",{operation:"click_profile_tab",behavior_info:"on_tarven_detail_page"}),Object(h.d)({id:null===(t=this.useCardComputed)||void 0===t?void 0:t.id}).then((function(t){var n;10616===(null===(n=t.status)||void 0===n?void 0:n.code)?e.$refs.AiChatCardUpdatePopup.show({data:e.useCardComputed,title:e.$t("informationDialog14"),hideAsync:!0,type:"datacard"}):e.$refs.AiChatCardUpdatePopup.show({data:e.useCardComputed,title:e.$t("informationDialog14"),syncTitle:"informationDialog15",type:"datacard"})}))},confirm:function(t){var e=t.type;if("Remove"===(void 0===e?"":e))this.removeInformationFn()},handleClickManage:function(title){switch(title){case"Edit":this.$logEvent("log_actions",{operation:"click_edit_profile",behavior_info:"on_tarven_detail_page"}),this.handleEditInformation();break;case"Replace":this.$logEvent("log_actions",{operation:"click_replace_profile",behavior_info:"on_tarven_detail_page"}),this.$refs.myInformationPopup.show();break;case"Remove":this.$logEvent("log_actions",{operation:"click_remove_profile",behavior_info:"on_tarven_detail_page"}),this.$refs.confirmModal.show({subTitle:this.$t("removeInformationTipConfirm"),mainTitle:this.$t("removeInformationTip"),handleMethods:"Remove"})}},removeInformationFn:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.k)({session_id:null===(n=t.$route)||void 0===n||null===(n=n.query)||void 0===n?void 0:n.s_id});case 2:r=e.sent,1e4===(null===(o=r.status)||void 0===o?void 0:o.code)&&(t.$message.success(t.$t("informationDialog17")),t.$EventBus.$emit("updateCurrentCard",{}));case 4:case"end":return e.stop()}}),e)})))()},hideHandle:function(){this.isShowHandle=!1}}},A=(n(2688),Object(x.a)(R,(function(){var t,e,n=this,o=n._self._c;return o("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:n.hideHandle,expression:"hideHandle"}],staticClass:"role-box"},[n.useCardComputed.id?o("div",{staticClass:"current-role",on:{click:n.handleEditInformation}},[o("span",{staticClass:"name overflow-ellipsis"},[n._v("\n            "+n._s(n.useCardComputed.username)+"\n        ")]),n._v(" "),o("div",{staticClass:"more-handle",on:{click:function(t){t.stopPropagation(),n.isShowHandle=!n.isShowHandle}}},[o("i",{staticClass:"el-icon-more"})])]):o("div",{staticClass:"add-tip",on:{click:n.handleAddInformation}},[o("i",{staticClass:"el-icon-plus"}),n._v(" "),o("span",[n._v(n._s(n.$t("addInformation")))])]),n._v(" "),o("AiChatCardListPopup",{ref:"myInformationPopup",attrs:{useCardId:(null===(t=n.useCardComputed)||void 0===t?void 0:t.id)||""},on:{updateList:n.getList}}),n._v(" "),o("AiChatCardUpdatePopup",{ref:"AiChatCardUpdatePopup",attrs:{needSetDefaultUse:n.needSetDefaultUse,useCardId:(null===(e=n.useCardComputed)||void 0===e?void 0:e.id)||""},on:{updateList:n.getList}}),n._v(" "),o("ConfirmModal",{ref:"confirmModal",on:{confirm:n.confirm}}),n._v(" "),n.isShowHandle?o("div",{staticClass:"handle-menu"},n._l(n.manageMenu,(function(t,e){return o("div",{key:e,staticClass:"handle-menu-item",on:{click:function(e){return n.handleClickManage(t.title)}}},[o("i",{staticClass:"iconfont",class:t.icon}),n._v(" "),o("span",[n._v(n._s(n.$t(t.title)))])])})),0):n._e()],1)}),[],!1,null,"61bb6d9e",null).exports),E=n(99);function N(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var F={name:"BottomPopup",inject:["aiChatBody"],props:{info:{type:Object,default:function(){return{}}},sendMessage:{type:Array,default:function(){return[]}}},data:function(){return{isFree:!0,aniLoading:!1,listData:[],loading:!1}},mounted:function(){this.getList()},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?N(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(f.e)("user",["userInfo"])),beforeDestroy:function(){document.removeEventListener("click",this.handleOutsideClick)},methods:{handleEdit:function(text){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.aiChatBody.msgChange({text:text,isSend:t})},getList:function(){var t,e,n=this,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.listData=[],o&&this.$logEvent("log_actions",{operation:"click_switch",behavior_info:"on_tarven_detail_page"}),!this.ani&&!this.loading){this.aniLoading=o,this.loading=!0;var r={char_name:null===(t=this.info)||void 0===t?void 0:t.name,messages:this.sendMessage,user_name:this.userInfo.name||(null===(e=JSON.parse(localStorage.getItem("userInfo")))||void 0===e?void 0:e.name)};Object(h.E)(r).then((function(t){var e=t.status,o=void 0===e?{}:e,r=t.data,data=void 0===r?{}:r;1e4===o.code&&(n.listData=null==data?void 0:data.items),n.isFree=data.free_times>0,n.loading=!1,n.aniLoading=!1})).catch((function(t){console.log(t),n.loading=!1,n.aniLoading=!1,n.hidePopup()}))}},hidePopup:function(){this.aiChatBody.closePopup()}}},U=F,H=(n(2689),Object(x.a)(U,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"bottom-popup"},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"inner-box"},[e("i",{staticClass:"el-icon-close",on:{click:t.hidePopup}}),t._v(" "),e("div",{staticClass:"inner-box-container"},[t.listData.length?e("div",{staticClass:"last-item"},[e("div",{staticClass:"last-item-inner",on:{click:function(e){return t.getList(!0)}}},[e("i",{staticClass:"el-icon-refresh",class:{"ani-class":t.aniLoading}}),t._v(" "),e("span",[t._v(t._s(t.$t("changeit")))]),t._v(" "),t.isFree?e("span",{staticClass:"free"},[t._v(t._s("(".concat(t.$t("aiChatReTip"),")")))]):t._e()])]):t._e(),t._v(" "),t._l(t.listData,(function(n,o){return e("div",{key:o,staticClass:"inner-box-item"},[e("div",{staticClass:"left"},[e("i",{staticClass:"iconfont icon-icon-edit2",on:{click:function(e){return t.handleEdit(n.text)}}}),t._v(" "),e("div",{staticClass:"line"},[t._v("|")])]),t._v(" "),e("div",{staticClass:"right",on:{click:function(e){return t.handleEdit(n.text,!0)}}},[t._v("\n                    "+t._s(n.text)+"\n                ")])])}))],2)])])}),[],!1,null,"c497cc34",null).exports),z=n(212);function V(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function W(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?V(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var G={props:{msg:{type:Object,default:function(){return{}}},getVoiceParams:{type:Object,default:function(){return{}}}},watch:{"getVoiceParams.timbre_id":{handler:function(t){this.timbre_id=t,this.voiceUrl=""}}},data:function(){return{audioPlayer:null,duration:void 0,voiceLoading:!1,isPlaying:!1,customClass:"line-scale-audio",timbre_id:"",voiceUrl:null}},beforeDestroy:function(){this.stopAudio()},components:{LineLoading:E.a,selectSoundModel:z.a},computed:W(W(W(W({},Object(f.e)("payment",["paymentInfo"])),Object(f.c)("user",["cdnHostFun","isCompanyAccount","isLoggedIn"])),Object(f.e)("user",["token"])),{},{playTime:function(){var t;return Math.floor(null===(t=this.audioPlayer)||void 0===t||null===(t=t.audioPlayer)||void 0===t?void 0:t.scheduledTime)||void 0},isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)||this.isCompanyAccount}}),methods:W(W({playAudio:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.voiceUrl){e.next=2;break}return e.abrupt("return");case 2:if(t.audioPlayer=t.$createAudioPlayer(t.voiceUrl,t.updateStatus),e.prev=3,!t.audioPlayer){e.next=7;break}return e.next=7,t.audioPlayer.start();case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),t.$message.warning(t.$t("soundPlayFail"));case 12:case"end":return e.stop()}}),e,null,[[3,9]])})))()},stopAudio:function(){this.audioPlayer&&this.audioPlayer.stop()},updateStatus:function(t,e){if(console.log("updateStatus",t,e),"over"!==e&&"start"!==e&&"error"!==t&&"error"!==e||(this.voiceLoading=!1),"error"===t||"error"===e)return this.isPlaying=!1,void this.$message.warning(this.$t("soundPlayFail"));this.isPlaying=t},handleClickPlay:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.$logEvent("log_actions",{operation:"click_audio_broadcast",behavior_info:"on_tavern_chat_page"}),!t.voiceLoading){e.next=5;break}return t.voiceLoading=!1,t.stopAudio(),e.abrupt("return");case 5:if(t.getVoiceParams.timbre_id){e.next=8;break}return null===(n=t.$refs.selectSoundModel)||void 0===n||n.openModal(),e.abrupt("return");case 8:if(!t.isPlaying){e.next=11;break}return t.stopAudio(),e.abrupt("return");case 11:if(t.isLoggedIn){e.next=14;break}return t.$EventBus.$emit("openLoginDialog"),e.abrupt("return");case 14:if(!t.voiceUrl){e.next=19;break}t.voiceLoading=!0,t.playAudio(),e.next=21;break;case 19:return e.next=21,t.getTts();case 21:case"end":return e.stop()}}),e)})))()}},Object(f.b)("payment",["getPaymentInfo"])),{},{updateTts:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.voiceUrl||(t.timbre_id=t.getVoiceParams.timbre_id),t.voiceUrl&&!t.isPlaying&&(t.timbre_id=t.getVoiceParams.timbre_id,t.voiceUrl="");case 2:case"end":return e.stop()}}),e)})))()},selectModel:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.$emit("updateTimbreObj",t,"播放器更新音色"),e.timbre_id=t.id,e.$refs.selectSoundModel.handleClose(),e.voiceUrl="",n.next=6,e.getTts();case 6:case"end":return n.stop()}}),n)})))()},getTts:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.voiceLoading=!0,e.prev=1,n=JSON.parse(JSON.stringify(t.getVoiceParams)),t.timbre_id&&(n.timbre_id=t.timbre_id),e.next=6,Object(h.K)(n);case 6:1e4===(o=e.sent).status.code?(t.voiceUrl=o.data.url||"",t.duration=o.data.duration,t.getPaymentInfo(),t.playAudio()):(r={70039:["showVipComputingDialog","vipDialogComputedTit2"],70010:["showBreakDialog","VipTip","basic"],80008:t.isVip?["showVipComputingDialog"]:["showNotVipComputingDialog"]},o.status.code&&r[o.status.code]&&(l=t.$EventBus).$emit.apply(l,Object(c.a)(r[o.status.code])),t.voiceLoading=!1),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),t.$message.warning(t.$t("soundPlayFail")),t.voiceLoading=!1;case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))()}})},Y=(n(2690),Object(x.a)(G,(function(){var t,e,n=this,o=n._self._c;return o("div",{staticClass:"audio-player-fcc",on:{click:n.handleClickPlay}},[o("div",{staticClass:"icon-container"},[n.msg.loading||n.voiceLoading?o("i",{staticClass:"el-icon-loading"}):[o("i",{directives:[{name:"show",rawName:"v-show",value:!n.isPlaying,expression:"!isPlaying"}],staticClass:"custom-play-btn"}),n._v(" "),o("line-loading",{directives:[{name:"show",rawName:"v-show",value:n.isPlaying,expression:"isPlaying"}],attrs:{customClass:n.customClass,count:7}})]],2),n._v(" "),o("selectSoundModel",{ref:"selectSoundModel",attrs:{selectList:null!==(t=n.getVoiceParams)&&void 0!==t&&t.timbre_id?[null===(e=n.getVoiceParams)||void 0===e?void 0:e.timbre_id]:[]},on:{selectModel:n.selectModel}})],1)}),[],!1,null,"297b12c8",null).exports),J=n(5),K=n(674);function X(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Q(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?X(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Z={components:{LineLoading:E.a,AudioPlayer:Y,AiChatReChatPopup:H},props:{useCard:{type:Object,default:function(){return{}}},voiceDuration:{type:Number,default:0},msg:{type:Object,default:function(){return{}}},info:{type:Object,default:function(){return{}}},value:{type:String,default:""},isRegenerate:{type:Boolean,default:!1},isFirst:{type:Boolean,default:!1}},data:function(){return{formatMsg:K.a,env:"production",msgText:""}},filters:{shortName:function(t){return t?t[0]:""}},computed:Q(Q(Q({},Object(f.e)("user",["userInfo"])),Object(f.c)("user",["isCompanyAccount"])),{},{showVoiceIcon:function(){var t,e=(null===(t=this.userInfo)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.lang_code)||this.$i18n.locale,n=2===this.msg.role&&["zhCN","zhTW","ja","en"].includes(e)&&!this.isCompanyAccount&&this.msg.content||1===this.msg.support_voice,o=void 0===this.msg.showVoice||this.msg.showVoice;return n&&o},sender:function(){var t={name:"",avatar:""};if(1===this.msg.role){var e=this.useCard,n=e.username,o=void 0===n?"":n,r=e.avatar,l=void 0===r?{url:""}:r,c=this.userInfo,head=c.head,d=c.id,h=c.name;t.avatar=(null==l?void 0:l.url)||head,t.name=o||h||d}else{var v,m;t.avatar=null===(v=this.info)||void 0===v||null===(v=v.cover)||void 0===v?void 0:v.url,t.name=null===(m=this.info)||void 0===m?void 0:m.name}return t},isHandle:function(){var t=this.msg,e=t.loading,n=t.id;return!e&&"number"!=typeof n&&!this.isFirst}}),methods:{copyMsg:function(){this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"click_copy"}),Object(J.d)(this.msg.content),this.$message.success(this.$t("CopySuccess"))},delMsg:function(){this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"click_delete_chat"}),this.$emit("handle",{msg:this.msg,type:"DEL"})},changeMsgEdit:function(t){var e=this;this.$emit("input",t),this.$nextTick((function(){e.msgText=e.msg.content}))},editMsg:function(){var t,e=this,n=this.$route.query.s_id;this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"click_edit"}),Object(h.m)({id:null===(t=this.msg)||void 0===t?void 0:t.id,message:this.msgText,session_id:n}).then((function(t){var n=JSON.parse(JSON.stringify(e.msg));n.content=e.msgText,e.changeMsgEdit(""),e.$emit("handle",{msg:n,type:"EDIT"}),2===e.msg.role&&e.$refs.player&&e.$refs.player.updateTts()}))},regenerateMsg:function(){this.$emit("handle",{msg:this.msg,type:"REGENERATE"}),2===this.msg.role&&this.$refs.player&&this.$refs.player.updateTts()}}},tt=(n(2691),Object(x.a)(Z,(function(){var t,e,n=this,o=n._self._c;return o("div",{staticClass:"msg-item",class:{"my-msg":1===n.msg.role,"edit-item":n.value===n.msg.id,"msg-item-has-keep":n.msg.hasKeep}},[n.msg.coin?o("div",{staticClass:"msg-item-cost",class:{"msg-item-cost-right":1===n.msg.role}},[n._v("\n    "+n._s("Cost: - ".concat(n.msg.coin||"-"))+"\n    "),n.env.includes("production")?n._e():o("span",[n._v(n._s("Token: ".concat(n.msg.num_of_token||"-")))])]):n._e(),n._v(" "),o("div",{staticClass:"msg-sender",class:{"sender-name":!(null!==(t=n.sender)&&void 0!==t&&t.avatar)},style:{backgroundImage:"url(".concat(n.sender.avatar,")"),marginTop:2===n.msg.role?"54px":"0"},attrs:{"data-sender":n._f("shortName")(n.sender.name)}}),n._v(" "),o("div",{staticClass:"msg-body-box"},[n.showVoiceIcon?o("AudioPlayer",n._g(n._b({ref:"player",attrs:{getVoiceParams:{msg_id:n.msg.id,timbre_id:n.info.timbre_id},msg:n.msg}},"AudioPlayer",n.$attrs,!1),n.$listeners)):n._e(),n._v(" "),n.msg.recommend?[o("AiChatReChatPopup",n._b({attrs:{info:n.info}},"AiChatReChatPopup",n.$attrs,!1))]:o("div",{staticClass:"msg-body"},[o("div",{staticClass:"sender-name"},[n._v(n._s(null===(e=n.sender)||void 0===e?void 0:e.name))]),n._v(" "),n.isHandle?o("span",{staticClass:"handle-icon"},[n.isRegenerate?o("i",{staticClass:"el-icon-refresh",on:{click:n.regenerateMsg}}):n._e(),n._v(" "),n.value!==n.msg.id?o("i",{staticClass:"el-icon-edit",on:{click:function(t){return n.changeMsgEdit(n.msg.id)}}}):n._e()]):n._e(),n._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:n.value!==n.msg.id,expression:"value !== msg.id"}],staticClass:"msg-content",class:{"msg-content-disable":3===n.msg.status||n.msg.isDisabled},domProps:{innerHTML:n._s(n.formatMsg(n.msg.content))}}),n._v(" "),n.msg.loading?o("line-loading"):n._e(),n._v(" "),o("el-input",{directives:[{name:"show",rawName:"v-show",value:n.value===n.msg.id,expression:"value === msg.id"}],staticClass:"msg-textarea",attrs:{type:"textarea",autosize:{minRows:2,maxRows:10}},model:{value:n.msgText,callback:function(t){n.msgText=t},expression:"msgText"}})],1)],2),n._v(" "),n.isHandle?o("div",{staticClass:"msg-handle",style:{marginTop:"auto"}},[n.value!==n.msg.id?[o("i",{staticClass:"el-icon-copy-document",on:{click:n.copyMsg}}),n._v(" "),1===n.msg.role?o("i",{staticClass:"el-icon-delete",on:{click:n.delMsg}}):n._e()]:[o("i",{staticClass:"el-icon-success",on:{click:n.editMsg}}),n._v(" "),o("i",{staticClass:"el-icon-error",on:{click:function(t){return n.changeMsgEdit("")}}})]],2):n._e(),n._v(" "),n.msg.hasKeep?n._t("keepSAy"):n._e()],2)}),[],!1,null,"ef7c5f44",null).exports),et={props:{isShowKeep:Boolean,data:{type:Object,default:function(){return{list:[],laoding:!1,info:"",offset_to:0}}},voiceDuration:{type:Number,default:0}},components:{AiChatMsgItem:tt,LineLoading:E.a},data:function(){return{showMsgIndex:[0,1,2,3,4],editMsg:"",debounceHandleScroll:function(){},scrollTop:0}},mounted:function(){this.debounceHandleScroll=Object(y.debounce)(this.scrollLoad,200)},methods:{handleKeepSay:function(){this.$logEvent("log_actions",{operation:"go_on_talk",behavior_info:"on_tarven_detail_page"}),this.$emit("handleKeepSay")},isRegenerate:function(i){var t=this.data.list,e=t[i];return!(t.length<2)&&(0===i&&2===e.role)},scrollBottom:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.$refs.msgList,n=e.scrollHeight;this.$nextTick((function(){e.scrollTo({top:t?-n:n,behavior:"smooth"})}))},scrollLoad:function(){var t=this.$refs.msgList;this.scrollTop=t.scrollTop||0;try{t&&Math.abs(t.scrollTop)+t.clientHeight>=t.scrollHeight-50&&this.$emit("load")}catch(t){}}}},it=et,nt=(n(2692),Object(x.a)(it,(function(){var t,e,n=this,o=n._self._c;return o("div",{staticClass:"aichat-msg"},[o("div",{staticClass:"scroll-body"},[o("div",{ref:"msgList",staticClass:"msg-list hide-scrollbar",on:{scroll:n.debounceHandleScroll}},[n._l(n.data.list,(function(t,i){var e;return o("ai-chat-msg-item",n._g(n._b({key:"msg_"+t.id,attrs:{voiceDuration:n.voiceDuration,msg:t,info:n.data.info,isRegenerate:n.isRegenerate(i),isFirst:i===(null===(e=n.data.list)||void 0===e?void 0:e.length)-1},scopedSlots:n._u([{key:"keepSAy",fn:function(){return[n.isShowKeep?o("div",{staticClass:"keep-say",on:{click:n.handleKeepSay}},[o("div",{staticClass:"i-box"},[o("i",{staticClass:"iconfont icon-a-icon-keepon"})]),n._v(" "),o("span",[n._v(n._s(n.$t("keepSay")))])]):n._e()]},proxy:!0}],null,!0),model:{value:n.editMsg,callback:function(t){n.editMsg=t},expression:"editMsg"}},"ai-chat-msg-item",n.$attrs,!1),n.$listeners))})),n._v(" "),n.data.laoding||(null===(t=n.data.list)||void 0===t?void 0:t.length)%20==0?n._e():o("div",{staticClass:"aichat-body-desc"},[o("p",[o("span",{staticClass:"tips"},[n._v(n._s(n.$t("tavern12"))+": ")]),n._v(" "+n._s(null===(e=n.data.info)||void 0===e?void 0:e.evaluation))])])],2)])])}),[],!1,null,"c18821ea",null).exports),at=n(427),ot=n(675);function st(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,a){if(t){if("string"==typeof t)return lt(t,a);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?lt(t,a):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw l}}}}function lt(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,n=Array(a);e<a;e++)n[e]=t[e];return n}function ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function ut(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ct(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ht={components:{AiChatMsg:nt,AiChatCardManagePopup:A},props:["value","sessionId","info","handleConfig","aiChatId","characterCode"],provide:function(){return{aiChatBody:this}},data:function(){return{contentQueue:[],isProcessing:!1,regenerateMsgCopy:"",handleRegenerateMsg:!1,activeTypingEffects:0,streamIng:!1,typingSpeed:20,chatStreamClass:null,optimizeIng:!1,msg:"",isShowLayout:!1,msgList:[],isOver:!1,loading:!1,params:{page_size:20,offset_to:0}}},watch:{$route:function(t,e){var n;(null===(n=t.query)||void 0===n?void 0:n.s_id)!==e.query.s_id&&this.initLoadMsg(),this.contentQueue=[]},msgList:{handler:function(t){},deep:!0,immediate:!0}},computed:ut(ut(ut(ut({},Object(f.e)("user",["userInfo"])),Object(f.e)("payment",["paymentInfo"])),Object(f.c)("user",["isCompanyAccount","isLoggedIn"])),{},{isTreamMsgModel:function(){var t;return 1===(null===(t=this.handleConfig)||void 0===t?void 0:t.enable_stream_chat)},dataComputed:function(){var t=Object(y.cloneDeep)(this.msgList);return{list:this.setHasKeepForFirstRole2(t),loading:this.loading,info:this.info,offset_to:this.params.offset_to}},isShowKeep:function(){return!(this.loading||this.sendLoading||0===this.msgList.length||this.streamIng||this.isProcessing)},sendLoading:function(){var t,e=!1;this.msgList.length&&(e=null===(t=this.msgList)||void 0===t?void 0:t.some((function(t){return t.loading})));return this.isTreamMsgModel?e||this.isProcessing:e},maxInput:function(){return this.msg.length>2e3},isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)||this.isCompanyAccount},sendMessage:function(){var t=[];return this.msgList.length&&(t=this.getNewArray(this.msgList)),t}}),mounted:function(){if(this.sessionId&&this.getChatMsg("mounted"),!this.sessionId&&this.info.first_msg){var t={content:this.info.first_msg,create_at:(new Date).getTime(),id:"".concat((new Date).getTime(),"random"),is_first_msg:1,role:2,status:3,loading:!1};this.msgList.push(t)}console.log("🚀 ~ mounted ~ info:",this.info)},methods:ut(ut({},Object(f.b)("payment",["getPaymentInfo"])),{},{setHasKeepForFirstRole2:function(t){var e=t.findIndex((function(t){return"number"==typeof t.role&&2===t.role}));return-1!==e&&(t[e].hasKeep=!0),t},closePopup:function(){var t;null!==(t=this.msgList[0])&&void 0!==t&&t.recommend&&this.msgList.shift()},msgChange:function(data){var text=data.text,t=data.isSend;this.closePopup(),this.msg=text,t&&this.sendMsg()},handleOptimizeChat:function(){var t,e,n=this;if(this.$logEvent("log_actions",{operation:"click_polish",behavior_info:"on_tarven_detail_page"}),this.isLoggedIn){if(!this.optimizeIng&&!this.sendLoading){this.optimizeIng=!0;var o={char_name:null===(t=this.info)||void 0===t?void 0:t.name,messages:this.sendMessage,user_name:this.userInfo.name||(null===(e=JSON.parse(localStorage.getItem("userInfo")))||void 0===e?void 0:e.name),text:this.msg};Object(h.A)(o).then((function(t){var e=t.status,o=void 0===e?{}:e,r=t.data,data=void 0===r?{}:r;1e4===o.code&&(n.msg=data.text),n.optimizeIng=!1})).catch((function(t){console.log(t),n.optimizeIng=!1}))}}else this.$EventBus.$emit("openLoginDialog",{callBack:function(){return n.$emit("newChat")}})},getNewArray:function(t){var e=(JSON.parse(JSON.stringify(t))||[]).filter((function(t){return!t.recommend}));return(e.length>=3?e.slice(0,3):e).map((function(t){return{role:2===t.role?"assistant":"user",text:t.content}}))},handleShowPopup:function(){var t=this;this.$logEvent("log_actions",{operation:"recommend_reply",behavior_info:"on_tarven_detail_page"}),this.isLoggedIn?this.checkStatus()||(this.closePopup(),this.pushMsg("this is popup",!0)):this.$EventBus.$emit("openLoginDialog",{callBack:function(){return t.$emit("newChat")}})},scrollBottom:function(){this.$refs.aiChatMsg&&this.$refs.aiChatMsg.scrollBottom()},initLoadMsg:function(){this.msgList=[],this.params.offset_to=0,this.isOver=!1,this.loading=!1,this.getChatMsg("initLoad")},getChatMsg:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,d,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("type",t),e.isLoggedIn){n.next=3;break}return n.abrupt("return");case 3:if(n.prev=3,!(o=localStorage.getItem("translate_".concat(e.sessionId)))){n.next=8;break}return e.msgList=JSON.parse(o),n.abrupt("return");case 8:if(!e.isOver){n.next=10;break}return n.abrupt("return");case 10:return e.loading=!0,n.next=13,Object(h.s)(ut(ut({},e.params),{},{session_id:e.sessionId}));case 13:r=n.sent,l=r.data,c=l.has_more,d=l.items,v=l.offset,e.msgList=e.msgList.concat(d||[]),!c&&0===e.params.offset_to&&e.msgList.length<=1&&e.$refs.aiChatMsg.scrollBottom("top"),e.params.offset_to=v,e.isOver=!c,n.next=27;break;case 25:n.prev=25,n.t0=n.catch(3);case 27:return n.prev=27,e.loading=!1,n.finish(27);case 30:case"end":return n.stop()}}),n,null,[[3,25,27,30]])})))()},hideLayout:function(){this.isShowLayout&&(this.isShowLayout=!1)},setLayout:function(t){this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"change_chat_position",behavior_info_sub:t}),this.$emit("layOutChange",t),this.isShowLayout=!1},enterSend:function(t){t.ctrlKey?this.msg+="\n":(t.preventDefault(),this.sendMsg())},handleKeepSay:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLoggedIn){e.next=3;break}return t.$EventBus.$emit("openLoginDialog",{callBack:function(){return t.$emit("newChat")}}),e.abrupt("return");case 3:if(!t.checkStatus()){e.next=5;break}return e.abrupt("return");case 5:if(!t.sendLoading){e.next=7;break}return e.abrupt("return");case 7:t.closePopup(),n=t.pushMsg("",!1),o=t.info,r=o.vip_only,l=o.name,t.getStream({content:"",session_id:t.sessionId,vip_only:r,support_voice:t.info.support_voice,name:l},n,!0);case 11:case"end":return e.stop()}}),e)})))()},checkStatus:function(){if(1e4===this.characterCode)return!1;switch(this.characterCode){case 10610:this.$EventBus.$emit("loadComponent",{name:"bannedTipMask2",data:{message:"bannedTipCharter"}});break;case 10621:this.$message({type:"warning",message:this.$t("chatFail"),duration:5e3,offset:100});break;default:console.warn("Unhandled character code: ".concat(this.characterCode))}return!0},sendMsg:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.checkStatus()){e.next=2;break}return e.abrupt("return");case 2:if(t.isLoggedIn){e.next=5;break}return t.$EventBus.$emit("openLoginDialog",{callBack:function(){return t.$emit("newChat")}}),e.abrupt("return");case 5:if(t.msg.trim()&&!t.sendLoading&&!t.maxInput&&!t.optimizeIng){e.next=7;break}return e.abrupt("return");case 7:t.closePopup(),n=JSON.parse(JSON.stringify(t.msg)),o=t.pushMsg(t.msg,!0),r=t.info,l=r.vip_only,c=r.name,t.getStream({content:n,session_id:t.sessionId,vip_only:l,support_voice:t.info.support_voice,name:c},o),t.msg="";case 13:case"end":return e.stop()}}),e)})))()},isAsset:function(){var t,e=((null===(t=this.userInfo)||void 0===t?void 0:t.character_setting)||{}).gpt_model,n=this.paymentInfo||{},o=n.tempCoins,r=n.calculateCoins;return("GPT-4-Turbo-1106"===e?o+r>=120:o>0||r>0)||(this.isVip?this.$EventBus.$emit("showVipComputingDialog"):"GPT-4-Turbo-1106"===e?this.$EventBus.$emit("showBreakDialog","AiChatSendNotCoin","basic"):this.$EventBus.$emit("showNotVipComputingDialog"),!1)},getStream:function(t,e){var n=arguments,o=this;return Object(r.a)(regeneratorRuntime.mark((function l(){var c,d,h,v;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(c=n.length>2&&void 0!==n[2]&&n[2],d=o.isTreamMsgModel?"/api/stream/character/session/chat":"/api/v1/character/session/chat",h="",!o.isTreamMsgModel){l.next=10;break}if(v={data:t,isKeep:c,rMsgId:h,c_time:e,url:d},c){l.next=8;break}return setTimeout((function(){h=o.pushMsg("",""),o.sendStreamRequest(v,function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){var r,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{(l=null==n||null===(r=n.headers)||void 0===r?void 0:r.get("X-Msg-Id"))&&!c&&o.setMsgId(l,e)}catch(t){console.error("getStream-Error:",t)}case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}),500),l.abrupt("return");case 8:return o.sendStreamRequest(v,function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){var r,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{(l=null==n||null===(r=n.headers)||void 0===r?void 0:r.get("X-Msg-Id"))&&!c&&o.setMsgId(l,e)}catch(t){console.error("getStream-Error:",t)}case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),l.abrupt("return");case 10:c||setTimeout((function(){h=o.pushMsg("","")}),500),o.sendStreamRequest({data:t,url:d},function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){var r,l,d,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,d=!(null==n||null===(r=n.headers)||void 0===r||!r.get("X-Status")),(v=null==n||null===(l=n.headers)||void 0===l?void 0:l.get("X-Msg-Id"))&&o.setMsgId(v,e),t.next=6,o.readStream(n,c?v:h,v,d,c);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("getStream-Error:",t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}());case 12:case"end":return l.stop()}}),l)})))()},readStream:function(t,e,n){var o=arguments,l=this;return Object(r.a)(regeneratorRuntime.mark((function r(){var c,d,h,v,m,f,_,y,w,C,k,O,x,I;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(h=o.length>3&&void 0!==o[3]&&o[3],v=o.length>4&&void 0!==o[4]&&o[4],m=null==t||null===(c=t.body)||void 0===c?void 0:c.getReader(),f=!0,_=null==t||null===(d=t.headers)||void 0===d?void 0:d.get("X-Response-Msg-Id"),-1===(y=l.msgList.findIndex((function(t){return t.id===e})))&&(y=0),w=l.msgList[y],t){r.next=12;break}return w.content=l.$t("AiChatErrorMsg"),w.loading=!1,r.abrupt("return");case 12:if(!f){r.next=39;break}return r.next=15,m.read();case 15:if(C=r.sent,k=C.done,O=C.value,x=Object(at.a)(O),!k){r.next=22;break}return f=!1,r.abrupt("break",39);case 22:if(!l.isErrorMsg(x)){r.next=28;break}return console.log("非流式输出接口报错！！",l.handleRegenerateMsg,y),l.msgList.length&&l.msgList[y]&&l.$set(l.msgList[y],"loading",!1),!l.handleRegenerateMsg&&l.msgList.splice(y,1),l.handleRegenerateMsg&&(l.msgList[y]&&(l.msgList[y].content=l.regenerateMsgCopy),l.handleRegenerateMsg=!1,l.regenerateMsgCopy=""),r.abrupt("return");case 28:l.msgList[y]&&(l.msgList[y].content=""),I=l.wipeMsg(x,y,n,v),w.content="",w.content=I,w.isDisabled=h,w.id=_,w.loading=!1,l.$nextTick((function(){l.scrollBottom(),l.getPaymentInfo()})),console.log("获取消息---\x3e 内容为: "+x,_),r.next=12;break;case 39:case"end":return r.stop()}}),r)})))()},objectToEncodedJSON:function(t){var e=JSON.stringify(t);return encodeURIComponent(e)},wipeMsg:function(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];console.log("wipeMsg--",t,e,n);var r=t.match(/\[([^\]]*)\][^\[]*$/);if(!r)return t;var l=JSON.parse(r[0]),c=Object(d.a)(l,4),h=c[0],v=c[1],m=c[2],f=c[3];if(this.$set(this.msgList[e],"coin",f),this.$set(this.msgList[e],"num_of_token",m),n&&!o){var _=this.msgList.findIndex((function(t){return t.id===n}));-1!==_&&(this.$set(this.msgList[_],"coin",v),this.$set(this.msgList[_],"num_of_token",h))}return t.replace(/\[[^\]]*]$/,"")},getTimeout:function(){var t=new AbortController,e=t.signal;return setTimeout((function(){t.abort()}),6e4),e},sendStreamRequest:function(t,e){var n=this;return Object(r.a)(regeneratorRuntime.mark((function o(){var data,r,l,c,d,h,v,m,f,_,y,path,w,C;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(console.log("sendStreamRequest",t),data=t.data,r=t.isKeep,l=void 0!==r&&r,c=t.rMsgId,d=void 0===c?"":c,h=t.c_time,v=void 0===h?"":h,m=t.url,f=void 0===m?"":m,_=t.regenerateMsgId,y=void 0===_?"":_,!n.isTreamMsgModel){o.next=16;break}return o.prev=3,path="".concat(f,"?q=").concat(n.objectToEncodedJSON(data)),o.next=7,n.getSSE({path:path,isKeep:l,rMsgId:d,c_time:v,regenerateMsgId:y});case 7:w=o.sent,e&&e(w),o.next=15;break;case 11:o.prev=11,o.t0=o.catch(3),console.log("sendStreamRequest-err:",o.t0),e&&e("");case 15:return o.abrupt("return");case 16:return o.prev=16,o.next=19,fetch(f,{signal:n.getTimeout(),method:"POST",headers:{"Content-Type":"application/json",token:n.$cookies.get("T"),"Accept-Language":n.$cookies.get("lang")||navigator.language||navigator.browserLanguage,"X-App-Id":"web_global_seaart","X-Ad-Id":window.$nuxt.$cookies.get("ad")},body:JSON.stringify(data)});case 19:if((C=o.sent).ok){o.next=22;break}throw new Error("Network response was not ok");case 22:e&&e(C),o.next=29;break;case 25:o.prev=25,o.t1=o.catch(16),console.log("sendStreamRequest-err:",o.t1),e&&e("");case 29:case"end":return o.stop()}}),o,null,[[3,11],[16,25]])})))()},getSSE:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var path,o,r,l,c,d,h,v,m,f,_,y,w;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(path=t.path,o=t.isKeep,r=void 0!==o&&o,l=t.rMsgId,c=void 0===l?"":l,d=t.c_time,h=void 0===d?"":d,v=t.regenerateMsgId,m=void 0===v?"":v,console.log("getSSE--",t),path){n.next=4;break}return n.abrupt("return",Promise.reject(new Error("No path provided")));case 4:return f=e.$cookies.get("lang")||navigator.language||navigator.browserLanguage,_=e.$cookies.get("T"),y=e.getTimeout(),w=window.$nuxt.$cookies.get("ad"),n.abrupt("return",new Promise((function(t,n){var o=null,l=null,d=null,v=!!m;e.chatStreamClass=new ot.a({url:path,headers:{signal:y,token:_,"Accept-Language":f,"X-App-Id":"web_global_seaart","X-Ad-Id":w},onUpdate:function(data){e.handleStreamUpdate(data,o)},onFinish:function(t,n){e.handleStreamFinish({msg:t,expend:n},{isKeep:r,sMsgId:l,msgIndex:o,isRegenerate:v})},onError:function(t){e.handleStreamError(t),n(t)},onResponseReceived:function(n){var v,f,_,y=null==n||null===(v=n.headers)||void 0===v?void 0:v.get("X-Status");if(y&&e.isErrorMsg(y))return console.log("流式接口报错！！",e.handleRegenerateMsg),e.msgList.length&&e.$set(e.msgList[0],"loading",!1),!e.handleRegenerateMsg&&e.msgList.splice(0,1),e.handleRegenerateMsg&&(e.msgList[0].content=e.regenerateMsgCopy,e.handleRegenerateMsg=!1,e.regenerateMsgCopy=""),e.streamIng=!1,void(e.activeTypingEffects=0);if(d=m||(r?h:c),l=null==n||null===(f=n.headers)||void 0===f?void 0:f.get("X-Msg-Id"),-1===(o=e.msgList.findIndex((function(t){return t.id===d||t.create_at===d})))&&(o=0),console.log("msgIndex--targetId",o,d),2===(null===(_=e.msgList[o])||void 0===_?void 0:_.role)&&!m){var w,C=null==n||null===(w=n.headers)||void 0===w?void 0:w.get("X-Response-Msg-Id");e.msgList[o].id=C}e.msgList[o]&&(e.$set(e.msgList[o],"showVoice",!1),e.$set(e.msgList[o],"loading",!1)),t(n)}}),e.activeTypingEffects=0,e.streamIng=!0,e.chatStreamClass.fetchSSE()})));case 9:case"end":return n.stop()}}),n)})))()},handleStreamUpdate:function(data,t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,content;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.msgList[t]&&e.$set(e.msgList[t],"loading",!1),o=data.content,""===(content=void 0===o?"":o)&&(content=String.fromCharCode(10)),e.contentQueue.push({content:content,msgIndex:t}),e.isProcessing){n.next=7;break}return n.next=7,e.processQueue();case 7:case"end":return n.stop()}}),n)})))()},processQueue:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,content,r,l,c,d,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isProcessing&&0!==t.contentQueue.length){e.next=2;break}return e.abrupt("return");case 2:t.isProcessing=!0,t.activeTypingEffects++,n=null;case 5:if(!(t.contentQueue.length>0)){e.next=30;break}o=t.contentQueue.shift(),content=o.content,r=o.msgIndex,n=r,l=content.split(""),c=st(l),e.prev=10,c.s();case 12:if((d=c.n()).done){e.next=20;break}return h=d.value,e.next=16,t.wait(t.typingSpeed);case 16:t.msgList[r]&&t.$set(t.msgList[r],"content",(t.msgList[r].content||"")+h),t.scrollBottom();case 18:e.next=12;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(10),c.e(e.t0);case 25:return e.prev=25,c.f(),e.finish(25);case 28:e.next=5;break;case 30:t.activeTypingEffects--,t.isProcessing=!1,0===t.activeTypingEffects&&(console.log("流式输出效果结束！"),null!==n&&t.msgList[n]&&t.$set(t.msgList[n],"showVoice",!0)),t.contentQueue.length>0&&t.processQueue();case 34:case"end":return e.stop()}}),e,null,[[10,22,25,28]])})))()},handleStreamFinish:function(t,e){console.log("消息流结束回调--",t,e);t.msg;var n=t.expend,o=e.isKeep,r=void 0!==o&&o,l=e.sMsgId,c=void 0===l?"":l,h=e.msgIndex,v=void 0===h?null:h,m=e.isRegenerate,f=void 0!==m&&m;if(n.length){var _=Object(d.a)(n,4),y=_[0],w=_[1],C=_[2],k=_[3],O=null;this.msgList[v]&&(this.$set(this.msgList[v],"coin",k),this.$set(this.msgList[v],"num_of_token",C)),!c||r||f||(O=this.msgList.findIndex((function(t){return t.id===c})),this.msgList[O]&&(this.$set(this.msgList[O],"coin",w),this.$set(this.msgList[O],"num_of_token",y))),console.log("消息流结束回调--","回复索引--",v,"发送者索引--",O,"发送者id--",c,"this.msgList--",this.msgList)}this.streamIng=!1,this.getPaymentInfo()},handleStreamError:function(t){console.error("Stream error:",t),this.streamIng=!1,this.isProcessing=!1},wait:function(t){return new Promise((function(e){return setTimeout(e,t)}))},isErrorMsg:function(t){console.log("isErrorMsg--",t);try{var e={70039:["showVipComputingDialog","vipDialogComputedTit2"],70010:["showBreakDialog","VipTip","basic"],80008:this.isVip?["showVipComputingDialog"]:["showNotVipComputingDialog"]};if(this.isTreamMsgModel){var n;if(t&&e[t])return(n=this.$EventBus).$emit.apply(n,Object(c.a)(e[t])),!0}else{var o,data=JSON.parse(t);if(data.status.code&&e[data.status.code])return(o=this.$EventBus).$emit.apply(o,Object(c.a)(e[data.status.code])),!0}}catch(t){return!1}},setMsgId:function(t,e){console.log("setMsgId","-msgIde-",t,"-cTime-",e);var n=this.msgList.findIndex((function(t){return t.create_at===e}));-1!==n&&(this.msgList[n].id=t)},pushMsg:function(t,e,n){var o=(new Date).getTime(),r={content:t,create_at:o,role:e?1:2,id:n||o,coin:"",num_of_token:"",loading:!Boolean(e),isDisabled:!1,recommend:"this is popup"===t,hasKeep:!1,showVoice:!0};return this.msgList.unshift(r),this.scrollBottom(),o},handleMsg:function(t){var e=t.msg,n=e.id,content=e.content,o=t.type,r=this.msgList.findIndex((function(t){return t.id===n}));switch(o){case"DEL":this.delMsg(r);break;case"EDIT":this.editMsg(r,content);break;case"REGENERATE":this.regenerateMsg(r)}},regenerateMsg:function(t){var e=this;if(!this.checkStatus()){var n=this.msgList[t+1],content=n.content,o=n.id,c=this.msgList[t].id,d=this.$route.query.s_id;this.regenerateMsgCopy=this.msgList[t].content,this.msgList[t].content="",this.$set(this.msgList[t],"loading",!0),this.handleRegenerateMsg=!0;var h={data:{last_msg:content,last_msg_id:Object(l.a)(o)===Number?String(o):o,msg_id:c,session_id:d,support_voice:this.info.support_voice},url:this.isTreamMsgModel?"/api/stream/character/session/msg/refresh":"/api/v1/character/session/message/refresh",regenerateMsgId:c};[null,void 0,""].includes(c)&&(delete h.data.msg_id,delete h.data.last_msg_id),this.isTreamMsgModel&&delete h.data.last_msg,this.sendStreamRequest(h,function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isTreamMsgModel){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.readStream(n,c);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},editMsg:function(t,content){this.msgList[t].content=content},delMsg:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e.$route.query.s_id,n.prev=1,2!==(r=e.msgList.slice(t-1,t+1).map((function(t){return null==t?void 0:t.id}))).length){n.next=6;break}return n.next=6,Object(h.h)({ids:r,session_id:o});case 6:e.msgList.splice(t-1,2),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(1),console.error("Error deleting messages:",n.t0);case 12:case"end":return n.stop()}}),n,null,[[1,9]])})))()},handleTips:function(){var t=this;this.msg=this.msg.concat("**");var e=this.msg.length;this.$nextTick((function(){var n,input=null===(n=t.$refs.aichatInput)||void 0===n?void 0:n.$el.querySelector("textarea");input&&input.setSelectionRange&&(input.focus(),input.setSelectionRange(e-1,e-1))}))}})},pt=ht,vt=(n(2693),Object(x.a)(pt,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"aichat-body"},[e("ai-chat-msg",t._g(t._b({ref:"aiChatMsg",attrs:{sendMessage:t.sendMessage,isShowKeep:t.isShowKeep,data:t.dataComputed},on:{msgChange:t.msgChange,handleKeepSay:t.handleKeepSay,load:function(e){return t.getChatMsg("load")},handle:t.handleMsg}},"ai-chat-msg",t.$attrs,!1),t.$listeners)),t._v(" "),e("AiChatCardManagePopup",t._b({},"AiChatCardManagePopup",t.$attrs,!1)),t._v(" "),e("div",{staticClass:"aichat-input flex-center"},[e("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.hideLayout,expression:"hideLayout"}],staticClass:"set-layout"},[e("i",{staticClass:"el-icon-setting",class:{active:t.isShowLayout},on:{click:function(e){t.isShowLayout=!t.isShowLayout}}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowLayout,expression:"isShowLayout"}],staticClass:"layout-popup"},[e("p",[t._v(t._s(t.$t("ChatPosition")))]),t._v(" "),e("div",{staticClass:"set-list",class:t.value},[e("i",{staticClass:"el-icon-arrow-left",on:{click:function(e){return t.setLayout("left")}}}),t._v(" "),e("i",{staticClass:"el-icon-arrow-down",on:{click:function(e){return t.setLayout("center")}}}),t._v(" "),e("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.setLayout("right")}}})])])]),t._v(" "),e("div",{staticClass:"input-panel flex-center",class:{"max-input":t.maxInput}},[e("div",{staticClass:"auto-chat-btn",on:{click:t.handleShowPopup}},[e("i",{staticClass:"iconfont icon-a-icon-AutomaticReply"})]),t._v(" "),e("el-input",{ref:"aichatInput",attrs:{type:"textarea",placeholder:t.$t("gpt_input_placeholder_mobile"),autosize:{minRows:1,maxRows:6}},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.enterSend.apply(null,arguments))}},model:{value:t.msg,callback:function(e){t.msg=e},expression:"msg"}}),t._v(" "),t.optimizeIng?e("i",{staticClass:"el-icon-loading"}):e("i",{directives:[{name:"show",rawName:"v-show",value:t.msg,expression:"msg"}],staticClass:"iconfont icon-mofabang",on:{click:t.handleOptimizeChat}}),t._v(" "),t.sendLoading||t.optimizeIng?e("i",{staticClass:"el-icon-loading"}):e("i",{staticClass:"el-icon-s-promotion",class:{disabled:!t.msg},on:{click:t.sendMsg}})],1)])],1)}),[],!1,null,"6f6f919e",null)),mt=vt.exports,ft={props:["url"],data:function(){return{}},methods:{imgLoad:function(){this.$emit("imgLoad")}}},gt=(n(2694),Object(x.a)(ft,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"aichat-figure flex-center"},[e("img",{attrs:{src:t.url,alt:""},on:{load:t.imgLoad}})])}),[],!1,null,"bee0a2c0",null).exports),bt=n(539),_t=n(540),yt=(n(76),{components:{DelChatPopup:n(538).a},props:["value"],data:function(){return{loading:!1,list:[],isShowPopup:!1}},filters:{DateFormat:function(t){var e=new Date(t),n=e.getFullYear(),o=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0");return"".concat(n,"/").concat(o,"/").concat(r)},TimeFormat:function(t){var e=new Date(t);return e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0")}},methods:{getLastChatList:function(){var t,e=this;this.loading=!0,Object(h.r)({page_size:100,with_latest_msg:1,character_id:null===(t=this.value)||void 0===t?void 0:t.id}).then((function(t){var n=(null==t?void 0:t.data).items;e.list=n||[]})).finally((function(){e.loading=!1}))},show:function(){this.getLastChatList(),this.isShowPopup=!0},close:function(){this.isShowPopup=!1},showDelChatPopup:function(t){var e=this,n=this.list[t].session_id;this.$refs.delChatPopup.open(n,(function(){e.delChatHandle(t)}))},delChatHandle:function(t){var e=this.$route.query.s_id,n=this.list[t].session_id;this.list.splice(t,1),n===e&&this.changeChat(this.list.length?0:-1,this.list)},changeChat:function(i,t){var e=this.$route.query.s_id,n=this.$route.params.id;if(i<0)this.$router.replace(this.localePath("/cyberPubPage/"+n));else{var o=t[i].session_id;o!==e&&(this.$router.replace(this.localePath({path:"/aiChat/"+n,query:{s_id:o}})),this.close())}}}}),wt=(n(2695),Object(x.a)(yt,(function(){var t,e=this,n=e._self._c;return n("el-dialog",{staticClass:"custom-dialog allchat-popup",attrs:{visible:e.isShowPopup,title:e.$t("AllChatTitle",{name:null===(t=e.value)||void 0===t?void 0:t.name})},on:{"update:visible":function(t){e.isShowPopup=t}}},[n("div",{staticClass:"popup-body"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"aichat-list hide-scrollbar"},e._l(e.list,(function(t,i){var o,r,l;return n("div",{key:t.session_id,staticClass:"aichat-item",class:{"aichat-item-active":t.session_id===(null===(o=e.$route.query)||void 0===o?void 0:o.s_id)}},[n("div",{staticClass:"aichat-head",style:{backgroundImage:"url(".concat(null===(r=e.value)||void 0===r||null===(r=r.cover)||void 0===r?void 0:r.url,")")},on:{click:function(t){return e.changeChat(i,e.list)}}}),e._v(" "),n("div",{staticClass:"aichat-info"},[n("p",{staticClass:"info-name",on:{click:function(t){return e.changeChat(i,e.list)}}},[e._v("\n            "+e._s(null===(l=e.value)||void 0===l?void 0:l.name)+"\n          ")]),e._v(" "),t.session_title?n("p",{staticClass:"info-date"},[e._v(e._s(t.session_title))]):[n("p",{staticClass:"info-date"},[e._v(e._s(e._f("DateFormat")(t.create_at)))]),e._v(" "),n("p",{staticClass:"info-time"},[e._v(e._s(e._f("TimeFormat")(t.create_at)))])],e._v(" "),n("p",{staticClass:"info-del"},[n("i",{staticClass:"el-icon-delete",on:{click:function(t){return e.showDelChatPopup(i)}}})])],2)])})),0),e._v(" "),n("del-chat-popup",{ref:"delChatPopup"})],1)])}),[],!1,null,"4b82ab82",null).exports),Ct=n(186);function kt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Ot(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?kt(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var xt={components:{STooltip:n(189).a},props:["value","info","timbreObj","isShowSetting"],data:function(){return{isShowHandle:!1,menuList:[{title:"FullScreen",key:"full_screen",off:!0},{title:"HideBack",key:"hide_bg",off:!0},{title:"enableMemory",key:"enable_memory",off:!0,isHide:!1},{title:"chatModelResponse",key:"enable_stream_chat",off:!0,isHide:!1},{title:"StartNewChat",icon:"icon-a-icon_newchat",key:"NewChat"},{title:"ResetChat",icon:"icon-a-icon_restartchat",key:"ResetChat"},{title:"Share",icon:"icon-icon_share",key:"Share",isHide:!1},{title:"AllChat",icon:"icon-a-icon_allchat",key:"AllChat"},{title:"Report",key:"Report",icon:"icon-icon_report"}],modeList:[{name:"AdvancedMode",value:"GPT-4-Turbo-1106",tips:this.$t("AdvancedModeTips"),logName:"Immersive"},{name:"freelyChat",value:"GPT-35-Turbo-1106",tips:this.$t("UniversalModeTips"),logName:"chat"},{name:"OvervalueMode",value:"Normal",tips:this.$t("OvervalueModeTips"),logName:"value"}],modeIndex:1,isShowModeHandle:!1}},computed:Ot(Ot(Ot({},Object(f.c)("user",["isLoggedIn"])),Object(f.e)("user",["cdnHost","userInfo"])),{},{list:function(){var t=this.menuList,e=this.info.publish_status;return t[6].isHide=2===e,t}}),mounted:function(){this.initModeIndex()},methods:Ot(Ot({},Object(f.d)("user",["SET_USER_INFO"])),{},{handleChangeModel:function(){var t=this;this.isLoggedIn?this.isShowModeHandle=!this.isShowModeHandle:this.$EventBus.$emit("openLoginDialog",{callBack:function(){return t.$emit("newChat")}})},compareTimestamp:function(t){return Date.now()-t>864e5?"long_memory_chat_old":"long_memory_chat_new"},switchChange:function(t,e){var n=this;if(this.isLoggedIn){if("enable_memory"===e){var o,r=null===(o=this.userInfo)||void 0===o?void 0:o.create_at;this.$logEvent("log_actions",{operation:this.compareTimestamp(r),behavior_info:"on_tarven_detail_page",behavior_info_sub:1===t?"open":"close"})}var l={};l[e]=t,Object(h.I)(l).then((function(o){var r;if(1e4===(null===(r=o.status)||void 0===r?void 0:r.code)){var l=JSON.parse(JSON.stringify(n.userInfo));l.character_setting[e]=t,n.SET_USER_INFO(l)}}))}},closePopup:function(){this.$emit("handle",{key:"Close",value:""})},initModeIndex:function(){if(this.isLoggedIn){var t=JSON.parse(localStorage.getItem("userInfo")).character_setting.gpt_model,e=this.modeList.findIndex((function(e){return e.value===t}));this.modeIndex=e>-1?e:1}},hideHandle:function(){this.isShowHandle&&(this.isShowHandle=!1)},hideModeHandle:function(){this.isShowModeHandle&&(this.isShowModeHandle=!1)},chooseMode:function(t,e){this.$logEvent("log_actions",{operation:"choose_".concat(t.logName,"_mode"),behavior_info:"on_tarven_detail_page"}),this.modeIndex=e,this.isShowModeHandle=!1,this.$emit("handle",{key:"gpt_model",value:t.value})},chooseLanguage:function(t){this.isShowHandle=!1,localStorage.setItem("translate_language",t),this.$emit("handle",{key:"Language",value:t})},openModal:function(){this.$emit("handle",{key:"Setting"})},handle:function(t,e){var n=this;if(this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"click_button_on_corner",behavior_info_sub:e}),this.isLoggedIn||["Share","HideBack","FullScreen","enableMemory","chatModelResponse"].includes(this.list[t].title)){var o=this.menuList[t];!e&&o.off||this.value.loading!==o.key&&(e||(this.isShowHandle=!1),this.$emit("handle",o))}else this.$EventBus.$emit("openLoginDialog",{callBack:function(){return n.$emit("newChat")}})}})},It=(n(2696),Object(x.a)(xt,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"aichat-set"},[e("i",{staticClass:"el-icon-close",on:{click:t.closePopup}}),t._v(" "),e("div",{staticClass:"info flex-center"},[e("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.hideModeHandle,expression:"hideModeHandle"}],staticClass:"info-item asset-item"},[e("span",{staticClass:"mode-item",on:{click:t.handleChangeModel}},[t._v("\n        "+t._s(t.$t(t.modeList[t.modeIndex].name))+" "),e("i",{staticClass:"el-icon-arrow-down",class:{"icon-active":t.isShowModeHandle}})]),t._v(" "),t.isShowModeHandle?e("div",{staticClass:"handle-menu handle-menu-mode"},[e("div",{staticClass:"menu-list"},t._l(t.modeList,(function(n,o){return e("div",{key:n.name,staticClass:"menu-item flex-between",class:{"menu-item-active":t.modeIndex===o},on:{click:function(e){return t.chooseMode(n,o)}}},[e("div",[e("span",{staticClass:"menu-item-text"},[t._v(t._s(t.$t(n.name)))]),t._v(" "),"GPT-4-Turbo-1106"===n.value?e("div",{staticClass:"new-img"},[t._v("\n                New\n              ")]):t._e()]),t._v(" "),t.modeIndex===o?e("span",{staticClass:"iconfont icon-gou"}):t._e()])})),0)]):t._e()]),t._v(" "),e("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.hideHandle,expression:"hideHandle"}],staticClass:"info-item handle-item"},[e("span",{staticClass:"handle-icon",on:{click:function(e){t.isShowHandle=!t.isShowHandle}}},[t._v("...")]),t._v(" "),t.isShowHandle?e("div",{staticClass:"handle-menu"},[e("div",{staticClass:"menu-list"},t._l(t.list,(function(n,i){return e("div",{directives:[{name:"show",rawName:"v-show",value:!n.isHide,expression:"!m.isHide"}],key:n.title,staticClass:"menu-item flex-between",class:{"last-menu-item":i===t.list.length-1}},[e("div",{on:{click:function(e){return t.handle(i,"")}}},[n.icon?e("i",{class:"iconfont ".concat(n.icon)}):t._e(),t._v(" "),e("span",[t._v(t._s(t.$t(n.title)))]),t._v(" "),n.tips?e("s-tooltip",{attrs:{info:n.tips,icon:"el-icon-info"}}):t._e()],1),t._v(" "),!["enable_memory","enable_stream_chat"].includes(n.key)&&n.off?e("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:function(e){return t.handle(i,"change")}},model:{value:t.value[n.key],callback:function(e){t.$set(t.value,n.key,e)},expression:"value[m.key]"}}):t._e(),t._v(" "),"enable_memory"===n.key&&n.off?e("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:function(e){return t.switchChange(e,"enable_memory")}},model:{value:t.value.enable_memory,callback:function(e){t.$set(t.value,"enable_memory",e)},expression:"value.enable_memory"}}):t._e(),t._v(" "),"enable_stream_chat"===n.key&&n.off?e("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:function(e){return t.switchChange(e,"enable_stream_chat")}},model:{value:t.value.enable_stream_chat,callback:function(e){t.$set(t.value,"enable_stream_chat",e)},expression:"value.enable_stream_chat"}}):e("i",{directives:[{name:"show",rawName:"v-show",value:t.value.loading===n.key,expression:"value.loading === m.key"}],staticClass:"el-icon-loading"})],1)})),0)]):t._e()])])])}),[],!1,null,"bd8472b2",null).exports),Dt=n(30),St={data:function(){return{isShowPopup:!1,loading:!1,submitEvent:null}},methods:{open:function(t){this.submitEvent=t,this.isShowPopup=!0},close:function(){this.isShowPopup=!1},submit:function(){var t=this;this.loading=!0,this.submitEvent&&this.submitEvent((function(e){t.loading=!1,e&&t.close()}))}}},Pt=(n(2697),Object(x.a)(St,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"custom-dialog big-head-dialog allchat-popup reset-chat-popup",attrs:{visible:t.isShowPopup},on:{"update:visible":function(e){t.isShowPopup=e}}},[e("div",{staticClass:"popup-body"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t("ResetAiChatTitle")))]),t._v(" "),e("i",{staticClass:"el-icon-close",on:{click:t.close}}),t._v(" "),e("div",{staticClass:"aichat-reset"},[t._v("\n      "+t._s(t.$t("ResetAiChatDesc"))+"\n    ")])]),t._v(" "),e("div",{staticClass:"handle-btn",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{staticClass:"cancel-btn",attrs:{type:"default"},on:{click:t.close}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{staticClass:"submit-btn",attrs:{type:"default",loading:t.loading},on:{click:t.submit}},[t._v(t._s(t.$t("ResetChat")))])],1)])}),[],!1,null,"232a81e8",null).exports),Lt=n(345);function jt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function $t(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?jt(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Tt={beforeRouteEnter:function(t,e,n){n((function(t){t.historyStack.push(e.fullPath)}))},beforeRouteLeave:function(t,e,n){this.historyStack=this.historyStack.filter((function(path){return path!==e.fullPath})),n()},name:"aiChat",components:{AiChatHead:bt.a,AiChatLast:_t.a,AiChatFigure:gt,AiChatBody:mt,AllChatPopup:wt,AiChatReport:Ct.a,ResetChatPopup:Pt,AiChatSetting:It,CommentDrawer:Lt.a},asyncData:function(t){return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,d,h,v,m,f,_,y,data,w,C,k;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.$axios,o=t.params,r=t.query,l=t.error,c=(o||null).id,d=(r||null).s_id,h=null,v=null,m={},f=1e4,e.prev=7,_={id:c,check_session_id:d},d||delete _.check_session_id,null==o||!o.id){e.next=18;break}return e.next=13,n.$post("/api/v1/character/detail",_);case 13:y=e.sent,data=y.data,w=y.status,f=null==w?void 0:w.code,data&&(C=data.vip_only,k=data.latest_session,m=data,v=C,d||(h=k.length?k[0].session_id:null));case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(7),console.log("数字人聊天页-> asyncData错误啦：",e.t0),l({statusCode:404,message:e.t0});case 24:return e.abrupt("return",{characterInfo:m,vip_only:v,aiChatId:c,aiChatSessionId:h||d,characterCode:f});case 25:case"end":return e.stop()}}),e,null,[[7,20]])})))()},data:function(){return{characterCode:1e4,useCard:{},isShowFree:!1,timbreObj:{},historyStack:[],first_msg_has_voice:!1,aiChatId:null,aiChatSessionId:null,layout:"center",characterInfo:{},imgReady:!1,handleConfig:{hide_bg:2,full_screen:1,style:"center",gpt_model:"GPT-35-Turbo-1106",Lang:"",loading:"",enable_memory:2,enable_stream_chat:1}}},computed:$t($t($t($t({},Object(f.c)("user",["isCompanyAccount","isLoggedIn"])),Object(f.e)("user",["userInfo"])),Object(f.e)("payment",["paymentInfo"])),{},{bgImg:function(){var t,e=(null===(t=this.characterInfo)||void 0===t?void 0:t.vision)||{},n=e.bg,o=e.character;return(null==n?void 0:n.url)||(null==o?void 0:o.url)||"https://image.cdn2.seaart.ai/static/upload/20231211/af3b8892-05bf-4823-a304-9f8de1231b47.webp"},figureImg:function(){var t,e=(null===(t=this.characterInfo)||void 0===t?void 0:t.vision)||{},n=e.bg,o=e.character;return(null==o?void 0:o.url)||(null==n?void 0:n.url)||"https://image.cdn2.seaart.ai/static/upload/20231211/af3b8892-05bf-4823-a304-9f8de1231b47.webp"},isDim:function(){var t,e=(null===(t=this.characterInfo)||void 0===t?void 0:t.vision)||{},n=e.bg,o=e.character;return!(null!=o&&o.url&&null!=n&&n.url)},isShowFigure:function(){var t=this.handleConfig,e=t.hide_bg;t.full_screen;return this.imgLoad&&1!==e},isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)},characterSetting:function(){var t;return(null===(t=this.userInfo)||void 0===t?void 0:t.character_setting)||{}},notAnySession:function(){var t,e;return!this.aiChatSessionId||!(null!==(t=this.characterInfo)&&void 0!==t&&t.session_id)&&(null===(e=this.$route)||void 0===e||null===(e=e.query)||void 0===e?void 0:e.s_id)}}),watch:{characterSetting:{handler:function(t){var e=this;t&&"{}"!==JSON.stringify(t)&&this.$nextTick((function(){console.log(789,t),e.handleConfig.full_screen=t.full_screen||1,e.handleConfig.hide_bg=t.hide_bg||2,e.handleConfig.style=t.style||"center",e.layout=e.handleConfig.style,e.handleConfig.enable_memory=t.enable_memory||2,e.handleConfig.enable_stream_chat=t.enable_stream_chat||1,t.gpt_model?e.handleConfig.gpt_model=t.gpt_model:e.setModel("GPT-35-Turbo-1106"),e.handleConfig.Lang=localStorage.getItem("translate_language")||e.$i18n.locale}))},immediate:!0,deep:!0},$route:function(t,e){var n,o;if((null===(n=t.query)||void 0===n?void 0:n.s_id)!==(null===(o=e.query)||void 0===o?void 0:o.s_id)){var r=t.query.s_id,l=t.params.id;this.aiChatId=l,this.aiChatSessionId=r,this.reloadMsg(),this.reportView(l)}},characterInfo:{handler:function(t){var e=this;this.$nextTick((function(){null!=t&&t.timbre_id&&e.getVoiceDetail()}))},deep:!0,immediate:!0}},mounted:function(){this.$EventBus.$on("updateCurrentCard",this.updateCurrentCard),this.chatPermission(),this.checkStatus()||(this.notAnySession?this.newChat():this.$route.query.s_id?this.reloadMsg():this.reloadPage(this.aiChatSessionId))},beforeDestroy:function(){this.$EventBus.$off("updateCurrentCard")},methods:$t($t({},Object(f.d)("user",["SET_USER_INFO"])),{},{checkStatus:function(){if(1e4===this.characterCode)return!1;switch(this.characterCode){case 10610:this.$EventBus.$emit("loadComponent",{name:"bannedTipMask2",data:{message:"bannedTipCharter"}});break;case 10621:this.$message({type:"warning",message:this.$t("chatFail"),duration:5e3,offset:100});break;default:console.warn("Unhandled character code: ".concat(this.characterCode))}return!0},updateCurrentCard:function(data){console.log("接受！！！updateCurrentCard",data),this.useCard=data},compareTimestamp:function(t){return Date.now()-t>864e5?"long_memory_chat_old":"long_memory_chat_new"},enableMemoryChange:function(t){var e,n=this;if(this.handleConfig.enableMemory=t,this.isLoggedIn){var o=null===(e=this.userInfo)||void 0===e?void 0:e.create_at;this.$logEvent("log_actions",{operation:this.compareTimestamp(o),behavior_info:"on_tarven_detail_page",behavior_info_sub:1===t?"open":"close"}),Object(h.I)({enable_memory:t}).then((function(e){var o;if(1e4===(null===(o=e.status)||void 0===o?void 0:o.code)){var r=JSON.parse(JSON.stringify(n.userInfo));r.character_setting.enable_memory=t,console.log("更新用户信息",r.character_setting.enable_memory),n.SET_USER_INFO(r)}}))}},updateSession:function(t){if(!this.checkStatus()){var e=t.character_id,n=t.session_id;this.aiChatSessionId=n,this.aiChatId=e,this.$refs.chatBody.contentQueue=[],this.reloadPage(n)}},layOutChange:function(t){this.changeCharacterSetting("style",t)},getVoiceDetail:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"+"!==(null===(n=t.characterInfo)||void 0===n?void 0:n.timbre_id)){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,Object(h.v)({id:null===(o=t.characterInfo)||void 0===o?void 0:o.timbre_id});case 5:1e4===(r=e.sent).status.code&&(t.timbreObj=r.data),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log("err",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},reportView:function(t){Object(Dt.g)({items:[{action:"view",obj_no:t,obj_type:9}]})},updateTimbreObj:function(t,source){var e;if(console.log("聊天页更新会话的音色",t.timbre,source),(null===(e=this.timbreObj)||void 0===e?void 0:e.id)===t.id)return!1;this.timbreObj=t.timbre,this.characterInfo.timbre_id=this.timbreObj.id||this.characterInfo.timbre_id,this.bindVoiceToSeeion()},chatPermission:function(){if(location.origin.includes(".me"))this.$router.replace(this.localePath("/"));else{var t=this.paymentInfo,e=t.tempCoins;t.calculateCoins}},imgLoad:function(){this.imgReady=!0},reloadMsg:function(){this.startChat()},startChat:function(){var t=this;this.aiChatSessionId&&Object(h.L)({session_id:this.aiChatSessionId,dft_timbre_id:this.characterInfo.timbre_id}).then((function(e){var n=e.data,o=n.timbre,r=void 0===o?null:o,l=n.isFree,c=void 0!==l&&l,d=n.card,h=void 0===d?{}:d;t.timbreObj=r,t.characterInfo.timbre_id=r.id||t.characterInfo.timbre_id,t.isShowFree=c,t.useCard=h}))},updateCard:function(t){console.log("更新当前的使用资料卡信息",t),this.useCard=t},bindVoiceToSeeion:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLoggedIn){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,Object(h.J)({session_id:t.aiChatSessionId,timbre_id:t.timbreObj.id});case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:case"end":return e.stop()}}),e,null,[[2,7]])})))()},handle:function(t){var e=t.key;if(["hide_bg","Close","Share","AllChat","full_screen"].includes(e)||this.isLoggedIn)switch(e){case"full_screen":this.fullScreen(!1);break;case"hide_bg":this.fullScreen(!0);break;case"NewChat":if(!this.isLoggedIn)return void this.$EventBus.$emit("openLoginDialog",{redirect:this.$route.fullPath});this.newChat();break;case"ResetChat":this.openResetPopup();break;case"Share":this.shareAiChat();break;case"AllChat":this.showAllChatPopup();break;case"Report":this.showReport();break;case"gpt_model":this.setModel(t.value);break;case"chooseLanguage":this.setLanguage(t.value);break;case"Setting":this.openSetting();break;case"Close":this.closeSetModal()}else this.$EventBus.$emit("openLoginDialog")},closeSetModal:function(){this.$refs.commentDrawer.handleClose()},fullScreen:function(){var t=arguments,e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t.length>0&&void 0!==t[0]&&t[0])){n.next=6;break}return n.next=4,e.changeCharacterSetting("hide_bg","",!0);case 4:n.next=8;break;case 6:return n.next=8,e.changeCharacterSetting("full_screen","",!1);case 8:case"end":return n.stop()}}),n)})))()},shareAiChat:function(){var t=location.host+this.localePath("/cyberPubPage/".concat(this.aiChatId));Object(J.d)(t),this.$message.success(this.$t("CopiedURLToClipboard"))},openResetPopup:function(){this.$refs.resetChatPopup.open(this.resetChat)},resetChat:function(t){var e=this;this.handleConfig.loading="ResetChat",localStorage.removeItem("translate_".concat(this.aiChatSessionId)),Object(h.H)({session_id:this.aiChatSessionId}).then((function(n){var o=n.data.support_voice,r=void 0===o?0:o;e.first_msg_has_voice=1===r,t&&t(n),e.$refs.chatBody.initLoadMsg("resetChat")})).catch((function(e){t&&t("")})).finally((function(){e.handleConfig.loading=""}))},newChat:function(){var t=this;console.log("开始新聊天！！"),this.isLoggedIn&&(this.checkStatus()||(this.handleConfig.loading="NewChat",Object(h.g)({character_id:this.aiChatId,mask:""}).then((function(e){var n=e.data,o=n.session_id,r=n.support_voice,l=void 0===r?0:r;t.first_msg_has_voice=1===l,t.reloadPage(o),t.aiChatSessionId=o})).finally((function(){t.handleConfig.loading=""}))))},reloadPage:function(t){var e=this.localePath("/aiChat/".concat(this.aiChatId,"?s_id=").concat(t));this.$router.replace(e)},setModel:function(t){var e=this;Object(h.I)({gpt_model:t}).then((function(n){var o=JSON.parse(JSON.stringify(e.userInfo));o.character_setting.gpt_model=t,e.SET_USER_INFO(o)}))},changeCharacterSetting:function(){var t=arguments,e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.length>1&&void 0!==t[1]?t[1]:"",l=t.length>2&&void 0!==t[2]&&t[2],"style"!==(o=t.length>0&&void 0!==t[0]?t[0]:"")||!r||e.isLoggedIn){n.next=6;break}return e.layout=r,n.abrupt("return");case 6:if((c=Object(y.cloneDeep)(e.userInfo)).character_setting[o]=r||(2===c.character_setting[o]||0===c.character_setting[o]?1:2),o&&Object.keys(e.characterSetting).includes(o)&&Object.keys(e.handleConfig).includes(o)){n.next=10;break}return n.abrupt("return");case 10:if((d={})[o]=null==c?void 0:c.character_setting[o],l&&1===c.character_setting.hide_bg&&(e.handleConfig.full_screen=1,d.full_screen=1),l||(e.handleConfig.hide_bg=2,d.hide_bg=2),e.isLoggedIn){n.next=16;break}return n.abrupt("return");case 16:return"style"===o&&(d[o]=r),e.SET_USER_INFO(c),console.log("params",d),n.prev=19,n.next=22,Object(h.I)(d);case 22:n.next=27;break;case 24:n.prev=24,n.t0=n.catch(19),console.log(n.t0);case 27:case"end":return n.stop()}}),n,null,[[19,24]])})))()},showAllChatPopup:function(){this.getAiChatInfo(),this.$refs.allChatPopup.show()},showReport:function(){this.$refs.aiChatReport.open()},getAiChatInfo:function(){var t=this;this.imgReady=!1,Object(h.q)({id:this.aiChatId}).then((function(e){var n;t.characterCode=(null===(n=e.status)||void 0===n?void 0:n.code)||1e4,t.characterInfo=e.data,t.$set(t,"characterInfo",e.data),t.checkStatus()}))},setLanguage:function(t){this.handleConfig.Lang=t},handleUpdateCountNum:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.characterInfo=Object.assign({},this.characterInfo,t)},openSetting:function(){this.$refs.commentDrawer&&this.$refs.commentDrawer.openModal(this.characterInfo)}})},Bt=Tt,Mt=(n(2698),Object(x.a)(Bt,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"aichat-page",class:{hideback:1===t.handleConfig.hide_bg,"dim-bg":t.isDim,"full-page":1===t.handleConfig.full_screen}},[e("div",{staticClass:"bg",style:{backgroundImage:"url(".concat(t.bgImg,")")}}),t._v(" "),e("div",{staticClass:"aichat-main",class:"aichat-"+t.layout},[e("ai-chat-head",{attrs:{info:t.characterInfo,timbreObj:t.timbreObj},on:{newChat:t.newChat,openSetting:t.openSetting,updateTimbreObj:t.updateTimbreObj}}),t._v(" "),e("ai-chat-last",{ref:"lastChat",attrs:{historyStack:t.historyStack,characterInfo:t.characterInfo,characterId:t.aiChatId},on:{updateSession:t.updateSession}}),t._v(" "),e("div",{staticClass:"aichat-content"},[e("ai-chat-body",{ref:"chatBody",attrs:{characterCode:t.characterCode,useCard:t.useCard,handleConfig:t.handleConfig,sessionId:t.aiChatSessionId,info:t.characterInfo,isShowFree:t.isShowFree},on:{newChat:t.newChat,layOutChange:t.layOutChange,updateTimbreObj:t.updateTimbreObj}}),t._v(" "),e("ai-chat-figure",{class:{"show-img":t.isShowFigure},attrs:{url:t.figureImg},on:{imgLoad:t.imgLoad}})],1)],1),t._v(" "),e("all-chat-popup",{ref:"allChatPopup",model:{value:t.characterInfo,callback:function(e){t.characterInfo=e},expression:"characterInfo"}}),t._v(" "),e("ai-chat-report",{ref:"aiChatReport",attrs:{aiChatId:t.aiChatId}}),t._v(" "),e("reset-chat-popup",{ref:"resetChatPopup",attrs:{aiChatId:t.aiChatId}}),t._v(" "),e("CommentDrawer",{ref:"commentDrawer",attrs:{isShowSetting:""},on:{newChat:t.newChat,updateCountNum:t.handleUpdateCountNum},scopedSlots:t._u([{key:"Settings",fn:function(){return[e("AiChatSetting",{attrs:{info:t.characterInfo,timbreObj:t.timbreObj,isShowSetting:!0},on:{newChat:t.newChat,handle:t.handle,updateTimbreObj:t.updateTimbreObj},model:{value:t.handleConfig,callback:function(e){t.handleConfig=e},expression:"handleConfig"}})]},proxy:!0}])})],1)}),[],!1,null,"743e5e66",null));e.default=Mt.exports},3255:function(t,e,n){"use strict";n.r(e);n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),r=(n(16),n(14),n(71),n(125),n(28),n(113),n(1));function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d={name:"ActivityHome",props:{galleryIndex:{type:Number,default:0}},computed:c(c({},Object(r.c)("user",["cdnHostFun"])),{},{langKey:function(){return this.$i18n.locale.startsWith("zh")?"zh":this.$i18n.locale.startsWith("ja")?"jp":"en"},imgList:function(){var t,e=this[["homeBgMap","detailBgMap","resultBgMap"][this.galleryIndex]||"homeBgMap"],n=this.langKey;return(null==e||null===(t=e[n])||void 0===t?void 0:t.contents)||[]},homeBgMap:function(){return{en:{contents:this.generateUrls("en",2,3)},zh:{contents:this.generateUrls("zh",2,3)},jp:{contents:this.generateUrls("jp",2,3)}}},detailBgMap:function(){return{en:{contents:[]},zh:{contents:[]},jp:{contents:[]}}},resultBgMap:function(){return{en:{contents:this.generateUrls("en",1,2,"/static/fluxsecondresult/")},zh:{contents:this.generateUrls("zh",1,2,"/static/fluxsecondresult/")},jp:{contents:this.generateUrls("jp",1,2,"/static/fluxsecondresult/")}}},downloadArea:function(){var path=this.localePath("/models/detail/5073e7d38c3bb4376c201ec297b60261");return{imgUrl:this.generateUrls(this.langKey,6,6),link:path}},downloadAreaRight:function(){var path=this.localePath("/models/detail/7e66a2f311f4b593a51a54234fc37c3d");return{imgUrl:this.generateUrls(this.langKey,7,7),link:path}},firstBg:function(){var path="https://docs.seaart.ai/guide-1/2-seaart-ai-basic-function/flux-lora-training";return this.$isChinaSite&&(path="https://kvrbeskjhpg.feishu.cn/docx/VqXBdza69olCYexouetcglKCn6e#GI4JdNsozouBEWx79CccpBzdnOg"),{imgUrl:this.generateUrls(this.langKey,5,5),link:path}}}),data:function(){return{}},methods:{generateUrls:function(t){for(var e=arguments.length>2?arguments[2]:void 0,path=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"/static/fluxsecond/",n=[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;i<=e;i++)n.push("https://".concat(this.cdnHostFun()).concat(path).concat(t,"/web").concat(i,".png"));return n},download:function(t){null!=t&&t.link&&window.open(null==t?void 0:t.link,"_blank")}}},h=d,v=(n(2699),n(0)),m=Object(v.a)(h,(function(){var t=this,e=t._self._c;return e("el-row",{staticClass:"activity-home-content"},t._l(t.imgList,(function(n,o){return e("div",{key:"ac_home_img_".concat(o),staticClass:"item-row"},[n?e("img",{attrs:{src:n,alt:"activity_img"},on:{mousedown:function(t){t.preventDefault()},contextmenu:function(t){t.preventDefault()}}}):t._e(),t._v(" "),n.endsWith("web2.png")&&0===t.galleryIndex?[t.firstBg.imgUrl?e("img",{staticClass:"first-bg-area",class:"top"+t.langKey,attrs:{src:t.firstBg.imgUrl,alt:"first-bg-btn"},on:{click:function(e){return t.download(t.firstBg)}}}):t._e()]:t._e(),t._v(" "),n.endsWith("web3.png")&&0===t.galleryIndex?[t.downloadArea.imgUrl?e("img",{staticClass:"download-area",class:"top"+t.langKey,attrs:{src:t.downloadArea.imgUrl,alt:"download-btn"},on:{click:function(e){return t.download(t.downloadArea)}}}):t._e(),t._v(" "),t.downloadAreaRight.imgUrl?e("img",{staticClass:"download-area download-area-right",class:"top"+t.langKey,attrs:{src:t.downloadAreaRight.imgUrl,alt:"download-btn"},on:{click:function(e){return t.download(t.downloadAreaRight)}}}):t._e()]:t._e()],2)})),0)}),[],!1,null,"5d429db0",null).exports,f=(n(274),n(55)),_=n(149);function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var C={name:"ActivityWaterfall",props:{type:{type:String,default:"model"},order:{type:String,default:"hot"}},components:{homeList:f.a},computed:{},data:function(){return{loading:!1,noMore:!1,pageInfo:{page:1,limit:20,total:0},queryParam:{page:1,page_size:35,order_by:"hot"},list:[]}},mounted:function(){console.log("mounted comfyui"),this.getList()},methods:{refresh:function(){console.log("refresh"),this.pageInfo.page=1,this.noMore=!1,Reflect.deleteProperty(this.queryParam,"time_to"),this.getList()},getList:function(t){var e=this;if(!this.loading&&!this.noMore){this.loading=!0;var n=_.c,o=w(w({},this.queryParam),{},{page:this.pageInfo.page,page_size:this.pageInfo.limit,type:"model"===this.type?2:4,order_by:"model"===this.type?"new":this.order});this.queryParam.time_to&&(o.time_to=this.queryParam.time_to),n(o).then((function(n){var o;if(1e4===(null==n||null===(o=n.status)||void 0===o?void 0:o.code)){var r,l,c,d,h;if(e.noMore=!(null!==(r=n.data)&&void 0!==r&&r.has_more),t)e.list=e.list.concat((null===(c=n.data)||void 0===c?void 0:c.items)||[]);else e.list=(null===(d=n.data)||void 0===d?void 0:d.items)||[];if(1===e.pageInfo.page&&null!==(l=n.data)&&void 0!==l&&l.time_ms)e.queryParam.time_to=null===(h=n.data)||void 0===h?void 0:h.time_ms;e.pageInfo.page++}})).finally((function(){e.getReady=!0,e.loading=!1}))}}}},k=(n(2700),Object(v.a)(C,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"activity-waterfall"},[e("div",{ref:"activityList",staticClass:"activity-waterfall__list"},[e("homeList",{attrs:{fromPage:"activityPage",isOpen:!0,isOpenNewTab:!0,list:t.list,container:"activityList"},on:{load:function(e){return t.getList(!0)}}}),t._v(" "),0===t.list.length?e("div",{staticClass:"at-bottom"},[e("div",{staticClass:"dashed-line"}),t._v(" "),e("div",{staticClass:"tips"},[t._v(t._s(t.$t("NoMoreData")))]),t._v(" "),e("div",{staticClass:"dashed-line"})]):t._e()],1)])}),[],!1,null,"1c324e75",null).exports),O=(n(19),n(10),n(15)),x=(n(47),n(70),n(36),n(18),n(5)),I=n(87),D=n(35),S=n.n(D),P=n(39),L=n(30);function j(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function $(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?j(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var T={mixins:[n(33).a],inject:["activityOver"],props:{list:{type:Array,default:function(){return[]}},container:{type:String,require:!0},gap:{type:Number,default:16},topGap:{type:Number,default:40},lazy:{type:Boolean,default:!1},type:{type:String,default:""},actived:{type:Boolean,default:!0},cols:{type:Number,default:7},fromPage:{type:String,default:""},isFromRelated:{type:Boolean,default:!1},isShowNullRelatedImg:{type:Boolean,default:!1},alreadyNoMoreData:{type:Boolean,default:!1},noSearchData:{type:Boolean,default:!1},isCheck:{type:Boolean,default:!1},dislikeShow:{type:Boolean,default:!1},hidethumbup:{type:Boolean,default:!1},hidecollect:{type:Boolean,default:!1},hoverShow:{type:Boolean,default:!1},imgQuality:{type:String,default:"low"},isTiemRow:{type:Boolean,default:!1},openWin:{type:Boolean,default:!1},checkMax:{type:Number,default:-1},category:{type:Boolean,default:!1},dotReportInfo:{type:Object,default:function(){return{category:"default",view_domain:"",batch_id:""}}},contentType:{type:String,default:"model"}},data:function(){var t=this;return{formatNumberForeign:x.i,copyTextToClipboard:x.d,saveImg:x.z,width:0,heights:[],dataList:[],resizeListener:Object(I.a)((function(){return t.resize(t.dataList)}),500),selfCols:4,isCollecting:!1,imagePopoverVisible:!1,reportLoading:!1,openWatch:!0,isDelete:!1,sharevisible:!1,popTime:0,itemShow:!1,itemShowId:"",checkList:{ids:[],collectIds:[],folderNos:[],url:[]},scrollTop:0,lastTime:null,appeaData:{obj_no:"",obj_type:1,remark:""},appealShow:!1,errorCodeMap:{40202:"voteOver",40204:"voteDid",40205:"voteForbidden",40206:"voteSelf"}}},watch:{appealShow:{handler:function(t){t||(this.appeaData={obj_no:"",obj_type:1,remark:""})}},list:{handler:function(t,e){var n=this.openWatch,o=this.width;if(n){o&&0!=o||(this.width=this.getWidth());var r=S()(t);if(this.dataList.length<100)this.updateDataList(r,!1);else if(r.length>this.dataList.length){var l=Object(O.a)(r.slice(this.dataList.length));this.updateDataList(l,!0)}else r.length<=this.dataList.length&&(this.dataList=[],this.updateDataList(r,!1))}}},WaterFallDeleteLits:{handler:function(t){this.isDelete=!0}}},computed:$($($({},Object(r.c)("user",["isLoggedIn","accountSettingsData"])),Object(r.e)("user",["userInfo","accountData","adminOff"])),{},{greenMode:function(){var t;return 2!==(null==this||null===(t=this.accountData)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.green_mode)},enableGreenMode:function(){return this.greenMode&&!["/personal"].includes(this.$route.path)},checkIsShowViewNsfw:function(){var t;return null==this||null===(t=this.userInfo)||void 0===t?void 0:t.enable_nsfw_plus},enableNsfwMode:function(){var t;return![2,"2"].includes(null==this||null===(t=this.userInfo)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.nsfw_plus)},isShowNsfw:function(){return function(t){return this.category&&this.checkIsShowViewNsfw&&!this.enableNsfwMode&&1!==t.nsfw&&(null==t?void 0:t.is_nsfw_plus)}},isPC:function(){return"PC"===localStorage.getItem("visitFrom")}}),created:function(){},activated:function(){var t=this;this.openWatch=!0,this.resizeListener(),window.addEventListener("resize",this.resizeListener),this.lazy&&document.addEventListener("scroll",this.lazyLoad),this.$nextTick((function(){window.scrollTo(0,t.scrollTop)}))},deactivated:function(){this.openWatch=!1,window.removeEventListener("resize",this.resizeListener),window.removeEventListener("scroll",this.lazyLoad)},mounted:function(){window.addEventListener("resize",this.resizeListener),this.lazy&&document.addEventListener("scroll",this.lazyLoad)},beforeDestroy:function(){window.removeEventListener("resize",this.resizeListener),window.removeEventListener("scroll",this.lazyLoad)},methods:$($({},Object(r.b)("user",["getAccountInfo"])),{},{voteFun:function(t){var e=this;if(!this.activityOver)if(this.isLoggedIn){var n={item_id:t.id,item_type:4};Object(_.g)(n).then((function(n){var o,code=null==n||null===(o=n.status)||void 0===o?void 0:o.code,r=(null==n?void 0:n.data)||1;1e4===code?(e.$message({message:e.$t("voteDone"),type:"success"}),t.rank_score+=r):Object.keys(e.errorCodeMap).includes(String(code))?e.$message.error(e.$t(e.errorCodeMap[code])):e.$message.error(e.$t("ServerError"))}))}else this.$EventBus.$emit("openLoginDialog")},goToDetail:function(t){"model"===this.contentType?window.open("/models/detail/".concat(t.id),"_blank"):window.open("/explore/detail/".concat(t.id),"_blank")},goToPersonal:function(t){var e,n=t.author.id,o=null===(e=this.userInfo)||void 0===e?void 0:e.id,path="/user/"+encodeURIComponent(n);o==n&&(path="/personal"),window.open(path,"_blank")},dynamicList:function(t){var e=this.$parent.$refs[this.container];if(!e)return t;var n=this.scrollTop-e.offsetTop;return t.filter((function(t){return n-t.top<2e3&&t.top-n<2e3}))},updateDataList:function(t,e){var n=this,o=this.dataList,r=this.checkList,l=this.WaterFallDeleteLits,c=this.width;t.forEach((function(t){o.forEach((function(e){t.id==e.id&&(t.collect=e.collect,t.liked=e.liked)}))}));var d,h,v=t.filter((function(t){return!l.includes(t.id)}));this.isTiemRow&&(e||(this.lastTime=null));for(var i=0;i<v.length;i++){var m=v[i];if(m.timeItem)m.waterWidth=c,m.waterHeight=30;else{var f,_,y,w,C;if(this.$set(m,"hoverd",!1),this.$set(m,"propS",!1),this.$set(m,"rowIndex",-1),!r.ids.includes(m.id))r.ids.push(m.id),null!=m&&null!==(y=m.collect)&&void 0!==y&&y.id&&r.collectIds.push(m.collect.id),null!=m&&null!==(w=m.folder_no)&&void 0!==w&&w.id&&r.folderNos.push(m.folder_no.id),null!=m&&null!==(C=m.banner)&&void 0!==C&&C.url&&r.url.push(m.banner.url);m.timeDiff=Object(P.c)(m.created_at,Date.now()),m.waterWidth=c,this.isTiemRow||"gallery"===this.type?m.waterHeight=c:(d=m.banner&&m.banner.width?m.banner.width:308,h=m.banner&&m.banner.height?m.banner.height:308,m.waterHeight=parseInt(h*c/d),isNaN(m.waterHeight)&&(m.waterHeight=320)),null===(f=m.banner)||void 0===f||!f.url||null!==(_=m.banner)&&void 0!==_&&_.replaceUrl||(m.banner.replaceUrl=Object(x.x)(m.banner.url,this.imgQuality||"low")),m.errorTime=0}}e?v.forEach((function(t){n.dataList.push(t)})):this.dataList=v,this.waterfall()},handleContextMenu:function(t,e){1===e.nsfw&&t.preventDefault()},handleClick:function(t,e,n){if(this.isLoggedIn){var o=this.list.findIndex((function(i){return i.id===t.id})),r=(o<10?this.list.slice(0,o):this.list.slice(o-10,o)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));switch(e){case"创作":Object(L.g)({items:[$($({},this.dotReportInfo),{},{negative_ids:r,action:"task"})]});var l=Object.assign({},t);"model"===this.type&&["explore","personal"].includes(this.fromPage)&&(l.taskSource=1),this.$EventBus.$emit("openGenerate",{action:1,data:{source:l}});break;case"收藏":Object(L.g)({items:[$($({},this.dotReportInfo),{},{negative_ids:r,action:"collection"})]}),this.setCollect(t,n)}}else this.$EventBus.$emit("openLoginDialog")},handleDetail:function(t,e){if(this.$logEvent("log_actions",{operation:{artwork:"click_image",model:"click_model",gallery:"click_gallery"}[this.type],behavior_info:e.id}),"activity"!==this.type)if("IMG"!==t.target.tagName&&"cltpop"!==t.target.className&&"img-content"!==t.target.className&&"statusZg"!==t.target.className&&"workInfo"!==t.target.className||"model"!==this.type)if("IMG"!==t.target.tagName&&"cltpop"!==t.target.className&&"img-content"!==t.target.className&&"statusZg"!==t.target.className&&"workInfo"!==t.target.className&&"green-mode-div"!==t.target.className||"artwork"!==this.type)"IMG"!==t.target.tagName&&"img-content"!==t.target.className&&"statusZg"!==t.target.className&&"workInfo"!==t.target.className||"gallery"!==this.type||(Object(L.g)({items:[{action:"view",obj_no:e.id,obj_type:4}]}),this.$router.push(this.localePath("/explore/detail/"+e.id)));else{var n=this.list.findIndex((function(i){return i.id===e.id})),o=(n<10?this.list.slice(0,n):this.list.slice(n-10,n)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));Object(L.g)({items:[$($({},this.dotReportInfo),{},{negative_ids:o,action:"view",obj_no:e.id,obj_type:1})]}),this.openWin?window.open("/explore/detail/"+e.id,"_blank"):this.$router.push(this.localePath("/explore/detail/"+e.id))}else 3==e.status||4==e.status?this.$router.push(this.localePath("/models/detail/".concat(e.id,"?type=other"))):this.$router.push(this.localePath("/models/detail/".concat(e.id)))},imgError:function(t){t.errorTime++,t.errorTime>=2||(this.$refs[t.id][0].src=t.banner.url)},waterfall:function(){var t=this;try{this.heights=[];for(var e=function(){var e=t.dataList[i],n=e.waterHeight;if(e.timeItem){e.left=0;var o=t.getMaxIndex(t.heights);e.top=o>-1?t.heights[o]+t.gap:0,t.heights.forEach((function(o,r){t.heights[r]=e.top+n}))}else if(t.heights.length<t.selfCols)if(t.dataList[i-1]&&t.dataList[i-1].timeItem)if(e.left=0,e.top=t.dataList[i-1].top+t.dataList[i-1].waterHeight+t.gap,t.heights[0]){var r=t.heights[0]+n;t.heights=[r+t.gap]}else t.heights.push(e.top+n);else e.top=t.dataList[i-1]?t.dataList[i-1].top:0,e.left=t.heights.length*(t.width+t.gap),t.heights.push(e.top+n);else{var l=t.getMinIndex(t.heights),c=t.heights[l]+t.topGap;e.top=c,e.left=l*(t.width+t.gap),t.heights[l]=c+n}},i=0;i<this.dataList.length;i++)e();this.setWaterFallRect()}catch(t){}},getWidth:function(){this.selfCols=this.cols;var t=this.$parent.$refs[this.container].offsetWidth;if(t){t<1700&&(this.selfCols=6),t<1500&&(this.selfCols=5),t<1240&&(this.selfCols=4),t<980&&(this.selfCols=3),t<730&&(this.selfCols=2),t<500&&this.isPC&&(this.selfCols=1);var e=~~((t-this.selfCols*this.gap-this.gap+32)/this.selfCols);return this.isPC?e>233?e:233:e>176?e:176}},setWaterFallRect:function(){var t=this.$parent.$refs[this.container],e=Math.max.apply(null,this.heights);this.list.length?(t.style.height=e+"px",t.style.marginBottom="130px"):t.style.height="0px"},getMinIndex:function(t){var e=Math.min.apply(null,t);return t.indexOf(e)},getMaxIndex:function(t){var e=Math.max.apply(null,t);return t.indexOf(e)},resize:function(t){var e=this;this.openWatch&&(this.$parent.$refs[this.container].offsetWidth<600||(this.dataList=S()(t).filter((function(t){return!e.WaterFallDeleteLits.includes(t.id)})),this.width=this.getWidth(),this.dataList.forEach((function(t){if(t.timeItem)t.waterWidth=e.width,t.waterHeight=30;else{var n,o;if(e.$set(t,"hoverd",!1),t.timeDiff=Object(P.c)(t.created_at,Date.now()),t.waterWidth=e.width,e.isTiemRow||"gallery"===e.type)t.waterHeight=e.width;else null!=t&&null!==(o=t.banner)&&void 0!==o&&o.width&&(t.waterHeight=parseInt(e.width/(t.banner.width/t.banner.height))),isNaN(t.waterHeight)&&(t.waterHeight=320);null!=t&&null!==(n=t.banner)&&void 0!==n&&n.replaceUrl&&(t.banner.replaceUrl=Object(x.x)(t.banner.url,e.imgQuality||"low")),t.errorTime=0}})),this.waterfall()))},lazyLoad:function(){if(this.actived&&this.openWatch){var t=document.documentElement.scrollHeight,e=window.innerHeight;this.scrollTop=document.documentElement.scrollTop||document.body.scrollTop||window.pageYOffset,t-this.scrollTop-e<1.5*e&&this.$emit("load")}},initials:function(t){return t.split(" ").map((function(t){return t[0]})).join("")},otherUser:function(t,e){var path=e?"/user/"+encodeURIComponent(t.author.id)+"?type=gather":"/user/"+encodeURIComponent(t.author.id);this.userInfo.id==t.author.id&&(path="/personal?tab=gather"),this.openWin?window.open(path,"_blank"):this.$router.push(this.localePath(path))},getPersonalInfoUrl:function(t){var path="/user/"+encodeURIComponent(t.author.id);return this.userInfo.id==t.author.id&&(path="/personal"),path}})},B=(n(2701),Object(v.a)(T,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"waterfall-container"},[t._l(t.dynamicList(t.dataList),(function(n,o){var r,l,c;return e("a",{key:n.top+","+n.left+","+o,staticClass:"waterfall-item",style:{top:n.top+"px",left:n.left+"px"},attrs:{href:"model"===t.contentType?"/models/detail/"+n.id:"/explore/detail/"+n.id,target:"_blank"},on:{click:function(e){return e.preventDefault(),t.handleDetail(e,n)},contextmenu:function(e){return t.handleContextMenu(e,n)}}},[n.timeItem?e("div",{staticClass:"timeRow",style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}},[t._v("\n      "+t._s(n.timeItem)+"\n    ")]):e("div",{staticClass:"listCnt",class:[1===n.banner.nsfw||t.isShowNsfw(n.banner)?"bg-nsfw":""]},[[2,"2"].includes(n.green)&&t.enableGreenMode?e("div",{staticClass:"green-mode-div",staticStyle:{"backdrop-filter":"blur(19px) saturate(160%)",position:"absolute",left:"0",top:"0"},style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}}):t._e(),t._v(" "),e("div",{staticClass:"img-content",style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}},[e("img",{ref:n.id,refInFor:!0,staticClass:"cntImg",style:{visibility:1===(null==n||null===(r=n.banner)||void 0===r?void 0:r.nsfw)||t.isShowNsfw(n.banner)?"hidden":"visible"},attrs:{decoding:"async",src:1===(null==n||null===(l=n.banner)||void 0===l?void 0:l.nsfw)||t.isShowNsfw(n.banner)?"":null==n||null===(c=n.banner)||void 0===c?void 0:c.replaceUrl},on:{error:function(e){return t.imgError(n)},dragstart:function(t){t.preventDefault()}}})]),t._v(" "),"activity"===t.type?e("div",{staticClass:"activity",class:{langger:n.name},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.goToDetail(n)}}},[e("div",{staticClass:"top-container"},[e("div",{staticClass:"points"},[t._v(t._s(((null==n?void 0:n.rank_score)||0)+" "+t.$t("voteUnit")))])]),t._v(" "),e("div",{staticClass:"personal-info"},[e("div",{staticClass:"left-info",style:{width:n.name?"100%":"calc(100% - 68px)"}},[n.author.head?e("img",{staticClass:"avatorClass",attrs:{decoding:"async",loading:"lazy",src:n.author.head,alt:""},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.goToPersonal(n)}}}):e("div",{staticClass:"avatorClass",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.goToPersonal(n)}}},[t._v("\n              "+t._s(t.initials(n.author.name||n.author.id))+"\n            ")]),t._v(" "),e("span",{staticClass:"ellipsis-text",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.goToPersonal(n)}}},[t._v("\n              "+t._s(n.author.name||n.author.id)+"\n            ")])]),t._v(" "),e("div",{staticClass:"right-btn",class:{disabled:t.activityOver},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.voteFun(n)}}},[t._v("\n            "+t._s(t.$t("vote"))+"\n          ")])])]):t._e()])])})),t._v(" "),t.alreadyNoMoreData?e("div",{staticClass:"at-bottom"},[e("div",{staticClass:"dashed-line"}),t._v(" "),e("div",{staticClass:"tips"},[t._v(t._s(t.$t("NoMoreData")))]),t._v(" "),e("div",{staticClass:"dashed-line"})]):t._e(),t._v(" "),t.noSearchData?e("div",{staticClass:"no-search-data-container"},[e("img",{staticClass:"no-search-image",attrs:{src:n(290),alt:"no search data"}}),t._v(" "),e("div",{staticClass:"null-tips"},[t._v(t._s(t.$t("NoSearchData")))])]):t._e()],2)}),[],!1,null,"36ebea42",null).exports);function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function R(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var A={name:"ActivityGallery",props:{type:{type:String,default:"model"},order:{type:String,default:""}},components:{AWaterFall:B},computed:{},data:function(){return{isLock:!1,isReq:!1,modelParam:{page:1,page_size:60,order_by:"hot",model_type:"",type:"activity"},galleryParam:{page:1,page_size:60,order_by:"hot"},list:[]}},mounted:function(){this.getList()},methods:{refresh:function(){this.galleryParam.page=1,this.isLock=!1,this.getList()},getList:function(t){var e=this;if(!this.isReq&&!this.isLock){this.isReq=!0;var param=R(R({},this.galleryParam),{},{type:4,order_by:this.order});(0,_.c)(param).then((function(n){var o;if(1e4===(null==n||null===(o=n.status)||void 0===o?void 0:o.code)){var r,l;e.isLock=!(null!=n&&null!==(r=n.data)&&void 0!==r&&r.has_more);var c,d,h=[];if((null==n||null===(l=n.data)||void 0===l||null===(l=l.items)||void 0===l?void 0:l.length)>0)h=null==n||null===(c=n.data)||void 0===c?void 0:c.items.map((function(t){return R(R({},t),{},{banner:{url:t.cover,nsfw:t.nsfw,width:(null==t?void 0:t.cover_width)||0,height:(null==t?void 0:t.cover_height)||0}})}));if(t?e.list=e.list.concat(h||[]):(e.list=[],e.$nextTick((function(){e.list=h}))),e.isReq=!1,1===e.galleryParam.page)e.galleryParam.time_to=null==n||null===(d=n.data)||void 0===d?void 0:d.time_ms;e.galleryParam.page++}else e.isLock=!0})).catch((function(){e.isReq=!1}))}}}},E=(n(2702),Object(v.a)(A,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"activity-waterfall"},[e("div",{ref:"wraper",staticClass:"wraper"},[e("AWaterFall",{ref:"AWaterFall",attrs:{type:"activity",contentType:t.type,topGap:60,cols:7,container:"wraper",list:t.list,lazy:!0,hidecollect:!0,hoverShow:!0,imgQuality:"high",alreadyNoMoreData:t.isLock},on:{load:function(e){return t.getList(!0)}}})],1)])}),[],!1,null,"6325a59a",null).exports),N=(n(32),n(23),n(120),n(41));function F(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function U(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?F(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var H={name:"tabBtns",components:{ClaimDialog:n(555).a},props:{btns:{type:Array,default:function(){return[]}},order:{type:String,default:"new"}},computed:U(U(U(U({},Object(r.c)("activity",["isInActivity"])),Object(r.e)("user",["userInfo"])),Object(r.c)("user",["isLoggedIn"])),{},{getBtnName:function(){var t;return this.$t("actvtyModel"===(null===(t=this.active)||void 0===t?void 0:t.name)?"actvtyModel":"actvtyImgGallery")},inShowResultTime:function(){return Date.now()>17295552e5},isShowClaimBtn:function(){var t="production".includes("production");if(console.log("isShowClaimBtn","production",this.isLoggedIn,this.inShowResultTime),!t&&this.isLoggedIn&&this.inShowResultTime)return!0;if(this.inShowResultTime&&Date.now()<17312544e5&&t){return this.userInfo.id&&["jiuchen1","xiaogua","chaochao","longdamiao","1d236c248c47a125f6915ec2165cb67a","5690f702d7871bd3e34c268102badef7","fa6c65cd4a4edc21234b2eaa6a109499","3c939b92b2514df581dfaa8e27f89cc7","c21b73e5524935e42f7bcef072b6a984","4a8bd4a44dadca93c34893f6eee0bb5d","b726608a0462d77414a8a3f7eac56e83","3aa2932a0aa02f6e5152d94abce261d3","2e67b050a0a36fc6aaea0e2ae533d5fb"].includes(this.userInfo.id)}}}),data:function(){return{active:{name:"actvtyInfo",label:"actvtyInfo"},search:{name:"actvtyInfo",order:"new"},orders:[{name:"New",value:"new",icon:"new1"},{name:"actvtyPoint",value:"hot",icon:"icon-jilijihua"}],inModelRank:!1,inGalleryRank:!1}},mounted:function(){this.getTop10List()},methods:{openClaimDialog:function(){this.$refs.claimDialog.showDialog()},getTop10List:function(){var t=this;Object(_.e)({order_by:"hot",page:1,page_size:10}).then((function(e){var n=e||{},o=n.status,r=(void 0===o?{}:o).code,code=void 0===r?"":r,l=n.data,c=(void 0===l?{}:l).list,d=void 0===c?[]:c;1e4===code&&(t.inGalleryRank=!!d.find((function(e){var n;return(null==e||null===(n=e.data)||void 0===n||null===(n=n.author)||void 0===n?void 0:n.id)===t.userInfo.id})))}))},changeTab:function(t){console.log("changeTab",t.name),this.active=t,this.search.name=t.name,this.$emit("change",U(U({},this.search),{},{changed:!1}))},changeSort:function(t){console.log("changeSort",t.value);var e=t.value,n=this.search.order!==e;this.search.order=e,this.$emit("change",U(U({},this.search),{},{changed:n}))}}},z=(n(2703),Object(v.a)(H,(function(){var t,e,n=this,o=n._self._c;return o("div",{staticClass:"tab-btns flex"},[o("div",{staticClass:"tab-content flex"},n._l(n.btns,(function(t,e){return o("div",{directives:[{name:"show",rawName:"v-show",value:3!==e||n.inShowResultTime,expression:"index !== 3 || inShowResultTime"}],key:"tab_".concat(e),staticClass:"tab-btn",class:{active:n.active.name===t.name},on:{click:function(e){return n.changeTab(t)}}},[n._v("\n      "+n._s(null!=t&&t.label_name?n.$t(t.label,{name:n.$t(null==t?void 0:t.label_name)}):n.$t(t.label))+"\n    ")])})),0),n._v(" "),o("div",{staticClass:"right"},[null!==(t=n.active)&&void 0!==t&&t.showSort?o("div",{staticClass:"order-content flex items-center"},n._l(n.orders,(function(t,e){return o("div",{key:"order_".concat(e),staticClass:"order-btn",class:{active:n.order===t.value},on:{click:function(e){return n.changeSort(t)}}},[o("i",{staticClass:"iconfont",class:"icon-".concat(t.icon)}),n._v(" "+n._s(n.$t(t.name))+"\n      ")])})),0):n._e(),n._v(" "),n.isShowClaimBtn?o("div",{staticClass:"claim-btn",on:{click:n.openClaimDialog}},[n._v(n._s(n.$t("vip_invite_dialog_btn"))+" "),o("i",{staticClass:"el-icon-d-arrow-right"})]):n._e()]),n._v(" "),o("claim-dialog",{ref:"claimDialog",attrs:{type:"actvtyImgGallery"===(null===(e=n.active)||void 0===e?void 0:e.name)?1:2}})],1)}),[],!1,null,"ceb315c8",null).exports),V=(n(21),n(40));function W(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function G(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?W(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Y={name:"joinDialog",props:{},computed:G(G({},Object(r.e)("user",["userInfo"])),{},{clickItem:function(){var t=this;return function(e){var n,o;return"model"===t.type?(null===(n=t.clickedmodel)||void 0===n?void 0:n.id)===(null==e?void 0:e.id):(null===(o=t.clickedGallery)||void 0===o?void 0:o.id)===(null==e?void 0:e.id)}}}),data:function(){return{dialogVisible:!1,loading:!1,type:"gallery",noMoreGalllery:!1,noMoreModel:!1,clickedmodel:{},clickedGallery:{},joinedmodel:{},joinedGallery:{},modelList:[],galleryList:[],comfyuiList:[],modelParam:{page:1,page_size:20,keyword:"",order_by:"new",publish_status:1,model_types:["LORA"],base_models:[],sub_channel:"activity"},galleryParam:{page:1,page_size:35,after:0,type:"bookmarks",order_by:"new",category:2,sub_type:"activity"}}},mounted:function(){},methods:{showDialog:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"gallery";this.getJoined(),this.type=t,console.log("showDialog",t),"model"===t?this.getModelList():this.getGalleryList(),this.dialogVisible=!0},closeDialog:function(){this.galleryParam.page=1,this.modelParam.page=1,this.galleryParam.time_to=0,this.galleryParam.after=0,this.dialogVisible=!1,this.clickedmodel={},this.clickedGallery={},Reflect.deleteProperty(this.modelParam,"time_to")},getJoined:function(){var t=this;Object(_.f)().then((function(e){var n,o,r;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&(t.joinedmodel=(null==e||null===(o=e.data)||void 0===o?void 0:o.model)||{},t.joinedGallery=(null==e||null===(r=e.data)||void 0===r?void 0:r.artwork)||{})}))},submitApply:function(){var t,e,n=this,data={type:"model"===this.type?2:4,item_id:"model"===this.type?null===(t=this.clickedmodel)||void 0===t?void 0:t.id:null===(e=this.clickedGallery)||void 0===e?void 0:e.id};console.log("参与参数",data),data.item_id?Object(_.b)(data).then((function(t){var e;1e4===(null==t||null===(e=t.status)||void 0===e?void 0:e.code)&&(n.$message({message:n.$t("Participated"),type:"success"}),n.getJoined())})):this.$message.info(this.$t("Pls_select"))},changeType:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"gallery";this.type=t,"model"===this.type?!this.modelList.length&&this.getModelList():!this.galleryList.length&&this.getGalleryList()},getModelList:function(){var t,e=this;this.loading||this.noMoreModel||(this.loading=!0,this.modelParam.account_no=null===(t=this.userInfo)||void 0===t?void 0:t.id,Object(N.k)(this.modelParam).then((function(t){var n,o,r;if(1e4===(null==t||null===(n=t.status)||void 0===n?void 0:n.code)){var l;if(e.modelList=e.modelList.concat((null==t||null===(o=t.data)||void 0===o?void 0:o.items)||[]),console.log("获取模型",e.modelList),1===e.modelParam.page)e.modelParam.time_to=null==t||null===(l=t.data)||void 0===l?void 0:l.time_ms;e.modelParam.page++,null!=t&&null!==(r=t.data)&&void 0!==r&&r.has_more||(e.noMoreModel=!0)}})).finally((function(){e.loading=!1})))},getGalleryList:function(){var t=this;this.loading||this.noMoreGalllery||(this.loading=!0,Object(V.artworkList)(this.galleryParam).then((function(e){var n,o,r;if(1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)){var l;if(t.galleryList=t.galleryList.concat((null==e||null===(o=e.data)||void 0===o?void 0:o.items)||[]),1===t.galleryParam.page&&e.data.time_ms&&(t.galleryParam.time_to=e.data.time_ms),e.data.items.length>0)t.galleryParam.after=null===(l=e.data.items[e.data.items.length-1])||void 0===l||null===(l=l.folder_no)||void 0===l?void 0:l.collect_at;t.galleryParam.page++,null!=e&&null!==(r=e.data)&&void 0!==r&&r.has_more||(t.noMoreGalllery=!0)}})).finally((function(){t.loading=!1})))},handleScroll:function(){var content=this.$refs.scrollContent,t=this.$refs.scrollItems;content.scrollTop+content.clientHeight>=t.clientHeight&&("model"===this.type?this.getModelList():this.getGalleryList())},handleClickItem:function(t){"model"===this.type?this.clickedmodel=t:this.clickedGallery=t},handleSubmit:function(){var t,e,n=this;("model"===this.type?null===(t=this.joinedmodel)||void 0===t?void 0:t.id:null===(e=this.joinedGallery)||void 0===e?void 0:e.id)?"model"===this.type?this.submitApply():this.$confirm(this.$t("actvtyReplaceTip"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"ai-face-swap-confirm"}).then((function(){n.submitApply()})):this.submitApply()},goCreate:function(){this.dialogVisible=!1,"model"===this.type?window.open(this.localePath("/loraTrainingEdit?defaultType=FLUX"),"_blank"):this.$EventBus.$emit("openGenerate",{action:1,data:{source:{id:"5c4f26337a770760d2d6d2288d7e4698",name:"FLUX",nsfw:0,cover:"https://image2.cdn.seaart.me/static/cc6b8368cf3e511874abdeb8c3c4e4ad/1722959506726/aaab49023af1f1abbc75687dac463baa.jpeg",cover_width:832,cover_height:1216,desc:"",base_model:"Flux.1 D",model_ver_no:"86f5b35dcf257ab74b9fa00a8bbf0da3",model_ver_nos:[{id:"86f5b35dcf257ab74b9fa00a8bbf0da3",version_name:"Dev",same:{primary:1,train_model_no:""}},{id:"ea3e7ba4a5525c1b57abb644a61a92c2",version_name:"Schnell",same:{primary:1,train_model_no:""}}],version_name:"Dev",type:"Checkpoint",ver:"Dev",samples:[{id:"419a117bbf4642b8e7cc9f5f4a9a22a5",url:"https://image2.cdn.seaart.me/static/cc6b8368cf3e511874abdeb8c3c4e4ad/1722959506726/aaab49023af1f1abbc75687dac463baa.jpeg",nsfw:2,width:832,height:1216,meta:{extra_prompt:"",prompt:'a digital illustration of a movie poster titled "Finding Emo", finding nemo parody poster, featuring a depressed cartoon clownfish with black emo hair, eyeliner, and piercings, bored expression, swimming in a dark underwater scene, in the background, movie title in a dripping, grungy font, moody blue and purple color palette',width:832,height:1216,steps:25,sampler_name:"Euler",seed:419750308183444,lora_models:null,hi_res_arg:null,smart_edit:null,guidance_scale:0,left_margin:0,up_margin:0,image:"",images:null,vae:"None",refiner_mode:0,lcm_mode:0,embeddings:null,generate:null},generation_process:"",collect:null,task_operation:{is_make_variations:!0,is_img_2_img:!1,is_upscale:!1,is_extra_upscale:!0,is_remove_background:!0,is_animation:!1},green:1}],create_at:1724250509247,update_at:1724472739064,meta:null,stat:{num_of_like:0,num_of_collection:52,num_of_task:19516,num_of_view:309,rating:0,num_of_download:17,num_of_comment:1},tags:[{id:"base model",title:"Base Model",cover:"",is_collect:!1,show_in:0},{id:"flux.1",title:"flux.1",cover:"",is_collect:!1,show_in:0},{id:"flux",title:"FLUX",cover:"",is_collect:!1,show_in:0},{id:"flux",title:"FLUX",cover:"",is_collect:!1,show_in:0}],categories:null,trained_words:null,author:{id:"4381edef94419e64163cacd019f70ac8",head:"",is_follow:!1,name:"CheemsAI",status:1,follower_cnt:4,is_active:!1,join_stimulate:0},collect:null,refer:"https://civitai.com/models/618692",channel:5,file_id:"12698f6ab4a2d63e65dc1b15e749d6f7",publish_status:1,status:1,audit_status:null,origin_model:null,download:1,commercial:2,mix:2,allow_use_in_haiyi:1,allow_sell:1,allow_resell:2,is_agency_fee:!1,agency_fee:0,payment_way:0,allow_creation:0,interaction:{rating:0,rating_time:0},train_param:{epoch:0,step:0,clip_skip:0}}}})}}},J=Y;n(2704);function K(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function X(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?K(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Q={name:"activityIndex",components:{ActivityHome:m,ActivityModels:k,ActivityGallery:E,TabBtns:z,joinDialog:Object(v.a)(J,(function(){var t,e,n,o,r,l,c,d,h=this,v=h._self._c;return h.dialogVisible?v("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:h.loading,expression:"loading"}],staticClass:"active-join-dialog custom-dialog",attrs:{visible:h.dialogVisible,title:h.$t("actvtyJoin"),width:"1124px","close-on-click-modal":!1,"before-close":h.closeDialog,"destroy-on-close":!0},on:{"update:visible":function(t){h.dialogVisible=t}}},[v("div",{staticClass:"select flex"},[v("el-button",{staticClass:"tab-btn",class:{"tab-active":"model"!==h.type},attrs:{type:"text"},on:{click:function(t){return h.changeType("gallery")}}},[h._v("\n      "+h._s(h.$t("actvtyUseKey",{name:h.$t("Image")}))+"\n    ")]),h._v(" "),v("el-button",{staticClass:"tab-btn",class:{"tab-active":"model"===h.type},attrs:{type:"text"},on:{click:function(t){return h.changeType("model")}}},[h._v("\n      "+h._s(h.$t("actvtyUseKey",{name:h.$t("LoRA")}))+"\n    ")])],1),h._v(" "),v("div",{staticClass:"info flex items-center"},[v("span",{staticClass:"title"},[h._v("\n      "+h._s("model"===h.type?h.$t("selecKey",{name:h.$t("LoRA")}):h.$t("selecKey",{name:h.$t("Image")}))+"\n    ")]),h._v(" "),v("span",{staticClass:"txt flex items-center"},[v("i",{staticClass:"iconfont icon-warningTip icon"}),h._v("\n      "+h._s("model"===h.type?h.$t("actvtySelectTip3",{name:h.$t("LoRA")}):h.$t("actvtySelectTip"))+"\n    ")])]),h._v(" "),v("div",{ref:"scrollContent",staticClass:"select-content",on:{scroll:h.handleScroll}},[v("div",{ref:"scrollItems",staticClass:"select-items flex flex-wrap"},[v("div",{staticClass:"create-item item flex flex-col justify-center items-center",on:{click:h.goCreate}},[[v("i",{staticClass:"iconfont icon-add-icon icon"}),h._v(" "),v("span",{staticClass:"txt"},[h._v(h._s("model"===h.type?h.$t("Create"):h.$t("Generate")))])]],2),h._v(" "),[v("div",{directives:[{name:"show",rawName:"v-show",value:(null===(t=h.joinedmodel)||void 0===t?void 0:t.id)&&"model"===h.type,expression:"joinedmodel?.id && type === 'model'"}],staticClass:"model-item item flex flex-col items-center"},[null!==(e=h.joinedmodel)&&void 0!==e&&e.uri?v("img",{directives:[{name:"webp",rawName:"v-webp"}],staticClass:"item-cover",attrs:{src:null===(n=h.joinedmodel)||void 0===n?void 0:n.uri,alt:"model_cover"}}):h._e(),h._v(" "),v("div",{staticClass:"added-btn"},[h._v("\n            "+h._s(h.$t("Competing"))+"\n          ")]),h._v(" "),v("div",{staticClass:"text text-no-wrap"},[h._v(h._s(h.joinedmodel.model_name))])]),h._v(" "),h._l(h.modelList,(function(t,e){var n,o,r;return v("div",{directives:[{name:"show",rawName:"v-show",value:"model"===h.type&&h.modelList.length,expression:"type === 'model' && modelList.length"}],key:"model-item_".concat(e),staticClass:"model-item item flex flex-col items-center",class:{"joined-hidden":(null===(n=h.joinedmodel)||void 0===n?void 0:n.id)===(null==t?void 0:t.id),clicked:h.clickItem(t)},on:{click:function(e){return h.handleClickItem(t)}}},[null!=t&&t.cover?v("img",{directives:[{name:"webp",rawName:"v-webp"}],staticClass:"item-cover",attrs:{src:null==t?void 0:t.cover,alt:"model_cover"}}):h._e(),h._v(" "),null!=t&&null!==(o=t.art_model)&&void 0!==o&&o.name?v("div",{staticClass:"text text-no-wrap"},[h._v(h._s(null==t||null===(r=t.art_model)||void 0===r?void 0:r.name))]):h._e()])}))],h._v(" "),[v("div",{directives:[{name:"show",rawName:"v-show",value:(null===(o=h.joinedGallery)||void 0===o?void 0:o.id)&&"gallery"===h.type,expression:"joinedGallery?.id && type === 'gallery'"}],staticClass:"gallery-item item flex flex-col items-center"},[null!==(r=h.joinedGallery)&&void 0!==r&&r.uri?v("img",{directives:[{name:"webp",rawName:"v-webp"}],staticClass:"item-cover",attrs:{src:null===(l=h.joinedGallery)||void 0===l?void 0:l.uri,alt:"gallery_cover"}}):h._e(),h._v(" "),v("div",{staticClass:"added-btn"},[h._v("\n            "+h._s(h.$t("Competing"))+"\n          ")])]),h._v(" "),h._l(h.galleryList,(function(t,e){var n,o,r;return v("div",{directives:[{name:"show",rawName:"v-show",value:"gallery"===h.type&&h.galleryList.length,expression:"type === 'gallery' && galleryList.length"}],key:"gallery-item_".concat(e),staticClass:"gallery-item item flex flex-col items-center",class:{"joined-hidden":(null===(n=h.joinedGallery)||void 0===n?void 0:n.id)===(null==t?void 0:t.id),clicked:h.clickItem(t)},on:{click:function(e){return h.handleClickItem(t)}}},[null!=t&&null!==(o=t.banner)&&void 0!==o&&o.url?v("img",{directives:[{name:"webp",rawName:"v-webp"}],staticClass:"item-cover",attrs:{src:null==t||null===(r=t.banner)||void 0===r?void 0:r.url,alt:"gallery_cover"}}):h._e(),h._v(" "),null!=t&&t.name?v("div",{staticClass:"text flex items-center text-no-wrap"},[h._v(h._s(t.name))]):h._e()])}))]],2)]),h._v(" "),v("div",{staticClass:"submit-content"},["model"===h.type?v("div",{staticClass:"submit-btn",on:{click:h.handleSubmit}},[h._v("\n      "+h._s(null!==(c=h.joinedmodel)&&void 0!==c&&c.id?h.$t("actvtyReplaceBtn2",{name:h.$t("LoRA")}):h.$t("actvtySubmitBtn"))+"\n    ")]):v("div",{staticClass:"submit-btn",on:{click:h.handleSubmit}},[h._v("\n      "+h._s(null!==(d=h.joinedGallery)&&void 0!==d&&d.id?h.$t("actvtyReplaceBtn"):h.$t("actvtySubmitBtn"))+"\n    ")])])]):h._e()}),[],!1,null,"98e36d3a",null).exports},props:{},computed:X(X(X({},Object(r.c)("user",["cdnHostFun","isLoggedIn"])),Object(r.e)("user",["cdnHost"])),{},{langKey:function(){return console.log("this.$i18n.locale",this.$i18n.locale),this.$i18n.locale.startsWith("zh")?"zh":this.$i18n.locale.startsWith("ja")?"jp":"en"},topImg:function(){return"https://".concat(this.cdnHost,"/static/fluxsecond/").concat(this.langKey,"/web1.png")},activityOver:function(){return new Date>17294688e5},getBtnBG:function(){return"https://".concat(this.cdnHost,"/static/fluxsecond/").concat(this.langKey,"/web4.png")}}),provide:function(){return{activityOver:this.activityOver}},data:function(){return{active:"actvtyInfo",threshold:0,order:"new",tabs:[{name:"actvtyInfo",label:"actvtyInfo"},{name:"actvtyImgGallery",label:"contest_artwork",showSort:!0},{name:"actvtyModel",label:"contest_key",label_name:"LoRA"},{name:"actvtyResult",label:"actvtyResult"}]}},mounted:function(){var t=this;window.addEventListener("scroll",this.onScroll),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("scroll",t.onScroll)}))},methods:{changeTabs:function(data){var t=this,e=data.name,n=data.order,o=data.changed;this.active=e||this.active,this.order=n||this.order,console.log("changeTabs",this.active,this.order,"changed:",o),this.$nextTick((function(){"actvtyModel"===t.active&&o?t.$refs.model.refresh():"actvtyImgGallery"===t.active&&o&&t.$refs.gallery.refresh()}))},onScroll:function(){var t,e,n=this.$refs["sticky-ele"],rect=null===(t=this.$refs.outer)||void 0===t?void 0:t.getBoundingClientRect();if(n&&rect){var o=null==n||null===(e=n.getBoundingClientRect())||void 0===e?void 0:e.top;if(n){var r="sticky";o-72<=0&&rect.top<=-416?n.classList.add(r):n.classList.remove(r)}}},handleJoinBtnClick:function(){if(!this.activityOver)if(this.isLoggedIn){var t="actvtyModel"===this.active?"model":"gallery";this.$refs["join-dialog"].showDialog(t)}else this.$EventBus.$emit("openLoginDialog")}}},Z=(n(2705),Object(v.a)(Q,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"activity-index"},[e("el-backtop",{attrs:{bottom:30,right:30}},[e("i",{staticClass:"el-icon-top"})]),t._v(" "),e("div",{ref:"outer",staticClass:"top"},[e("div",{staticClass:"top-img"},[t.topImg?e("img",{attrs:{src:t.topImg,alt:"topImg"},on:{mousedown:function(t){t.preventDefault()},contextmenu:function(t){t.preventDefault()}}}):t._e()]),t._v(" "),e("div",{ref:"sticky-ele",staticClass:"join-btn-content flex"},[e("div",{staticClass:"join-btn flex justify-center items-center",class:{disabled:t.activityOver},style:{backgroundImage:"url("+t.getBtnBG+")"},on:{click:t.handleJoinBtnClick}})])]),t._v(" "),e("div",{ref:"sticky-ele",staticClass:"tab-content w-full"},[e("tab-btns",{attrs:{btns:t.tabs,order:t.order},on:{change:function(e){return t.changeTabs(e)}}})],1),t._v(" "),e("ActivityHome",{directives:[{name:"show",rawName:"v-show",value:"actvtyInfo"===t.active,expression:"active === 'actvtyInfo'"}],attrs:{galleryIndex:0}}),t._v(" "),e("ActivityHome",{directives:[{name:"show",rawName:"v-show",value:"actvtyResult"===t.active,expression:"active === 'actvtyResult'"}],attrs:{galleryIndex:2}}),t._v(" "),"actvtyModel"===t.active?e("ActivityModels",{ref:"model",attrs:{type:"model",order:t.order}}):t._e(),t._v(" "),"actvtyImgGallery"===t.active?e("ActivityGallery",{ref:"gallery",attrs:{type:"gallery",order:t.order}}):t._e(),t._v(" "),e("joinDialog",{ref:"join-dialog"})],1)}),[],!1,null,"13aa9242",null));e.default=Z.exports},3256:function(t,e,n){"use strict";n.r(e);n(14),n(10),n(4),n(18);var o=n(2),r=(n(9),n(7),n(32),n(36),n(11),n(12),n(8),n(6),n(40)),l=n(5),c=(n(16),n(47),n(19),n(43),n(29),n(41)),d=n(149),h=n(1);function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={name:"EventRegistrationModelDialog",data:function(){return{dialogVisible:!1,loading:!1,imgLoading:!1,btnLoading:!1,listParams:{publish_status:1,model_type:"ALL",page:1,page_size:60,type:"user_upload",in_match_page:!0},hasMore:!1,modelListData:[],selectedModels:[],agreeRules:!1,activeTab:"my_model",contestModelListData:[]}},computed:m(m({},Object(h.e)("user",["userInfo","cdnHost"])),{},{getModelUrl:function(){return function(t){var e=t.banner,o=e.nsfw,r=e.url;return 1===o?n(171):Object(l.x)(r,"low")}},getParticipatingModelUrl:function(){return function(t){var e=t.uri;return Object(l.x)(e,"low")}},selected:function(){var t=this;return function(e){return t.selectedModels.some((function(t){return t.id===e}))}}}),methods:{showDialog:function(){this.dialogVisible=!0,this.getList(),this.getContestList()},closedDialog:function(){this.dialogVisible=!1,this.loading=!1,this.imgLoading=!1,this.btnLoading=!1,this.listParams={publish_status:1,model_type:"ALL",page:1,page_size:60,type:"user_upload",in_match_page:!0},this.hasMore=!1,this.modelListData=[],this.selectedModels=[],this.agreeRules=!1,this.activeTab="my_model",this.contestModelListData=[]},getList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loading=!0,Object(c.r)(this.listParams).then((function(n){var o,r=n.data,l=r.items,c=r.has_more,d=r.time_ms;t.listParams.time_to=d,t.hasMore=c,t.loading=!1,l=l.filter((function(t){return 1===t.status&&2===t.primary&&t.banner.url})),t.modelListData=e?t.modelListData.concat(l||[]):l,(null===(o=t.modelListData)||void 0===o||!o.length)&&(t.imgLoading=!0),t.hasMore&&setTimeout((function(){t.addScrollEvent()}),1500)})).catch((function(e){t.loading=!1,console.log("err",e)}))},getContestList:function(){var t=this;Object(d.d)({account_id:this.userInfo.id,type:2}).then((function(e){var n=e.data.items;t.contestModelListData=n}))},showActivityRules:function(){this.$EventBus.$emit("openActivityRulesDialog")},handleModelItemClick:function(t){var e=this.selectedModels.findIndex((function(e){return e.id===t.id}));if(e>-1)this.selectedModels.splice(e,1);else{if(this.selectedModels.length>=5)return void this.$message.warning(this.$t("Limit5Models"));this.selectedModels.push(t)}},addScrollEvent:function(){var t=document.querySelector(".model-list");t&&(t.removeEventListener("scroll",this.scrollFun),t.addEventListener("scroll",this.scrollFun))},scrollFun:function(){var t=document.querySelector(".model-list");t.scrollHeight-t.scrollTop<=t.clientHeight+250&&!this.loading&&this.hasMore&&(this.listParams.page++,this.getList(!0))},handleConfirm:function(){var t,e,n=this;if(!this.agreeRules||null===(t=this.selectedModels)||void 0===t||!t.length)return null!==(e=this.selectedModels)&&void 0!==e&&e.length?this.agreeRules?void 0:void this.$message.warning(this.$t("PleaseAgreeRules")):void this.$message.warning(this.$t("NullSelectedTips"));this.btnLoading=!0;var o=this.selectedModels.map((function(t){return t.id}));Object(d.a)({type:2,ids:o}).then((function(){n.$message.success(n.$t("RegistrationSuccess")),n.closedDialog()})).catch((function(t){console.log("err",t),n.btnLoading=!1}))}}},_=f,y=(n(2376),n(0)),w=Object(y.a)(_,(function(){var t,e,n,o,r=this,l=r._self._c;return l("el-dialog",{staticClass:"event-registration",attrs:{visible:r.dialogVisible,width:"1076px",top:"50px","modal-append-to-body":!1,"close-on-click-modal":!1,"destroy-on-close":!0,"custom-class":"SaDialog"},on:{"update:visible":function(t){r.dialogVisible=t},closed:r.closedDialog}},[l("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[l("span",[r._v("\n\t\t\t"+r._s(r.$t("EventRegistration"))+"\n\t\t")]),r._v(" "),l("el-tooltip",{attrs:{content:r.$t("EventRegistrationTip"),placement:"top"}},[l("i",{staticClass:"el-icon-info"})])],1),r._v(" "),l("div",{directives:[{name:"loading",rawName:"v-loading",value:r.loading||r.imgLoading,expression:"loading || imgLoading"}],staticClass:"event-registration-container"},[l("div",{staticClass:"top-div"},[l("div",{staticClass:"header"},[l("div",{staticClass:"tabs-container"},[l("div",{staticClass:"tab-item",class:{active:"my_model"===r.activeTab},on:{click:function(t){r.activeTab="my_model"}}},[r._v("\n\t\t\t\t\t\t"+r._s(r.$t("MyModel"))+"\n\t\t\t\t\t")]),r._v(" "),l("div",{staticClass:"tab-item",class:{active:"participating_model"===r.activeTab},on:{click:function(t){r.activeTab="participating_model"}}},[r._v("\n\t\t\t\t\t\t"+r._s(r.$t("participating_model"))+"\n\t\t\t\t\t")])]),r._v(" "),"my_model"===r.activeTab?l("el-button",{staticClass:"btn",attrs:{loading:r.btnLoading},on:{click:r.handleConfirm}},[r._v("\n\t\t\t\t\t"+r._s(r.$t("Confirm"))+"\n\t\t\t\t")]):r._e()],1),r._v(" "),"my_model"===r.activeTab?l("div",{staticClass:"checkbox-div"},[l("div",{staticClass:"select-num"},[l("span",[r._v(r._s(null===(t=r.selectedModels)||void 0===t?void 0:t.length)+" / 5")])]),r._v(" "),l("div",{staticClass:"agree-rules"},[l("el-checkbox",{model:{value:r.agreeRules,callback:function(t){r.agreeRules=t},expression:"agreeRules"}}),r._v(" "),l("span",[r._v("\n\t\t\t\t\t\t"+r._s(r.$t("JoinTipsFront"))+"\n\t\t\t\t\t")]),r._v(" "),l("span",{staticClass:"activity-rules",on:{click:r.showActivityRules}},[r._v("\n\t\t\t\t\t\t"+r._s(r.$t("ActivityRules"))+"\n\t\t\t\t\t")])],1)]):r._e()]),r._v(" "),l("div",{directives:[{name:"show",rawName:"v-show",value:"my_model"===r.activeTab,expression:"activeTab === 'my_model'"}],staticClass:"model-list"},[null!==(e=r.modelListData)&&void 0!==e&&e.length?r._l(r.modelListData,(function(t){return l("div",{key:t.id,staticClass:"model-item",class:{selected:r.selected(t.id)},on:{click:function(e){return r.handleModelItemClick(t)}}},[l("div",{staticClass:"model-item-container"},[l("img",{staticClass:"model-img",attrs:{alt:"model image",src:r.getModelUrl(t)}}),r._v(" "),l("div",{staticClass:"bottom-name"},[l("div",{staticClass:"name",attrs:{title:t.name}},[r._v("\n\t\t\t\t\t\t\t\t"+r._s(t.name)+"\n\t\t\t\t\t\t\t")])])])])})):r._e(),r._v(" "),r.loading||null!==(n=r.modelListData)&&void 0!==n&&n.length?r._e():l("div",{staticClass:"no-picture"},[l("img",{attrs:{src:"https://".concat(r.cdnHost,"/static/upload/20230617/804ae1a7-d655-4a59-a93b-775bfe4ebb5d.png"),alt:"no-picture"},on:{load:function(t){r.imgLoading=!1}}}),r._v(" "),l("div",{staticClass:"tip"},[r._v("\n\t\t\t\t\t"+r._s(r.$t("NoModelPictureTip"))+"\n\t\t\t\t")])])],2),r._v(" "),l("div",{directives:[{name:"show",rawName:"v-show",value:"participating_model"===r.activeTab,expression:"activeTab === 'participating_model'"}],staticClass:"participating-model-list"},[l("div",{directives:[{name:"show",rawName:"v-show",value:"participating_model"===r.activeTab,expression:"activeTab === 'participating_model'"}],staticClass:"participating-tip"},[l("i",{staticClass:"iconfont icon-mall-desc tip"}),r._v("\n\t\t\t\t"+r._s(r.$t("ParticipatingModelTip"))+"\n\t\t\t")]),r._v(" "),null!==(o=r.contestModelListData)&&void 0!==o&&o.length?r._l(r.contestModelListData,(function(t){return l("div",{key:t.id,staticClass:"model-item"},[l("div",{staticClass:"model-item-container"},[l("div",{staticClass:"tip",class:2!==t.audit_status?"competing":"not-pass"},[r._v("\n\t\t\t\t\t\t\t"+r._s(r.$t(2!==t.audit_status?"Competing":"notApproved"))+"\n\t\t\t\t\t\t")]),r._v(" "),l("img",{staticClass:"model-img",attrs:{alt:"model image",src:r.getParticipatingModelUrl(t)}}),r._v(" "),l("div",{staticClass:"bottom-name"},[l("div",{staticClass:"name",attrs:{title:t.model_name}},[r._v("\n\t\t\t\t\t\t\t\t"+r._s(t.model_name)+"\n\t\t\t\t\t\t\t")])])])])})):l("div",{staticClass:"no-picture"},[l("img",{attrs:{src:"https://".concat(r.cdnHost,"/static/upload/20230617/804ae1a7-d655-4a59-a93b-775bfe4ebb5d.png"),alt:"no-picture"},on:{load:function(t){r.imgLoading=!1}}}),r._v(" "),l("div",{staticClass:"tip"},[r._v("\n\t\t\t\t\t"+r._s(r.$t("NoContestModelPictureTip"))+"\n\t\t\t\t")])])],2)])])}),[],!1,null,null,null).exports;function C(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?C(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var O={name:"EventRegistrationArtworkDialog",data:function(){return{dialogVisible:!1,loading:!1,imgLoading:!1,btnLoading:!1,listParams:{page:1,page_size:60,type:"bookmarks",order_by:"hot",keyword:"",start_at:0,end_at:0,after:0,artwork_types:[1,3],category:2,in_match_page:!0},hasMore:!1,workListData:[],selectedWorks:[],agreeRules:!1,activeTab:"my_artwork",contestWorklListData:[]}},computed:k(k({},Object(h.e)("user",["userInfo","cdnHost"])),{},{getArtworkUrl:function(){return function(t){var e=t.banner,o=e.nsfw,r=e.url;return 1===o?n(171):Object(l.x)(r,"low")}},getParticipatingArtworkUrl:function(){return function(t){var e=t.uri;return Object(l.x)(e,"low")}},selected:function(){var t=this;return function(e){return t.selectedWorks.some((function(t){return t.id===e}))}}}),methods:{showDialog:function(){this.dialogVisible=!0,this.getList(),this.getContestList()},closedDialog:function(){this.dialogVisible=!1,this.loading=!1,this.imgLoading=!1,this.btnLoading=!1,this.listParams={page:1,page_size:60,type:"bookmarks",order_by:"hot",keyword:"",start_at:0,end_at:0,after:0,artwork_types:[1,3],category:2,in_match_page:!0},this.hasMore=!1,this.workListData=[],this.selectedWorks=[],this.agreeRules=!1,this.activeTab="my_artwork",this.contestWorklListData=[]},getList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loading=!0,Object(r.artworkList)(this.listParams).then((function(n){var o,r=n.data,l=r.items,c=r.has_more,d=r.time_ms;t.listParams.time_to=d,t.hasMore=c,t.loading=!1,l=l.filter((function(t){return 1===t.status&&2===t.primary&&t.banner.url})),t.workListData=e?t.workListData.concat(l||[]):l,(null===(o=t.workListData)||void 0===o||!o.length)&&(t.imgLoading=!0),t.hasMore&&setTimeout((function(){t.addScrollEvent()}),1500)})).catch((function(e){t.loading=!1,console.log("err",e)}))},getContestList:function(){var t=this;Object(d.d)({account_id:this.userInfo.id,type:1}).then((function(e){var n=e.data.items;t.contestWorklListData=n}))},showActivityRules:function(){this.$EventBus.$emit("openActivityRulesDialog")},handleModelItemClick:function(t){var e=this.selectedWorks.findIndex((function(e){return e.id===t.id}));if(e>-1)this.selectedWorks.splice(e,1);else{if(this.selectedWorks.length>=5)return void this.$message.warning(this.$t("Limit5Models"));this.selectedWorks.push(t)}},addScrollEvent:function(){var t=document.querySelector(".model-list");t&&(t.removeEventListener("scroll",this.scrollFun),t.addEventListener("scroll",this.scrollFun))},scrollFun:function(){var t=document.querySelector(".model-list");t.scrollHeight-t.scrollTop<=t.clientHeight+250&&!this.loading&&this.hasMore&&(this.listParams.page++,this.getList(!0))},handleConfirm:function(){var t,e,n=this;if(!this.agreeRules||null===(t=this.selectedWorks)||void 0===t||!t.length)return null!==(e=this.selectedWorks)&&void 0!==e&&e.length?this.agreeRules?void 0:void this.$message.warning(this.$t("PleaseAgreeRules")):void this.$message.warning(this.$t("NullSelectedTips"));this.btnLoading=!0;var o=this.selectedWorks.map((function(t){return t.id}));Object(d.a)({type:1,ids:o}).then((function(){n.$message.success(n.$t("RegistrationSuccess")),n.closedDialog()})).catch((function(t){console.log("err",t),n.btnLoading=!1}))}}},x=O;n(2377);function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var S={components:{EventRegistrationModelDialog:w,EventRegistrationArtworkDialog:Object(y.a)(x,(function(){var t,e,n,o,r=this,l=r._self._c;return l("el-dialog",{staticClass:"event-registration",attrs:{visible:r.dialogVisible,width:"1076px",top:"50px","modal-append-to-body":!1,"close-on-click-modal":!1,"destroy-on-close":!0,"custom-class":"SaDialog"},on:{"update:visible":function(t){r.dialogVisible=t},closed:r.closedDialog}},[l("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[l("span",[r._v("\n\t\t\t"+r._s(r.$t("EventRegistration"))+"\n\t\t")]),r._v(" "),l("el-tooltip",{attrs:{content:r.$t("EventRegistrationTip"),placement:"top"}},[l("i",{staticClass:"el-icon-info"})])],1),r._v(" "),l("div",{directives:[{name:"loading",rawName:"v-loading",value:r.loading||r.imgLoading,expression:"loading || imgLoading"}],staticClass:"event-registration-container"},[l("div",{staticClass:"top-div"},[l("div",{staticClass:"header"},[l("div",{staticClass:"tabs-container"},[l("div",{staticClass:"tab-item",class:{active:"my_artwork"===r.activeTab},on:{click:function(t){r.activeTab="my_artwork"}}},[r._v("\n\t\t\t\t\t\t"+r._s(r.$t("MyArtworks"))+"\n\t\t\t\t\t")]),r._v(" "),l("div",{staticClass:"tab-item",class:{active:"participating_artwork"===r.activeTab},on:{click:function(t){r.activeTab="participating_artwork"}}},[r._v("\n\t\t\t\t\t\t"+r._s(r.$t("contest_artwork"))+"\n\t\t\t\t\t")])]),r._v(" "),"my_artwork"===r.activeTab?l("el-button",{staticClass:"btn",attrs:{loading:r.btnLoading},on:{click:r.handleConfirm}},[r._v("\n\t\t\t\t\t"+r._s(r.$t("Confirm"))+"\n\t\t\t\t")]):r._e()],1),r._v(" "),"my_artwork"===r.activeTab?l("div",{staticClass:"checkbox-div"},[l("div",{staticClass:"select-num"},[l("span",[r._v(r._s(null===(t=r.selectedWorks)||void 0===t?void 0:t.length)+" / 5")])]),r._v(" "),l("div",{staticClass:"agree-rules"},[l("el-checkbox",{model:{value:r.agreeRules,callback:function(t){r.agreeRules=t},expression:"agreeRules"}}),r._v(" "),l("span",[r._v("\n\t\t\t\t\t\t"+r._s(r.$t("JoinTipsFront"))+"\n\t\t\t\t\t")]),r._v(" "),l("span",{staticClass:"activity-rules",on:{click:r.showActivityRules}},[r._v("\n\t\t\t\t\t\t"+r._s(r.$t("ActivityRules"))+"\n\t\t\t\t\t")])],1)]):r._e()]),r._v(" "),l("div",{directives:[{name:"show",rawName:"v-show",value:"my_artwork"===r.activeTab,expression:"activeTab === 'my_artwork'"}],staticClass:"model-list"},[null!==(e=r.workListData)&&void 0!==e&&e.length?r._l(r.workListData,(function(t){return l("div",{key:t.id,staticClass:"model-item",class:{selected:r.selected(t.id)},on:{click:function(e){return r.handleModelItemClick(t)}}},[l("div",{staticClass:"model-item-container"},[l("img",{staticClass:"model-img",attrs:{alt:"model image",src:r.getArtworkUrl(t)}})])])})):r._e(),r._v(" "),r.loading||null!==(n=r.workListData)&&void 0!==n&&n.length?r._e():l("div",{staticClass:"no-picture"},[l("img",{attrs:{src:"https://".concat(r.cdnHost,"/static/upload/20230617/804ae1a7-d655-4a59-a93b-775bfe4ebb5d.png"),alt:"no-picture"},on:{load:function(t){r.imgLoading=!1}}}),r._v(" "),l("div",{staticClass:"tip"},[r._v("\n\t\t\t\t\t"+r._s(r.$t("NoWorkTip"))+"\n\t\t\t\t")])])],2),r._v(" "),l("div",{directives:[{name:"show",rawName:"v-show",value:"participating_artwork"===r.activeTab,expression:"activeTab === 'participating_artwork'"}],staticClass:"participating-artwork-list"},[l("div",{staticClass:"participating-tip"},[l("i",{staticClass:"iconfont icon-mall-desc tip"}),r._v("\n\t\t\t\t"+r._s(r.$t("ParticipatingArtworkTip"))+"\n\t\t\t")]),r._v(" "),null!==(o=r.contestWorklListData)&&void 0!==o&&o.length?r._l(r.contestWorklListData,(function(t){return l("div",{key:t.id,staticClass:"model-item"},[l("div",{staticClass:"model-item-container"},[l("div",{staticClass:"tip",class:2!==t.audit_status?"competing":"not-pass"},[r._v("\n\t\t\t\t\t\t\t"+r._s(r.$t(2!==t.audit_status?"Competing":"notApproved"))+"\n\t\t\t\t\t\t")]),r._v(" "),l("img",{staticClass:"model-img",attrs:{alt:"model image",src:r.getParticipatingArtworkUrl(t)}})])])})):l("div",{staticClass:"no-picture"},[l("img",{attrs:{src:"https://".concat(r.cdnHost,"/static/upload/20230617/804ae1a7-d655-4a59-a93b-775bfe4ebb5d.png"),alt:"no-picture"},on:{load:function(t){r.imgLoading=!1}}}),r._v(" "),l("div",{staticClass:"tip"},[r._v("\n\t\t\t\t\t"+r._s(r.$t("NoContestModelPictureTip"))+"\n\t\t\t\t")])])],2)])])}),[],!1,null,null,null).exports,ClaimDialog:n(555).a},props:{type:{type:String,default:""},needTimeSelection:{type:Boolean,default:!0},needPop:{type:Boolean,default:!0},intList:{type:Array,default:function(){return[]}},isOver:{type:Boolean,default:!1}},data:function(){return{formatNumberForeign:l.i,list:[],formData:{rank_type:"",time_type:"day"},options:[{value:"day",label:this.$t("Daily")},{value:"week",label:this.$t("Weekly")}],loading:!1,modelCreatorIcon:n(632),inRank:!1}},watch:{intList:{handler:function(t){this.list=t}},list:{handler:function(t){var e=this;if(["mcl_m8","pcl_m8","inul_m8"].includes(this.type)){var n,o="mcl_m8"===this.type?20:10;n=(null==t?void 0:t.length)<=o?t:t.slice(0,o),this.inRank=!!n.find((function(t){return t.id===e.userInfo.id}))}},deep:!0}},created:function(){this.intList&&this.intList.length>0&&(this.list=this.intList)},computed:D(D({},Object(h.e)("payment",["paymentInfo"])),Object(h.e)("user",["userInfo"])),methods:{openClaimDialog:function(){this.$refs.claimDialog.showDialog()},setTitle:function(){var t="";switch(this.type){case"ah":t=this.$t("popularityValue");break;case"cre":t=this.$t("creativeList");break;case"mh":t=this.$t("hottestModels");break;case"mc":t=this.$t("ModelCollection");break;case"mcl_m8":t=this.$t("ModelCreatorsList");break;case"pcl_m8":t=this.$t("CreativeWorks");break;case"inul_m8":t=this.$t("PopularStar")}return t},setRankNumColor:function(t){var e="#787d82";switch(t){case 1:e="#FF6600";break;case 2:e="#FAA90E"}return e},goPage:function(t){var e,n,path="/user/"+(null==t||null===(e=t.item_info)||void 0===e?void 0:e.id);"mh"!=this.type&&"mc"!=this.type||(path="/models/detail/"+(null==t||null===(n=t.item_info)||void 0===n?void 0:n.id));window.open(path,"_blank")},getData:function(){var t=this;this.loading||(this.loading=!0,this.list=[],this.formData.rank_type=this.type,Object(r.rankDetail)(this.formData).then((function(e){1e4==e.status.code&&(t.list=e.data||[])})).finally((function(){t.loading=!1})))},handleJoin:function(){switch(this.type){case"mcl_m8":this.$refs.eventRegistrationModelDialog.showDialog();break;case"pcl_m8":this.$refs.eventRegistrationArtworkDialog.showDialog();break;case"inul_m8":window.open("/incentiveTask")}},toMall:function(){this.isCompanyAccount||(this.$logEvent("log_actions",{operation:"subscription_page_show",behavior_info:location.href}),this.$router.push(this.localePath("/mall")))},goPlan:function(){var path=this.userInfo.join_stimulate?"/creationCenter":"/motivatingTask";this.$router.push(this.localePath(path))}}},P=(n(2379),n(2380),Object(y.a)(S,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"rankDelsList",class:{"no-pop":!t.needPop}},[e("div",{staticClass:"title"},[e("span",[t._v(t._s(t.setTitle()))]),t._v(" "),t.needTimeSelection?e("el-select",{attrs:{"popper-class":"custom-select"},on:{change:t.getData},model:{value:t.formData.time_type,callback:function(e){t.$set(t.formData,"time_type",e)},expression:"formData.time_type"}},t._l(t.options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1):[t.isOver?e("div",[t.inRank?e("div",{staticClass:"aceept",on:{click:t.openClaimDialog}},[t._v("\n            "+t._s(t.$t("Claim"))+"\n            "),e("i",{staticClass:"el-icon-d-arrow-right"})]):e("div",{staticClass:"end"},[t._v("\n            "+t._s(t.$t("EndedOver"))+"\n          ")])]):e("div",{staticClass:"join",on:{click:t.handleJoin}},[t._v("\n          "+t._s(t.$t("JoinNow"))+"\n          "),e("i",{staticClass:"el-icon-d-arrow-right"})])]],2),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"list"},t._l(t.list,(function(o,r){var l,c,d,h,v,m,f,_,y,w,C,k;return e("div",{key:r,staticClass:"item",on:{click:function(e){return t.goPage(o)}}},[e("div",{staticClass:"left"},[e("div",{staticClass:"info"},[e("div",{staticClass:"rankNum"},[0==r?e("img",{attrs:{src:n(749),alt:""}}):e("span",{style:{color:t.setRankNumColor(r)}},[t._v(t._s(r>8?r+1:"0"+(r+1)))])]),t._v(" "),"mh"==t.type||"mc"==t.type?e("div",{staticClass:"imgs imgsModel",class:1===(null==o||null===(l=o.item_info)||void 0===l?void 0:l.nsfw)?"bg-nsfw":"",style:{width:0==r?"105px":null,height:0==r?"105px":null}},[null!=o&&null!==(c=o.item_info)&&void 0!==c&&null!==(c=c.banner)&&void 0!==c&&c.url&&2===(null==o||null===(d=o.item_info)||void 0===d||null===(d=d.banner)||void 0===d?void 0:d.nsfw)?e("img",{directives:[{name:"webp",rawName:"v-webp",value:t.$imgL,expression:"$imgL"}],attrs:{src:null==o||null===(h=o.item_info)||void 0===h||null===(h=h.banner)||void 0===h?void 0:h.url,alt:""}}):t._e()]):e("div",{staticClass:"imgs",style:{width:0==r?"70px":null,height:0==r?"70px":null}},[null!=o&&null!==(v=o.item_info)&&void 0!==v&&v.head?e("img",{directives:[{name:"webp",rawName:"v-webp",value:t.$imgL,expression:"$imgL"}],attrs:{src:null==o||null===(m=o.item_info)||void 0===m?void 0:m.head,alt:""}}):e("div",{staticClass:"defImg"},[t._v(t._s(null==o||null===(f=o.item_info)||void 0===f?void 0:f.name[0]))])]),t._v(" "),e("div",{staticClass:"txt"},[e("div",{staticClass:"name"},[e("div",{staticClass:"name-text"},[t._v(t._s(null==o||null===(_=o.item_info)||void 0===_?void 0:_.name))]),t._v(" "),null!=o&&null!==(y=o.item_info)&&void 0!==y&&y.is_active?e("div",{staticClass:"vip-icon",on:{click:t.toMall}},[e("img",{attrs:{src:n(162),alt:"vip-icon"}})]):t._e(),t._v(" "),null!=o&&null!==(w=o.item_info)&&void 0!==w&&w.join_stimulate?e("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:t.$t("CreationCenterName"),placement:"top-start"}},[e("img",{staticClass:"creator-badge",attrs:{src:n(473),alt:"badge-icon"},on:{click:t.goPlan}})]):t._e(),t._v(" "),!["mh","mc"].includes(t.type)&&null!=o&&null!==(C=o.item_info)&&void 0!==C&&C.is_model_creator?e("div",{staticClass:"text-content-main-image"},[e("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"dark",content:t.$t("ModelCreator"),placement:"top-start"}},[e("img",{attrs:{src:t.modelCreatorIcon,alt:t.$t("ModelCreator")}})])],1):t._e()],1),t._v(" "),"mcl_m8"==t.type?e("div",{staticClass:"create-and-collect"},[e("div",{staticClass:"create"},[e("i",{staticClass:"iconfont icon-play"}),t._v(" "),e("span",{staticClass:"words"},[t._v(t._s(null==o?void 0:o.num_of_cre))])]),t._v(" "),e("div",{staticClass:"collect"},[e("i",{staticClass:"iconfont icon-collect"}),t._v(" "),e("span",{staticClass:"words"},[t._v(t._s(null==o?void 0:o.num_of_coll))])])]):t._e(),t._v(" "),["ah","cre","pcl_m8","inul_m8"].includes(t.type)?e("div",{staticClass:"followers"},[t._v(t._s(t.formatNumberForeign(null==o||null===(k=o.item_info)||void 0===k?void 0:k.follower_cnt))+" "+t._s(t.$t("Follower")))]):t._e()])]),t._v(" "),e("div",{staticClass:"quan"},["ah"==t.type||"mh"==t.type||"mcl_m8"==t.type?e("i",{staticClass:"iconfont icon-hot",staticStyle:{color:"#EF4444"}}):t._e(),t._v(" "),"cre"==t.type?e("i",{staticClass:"iconfont icon-play"}):t._e(),t._v(" "),"mc"==t.type?e("i",{staticClass:"iconfont icon-collect"}):t._e(),t._v(" "),"pcl_m8"==t.type?e("i",{staticClass:"iconfont icon-like"}):t._e(),t._v(" "),"inul_m8"==t.type?e("i",{staticClass:"iconfont icon-ranks-user ranks-user"}):t._e(),t._v(" "),e("span",[t._v(t._s(t.formatNumberForeign(o.score)))])])]),t._v(" "),t.needPop?e("div",{staticClass:"pop"},[e("div",{staticClass:"popNum"},[e("span",[t._v(t._s(0!=o.trend?Math.abs(o.trend):"-"))]),t._v(" "),0!=o.trend?e("svg-icon",{attrs:{"icon-class":o.trend>0?"rank-up":"rank-down"}}):t._e()],1),t._v(" "),e("div",{staticClass:"popTxt"},[t._v(t._s(t.$t("Popularity")))])]):t._e()])})),0),t._v(" "),e("event-registration-model-dialog",{ref:"eventRegistrationModelDialog"}),t._v(" "),e("event-registration-artwork-dialog",{ref:"eventRegistrationArtworkDialog"}),t._v(" "),e("claim-dialog",{ref:"claimDialog",attrs:{type:t.type}})],1)}),[],!1,null,"f7c3d0aa",null).exports),L={name:"ActivityRulesDialog",data:function(){return{dialogVisible:!1,language:""}},created:function(){var t=this;this.$EventBus.$on("openActivityRulesDialog",(function(){t.showDialog()}))},mounted:function(){this.language=this.$i18n.locale||"en";this.language=["zhCN","en"].includes(this.language)?this.language:"en"},beforeDestroy:function(){this.$EventBus.$off("openActivityRulesDialog")},methods:{showDialog:function(){this.dialogVisible=!0}}},j=(n(2381),Object(y.a)(L,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"activity-rules",attrs:{title:t.$t("ResultAnnouncement"),visible:t.dialogVisible,width:"1076px",top:"50px","modal-append-to-body":!0,"close-on-click-modal":!1,"custom-class":"SaDialog"},on:{"update:visible":function(e){t.dialogVisible=e}}},[t.language&&"zhCN"===t.language?e("pre",{staticClass:"zh-CN"},[t._v("亲爱的SeaArt AI创作者们：\n绘游未来-游戏主题创作活动已经圆满结束，在过去的几周里，我们看到了各位参赛者的无限创意与热情，经过激烈角逐，各个榜单的获胜者已火热出炉！让我们看看本\n次大赛又有哪些优秀的创作者脱颖而出呢？\n\n模型大咖奖\n第一名：\n5000元现金奖励+VIP季卡\n@Cecily cc\n\n第二名~第三名：\n2000元现金奖励+VIP月卡\n@Dương Nguyễn @zail \n\n第四名~第十名：\n500元现金奖励+VIP月卡\n@演绎 @MngYou @阿尔法狗 @mulidi @溜zi @烟火 @Xi  \n\n第十一名~第二十名：\n200元现金奖励+VIP月卡\n@ColeR @花剌子模信使 @toynya @岳说 @xiaolxl @KK official @懿展 @zaqws001 @wslmbb @L大风起兮傻飞扬 \n\n第二十一名~第三十名：\nVIP月卡\n@Mia @阿童木的小蝴蝶 @根叔在画了 @NekoCat @wuhabai @圣诞又至 @凤冠霞帔-新娘 @QX8W6X大风起兮 @月月AI \n\n创意之星奖：\n第一名：\n800元现金奖励+VIP季卡\n@懿展\n\n第二名~第三名：\n500元现金奖励+VIP月卡\n@wslmbb @Spatika\n\n第四名~第十名：\n100元现金奖励+VIP月卡\n@hougege @Dương Nguyễn @呆宝 @烟火 @阿尔法狗 @Xi  @溜zi   \n\n第十一名~第三十名：\nVIP月卡\n@Emotta @mkbk @岳说 @zail @MngYou @Rocket @兴趣使然的光头 @DOGLike @兔塔狸天王 @阿童木的小蝴蝶 @MOCKU @圣诞又至 @SuperAnna @NekoCat\n@Cecily cc @zaqws001 @花剌子模信使   @Partner Stroi @久境 heben @W8XV2J \n\n宣传大使奖：\n第一名：\n800元现金奖励+VIP季卡\n@Y.\n\n第二名~第三名：\n500元现金奖励+VIP月卡\n@Ty @Saidigen22 \n\n第四名~第十名：\n100元现金奖励+VIP月卡\n@苏博号 @Spatika @kepun lala @BackdoorBarry @B-1732 @riri @小逸檬\n \n\n第十一名~第三十名：\nVIP月卡\n@Canal Porq-On @LST @狗头人 @Pham Haru @mame @AI Protagonist @Mustafa Faisal @炸鸡 @popopon @AIporuru @R3PN0U @chrisbrigido\n@Paul567 2nd @Ryosan43 @拇指的帽子 @QNKIR8 @ZA NE @Coelllho @luanping liu  @yu18 \n\n奖励发放\n现金奖励：请在活动参与页面的网页内提交获奖认领信息，提交成功后工作人员将在公示期结束后与您取得联系\nVIP及算力奖励：提交获奖认领信息后，将在公示期结束后统一为您进行发放\n\n*详细获奖名单与排名情况见活动页内【绘游未来排名】，公示期为9月5日~9月11日，如有任何疑问或举报，请联系社区管理员，经核实后我们将会把作弊的参与者数据\n 清零\n*公示发布后请于7日内前往活动页完成收集，逾期视为自动放弃。（作弊导致数据清零的参与者不予发放奖励，排名向后顺延）\n\n感谢大家对SeaArt AI的支持和陪伴，绘游未来活动虽已经结束，但SeaArt AI社区的创作热情会持续燃烧，我们也期待能够看到更多的精彩创意作品~\n未来我们还会推出更多有意思的活动与更加丰厚的福利，请及时关注我们的社区以免错过重要情报哦！\n        ")]):t._e(),t._v(" "),t.language&&"en"===t.language?e("pre",{staticClass:"en"},[t._v('No Paint, No Game - Game Theme Design Contest Winners Announcement\n\nDear SeaArt creators,\nOur "No Paint, No Game - Game Theme Design Contest" has successfully concluded. Over the past few weeks, we have witnessed the participants\'\ncreativity and passion. After a fierce competition, the winners of each category have been determined! Let\'s see which excellent creators stood out in this\ncontest.\n\nModel Master Awards\n1st Place:\n$689.99 Cash + 90-Day VIP Card\n@Cecily cc\n\n2nd-3rd Place:\n$289.99 Cash + 30-Day VIP Card\n@Dương Nguyễn @zail \n\n4th-10th Place:\n$69.99 Cash + 30-Day VIP Card\n@演绎 @MngYou @阿尔法狗 @mulidi @溜zi @烟火 @Xi  \n\n11th-20th Place:\n$29.99 Cash + 30-Day VIP Card\n@ColeR @花剌子模信使 @toynya @岳说 @xiaolxl @KK official @懿展 @zaqws001 @wslmbb @L大风起兮傻飞扬 \n\n21st-30th Place:\n30-Day VIP Card\n@Mia @阿童木的小蝴蝶 @根叔在画了 @NekoCat @wuhabai @圣诞又至 @凤冠霞帔-新娘 @QX8W6X大风起兮 @月月AI \n\nCreative Star Awards:\n1st Place:\n$109.99 Cash + 90-Day VIP Card\n@懿展\n\n2nd-3rd Place:\n$69.99 Cash + 30-Day VIP Card\n@wslmbb @Spatika \n\n4th-10th Place:\n$14.99 Cash + 30-Day VIP Card\n@hougege @Dương Nguyễn @呆宝 @烟火 @阿尔法狗 @Xi  @溜zi   \n\n11th-30th Place:\n30-Day VIP Card\n@Emotta @mkbk @岳说 @zail @MngYou @Rocket @兴趣使然的光头 @DOGLike @兔塔狸天王 @阿童木的小蝴蝶 @MOCKU @圣诞又至 @SuperAnna @NekoCat\n@Cecily cc @zaqws001 @花剌子模信使   @Partner Stroi @久境 heben @W8XV2J \n\nStar Ambassador Awards:\n1st Place:\n$109.99 Cash + 90-Day VIP Card\n@Y.\n\n2nd-3rd Place:\n$69.99 Cash + 30-Day VIP Card\n@Ty @Saidigen22 \n\n4th-10th Place:\n$14.99 Cash + 30-Day VIP Card\n@苏博号 @Spatika @kepun lala @BackdoorBarry @B-1732 @riri @小逸檬\n\n11th-30th Place:\n30-Day VIP Card\n @Canal Porq-On @LST @狗头人 @Pham Haru @mame @AI Protagonist @Mustafa Faisal @炸鸡 @popopon @AIporuru @R3PN0U @chrisbrigido\n @Paul567 2nd @Ryosan43 @拇指的帽子 @QNKIR8 @ZA NE @Coelllho @luanping liu  @yu18 \n\nReward Distribution\nCash Rewards: Please submit the Award Claim Info on the event page. After the successful submission, we will contact you once the publicity period ends.\nVIP Card and Credit Rewards: Please submit the Award Claim Info on the event page. After the successful submission, the rewards will be distributed once\nthe publicity period ends.\n\n* Please check the [No Paint, No Game Rankings] on the event page for the complete winner list and rankings. The publicity period is from Sep 5th to\n  Sep 11th. If you have any questions or need to report any violations, please contact our community administrator. After verification, we will reset the data of\n  any participants who have cheated.\n* Please submit the Award Claim Info on the event page within 7 days after this announcement is posted. Missing the deadline will result in automatic\n  forfeiture of the rewards. Participants whose data is reset due to cheating will not be eligible for rewards, and other participants\' rankings may be adjusted\n  accordingly.\n\nThank you for supporting and being with us on SeaArt.AI. Our "No Paint, No Game" event may have ended, but the passion will continue burning in the\nSeaArt community, and we are looking forward to more wonderful creative works!\n\nPlease follow our community and stay tuned for more exciting events and rewards!\n        ')]):t._e()])}),[],!1,null,null,null).exports),$={name:"ActivityRank",components:{WaterFall:n(127).a},data:function(){return{list:[],queryParam:{page:1,page_size:60,order_by:"hot",model_type:"",type:"activity"},inReq:!1,hasMore:!0,activeTab:"contest_model",renderBtns:[{name:this.$t("Hot"),value:"hot",color:"#8E9CB1",activeColor:"#EF4444"},{name:this.$t("New"),value:"new",color:"#8E9CB1",activeColor:"#e9b942"}],activeButton:"hot"}},mounted:function(){this.getList()},methods:{resetData:function(){this.inReq=!1,this.hasMore=!0,this.list=[],this.queryParam.page=1,this.queryParam.page_size=60,delete this.queryParam.time_to},getList:function(){var t=this;if(!this.inReq&&this.hasMore){var e;switch(this.inReq=!0,this.activeTab){case"contest_model":default:this.queryParam.model_type="",e=c.r;break;case"contest_artwork":delete this.queryParam.model_type,e=r.artworkList}e(this.queryParam).then((function(e){var n=e.data,o=n.has_more,r=n.items,l=n.time_ms;1e4===e.status.code&&(t.hasMore=o,t.list=t.list.concat(r),t.inReq=!1,t.queryParam.time_to=l,t.queryParam.page++)})).catch((function(e){t.inReq=!1,console.log("err",e)}))}},handleTabChange:function(t){this.activeTab=t,this.resetData(),this.getList()},handleTagChange:function(button){this.activeButton=button.value,this.resetData(),this.queryParam.order_by=button.value,this.getList()}}},T=(n(2387),{components:{rankDelsList:P,ActivityRulesDialog:j,ActivityRank:Object(y.a)($,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"activity-rank"},[e("div",{staticClass:"tabs-container"},[e("div",{staticClass:"tab-item",class:{active:"contest_model"===t.activeTab},on:{click:function(e){return t.handleTabChange("contest_model")}}},[t._v("\n\t\t\t"+t._s(t.$t("contest_model"))+"\n\t\t")]),t._v(" "),e("div",{staticClass:"tab-item",class:{active:"contest_artwork"===t.activeTab},on:{click:function(e){return t.handleTabChange("contest_artwork")}}},[t._v("\n\t\t\t"+t._s(t.$t("contest_artwork"))+"\n\t\t")])]),t._v(" "),e("div",{staticClass:"tags-container"},t._l(t.renderBtns,(function(button){return e("button",{key:button.value,staticClass:"filter-button",class:{active:t.activeButton===button.value},on:{click:function(e){return t.handleTagChange(button)}}},[e("i",{staticClass:"iconfont filter-button-icon",class:"icon-".concat(button.value),style:{color:t.activeButton===button.value?button.activeColor:button.color}}),t._v(" "),e("span",{staticClass:"words"},[t._v(t._s(button.name))])])})),0),t._v(" "),e("div",{ref:"wraper",staticClass:"rank"},[e("WaterFall",{ref:"WaterFallVue",attrs:{type:"activity",cols:7,container:"wraper",list:t.list,lazy:!0,gap:16},on:{load:t.getList}})],1)])}),[],!1,null,null,null).exports},data:function(){return{tabList:[{name:this.$t("creatorsRank"),value:"play"},{name:this.$t("modelRank"),value:"model"}],tabVale:"play",dataAll:{}}},created:function(){var t;switch(null===(t=this.$route.query)||void 0===t?void 0:t.type){case"1":case"2":default:this.tabVale="play";break;case"3":case"4":this.tabVale="model"}},mounted:function(){var t;"true"==((null===(t=this.$route.query)||void 0===t?void 0:t.openActivity)||!1)&&this.openActivityRulesDialog(),this.getDataAll()},computed:{getRankTitle:function(){return location.href.includes("haiyiai.com")?"SeaArt AI":"SeaArt.AI"}},methods:{getDataAll:function(){var t=this;Object(r.rankDetailAll)().then((function(e){1e4==e.status.code&&(t.dataAll=e.data)})).finally((function(){}))},openActivityRulesDialog:function(){this.$refs.activityRulesDialog.showDialog()}},head:function(){var title=this.$t("ranking_tag_title"),desc=this.$t("ranking_tag_desc");return{title:title,meta:[{hid:"description",name:"description",content:desc},{hid:"og:title",name:"og:title",content:title},{hid:"og:description",name:"og:description",content:desc}]}}}),B=(n(2388),Object(y.a)(T,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"rankDetail"},[e("div",{staticClass:"bg"},["activity"==t.tabVale?e("el-backtop",{attrs:{bottom:30,right:30}},[e("i",{staticClass:"el-icon-top"})]):t._e(),t._v(" "),e("div",{staticClass:"cnt"},[e("div",{staticClass:"tabsBox"},[e("div",{staticClass:"tabs"},t._l(t.tabList,(function(n,o){return e("div",{key:o,staticClass:"tabItem",class:{tabItemActivate:t.tabVale==n.value},on:{click:function(e){t.tabVale=n.value}}},[t._v("\n            "+t._s(n.name)+"\n          ")])})),0)]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"play"==t.tabVale,expression:"tabVale == 'play'"}],staticClass:"ranks"},[e("rankDelsList",{attrs:{type:"ah",intList:t.dataAll.ah}}),t._v(" "),e("rankDelsList",{attrs:{type:"cre",intList:t.dataAll.cre}})],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"model"==t.tabVale,expression:"tabVale == 'model'"}],staticClass:"ranks"},[e("rankDelsList",{attrs:{type:"mh",intList:t.dataAll.mh}}),t._v(" "),e("rankDelsList",{attrs:{type:"mc",intList:t.dataAll.mc}})],1),t._v(" "),"activity"==t.tabVale?e("div",{staticClass:"ranks activity"},[e("div",{staticClass:"activityRules",on:{click:t.openActivityRulesDialog}},[e("span",{staticClass:"words"},[t._v(t._s(t.$t("ResultAnnouncement")))]),t._v(" "),e("i",{staticClass:"iconfont icon-tagTips"})]),t._v(" "),e("div",{staticClass:"rankContainer"},[e("rankDelsList",{attrs:{type:"mcl_m8",intList:t.dataAll.mcl_m8,isOver:t.dataAll.is_over,needTimeSelection:!1,needPop:!1}}),t._v(" "),e("rankDelsList",{attrs:{type:"pcl_m8",intList:t.dataAll.pcl_m8,isOver:t.dataAll.is_over,needTimeSelection:!1,needPop:!1}}),t._v(" "),e("rankDelsList",{attrs:{type:"inul_m8",intList:t.dataAll.inul_m8,isOver:t.dataAll.is_over,needTimeSelection:!1,needPop:!1}})],1),t._v(" "),e("activity-rank")],1):t._e()])],1),t._v(" "),e("activity-rules-dialog",{ref:"activityRulesDialog"})],1)}),[],!1,null,"753e19e0",null));e.default=B.exports},3258:function(t,e,n){"use strict";n.r(e);n(14);var o=n(15),r=n(3),l=n(2),c=(n(20),n(9),n(16),n(7),n(32),n(47),n(75),n(10),n(19),n(36),n(165),n(43),n(28),n(8),n(11),n(12),n(4),n(23),n(49),n(237),n(18),n(50),n(76),n(37),n(110),n(238),n(239),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(6),n(48),n(29),n(42)),d=n(24),h=n(1883),v=n(5),m=n(39),f=n(178),_=n(703),y=n.n(_),w=n(704),C=n.n(w),k=n(705),O=n.n(k),x=n(299),I=n.n(x),D=n(78),S=n(1);n(133);function P(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function j(t,e){return'<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">'.concat(e,'</span><span class="code-block-header__copy hidden">').concat(Object(D.a)("copyCode"),'</span></div><code class="hljs code-block-body ').concat(e,'">').concat(t,"</code></pre>")}var $=new y.a({html:!1,linkify:!0,typographer:!0,highlight:function(code,t){if(!(!t||!I.a.getLanguage(t))){var e=t||"";return j(I.a.highlight(code,{language:e}).value,e)}return j(I.a.highlightAuto(code).value,"")}});$.use(O.a,{attrs:{target:"_blank",rel:"noopener"}}),$.use(C.a,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});var T={name:"ChatItem",props:{inAdd:{type:Boolean,default:!1},inGenerate:{type:Boolean,default:!1},item:{type:Object,default:null},msgLoading:{type:Boolean,default:!1},stop:{type:Boolean,default:!1},inStarLilst:{type:Boolean,default:!1},name:{type:String,default:""}},watch:{inGenerate:{handler:function(t,e){var n=this;!1===t&&!0===e&&(console.log("代码停止",t),this.$nextTick((function(){n.addCopyEvents()})))},immediate:!0},"item.content":{handler:function(t,e){""===e&&t.length>0&&this.typeText()},immediate:!0},stop:{handler:function(t,e){!0===t&&!1===e&&(console.log("watch stop 手动停止, in chatwork",t),this.showText=this.showText||"[Something went wrong]")}}},computed:L(L({},Object(S.e)("user",["userInfo"])),{},{isAi:function(){var t;return!(null!==(t=this.item)&&void 0!==t&&t.sender_id)},text:function(){var t=this.showText||"";return t?$.render(t):t},loading:function(){return""===this.item.content&&this.msgLoading},isCollect:function(){var t=this,e=!1;return this.staredListIds.forEach((function(n){n===t.item.id&&(e=!0)})),e},urlList:function(){var t,e;return console.log("urlList",null===(t=this.item)||void 0===t?void 0:t.attachments),null!==(e=this.item)&&void 0!==e&&e.attachments&&this.item.attachments.length>0?this.item.attachments.map((function(t){return t.url})):[]}}),data:function(){return{code:"",showText:"",codeIdx:0,index:0,codeQueue:new f.b(3),codeFlag:!1,halfOpen:!1,codeInType:"",timeOut:null,staredList:[],staredListIds:[],btnTooltips:[{className:"copy",iconFont:"icon-copy-gpt",tipText:Object(D.a)("copy"),action:"copyItem"},{className:"collect",tipText:Object(D.a)("Collect"),action:"toggleCollect"},{className:"delete",iconFont:"icon-delete-gpt",tipText:Object(D.a)("Delete"),action:"deleteItem"},{className:"send",iconFont:"icon-gpt-send",tipText:Object(D.a)("sendTextBtn"),action:"sendToCreate"}],pageNumber:0,dialogVisible:!1}},mounted:function(){var t=this;this.typeTextExist(),this.$nextTick((function(){t.addCopyEvents()})),this.updateStared()},unmounted:function(){this.removeCopyEvents()},methods:{addCopyEvents:function(){var t=this;if(this.isAi){var e=this.$refs.textRef;if(e)e.querySelectorAll(".code-block-header__copy").forEach((function(e){console.log("绑定的Btn",e),e.classList.remove("hidden"),t.$nextTick((function(){e.addEventListener("click",(function(){var t,code=null===(t=e.parentElement)||void 0===t||null===(t=t.nextElementSibling)||void 0===t?void 0:t.textContent;console.log("复制的内容",code),code&&Object(v.d)(code)}))}))}))}},removeCopyEvents:function(){var t=this.$refs.textRef;t&&t.querySelectorAll(".code-block-header__copy").forEach((function(t){t.removeEventListener("click",(function(){}))}))},formatTime:function(t){return Object(m.e)(t)},onCopy:function(){""!==this.code&&Object(v.d)(this.code)},typeText:function(){var t=this;if(""!==this.item.content)if(this.isAi)if(this.stop)this.showText.length>0&&(this.item.content=this.showText,this.$emit("saveChannel"));else{var e=this.item.content;this.codeQueue.enqueue(e[this.index]),"```"===this.codeQueue.string()?(console.log("代码开始"),this.codeQueue.reset(),this.codeFlag=!0,this.halfOpen=!0,this.codeIdx++):this.codeFlag=!1,this.codeFlag?(this.codeFlag=!1,this.codeIdx%2==1?this.showText+="```":(this.showText=this.showText.slice(0,-3),this.halfOpen=!1)):void 0!==e[this.index+1]&&(this.halfOpen?this.showText=this.showText.slice(0,-3)+e[this.index++]+"```":this.showText+=e[this.index++]);!this.inAdd&&this.index+1>=e.length?(this.showText+=e[this.index],clearTimeout(this.timeOut),this.$nextTick((function(){console.log("打字机绑定"),t.$emit("saveChannel"),t.addCopyEvents()}))):this.timeOut=setTimeout(this.typeText,30)}else this.showText=this.item.content},typeTextExist:function(){""!==this.item.content&&(this.isAi?this.isAi&&!1===this.inGenerate&&(this.showText=this.item.content):this.showText=this.item.content)},copyItem:function(){var text=this.item.content||"";text&&(Object(v.d)(text),this.$message.success(Object(D.a)("CopySuccess")))},deleteStar:function(){var t=this;this.$confirm(this.$t("gpt_chat_del_star"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){t.toggleCollect().then((function(){t.$emit("deleteStar")}))})).catch((function(){}))},toggleCollect:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],!t.isCollect){e.next=7;break}return e.next=4,Object(f.d)(t.item,t.userInfo.id);case 4:n=e.sent,e.next=10;break;case 7:return e.next=9,Object(f.c)(t.item,t.userInfo.id);case 9:n=e.sent;case 10:t.updateStared(n);case 11:case"end":return e.stop()}}),e)})))()},updateStared:function(t){var e=this;t?(this.staredList=Array.from(new Set(t)),this.staredListIds=this.staredList.map((function(t){return t.id}))):Object(f.e)(this.userInfo.id).then((function(t){e.staredList=Array.from(new Set(t)),e.staredListIds=e.staredList.map((function(t){return t.id}))}))},clickBtn:function(t){var e=t.action;e&&this[e]()},deleteItem:function(){var t=this;this.$confirm(this.$t("gpt_chat_del_msg"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){t.$emit("deleteMsg",{id:t.item.id})})).catch((function(){}))},sendToCreate:function(){var text=this.item.content.trim();if(text){var t={prompt:text,category:4,noRefer:!0};this.$EventBus.$emit("openGenerate",{action:1,data:t})}}},filters:{formatDateTime:function(t){var e,n;(null===(n=t=null===(e=t)||void 0===e?void 0:e.toString())||void 0===n?void 0:n.length)>13&&(t=t.slice(0,13));var o=new Date(Number(t)),r=o.getFullYear(),l=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0"),d=o.getHours().toString().padStart(2,"0"),h=o.getMinutes().toString().padStart(2,"0"),m=o.getSeconds().toString().padStart(2,"0");return Object(v.u)(o,new Date)?"".concat(d,":").concat(h,":").concat(m):"".concat(r,"/").concat(l,"/").concat(c," ").concat(d,":").concat(h,":").concat(m)}}},B=(n(2716),n(2717),n(0)),M=Object(B.a)(T,(function(){var t,e,n,o=this,r=o._self._c;return r("div",{staticClass:"chat-item flex",class:{isUser:!o.isAi&&!o.inStarLilst}},[o.isAi?o._e():r("div",{staticClass:"chat-item-avatar flex justify-center items-center",class:{round:!o.isAi}},[!o.isAi&&null!==(t=o.userInfo)&&void 0!==t&&t.head?r("img",{attrs:{src:null===(e=o.userInfo)||void 0===e?void 0:e.head,alt:""}}):o.isAi?o._e():r("div",{staticClass:"letter flex justify-center items-center"},[o._v(o._s(o.item.sender_id?o.item.sender_id[0].toUpperCase():o.userInfo.name[0].toUpperCase()))])]),o._v(" "),r("div",{staticClass:"chat-item-content",class:o.isAi||o.inStarLilst?"m-l":"m-r"},[r("div",{staticClass:"chat-item-content-time",class:{"text-right":!o.isAi}},[o._v(o._s(o._f("formatDateTime")(null===(n=o.item)||void 0===n?void 0:n.timestamp)))]),o._v(" "),r("div",{staticClass:"chat-item-content-main flex",class:{isUser:!o.isAi&&!o.inStarLilst}},[r("div",{staticClass:"chat-item-content-body"},[r("div",{ref:"textRef",staticClass:"chat-item-content-body-text"},[o.isAi&&o.loading?r("span",{staticClass:"loading"},[r("i",{staticClass:"el-icon-loading"})]):r("span",{staticClass:"text"},[r("div",{staticClass:"flex flex-col",domProps:{innerHTML:o._s(o.text)}})])]),o._v(" "),o.item.attachments&&o.item.attachments.length>0?r("div",{staticClass:"chat-item-content-body-img"},[r("div",{staticClass:"selfie_img flex"},[o._l(o.item.attachments,(function(img,i){return[r("div",{key:"selfie_".concat(i),staticClass:"img",on:{click:function(t){o.dialogVisible=!0,o.pageNumber=i}}},[null!=img&&img.url?r("img",{attrs:{src:img.url,alt:""}}):o._e()])]}))],2)]):o._e()])])]),o._v(" "),o.dialogVisible?r("el-image-viewer",{staticClass:"message-img-viewer",staticStyle:{"z-index":"9999"},attrs:{"on-close":function(){return o.dialogVisible=!1},initialIndex:o.pageNumber,"url-list":o.urlList}}):o._e()],1)}),[],!1,null,"b4f7a3bc",null).exports,R={name:"PersonInfo",props:{item:{type:Object,default:function(){return{}}}},data:function(){return{replaceImageType:v.x}},mounted:function(){},methods:{showSoon:function(){this.$emit("showSoon")}}},A=(n(2718),Object(B.a)(R,(function(){var t,e,o,r=this,l=r._self._c;return l("div",{staticClass:"person-info flex flex-col"},[l("div",{staticClass:"big-img"},[r.item.photo_album&&r.item.photo_album.length>0?l("el-carousel",{attrs:{autoplay:!1,"indicator-position":"none",arrow:"always",height:"380px"}},r._l(r.item.photo_album,(function(img,t){return l("el-carousel-item",{key:"big-img_".concat(t),staticClass:"rotation-img"},[img.image_uri?l("img",{attrs:{src:r.replaceImageType(img.image_uri,""),alt:""}}):r._e()])})),1):l("span",[r._v(r._s(r.$t("EmptyBannerText")))])],1),r._v(" "),l("div",{staticClass:"info-content flex flex-col"},[l("div",{staticClass:"title"},[r._v(r._s(r.$t("gpt_roleName"+(null===(t=r.item)||void 0===t?void 0:t.person_id)))+"  "+r._s(null===(e=r.item)||void 0===e?void 0:e.age))]),r._v(" "),l("div",{staticClass:"content"},[r._v(r._s(r.$t("gpt_roleIdentity"+(null===(o=r.item)||void 0===o?void 0:o.person_id))))])]),r._v(" "),r.item.portraits&&r.item.portraits.length>0?l("div",{staticClass:"gallery flex flex-col"},[l("div",{staticClass:"title"},[r._v(r._s(r.$t("gpt_gallery")))]),r._v(" "),l("div",{staticClass:"blur-imgs flex flex-wrap justify-center"},r._l(r.item.portraits,(function(t,i){return l("div",{key:"blur_".concat(i),staticClass:"img"},[l("span",{staticClass:"diamond",on:{click:r.showSoon}},[l("img",{staticClass:"diamond-img",attrs:{src:n(3224),alt:""}})]),r._v(" "),t.image_uri?l("img",{attrs:{src:t.image_uri,alt:""}}):r._e()])})),0),r._v(" "),l("button",{staticClass:"more-btn",on:{click:r.showSoon}},[r._v(r._s(r.$t("more")))])]):r._e()])}),[],!1,null,"f0fec71a",null).exports);function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var N={name:"CommingSoon",props:{},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(S.e)("user",["cdnHost"])),data:function(){return{dialogVisible:!1,width:"320"}},mounted:function(){},methods:{handelClose:function(){this.dialogVisible=!1},showDialog:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.dialogVisible=t}}},F=N,U=(n(2719),Object(B.a)(F,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"comming-soon-dialog",attrs:{visible:t.dialogVisible,width:t.width,"before-close":t.handelClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[t._t("default"),t._v(" "),e("el-button",{staticClass:"close-btn el-icon-close",attrs:{type:"text"},on:{click:t.handelClose}}),t._v(" "),e("div",{staticClass:"content flex"},[e("div",{staticClass:"left-img"},[e("img",{staticClass:"blurImg",attrs:{src:"https://".concat(t.cdnHost,"/static/upload/20230708/bd7be51f-77f1-47bf-a191-2f9e7fe72c5b_low.webp"),alt:""}})]),t._v(" "),e("div",{staticClass:"right-content flex flex-col justify-center"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t("gpt_waiting")))]),t._v(" "),e("div",{staticClass:"mid-line"},[t._v(t._s(t.$t("gpt_moreFeature_name")))]),t._v(" "),e("div",{staticClass:"items flex flex-col"},[e("span",{staticClass:"item"},[e("i",{staticClass:"iconfont icon-gpt_select"}),t._v("\n          "+t._s(t.$t("gpt_moreFeature1")))]),t._v(" "),e("span",{staticClass:"item"},[e("i",{staticClass:"iconfont icon-gpt_select"}),t._v("\n          "+t._s(t.$t("gpt_moreFeature2")))]),t._v(" "),e("span",{staticClass:"item"},[e("i",{staticClass:"iconfont icon-gpt_select"}),t._v("\n          "+t._s(t.$t("gpt_moreFeature3")))])])])])],2)}),[],!1,null,null,null).exports),H={name:"LimitDialog",props:{},data:function(){return{dialogVisible:!1}},mounted:function(){},methods:{handelClose:function(){this.dialogVisible=!1},showDialog:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.dialogVisible=t}}},z=H,V=(n(2720),n(2721),Object(B.a)(z,(function(){var t=this,e=t._self._c;return e("div",[e("el-dialog",{attrs:{visible:t.dialogVisible,"custom-class":"limit-dialog","close-on-click-modal":!0,"close-on-press-escape":!0,"append-to-body":!0,"before-close":t.handelClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"}),t._v(" "),e("div",{staticClass:"main-part"},[e("div",{staticClass:"title flex justify-center"},[e("div",{staticClass:"img-part"},[e("img",{attrs:{src:n(3225),alt:"wechat"}})])]),t._v(" "),e("div",{staticClass:"info flex w-full items-center justify-center"},[t._v("\n        "+t._s(t.$t("gpt_chat_limit"))+"\n      ")])]),t._v(" "),e("span",{staticClass:"dialog-footer w-full flex justify-center",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{staticClass:"my-dialog-btn flex items-center justify-center",on:{click:t.handelClose}},[t._v(t._s(t.$t("Okay")))])],1)])],1)}),[],!1,null,"1740b78d",null).exports),W=n(430),G=n(230),Y=(n(53),n(490),n(13));function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function K(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var X={name:"RolesAndChats",components:{AIChatItem:M,PersonInfo:A,CommingSoon:U,LimitDialog:V},data:function(){return{activeChannelId:"",channels:[],activeMessages:[],hideList:[],tempOpenList:[],debounceHandleScroll:"",myRoles:[],messageInput:"",lastSendTime:null,showProfile:!1,inGenerate:!1,msgLoading:!1,inWaiting:!1,stop:!0,inAdd:!1,isComposing:!1,defaultChannel:null,subjectCreate:!1,replaceImageType:v.x,getHideList:h.a,setHideList:h.b,msgListLoading:!1,connectTime:null,errorMap:{20313:"gpt_error_20313",20332:"gpt_sendTooFast"}}},filters:{formatTime:function(t){var e;(null===(e=t)||void 0===e?void 0:e.length)>13&&(t=t.slice(0,13));var n=new Date(Number(t)),o=n.getHours().toString().padStart(2,"0"),r=n.getMinutes().toString().padStart(2,"0"),l=n.getSeconds().toString().padStart(2,"0");return"".concat(o,":").concat(r,":").concat(l)}},computed:K(K(K({},Object(S.e)("chatgpt",["AIPersonList"])),Object(S.e)("user",["userInfo"])),{},{showLeftChannel:function(){var t=this;return function(e){return!t.hideList.includes(e.channel_id)&&(!(null!=e&&e.is_first)||(null==e?void 0:e.channel_id)===t.activeChannelId||t.tempOpenList.includes(e.channel_id))}},allShowChannels:function(){var t=this;return this.channels.filter((function(e){return!t.hideList.includes(e.channel_id)&&(!(null!=e&&e.is_first)||(null==e?void 0:e.channel_id)===t.activeChannelId||t.tempOpenList.includes(e.channel_id))}))},disableMsg:function(){return this.inGenerate||""===this.messageInput.trim()},disableClear:function(){var t;return this.inGenerate||0===(null===(t=this.selectedChannel)||void 0===t||null===(t=t.messages)||void 0===t?void 0:t.length)||!this.stop},selectedChannel:function(){var t,e=this;return(null===(t=this.channels)||void 0===t?void 0:t.find((function(t){return t.channel_id===e.activeChannelId})))||{}}}),watch:{hideList:function(t){this.setHideList(t)},"$route.query":{handler:function(t){null!=t&&t.CID&&(this.activeChannelId=t.CID)},immediate:!0}},mounted:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.AIPersonList.length){e.next=3;break}return e.next=3,t.getDefaultPerson();case 3:t.initChannelList(),t.initWebSocketService(),t.debounceHandleScroll=Object(d.debounce)(t.handleScroll,600),window.addEventListener("online",t.handleOnline),window.addEventListener("offline",t.handleOffline),t.initReconnect();case 9:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){this.debounceHandleScroll=null,window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),clearInterval(this.connectTime)},methods:K(K({},Object(S.b)("chatgpt",["getDefaultPerson","getChatHisMessage"])),{},{initChannelList:function(){var t=Object(o.a)(this.AIPersonList);if(t.length>0){var e=t.map((function(t){return t.messages=[],t}));console.log("**init channel list",e.length,e),this.channels=Object(o.a)(e),this.initActiveChannel()}},initActiveChannel:function(){var t,e,n;if(null!==(t=this.$route)&&void 0!==t&&null!==(t=t.query)&&void 0!==t&&t.CID)this.activeChannelId=null===(n=this.$route)||void 0===n||null===(n=n.query)||void 0===n?void 0:n.CID;else for(var o=this.getHideList(),i=0;i<this.channels.length;i++)if(!this.channels[i].is_first&&!o.includes(this.channels[i].channel_id)){this.activeChannelId=this.channels[i].channel_id;break}!this.activeChannelId&&(this.activeChannelId=null===(e=this.channels[0])||void 0===e?void 0:e.channel_id),this.tempOpenList.push(this.activeChannelId),this.changeHideList()},initReconnect:function(){var t,e,n=this;this.connectTime=setInterval((function(){var t;if(!0!==(null===(t=window)||void 0===t||null===(t=t.SEAART_webSocketService)||void 0===t?void 0:t.isConnected)){console.log("连接已断开，尝试重连"),n.inWaiting=!1;try{var e,o;if(window.SEAART_webSocketService)null===(e=window.SEAART_webSocketService)||void 0===e||e.close(),null===(o=window.SEAART_webSocketService)||void 0===o||o.init()}catch(t){console.log("reconnect error",t)}}}),3e3),null!==(t=this.selectedChannel)&&void 0!==t&&t.messages&&0===(null===(e=this.selectedChannel)||void 0===e||null===(e=e.messages)||void 0===e?void 0:e.length)&&this.getLastChatMessage()},changeHideList:function(){var t=this,e=this.getHideList();e.includes(this.activeChannelId)?this.hideList=e.filter((function(e){return e!==t.activeChannelId})):this.hideList=Object(o.a)(e)},enterMsg:function(t){13!==t.keyCode||t.shiftKey||this.isComposing||!1!==this.inGenerate||this.sendMessage()},enterNextLine:function(t){13===t.keyCode&&t.shiftKey&&(this.isComposing||(this.messageInput+="\n"))},sendMessage:function(){var t,e,n=this;if(""!==this.messageInput.trim()&&null!==(t=this.selectedChannel)&&void 0!==t&&t.person_id){var o=(new Date).getTime();if(this.lastSendTime&&o-this.lastSendTime<3e3)this.$message.warning(this.$t("gpt_sendTooFast"));else{this.lastSendTime=o,console.log("发送消息",this.messageInput);var r={messages:[{role:"user",content:this.messageInput}],model_name:"gpt-3.5-turbo",is_preset:!0,person_id:null===(e=this.selectedChannel)||void 0===e?void 0:e.person_id};this.addMsg("self",{},this.messageInput),this.messageInput="",this.reconnectWebSocket().then((function(){n.msgListLoading=!1,Object(G.c)(r).then((function(t){var e,code=null==t||null===(e=t.status)||void 0===e?void 0:e.code;if(1e4===code){var o;n.inWaiting=!1;var l=null==t||null===(o=t.data)||void 0===o?void 0:o.girlfriend_message;l&&n.addMsg("ai",K({},l))}else[20312,20319,"20312","20319"].includes(code)?(n.showDialog("limitDialog"),n.removeLastMsg(r.messages[0].content)):Object.keys(n.errorMap).includes(code)?n.$message.warning(n.errorMap[code]):n.$message.error(n.$t("gpt_send_error"))})).catch((function(t){console.log("发送消息失败",t)})).finally((function(){n.inWaiting=!1}))})).catch((function(t){console.log("重连失败",t),n.$message.error(n.$t("ServerError"))}))}}else console.log("无内容或为获取到频道person_id")},selectChannel:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.inWaiting=!1,t.channel_id!==e.selectedChannel.channel_id){n.next=3;break}return n.abrupt("return");case 3:if(e.stopGenerate(!0),e.activeChannelId=t.channel_id,e.messageInput="",t.messages&&0!==t.messages.length){n.next=9;break}return n.next=9,e.getLastChatMessage();case 9:e.scrollToBottom("messageList");case 10:case"end":return n.stop()}}),n)})))()},stopGenerate:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.inAdd=!1,this.stop=t,this.inGenerate=!1,this.msgLoading=!1},saveChannel:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log("存消息",this.channels),t&&(this.stop=!0,this.scrollToBottom("messageList"))},deleteChannel:function(t){var e=Object(o.a)(this.allShowChannels);console.log("删除时的频道数组",e),1!==e.length?(this.hideList.push(t.channel_id),this.saveChannel(),t.channel_id===this.selectedChannel.channel_id&&(this.activeChannelId=this.allShowChannels[0].channel_id,this.$router.replace({path:"/chat"}),this.getLastChatMessage())):console.log("删除最后一个频道")},addMsg:function(){var t,e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;"self"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ai")&&(this.inWaiting=!0,n={author:{},channel_id:null===(t=this.selectedChannel)||void 0===t?void 0:t.channel_id,content:o,message_id:String((new Date).getTime()),sender_id:null===(e=this.userInfo)||void 0===e?void 0:e.name,timestamp:(new Date).getTime()+"000000",type:1});this.channels.forEach((function(t){var e;t.channel_id===n.channel_id&&(null===(e=t.messages[t.messages.length-1])||void 0===e?void 0:e.message_id)!==n.message_id&&t.messages.push(n)})),this.$forceUpdate(),this.scrollToBottom("messageList")},deleteMsg:function(t){console.log("删除消息",t);var e=t.id;this.selectedChannel.messages=this.selectedChannel.messages.filter((function(t){return t.id!==e})),this.saveChannel()},handleScroll:function(){try{var t=this.$refs.messageList;try{if(0===t.scrollTop&&0===t.scrollHeight)return;this.showBackTopBtn=t.scrollHeight-t.scrollTop>t.clientHeight+50}catch(t){}t&&t.scrollTop<=100&&this.getHistoryChatMessage()}catch(t){}},getHistoryChatMessage:function(){var t,e=this;console.log("in 获取历史消息 has_more",this.selectedChannel.has_more);var n=(null===(t=this.selectedChannel)||void 0===t?void 0:t.messages)||[],r=n.length?n[0]:"",l=r?r.timestamp:"",c={channel_id:this.activeChannelId,page_size:20};r&&(c.time_from=l),!1!==this.selectedChannel.has_more&&(this.msgListLoading=!0,console.log("获取历史消息",c),this.getChatHisMessage(c).then((function(t){var n=t&&t.data?t.data:{},r=n.items,l=void 0===r?[]:r,d=n.has_more,h=void 0!==d&&d;if(e.selectedChannel.has_more=h,c.time_from){var v,m=e.channels.findIndex((function(t){return t.channel_id===c.channel_id})),f=e.sortByField(l,"timestamp",!0);(v=e.selectedChannel.messages).splice.apply(v,[0,0].concat(Object(o.a)(f))),e.scrollToBottom("messageList",h?1735:400),console.log("顶部历史消息",e.channels[m].messages)}})).finally((function(){e.msgListLoading=!1})))},initWebSocketService:function(){var t,e=this;if(!Object(c.l)()||window.SEAART_webSocketService)return console.log("存在 socket实例"),void(0===(null===(t=this.selectedChannel)||void 0===t?void 0:t.messages.length)&&this.getLastChatMessage());var n=Object(Y.t)();console.log("websocket url",n),window.SEAART_webSocketService=new W.a(n,(function(){var t;console.log("连接成功-------"),e.getLastChatMessage(0===(null===(t=e.selectedChannel)||void 0===t||null===(t=t.messages)||void 0===t?void 0:t.length))}),this.handleWebsocketMessage)},handleOnline:function(){try{var t;null===(t=window.SEAART_webSocketService)||void 0===t||t.reconnectWebSocket(!0)}catch(t){}},handleOffline:function(){console.log("网络连接已断开---")},getLastChatMessage:function(){var t,e=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.log("获取最后的40条消息");var r={page_size:40},l=(null===(t=this.selectedChannel)||void 0===t?void 0:t.messages)||[],c=this.getLastMessage(l),d=c?c.timestamp:"";if(d&&(r.time_from=d,r.order_by="asc"),r.channel_id=this.activeChannelId,r.channel_id)return this.msgListLoading=!0,console.log("last消息参数",JSON.stringify(r)),this.getChatHisMessage(r).then((function(t){var l,c,d=t&&t.data?t.data:{},h=d.items,v=void 0===h?[]:h,m=d.has_more,f=void 0!==m&&m;console.log("last消息结果",r.channel_id,e.activeChannelId,v);var _=e.channels.findIndex((function(t){return t.channel_id===r.channel_id})),y=e.channels[_],w=(null==t||null===(l=t.data)||void 0===l?void 0:l.items)||[];w=e.sortByField(w,"timestamp",!0);var C=e.removeDuplicate(y.messages,w);(c=e.channels[_].messages).splice.apply(c,[0,y.messages.length].concat(Object(o.a)(C))),console.log("所有消息",e.channels[_].messages),e.$forceUpdate(),f&&w.length?(console.log("递归获取 last消息"),e.getLastChatMessage(n)):n&&e.scrollToBottom("messageList")})).catch((function(t){console.log("获取last消息失败",t)})).finally((function(){e.msgListLoading=!1}))},reconnectWebSocket:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return new Promise((function(o,r){var l;if(null===(l=window.SEAART_webSocketService)||void 0===l?void 0:l.isConnected)t.msgListLoading=!1,console.log("已是连接状态"),o();else if(e>0){t.msgListLoading=!0,console.log("WebSocket connection failed. Retrying in ".concat(n/1e3," seconds...")),setTimeout((function(){o(t.reconnectWebSocket(e-1,n))}),n);try{var c;null===(c=window.SEAART_webSocketService)||void 0===c||c.init()}catch(t){}}else console.error("WebSocket connection failed after max retries."),r(new Error("WebSocket connection failed."))}))},sortByField:function(t,e){var n=function(a,b){var t=a[e],n=b[e];return t<n?-1:t>n?1:0};return!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?t.sort(n):t.sort((function(a,b){return n(b,a)}))},removeDuplicate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.length>0&&e.length>0&&t[t.length-1].content===e[0].content&&t.pop(),Array.from(new Set([].concat(Object(o.a)(t),Object(o.a)(e))))},handleWebsocketMessage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null!=t&&t.author&&null!=t&&t.sender_id?console.log("收到消息 自己的"):console.log("收到ai消息",null==t?void 0:t.content,t)},showDialog:function(t){var e;null===(e=this.$refs[t])||void 0===e||e.showDialog(!0)},showSheet:function(){this.$router.push(this.localePath({name:"CreateSheet"}))},toggleProfile:function(){this.showProfile=!this.showProfile},scrollToBottom:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.$refs[t]&&this.$refs[t].scrollHeight&&this.$nextTick((function(){try{e.$refs[t].scrollTop=n||e.$refs[t].scrollHeight}catch(t){console.log("scrollTop error",t)}}))},getLastMessage:function(t){if(t.length){var e=t[t.length-1];if(String(e.timestamp.length)>13)return e;var n=t.slice(0,t.length-1);return this.getLastMessage(n)}return""},removeLastMsg:function(){var content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(content){var t,e,n,o=this.getLastMessage(null===(t=this.selectedChannel)||void 0===t?void 0:t.messages);if((null==o?void 0:o.sender_id)===(null===(e=this.userInfo)||void 0===e?void 0:e.name)&&(null==o?void 0:o.content)===content)console.log("删除消息",content),null===(n=this.selectedChannel)||void 0===n||n.messages.pop()}}})},Q=X,Z=(n(2722),Object(B.a)(Q,(function(){var t,e,n,o,r,l,c,d,h,v=this,m=v._self._c;return m("div",{staticClass:"chat-work-list flex justify-between"},[m("div",{staticClass:"channel-list"},[m("div",{staticClass:"channel-list-title flex justify-between items-center",on:{click:function(t){return v.showDialog("commingSoonDialog")}}},[m("span",{staticClass:"flex"},[m("i",{staticClass:"iconfont icon-gpt_create_ai svg-add"}),v._v(" "),m("span",{staticClass:"text"},[v._v(v._s(v.$t("gpt_create_btn")))])]),v._v(" "),m("span",{staticClass:"btn"},[v._v(v._s(v.$t("SOON")))])]),v._v(" "),m("div",{ref:"channelListContent",staticClass:"channel-list-content flex flex-col"},[m("span",{staticClass:"channel-list-top"},[v._v(v._s(v.$t("gpt_conversations")))]),v._v(" "),v._l(v.channels,(function(t,e){var n;return[v.showLeftChannel(t)?m("div",{key:"channels_".concat(e),staticClass:"channel-list-item flex justify-between items-center",class:{selected:v.selectedChannel.channel_id===t.channel_id},on:{click:function(e){return v.selectChannel(t)}}},[m("div",{staticClass:"channel-list-item__name flex items-center"},[null!=t&&t.avatar?m("img",{staticClass:"avatar",attrs:{src:null==t?void 0:t.avatar,alt:""}}):v._e(),v._v(" "),m("span",{staticClass:"text flex flex-col"},[null!=t&&t.person_id?m("span",{staticClass:"name"},[v._v(v._s(v.$t("gpt_roleName"+(null==t?void 0:t.person_id)))+v._s(null!=t&&t.age?", "+(null==t?void 0:t.age):"")+" ")]):v._e(),v._v(" "),null!=t&&t.messages&&(null==t?void 0:t.messages.length)>0?m("span",{staticClass:"first-msg"},[v._v(v._s(null==t||null===(n=t.messages[t.messages.length-1])||void 0===n?void 0:n.content))]):v._e()])]),v._v(" "),m("div",{staticClass:"flex"},[v.allShowChannels.length>1?m("el-button",{staticClass:"chat-item-close el-icon-close",attrs:{type:"text"},on:{click:function(e){return e.stopPropagation(),v.deleteChannel(t)}}}):v._e()],1)]):v._e()]}))],2)]),v._v(" "),m("div",{staticClass:"message-window"},[m("div",{ref:"messageWindow",staticClass:"message-lists flex flex-col"},[m("div",{staticClass:"top-info flex justify-between items-center"},[m("div",{staticClass:"person-info flex items-center"},[null!==(t=v.selectedChannel)&&void 0!==t&&t.avatar?m("img",{staticClass:"avatar",attrs:{src:null===(e=v.selectedChannel)||void 0===e?void 0:e.avatar,alt:""}}):v._e(),v._v(" "),null!==(n=v.selectedChannel)&&void 0!==n&&n.person_id?m("span",{staticClass:"text"},[v._v("\n              "+v._s(v.$t("gpt_roleName"+(null===(o=v.selectedChannel)||void 0===o?void 0:o.person_id))||(null===(r=v.selectedChannel)||void 0===r?void 0:r.name))+v._s(null!==(l=v.selectedChannel)&&void 0!==l&&l.age?", "+(null===(c=v.selectedChannel)||void 0===c?void 0:c.age):"")+"\n            ")]):v._e()]),v._v(" "),m("div",{staticClass:"r-btn"},[m("div",{staticClass:"hide-btn flex items-center",attrs:{type:"text"},on:{click:v.toggleProfile}},[v._v("\n              "+v._s(v.$t("gpt_profile"))+"\n              "),v.showProfile?m("i",{staticClass:"iconfont icon-profile_hide"}):m("i",{staticClass:"iconfont icon-profile_show"})])])]),v._v(" "),m("div",{directives:[{name:"loading",rawName:"v-loading",value:v.msgListLoading,expression:"msgListLoading"}],ref:"messageList",staticClass:"message-list",on:{scroll:v.debounceHandleScroll}},v._l(v.channels,(function(t,e){var n,o;return m("div",{key:t.channel_id+e},[v.selectedChannel.channel_id===t.channel_id?m("div",[v._l(null===(n=v.selectedChannel)||void 0===n?void 0:n.messages,(function(e,i){return[m("AIChatItem",{key:e.message_id+i,attrs:{item:e,inGenerate:v.inGenerate,inAdd:v.inAdd,msgLoading:v.msgLoading,stop:v.stop,name:null==t?void 0:t.name},on:{saveChannel:v.saveChannel,deleteMsg:v.deleteMsg}})]})),v._v(" "),null!==(o=v.selectedChannel)&&void 0!==o&&o.messages.length&&v.inWaiting?m("div",{staticClass:"fake-loading"},[m("div",{staticClass:"time"},[v._v(v._s(v._f("formatTime")(Date.now())))]),v._v(" "),v._m(0,!0)]):v._e()],2):v._e()])})),0)]),v._v(" "),m("div",{staticClass:"message-form flex items-end"},[m("div",{staticClass:"input-wrapper custom-form flex items-end"},[m("el-input",{staticClass:"msg-input",attrs:{type:"textarea",autosize:{minRows:1,maxRows:5},"show-word-limit":"",maxlength:2e3,placeholder:v.$t("gpt_input_placeholder")},on:{compositionstart:function(t){v.isComposing=!0},compositionend:function(t){v.isComposing=!1}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&v._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),v.enterMsg.apply(null,arguments))},keyup:function(t){return!t.type.indexOf("key")&&v._k(t.keyCode,"enter",13,t.key,"Enter")?null:v.enterNextLine.apply(null,arguments)}},model:{value:v.messageInput,callback:function(t){v.messageInput=t},expression:"messageInput"}}),v._v(" "),m("i",{staticClass:"iconfont icon-send1 svg-send",class:{disabled:v.disableMsg},on:{click:function(t){return v.sendMessage()}}})],1)])]),v._v(" "),v.showProfile&&null!==(d=v.selectedChannel)&&void 0!==d&&d.photo_album&&null!==(h=v.selectedChannel)&&void 0!==h&&null!==(h=h.photo_album)&&void 0!==h&&h.length?m("PersonInfo",{attrs:{item:v.selectedChannel},on:{showSoon:function(t){return v.showDialog("commingSoonDialog")}}}):v._e(),v._v(" "),m("CommingSoon",{ref:"commingSoonDialog"}),v._v(" "),m("LimitDialog",{ref:"limitDialog"})],1)}),[function(){var t=this,e=t._self._c;return e("div",{staticClass:"content"},[e("div",{staticClass:"loading flex justify-center items-center"},[e("span",{staticClass:"line line1"}),t._v(" "),e("span",{staticClass:"line line2"}),t._v(" "),e("span",{staticClass:"line line3"})])])}],!1,null,"f6c67f9c",null)),tt={name:"AiPerson.vue",components:{RolesAndChats:Z.exports},data:function(){return{}},methods:{}},et=(n(2723),Object(B.a)(tt,(function(){var t=this._self._c;return t("div",{staticClass:"person-chat"},[t("div",{staticClass:"main w-full"},[t("RolesAndChats")],1)])}),[],!1,null,"d304505e",null));e.default=et.exports},3276:function(t,e,n){"use strict";n.r(e);var o=n(31),r=n(3),l=(n(20),n(4),n(50),n(48),n(542)),c=n(176),d={props:{bList:{type:Array,default:function(){return[]}}},data:function(){return{bannerList:this.bList||[]}},mounted:function(){},methods:{getList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(c.a)();case 3:n=e.sent,o=n.data.items,r=void 0===o?[]:o,t.bannerList=r;case 7:return e.prev=7,t.loading=!1,e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[0,,7,10]])})))()},goDetail:function(t){this.$router.push(this.localePath("/blog/".concat(t.id)))}}},h=(n(2908),n(0)),v=Object(h.a)(d,(function(){var t=this,e=t._self._c;return e("el-carousel",{attrs:{"indicator-position":"outside",height:"420px",arrow:"never"}},t._l(t.bannerList,(function(n){return e("el-carousel-item",{key:n.id},[e("a",{staticClass:"banner",attrs:{href:t.localePath("/blog/".concat(n.seo_url))}},[e("div",{staticClass:"banner-left"},[e("img",{attrs:{src:n.cover,alt:n.title}})]),t._v(" "),e("div",{staticClass:"banner-right"},[e("span",{staticClass:"banner-right-top"},[t._v("\n          "+t._s(n.post_title)+"\n        ")]),t._v(" "),e("span",{staticClass:"banner-right-content"},[t._v("\n          "+t._s(n.meta_desc)+"\n        ")]),t._v(" "),e("div",{staticClass:"banner-right-bottom"},[e("div",[e("span",[t._v(t._s(n.author))])]),t._v(" "),e("div",[e("i",{staticClass:"el-icon-time"}),t._v(" "),e("span",[t._v(t._s(n.reading_duration)+" "+t._s(t.$t("blog_read")))])])])])])])})),1)}),[],!1,null,"9b4f3976",null).exports,m=(n(32),{components:{SwipeableList:n(64).a},props:{bList:{type:Array,default:function(){return[]}},cList:{type:Array,default:function(){return[]}}},data:function(){return{blogList:this.bList||[],categroyList:this.cList||[],tagList:[{icon:"icon-icon_All_",label:"All",value:"all",i18nKey:"blog_all"},{icon:"icon-a-icon_AIArtGuide_",label:"AI Art Guide",value:"aiArtGuide",i18nKey:"blog_aiArtGuide"},{icon:"icon-a-icon_AIVideoGuide_",label:"AI Video Guide",value:"aiVideoGuide",i18nKey:"blog_aiVideoGuide"},{icon:"icon-a-icon_TrainingGuide_",label:"Training Guide",value:"trainingGuide",i18nKey:"blog_trainingGuide"},{icon:"icon-icon_news_",label:"News",value:"news",i18nKey:"blog_news"},{icon:"icon-a-icon_AITools_",label:"AI Tools",value:"aiTools",i18nKey:"blog_aiTools"},{icon:"icon-icon-blog-voice_",label:"AI语音指南",value:"aiVoiceGuide",i18nKey:"blog_aiVoiceGuide"},{icon:"icon-icon-blog-tip_",label:"指南与技巧",value:"guides&tips",i18nKey:"blog_guides&tips"},{icon:"icon-icon-blog-review_",label:"评测",value:"review",i18nKey:"blog_review"}],currentIndex:0,paramsData:{keyword:"",category:"",page:1,page_size:30},loading:!1,itemScrollLeft:null}},computed:{getI18nKey:function(){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.tagList.find((function(e){return e.value===t}));return e?e.i18nKey:"blog_".concat(t)}}},watch:{"paramsData.keyword":{handler:function(t){t&&!this.loading&&this.getBlogList()}}},mounted:function(){},methods:{getList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(c.b)({page:1,page_size:30});case 3:n=e.sent,o=n.data.categories,r=void 0===o?[]:o,t.categroyList=r;case 7:return e.prev=7,t.loading=!1,e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[0,,7,10]])})))()},getBlogList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,e.next=4,Object(c.d)(t.paramsData);case 4:n=e.sent,o=n.data.items,r=void 0===o?[]:o,t.blogList=r;case 8:return e.prev=8,t.loading=!1,e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[0,,8,11]])})))()},chooseTag:function(t,e){this.currentIndex=e,this.paramsData.category=t,this.getBlogList()},goDetail:function(t){this.$router.push(this.localePath("/blog/".concat(t.id)))}}}),f=m,_=(n(2909),Object(h.a)(f,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"categroy"},[e("div",{staticClass:"categroy-title"},[e("div",{staticClass:"categroy-title-content"},[t._v("\n      "+t._s(t.$t("RecentPosts"))+"\n      "),e("el-input",{staticStyle:{width:"320px"},attrs:{placeholder:t.$t("Search"),"suffix-icon":"el-icon-search"},model:{value:t.paramsData.keyword,callback:function(e){t.$set(t.paramsData,"keyword",e)},expression:"paramsData.keyword"}})],1)]),t._v(" "),e("div",{staticClass:"tag-list"},[e("SwipeableList",{attrs:{top:"0px",height:"50px",bntTop:"0px",listAlignItems:"flex-end",listGap:"14px",scrollLeftnum:t.itemScrollLeft}},t._l(t.tagList,(function(n,o){return e("div",{key:n.value,staticClass:"tag-list-item",class:{active:t.currentIndex===o},on:{click:function(e){return t.chooseTag(n.value,o)}}},[e("i",{staticClass:"iconfont",class:t.currentIndex===o?"".concat(null==n?void 0:n.icon,"selected"):"".concat(null==n?void 0:n.icon,"default")}),t._v(" "),e("span",[t._v(t._s(t.$t("".concat(n.i18nKey))))])])})),0)],1),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"categroy-list"},t._l(t.blogList,(function(n,o){return e("a",{key:o,staticClass:"categroy-list-item",attrs:{href:t.localePath("/blog/".concat(n.seo_url))}},[e("img",{staticClass:"categroy-list-item-img",attrs:{src:n.cover,alt:n.title}}),t._v(" "),e("span",{staticClass:"categroy-list-item-top"},[t._v("\n        "+t._s(t.$t("".concat(t.getI18nKey(null==n?void 0:n.category))))+"\n      ")]),t._v(" "),e("span",{staticClass:"categroy-list-item-content"},[t._v("\n        "+t._s(n.post_title)+"\n      ")]),t._v(" "),e("div",{staticClass:"categroy-list-item-bottom"},[e("div",[e("span",[t._v(t._s(n.author))])]),t._v(" "),e("div",[e("i",{staticClass:"el-icon-time"}),t._v(" "),e("span",[t._v(t._s(n.reading_duration)+" "+t._s(t.$t("blog_read")))])])])])})),0),t._v(" "),0!==t.blogList.length||t.loading?t._e():e("div",{staticClass:"defBox"},[e("img",{attrs:{src:n(450),alt:""}}),t._v(" "),e("span",[t._v(t._s(t.$t("no_data")))])])])}),[],!1,null,"28093044",null).exports),y={components:{BlogHeader:l.a,FeaturedPosts:v,RecentPosts:_},data:function(){return{blogList:[],categroyList:[],bannerList:[]}},methods:{},head:function(){var title=this.$t("blog_title"),desc=this.$t("blog_decription");return{title:title,meta:[{hid:"description",name:"description",content:desc},{hid:"og:title",name:"og:title",content:title},{hid:"og:description",name:"og:description",content:desc}]}},asyncData:function(t){return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,l,c,d,data,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$axios,t.app,t.params,r=t.error,e.prev=1,e.next=4,Promise.all([n.$post("/api/v1/blog/category",{page:1,page_size:100}),n.$post("/api/v1/blog/home",{keyword:"",category:"",page:1,page_size:100}),n.$post("/api/v1/blog/banner",{})]);case 4:return l=e.sent,c=Object(o.a)(l,3),d=c[0].data,data=c[1].data,h=c[2].data,e.abrupt("return",{categroyList:(null==d?void 0:d.categories)||[],blogList:(null==data?void 0:data.items)||[],bannerList:(null==h?void 0:h.items)||[]});case 12:e.prev=12,e.t0=e.catch(1),console.log("blog -> asyncData错误啦：",e.t0),r({statusCode:404,message:e.t0});case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))()}},w=(n(2910),Object(h.a)(y,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"blog"},[e("BlogHeader"),t._v(" "),e("div",{staticClass:"blog-title"},[e("span",{staticClass:"blog-title-content"},[t._v(t._s(t.$t("FeaturedPosts")))])]),t._v(" "),e("FeaturedPosts",{attrs:{bList:t.bannerList}}),t._v(" "),e("RecentPosts",{attrs:{bList:t.blogList,cList:t.categroyList}})],1)}),[],!1,null,"5ac73b5c",null));e.default=w.exports},3279:function(t,e,n){"use strict";n.r(e);n(10),n(9),n(11),n(12);var o=n(97),r=n(3),l=n(31),c=n(2),d=(n(20),n(16),n(7),n(32),n(19),n(8),n(4),n(50),n(6),n(48),n(104)),h=n(40),v=n(30),m=n(677),f=n(42),_=n(1),y=n(167),w=n(1908),C=n(1891),k=n(1909),O=n(1892),x=n(1910),I=n(1911),D=n(1888),S=n(1912),P=(n(14),n(36),n(47),n(43),n(5)),L=n(92);function j(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var $={components:{ImgWaterFall:L.a},data:function(){return{formatNumberForeign:P.i,timeAgo:P.E,dialogVisible:!1,lastChatParams:{page:1,page_size:20},roleList:[],isHaveMore:!1,isDone:!1,loading:!1}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?j(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(_.e)("user",["cdnHost","userInfo"])),methods:{showVoiceIcon:function(t){var e,n=(null===(e=this.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.lang_code)||this.$i18n.locale;return["zhCN","zhTW","ja","en"].includes(n)&&1===(null==t?void 0:t.support_voice)},openModel:function(){this.dialogVisible=!0,this.lastChatParams.page=1,this.getRecentChatList()},handleDel:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$confirm(this.$t("tavern1"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){t.removeRole(e),localStorage.removeItem("translate_".concat(e.session_id))}))},removeRole:function(t){var e=this;Object(h.delRecentChatList)({character_id:t.character.id}).then((function(n){var o;if(1e4===(null==n||null===(o=n.status)||void 0===o?void 0:o.code)){var r=e.roleList.findIndex((function(e){return e.character.id===t.character.id}));-1!==r&&e.roleList.splice(r,1),e.$message.success(e.$t("deleteSuccess"))}}))},handleClose:function(){this.roleList=[],this.isDone=!1,this.dialogVisible=!1},handleEdit:function(){this.isDone=!this.isDone,this.$logEvent("log_actions",{operation:"click_edit",behavior_info:"on_tavern_page"})},handelChat:function(t){this.handleClose(),this.$router.push(this.localePath("/aiChat/".concat(null==t?void 0:t.id)))},getRecentChatList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,Object(h.getNewRecentChatList)(t.lastChatParams);case 3:n=e.sent,o=n.data.items,(r=void 0===o?[]:o).forEach((function(t){var e;t.stat=null==t||null===(e=t.character)||void 0===e?void 0:e.stat,1===t.nsfw&&(t.cover="https://image.cdn2.seaart.ai/static/upload/20231207/39b3e881-ae85-415d-b7aa-74182b3b6267.webp")})),t.loading=!1,t.roleList=t.lastChatParams.page_size>1?t.roleList.concat(r):r,t.isHaveMore=r.length===t.lastChatParams.page_size;case 10:case"end":return e.stop()}}),e)})))()},isScrollBottom:function(){if(this.isHaveMore){var t=this.$refs.cyberBarRecentlyBody,e=t.clientHeight;t.scrollTop+e>=t.scrollHeight&&(this.lastChatParams.page+=1,this.getRecentChatList())}}}},T=$,B=(n(2971),n(0)),M=Object(B.a)(T,(function(){var t=this,e=t._self._c;return e("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cyberBar-dialog",attrs:{"close-on-click-modal":!1,title:"",visible:t.dialogVisible,top:"10px","show-close":!1,"append-to-body":!0,"destroy-on-close":""},on:{"update:visible":function(e){t.dialogVisible=e},"before-close":t.handleClose}},[e("div",{staticClass:"cyberBar-recently-pop-header"},[e("div",{staticClass:"btn",on:{click:t.handleEdit}},[e("i",{class:t.isDone?"el-icon-check":"el-icon-edit"}),t._v(" "),e("span",[t._v(t._s(t.$t(t.isDone?"Done":"Edit")))])]),t._v(" "),e("div",{staticClass:"title"},[t._v(t._s(t.$t("LastChat")))]),t._v(" "),e("i",{staticClass:"el-icon-close",on:{click:t.handleClose}})]),t._v(" "),e("div",{ref:"cyberBarRecentlyBody",staticClass:"cyberBar-recently-pop-body",on:{scroll:t.isScrollBottom}},t._l(t.roleList,(function(n){var o,r,l,c,d,h,v;return e("div",{key:n.id,staticClass:"role-item"},[e("div",{staticClass:"role-item-header"},[t._v("\n        "+t._s(null==n||null===(o=n.character)||void 0===o?void 0:o.name)+"\n      ")]),t._v(" "),e("div",{staticClass:"role-item-content"},[t.isDone?e("div",{staticClass:"delete-icon flex-center",on:{click:function(e){return t.handleDel(n)}}},[e("i",{staticClass:"el-icon-close"})]):t._e(),t._v(" "),e("div",{staticClass:"role-item-left"},[e("div",{staticClass:"role-item-left-img"},[n.nsfw?e("ImgWaterFall",{style:{transition:"all 0.3s ease-in-out"},attrs:{isHeight:!1,item:n}}):t._e()],1),t._v(" "),e("div",{staticClass:"role-item-left-info"},[null!=n&&null!==(r=n.character)&&void 0!==r&&r.latest_time?e("div",{staticClass:"role-item-left-info-time"},[e("i",{staticClass:"el-icon-time"}),t._v(" "),e("span",[t._v(t._s(t.timeAgo(null==n||null===(l=n.character)||void 0===l?void 0:l.latest_time)))])]):t._e(),t._v(" "),e("div",{staticClass:"role-item-left-info-stat"},[e("i",{staticClass:"iconfont icon-users-solid imgBox-num-item-icon"}),t._v(" "),e("span",[t._v(t._s(t.formatNumberForeign((null==n||null===(c=n.stat)||void 0===c?void 0:c.num_of_token)||(null==n||null===(d=n.character)||void 0===d||null===(d=d.stat)||void 0===d?void 0:d.num_of_token)||0)))])])])]),t._v(" "),e("div",{staticClass:"role-item-right"},[e("el-tooltip",{attrs:{"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"bottom"}},[e("div",{staticClass:"tooltip-txt",attrs:{slot:"content"},slot:"content"},[t._v("\n              "+t._s(null===(h=n.character)||void 0===h?void 0:h.evaluation)+"\n            ")]),t._v(" "),e("div",{staticClass:"desc"},[t._v(t._s(null===(v=n.character)||void 0===v?void 0:v.evaluation))])]),t._v(" "),e("div",{staticClass:"role-item-right-btn flex-center"},[e("div",{on:{click:function(e){return t.handelChat(n)}}},[t._v("\n              "+t._s(t.$t("Continue"))+"\n            ")])])],1)])])})),0)])}),[],!1,null,"f93b884e",null).exports;function R(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?R(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var E={mixins:[n(33).a],props:{},components:{CyberBarRecentlyPop:M,ImgWaterFall:L.a},data:function(){return{formatNumberForeign:P.i,lastChatParams:{page:1,page_size:40},isHaveMore:!1,roleList:[],stickyStyle:{}}},computed:A(A(A({},Object(_.c)("user",["isLoggedIn"])),Object(_.e)("user",["userInfo"])),Object(_.e)("app",["topBanner"])),mounted:function(){this.getRecentChatList()},watch:{$route:function(){document.querySelectorAll(".el-popover").forEach((function(t){t.style.display="none"}))},isLoggedIn:function(t){t&&this.getRecentChatList()}},methods:{addScrollListener:function(){(document.documentElement.scrollTop||document.body.scrollTop)>=180?this.stickyStyle={position:"fixed",top:this.topBanner?"120px":"75px",right:"15px"}:this.$set(this,"stickyStyle",{})},getRecentChatList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.$route.params.ptype,!t.isLoggedIn||"cyberPub"!==n){e.next=10;break}return e.next=4,Object(h.getNewRecentChatList)(t.lastChatParams);case 4:o=e.sent,r=o.data.items,(l=void 0===r?[]:r).forEach((function(t){var e;t.stat=null==t||null===(e=t.character)||void 0===e?void 0:e.stat,1===t.nsfw&&(t.cover="https://image.cdn2.seaart.ai/static/upload/20231207/39b3e881-ae85-415d-b7aa-74182b3b6267.webp")})),t.roleList=l.length>5?l.slice(0,5):l,t.isHaveMore=l.length>5;case 10:case"end":return e.stop()}}),e)})))()},handleClickToDetails:function(t){this.$router.push(this.localePath("/cyberPubPage/".concat(t)))},goChat:function(t){this.$router.push(this.localePath("/aiChat/".concat(t)))},addCyber:function(){this.$router.push(this.localePath("/cyberPubPage/new-character")),this.$logEvent("log_actions",{operation:"click_navtoolnew",behavior_info:"on_tavern_page"})},getMore:function(){this.$refs.cyberBarRecentlyPop.openModel(),this.$logEvent("log_actions",{operation:"click_navtoolmore",behavior_info:"on_tavern_page"})},otherUser:function(t){var path="/user/"+encodeURIComponent(t.author.id);this.userInfo.id==t.character.id&&(path="/personal"),window.open(this.localePath(path),"_blank")}},beforeDestroy:function(){}},N=(n(2972),Object(B.a)(E,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"cyberBarRecently",style:{top:"120px"}},[e("div",{staticClass:"cyberBarRecently-box"},[e("el-tooltip",{attrs:{effect:"light",content:t.$t("NewDigitalPerson"),placement:"top-start"}},[e("i",{staticClass:"el-icon-circle-plus icon",on:{click:t.addCyber}})]),t._v(" "),t.roleList&&t.roleList.length>0?e("el-tooltip",{attrs:{effect:"light",content:t.$t("recently"),placement:"top-start"}},[e("span",{staticClass:"cyberBarRecently-box-text"},[t._v("\n        "+t._s(t.$t("recently"))+"\n      ")])]):t._e(),t._v(" "),t._l(t.roleList,(function(n,o){var r,l,c,d,h,v,m,f,_,y,w;return e("div",{key:n.id,staticClass:"cyberBarRecently-box-item"},[e("el-popover",{attrs:{width:"335","popper-class":"custom-popver",placement:"right",trigger:"hover"}},[e("div",{staticClass:"cyberBarRecently-box-item-img",attrs:{slot:"reference"},slot:"reference"},[e("img",{attrs:{src:null==n?void 0:n.cover,alt:""},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.goChat(n.id)}}})]),t._v(" "),e("div",{staticClass:"cyberBarRecently-hover",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.goChat(n.id)}}},[e("div",{staticClass:"imgBox"},[n.nsfw?e("ImgWaterFall",{style:{transition:"all 0.3s ease-in-out"},attrs:{isHeight:!1,item:n}}):t._e(),t._v(" "),e("div",{staticClass:"imgBox-num"})],1),t._v(" "),e("div",{staticClass:"name",attrs:{title:null==n?void 0:n.name},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleClickToDetails(n.id)}}},[t._v("\n            "+t._s(null==n||null===(r=n.character)||void 0===r?void 0:r.name)+"\n          ")]),t._v(" "),e("div",{staticClass:"info"},[e("div",{staticClass:"bottom"},[e("div",{staticClass:"author"},[e("div",{staticClass:"author-box",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.otherUser(n)}}},[null!==(l=n.author)&&void 0!==l&&l.head?e("div",{staticClass:"authorHead"},[e("img",{directives:[{name:"webp",rawName:"v-webp",value:t.$imgL,expression:"$imgL"}],attrs:{src:null===(c=n.author)||void 0===c?void 0:c.head,alt:null===(d=n.author)||void 0===d?void 0:d.name}})]):e("div",{staticClass:"authorHead"},[t._v("\n                    "+t._s(null===(h=n.author)||void 0===h?void 0:h.name[0])+"\n                  ")]),t._v(" "),e("div",{staticClass:"authorName"},[e("span",[t._v(t._s(null===(v=n.author)||void 0===v?void 0:v.name))])])]),t._v(" "),e("div",{staticClass:"imgBox-num-item",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.setCollect(n,"character")}}},[e("div",{staticClass:"imgBox-num-item-icon"},[e("i",{staticClass:"iconfont",class:t.setCollectData(n)})]),t._v(" "),e("span",{staticClass:"imgBox-num-item-text"},[t._v("\n                    "+t._s(t.formatNumberForeign((null===(m=n.character)||void 0===m||null===(m=m.stat)||void 0===m?void 0:m.num_of_collection)||(null==n||null===(f=n.character)||void 0===f||null===(f=f.stat)||void 0===f?void 0:f.num_of_collection)||0))+"\n                  ")])])]),t._v(" "),e("div",{staticClass:"item-content-tags"},t._l(null===(_=n.character)||void 0===_?void 0:_.categories,(function(n){return e("span",{key:n.id,staticClass:"item-content-tags-item"},[t._v("\n                  "+t._s(n.name)+"\n                ")])})),0)]),t._v(" "),e("div",{staticClass:"top"},[e("el-tooltip",{attrs:{"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"bottom"}},[e("div",{staticClass:"tooltip-txt",attrs:{slot:"content"},slot:"content"},[t._v("\n                  "+t._s(null===(y=n.character)||void 0===y?void 0:y.evaluation)+"\n                ")]),t._v(" "),e("div",{staticClass:"desc"},[t._v(t._s(null===(w=n.character)||void 0===w?void 0:w.evaluation))])])],1)])])])],1)})),t._v(" "),t.roleList&&t.roleList.length>0?e("el-tooltip",{attrs:{effect:"light",content:t.$t("recentlyUsedTips"),placement:"top-start"}},[e("i",{staticClass:"el-icon-arrow-right icon",on:{click:t.getMore}})]):t._e()],2),t._v(" "),e("CyberBarRecentlyPop",{ref:"cyberBarRecentlyPop"})],1)}),[],!1,null,"34d09b3a",null).exports),F=["content"];function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function H(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var z={inject:["app"],provide:function(){return{homePageApp:this}},name:"Home",components:{PageSeo:y.a,HyTagList:w.a,HyBannerList:C.a,HyQuickAppList:k.a,HyBlockList:O.a,HyRecentlyUsed:x.a,HyFeaturedList:I.a,HyHomeForms:D.a,HyWaterfallFlowList:S.a,CyberBarRecently:N},data:function(){return{hasInitialized:!1,isReq:!1,homeData:{},homeConfigAllData:{},queryParam:{offset:"",page:2,page_size:35},pageSEO:{title:"",meta_description:"",key_words:"",tempList:[]},pageSEOSwitch:!1,waterList:[]}},computed:H(H({},Object(_.c)("user",["isLoggedIn","token"])),{},{isShowPageSEO:function(){var t;return(null===(t=this.pageSEO)||void 0===t||null===(t=t.tempList)||void 0===t?void 0:t.length)&&!this.isLoggedIn},tagList:function(){return(this.homeData||{}).tag_items},runderComponent:function(){return function(t){return d.c[t]}},thePage:function(){var t=(this.$route.params||{}).ptype;return void 0===t?"/":t},isShowCyberBarRecently:function(){return"cyberPub"===this.thePage&&this.isLoggedIn}}),watch:{$route:{handler:function(){},deep:!0},isLoggedIn:{handler:function(t,e){t&&!e&&this.getPatFaceLists()}}},mounted:function(){this.getHomeViewerData(),this.locaConfigData(),Object(f.l)()&&this.getPatFaceLists()},activated:function(){this.locaConfigData()},deactivated:function(){this.hasInitialized=!1},beforeDestroy:function(){this.hasInitialized=!1},methods:{locaConfigData:function(){if(!this.hasInitialized){this.hasInitialized=!0;var t=this.$cookies.get("isDeadline"),e=localStorage.getItem("homeConfigData");if(!e||"{}"===e||t){var n=JSON.stringify(this.homeConfigAllData);localStorage.setItem("homeConfigData",n)}var o=localStorage.getItem("homeConfigData")||"{}";Object.keys(this.homeConfigAllData).length||(this.homeConfigAllData=JSON.parse(o)),this.app.getHomeConfig(this.homeConfigAllData),this.setPageData();var r=!this.waterList.length,l=2===this.queryParam.page;r&&l&&(this.queryParam.page=1,this.queryParam.offset="",this.getWaterfallList())}},setPageData:function(){var t=this.$route.params.ptype,e=void 0===t?"/":t,n=(this.homeConfigAllData||{}).items,o=(void 0===n?[]:n).find((function(t){return t.route===e}))||{};this.homeData=o,this.getElInfoFill()},getModulesFill:function(){var t=this,e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).nextFn,n=JSON.parse(JSON.stringify(this.homeData)),o=n.modules,r=(void 0===o?[]:o).filter((function(t){return!t.elList})).map((function(t){return t.id}));if(r.length){var l={module_ids:r};Object(v.k)(l).then((function(e){var o,r,l=(null==e||null===(o=e.data)||void 0===o?void 0:o.items)||[];n.modules.forEach((function(t){var e=l.find((function(sub){return sub.id===t.id}))||{};t.elList=(null==e?void 0:e.items)||[]})),t.homeData=n,((null===(r=t.homeConfigAllData)||void 0===r?void 0:r.items)||[]).forEach((function(t){n.id===t.id&&(t.modules=n.modules)})),localStorage.setItem("homeConfigData",JSON.stringify(t.homeConfigAllData))}))}else e&&e()},getElInfoFill:function(){var t=this,e=(this.homeData||{}).modules,n=void 0===e?[]:e,o=[],param=[];this.getModulesFill({nextFn:function(){n.forEach((function(em){var t=(null==em?void 0:em.elList)||[];![6,"6"].includes(em.content_type)&&t.length&&t.forEach((function(sub){var t=sub||{},e=t.id,n={obj_id:e,obj_type:t.obj_type};o.push(e),param.push(n)}))})),h.getElinfoDynamic({items:param}).then((function(e){var n=((null==e?void 0:e.data)||{}).items,o=void 0===n?[]:n,r=JSON.parse(JSON.stringify(t.homeData));r.modules.forEach((function(em){((null==em?void 0:em.elList)||[]).forEach((function(sub){var t=o.find((function(t){return t.id===sub.id}))||{};sub.stat=t.stat||{},sub.liked=t.liked,sub.collect=t.collect}))})),t.homeData=r}))}})},changeTags:function(t){this.$router.push(this.localePath(null==t?void 0:t.path))},getHomeViewerData:function(){var t,e=this,n=(null==this||null===(t=this.$route)||void 0===t?void 0:t.query).tpid;if(n){var o={page_id:n};h.getHomeViewerData(o).then((function(t){var n,o=(null==t||null===(n=t.data)||void 0===n?void 0:n.items)||[],r=Object(l.a)(o,1)[0];e.homeData=r}))}},screenWaterList:function(){var t=this;this.isReq=!1,this.queryParam.page=1,this.queryParam.offset="",this.getWaterfallList({afterCall:function(){t.waterList=[]}})},getWaterfallList:function(){var t=this,e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).afterCall;if(!this.isReq){this.isReq=!0;var n=this.$refs.HyHomeFormsRef.formData,o=this.$refs.HyHomeFormsRef.citemObj,param=H(H({},this.queryParam),n);param.order_by=n.order_by_time||n.order_by;var r=h[o[n.order_by]]||h.getWaterRecommend,l=this.$route.params.ptype;"/"!==(void 0===l?"/":l)||this.isLoggedIn||(r="recommend"===param.order_by?h.getWaterArtworkRecommend:h.getWaterfallPost),r(param).then((function(n){e&&e(),t.queryParam.page++,t.queryParam.offset=n.data.offset||"",t.waterList=t.waterList.concat(n.data.items||[]),t.isReq=!1})).catch((function(){t.isReq=!1}))}},switchPageSEO:function(){this.pageSEOSwitch=!this.pageSEOSwitch},getPatFaceLists:function(){var t=this;h.getPatFaceList({plat:"web"}).then((function(e){var n,o;null!==(n=e.data)&&void 0!==n&&n.page&&(null===(o=e.data)||void 0===o||null===(o=o.page)||void 0===o?void 0:o.length)>0&&(window.$EventBus=t.$EventBus,m.a.open({type:"./PatFacePopup",options:{data:e.data},confirm:function(){}}))}))}},asyncData:function(t){return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,c,h,v,m,f,_,y,w,C,k,O,x,I,D,S,title,P,L,j,$,T,B,M,R,A,E,N,U,z,V,W,G;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.store,n=t.$axios,r=t.app,c=t.params,h=t.error,t.req,v=t.redirect,e.prev=1,m=r.$cookies.get("T"),f=(new Date).getTime(),_=f+3e5,y=r.$cookies.get("locaExpire")||0,w=(c||{}).ptype,C=void 0===w?"/":w,k={},O={name:d.h[C]||"recommendPage"},x=null,m){e.next=20;break}return e.next=14,n.$post("/api/v1/fast_ai/detail",O);case 14:I=e.sent,D=I.data,title=(S=D||{}).title,P=S.meta_description,L=S.key_words,j=S.module,$=(void 0===j?[]:j).map((function(t){var content=t.content;return H(H({},Object(o.a)(t,F)),{},{content:JSON.parse(content)})})),x={tempList:$||[],title:title,meta_description:P,key_words:L},k.pageSEO=x;case 20:if(!(f<y)){e.next=25;break}return r.$cookies.set("isDeadline",!1),e.abrupt("return",k);case 25:return r.$cookies.set("locaExpire",_),r.$cookies.set("isDeadline",!0),e.next=29,Promise.all([n.$post("/api/v1/square/component/config",{parent_id:"home",type:"page",active_id:C})]);case 29:if(T=e.sent,B=Object(l.a)(T,1),M=B[0].data,R=(M||{}).items,A=(void 0===R?[]:R).find((function(t){return t.route===C}))){e.next=36;break}return e.abrupt("return",v("/"));case 36:return E=d.k[A.content_type]||"/",N=d.i[E],"/"!==C||m||(N="/api/v1/square/v3/post/list"),U=m?d.f[E]:d.g[E],z=U.order_by_time||U.order_by,e.next=43,n.$post(N,{page:1,page_size:35,order_by:z,time_from:U.time_from,time_to:U.time_to,offset:""});case 43:return V=e.sent,W=V.data.items||[],G={offset:V.data.offset||"",page:2,page_size:35},k={homeConfigAllData:M,homeData:A,waterList:W,queryParam:G},x&&(k.pageSEO=x),e.abrupt("return",k);case 49:e.next=55;break;case 51:e.prev=51,e.t0=e.catch(1),console.log("首页配置 -> asyncData错误啦：",e.t0),h({statusCode:404,message:e.t0});case 55:case"end":return e.stop()}}),e,null,[[1,51]])})))()},head:function(){var t=this.pageSEO,title=t.title,e=t.meta_description,n=t.key_words;title=this.$t(title||"newHomeTitle");var desc=this.$t(e||"newHomeDesc");return{title:title||"newHomeTitle",meta:[{hid:"description",name:"description",content:desc},{hid:"keywords",name:"keywords",content:this.$t(n)},{hid:"og:title",name:"og:title",content:title},{hid:"og:description",name:"og:description",content:desc}]}}},V=z,W=(n(2973),Object(B.a)(V,(function(){var t,e=this,n=e._self._c;return n("div",{staticClass:"assemble-home-page",class:["cyberPub"===e.thePage&&"main-cyber",e.app.showMenu&&e.isLoggedIn&&"main-collect"]},[e._l(e.homeData.modules,(function(t,o){return n("div",{key:t.id},[[6,"6"].includes(t.content_type)?n("HyTagList",{staticClass:"module-box",attrs:{temp:t,indexes:o},on:{onChange:e.changeTags}}):e._e(),e._v(" "),[7,"7"].includes(t.content_type)?n("HyQuickAppList",{staticClass:"module-box",attrs:{temp:t,indexes:o}}):e._e(),e._v(" "),[8,"8"].includes(t.content_type)?n("HyBannerList",{staticClass:"module-box",attrs:{temp:t,indexes:o}}):e._e(),e._v(" "),[9,"9"].includes(t.content_type)?n("HyBlockList",{staticClass:"module-box",attrs:{temp:t,indexes:o}}):e._e(),e._v(" "),n(e.runderComponent(t.content_type),{tag:"component",staticClass:"module-box",attrs:{temp:t,indexes:o}})],1)})),e._v(" "),n("HyHomeForms",{ref:"HyHomeFormsRef",on:{onScreen:e.screenWaterList}}),e._v(" "),n("div",{ref:"wraper",staticClass:"wraper"},[n("HyWaterfallFlowList",{ref:"HyWaterfallFlowListRef",attrs:{list:e.waterList,container:"wraper"},on:{load:e.getWaterfallList}}),e._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isReq,expression:"isReq"}],staticClass:"loadBox"})],1),e._v(" "),n("el-backtop",{attrs:{bottom:30,right:30}},[n("i",{staticClass:"el-icon-top"})]),e._v(" "),n("CyberBarRecently",{directives:[{name:"show",rawName:"v-show",value:e.isShowCyberBarRecently,expression:"isShowCyberBarRecently"}]}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowPageSEO,expression:"isShowPageSEO"}],staticClass:"page-info",class:{"open-info":e.pageSEOSwitch}},[n("div",{staticClass:"page-switch"},[n("i",{staticClass:"iconfont icon-icon-arrow3",on:{click:e.switchPageSEO}})]),e._v(" "),n("page-seo",{attrs:{tempList:null===(t=e.pageSEO)||void 0===t?void 0:t.tempList}})],1)],2)}),[],!1,null,"28a288ac",null));e.default=W.exports},3283:function(t,e,n){"use strict";n.r(e);n(9),n(11),n(12);var o=n(3),r=n(2),l=(n(20),n(16),n(7),n(10),n(19),n(8),n(4),n(274),n(23),n(37),n(6),n(520)),c=n(127),d=n(40),h=n(41),v=(n(723),n(1)),m=n(1903),f=n(1893),video=n(426);function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var w={components:{VideoItem:f.a},data:function(){return{videoList:[],loading:!1,isEnd:!1,params:{page:1,page_size:30},noSearchData:!1}},mounted:function(){this.addScrollEvent(),this.getList()},watch:{greenMode:{handler:function(t,e){t!==e&&(this.params.page=1,this.isEnd=!1,this.loading=!1,this.videoList=[],this.getList())},deep:!0}},computed:y(y(y({},Object(v.e)("user",["accountData"])),Object(v.e)("app",["homeType"])),{},{greenMode:function(){var t;return 2!==(null==this||null===(t=this.accountData)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.green_mode)},loadingText:function(){return!this.isEnd&&this.loading?"Loading":this.isEnd&&this.params.page>1?"NoMoreData":""}}),methods:{search:function(t){this.params=t,this.isEnd=!1,this.loading=!1,this.videoList=[],this.getList(!0)},getList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if("video"===this.homeType){this.loading=!0;var n=Object.assign({},this.params,{green:this.greenMode?1:2});Object(video.c)(n).then((function(n){var o=n.data,r=o.has_more,l=o.items,c=o.total,d=void 0===c?0:c;t.videoList=t.videoList.concat(l),t.isEnd=!r,t.loading=!1,t.noSearchData=!(null!=l&&l.length),e&&t.$emit("changeSearchNum",d)})).catch((function(e){t.loading=!1}))}},addScrollEvent:function(){var t=this,e=document.documentElement;window.addEventListener("scroll",(function(){!(e.scrollTop+e.clientHeight>=e.scrollHeight-250)||t.loading||t.isEnd||(t.params.page++,t.getList())}))},toVideoDetails:function(t){this.$router.push(this.localePath("/video/"+t))},changeTab:function(t){console.log("changeTab: "+t),this.videoList=this.videoList.filter((function(e){return e.id!==t}))}}},C=w,k=(n(2530),n(0)),component=Object(k.a)(C,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"video-list"},[t.noSearchData?e("div",{staticClass:"no-search-data-container"},[e("img",{staticClass:"no-search-image",attrs:{src:n(290),alt:"no search data"}}),t._v(" "),e("div",{staticClass:"null-tips"},[t._v(t._s(t.$t("NoSearchData")))])]):e("div",{staticClass:"list"},t._l(t.videoList,(function(video,n){return e("a",{key:"video_"+n,staticClass:"item",attrs:{href:"/video/"+(null==video?void 0:video.id)},on:{click:function(e){return e.preventDefault(),t.toVideoDetails(video.id)}}},[e("video-item",{staticStyle:{width:"100%"},attrs:{video:video,type:"explore"},on:{change:t.changeTab}})],1)})),0),t._v(" "),e("div",{staticClass:"bottom-loading"},[t._v("\n      "+t._s(t.$t(t.loadingText))+"\n    ")])])}),[],!1,null,"157c7134",null),O=component.exports,x=n(5);function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var S={name:"ExploreDetail",components:{FilterComponent:m.a,TagList:l.a,WaterFallVue:c.a,VideoList:O},data:function(){return{noSearchData:!1,batchNum:1,queryParam:{page:1,page_size:35,order_by:"hot",type:"recommend",tags:[]},searchAction:"filter",inTagSearch:!1,activeName:"artwork",activeTag:"",followingList:[],list:[],firstList:[],isLock:!1,isReq:!1,filterChange:!1,isShowHomeTypeSelect:!0,filterBtns:[{name:this.$t("Recommend"),value:"recommend",color:"#8E9CB1",activeColor:"#255EFB"},{name:this.$t("Following"),value:"following",color:"#8E9CB1",activeColor:"#26A06F"},{name:this.$t("Hot"),value:"hot",color:"#8E9CB1",activeColor:"#EF4444"},{name:this.$t("New"),value:"new1",color:"#8E9CB1",activeColor:"#e9b942"},{name:this.$t("Top"),value:"top",color:"#8E9CB1",activeColor:"#fa6929"}],isFirstGetList:!1,dotReportInfo:{category:"default",view_domain:"recommend",batch_id:""},searchContent:"",searchNumber:0,getListNum:0,homeType:"work",isClient:!0}},computed:D(D(D(D({},Object(v.c)("user",["accountData"])),Object(v.e)("app",["userHomeType"])),Object(v.e)("user",["adminOff"])),{},{renderFilter:function(){return this.inTagSearch?this.filterBtns.filter((function(t){return-1===["recommend","following"].indexOf(t.value)})):this.filterBtns},showTags:function(){return!["follows"].includes(this.queryParam.type)},defaultButton:function(){return"work"!=this.homeType?this.$t("Hot"):this.$t("Recommend")},filterCopBtn:{get:function(){return this.$refs.filterComponent.activeButton},set:function(t){this.$refs.filterComponent.activeButton=t}},btnMoreforRecommend:function(){return"recommend"===this.queryParam.type&&this.isLock&&this.queryParam.page>1}}),mounted:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.initList(),o=null===(n=t.$route.params)||void 0===n?void 0:n.tag,t.activeTag=o,t.dotReportInfo.category=t.activeTag||"default",t.activeTag&&(t.queryParam.tags=[t.activeTag],t.queryParam.type="community",t.searchAction="tags",t.inTagSearch=!0);case 5:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){this.$EventBus.$off("homeList"),this.$EventBus.$off("topTextSearch")},methods:D(D(D({},Object(v.d)("app",["setHomeType"])),Object(v.b)("user",["setAdminOff"])),{},{initList:function(){var t=this.list;null!=t&&t.length&&(this.list=t.map((function(t){var e=t.banner;return null==e||!e.url||null!=e&&e.replaceUrl||(t.banner.replaceUrl=Object(x.x)(e.url,"low")),t})))},handleSwitch:function(t){switch(t){case"work":default:this.activeName="artwork";break;case"Checkpoint":case"LORA":this.activeName="model";break;case"gallery":this.activeName="gallery";break;case"video":break;case"User":this.activeName={work:"artwork",Checkpoint:"model",LORA:"model",gallery:"gallery"}[this.userHomeType]}},changeAdminOff:function(){-1!==this.adminOff&&this.setAdminOff(1===this.adminOff?0:1)},addEvent:function(){var t=this;this.$EventBus.$on("homeList",(function(){t.$nextTick((function(){t.$refs.backtop.handleClick()})),t.queryParam.page=1,t.isLock=!1,t.getList()})),sessionStorage.getItem("promptSearch")&&(this.$EventBus.$emit("promptSearch",sessionStorage.getItem("promptSearch")),sessionStorage.removeItem("promptSearch")),this.$nextTick((function(){var e,n,o,r;if(null!==(e=t.$route)&&void 0!==e&&null!==(e=e.query)&&void 0!==e&&e.modelType){var l;if(null!==(n=t.$route)&&void 0!==n&&n.query.modelType&&t.$route.query.tag)return t.activeName="model",null==t||null===(l=t.$refs)||void 0===l||l.filterComponent.changeType("Checkpoint",{order_by:"new"}),void t.$router.replace({path:location.pathname});null==t||null===(o=t.$refs)||void 0===o||o.filterComponent.changeType(null===(r=t.$route)||void 0===r||null===(r=r.query)||void 0===r?void 0:r.modelType),t.$router.replace({path:location.pathname})}}))},changeTags:function(t){if(this.queryParam.tags=t.id?[t.id]:[],this.queryParam.tags.length>0&&this.activeTag!==t.id){this.activeTag="",this.dotReportInfo.category=t.id;var e=this.filterCopBtn;["recommend","following"].includes(e.value)&&(this.filterCopBtn=this.filterBtns[3]),this.inTagSearch=!0;var n=this.filterCopBtn.value;this.filterSearch("tags",{tag_type:2,order_by:n})}else{this.queryParam.tags=[],this.activeTag="",this.dotReportInfo.category="default",this.$refs.tagList.selectItem={},this.inTagSearch=!1,!this.filterChange&&(this.filterCopBtn=this.filterBtns[0]);var o=this.filterCopBtn.value;this.filterSearch("filter",{order_by:o})}},getList:function(t){var e=this;if(console.log("--------\x3ehttpParams: ",JSON.parse(JSON.stringify(this.queryParam))),!this.isReq&&!this.isLock){if(this.accountData.tags&&this.accountData.tags.length>0&&"filter"===this.searchAction)this.queryParam.tags=[],["recommend"].includes(this.queryParam.type)?(this.accountData.tags.forEach((function(element){e.queryParam.tags.push(element.id)})),this.queryParam.batch?this.queryParam.batch:this.queryParam.batch=1,this.queryParam.tag_type=2):delete this.queryParam.batch;else if(1===this.queryParam.tags.length&&["tags","filter"].includes(this.searchAction))this.searchAction="tags",this.queryParam.tag_type=2,this.queryParam.type="community",delete this.queryParam.batch;else{var n;if(null!==(n=this.$route.params)&&void 0!==n&&n.tag)return this.searchAction="tags",this.queryParam.tag_type=2,this.queryParam.type="community",void delete this.queryParam.batch;"recommend"===this.queryParam.type?this.queryParam.batch?this.queryParam.batch:this.queryParam.batch=1:delete this.queryParam.batch}this.isReq=!0;var o=h.r;"artwork"===this.activeName&&(o=d.artworkList),"following"===this.queryParam.order_by&&(o=d.artworkList,this.queryParam.order_by="new",this.queryParam.type="follows"),"gallery"===this.activeName&&(o=d.portfolioSearch),["Checkpoint","LORA"].includes(this.homeType)||"User"===this.homeType&&["Checkpoint","LORA"].includes(this.userHomeType)?this.queryParam=D(D({},this.queryParam),{},{model_type:this.homeType}):delete this.queryParam.model_type;var r=this.queryParam;console.log("httpParams: ",r),o(r).then((function(n){if(n.status&&1e4===n.status.code){var o,l,c,d,h;if(e.searchNumber=(null==n||null===(o=n.data)||void 0===o?void 0:o.total)||0,e.isLock=!n.data.has_more,"artwork"===e.activeName&&(e.dotReportInfo.batch_id=(null==n||null===(l=n.data)||void 0===l?void 0:l.batch_id)||""),t)"gallery"===e.activeName?e.list=e.list.concat(n.data.list||[]):e.list=e.list.concat(n.data.items||[]);else{var v=[];v="gallery"===e.activeName?n.data.list||[]:n.data.items||[],e.list=[],e.$nextTick((function(){e.list=v})),e.getFirstHot(e.queryParam,e.list)}if(e.isReq=!1,e.isFirstGetList=!0,1===r.page&&(r.time_to=n.data.time_ms),r.page++,"gallery"===e.activeName)e.noSearchData=!(t||null!=n&&null!==(c=n.data)&&void 0!==c&&null!==(c=c.list)&&void 0!==c&&c.length);else e.noSearchData=!(t||null!=n&&null!==(d=n.data)&&void 0!==d&&null!==(d=d.items)&&void 0!==d&&d.length),(null===(h=n.data)||void 0===h||!h.items||n.data.items.length<15)&&e.getListNum<3?(e.getListNum++,e.getList(!0)):e.getListNum=0}else n.status&&150002===n.status.code?(e.isReq=!1,e.isLock=!0,e.noSearchData=!0):(e.isReq=!1,e.isLock=!0,e.noSearchData=!1)})).catch((function(t){var code=t.code;e.noSearchData=150002===code,e.isReq=!1})).finally((function(){Reflect.deleteProperty(e.queryParam,"r"),e.btnMoreforRecommend&&e.recommendMore(),e.isShowHomeTypeSelect=!0}))}},getFirstHot:function(t,e){if(e.length>0&&"artwork"===this.activeName&&1===t.page&&"hot"===t.order_by){if(this.firstList.length>0&&"recommend"!==t.type)return;this.firstList=e;var n=e.map((function(t){return t.prompt}));localStorage.setItem("RandomPrompt",JSON.stringify(n))}},getFollowingList:function(){var t=this;Object(d.artworkList)({page:1,page_size:40,order_by:"new",type:"follows"}).then((function(e){1e4===e.status.code&&(t.followingList=e.data.items)}))},dealTypeAndOrder:function(t,e){this.filterChange=!1,"following"===t?(this.queryParam.type="follows",this.queryParam.order_by="new"):"recommend"===t?(this.queryParam.type="recommend",this.queryParam.order_by="hot",this.queryParam.batch=1):(this.filterChange=!0,this.searchAction=this.inTagSearch?"tags":"filter",this.queryParam.type="community",this.queryParam.order_by=t)},filterSearch:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;if(this.dotReportInfo.view_domain=(null==e?void 0:e.order_by)||"hot",this.searchAction=t,null!=e&&e.showType&&(this.homeType=e.showType),"filter"===t){var n=e.order_by;this.dealTypeAndOrder(n)}else if("tags"===t){var o=e.order_by;this.searchAction=this.inTagSearch?"tags":"filter",this.queryParam.type="community",this.queryParam.order_by=o}if(this.homeType&&this.handleSwitch(this.homeType),this.homeType&&"work"===this.homeType&&e.isFromHomeType){var r=e.order_by;this.dealTypeAndOrder(r)}if(this.homeType&&"work"!==this.homeType&&e.isFromHomeType&&(this.queryParam.type="community"),"recommend"===e.order_by){if(this.queryParam.batch=++this.batchNum,this.isReq)return}else this.queryParam.batch=1;if(this.isLock=!1,this.isReq=!1,delete this.queryParam.time_to,this.queryParam.page=1,this.list=[],this.followingList=[],"recommend"===this.queryParam.type)try{var l=this.$refs.tagList.selectItem;null!=l&&l.id&&(this.queryParam.type="community")}catch(t){}this.getList()},tabChange:function(t){this.queryParam.order_by=t.order_by,this.activeName=t.type,this.filterSearch("tab"),this.followingList=[],"artwork"===this.activeName&&this.getFollowingList()},goAll:function(){this.$router.push(this.localePath("/personal?tab=follows"))},recommendMore:function(){this.queryParam.page=1,this.queryParam.r=!0,this.queryParam.batch?this.queryParam.batch++:this.queryParam.batch=1,this.isLock=!1,this.isReq=!1,this.getList(!0)},handlePromptSearch:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";null===(t=this.$refs)||void 0===t||null===(t=t.searchTextarea)||void 0===t||t.fillText(e)},changeSearchNum:function(t){this.searchNumber=t}}),head:function(){return{title:this.$t("ExploreTitle"),meta:[{hid:"description",name:"description",content:this.$t("ExploreDesc")},{hid:"keywords",name:"keywords",content:this.$t("ExploreKeyword")},{hid:"og:title",name:"og:title",content:this.$t("ExploreTitle")},{hid:"og:description",name:"og:description",content:this.$t("ExploreDesc")}]}},asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,data,c,d,h,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$axios,t.app,t.params,o=t.error,e.prev=1,r={batch:1,page:1,page_size:50,order_by:"hot",type:"recommend",tags:[]},e.next=5,n.$post("/api/v1/artwork/list",r);case 5:return l=e.sent,data=l.data,d=(c=data||{}).items,h=c.time_ms,v=c.has_more,r.page++,r.time_to=h,r.batch=v?1:2,e.abrupt("return",{list:d,queryParam:r});case 14:e.prev=14,e.t0=e.catch(1),console.log("广场页-> asyncData错误啦：",e.t0),o({statusCode:404,message:e.t0});case 18:case"end":return e.stop()}}),e,null,[[1,14]])})))()}},P=S,L=(n(2531),n(2532),Object(k.a)(P,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"explore"},[e("el-backtop",{attrs:{bottom:30,right:30}},[e("i",{staticClass:"el-icon-top"})]),t._v(" "),t.searchContent?e("div",{staticClass:"search-result"},[e("span",{staticClass:"content"},[t._v(' "'+t._s(t.searchContent)+'" ')]),t._v(" "),e("span",{staticClass:"tip"},[t._v(t._s(t.$t("SearchResult",{number:t.searchNumber})))])]):t._e(),t._v(" "),t.showTags?e("tag-list",{ref:"tagList",attrs:{active:t.activeTag},on:{changeTags:t.changeTags}}):t._e(),t._v(" "),e("filter-component",{ref:"filterComponent",attrs:{top:"0",showTitle:!1,showTabs:!1,showModelType:!1,showWorkOrModel:!0,defaultButton:t.defaultButton,buttons:t.renderFilter,isShowHomeTypeSelect:t.isShowHomeTypeSelect},on:{change:function(e){return t.filterSearch("filter",e)}}}),t._v(" "),"artwork"===t.activeName&&t.followingList&&t.followingList.length>0?e("div",{staticClass:"following"},[e("div",{staticClass:"title"},[e("span",[t._v(t._s(t.$t("Following")))]),t._v(" "),e("span",{staticStyle:{"font-size":"16px"},on:{click:t.goAll}},[t._v(t._s(t.$t("ShowALL")))])]),t._v(" "),e("follow-work-list",{attrs:{type:"artwork",list:t.followingList}})],1):t._e(),t._v(" "),e("div",{ref:"wraper",staticClass:"wraper",class:{"server-list":!t.isClient}},[e("WaterFallVue",{ref:"WaterFallVue",attrs:{dotReportInfo:t.dotReportInfo,noSearchData:t.noSearchData,alreadyNoMoreData:t.isLock,type:"artwork"===t.activeName?"artwork":"gallery"===this.activeName?"gallery":"model",cols:7,container:"wraper",list:t.list,lazy:!0,dislikeShow:!0,"from-page":"explore",needGridSource:!0},on:{load:function(e){return t.getList(!0)}}})],1),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isReq&&t.isFirstGetList,expression:"isReq && isFirstGetList"}],staticClass:"loading"})],1)}),[],!1,null,"5677f380",null));e.default=L.exports},3284:function(t,e,n){"use strict";n.r(e);n(14),n(4),n(23),n(37);var o=n(30),video=n(426),r=n(527),l=n(528),c=n(529),d=n(530),h=n(5),v=n(260),m=n(672),f={components:{MyPlayer:v.a},props:["video"],data:function(){return{replaceImageType:h.x,player:null,videoConfig:{id:"lookbookVideoId",url:this.video.video.url||"",autoplay:!0,width:"100%",height:"100%",dynamicBg:{disable:!1,mode:"firstframe"}},expandField:{durationNum:8e3,videoProdType:5,relatedWh:{w:221,h:128}},currentPlayTime:0}},beforeDestroy:function(){var t;this.player&&(null===(t=this.player)||void 0===t||t.reset())},methods:{playerReady:function(t){var e=this,n=t.player,o=t.Events,r=t.expandAttrs;this.player=n;var l=this.video.video,c=l.dash_url,d=l.hls_url,h=l.url;this.$nextTick((function(){var t={dash:c,hls:d,other:h},path=Object(m.a)(t).path;n.switchURL(path),n.playNext({url:path}),n.on(o.LOADED_DATA,(function(data){e.handleDataReport(0,"beginning")})),n.on(o.DESTROY,(function(){e.handleDataReport(Math.floor(e.currentPlayTime),"exit")})),n.on(o.USER_ACTION,(function(data){var t=data.action,n=data.currentTime,o={click:"drag",change_definition:"clarity",switch_play_pause:"stop"};o[t]&&e.handleDataReport(Math.floor(n),o[t])})),n.on(o.ENDED,(function(){e.$emit("playerEnd",{player:n,expandAttrs:r})}))}))},timeUpdate:function(data){var t=data.currentTime;this.currentPlayTime=t,this.handleDataReport(Math.floor(t),"tens")},handleDataReport:function(t){var e,n,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=this.video.video_type,c=((null===(e=this.$refs)||void 0===e||null===(e=e.MyPlayerRef)||void 0===e?void 0:e.getPlayerInfo())||{}).definition;this.$logEvent("log_vedio_time",{duration:t,resolution:(null==c?void 0:c.definition)||"",vedio_id:(null===(n=this.$route)||void 0===n||null===(n=n.params)||void 0===n?void 0:n.id)||"",video_source:["post","swift","dance"][l],report_type:r,is_selected:!(null===(o=this.$route)||void 0===o||null===(o=o.query)||void 0===o||!o.isRecommend)})},handRelatedItem:function(data){this.$emit("onRelatedItem",data)},destroyMyPlayer:function(){this.$refs.MyPlayerRef.expandAttrs.destroyMyPlayer()}}},_=f,y=(n(2544),n(0)),w=Object(y.a)(_,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"play-video"},[e("MyPlayer",{ref:"MyPlayerRef",attrs:{config:t.videoConfig,expandField:t.expandField,onReady:t.playerReady,loading:!1},on:{onTimeUpdate:t.timeUpdate,onRelatedItem:t.handRelatedItem}})],1)}),[],!1,null,"505b407c",null).exports,C={name:"allVidoes",props:{},components:{VideoInfo:r.a,VideoComments:l.a,VideoAiPerson:c.a,VideoRelated:d.a,VideoPlayer:w},computed:{videoType:function(){var t;return null===(t=this.videoData)||void 0===t?void 0:t.video_type}},data:function(){return{videoId:"",videoData:null,child2MarginTop:20,previousScrollY:0,isScrollingUp:!1,nextVideoId:""}},mounted:function(){this.getVideoInfo("init")},beforeDestroy:function(){this.$refs.VideoPlayerRef.destroyMyPlayer()},methods:{getVideoInfo:function(t){var e,n=this;this.videoId=this.$route.params.id;var source=(null===(e=this.$route.query)||void 0===e?void 0:e.source)||"";if(this.videoId){var o={id:this.videoId};source&&(o.source=source),this.viewVideoDot(),this.loading=!0,Object(video.b)(o).then((function(t){var e;n.videoData=null==t?void 0:t.data,null===(e=n.$refs)||void 0===e||null===(e=e.relatedVideo)||void 0===e||e.getVideoRelated()})).catch((function(t){console.log("getVideoDetails",t)})).finally((function(){n.loading=!1}))}else this.$router.push(this.localePath("/"))},viewVideoDot:function(){Object(o.g)({items:[{action:"view",obj_no:this.$route.params.id,obj_type:5}]})},backTo:function(){history.length>1?this.$router.back():this.$router.push(this.localePath("/"))},handleAutoPlay:function(t){var e=this,n=t.expandAttrs;if(this.nextVideoId){var o=this.$refs.relatedVideo.videoList[0],r={id:o.id,cover:o.cover,duration:o.look_book.duration,name:o.look_book.name};n.nextPlayVideo({params:r,call:function(){e.$router.replace({path:e.localePath("/video/".concat(e.nextVideoId))})}})}},handRelatedItem:function(data){var t=data.id;this.$router.replace({path:this.localePath("/video/".concat(t))})},handleScroll:function(){var t=this.$refs.child1,e=this.$refs.child2,n=t.getBoundingClientRect().bottom,o=window.innerHeight,r=window.scrollY;if(this.isScrollingUp=r<this.previousScrollY,console.log("leftBottom",n,"viewportHeight",o,"currentScrollY",r),n<=o&&!this.isScrollingUp){var l=o-n;this.child2MarginTop=Math.min(l,e.scrollHeight-o)}else if(this.isScrollingUp&&this.child2MarginTop>0){var c=this.previousScrollY-r;this.child2MarginTop=Math.max(this.child2MarginTop-c,0)}this.previousScrollY=r}}},k=(n(2545),Object(y.a)(C,(function(){var t,e,n,o,r,l,c,d=this,h=d._self._c;return h("div",{staticClass:"all-vidoes"},[h("div",{staticClass:"all-vidoes-back",on:{click:d.backTo}},[h("i",{staticClass:"el-icon-back"})]),d._v(" "),h("div",{ref:"child1",staticClass:"all-vidoes-left"},[null!==(t=d.videoData)&&void 0!==t&&t.id?h("VideoPlayer",{ref:"VideoPlayerRef",attrs:{video:d.videoData},on:{playerEnd:d.handleAutoPlay,onRelatedItem:d.handRelatedItem}}):d._e(),d._v(" "),null!==(e=d.videoData)&&void 0!==e&&null!==(e=e.author)&&void 0!==e&&e.id?h("VideoInfo",{attrs:{authorInfo:null===(n=d.videoData)||void 0===n?void 0:n.author,videoType:d.videoType,tags:(null===(o=d.videoData)||void 0===o?void 0:o.tag)||[],info:d.videoData}}):d._e(),d._v(" "),h("VideoComments",{attrs:{videoType:d.videoType,videoInfo:d.videoData}})],1),d._v(" "),h("div",{ref:"child2",staticClass:"all-vidoes-right",style:{marginTop:d.child2MarginTop+"px"}},[null!==(r=d.videoData)&&void 0!==r&&null!==(r=r.related_characters)&&void 0!==r&&r.length?h("VideoAiPerson",{attrs:{personData:null===(l=d.videoData)||void 0===l?void 0:l.related_characters}}):d._e(),d._v(" "),h("VideoRelated",{ref:"relatedVideo",attrs:{videoType:d.videoType,objType:5,objId:null===(c=d.videoData)||void 0===c?void 0:c.id},on:{nextVideo:function(t){d.nextVideoId=t}}})],1)])}),[],!1,null,"9effe462",null));e.default=k.exports},3289:function(t,e,n){"use strict";n.r(e);n(14),n(9),n(11),n(12);var o=n(15),r=n(3),l=n(2),c=(n(20),n(16),n(7),n(19),n(36),n(43),n(1957),n(8),n(4),n(110),n(6),n(427)),d=n(42),h={name:"ChatWork",components:{ChatItem:n(541).a},props:{channel:{type:Object,default:function(){return{}}},inGenerate:{type:Boolean,default:!1},inAdd:{type:Boolean,default:!1},msgLoading:{type:Boolean,default:!1},stop:{type:Boolean,default:!1}},watch:{channel:{handler:function(t,e){this.workChannel=t},immediate:!0,deep:!0}},data:function(){return{workChannel:{name:"",subject:"",channelId:"",messages:[]},activeTab:0}},mounted:function(){},methods:{switchType:function(t){console.log("type",t),this.activeTab=t,this.$emit("switchType",t)},saveChannel:function(){this.$emit("saveChannel")},deleteMsg:function(t){this.$emit("deleteMsg",t)}}},v=(n(2709),n(0)),m=Object(v.a)(h,(function(){var t,e=this,o=e._self._c;return o("div",[o("div",{staticClass:"chat-item-list flex flex-col"},[null!==(t=e.workChannel)&&void 0!==t&&null!==(t=t.messages)&&void 0!==t&&t.length?e._l(e.workChannel.messages,(function(t){return o("ChatItem",{key:t.id,attrs:{item:t,inGenerate:e.inGenerate,inAdd:e.inAdd,msgLoading:e.msgLoading,stop:e.stop},on:{saveChannel:e.saveChannel,deleteMsg:e.deleteMsg}})})):o("div",{staticClass:"middle-container flex justify-center flex-col items-center"},[o("img",{staticClass:"ai-img",attrs:{src:n(3222),alt:e.$t("chat_tag_title")}}),e._v(" "),o("div",{staticClass:"text-content flex flex-col items-center"},[o("span",{staticClass:"ai-title"},[e._v(e._s(e.$t("gpt_blank_title")))]),e._v(" "),o("span",{staticClass:"ai-text"},[e._v(e._s(e.$t("gpt_blank_text")))])]),e._v(" "),o("div",{staticClass:"btn-content flex justify-between items-center w-full mx-auto"},[o("button",{staticClass:"switch-btn btn-general",class:{active:0===e.activeTab},on:{click:function(t){return e.switchType(0)}}},[o("i",{staticClass:"iconfont icon-gpt-general icon icon-general"}),e._v("\n            "+e._s(e.$t("gpt_blank_general"))+"\n          ")]),e._v(" "),o("button",{staticClass:"switch-btn btn-advance",class:{active:1===e.activeTab},attrs:{disabled:""},on:{click:function(t){return e.switchType(1)}}},[o("i",{staticClass:"iconfont icon-gpt-advance icon icon-advances"}),e._v("\n            "+e._s(e.$t("gpt_blank_advance"))+"\n            "),o("div",{staticClass:"btn-text"},[e._v(e._s(e.$t("gpt_waiting")))])])])])],2)])}),[],!1,null,"6ac0e421",null).exports,f=n(178),_=n(2710),y=n(1),w=n(490);function C(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?C(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var O={name:"ChatWorkList",components:{ChatWork:m},data:function(){return{messageInput:"",inGenerate:!1,msgLoading:!1,stop:!0,inAdd:!1,isComposing:!1,channels:[],selectedChannelIndex:0,defaultChannel:null,subjectCreate:!1}},watch:{selectedChannel:{handler:function(t,e){var n;null!==(n=Object.keys(t))&&void 0!==n&&n.length&&(null==t?void 0:t.channelId)!==(null==e?void 0:e.channelId)&&this.scrollTop("messageWindow")},deep:!0},inGenerate:{handler:function(t,e){!1===t&&!0===e&&this.saveChannel()},immediate:!0},isLoggedIn:{handler:function(t,e){t&&!e&&this.initChannel()},immediate:!0,deep:!0}},computed:k(k(k(k(k(k({},Object(y.e)("user",["userInfo","token"])),Object(y.c)("user",["isLoggedIn","isCompanyAccount"])),Object(y.e)("app",["topBanner"])),Object(y.e)("chatgpt",["selectSubject"])),Object(y.e)("payment",["paymentInfo"])),{},{disableMsg:function(){return this.inGenerate||""===this.messageInput.trim()},disableClear:function(){var t;return this.inGenerate||0===(null===(t=this.selectedChannel)||void 0===t||null===(t=t.messages)||void 0===t?void 0:t.length)||!this.stop},selectedChannel:function(){return this.channels[this.selectedChannelIndex]||{}},blankState:function(){return 0===this.channels.length||1===this.channels.length&&0===this.channels[0].messages.length},msgWinHeight:function(){return"calc(100vh - ".concat(this.topBanner?"140":"94","px)")},isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)||this.isCompanyAccount}}),mounted:function(){this.subjectCreate||this.initChannel()},activated:function(){this.createSubjectChannel(this.selectSubject)},methods:k(k({},Object(y.d)("chatgpt",["setSelectSubject"])),{},{initChannel:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.a)(t.userInfo.id);case 2:(n=e.sent)&&n.length>0?(t.channels=n,t.selectedChannelIndex=n.length-1):t.channels.length<1&&!t.subjectCreate&&t.createChannel();case 4:case"end":return e.stop()}}),e)})))()},createChannel:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.stopGenerate(!0),o={name:(null==t?void 0:t.name)||e.$t("gpt_new_chat"),subject:(null==t?void 0:t.subject)||"",messages:(null==t?void 0:t.messages)||[],prompts:(null==t?void 0:t.prompts)||""},e.messageInput=(null==t?void 0:t.content)||"",r=new _.a(k({},o)),!e.subjectCreate){n.next=9;break}return n.next=7,e.initChannel();case 7:e.subjectCreate=!1,e.blankState&&(e.channels=[]);case 9:console.log("创建的新频道",r),e.channels.push(r),e.selectedChannelIndex=e.channels.length-1,null!=t&&t.prompts&&(console.log("带主题, 自动发送系统消息",e.selectedChannel),e.sendMessage(!0)),e.scrollTop("channelListContent"),e.saveChannel();case 15:case"end":return n.stop()}}),n)})))()},createSubjectChannel:function(t){if(t){this.subjectCreate=!0,this.defaultChannel={role:"system",content:t.prompts||""};var e={name:this.$t(t.title),subject:t.type,messages:[],prompts:t.prompts};this.setSelectSubject(null),this.createChannel(e)}},selectChannel:function(t){t.channelId!==this.selectedChannel.channelId&&(this.stopGenerate(!0),this.selectedChannelIndex=this.channels.indexOf(t),this.messageInput="")},editName:function(t){this.channels.forEach((function(t){t.editing=!1})),t.editing=!0;var e="Name_"+t.channelId,input=this.$refs[e][0];input&&this.$nextTick((function(){input.focus()}))},saveName:function(t){t.editing=!1,t.name||(t.name=this.$t("gpt_new_chat")),this.saveChannel()},deleteChannel:function(t){var e=this,n=this.channels.indexOf(t);this.$confirm(this.$t("gpt_chat_del_channel"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){1===e.channels.length?(e.channels=[],e.createChannel(),console.log("删除最后一个频道")):e.channels.splice(n,1),e.saveChannel(),n===e.selectedChannelIndex?e.selectedChannelIndex=0:n<e.selectedChannelIndex&&(e.selectedChannelIndex=e.selectedChannelIndex-1)})).catch((function(){}))},getMessage:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var data,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(d.l)()){e.next=3;break}return console.log("请先登录"),e.abrupt("return");case 3:return t.inGenerate=!0,t.addNewMessage("ai"),console.log("this.inGenerate  获取消息",t.inGenerate),data=t.getParams(t.selectedChannel),console.log("发送消息参数",data),n={model_name:"gpt-3.5-turbo",messages:Object(o.a)(data)},e.next=11,t.fetchAndReadStream(n);case 11:a=e.sent,t.inGenerate=!1,console.log("获取消息",a);case 14:case"end":return e.stop()}}),e)})))()},fetchAndReadStream:function(data){var t=arguments,e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=t.length>1&&void 0!==t[1]?t[1]:"/api/v1/chat-completion/completion",r=e.$cookies.get("lang")||navigator.language||navigator.browserLanguage,n.next=4,fetch(o,{method:"POST",headers:{"Content-Type":"application/json",token:Object(d.l)(),"Accept-Language":r},body:JSON.stringify(data)});case 4:if(l=n.sent,e.validToken(l)){n.next=8;break}return e.stopGenerate(!0),n.abrupt("return");case 8:if(l.ok){n.next=10;break}throw new Error("dialog error");case 10:return n.next=12,e.readStream(l);case 12:return n.abrupt("return",n.sent);case 13:case"end":return n.stop()}}),n)})))()},readStream:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,d,h,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=e,r=t.body.getReader();case 2:return n.next=5,r.read();case 5:if(l=n.sent,d=l.done,h=l.value,v=Object(c.a)(h),!o.stop){n.next=13;break}return console.log("停止数据流"),r.cancel(),n.abrupt("break",24);case 13:if(!d){n.next=17;break}return h&&h.length>0&&(o.addText(v),o.scrollTop("messageWindow")),o.stopGenerate(!1),n.abrupt("break",24);case 17:o.inGenerate=!0,o.inAdd=!0,o.addText(v),o.scrollTop("messageWindow"),o.msgLoading=!1,n.next=2;break;case 24:case"end":return n.stop()}}),n)})))()},validToken:function(t){try{var e=Object.fromEntries(t.headers),n=e["x-input-coins"],r=e["x-input-tokens"],l=e["x-output-coins"],c=e["x-output-tokens"],d=e["x-code"];if(console.log("获取消息headers",d,n,r,l,c),"10200"===d)return this.$message.error(this.$t("ServerError")),!1;var h,v={70039:["showVipComputingDialog","vipDialogComputedTit2"],70010:["showBreakDialog","VipTip","basic"],80008:this.isVip?["showVipComputingDialog"]:["showNotVipComputingDialog"]};return d&&v[d]?((h=this.$EventBus).$emit.apply(h,Object(o.a)(v[d])),!1):(this.selectedChannel.messages[this.selectedChannel.messages.length-2].coins=n,this.selectedChannel.messages[this.selectedChannel.messages.length-2].tokens=r,this.selectedChannel.messages[this.selectedChannel.messages.length-1].coins=l,this.selectedChannel.messages[this.selectedChannel.messages.length-1].tokens=c,!0)}catch(t){return console.error("Error accessing headers:",t),!1}},getParams:function(t){var e=["assistant","user","system"],n=t.prompts||"";if(t&&t.messages){var r=Object(o.a)(t.messages).slice(-7,-1),l=1e4;n&&(l-=n.length);var c=r.reduceRight((function(t,e){return t.totalLength+e.content.length<=l&&(t.items.unshift(e),t.totalLength+=e.content.length),t}),{items:[],totalLength:0}).items,d=!0,h=c.map((function(t){var content=t.content,n=t.type,o=e[n];return console.log("获取参数",o),"system"===o&&(d=!1),{content:content,role:o}}));return n&&h.length>1&&d&&h.unshift({content:n,role:"system"}),h}},addText:function(text){this.inAdd&&!this.stop&&(this.selectedChannel.messages[this.selectedChannel.messages.length-1].content+=text,this.scrollTop("messageWindow"))},clearMessage:function(){var t=this;this.disableClear||this.$confirm(this.$t("gpt_chat_clear"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){t.selectedChannel.messages=[],t.saveChannel()})).catch((function(){}))},enterMsg:function(t){13!==t.keyCode||t.shiftKey||(console.log(" enterMsg isComposing",this.isComposing),this.isComposing||!1!==this.inGenerate||this.sendMessage())},enterNextLine:function(t){13===t.keyCode&&t.shiftKey&&(console.log(" enterNextLine isComposing",this.isComposing),this.isComposing||(this.messageInput+="\n"))},stopGenerate:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.inAdd=!1,this.stop=t,this.inGenerate=!1,this.msgLoading=!1,this.setLastMsg()},sendMessage:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.token?t?(this.addNewMessage("system"),void this.getMessage()):void(this.disableMsg?console.log("禁止发送消息"):(console.log("手动 发送消息",this.messageInput),""!==this.messageInput.trim()&&(this.addNewMessage("user"),this.getMessage()),this.messageInput="")):this.$EventBus.$emit("openLoginDialog")},addNewMessage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user";0===this.channels.length&&this.createChannel();var e=this.createMessage(t,this.selectedChannel.prompts||"");this.selectedChannel.messages.push(e),this.scrollTop("messageWindow"),this.saveChannel()},createMessage:function(t){var content=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e={};return"user"===t||"system"===t?(e={senderId:this.userInfo.id,name:this.userInfo.name,senderAvatar:this.userInfo.head,type:"user"===t?1:2,content:"user"===t?this.messageInput:content},console.log("是否为自动系统消息","system"===t)):"ai"===t&&(this.msgLoading=!0,this.stop=!1,e={senderId:"SeaArt_AI",name:this.$t("SeaArtBot"),senderAvatar:"",type:0,content:""}),new f.a(k({},e))},saveChannel:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log("存消息",this.channels),t&&(this.stop=!0,this.scrollTop("messageWindow")),this.isLoggedIn&&Object(w.b)(this.channels,this.userInfo.id);var e=this.channels.reduce((function(t,e){var n=e.messages.map((function(t){return t.id}));return[].concat(Object(o.a)(t),Object(o.a)(n))}),[]);Object(w.c)(e,this.userInfo.id)},deleteMsg:function(t){console.log("删除消息",t);var e=t.id;this.selectedChannel.messages=this.selectedChannel.messages.filter((function(t){return t.id!==e})),this.saveChannel()},scrollTop:function(t){var e=this;this.$refs[t]&&this.$refs[t].scrollHeight&&this.$nextTick((function(){try{e.$refs[t].scrollTop=e.$refs[t].scrollHeight}catch(t){console.log("scrollTop error",t)}}))},setLastMsg:function(){var t,e=this.selectedChannel;if((null==e||null===(t=e.messages)||void 0===t?void 0:t.length)>0){var n=e.messages[e.messages.length-1];0===n.type&&""===n.content&&(n.content="[Something went wrong]",console.log("已出发兜底"),this.saveChannel())}}}),beforeDestroy:function(){this.setLastMsg()}},x=O,I=(n(2711),Object(v.a)(x,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"chat-work-list flex",class:t.blankState?"justify-center":"justify-between"},[t.blankState?t._e():e("div",{staticClass:"channel-list"},[e("div",{staticClass:"channel-list-title flex justify-center items-center",on:{click:t.createChannel}},[e("el-button",{attrs:{type:"text",icon:"el-icon-plus"}}),t._v(" "),e("span",{staticClass:"text"},[t._v(t._s(t.$t("gpt_new_chat")))])],1),t._v(" "),e("div",{ref:"channelListContent",staticClass:"channel-list-content flex flex-col"},t._l(t.channels,(function(n,o){return e("div",{key:"channels_".concat(o),staticClass:"channel-list-item flex justify-between items-center",class:{selected:t.selectedChannel.channelId===n.channelId},on:{click:function(e){return t.selectChannel(n)}}},[e("div",{directives:[{name:"show",rawName:"v-show",value:!n.editing,expression:"!channel.editing"}],staticClass:"channel-list-item__name"},[t._v(t._s(n.name))]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:n.editing,expression:"channel.editing"}],staticClass:"channel-list-item_input"},[e("el-input",{ref:"Name_"+n.channelId,refInFor:!0,attrs:{placeholder:"Enter new name",maxlength:"30"},on:{click:function(t){t.stopPropagation()},blur:function(e){return t.saveName(n)}},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.saveName(n)}},model:{value:n.name,callback:function(e){t.$set(n,"name",e)},expression:"channel.name"}})],1),t._v(" "),e("div",{staticClass:"flex"},[e("el-button",{staticClass:"chat-item-edit",attrs:{type:"text"},on:{click:function(e){return e.stopPropagation(),t.editName(n)}}},[e("i",{staticClass:"iconfont icon-icon-edit1 svg-edit"})]),t._v(" "),e("el-button",{staticClass:"chat-item-close el-icon-close",attrs:{type:"text"},on:{click:function(e){return e.stopPropagation(),t.deleteChannel(n)}}})],1)])})),0)]),t._v(" "),e("div",{staticClass:"message-window",class:{"no-bg":t.blankState},style:{height:t.msgWinHeight}},[e("div",{ref:"messageWindow",staticClass:"message-list"},[t._l(t.channels,(function(n,o){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.isLoggedIn,expression:"isLoggedIn"}],key:o,staticClass:"messageList"},[t.selectedChannel.channelId===n.channelId?e("ChatWork",{attrs:{channel:n,inGenerate:t.inGenerate,inAdd:t.inAdd,msgLoading:t.msgLoading,stop:t.stop},on:{saveChannel:function(e){return t.saveChannel(!0)},deleteMsg:t.deleteMsg}}):t._e()],1)})),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoggedIn,expression:"!isLoggedIn"}],staticClass:"messageList"},[e("ChatWork",{attrs:{channel:{}}})],1)],2),t._v(" "),e("div",{staticClass:"message-form flex items-end"},[!1===t.stop?e("div",{staticClass:"stop-content flex justify-center items-center"},[e("el-button",{staticClass:"stop-btn flex",attrs:{type:"text"},on:{click:function(e){return t.stopGenerate(!0)}}},[e("span",{staticClass:"flex items-center",staticStyle:{color:"#FF991F","margin-right":"15px"}},[e("i",{staticClass:"iconfont icon-gpt-stop svg-stop",staticStyle:{color:"#FF991F"}}),t._v(" "),e("span",{staticClass:"stop-btn-text"},[t._v(t._s(t.$t("gpt_stop")))])])])],1):t._e(),t._v(" "),e("div",{staticClass:"input-wrapper custom-form flex items-end"},[e("el-input",{staticClass:"msg-input",attrs:{type:"textarea",autosize:{minRows:1,maxRows:5},maxlength:2e3,placeholder:t.$t("gpt_input_placeholder")},on:{compositionstart:function(e){t.isComposing=!0},compositionend:function(e){t.isComposing=!1}},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.enterMsg.apply(null,arguments))},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.enterNextLine.apply(null,arguments)}},model:{value:t.messageInput,callback:function(e){t.messageInput=e},expression:"messageInput"}}),t._v(" "),e("i",{staticClass:"iconfont icon-send1 svg-send",class:{disabled:t.disableMsg},on:{click:function(e){return t.sendMessage(!1)}}})],1)])])])}),[],!1,null,"6b577f6c",null));e.default=I.exports},3321:function(t,e,n){"use strict";n.r(e);n(36),n(14);var o=n(3),r=n(2),l=(n(20),n(9),n(16),n(7),n(19),n(43),n(8),n(11),n(12),n(4),n(23),n(49),n(6),n(76),n(37),n(29),n(1906)),c=n(5),d=n(26),h=n(30),v=n(1),m=n(186),f=n(538),_=n(267),y=n(39),w=n(345),C=n(126),k=n(540),O=n(33),x=n(56);function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var S={name:"tavernCover",mixins:[O.a],components:{DotLoading:l.a,AiChatReport:m.a,DelChatPopup:f.a,CircularLoading:_.a,commentDrawer:w.a,AiChatLast:k.a,CollectPopover:x.a},data:function(){var t=this.$route.params.id;return{formatNumberForeign:c.i,characterId:t,characterCode:1e4,loading:!1,imgLoading:!1,characterInfo:{},lastOff:!1,task_id:null,showCreatChatMask:!1,creatCharacterFail:!1,timer:null,canChat:!0,process:0,createdLoading:!1,historyStack:[],typeKey:"character"}},watch:{$route:function(t,e){var n;this.characterId=null===(n=t.params)||void 0===n?void 0:n.id,this.getAiChatInfo()}},filters:{TimeFormat:function(t){var e=new Date(t),n=(e.getMonth()+1).toString().padStart(2,"0"),o=e.getDate().toString().padStart(2,"0"),r=e.getHours().toString().padStart(2,"0"),l=e.getMinutes().toString().padStart(2,"0");return"".concat(n,"/").concat(o," ").concat(r,":").concat(l)},formatNumberForeign:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(c.i)(t)}},computed:D(D(D(D({},Object(v.c)("user",["isCompanyAccount","isLoggedIn"])),Object(v.e)("user",["token","userInfo"])),Object(v.e)("payment",["paymentInfo"])),{},{createTime:function(){var t;return Object(y.g)(null===(t=this.characterInfo)||void 0===t?void 0:t.create_at)},isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)},isOwner:function(){var t,e,n,o;return!(null===(t=this.characterInfo)||void 0===t||null===(t=t.author)||void 0===t||!t.id||null===(e=this.userInfo)||void 0===e||!e.id)&&(null===(n=this.characterInfo)||void 0===n||null===(n=n.author)||void 0===n?void 0:n.id)===(null===(o=this.userInfo)||void 0===o?void 0:o.id)},isPrivate:function(){return 2===this.characterInfo.publish_status},isNext:function(){var t=this.characterInfo.latest_session;return Boolean(null==t?void 0:t.length)},categories:function(){var t=this.characterInfo.categories;return t.map((function(t){return t.name})).toString()}}),beforeRouteEnter:function(t,e,n){n((function(t){t.historyStack.push(e.fullPath)}))},beforeRouteLeave:function(t,e,n){this.historyStack=this.historyStack.filter((function(path){return path!==e.fullPath})),n()},mounted:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("true"!==t.$route.query.quickChat){e.next=6;break}return e.next=3,t.creatCharacterFn();case 3:t.$EventBus.$emit("characterDetailInfo",{}),e.next=15;break;case 6:return t.characterId=null===(n=t.$route)||void 0===n||null===(n=n.params)||void 0===n?void 0:n.id,e.prev=7,e.next=10,t.getAiChatInfo();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),console.log("数字人详情页mounted-error",e.t0);case 15:t.dotReport();case 16:case"end":return e.stop()}}),e,null,[[7,12]])})))()},beforeDestroy:function(){this.timer&&clearInterval(this.timer),this.$EventBus.$emit("characterDetailInfo",null)},methods:{checkStatus:function(){if(1e4===this.characterCode)return!1;switch(this.characterCode){case 10610:this.$EventBus.$emit("loadComponent",{name:"bannedTipMask2",data:{message:"bannedTipCharter"}});break;case 10621:this.$message({type:"warning",message:this.$t("chatFail"),duration:5e3,offset:100});break;default:console.warn("Unhandled character code: ".concat(this.characterCode))}return!0},updateSession:function(t){if(!this.checkStatus()){var e=t.character_id,n=t.session_id,o=this.localePath("/aiChat/".concat(e,"?s_id=").concat(n));this.$router.push(o)}},handleUpdateCountNum:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.characterInfo=Object.assign({},this.characterInfo,t)},dotReport:function(){var t={action:"view",obj_type:9,obj_no:this.characterId};Object(h.g)({items:[t]})},jumpToUserPage:function(){var t,e=null===(t=this.characterInfo)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id,path=this.isOwner?this.localePath("/personal"):this.localePath("/user/".concat(e));this.$router.push(path)},openCommentModal:function(){var t;this.logEvent("click_chat"),null===(t=this.$refs.commentDrawer)||void 0===t||t.openModal(this.characterInfo)},logEvent:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"on_tavern_detail_page";this.$logEvent("log_actions",{operation:t,behavior_info:e})},handleMark:function(){this.isLoggedIn?(this.logEvent("click_collect"),console.log("this.setCollectData(this.characterInfo)",this.setCollectData(this.characterInfo)),"icon-collect_selected"===this.setCollectData(this.characterInfo)?(this.$refs.collectPopover.visible=!1,this.setCollect(this.characterInfo,this.typeKey)):this.$refs.collectPopover.visible=!0):this.$EventBus.$emit("openLoginDialog")},handleDelete:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$confirm(this.$t("DelAiChatDesc"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){t.removeRole(e)}))},removeRole:function(t){var e=this;Object(C.c)({id:t.id}).then((function(t){var n;if(1e4===(null==t||null===(n=t.status)||void 0===n?void 0:n.code)){try{var o;null===(o=e.$refs.lastChat)||void 0===o||o.goback()}catch(t){}e.$message.success(e.$t("deleteSuccess"))}}))},handleClickRetry:function(){this.timer&&clearInterval(this.timer),this.creatCharacterFail=!1,this.showCreatChatMask=!0,this.creatCharacterFn()},creatCharacterFn:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,r,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=localStorage.getItem("createParams")?JSON.parse(localStorage.getItem("createParams")):null,console.log("创建数字人---",n),n){e.next=4;break}return e.abrupt("return");case 4:return t.canChat=!1,e.next=7,Object(d.B)({cover:{id:n.id,url:n.url,width:n.width,height:n.height},source_id:n.id,source_account_id:n.source_account_id,channel:n.channel||"artwork"});case 7:if(r=e.sent,r.status,null==(data=r.data)||!data.character_id){e.next=16;break}return t.canChat=!0,t.characterId=(null==data?void 0:data.character_id)||t.characterId,e.next=14,t.getAiChatInfo(t.characterId,!0);case 14:e.next=19;break;case 16:t.showCreatChatMask=!0,t.canChat=!1,t.timer=setInterval(Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getCreatProgressFn(null==data?void 0:data.task_id);case 2:case"end":return e.stop()}}),e)}))),2e3);case 19:case"end":return e.stop()}}),e)})))()},getCreatProgressFn:function(){var t=arguments,e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,h,data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.length>0&&void 0!==t[0]?t[0]:null){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,n.next=6,Object(d.C)({task_id:o});case 6:if(r=n.sent,l=r.status,c=void 0===l?{}:l,h=r.data,data=void 0===h?{}:h,1e4!==(null==c?void 0:c.code)){n.next=17;break}if(e.process=null==data?void 0:data.progress,5===(null==data?void 0:data.status)&&(e.process=0,e.canChat=!1,e.creatCharacterFail=!0,e.timer&&clearInterval(e.timer)),100!==(null==data?void 0:data.progress)||1!==(null==data?void 0:data.status)||null==data||!data.character_id){n.next=17;break}return e.characterId=null==data?void 0:data.character_id,e.canChat=!0,e.timer&&clearInterval(e.timer),n.next=17,e.getAiChatInfo(e.characterId,!0);case 17:n.next=26;break;case 19:n.prev=19,n.t0=n.catch(3),console.log("error",n.t0),e.process=0,e.canChat=!1,e.creatCharacterFail=!0,e.timer&&clearInterval(e.timer);case 26:case"end":return n.stop()}}),n,null,[[3,19]])})))()},goCreatedSame:function(t){if(t){var e=this.localePath("/cyberPubPage/new-character?id=".concat(t,"&sameStyle=1"));this.isLoggedIn?this.$router.push(e):this.$EventBus.$emit("openLoginDialog",{redirect:e})}},openDelPopup:function(t){var e=this,n=this.characterInfo.latest_session[t].session_id;this.$refs.delChatPopup.open(n,(function(){e.characterInfo.latest_session.splice(t,1)}))},openReport:function(){this.$logEvent("log_actions",{operation:"tavern_on_detail_page",behavior_info:"click_report"}),this.$refs.aiChatReport.open()},updateBg:function(t){this.$emit("updateBg",{backgroundUrl:Object(c.x)(null==t?void 0:t.url,"high"),width:null==t?void 0:t.width,height:null==t?void 0:t.height})},getAiChatInfo:function(){var t=arguments,e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,data,h,v,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=t.length>0&&void 0!==t[0]?t[0]:e.characterId,r=t.length>1&&void 0!==t[1]&&t[1],e.loading=!0,e.imgLoading=!1,n.prev=4,n.next=7,Object(d.q)({id:o});case 7:if(l=n.sent,c=l.status,data=l.data,e.characterCode=c.code||1e4,e.characterInfo=data,h=l.data.vision,v=h.bg,m=h.character,e.$EventBus.$emit("characterDetailInfo",e.characterInfo),!r&&e.updateBg(null!=v&&v.url?v:m),n.t0=r,!n.t0){n.next=18;break}return n.next=18,e.goChat(0);case 18:e.loading=!1,n.next=24;break;case 21:n.prev=21,n.t1=n.catch(4),e.loading=!1;case 24:e.checkStatus();case 25:case"end":return n.stop()}}),n,null,[[4,21]])})))()},goChat:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,h,v,m,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.canChat||"true"!==e.$route.query.quickChat){n.next=3;break}return e.$message.warning(e.$t("createChartacterFail")),n.abrupt("return");case 3:if(o=e.characterId,r=e.characterInfo,r.vip_only,l=r.latest_session,c=e.paymentInfo,h=c.tempCoins,v=c.calculateCoins,!(t>-1&&l.length&&l[t])){n.next=11;break}return f=null===(m=l[t])||void 0===m?void 0:m.session_id,e.toAiChat(o,f),n.abrupt("return");case 11:if(e.loading=!0,!e.isLoggedIn){n.next=15;break}return Object(d.g)({character_id:o,mask:""}).then((function(t){var n=t.data.session_id;e.toAiChat(o,n),e.showCreatChatMask=!1})).finally((function(){e.loading=!1})),n.abrupt("return");case 15:e.toAiChat(o,"");case 16:case"end":return n.stop()}}),n)})))()},toAiChat:function(t,e){var n={s_id:e},o=this.localePath("/cyberPubPage/".concat(t));this.$router.replace({path:o,query:{}}),this.$router.push(this.localePath({path:"/aiChat/"+t,query:n}))},edit:function(){this.$router.push(this.localePath("/cyberPubPage/new-character?id="+this.characterId))},share:function(){this.$logEvent("log_actions",{operation:"tavern_on_detail_page",behavior_info:"click_share"}),Object(c.d)(location.href),this.$message.success(this.$t("CopiedURLToClipboard"))}},head:function(){var t=this.characterInfo,e=(t.id,t.name),n=t.evaluation,o=t.categories,r=t.cover,l=t.vision||{},c=o?o.map((function(t){return t.name})).toString():"",title=this.$t("CyberPubDetailsTitle",{name:e}),d=this.$t("CyberPubDetailsDesc",{name:e,desc:n});return{title:title,meta:[{hid:"description",name:"description",content:d},{hid:"keywords",name:"keywords",content:"".concat(e,",").concat(c)},{hid:"og:title",name:"og:title",content:title},{hid:"og:description",name:"og:description",content:d},{hid:"og:image",name:"og:image",content:(null==r?void 0:r.url)||(null==l?void 0:l.url)}]}}},P=S,L=(n(2683),n(2684),n(0)),component=Object(L.a)(P,(function(){var t,e,n,o,r,l,c,d,h,v,m,f,_,y=this,w=y._self._c;return w("div",{staticClass:"aichat-cover",class:{"full-cover":!(null!==(t=y.characterInfo)&&void 0!==t&&null!==(t=t.vision)&&void 0!==t&&null!==(t=t.bg)&&void 0!==t&&t.url)}},[w("ai-chat-last",{ref:"lastChat",attrs:{historyStack:y.historyStack,characterInfo:y.characterInfo,characterId:y.characterId,"only-back":!0,fromPage:"chatDetail"},on:{updateSession:y.updateSession}}),y._v(" "),w("div",{staticClass:"figure-img flex-center",class:{"show-img":y.imgLoading}},[null!==(e=y.characterInfo)&&void 0!==e&&null!==(e=e.vision)&&void 0!==e&&null!==(e=e.character)&&void 0!==e&&e.url?w("img",{directives:[{name:"webp",rawName:"v-webp",value:y.$imgH,expression:"$imgH"}],attrs:{src:null===(n=y.characterInfo)||void 0===n||null===(n=n.vision)||void 0===n||null===(n=n.character)||void 0===n?void 0:n.url,alt:y.categories+","+y.characterInfo.evaluation},on:{load:function(t){y.imgLoading=!0}}}):y._e()]),y._v(" "),y.showCreatChatMask?y._e():w("div",{staticClass:"figure-info"},[w("div",{staticClass:"info-panel"},[w("div",{staticClass:"info-title"},[w("h1",{attrs:{title:null===(o=y.characterInfo)||void 0===o?void 0:o.name}},[y._v(y._s(null===(r=y.characterInfo)||void 0===r?void 0:r.name))])]),y._v(" "),w("div",{staticClass:"info-by"},[y._v("\n        @ "),w("span",{on:{click:y.jumpToUserPage}},[y._v(y._s(null===(l=y.characterInfo)||void 0===l||null===(l=l.author)||void 0===l?void 0:l.name))])]),y._v(" "),w("div",{staticClass:"info-num"},[w("i",{staticClass:"iconfont icon-users-solid info-num-icon"}),y._v("\n        "+y._s(y._f("formatNumberForeign")((null===(c=y.characterInfo)||void 0===c||null===(c=c.stat)||void 0===c?void 0:c.num_of_token)||0))+"\n        "),w("span",{directives:[{name:"show",rawName:"v-show",value:y.createTime,expression:"createTime"}],staticClass:"info-num-time"},[y._v(y._s(y.$t("createdOn"))+y._s(y.createTime))])]),y._v(" "),w("div",{staticClass:"info-tag"},y._l(null===(d=y.characterInfo)||void 0===d?void 0:d.categories,(function(t){return w("span",{key:"tag_"+t.id},[y._v(y._s(t.name))])})),0),y._v(" "),w("div",{staticClass:"info-desc hide-scrollbar"},[y._v("\n        "+y._s(null===(h=y.characterInfo)||void 0===h?void 0:h.evaluation)+"\n      ")]),y._v(" "),w("div",{staticClass:"info-handle"},[w("span",{staticClass:"comment-btn"},[w("i",{staticClass:"iconfont icon-browse comment-btn-icon"}),y._v(" "),w("span",{staticClass:"comment-btn-text"},[y._v(y._s(y._f("formatNumberForeign")(null===(v=y.characterInfo)||void 0===v||null===(v=v.stat)||void 0===v?void 0:v.num_of_view)))])]),y._v(" "),w("span",{staticClass:"comment-btn",on:{click:function(t){return t.stopPropagation(),y.openCommentModal.apply(null,arguments)}}},[w("i",{staticClass:"iconfont icon-comment comment-btn-icon"}),y._v(" "),w("span",{staticClass:"comment-btn-text"},[y._v(y._s(y._f("formatNumberForeign")(null===(m=y.characterInfo)||void 0===m||null===(m=m.stat)||void 0===m?void 0:m.num_of_comment)))])]),y._v(" "),w("span",{staticClass:"comment-btn collect-btn",on:{click:function(t){return t.stopPropagation(),y.handleMark.apply(null,arguments)}}},[w("client-only",[w("CollectPopover",{ref:"collectPopover",attrs:{triggerMode:"click",hideBtn:!0,type:y.typeKey,folder:y.characterInfo}},[w("span",{staticClass:"comment-btn-icon iconfont",class:"".concat(y.setCollectData(y.characterInfo))})])],1),y._v(" "),w("span",{staticClass:"comment-btn-text"},[y._v(y._s(y._f("formatNumberForeign")(null===(f=y.characterInfo)||void 0===f||null===(f=f.stat)||void 0===f?void 0:f.num_of_collection)))])],1),y._v(" "),w("el-popover",{attrs:{"popper-class":"popper-ai-chat-cover",placement:"bottom",width:"120",trigger:"hover"}},[w("div",{staticClass:"pop-btns flex"},[y.isOwner?w("button",{on:{click:y.edit}},[y._v("\n              "+y._s(y.$t("Edit"))+"\n            ")]):y._e(),y._v(" "),y.isOwner?w("button",{on:{click:function(t){return y.handleDelete(y.characterInfo)}}},[y._v("\n              "+y._s(y.$t("Delete"))+"\n            ")]):y._e(),y._v(" "),w("button",{on:{click:y.openReport}},[y._v("\n              "+y._s(y.$t("Report"))+"\n            ")])]),y._v(" "),w("div",{staticClass:"more-box",attrs:{slot:"reference"},slot:"reference"},[w("i",{staticClass:"el-icon-more"})])])],1)]),y._v(" "),w("div",{staticClass:"handle-btn"},[w("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:y.$t("Share"),placement:"top-start"}},[w("i",{directives:[{name:"show",rawName:"v-show",value:!y.isPrivate,expression:"!isPrivate"}],staticClass:"iconfont icon-icon_share",on:{click:y.share}})]),y._v(" "),w("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:y.$t("Edit"),placement:"top-start"}},[y.isOwner?w("i",{staticClass:"el-icon-edit",on:{click:y.edit}}):y._e()]),y._v(" "),!y.isPrivate||y.isOwner?w("div",{staticClass:"start-btn",class:{"next-btn":y.isNext,"off-btn":y.lastOff},on:{click:function(t){return y.goChat(0)}}},[y._v("\n        "+y._s(y.loading?"":y.$t(y.isNext?"NextAiChat":"StartChat"))+"\n        "),y.loading?w("dot-loading"):y._e(),y._v(" "),y.isNext?w("span",{staticClass:"zoom",on:{click:function(t){t.stopPropagation(),y.lastOff=!y.lastOff}}},[w("i",{staticClass:"el-icon-arrow-down"})]):y._e(),y._v(" "),y.isNext?w("div",{staticClass:"last-list"},[w("div",{staticClass:"list-scroll hide-scrollbar"},y._l(null===(_=y.characterInfo)||void 0===_?void 0:_.latest_session,(function(t,i){return w("div",{key:t.session_id,staticClass:"last-item overflow-ellipsis",on:{click:function(t){return t.stopPropagation(),y.goChat(i)}}},[t.name?w("span",[y._v(y._s(t.name))]):w("span",[y._v(y._s(y._f("TimeFormat")(t.create_at)))]),y._v(" "),w("i",{staticClass:"el-icon-error",on:{click:function(t){return t.stopPropagation(),y.openDelPopup(i)}}})])})),0),y._v(" "),w("div",{staticClass:"last-item",on:{click:function(t){return t.stopPropagation(),y.goChat(-1)}}},[w("i",{staticClass:"el-icon-plus"}),y._v("\n            "+y._s(y.$t("StartNewChat"))+"\n          ")])]):y._e()],1):y._e()],1)]),y._v(" "),w("ai-chat-report",{ref:"aiChatReport",attrs:{aiChatId:y.characterId}}),y._v(" "),w("del-chat-popup",{ref:"delChatPopup"}),y._v(" "),y.showCreatChatMask?w("div",{staticClass:"loading-overlay"},[y.creatCharacterFail?y._e():w("div",{staticClass:"create-loading"},[w("CircularLoading",{attrs:{font:16,process:y.process,circleWH:78}}),y._v(" "),w("div",{staticClass:"loading-tip"},[100===y.process?w("span",[y._v(y._s(y.$t("aboutToStart")))]):[w("span",[y._v(y._s(y.$t("createChartacterLoading").slice(0,y.$t("createChartacterLoading").indexOf("..."))))]),y._v(" "),w("span",{staticClass:"loading-tip-animo"})]],2)],1),y._v(" "),y.creatCharacterFail?w("div",{staticClass:"create-err"},[w("svg-icon",{attrs:{"icon-class":"create-chat-fail"}}),y._v(" "),w("span",{staticClass:"tip"},[y._v(y._s(y.$t("createChartacterFail")))]),y._v(" "),w("div",{staticClass:"btn-box custom-btn-create"},[w("el-button",{on:{click:function(t){return t.stopPropagation(),y.$router.go(-1)}}},[y._v(y._s(y.$t("Return")))]),y._v(" "),w("el-button",{attrs:{type:"primary"},on:{click:function(t){return t.stopPropagation(),y.handleClickRetry.apply(null,arguments)}}},[y._v(y._s(y.$t("up_retry")))])],1)],1):y._e()]):y._e(),y._v(" "),w("comment-drawer",{ref:"commentDrawer",on:{updateCountNum:y.handleUpdateCountNum}})],1)}),[],!1,null,"5160027e",null);e.default=component.exports},3322:function(t,e,n){"use strict";n.r(e);n(14),n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),r=n(1),l=n(534),c=n(30);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var v={components:{Header:l.a},data:function(){return{toolsCurrentTab:"AIFilter",videoSrc:"",modelImgUrl:"",isShowLoginCard:!0}},mounted:function(){var t=this;this.$EventBus.$on("loginPopupStatus",(function(e){t.isShowLoginCard=!e})),this.token&&this.$router.push(this.localePath("/")),this.getData()},beforeDestroy:function(){this.$EventBus.$off("loginPopupStatus")},computed:h(h(h({},Object(r.c)("user",["cdnHostFun"])),Object(r.e)("user",["cdnHost","token"])),{},{toolsTabs:function(){return[{name:"AIFilter",tabTitle:"ai_tools_4",tabDesc:"ai_tools_8",video:"https://".concat(this.cdnHost,"/static/video/AITool/AIFilterv2.mp4"),img:n(448),title:"ai_tools_4",desc:"PublicizeToolsDescFour"},{name:"HDRepair",tabTitle:"taskTabUpscale",tabDesc:"ai_tools_5",video:"https://".concat(this.cdnHost,"/static/video/AITool/HDrepair.mp4"),img:n(445),title:"taskTabUpscale",desc:"PublicizeToolsDescOne"},{name:"DraftIntoDrawing",tabTitle:"ai_tools_3",tabDesc:"ai_tools_7",video:"https://".concat(this.cdnHost,"/static/video/AITool/draftToImgv2.mp4"),img:n(447),title:"ai_tools_3",desc:"PublicizeToolsDescThree"},{name:"RemoveBackground",tabTitle:"RemoveBackground",tabDesc:"ai_tools_6",video:"https://".concat(this.cdnHost,"/static/video/AITool/removeBackgroundv2.mp4"),img:n(446),title:"RemoveBackground",desc:"PublicizeToolsDescTwo"}]},getPageFiveStyle:function(){return{backgroundImage:"url(https://".concat(this.cdnHost,"/static/upload/20231120/a1c58da3-3116-47b8-93f7-d0a3863fef7e.webp)")}}}),methods:{getData:function(){var t=this;Object(c.j)().then((function(e){var n=(e||{}).data,o=void 0===n?{demo_video:"",recommend_model_img:""}:n,r=o.demo_video,l=o.recommend_model_img;t.videoSrc=r,t.modelImgUrl=l}))},btnClick:function(t){var e=this;switch(this.$logEvent("log_actions",{operation:"click_start_free_trial_button",behavior_info:"visitor_landing_page",behavior_info_sub:["first_page","second_page","third_page","fourth_page"][t-1]}),t){case 1:this.$EventBus.$emit("openGenerate",{action:1,data:{}});break;case 2:this.$EventBus.$emit("openLoginDialog",{redirect:"/home?toModel=1"});break;case 3:this.$EventBus.$emit("openLoginDialog",{callBack:function(){e.$EventBus.$emit("openGenerate",{action:1,data:{openType:"SIMPLE"}})}});break;case 4:this.$EventBus.$emit("openLoginDialog",{redirect:"/fastTools"})}}}},m=(n(2685),n(0)),component=Object(m.a)(v,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"landing-page"},[e("Header"),t._v(" "),e("div",{staticClass:"page-one"},[e("div",{staticClass:"top"},[e("div",{staticClass:"title"},[e("span",{staticClass:"words"},[t._v(t._s(t.$t("LandingPage1Title")))])]),t._v(" "),e("div",{staticClass:"sub-title"},[t._v(t._s(t.$t("LandingPage1SubTitle")))])]),t._v(" "),e("div",{staticClass:"video-box"},[e("video",{staticClass:"video",attrs:{autoplay:"",muted:"",loop:"",controls:"",src:t.videoSrc},domProps:{muted:!0}})]),t._v(" "),e("el-button",{staticClass:"btn",on:{click:function(e){return t.btnClick(1)}}},[t._v("\n\t\t\t"+t._s(t.$t("StartFreeTrial"))+"\n\t\t\t"),e("i",{staticClass:"el-icon-right"})])],1),t._v(" "),e("div",{staticClass:"page-two"},[e("div",{staticClass:"left"},[e("div",{staticClass:"box"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t("LandingPage2Title")))]),t._v(" "),e("div",{staticClass:"sub-title"},[t._v(t._s(t.$t("LandingPage2SubTitle")))]),t._v(" "),e("el-button",{staticClass:"btn",on:{click:function(e){return t.btnClick(2)}}},[t._v("\n\t\t\t\t\t"+t._s(t.$t("StartFreeTrial"))+"\n\t\t\t\t\t"),e("i",{staticClass:"el-icon-right"})])],1)]),t._v(" "),e("div",{staticClass:"right"},[e("img",{staticClass:"img",attrs:{src:t.modelImgUrl,alt:"models"}})])]),t._v(" "),e("div",{staticClass:"page-three"},[e("div",{staticClass:"img-box"},[e("img",{staticClass:"img",attrs:{src:"https://".concat(t.cdnHostFun(),"/static/upload/20231118/d776404c-16d9-40ea-b7e1-cda4badfc4de.png"),alt:"models"}})]),t._v(" "),e("div",{staticClass:"content"},[e("div",{staticClass:"box"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t("LandingPage3Title")))]),t._v(" "),e("div",{staticClass:"sub-title"},[t._v(t._s(t.$t("LandingPage3SubTitle")))]),t._v(" "),e("el-button",{staticClass:"btn",on:{click:function(e){return t.btnClick(3)}}},[t._v("\n\t\t\t\t\t"+t._s(t.$t("StartFreeTrial"))+"\n\t\t\t\t\t"),e("i",{staticClass:"el-icon-right"})])],1)])]),t._v(" "),e("div",{staticClass:"page-four"},[e("div",{staticClass:"tabs"},t._l(t.toolsTabs,(function(n){return e("div",{key:n.name,staticClass:"item-tab",class:{active:t.toolsCurrentTab===n.name},on:{click:function(e){t.toolsCurrentTab=n.name}}},[e("div",{staticClass:"content"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t(n.tabTitle)))]),t._v(" "),e("div",{staticClass:"desc"},[t._v(t._s(t.$t(n.tabDesc)))])])])})),0),t._v(" "),t._l(t.toolsTabs,(function(n){return[e("div",{directives:[{name:"show",rawName:"v-show",value:t.toolsCurrentTab===n.name,expression:"toolsCurrentTab === item.name"}],key:n.name,staticClass:"content",class:{animate:t.toolsCurrentTab===n.name}},[e("div",{staticClass:"left"},[e("video",{staticClass:"video",attrs:{autoplay:"",muted:"",loop:"",controls:"",src:n.video},domProps:{muted:!0}})]),t._v(" "),e("div",{staticClass:"right"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t(n.title)))]),t._v(" "),e("div",{staticClass:"desc"},[t._v(t._s(t.$t(n.desc)))]),t._v(" "),e("el-button",{staticClass:"btn",on:{click:function(e){return t.btnClick(4)}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.$t("StartFreeTrial"))+"\n\t\t\t\t\t\t"),e("i",{staticClass:"el-icon-right"})])],1)])]}))],2),t._v(" "),e("div",{staticClass:"page-five",style:t.getPageFiveStyle},[e("div",{staticClass:"mask"},[e("LoginCard",{directives:[{name:"show",rawName:"v-show",value:t.isShowLoginCard,expression:"isShowLoginCard"}],attrs:{redirect:"/home",isShowCloseIcon:!1,isAutoFoucs:!1}})],1)])],1)}),[],!1,null,"a10f0362",null);e.default=component.exports},3323:function(t,e,n){"use strict";n.r(e);n(14),n(9),n(11),n(12);var o=n(97),r=n(3),l=n(2),c=(n(20),n(7),n(32),n(10),n(19),n(8),n(4),n(18),n(6),n(1)),d=n(167),h=["content"];function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={name:"ChatAI",components:{PageSeo:d.a},data:function(){return{activeTab:"person",tabs:[{name:"chat",label:this.$t("gpt_tab_chat"),active:!1,route:"/chat"},{name:"tip",label:this.$t("gpt_tab_tip"),active:!1,route:"/chat/theme"},{name:"star",label:this.$t("gpt_tab_star"),active:!1,route:"/chat/star"},{name:"person",label:this.$t("gpt_tab_person"),active:!0,route:"/chat/person"}],channelData:null,pageSeo:{title:"",meta_description:"",key_words:"",tempList:[]}}},mounted:function(){this.initTab(),this.$EventBus.$on("create-channel",this.handleNewChannel)},beforeDestroy:function(){this.$EventBus.$off("create-channel",this.handleNewChannel)},computed:m(m(m({},Object(c.e)("user",["userInfo","token"])),Object(c.c)("user",["isLoggedIn"])),{},{showPerson:function(){var t;return null===(t=this.userInfo)||void 0===t?void 0:t.enable_gf},tabList:function(){var t;return null!==(t=this.userInfo)&&void 0!==t&&t.enable_gf?this.tabs:this.tabs.filter((function(t){return"person"!==t.name}))}}),methods:m(m({},Object(c.d)("chatgpt",["setSelectSubject"])),{},{initTab:function(){var t=this,e=this.$route.name.split("_")[0],n={ChatWorkList:"chat",SubjectTip:"tip",StartedChat:"star",AiPerson:"person"};Object.keys(n).includes(e)?(this.activeTab=n[e],"person"!==this.activeTab||this.showPerson||(this.activeTab="chat")):this.activeTab="chat",this.tabs.find((function(e){return e.name===t.activeTab})).active=!0},toggleTabs:function(t){this.isLoggedIn||"chat"===t.name?(this.activeTab=t.name,this.channelData=null,this.tabs.forEach((function(e){e.active=e.name===t.name})),t.route&&this.$router.push(this.localePath(t.route))):this.$EventBus.$emit("openLoginDialog")},handleNewChannel:function(data){this.activeTab="chat",this.setSelectSubject(data),this.$router.push(this.localePath("/chat")),this.channelData=data}}),head:function(){var t=this.pageSeo,title=t.title,e=t.meta_description,n=t.key_words;title=this.$t(title||"chat_tag_title");var desc=this.$t(e||"chat_tag_desc");return{title:title,meta:[{hid:"description",name:"description",content:desc},{hid:"keywords",name:"keywords",content:this.$t(n)},{hid:"og:title",name:"og:title",content:title},{hid:"og:description",name:"og:description",content:desc}]}},asyncData:function(t){return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,l,data,c,d,v,title,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$axios,t.app,t.params,r=t.error,t.route,e.prev=2,e.next=5,n.$post("/api/v1/fast_ai/detail",{name:"ai-chat"});case 5:return l=e.sent,data=l.data,c=data.module,d=data.key_words,v=data.meta_description,title=data.title,f=null!=c&&c.length?null==data?void 0:data.module.map((function(t){var content=t.content;return m(m({},Object(o.a)(t,h)),{},{content:JSON.parse(content)})})):[],e.abrupt("return",{pageSeo:{title:title,meta_description:v,key_words:d,tempList:f}});case 12:e.prev=12,e.t0=e.catch(2),console.log("aiChat详情页-> asyncData错误啦：",e.t0),r({statusCode:404,message:e.t0});case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))()}},_=f,y=(n(2706),n(0)),component=Object(y.a)(_,(function(){var t,e,o=this,r=o._self._c;return r("div",{staticClass:"chat-gpt flex"},[r("div",{staticClass:"chat-tabs flex flex-col items-center"},o._l(o.tabList,(function(t,i){return r("el-button",{key:"chatTab".concat(i),staticClass:"tab-btn",class:{active:t.name===o.activeTab},attrs:{round:""},on:{click:function(e){return o.toggleTabs(t)}}},[r("span",{staticClass:"flex flex-col items-center"},[t.name===o.activeTab?r("img",{staticClass:"tab-img",attrs:{src:n(3220)("./".concat(t.name,"-active.png")),alt:""}}):r("img",{staticClass:"tab-img",attrs:{src:n(3221)("./".concat(t.name,".png")),alt:""}}),o._v(" "),r("span",{staticClass:"tab-name"},[o._v(o._s(t.label))])])])})),1),o._v(" "),r("div",{staticClass:"chat-content"},[r("keep-alive",[r("router-view")],1),o._v(" "),null!==(t=o.pageSeo)&&void 0!==t&&t.tempList.length?r("page-seo",{attrs:{tempList:null===(e=o.pageSeo)||void 0===e?void 0:e.tempList}}):o._e()],1)])}),[],!1,null,"beaadf54",null);e.default=component.exports},3324:function(t,e,n){"use strict";n.r(e);var o=n(2),r=(n(43),n(8),n(9),n(7),n(11),n(12),n(4),n(110),n(6),n(2712));function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d={name:"SubjectTip",data:function(){return{myFavorite:[],myCreate:[],ThemeList:r.a,dialogVisible:!1,addVisible:!1,checkPop:{},tempCheckPop:{},gptPromptsLits:JSON.parse(localStorage.getItem("gptPromptsLits"))||[],gptLikePromptsList:JSON.parse(localStorage.getItem("gptLikePromptsList"))||[],formLabelAlign:{title:"",subTitle:"",prompts:"",color:"",bgColor:"",icon:"",isUserAdd:!0},rules:{title:[{required:!0,message:this.$t("gptRulesTite"),trigger:"blur"},{validator:this.validateSpaces,trigger:"blur"}],prompts:[{required:!0,message:this.$t("gptRulesPop"),trigger:"blur"},{validator:this.validateSpaces,trigger:"blur"}]},colorList:[{color:"#EAB308",bgColor:"rgba(234,179,8,0.2)"},{color:"#D946EF",bgColor:"rgba(217,70,239,0.2)"},{color:"#F43F5E",bgColor:"rgba(244,63,94,0.2)"},{color:"#6266F1",bgColor:"rgba(98,102,241,0.2)"},{color:"#13B8A6",bgColor:"rgba(19,184,166,0.2)"},{color:"#84CC16",bgColor:"rgba(0,182,212,0.2)"},{color:"#EC4898",bgColor:"rgba(236,72,152,0.2)"},{color:"#3B82F6",bgColor:"rgba(59,130,246,0.2)"},{color:"#05B6D4",bgColor:"rgba(5,182,212,0.2)"},{color:"#F59E0B",bgColor:"rgba(245,158,11,0.2)"},{color:"#10B981",bgColor:"rgba(16,185,129,0.2)"},{color:"#A855F7",bgColor:"rgba(168,85,247,0.2)"},{color:"#22C55E",bgColor:"rgba(34,197,94,0.2)"},{color:"#EF4444",bgColor:"rgba(239,68,68,0.2)"},{color:"#8B5CF6",bgColor:"rgba(139,92,246,0.2)"}]}},watch:{addVisible:{handler:function(t){t||(this.formLabelAlign={title:"",subTitle:"",prompts:"",color:"",bgColor:"",icon:"",isUserAdd:!0})}}},computed:{setCollectIcon:function(){return function(t){var e=!1;return this.gptLikePromptsList.forEach((function(n){t.title==n.title&&(e=!0)})),e?"icon-collect_selected":"icon-collect"}}},created:function(){var t=this;this.gptPromptsLits.forEach((function(e){e.isUserAdd||(e.isUserAdd=!0),t.gptLikePromptsList.forEach((function(t){e.title==t.title&&(t.isUserAdd||(t.isUserAdd=!0))}))}))},mounted:function(){},methods:{onApp:function(){this.$EventBus.$emit("create-channel",c({},this.checkPop)),this.resetPrompts()},submitForm:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(!e)return!1;if(t.colorList.forEach((function(e,n){e.bgColor==t.formLabelAlign.bgColor&&(t.formLabelAlign.color=e.color)})),!t.formLabelAlign.bgColor){var n=Math.floor(15*Math.random())+1;t.formLabelAlign.bgColor=t.colorList[n].bgColor,t.formLabelAlign.color=t.colorList[n].color}t.formLabelAlign.icon="gpt-"+(Math.floor(10*Math.random())+1);var o=JSON.parse(localStorage.getItem("gptPromptsLits"))||[],r=!0;o.forEach((function(e){e.title==t.formLabelAlign.title&&(t.$message({message:t.$t("gptAddRepeat"),type:"warning"}),r=!1)})),r&&(o.push(t.formLabelAlign),localStorage.setItem("gptPromptsLits",JSON.stringify(o)),t.addVisible=!1,t.gptPromptsLits=JSON.parse(localStorage.getItem("gptPromptsLits"))||[])}))},selectItem:function(t){var e=c(c({},t),{},{prompts:this.$t(t.prompts)});this.checkPop=e,this.dialogVisible=!0,this.tempCheckPop=c({},e)},resetPrompts:function(){this.checkPop.prompts=this.tempCheckPop.prompts,this.dialogVisible=!1},onLike:function(t){var e=JSON.parse(localStorage.getItem("gptLikePromptsList"))||[],n=!0,o=-1;e.forEach((function(e,r){e.title==t.title&&(n=!1,o=r)})),n?e.push(t):o>-1&&e.splice(o,1),localStorage.setItem("gptLikePromptsList",JSON.stringify(e)),this.gptLikePromptsList=JSON.parse(localStorage.getItem("gptLikePromptsList"))||[]},onDelete:function(t){var e=this;this.$confirm(this.$t("gptDeleteSure"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),customClass:"collectConfirm",type:"warning"}).then((function(){var n=-1,o=-1;e.gptLikePromptsList.forEach((function(e,o){e.title==t.title&&(n=o)})),n>-1&&(e.gptLikePromptsList.splice(n,1),localStorage.setItem("gptLikePromptsList",JSON.stringify(e.gptLikePromptsList))),e.gptPromptsLits.forEach((function(e,n){e.title==t.title&&(o=n)})),o>-1&&(e.gptPromptsLits.splice(o,1),localStorage.setItem("gptPromptsLits",JSON.stringify(e.gptPromptsLits))),e.dialogVisible=!1})).catch((function(){}))},validateSpaces:function(t,e,n){e&&""===e.trim()?n(new Error(this.$t("gptRulesSpace"))):n()}}},h=(n(2713),n(2714),n(0)),component=Object(h.a)(d,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"SubjectTip"},[e("div",{staticClass:"cnt"},[t.gptLikePromptsList.length>0?e("div",{staticClass:"row"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t("MyCollection")))]),t._v(" "),e("div",{staticClass:"subTitle"},[t._v(t._s(t.$t("AIlikeSub")))]),t._v(" "),e("div",{staticClass:"list"},t._l(t.gptLikePromptsList,(function(n,o){return e("div",{key:o,staticClass:"cell",on:{click:function(e){return t.selectItem(n)}}},[e("div",{staticClass:"item",style:{backgroundColor:n.bgColor,color:n.color}},[e("div",{staticClass:"collect",on:{click:function(e){return e.stopPropagation(),t.onLike(n)}}},[e("i",{staticClass:"iconfont",class:t.setCollectIcon(n)})]),t._v(" "),e("div",{staticClass:"iconBox"},[e("i",{staticClass:"iconfont",class:"icon-".concat(n.icon),style:{color:n.color}})]),t._v(" "),e("div",{staticClass:"prompTitle"},[t._v(t._s(t.$t(n.title)))])])])})),0)]):t._e(),t._v(" "),t.gptPromptsLits.length>0?e("div",{staticClass:"row"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t("MyThemes")))]),t._v(" "),e("div",{staticClass:"subTitle"},[t._v(t._s(t.$t("MyThemesSub")))]),t._v(" "),e("div",{staticClass:"list"},t._l(t.gptPromptsLits,(function(n,o){return e("div",{key:o,staticClass:"cell",on:{click:function(e){return t.selectItem(n)}}},[e("div",{staticClass:"item",style:{backgroundColor:n.bgColor,color:n.color}},[e("div",{staticClass:"collect",on:{click:function(e){return e.stopPropagation(),t.onLike(n)}}},[e("i",{staticClass:"iconfont",class:t.setCollectIcon(n)})]),t._v(" "),e("div",{staticClass:"iconBox"},[e("i",{staticClass:"iconfont",class:"icon-".concat(n.icon),style:{color:n.color}})]),t._v(" "),e("div",{staticClass:"prompTitle"},[t._v(t._s(t.$t(n.title)))])])])})),0)]):t._e(),t._v(" "),t._l(t.ThemeList,(function(n,o){return e("div",{key:o,staticClass:"row"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t(n.title)))]),t._v(" "),e("div",{staticClass:"subTitle"},[t._v(t._s(t.$t(n.subTitle)))]),t._v(" "),e("div",{staticClass:"list"},t._l(n.list,(function(n,o){return e("div",{key:o,staticClass:"cell",on:{click:function(e){return t.selectItem(n)}}},[e("div",{staticClass:"item",style:{backgroundColor:n.bgColor,color:n.color}},[e("div",{staticClass:"collect",on:{click:function(e){return e.stopPropagation(),t.onLike(n)}}},[e("i",{staticClass:"iconfont",class:t.setCollectIcon(n)})]),t._v(" "),e("div",{staticClass:"iconBox"},[e("i",{staticClass:"iconfont",class:"icon-".concat(n.icon),style:{color:n.color}})]),t._v(" "),e("div",{staticClass:"prompTitle"},[t._v(t._s(t.$t(n.title)))])])])})),0)])}))],2),t._v(" "),e("el-dialog",{attrs:{"close-on-click-modal":!1,visible:t.dialogVisible,width:"600px","custom-class":"SaDialog"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.resetPrompts}},[e("div",{staticClass:"main"},[e("div",{staticClass:"head"},[e("i",{staticClass:"iconfont",class:"icon-".concat(t.checkPop.icon)}),t._v(" "),e("div",{staticClass:"tit"},[t._v(t._s(t.$t(t.checkPop.title)))]),t._v(" "),t.checkPop.subTitle?e("div",{staticClass:"subTit"},[t._v(t._s(t.checkPop.subTitle))]):t._e()]),t._v(" "),e("div",{staticClass:"inputBox"},[e("el-input",{attrs:{type:"textarea",placeholder:t.$t("gptRulesPop"),maxlength:"2000","show-word-limit":""},model:{value:t.checkPop.prompts,callback:function(e){t.$set(t.checkPop,"prompts",e)},expression:"checkPop.prompts"}})],1),t._v(" "),t.checkPop.isUserAdd?e("div",{staticClass:"deletePop",on:{click:function(e){return t.onDelete(t.checkPop)}}},[t._v(t._s(t.$t("deleteTheme")))]):t._e()]),t._v(" "),e("div",{staticClass:"bntitem",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.resetPrompts}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{on:{click:t.onApp}},[t._v(t._s(t.$t("Apply")))])],1)]),t._v(" "),e("el-dialog",{attrs:{"close-on-click-modal":!1,visible:t.addVisible,width:"600px","custom-class":"SaDialog"},on:{"update:visible":function(e){t.addVisible=e}}},[e("div",{staticClass:"main"},[e("div",{staticClass:"addTit"},[t._v(t._s(t.$t("gptAddTit")))]),t._v(" "),e("div",{staticClass:"addSubTit"},[t._v(t._s(t.$t("gptAddTitTip")))]),t._v(" "),e("div",{staticClass:"form"},[e("el-form",{ref:"ruleForm",attrs:{"label-position":"top",model:t.formLabelAlign,rules:t.rules}},[e("el-form-item",{attrs:{label:t.$t("Title"),prop:"title"}},[e("el-input",{model:{value:t.formLabelAlign.title,callback:function(e){t.$set(t.formLabelAlign,"title",e)},expression:"formLabelAlign.title"}})],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("CustomPrompt"),prop:"prompts"}},[e("el-input",{attrs:{type:"textarea",maxlength:"2000","show-word-limit":""},model:{value:t.formLabelAlign.prompts,callback:function(e){t.$set(t.formLabelAlign,"prompts",e)},expression:"formLabelAlign.prompts"}})],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("color")}},[e("el-select",{attrs:{"popper-class":"custom-select",placeholder:t.$t("setLikeColor")},model:{value:t.formLabelAlign.bgColor,callback:function(e){t.$set(t.formLabelAlign,"bgColor",e)},expression:"formLabelAlign.bgColor"}},t._l(t.colorList,(function(n,o){return e("el-option",{key:o,attrs:{label:n.color,value:n.bgColor}},[e("div",{staticClass:"colorSelect"},[e("div",{staticStyle:{float:"left"},style:{backgroundColor:n.color}}),t._v(" "),e("div",{style:{color:n.color}},[t._v(t._s(n.color))])])])})),1)],1)],1)],1)]),t._v(" "),e("div",{staticClass:"bntitem",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.addVisible=!1}}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{on:{click:t.submitForm}},[t._v(t._s(t.$t("Done")))])],1)]),t._v(" "),e("div",{staticClass:"add",on:{click:function(e){t.addVisible=!0}}},[e("i",{staticClass:"el-icon-plus"})])],1)}),[],!1,null,"5d62df72",null);e.default=component.exports},3325:function(t,e,n){"use strict";n.r(e);n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),r=n(541),l=n(178),c=n(1);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var h={name:"StaredChat",components:{ChatItem:r.a},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(c.e)("user",["userInfo"])),data:function(){return{messages:[]}},mounted:function(){this.getStarList()},methods:{getStarList:function(){var t=this;Object(l.e)(this.userInfo.id).then((function(e){t.messages=e,console.log("获取收藏消息",t.messages)}))},deleteStar:function(){this.getStarList()}}},v=h,m=(n(2715),n(0)),component=Object(m.a)(v,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"message-window"},[e("div",{ref:"messageWindow",staticClass:"message-list"},[t.messages.length>0?e("div",{staticClass:"messageList"},t._l(t.messages,(function(n){return e("ChatItem",{key:n.id,attrs:{item:n,inStarLilst:!0},on:{deleteStar:t.deleteStar}})})),1):e("div",{staticClass:"middle-container flex justify-center flex-col items-center"},[e("img",{staticClass:"ai-img",attrs:{src:n(3223),alt:""}}),t._v(" "),e("div",{staticClass:"text-content flex flex-col items-center"},[e("span",{staticClass:"ai-text"},[t._v(t._s(t.$t("gpt_blank_fav")))])])])])])}),[],!1,null,"bf8d86ba",null);e.default=component.exports},3326:function(t,e,n){"use strict";n.r(e);n(10),n(23),n(18),n(37),n(9),n(7),n(11),n(12),n(4),n(6);var o=n(2),r=(n(8),n(1)),l=n(40);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var h=n(291),v={name:"downloadApp",computed:d(d(d({},Object(r.e)("user",["downloadUrl","cdnHost"])),Object(r.c)("user",["cdnHostFun"])),{},{linkMap:{get:function(){return{remark:"hjgjhgkhllkhlj;j;j;",version:"v1.2.4",download_url:"https://".concat(this.cdnHost,"/download/SeaArt_Prod_China_08242249.apk"),gp_play:"https://".concat(this.cdnHost,"/download/SeaArt_Prod_China_08242249.apk"),app_store:"https://".concat(this.cdnHost,"/download/SeaArt_Prod_China_08242249.apk")}},set:function(t){return t}},imgArr:function(){return{zh:{logo:"https://".concat(this.cdnHostFun(),"/static/upload/image/download/logo-zh.png"),textImg:"https://".concat(this.cdnHostFun(),"/static/upload/image/download/text-img-zh.png"),phoneImg:"https://".concat(this.cdnHostFun(),"/static/upload/image/download/main-zh-new.png")},ja:{logo:"https://".concat(this.cdnHostFun(),"/static/upload/image/download/logo-other-lang.png"),textImg:"https://".concat(this.cdnHostFun(),"/static/upload/image/download/text-img-ja.png"),phoneImg:"https://".concat(this.cdnHostFun(),"/static/upload/image/download/main-ja-new.png")},en:{logo:"https://".concat(this.cdnHostFun(),"/static/upload/image/download/logo-other-lang.png"),textImg:"https://".concat(this.cdnHostFun(),"/static/upload/image/download/text-img-en.png"),phoneImg:"https://".concat(this.cdnHostFun(),"/static/upload/image/download/main-en-new.png")}}},renderImg:function(){var t={},e=Object.keys(this.imgArr);try{for(var n=0,o=e;n<o.length;n++){var r=o[n];this.$route.path.includes(r)&&(t=this.imgArr[r])}0===Object.keys(t).length&&(t=this.imgArr.en)}catch(e){t=this.imgArr.en}return d(d({},t),{},{iosBtn:"https://".concat(this.cdnHostFun(),"/static/upload/20240902/11ab1310-1814-48df-91cd-ba38fb85da4f.png"),googleBtn:"https://".concat(this.cdnHostFun(),"/static/upload/20240902/4fd5aaab-dbfd-475b-b436-9edf958a6290.png"),androidBtn:"https://".concat(this.cdnHostFun(),"/static/upload/20240902/bb65bf9f-ca50-479a-b5b0-06d0080aaa60.png")})},commonImg:function(){return{leftBg:"https://".concat(this.cdnHostFun(),"/static/upload/image/download/download-left-bg.png"),rightBg:"https://".concat(this.cdnHostFun(),"/static/upload/image/download/download-right-bg.png")}}}),data:function(){return{androidUrl:"",iosUrl:"",apkUrl:"https://seeart-guanwang.onelink.me/J0hw/uz4c00w9"}},mounted:function(){this.getAppLinks(),this.appendQrCode(),this.$logEvent("log_actions",{operation:"download_page_show",behavior_info:"on_homepage_hover_page"})},methods:{appendQrCode:function(){var t=this.$refs.linkCode,e=window.location.href+"?scanQRCodes=1";new h(t,{text:e,width:this.$route.path.includes("ja")?136:114,height:this.$route.path.includes("ja")?136:114})},getAppLinks:function(){var t=this;Object(l.appDownloadUrl)().then((function(e){var n;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&(t.androidUrl=e.data.google_store_url,t.iosUrl=e.data.ios_url)}))},goStore:function(t){this.$logEvent("log_actions",{operation:2===t?"click_download_ios_app":"click_download_android_app",behavior_info:"on_homepage_hover_page"});var e=null,n="android";1==t&&(e=this.androidUrl),2==t&&(e=this.iosUrl,n="ios"),3==t&&(e=this.apkUrl,n="apk"),e?(window.open(e),this.$logEvent("log_actions",{operation:"click_go_to_app",behavior_info:"on_app_download_page",behavior_info_sub:n})):this.$message(this.$t("downloadAPPTip"))}}},m=(n(2724),n(0)),component=Object(m.a)(v,(function(){var t,e,o,r,l,c,d=this,h=d._self._c;return h("div",{staticClass:"download-app"},[h("div",{staticClass:"left-box",style:{backgroundImage:"url(".concat(d.commonImg.leftBg,")")}},[h("div",{staticClass:"img-title",on:{click:function(t){d.$router.replace(d.localePath("/"))}}},[h("img",{attrs:{src:null===(t=d.renderImg)||void 0===t?void 0:t.logo,alt:""}})]),d._v(" "),h("div",{staticClass:"text-imgs"},[h("img",{attrs:{src:null===(e=d.renderImg)||void 0===e?void 0:e.textImg,alt:""}})]),d._v(" "),h("div",{staticClass:"cnt"},[h("div",{ref:"linkCode",staticClass:"code",class:{"code-has-code-tip":!d.$route.path.includes("ja")}},[h("img",{staticClass:"code-logo",attrs:{src:n(474),alt:""}})]),d._v(" "),h("div",{staticClass:"btns"},[h("div",[h("a",{staticClass:"btn-content",attrs:{href:d.iosUrl},on:{click:function(t){return t.preventDefault(),d.goStore(2)}}},[h("img",{attrs:{src:null===(o=d.renderImg)||void 0===o?void 0:o.iosBtn,alt:"ios button"}})])]),d._v(" "),h("div",[h("a",{staticClass:"btn-content",attrs:{href:d.androidUrl},on:{click:function(t){return t.preventDefault(),d.goStore(1)}}},[h("img",{attrs:{src:null===(r=d.renderImg)||void 0===r?void 0:r.googleBtn,alt:"google button"}})]),d._v(" "),h("a",{staticClass:"btn-content",attrs:{href:d.apkUrl},on:{click:function(t){return t.preventDefault(),d.goStore(3)}}},[h("img",{attrs:{src:null===(l=d.renderImg)||void 0===l?void 0:l.androidBtn,alt:"apk button"}})])])])])]),d._v(" "),h("div",{staticClass:"right-box",style:{backgroundImage:"url(".concat(d.commonImg.rightBg,")")}},[h("img",{attrs:{src:null===(c=d.renderImg)||void 0===c?void 0:c.phoneImg,alt:""}})])])}),[],!1,null,"982a7916",null);e.default=component.exports},3329:function(t,e,n){"use strict";n.r(e);n(10),n(14),n(8);var o=n(3),r=n(2),l=(n(20),n(16),n(9),n(7),n(11),n(12),n(6),n(4),n(23),n(37),n(29),n(187)),c=n(127),d=n(56),h=n(133),v=n(54),m=n(193),f=n(5),_=n(1),y=n(424),w=n(33),C=n(399),k=(n(24),n(42)),O=n(264),x=n(263),I=n(188),D=n(39),S=n(134),P=n(265),L=n(30),j=n(55);function $(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function T(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var B={name:"ExploreDetail",mixins:[y.a,w.a,C.a],components:{FrameDtl:P.a,MetaTooltipVue:l.a,WaterFallVue:c.a,CollectPopover:d.a,ElImageViewer:h.a,AppealDialog:O.a,InviteDialog:x.a,Author:I.a,cmtComments:S.a,homeList:j.a},props:{escClose:{type:Boolean,default:!1}},data:function(){return{loading:!1,parseTime:D.e,copyTextToClipboard:f.d,saveImg:f.z,imgError:f.s,bigImgDialogVisible:!1,scrollContainer:{},waterfallContainer:{},activeIndex:0,activeImg:{},parentInfo:{},imgList:[],noMoreRelated:!1,list:[],followed:!1,showParent:!1,popovervisible:!1,infovisible:!1,imgLoading:!0,cols:7,page:1,relatedLoading:!0,copied:!1,isI18nToggled:!1,time_to:0,imgHeight:0,imgNaturalWidth:0,imgNaturalHeight:0,globalLoading:!1,paymentInfo:null,isShowNullRelatedImg:!1,alreadyNoMoreData:!1,fromPath:"Home",appeaData:{obj_no:"",obj_type:1,remark:""},appealShow:!1,singleImgQuickOperateButtons:[{name:"originality-upscale",icon:"work-originality-upscale",title:this.$t("OriginalityUpscale")},{name:"extra-upscale",icon:"upload-image-icon",title:this.$t("ExtraUpscale")},{name:"variation",icon:"work-variation",title:this.$t("WorkVariations")},{name:"picture-create-picture",icon:"work-picture-create-picture",title:this.$t("UsePicturesForNewCreations")},{name:"remove-background",icon:"work-remove-background",title:this.$t("RemoveBackground")},{name:"animGen",icon:"AnimGenIcon",title:this.$t("AnimGen")},{name:"work-hide-show",icon:"work-show",title:this.$t("PublishOrHideWork")},{name:"work-post",icon:"post-icon2",title:this.$t("GraphicSubmission")},{name:"work-delete",icon:"work-delete",title:this.$t("Delete")}],fourImgsQuickOperateButtons:[{name:"V1",buttonType:"V",buttonNum:1,icon:"",title:this.$t("WorkVariations")},{name:"V2",buttonType:"V",buttonNum:2,icon:"",title:this.$t("WorkVariations")},{name:"V3",buttonType:"V",buttonNum:3,icon:"",title:this.$t("WorkVariations")},{name:"V4",buttonType:"V",buttonNum:4,icon:"",title:this.$t("WorkVariations")},{name:"U1",buttonType:"U",buttonNum:1,icon:"",title:this.$t("WorkUpscale")},{name:"U2",buttonType:"U",buttonNum:2,icon:"",title:this.$t("WorkUpscale")},{name:"U3",buttonType:"U",buttonNum:3,icon:"",title:this.$t("WorkUpscale")},{name:"U4",buttonType:"U",buttonNum:4,icon:"",title:this.$t("WorkUpscale")},{name:"extra-upscale1",buttonType:"extra-upscale",buttonNum:1,icon:"upload-image-icon",title:this.$t("ExtraUpscale")},{name:"extra-upscale2",buttonType:"extra-upscale",buttonNum:2,icon:"upload-image-icon",title:this.$t("ExtraUpscale")},{name:"extra-upscale3",buttonType:"extra-upscale",buttonNum:3,icon:"upload-image-icon",title:this.$t("ExtraUpscale")},{name:"extra-upscale4",buttonType:"extra-upscale",buttonNum:4,icon:"upload-image-icon",title:this.$t("ExtraUpscale")},{name:"remove-background",buttonType:"remove-background",icon:"work-remove-background",title:this.$t("RemoveBackground")},{name:"work-hide-show",icon:"work-show",title:this.$t("ShowOrHide")},{name:"work-delete",icon:"work-delete",title:this.$t("Delete")}],isNewPage:!1,dotReportInfo:{category:"default",view_domain:"details_one",batch_id:""}}},activated:function(){var video=this.$refs.mainVideo;video&&video.paused&&video.play()},mounted:function(){this.paymentInfo=JSON.parse(localStorage.getItem("paymentInfo")),this.isI18nToggled=!this.accountSettingsData.is_off_localization,this.getList()},beforeRouteEnter:function(t,e,n){n((function(t){t.fromPath=e.name,t.setImagePageFromPath(e.path)}))},beforeDestroy:function(){this.list=null,document.body.style.overflow=""},computed:T(T(T(T(T({},Object(_.e)("app",["imagePageFromPath"])),Object(_.c)(["isSupportWebp"])),Object(_.c)("user",["isLoggedIn","userInfo","accountSettingsData","isCompanyAccount"])),Object(_.e)("user",["accountData","adminOff"])),{},{imgWidth:function(){var t=window.innerHeight-90;if(this.activeImg){var e,n,img=this.activeImg;if(null!=img&&null!==(e=img.meta)&&void 0!==e&&e.width&&null!=img&&null!==(n=img.meta)&&void 0!==n&&n.height){var o,r,l=t*(null==img||null===(o=img.meta)||void 0===o?void 0:o.width)/(null==img||null===(r=img.meta)||void 0===r?void 0:r.height);return l>850?850:l<440?440:l}}return 440},convertMode:function(){var t,e={1:"createModeType1",2:"createModeType2",6:"createModeType6",4:"createModeType4",5:"createModeType5",7:"studio"},n={v5:1,v6:2,4:4,sdxl:5,hy21:6,studio:7}[null===(t=this.activeImg)||void 0===t?void 0:t.channel]||1;return e[n]?this.$t("".concat(e[n])):""},isSdModel:function(){var t,e;return[5,"5","sdxl"].includes(null==this||null===(t=this.activeImg)||void 0===t?void 0:t.channel)||[5,"5","sdxl"].includes(null==this||null===(e=this.activeImg)||void 0===e?void 0:e.category)},greenMode:function(){var t;return 2!==(null==this||null===(t=this.accountData)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.green_mode)},enableGreenMode:function(){return this.greenMode},imgCanUpscale:function(){var t,e;return[null===(t=this.activeImg)||void 0===t||null===(t=t.banner)||void 0===t?void 0:t.width,null===(e=this.activeImg)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.height].every((function(t){return 2*t<=4096}))},setI18nPrompt:function(){var t=this.activeImg.meta?this.activeImg.meta.prompt:"",e=this.activeImg.local_prompt;return this.isI18nToggled?e:t},imgIsHide:function(){var t;return!(null==this||null===(t=this.activeImg)||void 0===t||!t.status||1==this.activeImg.status)||!this.determineSelfWork&&1==this.activeImg.primary},quickButtonsIsDisplay:function(){return!this.imgIsHide&&1!=this.activeImg.nsfw},isSinglePicture:function(){return 2!=this.activeImg.type}}),methods:T(T(T({},Object(_.d)("app",["setImagePageFromPath"])),Object(_.b)("user",["setAdminOff"])),{},{changeAdminOff:function(){-1!==this.adminOff&&this.setAdminOff(1===this.adminOff?0:1)},openAppealShow:function(){this.appeaData.obj_no=this.activeImg.id,this.appealShow=!0,this.popovervisible=!1},operateButtonMouseEnter:function(t){void 0!==t.showToolTip&&!0!==t.showToolTip||this.$set(t,"showToolTip",!1)},operateButtonMouseLeave:function(t){t.showToolTip||this.$set(t,"showToolTip",!0)},imgLoaded:function(t){var img=t.target,e=img.naturalHeight,n=img.naturalWidth;this.imgNaturalWidth=img.naturalWidth,this.imgNaturalHeight=img.naturalHeight,this.imgHeight=508*e/n,this.imgLoading=!1},viewBigImage:function(){this.bigImgDialogVisible=!0},closeViewBigImage:function(){this.bigImgDialogVisible=!1},wordsCopy:function(){var t=this;this.copied=!0;var e=this.activeImg.meta?this.activeImg.meta.prompt:"",n=this.activeImg.local_prompt;this.copyTextToClipboard(this.isI18nToggled?n:e),setTimeout((function(){t.copied=!1}),1e3)},backTo:function(){this.$refs.frameDtl?this.$refs.frameDtl.backTo():this.$router.back()},handleWorkHideOrShow:function(){var t,e,n=this;if(this.paymentInfo.show_auto_pub_switch){var o={id:(null===(t=this.activeImg)||void 0===t?void 0:t.id)||"",is_visible:1==(null===(e=this.activeImg)||void 0===e?void 0:e.primary)};this.hidePopover(),this.globalLoading=!0,Object(m.b)(o).then((function(t){var e,o,r;1e4==(null==t||null===(e=t.status)||void 0===e?void 0:e.code)?(n.$message({message:n.$t("".concat(1==(null===(o=n.activeImg)||void 0===o?void 0:o.primary)?"WorksPublished":"WorksHidden")),type:"success"}),n.$set(n.activeImg,"primary",1==n.activeImg.primary?2:1),n.$set(n.isSinglePicture?n.singleImgQuickOperateButtons[6]:n.fourImgsQuickOperateButtons[13],"icon",1==n.activeImg.primary?"work-hide":"work-show")):n.$message({message:(null==t||null===(r=t.status)||void 0===r?void 0:r.msg)||n.$t("ServerError"),type:"error"})})).finally((function(){n.globalLoading=!1}))}else this.$EventBus.$emit("showBreakDialog","PrivateWorkTipWeb","basic")},handleWorkDelete:function(){var t=this;this.$confirm(this.$t("deleteConfirm"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){var e={id:t.activeImg.id};t.globalLoading=!0,Object(m.a)(e).then((function(e){var n,o;1e4==(null==e||null===(n=e.status)||void 0===n?void 0:n.code)?(t.$message({message:t.$t("deleteSuccess"),type:"success"}),t.setWaterFallDeleteLits(t.activeImg.id),t.$router.back()):t.$message({message:(null==e||null===(o=e.status)||void 0===o?void 0:o.msg)||t.$t("ServerError"),type:"error"})})).finally((function(){t.globalLoading=!1}))})).catch((function(t){console.log("err",t)}))},reset:function(){this.$refs.mainImage&&(this.$refs.mainImage.src=""),this.activeImg={},this.page=1,this.bigImgDialogVisible=!1,this.imgLoading=!0,this.globalLoading=!1,this.relatedLoading=!0,this.showParent=!1,this.hidePopover(),this.parentInfo={},this.noMoreRelated=!1,this.copied=!1,this.isShowNullRelatedImg=!1,this.alreadyNoMoreData=!1,this.time_to=0,this.imgHeight=0,document.body.style.overflow=""},imgDetail:function(){var t=this;this.loading=!0;var e=this.$route.params.id;e?Object(v.C)({id:e,with_author:!0}).then((function(e){e.data.banner={url:e.data.cover},t.activeImg=e.data})).finally((function(){t.loading=!1})):this.$router.push(this.localePath("/"))},solveScrollbarStyle:function(){var t=document.getElementsByClassName("imgpage-inner")[0],e=(null==t?void 0:t.offsetHeight)<=window.innerHeight;document.body.style.overflow=this.isShowNullRelatedImg&&e?"hidden":"auto"},getList:function(){var t,e,n=this;if(null==this||null===(t=this.activeImg)||void 0===t||!t.id||1==this.activeImg.nsfw||this.noMoreRelated)return this.relatedLoading=!1,void(!this.noMoreRelated&&(this.isShowNullRelatedImg=!0));var o={page:this.page,page_size:20,id:null==this||null===(e=this.activeImg)||void 0===e?void 0:e.id,time_to:this.time_to};this.relatedLoading=!0,Object(v.n)(o).then((function(t){var e;if(null===(e=t.data)||void 0===e||!e.items)return n.noMoreRelated=!0,n.isShowNullRelatedImg=!0,void n.solveScrollbarStyle();!0===t.data.has_more?(n.noMoreRelated=!1,n.page+=1):(n.alreadyNoMoreData=!0,n.noMoreRelated=!0);var o=t.data.items||[];n.time_to=t.data.time_ms,n.list=n.list.concat(o)})).finally((function(){n.relatedLoading=!1}))},goModelDtl:function(t){var e,n={action:"view",obj_no:t,obj_type:2,category:"default",batch_id:"",negative_ids:[],view_domain:"details_one"};(Object(L.g)({items:[n]}),t)&&(null===(e=window)||void 0===e||e.open(this.localePath("/models/detail/".concat(t)),"_blank"))},handlePlay:function(){this.isLoggedIn?this.goBorad():this.$EventBus.$emit("openLoginDialog")},goHome:function(){this.$router.replace(this.localePath("/"))},goBorad:function(path){var t=this.activeImg,e=t.id,n=t.palette;this.$router.push(this.localePath("/editBoard?remix_id=".concat(e,"&publish_type=").concat(null==n?void 0:n.publish_type)))},report:function(){var t=this,e=this.activeImg.id;Object(L.p)({id:e,obj_type:7}).then((function(e){t.popovervisible=!1,t.$message({message:t.$t("ReportSuccess"),type:"success",duration:5e3})}))}}),watch:{appealShow:{handler:function(t){t||(this.appeaData={obj_no:"",obj_type:1,remark:""})}},accountSettingsData:{handler:function(t){this.isI18nToggled=!t.is_off_localization},deep:!0},$route:function(t,e){this.reset(),t.path.indexOf("explore/")>-1&&t.params.id!==e.params.id&&this.imgDetail()},"$route.query":{handler:function(t){var e=t.u_code;e&&Object(k.w)(e)},immediate:!0},bigImgDialogVisible:function(t){document.body.style.overflow=t?"hidden":"auto"}},head:function(){var t=(null==this?void 0:this.activeImg)||{},e=t.author,n=void 0===e?{}:e,o=t.local_prompt,r=void 0===o?"":o,l=t.cover,c=t.name,d=t.intro,h=t.id,v=r||"",m=d||c?(d||c)+" - SeaArt AI":this.$t("newHomeTitle"),f="https://image.cdn2.seaart.ai/static/upload/20240105/74f78417-21a7-457b-ac87-eafcaf8abf61.webp",_=h?"https://www.seaart.ai/editBoard/detail/".concat(h):"https://www.seaart.ai";return{title:m,meta:[{hid:"description",name:"description",content:v},{hid:"og:title",name:"og:title",content:m},{hid:"og:description",name:"og:description",content:v},{hid:"og:image",name:"og:image",content:l||f},{hid:"og:site_name",name:"og:site_name",content:"SeaArt"},{hid:"og:url",name:"og:url",content:_},{hid:"twitter:url",property:"twitter:url",content:_},{hid:"twitter:image",property:"twitter:image",content:l||f},{hid:"twitter:title",name:"twitter:title",content:m},{hid:"twitter:description",name:"twitter:description",content:v},{hid:"twitter:site",name:"twitter:site",content:"@SeaArt_Ai"},{hid:"twitter:creator",name:"twitter:creator",content:(null==n?void 0:n.name)||"@SeaArt_Ai"},{hid:"twitter:card",name:"twitter:card",content:"summary_large_image"}],script:[{type:"application/ld+json",json:{"@context":"https://schema.org","@type":"ImageObject",acquireLicensePage:"https://image6.cdn.seaart.me/20230808/9598893d-2207-4b30-9036-bf5b026232bf.html",contentUrl:l||f,creator:{name:(null==n?void 0:n.name)||"SeaArt","@type":"Person"},creditText:(null==n?void 0:n.name)||"SeaArt",copyrightNotice:(null==n?void 0:n.name)||"SeaArt",license:"https://image6.cdn.seaart.me/20230808/9598893d-2207-4b30-9036-bf5b026232bf.html"}}],__dangerouslyDisableSanitizers:["script"]}},asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$axios,o=t.params,r=t.error,l=o.id,e.prev=2,e.next=5,n.$post("/api/v1/palette/tpl-detail",{id:l,with_author:!0});case 5:return c=e.sent,data=c.data,e.abrupt("return",{activeImg:data||{}});case 10:e.prev=10,e.t0=e.catch(2),console.log("画板品详情页-> asyncData错误啦：",e.t0),r({statusCode:404,message:e.t0});case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))()}},M=(n(2868),n(2869),n(0)),component=Object(M.a)(B,(function(){var t,e,o,r,l,c,d=this,h=d._self._c;return h("div",{directives:[{name:"loading",rawName:"v-loading",value:d.globalLoading,expression:"globalLoading"}],ref:"image-gallery",staticClass:"image-gallery"},[h("el-backtop",{attrs:{bottom:30,right:30}},[h("i",{staticClass:"el-icon-top"})]),d._v(" "),h("div",{staticClass:"mobile-back-to",on:{"~click":function(t){return t.stopPropagation(),d.backTo.apply(null,arguments)}}},[h("i",{staticClass:"el-icon-back"})]),d._v(" "),null!==(t=d.activeImg)&&void 0!==t&&t.id?h("div",{staticClass:"imgpage-content flex",on:{click:d.hidePopover}},[h("div",{staticClass:"imgpage-inner"},[h("FrameDtl",{ref:"frameDtl",attrs:{imgIsHide:d.imgIsHide,type:"work"}},[h("div",{directives:[{name:"loading",rawName:"v-loading",value:d.imgLoading,expression:"imgLoading"}],staticClass:"imgpage-image flex",style:{width:d.imgWidth+"px"}},[h("div",{staticClass:"image-container flex"},[h("img",{ref:"mainImage",class:{"blur-img":[2,"2"].includes(d.activeImg.green)&&d.enableGreenMode},attrs:{alt:d.activeImg.local_prompt,src:"".concat(d.getImagUrl(null===(e=d.activeImg)||void 0===e?void 0:e.cover,d.$imgH)||"")},on:{load:function(t){return d.imgLoaded(t)},error:function(t){var e;return d.imgError(null===(e=d.activeImg)||void 0===e?void 0:e.cover,d.$refs.mainImage)}}})])]),d._v(" "),h("h1",{staticClass:"prompt",staticStyle:{display:"none"}},[d._v(d._s(d.activeImg.local_prompt))]),d._v(" "),h("div",{staticClass:"imgpage-info",staticStyle:{width:"450px",padding:"0 24px"}},[h("Author",{attrs:{type:"palette",activeImg:d.activeImg}},[3!=(null===(o=d.activeImg)||void 0===o?void 0:o.type)?h("button",{staticClass:"right-btn button-try",class:d.isLoggedIn?"":"disabled",on:{click:function(t){return d.handlePlay("work")}}},[d._v("\n                "+d._s(d.$t("Remix"))+"\n              ")]):d._e()]),d._v(" "),null!==(r=d.activeImg)&&void 0!==r&&r.id?h("cmtComments",{attrs:{infos:d.activeImg,type:11,dotReportInfo:d.dotReportInfo},scopedSlots:d._u([{key:"cmtInner",fn:function(){var t,e,o,r,l,c,v,m,f,_,y,w,C;return[d.activeImg.prompt||d.activeImg.meta?h("div",{staticClass:"description"},[h("div",{staticClass:"header"},[h("div",{staticClass:"header-left"},[h("div",{staticClass:"title"},[d._v(d._s(d.$t("Prompt")))]),d._v(" "),h("div",{staticClass:"header-copy"},[h("div",{staticClass:"prompt-copy",class:{copied:d.copied},on:{click:function(t){return d.wordsCopy()}}},[h("i",{directives:[{name:"show",rawName:"v-show",value:d.copied,expression:"copied"}],staticClass:"iconfont icon-success"}),d._v(" "),h("i",{directives:[{name:"show",rawName:"v-show",value:!d.copied,expression:"!copied"}],staticClass:"iconfont icon-copy"}),d._v("\n                          "+d._s(d.$t("CopyPrompts"))+"\n                        ")])]),d._v(" "),h("div",{staticClass:"header-trans",on:{click:function(t){d.isI18nToggled=!d.isI18nToggled}}},[h("i",{staticClass:"iconfont icon-i18n_prompt",staticStyle:{color:"#93A2B6"}})])])]),d._v(" "),h("div",{ref:"promptContainer",staticClass:"prompt-container"},[h("div",{staticClass:"prompt"},[d._v(d._s(d.setI18nPrompt))])])]):d._e(),d._v(" "),null!==(t=d.activeImg)&&void 0!==t&&t.meta&&Object.keys(d.activeImg.meta).length?h("div",{staticClass:"model-info"},[h("div",{staticClass:"header flex items-center"},[h("div",{staticClass:"title"},[d._v(d._s(d.$t("INFO")))]),d._v(" "),null!==(e=d.activeImg)&&void 0!==e&&e.meta&&Object.keys(d.activeImg.meta).length?h("span",{on:{click:function(t){t.stopPropagation(),d.infovisible=!d.infovisible}}},[h("el-popover",{staticStyle:{padding:"0"},attrs:{"popper-class":"metaPoper",placement:"right","visible-arrow":!1,trigger:"hover"},on:{click:function(t){t.stopPropagation(),t.preventDefault()}},model:{value:d.infovisible,callback:function(t){d.infovisible=t},expression:"infovisible"}},[h("MetaTooltipVue",{attrs:{sourceFrom:"imageDetail",category:null===(o=d.activeImg)||void 0===o?void 0:o.channel,meta:null===(r=d.activeImg)||void 0===r?void 0:r.meta,model:(null===(l=d.activeImg)||void 0===l?void 0:l.model_id)||(null===(c=d.activeImg)||void 0===c?void 0:c.artwork_no),"model-name":null===(v=d.activeImg)||void 0===v?void 0:v.model_name},on:{copyGenerationData:d.goBorad}}),d._v(" "),h("span",{staticClass:"carousel-icon",attrs:{slot:"reference"},slot:"reference"},[h("i",{staticClass:"iconfont icon-work-tips work-tips"})])],1)],1):d._e()]),d._v(" "),h("el-row",{staticClass:"meta-content flex flex-col",attrs:{type:"flex"}},[h("div",{staticClass:"info flex"},[h("span",{staticClass:"item"},[h("div",{staticClass:"name"},[d._v(d._s(d.$t("Size")))]),d._v(" "),h("div",{staticClass:"value"},[d._v("\n                          "+d._s(d.activeImg.meta.width+"X"+d.activeImg.meta.height)+"\n                        ")])]),d._v(" "),h("span",{staticClass:"item"},[h("div",{staticClass:"name"},[d._v(d._s(d.$t("Date")))]),d._v(" "),h("div",{staticClass:"value"},[d._v(d._s(d.formatDate(d.activeImg.create_at)))])]),d._v(" "),h("span",{directives:[{name:"show",rawName:"v-show",value:d.convertMode,expression:"convertMode"}],staticClass:"item"},[h("div",{staticClass:"name"},[d._v(d._s(d.$t("createModeTitle")))]),d._v(" "),h("div",{staticClass:"value"},[d._v(d._s(d.convertMode))])]),d._v(" "),h("span",{staticClass:"item"},[h("div",{staticClass:"name"},[d._v(d._s(d.$t("Type")))]),d._v(" "),h("div",{staticClass:"value"},[d._v("\n                          "+d._s(d.activeImg.type&&1!=d.activeImg.type&&3!=d.activeImg.type?"grid":"upscale")+"\n                        ")])])])]),d._v(" "),null!==(m=d.activeImg)&&void 0!==m&&m.models&&(null===(f=d.activeImg)||void 0===f||null===(f=f.models)||void 0===f?void 0:f.length)>0?h("div",{staticClass:"models flex flex-wrap"},d._l(null===(_=d.activeImg)||void 0===_?void 0:_.models,(function(t,i){var e,o,r;return h("a",{key:"model_".concat(i),staticClass:"model-item flex items-center",attrs:{href:d.localePath("/models/detail/".concat(t.id))},on:{click:function(e){return e.preventDefault(),d.goModelDtl(t.id)}}},[null!=t&&null!==(e=t.cover)&&void 0!==e&&e.url&&1!==(null==t||null===(o=t.cover)||void 0===o?void 0:o.nsfw)?h("img",{ref:"modelCover".concat(i),refInFor:!0,staticClass:"model-cover",attrs:{src:"".concat(d.getImagUrl(null==t||null===(r=t.cover)||void 0===r?void 0:r.url,d.$imgL)||""),alt:t.name},on:{error:function(e){return d.imgError(null==t?void 0:t.cover,d.$refs["modelCover".concat(i)])}}}):h("img",{staticClass:"model-cover",attrs:{src:n(171),alt:""}}),d._v(" "),h("div",{staticClass:"model-cont flex flex-col"},[h("div",{staticClass:"model-type"},[h("span",{class:{isLora:"Checkpoint"!==(null==t?void 0:t.type)}},[d._v(d._s(null==t?void 0:t.type))])]),d._v(" "),h("div",{staticClass:"model-name text-no-wrap-2"},[d._v(d._s(t.name))])])])})),0):d._e(),d._v(" "),null!==(y=d.activeImg)&&void 0!==y&&y.tags&&(null===(w=d.activeImg)||void 0===w||null===(w=w.tags)||void 0===w?void 0:w.length)>0?h("div",{staticClass:"tag-items flex flex-wrap"},d._l(null===(C=d.activeImg)||void 0===C?void 0:C.tags,(function(t,i){return h("div",{key:"tag_".concat(i),staticClass:"tag-item"},[t.id?[h("a",{attrs:{target:"_self",href:"/tagInfo/"+t.id+"?id="+t.id},on:{click:function(e){return e.preventDefault(),d.goTagDtl(t,"work_detials")}}},[d._v("#"+d._s(null==t?void 0:t.title))])]:d._e()],2)})),0):d._e()],1):d._e()]},proxy:!0},{key:"cmtMore",fn:function(){return[d.isCompanyAccount?d._e():h("button",{staticClass:"commFunNum",on:{click:function(t){return t.stopPropagation(),d.share("palette")}}},[h("i",{staticClass:"iconfont icon-share-icon"})]),d._v(" "),h("button",{staticClass:"commFunNum",on:{click:function(t){return t.stopPropagation(),d.moreActions("save")}}},[h("i",{staticClass:"iconfont icon-icon-Download"})]),d._v(" "),h("div",{staticClass:"commFunNum",on:{click:function(t){t.stopPropagation(),d.popovervisible=!d.popovervisible}}},[h("el-popover",{ref:"myPopover",attrs:{placement:"top-start","popper-class":"my-popover","visible-arrow":!1,width:"100",trigger:"manual"},model:{value:d.popovervisible,callback:function(t){d.popovervisible=t},expression:"popovervisible"}},[h("div",{staticClass:"pop-btns flex"},[h("button",{on:{click:d.report}},[d._v("\n                        "+d._s(d.$t("Report"))+"\n                      ")])]),d._v(" "),h("button",{staticStyle:{color:"#ffffff"},attrs:{slot:"reference"},slot:"reference"},[h("i",{staticClass:"iconfont icon-more"})])])],1)]},proxy:!0}],null,!1,3480851285)}):d._e()],1)]),d._v(" "),h("div",{staticClass:"imgpage-related"},[h("div",{staticClass:"title-div"},[h("span",{staticClass:"title"},[d._v(d._s(d.$t("ExploreRelated")))])]),d._v(" "),h("div",{ref:"wraper",staticClass:"wraper"},[h("homeList",{attrs:{list:d.list,container:"wraper",dotReportInfo:d.dotReportInfo,isTrainLora:!1},on:{load:d.getList}}),d._v(" "),h("div",{directives:[{name:"loading",rawName:"v-loading",value:d.relatedLoading,expression:"relatedLoading"}],staticClass:"loading-div"})],1)]),d._v(" "),d.bigImgDialogVisible?h("el-image-viewer",{staticClass:"message-img-viewer",staticStyle:{"z-index":"9999"},attrs:{"on-close":d.closeViewBigImage,"url-list":[d.getImagUrl(null===(l=d.activeImg)||void 0===l?void 0:l.cover)]}}):d._e()],1)]):d._e(),d._v(" "),d.appealShow?h("AppealDialog",{attrs:{"appeal-data":d.appeaData,"is-appealing":d.isAppealLoading,"submit-callback":d.setResourceAppeal,"dialog-visible":d.appealShow},on:{"update:dialogVisible":function(t){d.appealShow=t},"update:dialog-visible":function(t){d.appealShow=t}}}):d._e(),d._v(" "),h("invite-dialog",{ref:"inviteDialog",attrs:{type:"artwork",workId:null===(c=d.activeImg)||void 0===c?void 0:c.id}})],1)}),[],!1,null,"2f0d7aaa",null);e.default=component.exports},3330:function(t,e,n){"use strict";n.r(e);var o=n(3),r=(n(1561),n(44),n(678)),l=n.n(r),c=(n(1562),n(679)),d=n.n(c),h=(n(20),n(32),n(4),n(542)),v=n(176),m=n(39),f={components:{BlogHeader:h.a,ElBreadcrumb:d.a,ElBreadcrumbItem:l.a},data:function(){return{detailData:{},tagList:[{icon:"icon-icon_All_",label:"All",value:"all",i18nKey:"blog_all"},{icon:"icon-a-icon_AIArtGuide_",label:"AI Art Guide",value:"aiArtGuide",i18nKey:"blog_aiArtGuide"},{icon:"icon-a-icon_AIVideoGuide_",label:"AI Video Guide",value:"aiVideoGuide",i18nKey:"blog_aiVideoGuide"},{icon:"icon-a-icon_TrainingGuide_",label:"Training Guide",value:"trainingGuide",i18nKey:"blog_trainingGuide"},{icon:"icon-icon_news_",label:"News",value:"news",i18nKey:"blog_news"},{icon:"icon-a-icon_AITools_",label:"AI Tools",value:"aiTools",i18nKey:"blog_aiTools"},{icon:"icon-icon-blog-voice_",label:"AI语音指南",value:"aiVoiceGuide",i18nKey:"blog_aiVoiceGuide"},{icon:"icon-icon-blog-tip_",label:"指南与技巧",value:"guides&tips",i18nKey:"blog_guides&tips"},{icon:"icon-icon-blog-review_",label:"评测",value:"review",i18nKey:"blog_review"}]}},computed:{time:function(){var t;return Object(m.g)(null===(t=this.detailData)||void 0===t?void 0:t.update_at)},getI18nKey:function(){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.tagList.find((function(e){return e.value===t}));return e?e.i18nKey:"blog_".concat(t)}}},mounted:function(){this.$route.params.id&&this.getData(this.$route.params.id)},methods:{getData:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(o={}).seo_url=t,n.next=4,Object(v.c)(o);case 4:r=n.sent,data=r.data,e.detailData=data||{};case 7:case"end":return n.stop()}}),n)})))()}},head:function(){var t=this.detailData,e=t.title,title=void 0===e?"":e,n=t.meta_desc,o=void 0===n?"":n,r=t.author,l=void 0===r?"":r,c=t.cover,d=void 0===c?"":c,h=t.create_at,v=void 0===h?0:h,m=t.update_at,f=void 0===m?0:m;return{title:title,meta:[{hid:"description",name:"description",content:o},{hid:"og:title",name:"og:title",content:title},{hid:"og:description",name:"og:description",content:o}],script:[{type:"application/ld+json",json:{"@context":"https://schema.org","@type":"NewsArticle",headline:title,image:[d],datePublished:new Date(v).toISOString(),dateModified:new Date(f).toISOString(),author:[{"@type":"Person",name:l}]}}],__dangerouslyDisableSanitizers:["script"]}},asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$axios,t.app,o=t.params,r=t.error,e.prev=1,l={seo_url:o.id},e.next=5,n.$post("/api/v1/blog/detail",l);case 5:if(c=e.sent,data=c.data){e.next=9;break}throw new Error("获取数据失败");case 9:return e.abrupt("return",{detailData:data||{}});case 12:e.prev=12,e.t0=e.catch(1),console.log("blog -> asyncData错误啦：",e.t0),r({statusCode:404,message:e.t0});case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))()}},_=f,y=(n(2911),n(0)),component=Object(y.a)(_,(function(){var t,e,n,o,r,l,c=this,d=c._self._c;return d("div",{staticClass:"blog-detail"},[d("BlogHeader",{attrs:{isDetail:""}}),c._v(" "),d("div",{staticClass:"blog-detail-content"},[d("el-breadcrumb",{staticClass:"breadcrumb",attrs:{"separator-class":"el-icon-arrow-right"}},[d("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[c._v("\n        "+c._s(c.$t("blog_home"))+"\n      ")]),c._v(" "),d("el-breadcrumb-item",{attrs:{to:{path:"/blog"}}},[c._v("\n        "+c._s(c.$t("blog"))+"\n      ")]),c._v(" "),null!==(t=c.detailData)&&void 0!==t&&t.category?d("el-breadcrumb-item",[c._v("\n        "+c._s(c.$t("".concat(c.getI18nKey(null===(e=c.detailData)||void 0===e?void 0:e.category))))+"\n      ")]):c._e()],1),c._v(" "),null!==(n=c.detailData)&&void 0!==n&&n.post_title?d("h1",[c._v(c._s(c.detailData.post_title))]):c._e(),c._v(" "),null!==(o=c.detailData)&&void 0!==o&&o.author?d("div",{staticClass:"tips"},[d("div",[d("span",{staticClass:"author"},[c._v(c._s(c.detailData.author))]),c._v(" "),d("time",{staticClass:"time",attrs:{datetime:c.time}},[c._v("\n          "+c._s(c.$t("blog_updated"))+" "+c._s(c.time)+"\n        ")])]),c._v(" "),d("div",{staticClass:"time"},[d("i",{staticClass:"el-icon-time"}),c._v(" "),d("span",[c._v(c._s(c.detailData.reading_duration)+" "+c._s(c.$t("blog_read")))])])]):c._e(),c._v(" "),null!==(r=c.detailData)&&void 0!==r&&r.meta_desc?d("div",{staticClass:"meta"},[c._v("\n      "+c._s(c.detailData.meta_desc)+"\n    ")]):c._e(),c._v(" "),null!==(l=c.detailData)&&void 0!==l&&l.content?d("div",{staticClass:"blog-detail-content-html",domProps:{innerHTML:c._s(c.detailData.content)}}):c._e()],1)],1)}),[],!1,null,"8e53da9e",null);e.default=component.exports},3332:function(t,e,n){"use strict";n.r(e);var o=n(2),r=n(97),l=n(3),c=(n(20),n(9),n(7),n(19),n(11),n(12),n(8),n(4),n(6),n(167)),d=["content"];function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var m={components:{PageSeo:c.a},data:function(){return{SEOInfo:{tempList:{},pageInfo:{}}}},head:function(){var t,e=(null===(t=this.pageSEO)||void 0===t?void 0:t.pageInfo)||{},title=e.title,n=e.key_words,o=e.meta_description,r=this.$t(title),desc=this.$t(o);return{title:r,meta:[{hid:"description",name:"description",content:desc},{hid:"og:title",name:"og:title",content:r},{hid:"og:description",name:"og:description",content:desc},{hid:"keywords",name:"keywords",content:this.$t(n)}]}},asyncData:function(t){return Object(l.a)(regeneratorRuntime.mark((function e(){var n,o,l,c,h,data,m,f,title,_,y,w,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$axios,t.app,o=t.params,l=t.error,t.route,e.prev=1,c=null==o?void 0:o.id,e.next=5,n.$post("/api/v1/fast_ai/detail",{name:c,cat:2});case 5:if(h=e.sent,data=h.data,f=(m=data||{}).module,title=m.title,_=m.meta_description,y=m.key_words,data){e.next=10;break}return e.abrupt("return",l({statusCode:404,message:"Not Found"}));case 10:return w=null!=f&&f.length?f.map((function(t){var content=t.content;return v(v({},Object(r.a)(t,d)),{},{content:JSON.parse(content)})})):[],C={tempList:w,pageInfo:{title:title,meta_description:_,key_words:y}},e.abrupt("return",{pageSEO:C});case 15:e.prev=15,e.t0=e.catch(1),console.log("快捷AI详情页-> asyncData错误啦：",e.t0),l({statusCode:404,message:e.t0});case 19:case"end":return e.stop()}}),e,null,[[1,15]])})))()}},f=m,_=n(0),component=Object(_.a)(f,(function(){var t,e,n=this,o=n._self._c;return o("div",{staticClass:"custom-page"},[null!==(t=n.pageSEO)&&void 0!==t&&null!==(t=t.tempList)&&void 0!==t&&t.length?o("page-seo",{attrs:{tempList:null===(e=n.pageSEO)||void 0===e?void 0:e.tempList}}):n._e()],1)}),[],!1,null,"4b3fd5ef",null);e.default=component.exports},3337:function(t,e,n){"use strict";n.r(e);n(14),n(9),n(7),n(11),n(12),n(8),n(6);var o=n(2),r=(n(10),n(4),n(29),n(1)),l=n(184),c=n(13),d=n(73);function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var m={name:"langDialog",props:{},computed:v(v({},Object(r.c)("user",["isLoggedIn","accountSettingsData"])),Object(r.e)("user",["token"])),data:function(){return{languageList:c.G,dialogVisible:!1,language:"en"}},mounted:function(){var t,e=(null===(t=this.accountSettingsData)||void 0===t?void 0:t.lang_code)||this.$i18n.locale;this.language=e||"en",this.init()},methods:v(v(v(v(v({},Object(r.b)("app",["setLang"])),Object(r.b)("user",["getAccountInfo","updateAccountSettings","logout","getCollectTags"])),Object(r.b)("chatgpt",["getMainMessage"])),Object(r.d)("home",["setAllUpdateStatus"])),{},{init:function(){var t=this;this.initLang(),this.$EventBus.$on("openLangDialog",(function(){t.initLang(),t.dialogVisible=!0}))},initLang:function(){var t=this.$cookies.get("lang")||this.$i18n.locale;this.language=t||"en"},handleChangeLang:function(t){var e=this;if(this.$cookies.set("locaExpire",0),this.$cookies.set("isDeadline",!0),localStorage.removeItem("homeConfigData"),this.setAllUpdateStatus(!0),this.language=t.value,this.$i18n.locale!==this.language){var n={lang:this.language};this.isLoggedIn?(this.getMainMessage(),Object(d.a)(n).then((function(t){var o=(t||{}).status.code;["10000",1e4].includes(void 0===o?"":o)&&(e.loading=!1,e.changeLang(),e.$message.success(e.$t("SaveSuccess")),e.updateAccountSettings(n))})).finally((function(){e.loading=!1}))):this.changeLang()}},changeLang:function(){var t=this;Object(l.b)(this.language),localStorage.setItem("language",this.language),this.$cookies.set("lang",this.language),this.token&&this.getCollectTags(this.language),this.$i18n.setLocale(this.language),setTimeout((function(){t.close()}),1500)},close:function(){this.dialogVisible=!1}})},f=(n(2974),n(2975),n(0)),component=Object(f.a)(m,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"lang-dialog",attrs:{title:t.$t("Language"),visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e},close:function(e){t.dialogVisible=!1}}},[e("div",{staticClass:"lang-content flex flex-col"},t._l(t.languageList,(function(n,i){return e("div",{key:"lang_".concat(i),staticClass:"lang-item flex justify-between",on:{click:function(e){return t.handleChangeLang(n)}}},[e("div",{staticClass:"name",class:{active:n.value===t.language}},[t._v(t._s(t.$t(n.name)))]),t._v(" "),n.value===t.language?e("i",{staticClass:"el-icon-check"}):t._e()])})),0)])}),[],!1,null,"512c29bf",null);e.default=component.exports},3339:function(t,e,n){"use strict";n.r(e);n(16),n(10);var o={name:"BusinessTransformationDialog",data:function(){return{isShowDialog:!1,isCredits:!0,showSubscribe:!1,limitTypes:{vip:"",createModeType2:"createModeType2",createModeType6:"createModeType6",studio:"seaartStudio",trainLora:"LoRATrain",LoRATrainQue:"LoRATrainQue",UnlimitedQueue:"UnlimitedQueue",SubsBottomTerms2:"SubsBottomTerms2",privateWork:"SubsBottomTerms6",downloadLimit:"WorkBatchDownload",LoRALimit5:"LoRALimit5",computingPower:"InsufficientBalanceTip",aiToolsPhoto:"ai_tools_10",aiToolsFilter:"ai_tools_4",aiPersonExclusive:"aiPersonExclusive",aiPersonVipRole:"aiPersonVipRole",AiChatSendNotCoin:"AiChatSendNotCoin",AiChatSendVipNotCoin:"AiChatSendVipNotCoin",trainLoraNoVip:"modelTrainLimit"},limitType:"vip",isVipBig:!1}},mounted:function(){var t=this;window.$EventBus=this.$EventBus,this.$EventBus.$on("showBusinessTransformation",(function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.isShowDialog=!0,t.limitType=e,t.isVipBig=n;t.$logEvent("log_actions",{operation:"vip_pop_show",behavior_info:n?"forced_pop":{SubsBottomTerms2:"new_user_fourth_try_quick",computingPower:"insufficient_computing_power",createModeType2:"seaart_20",createModeType6:"seaart_21",studio:"laboratory",UnlimitedQueue:"infinite_queue",LoRATrainQue:"style_training",aiToolsPhoto:"ai_photo_without_vip",aiToolsFilter:"ai_filter_without_vip",LoRALimit5:"lora_limitation"}[e]||""})}))},beforeDestroy:function(){this.$EventBus.$off("showBusinessTransformation")},computed:{getHtml1:function(){return this.$t("VIPTransformationTerm1")},getHtml2:function(){return this.$t("VIPTransformationTerm5")},limitContent:function(){if("computingPower"===this.limitType&&!this.isVipBig)return{title:this.$t("InsufficientBalance"),desc:this.$t("InsufficientBalanceTip"),btn:this.$t("GoRecharge"),btnMini:this.$t("Sale")};if("AiChatMsg"===this.limitType&&!this.isVipBig)return{title:this.$t("InsufficientBalance"),desc:this.$t("AiChatNoCoinMsg"),btn:this.$t("GoRecharge"),btnMini:this.$t("Sale")};if("AiChatSendNotCoin"===this.limitType&&!this.isVipBig)return{title:this.$t("InsufficientBalance"),desc:this.$t("AiChatSendNotCoin"),btn:this.$t("GoRecharge"),btnMini:this.$t("Sale")};if("AiChatSendVipNotCoin"===this.limitType&&!this.isVipBig)return{title:this.$t("InsufficientBalance"),desc:this.$t("AiChatSendVipNotCoin"),btn:this.$t("GoRecharge"),btnMini:this.$t("Sale")};if(this.limitTypes[this.limitType]&&!this.isVipBig){var t=this.limitTypes[this.limitType],e={title:this.$t("BusinessTransformationDialog2"),desc:this.$t("vipLimitContent",{type:this.$t(t)}),btn:this.$t("SubscribeNow"),btnMini:this.$t("Sale")};return"privateWork"===this.limitType&&(e.desc=this.$t("vipLimitContent",{type:this.$t(t),txt:this.$t("DialogVipPrivateTxt")})),e}return{title:this.$t("RightsActivation"),desc:this.$t("RightsActivationTip"),btn:this.$t("GoActivate"),btnMini:this.$t("Sale")}}},methods:{toMall:function(){if(this.isShowDialog=!1,["AiChatSendVipNotCoin","computingPower"].includes(this.limitType))this.$logEvent("log_actions",{operation:"click_popup_to_pay",behavior_info:"credits_not_enough"}),this.$router.push(this.localePath({path:"/mall",query:{dotFrom:this.limitType}}));else{this.$logEvent("log_actions",{operation:"click_popup_to_pay",behavior_info:"not_VIP"});var t="".concat(location.origin).concat(this.localePath("/mall?dotFrom=".concat(this.limitType)));window.open(t,"_blank")}},close:function(){var t=(new Date).getTime()+1728e5;t=new Date(t).setHours(0,0,0,0),localStorage.setItem("bannerPopupTime",new Date(t).getTime()),this.isShowDialog=!1}}},r=o,l=(n(3147),n(0)),component=Object(l.a)(r,(function(){var t,e=this,o=e._self._c;return o("el-dialog",{staticClass:"business-transformation-dialog",class:{"vip-dialog":e.isVipBig},attrs:{visible:e.isShowDialog,"destroy-on-close":!0,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.isShowDialog=t}}},[e.isVipBig?[o("div",{staticClass:"container-vip"},[o("i",{staticClass:"el-icon-close close-icon",on:{click:e.close}}),e._v(" "),o("div",{staticClass:"left-img"},[o("div",{staticClass:"content"},[o("div",{staticClass:"img-box"},[o("img",{staticClass:"vip-icon",attrs:{src:n(162),alt:"vip-icon"}})]),e._v(" "),o("div",{staticClass:"words-top"},[e._v(e._s(e.$t("VIPTransformationIMGDesc1")))]),e._v(" "),o("div",{staticClass:"words-bottom"},[o("span",[e._v(e._s(e.$t("VIPTransformationIMGDesc2")))])])])]),e._v(" "),o("div",{staticClass:"right-content"},[o("div",{staticClass:"title"},[e._v("SeaArt VIP")]),e._v(" "),o("div",{staticClass:"desc"},[e._v(e._s(e.$t("VIPTransformationDesc")))]),e._v(" "),o("div",{staticClass:"terms"},[o("div",{staticClass:"item-term term-one"},[o("i",{staticClass:"icon el-icon-check"}),e._v(" "),o("span",{staticClass:"before",domProps:{innerHTML:e._s(e.getHtml1)}}),e._v(" "),o("span",{staticClass:"point"},[e._v("·")]),e._v(" "),o("span",{staticClass:"after"},[e._v(e._s(e.$t("VIPTransformationTerm2")))])]),e._v(" "),o("div",{staticClass:"item-term term-two"},[o("i",{staticClass:"icon el-icon-check"}),e._v(" "),o("span",{staticClass:"before"},[e._v(e._s(e.$t("SubsBottomTerms2")))]),e._v(" "),o("span",{staticClass:"point"},[e._v("·")]),e._v(" "),o("span",{staticClass:"after"},[e._v(e._s(e.$t("VIPTransformationTerm3")))])]),e._v(" "),o("div",{staticClass:"item-term term-three"},[o("i",{staticClass:"icon el-icon-check"}),e._v(" "),o("span",{staticClass:"before"},[e._v(e._s(e.$t("UnlimitedQueue")))]),e._v(" "),o("span",{staticClass:"point"},[e._v("·")]),e._v(" "),o("span",{staticClass:"after"},[e._v(e._s(e.$t("VIPTransformationTerm4")))])]),e._v(" "),o("div",{staticClass:"item-term term-four"},[o("i",{staticClass:"icon el-icon-check"}),e._v(" "),o("span",{staticClass:"before",domProps:{innerHTML:e._s(e.getHtml2)}}),e._v(" "),o("span",{staticClass:"point"},[e._v("·")]),e._v(" "),o("span",{staticClass:"after"},[e._v(e._s(e.$t("GetCreditsGive")))])])]),e._v(" "),o("div",{staticClass:"privilege"},[o("img",{staticClass:"img",attrs:{src:"https://image4.cdn.seaart.me/static/upload/20231104/55b08adf-957c-4c5d-aca3-9492bf828598.png",alt:"vip icon"}}),e._v(" "),o("div",{staticClass:"title"},[o("span",[e._v(e._s(e.$t("VIPTransformationPrivilegeTitle")))])]),e._v(" "),o("div",{staticClass:"content"},[o("div",{staticClass:"item-privilege"},[o("span",{staticClass:"before"},[e._v(e._s(e.$t("vip_dlg_tit4")))]),e._v(" "),o("span",{staticClass:"line"},[e._v("——")]),e._v(" "),o("span",{staticClass:"after"},[e._v(e._s(e.$t("HigherQuality")))])]),e._v(" "),o("div",{staticClass:"item-privilege"},[o("span",{staticClass:"before"},[e._v(e._s(e.$t("ImagePrivacyGeneration")))]),e._v(" "),o("span",{staticClass:"line"},[e._v("——")]),e._v(" "),o("span",{staticClass:"after"},[e._v(e._s(e.$t("ImagePrivacyViewing")))])]),e._v(" "),o("div",{staticClass:"item-privilege"},[o("span",{staticClass:"before"},[e._v(e._s(e.$t("ModelTrainingQueue")))]),e._v(" "),o("span",{staticClass:"line"},[e._v("——")]),e._v(" "),o("span",{staticClass:"after"},[e._v(e._s(e.$t("ThreeModelTrainingTasks")))])])])]),e._v(" "),o("div",{staticClass:"footer"},[o("el-button",{staticClass:"cancel",on:{click:e.close}},[e._v("\n\t\t\t\t\t\t\t"+e._s(e.$t("ReminderLater"))+"\n\t\t\t\t\t\t")]),e._v(" "),o("el-button",{staticClass:"to-mall",on:{click:e.toMall}},[o("div",{staticClass:"desc"},[e._v("\n\t\t\t\t\t\t\t\t"+e._s(e.$t("FreeForNow"))+"\n\t\t\t\t\t\t\t")]),e._v("\n\t\t\t\t\t\t\t"+e._s(e.$t("ActivateNow"))+"\n\t\t\t\t\t\t")])],1)])])]:o("div",{staticClass:"container-credits"},[o("i",{staticClass:"el-icon-close close-icon",on:{click:e.close}}),e._v(" "),o("div",{staticClass:"top"}),e._v(" "),o("div",{staticClass:"content"},[o("div",{staticClass:"title"},[e._v("\n\t\t\t\t\t"+e._s(e.limitContent.title)+"\n\t\t\t\t")]),e._v(" "),o("div",{staticClass:"desc"},[e._v("\n\t\t\t\t\t"+e._s(e.limitContent.desc)+"\n\t\t\t\t")])]),e._v(" "),o("div",{staticClass:"btn container-credits-btn",on:{click:e.toMall}},[o("div",{directives:[{name:"show",rawName:"v-show",value:null===(t=e.limitContent)||void 0===t?void 0:t.btnMini,expression:"limitContent?.btnMini"}],staticClass:"desc",attrs:{title:e.limitContent.btnMini}},[e._v("\n\t\t\t\t\t"+e._s(e.limitContent.btnMini)+"\n\t\t\t\t")]),e._v("\n\t\t\t\t"+e._s(e.limitContent.btn)+"\n\t\t\t")])])],2)}),[],!1,null,null,null);e.default=component.exports},350:function(t,e,n){"use strict";n(14),n(4);var o=n(54),r={name:"AddOrEditCanvas",data:function(){return{type:"add",isShowDialog:!1,canvasName:"",canvasId:"",btnLoading:!1}},computed:{},methods:{openDialog:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type=t,this.canvasId=e.id||"",this.canvasName=e.name||"",this.isShowDialog=!0},closeDialog:function(){this.isShowDialog=!1},handleConfirm:function(){this.btnLoading=!0,"add"===this.type?this.addCanvas():this.editCanvas()},addCanvas:function(){var t=this;if(!this.canvasName.length)return this.$message.warning(this.$t("CanvasNameWarning")),void(this.btnLoading=!1);Object(o.a)({name:this.canvasName}).then((function(){t.$message.success(t.$t("CreateSuccess")),t.closeDialog(),t.$emit("updateList")})).finally((function(){t.btnLoading=!1}))},editCanvas:function(){var t=this;if(!this.canvasName.length)return this.$message.warning(this.$t("CanvasNameWarning")),void(this.btnLoading=!1);Object(o.J)({id:this.canvasId,name:this.canvasName}).then((function(){t.$message.success(t.$t("SuccessfullyModified")),t.closeDialog(),t.$emit("updateList")})).finally((function(){t.btnLoading=!1}))}}},l=r,c=(n(2496),n(0)),component=Object(c.a)(l,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"add-or-edit-canvas custom-dialog-canvas",attrs:{width:"475px","append-to-body":"",title:t.$t("add"===t.type?"AddCanvas":"EditCanvas"),visible:t.isShowDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){t.isShowDialog=e}}},[e("div",{staticClass:"label"},[t._v(t._s(t.$t("CanvasName")))]),t._v(" "),e("el-input",{staticClass:"canvas-name-input",attrs:{placeholder:"",maxlength:"15"},model:{value:t.canvasName,callback:function(e){t.canvasName=e},expression:"canvasName"}}),t._v(" "),e("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.closeDialog}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{attrs:{loading:t.btnLoading},on:{click:t.handleConfirm}},[t._v(t._s(t.$t("Confirm"))+" ")])],1)],1)}),[],!1,null,"1bd13737",null);e.a=component.exports},353:function(t,e,n){"use strict";n(28);var o={name:"creaCharacterConfirmModal",data:function(){return{visible:!1,options:null}},props:{dialogWidth:{type:Number,default:407}},methods:{show:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetData(),this.options=t,this.visible=!0},resetData:function(){this.options=null},handleClose:function(){this.visible=!1,this.$emit("cancel")},handleConfirm:function(){var t,e,n;null!==(t=this.options)&&void 0!==t&&t.customClose||(this.visible=!1),this.$emit("confirm",{type:null===(e=this.options)||void 0===e?void 0:e.handleMethods,id:(null===(n=this.options)||void 0===n?void 0:n.id)||""})}}},r=o,l=(n(2681),n(0)),component=Object(l.a)(r,(function(){var t,e,n=this,o=n._self._c;return o("el-dialog",{attrs:{"close-on-press-escape":!1,"close-on-click-modal":!1,visible:n.visible,"custom-class":"common-confirm-modal custom-dialog","destroy-on-close":!1,"modal-append-to-body":"","append-to-body":"",width:n.dialogWidth+"px"},on:{"update:visible":function(t){n.visible=t}}},[o("div",{staticClass:"confirm-modal-header"},[o("div",{staticClass:"modal-header-title"},[n._v(n._s((null===(t=n.options)||void 0===t?void 0:t.title)||n.$t("Tip")))]),n._v(" "),o("span",{staticClass:"modal-header-close",on:{click:function(t){return t.stopPropagation(),n.handleClose()}}},[o("i",{staticClass:"el-icon-close"})])]),n._v(" "),n._t("custom_content",(function(){var t,e,r;return[o("div",{staticClass:"confirm-modal-content"},[o("div",{staticClass:"modal-content-left"},[o("div",{staticClass:"warning-icon-box"},[o("i",{staticClass:"iconfont icon-warn"})])]),n._v(" "),o("div",{staticClass:"modal-content-right"},[o("div",{staticClass:"modal-content-right-title"},[n._v(n._s((null===(t=n.options)||void 0===t?void 0:t.mainTitle)||n.$t("createCharacterTip")))]),n._v(" "),null!==(e=n.options)&&void 0!==e&&e.subTitle?[Array.isArray(n.options.subTitle)?n._l(n.options.subTitle,(function(t,e){return o("div",{key:e,staticClass:"modal-content-right-sub-title",domProps:{innerHTML:n._s(t)}})})):[o("div",{staticClass:"modal-content-right-sub-title"},[n._v("\n              "+n._s(null===(r=n.options)||void 0===r?void 0:r.subTitle)+"\n            ")])]]:n._e()],2)])]})),n._v(" "),o("div",{staticClass:"confirm-modal-footer"},[null!==(e=n.options)&&void 0!==e&&e.hideClose?n._e():o("span",{staticClass:"modal-footer-btn modal-footer-btn-cancel",on:{click:function(t){return t.stopPropagation(),n.handleClose()}}},[n._v(n._s(n.$t("Cancel")))]),n._v(" "),o("span",{staticClass:"modal-footer-btn modal-footer-btn-confirm",on:{click:function(t){return t.stopPropagation(),n.handleConfirm()}}},[n._v(n._s(n.$t("Confirm")))])])],2)}),[],!1,null,"7565a348",null);e.a=component.exports},505:function(t,e,n){"use strict";n(14),n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),r=n(92),l=n(115),c=n(106),d=n(5),h=n(186),v=n(1),m=n(33),f=n(21),_={props:{fromPage:{type:String,default:""},item:{type:Object,default:function(){}},isCheck:{type:Boolean,default:!1},isMine:{type:Boolean,default:!1}},data:function(){return{}},methods:{handlePopoverShow:function(){this.$emit("handlePopoverShow")},moreActions:function(t){this.$emit("moreActions",t)}}},y=(n(2323),n(0)),w=Object(y.a)(_,(function(){var t,e=this,n=e._self._c;return n("el-popover",{directives:[{name:"show",rawName:"v-show",value:!e.isCheck,expression:"!isCheck"}],ref:"myPopover",attrs:{placement:"top-end","popper-class":"water-fall-popover","append-to-body":!0,"visible-arrow":!1,width:"100",trigger:"hover"},on:{show:e.handlePopoverShow}},[n("div",{staticClass:"pop-btns flex"},["userPage"==e.fromPage&&e.isMine?n("button",{on:{click:function(t){return t.preventDefault(),e.moreActions("pinOrNot")}}},[e._v("\n      "+e._s(e.$t(null!==(t=e.item)&&void 0!==t&&t.isTop?"UnpinOverview":"PinOverview"))+"\n    ")]):e._e(),e._v(" "),e.isMine?n("button",{on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.moreActions("edit")}}},[e._v("\n      "+e._s(e.$t("Edit"))+"\n    ")]):e._e(),e._v(" "),n("button",{on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.moreActions("report")}}},[n("span",{staticClass:"pop-btns-text"},[e._v(e._s(e.$t("Report")))]),e._v(" "),n("span",{staticClass:"pop-btns-icon"},[n("svg-icon",{attrs:{"icon-class":"task-report-icon"}})],1)]),e._v(" "),e.isMine?n("button",{on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.moreActions("delete")}}},[e._v("\n      "+e._s(e.$t("Delete"))+"\n    ")]):e._e()]),e._v(" "),n("div",{staticClass:"item-cover-operate",attrs:{slot:"reference"},on:{click:function(t){t.preventDefault(),t.stopPropagation()}},slot:"reference"},[n("i",{staticClass:"iconfont icon-more"})])])}),[],!1,null,"42cda482",null).exports,C={components:{HandlePopover:w},props:{name:{type:String,default:""},desc:{type:String,default:""}}},k=(n(2324),Object(y.a)(C,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"hover-mask"},[e("div",{staticClass:"mask-head"},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.name,expression:"name"}]},[t._v(t._s(t.name))]),t._v(" "),t._t("default")],2),t._v(" "),e("div",{staticClass:"mask-info"},[t._v("\n          "+t._s(t.desc)+"\n        ")])])}),[],!1,null,"1f1df72e",null).exports),O=n(24),x=n(30);function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var S={components:{ImgWaterFall:r.a,AiChatReport:h.a,listCheckbox:l.a,HandlePopover:w,HoverMask:k,AdminTag:c.a},mixins:[m.a],props:{fromPage:{type:String,default:""},item:{type:Object,default:function(){}},isCheck:{type:Boolean,default:!1},activateTab:{type:String,default:""},dotReportInfo:{type:Object,default:function(){return{category:"default",view_domain:"",batch_id:""}}},review:{type:Boolean,default:!1}},data:function(){return{formatNumberForeign:d.i}},computed:D(D(D({},Object(v.e)("user",["token","userInfo"])),Object(v.e)("payment",["productLevel"])),{},{isMine:function(){var t,e;return(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)==(null===(e=this.userInfo)||void 0===e?void 0:e.id)},isLoggedIn:function(){return this.token},isRecommend:function(){return"feature"===this.activateTab},itemStyle:function(){return{width:this.item.waterWidth+"px",height:this.item.waterHeight+"px"}},boxStyle:function(){var t=this.item.waterHeight;return this.isRecommend?{height:t-60+"px"}:{}},renderItem:function(){if(1===this.item.nsfw){var t=Object(O.cloneDeep)(this.item);return t.cover="https://image.cdn2.seaart.ai/static/upload/20231207/39b3e881-ae85-415d-b7aa-74182b3b6267.webp",t.replaceUrl="https://image.cdn2.seaart.ai/static/upload/20231207/39b3e881-ae85-415d-b7aa-74182b3b6267.webp",t}return this.item}}),methods:{handleClickToDetails:function(){var t;this.$logEvent("log_actions",{operation:"click_tavern",behavior_info:this.item.id,behavior_info_sub:"Home"}),this.$router.push(this.localePath("/cyberPubPage/".concat(null===(t=this.item)||void 0===t?void 0:t.id)))},goChat:function(){var t,e=this.item,n=e.id,o=e.obj_type,r=e.pt,l=e.stat;this.isCheck||(this.$logEvent("log_actions",{operation:"click_tavern",behavior_info:this.item.id,behavior_info_sub:"Home"}),Object(x.g)({items:[D(D({},this.dotReportInfo),{},{action:"view",obj_no:n,obj_type:o,batch_id:r,stat:l},this.productLevel&&{vip:this.productLevel})]}),this.$router.push(this.localePath("/aiChat/".concat(null===(t=this.item)||void 0===t?void 0:t.id))))},moreActions:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.item.obj_type;switch(e){case"edit":this.$logEvent("log_actions",{operation:"click_edit",behavior_info:"on_personal_center",behavior_info_sub:n}),this.$router.push(this.localePath("/cyberPubPage/new-character?id="+(null===(t=this.item)||void 0===t?void 0:t.id)));break;case"delete":this.$emit("moreActions","delete",this.item);break;case"pinOrNot":this.$emit("moreActions","pinOrNot",this.item);break;case"report":try{this.$logEvent("log_actions",{operation:"tavern_on_square",behavior_info:"click_report"}),this.$refs.AiChatReport.open()}catch(t){}break;case"share":this.$logEvent("log_actions",{operation:"click_share",behavior_info:"on_personal_center",behavior_info_sub:n}),this.handleShare()}},handleShare:function(){this.$logEvent("log_actions",{operation:"tavern_on_square",behavior_info:"click_share"});var t=location.origin;Object(d.d)(t+"/cyberPubPage/".concat(this.item.id)),this.$message.success(this.$t("CopiedURLToClipboard"))},otherUser:function(t){var e,n,path="/user/"+encodeURIComponent(t.author.id);(null===(e=this.userInfo)||void 0===e?void 0:e.id)==(null===(n=t.author)||void 0===n?void 0:n.id)&&(path="/personal"),window.open(this.localePath(path),"_blank")},tagChange:function(){this.$emit("change")},handlePopoverShow:function(){var t=this;if("userPage"===this.fromPage){var e=this.item,n=e.id,o=e.obj_type;Object(f.M)({obj_id:n,obj_type:o}).then((function(e){var n,o;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&t.$set(t.item,"isTop",null==e||null===(o=e.data)||void 0===o?void 0:o.is_top)}))}}}},P=S,L=(n(2325),Object(y.a)(P,(function(){var t,e,n,o,r,l,c,d,h,v,m,f,_,y,w,C,k,O,x=this,I=x._self._c;return I("a",{class:{"recommend-cyberpub":x.isRecommend},attrs:{href:x.localePath("/cyberPubPage/".concat(null===(t=x.item)||void 0===t?void 0:t.id))},on:{click:function(t){return t.preventDefault(),x.goChat.apply(null,arguments)}}},[I("div",{staticClass:"cyberBarItem",style:x.itemStyle,attrs:{"data-tag":x.$t("digitalHuman")}},[x.isCheck&&x.item?I("listCheckbox",{on:{change:function(t){return x.$emit("checkChange")}},model:{value:x.item.isCheck,callback:function(t){x.$set(x.item,"isCheck",t)},expression:"item.isCheck"}}):x._e(),x._v(" "),x.isRecommend?x._e():I("div",{staticClass:"name",attrs:{title:null===(e=x.item.character)||void 0===e?void 0:e.name},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),x.handleClickToDetails.apply(null,arguments)}}},[x._v("\n      "+x._s(null===(n=x.item.character)||void 0===n?void 0:n.name)+"\n    ")]),x._v(" "),I("div",{staticClass:"imgBox",style:x.boxStyle},[x.item.nsfw?I("ImgWaterFall",{style:{transition:"all 0.3s ease-in-out",transform:x.item.isCheck?"scale(0.85)":null},attrs:{isLazyload:!1,isHeight:!1,item:x.renderItem}}):x._e(),x._v(" "),I("div",{staticClass:"imgBox-num"},[I("div",{staticClass:"imgBox-num-item"},[I("i",{staticClass:"iconfont icon-users-solid imgBox-num-item-icon"}),x._v(" "),I("span",{staticClass:"imgBox-num-item-text"},[x._v("\n            "+x._s(x.formatNumberForeign((null===(o=x.item)||void 0===o||null===(o=o.stat)||void 0===o?void 0:o.num_of_token)||(null===(r=x.item)||void 0===r||null===(r=r.character)||void 0===r||null===(r=r.stat)||void 0===r?void 0:r.num_of_token)||0))+"\n          ")])]),x._v(" "),I("div",{staticClass:"imgBox-num-item",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),x.setCollect(x.item,"character")}}},[I("div",{staticClass:"imgBox-num-item-icon"},[I("i",{staticClass:"iconfont",class:x.setCollectData(x.item)})]),x._v(" "),I("span",{staticClass:"imgBox-num-item-text"},[x._v("\n            "+x._s(x.formatNumberForeign((null===(l=x.item)||void 0===l||null===(l=l.stat)||void 0===l?void 0:l.num_of_collection)||(null===(c=x.item)||void 0===c||null===(c=c.character)||void 0===c||null===(c=c.stat)||void 0===c?void 0:c.num_of_collection)||0))+"\n          ")])])]),x._v(" "),I("client-only",[x.isRecommend?I("hover-mask",{attrs:{name:null===(d=x.item.character)||void 0===d?void 0:d.name,desc:null===(h=x.item.character)||void 0===h?void 0:h.evaluation}},[I("handle-popover",{attrs:{fromPage:x.fromPage,isCheck:x.isCheck,isMine:x.isMine,item:x.item},on:{handlePopoverShow:x.handlePopoverShow,moreActions:x.moreActions}})],1):x._e(),x._v(" "),x.isRecommend?I("div",{staticClass:"waterfall-hover-try",on:{click:function(t){return t.preventDefault(),x.goChat.apply(null,arguments)}}},[x._v("\n          "+x._s(x.$t("gpt_tab_chat"))+"\n        ")]):x._e()],1),x._v(" "),I("admin-tag",{attrs:{id:x.item.id,item:x.item,type:"9",review:x.review},on:{change:x.tagChange}})],1),x._v(" "),x.isRecommend?x._e():[I("el-tooltip",{attrs:{"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"bottom"}},[I("div",{staticClass:"tooltip-txt",attrs:{slot:"content"},slot:"content"},[x._v("\n          "+x._s(null===(v=x.item.character)||void 0===v?void 0:v.evaluation)+"\n        ")]),x._v(" "),I("div",{staticClass:"desc"},[x._v(x._s(null===(m=x.item.character)||void 0===m?void 0:m.evaluation))])]),x._v(" "),I("div",{staticClass:"item-content-tags"},x._l(null===(f=x.item.character)||void 0===f?void 0:f.categories,(function(t,e){return I("span",{key:e+t.id,staticClass:"item-content-tags-item"},[x._v("\n          "+x._s(t.name)+"\n        ")])})),0)],x._v(" "),x.isRecommend?I("div",{staticClass:"cyberpub-name"},[x._v(x._s(null===(_=x.item.character)||void 0===_?void 0:_.name))]):x._e(),x._v(" "),I("div",{staticClass:"author",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[I("div",{staticClass:"author-box",on:{click:function(t){return x.otherUser(x.item)}}},[null!==(y=x.item.author)&&void 0!==y&&y.head?I("div",{staticClass:"authorHead"},[I("img",{directives:[{name:"webp",rawName:"v-webp",value:x.$imgL,expression:"$imgL"}],attrs:{src:null===(w=x.item.author)||void 0===w?void 0:w.head,alt:null===(C=x.item.author)||void 0===C?void 0:C.name}})]):I("div",{staticClass:"authorHead"},[x._v("\n            "+x._s(null===(k=x.item.author)||void 0===k?void 0:k.name[0])+"\n          ")]),x._v(" "),I("div",{staticClass:"authorName"},[I("span",[x._v(x._s(null===(O=x.item.author)||void 0===O?void 0:O.name))])])]),x._v(" "),x.isRecommend?x._e():I("handle-popover",{attrs:{fromPage:x.fromPage,isCheck:x.isCheck,isMine:x.isMine,item:x.item},on:{handlePopoverShow:x.handlePopoverShow,moreActions:x.moreActions}})],1)],2),x._v(" "),I("ai-chat-report",{ref:"AiChatReport",attrs:{"ai-chat-id":x.item.id}})],1)}),[],!1,null,"7936b41a",null));e.a=L.exports},527:function(t,e,n){"use strict";n(10),n(14),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),r=(n(9),n(85),n(16),n(28),n(89),n(18),n(1)),l=n(56),c=n(33),d=n(5),h=n(39),v=n(30);function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var _={name:"VideoInfo",mixins:[c.a],props:{authorInfo:{type:Object,default:function(){}},videoType:{type:Number,default:0},info:{type:Object,default:function(){}},tags:{type:Array,default:function(){return[]}}},components:{CollectPopover:l.a},computed:f(f(f(f({},Object(r.e)("user",["userInfo","token"])),Object(r.c)("user",["isLoggedIn","isCompanyAccount"])),Object(r.c)("payment",["paymentInfo"])),{},{headBg:function(){var t;return{"background-color":null!==(t=this.authorInfo)&&void 0!==t&&t.head?"transparent":"#ADB8CD"}},authorName:function(){var t,e,n=(null===(t=this.authorInfo)||void 0===t?void 0:t.name)||(null===(e=this.authorInfo)||void 0===e?void 0:e.id);return n?n[0].toUpperCase():"-"},inviteCode:function(){var t;return(null===(t=this.userInfo)||void 0===t?void 0:t.invite_user_code)||""},determineSelfWork:function(){var t,e;return(null===(t=this.authorInfo)||void 0===t?void 0:t.id)===(null===(e=this.userInfo)||void 0===e?void 0:e.id)},allFollows:function(){if(this.authorInfo.follower_cnt)return this.authorInfo.follower_cnt>999?(this.authorInfo.follower_cnt/1e3).toFixed(1)+"k":this.authorInfo.follower_cnt},showReport:function(){return[0,1,2].includes(this.videoType)},videoTypeKey:function(){return 9===this.videoType?"ai_video":"lookbook"},videoDesc:function(){var t,e;return(null===(t=this.info)||void 0===t?void 0:t.description)||(null===(e=this.info)||void 0===e?void 0:e.desc)||""}}),filters:{formatNumberForeign:d.i},data:function(){return{formatTime:h.b,formatNumberForeign:d.i,popovervisible:!1,dotReportInfo:{view_domain:"",batch_id:"",action:"",obj_no:"",obj_type:5,negative_ids:[],category:"default"}}},mounted:function(){},methods:{getPersonalInfoUrl:function(){var t,e,n=(null===(t=this.authorInfo)||void 0===t?void 0:t.id)||"",o=(null===(e=this.userInfo)||void 0===e?void 0:e.id)||"",path="/user/"+encodeURIComponent(n);return o==n&&(path="/personal"),path},jumpToOtherUser:function(){var path=this.getPersonalInfoUrl();this.$router.push(this.localePath(path))},handleFollow:function(){if(this.token){var t={0:"post",9:"ai_video"}[this.videoType]||"lookbook";this.setFollow(this.info,t)}else this.$EventBus.$emit("openLoginDialog")},handleLike:function(){this.$emit("infoDot","click_like"),this.setLike(this.info,this.videoTypeKey)},handleShare:function(){this.$emit("infoDot","click_share");var t=location.href+(this.inviteCode?"?u_code=".concat(this.inviteCode):"");this.$message.success(this.$t("CopiedURLToClipboard")),Object(d.d)(t)},handleMark:function(){this.isLoggedIn?this.setCollectData(this.videoData).includes("collect_selected")?(this.$refs.collectPopover.visible=!1,this.setCollect(this.videoData,this.videoTypeKey)):this.$refs.collectPopover.visible=!0:this.$EventBus.$emit("openLoginDialog")},handleTry:function(){if(this.isLoggedIn){var t={},path="",e=this.info,n=e.cover,o=n.height,r=n.width,l=n.url,c=e.template_id,d=e.template_url;1==this.videoType?(this.$logEvent("log_actions",{operation:"click_create_same_image",behavior_info:"on_show_me_detail_page"}),t={template_id:c,url:d,height:o,width:r,cover:l},path="ai-face-swap"):(t={template_id:c},path="ai-video-generator"),t=JSON.stringify(t),this.$router.push(this.localePath("/ai-tools/".concat(path,"?info=").concat(t)))}else this.$EventBus.$emit("openLoginDialog")},report:function(){var t=this;Object(v.q)({id:this.info.id,obj_type:5}).then((function(e){t.popovervisible=!1,t.$message({message:t.$t("ReportSuccess"),type:"success",duration:5e3})}))},tagClick:function(t){window.open(this.localePath("/tagInfo/ai-video/".concat(t.id)),"_blank")}}},y=(n(2534),n(0)),component=Object(y.a)(_,(function(){var t,e,n,o,r,l,c,d,h=this,v=h._self._c;return v("div",{staticClass:"video-info"},[v("div",{staticClass:"top-title w-full flex justify-between items-start"},[v("span",{staticClass:"title text-no-wrap-2"},[h._v(h._s((null===(t=h.info)||void 0===t?void 0:t.name)||(null===(e=h.info)||void 0===e?void 0:e.title)||""))]),h._v(" "),[1,3].includes(h.videoType)?v("button",{staticClass:"button-try",on:{click:h.handleTry}},[h._v("\n      "+h._s(h.$t("Remix"))+"\n    ")]):h._e()]),h._v(" "),v("div",{staticClass:"user-btns flex justify-between items-center"},[h.authorInfo?v("div",{staticClass:"left flex"},[v("div",{staticClass:"head",style:h.headBg,on:{click:h.jumpToOtherUser}},[null!==(n=h.authorInfo)&&void 0!==n&&n.head?v("img",{directives:[{name:"webp",rawName:"v-webp",value:h.$imgL,expression:"$imgL"}],staticClass:"avatar",attrs:{src:null===(o=h.authorInfo)||void 0===o?void 0:o.head,loading:"lazy",width:"40",height:"40",alt:"avatar"}}):v("div",{staticClass:"letter"},[h._v("\n          "+h._s(h.authorName)+"\n        ")])]),h._v(" "),v("div",{staticClass:"name flex flex-col",on:{click:h.jumpToOtherUser}},[v("a",{staticClass:"personal-info-a",attrs:{href:h.getPersonalInfoUrl(),rel:"nofollow"},on:{click:function(t){t.preventDefault()}}},[h._v("\n          "+h._s(h.authorInfo.name||h.authorInfo.id)+"\n        ")]),h._v(" "),v("span",{directives:[{name:"show",rawName:"v-show",value:h.authorInfo.follower_cnt,expression:"authorInfo.follower_cnt"}]},[h._v(h._s(h.allFollows+" "+h.$t("Followers")))])]),h._v(" "),h.determineSelfWork?h._e():v("el-button",{staticClass:"follow",attrs:{loading:h.followLoading},on:{click:h.handleFollow}},[h._v("\n        "+h._s("followed"===h.setFollowData(h.info)?h.$t("Followed"):h.$t("Follow"))+"\n      ")])],1):h._e(),h._v(" "),v("div",{staticClass:"right"},[v("div",{staticClass:"line-2"},[v("div",{staticClass:"line-2-statistics"},[v("div",{staticClass:"item-statistics view"},[v("i",{staticClass:"iconfont icon-icon_Views"}),h._v(" "),v("span",[h._v(h._s(null===(r=h.info)||void 0===r||null===(r=r.stat)||void 0===r?void 0:r.num_of_view))])]),h._v(" "),v("div",{staticClass:"item-statistics",on:{click:h.handleLike}},[v("i",{staticClass:"iconfont",class:h.setlikeData(h.info)}),h._v(" "),v("span",[h._v(h._s(null===(l=h.info)||void 0===l||null===(l=l.stat)||void 0===l?void 0:l.num_of_like))])])]),h._v(" "),v("div",{staticClass:"line-2-share",on:{click:h.handleShare}},[v("i",{staticClass:"iconfont icon-share-icon"})]),h._v(" "),h.showReport?v("el-popover",{ref:"myPopover",attrs:{placement:"top-start","popper-class":"my-popover","visible-arrow":!1,width:"100",trigger:"manual"},model:{value:h.popovervisible,callback:function(t){h.popovervisible=t},expression:"popovervisible"}},[v("div",{staticClass:"pop-btns flex"},[v("button",{on:{click:h.report}},[h._v("\n              "+h._s(h.$t("Report"))+"\n            ")])]),h._v(" "),v("div",{staticClass:"line-2-share",staticStyle:{color:"#f1f1f1"},attrs:{slot:"reference"},on:{click:function(t){t.stopPropagation(),h.popovervisible=!h.popovervisible}},slot:"reference"},[v("i",{staticClass:"iconfont icon-more"})])]):h._e()],1)])]),h._v(" "),v("div",{staticClass:"bottom-info"},[v("div",{staticClass:"times"},[h._v("\n      "+h._s(h._f("formatNumberForeign")(null===(c=h.info)||void 0===c||null===(c=c.stat)||void 0===c?void 0:c.num_of_view))+"\n      "+h._s(h.$t("watchNum"))+" "+h._s(h.formatTime(null===(d=h.info)||void 0===d?void 0:d.create_at))+"\n    ")]),h._v(" "),v("div",{directives:[{name:"show",rawName:"v-show",value:h.videoDesc,expression:"videoDesc"}],staticClass:"description text-no-wrap-2"},[h._v("\n      "+h._s(h.videoDesc)+"\n    ")]),h._v(" "),v("div",{staticClass:"video-tags"},h._l(h.tags,(function(t){return v("div",{key:t.id,staticClass:"item-tag flex-center"},[v("a",{attrs:{target:"_self",href:"/tagInfo/ai-video/"+t.id},on:{click:function(e){return e.preventDefault(),h.tagClick(t)}}},[h._v("#"+h._s((null==t?void 0:t.title)||(null==t?void 0:t.id)))])])})),0)])])}),[],!1,null,"11d56d0d",null);e.a=component.exports},528:function(t,e,n){"use strict";n(28);var o=n(134),r={name:"VideoComments",props:{videoType:{type:Number,default:0},videoInfo:{type:Object,default:function(){}}},components:{cmtComments:o.a},computed:{},data:function(){return{}},created:function(){},mounted:function(){},methods:{}},l=(n(2535),n(0)),component=Object(l.a)(r,(function(){var t,e=this,n=e._self._c;return n("div",{staticClass:"video-comments"},[null!==(t=e.videoInfo)&&void 0!==t&&t.id?n("cmtComments",{attrs:{infos:e.videoInfo,type:9===e.videoType?15:5}}):e._e()],1)}),[],!1,null,"36dc408a",null);e.a=component.exports},529:function(t,e,n){"use strict";n(14),n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),r=n(1),l=n(5),c=n(556);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var v={name:"VideoAiPerson",mixins:[n(33).a],props:{personData:{type:Array,default:function(){return[]}}},components:{PersonInfo:c.a},computed:h(h({},Object(r.c)("user",["isLoggedIn"])),{},{personInfo:function(){return this.personData.length?this.personData[0]:{}}}),data:function(){return{formatNumberForeign:l.i}},mounted:function(){},methods:{goChatDetail:function(){var t;this.isLoggedIn?this.$router.push(this.localePath("/cyberPubPage/".concat(null===(t=this.personInfo)||void 0===t?void 0:t.id))):this.$EventBus.$emit("openLoginDialog")},goChat:function(){var t;this.isLoggedIn?(this.$logEvent("log_actions",{operation:"click_go_to_chat",behavior_info:"on_ai_video_detail_page"}),this.$router.push(this.localePath("/aiChat/".concat(null===(t=this.personInfo)||void 0===t?void 0:t.id)))):this.$EventBus.$emit("openLoginDialog")},goTag:function(t){}}},m=(n(2537),n(0)),component=Object(m.a)(v,(function(){var t,e,n,o,r,l,c=this,d=c._self._c;return d("div",{staticClass:"ai-person"},[null!==(t=c.personInfo)&&void 0!==t&&t.id?d("div",{staticClass:"video-Ai-Person",on:{click:c.goChat}},[d("div",{staticClass:"bg-cover w-full"}),c._v(" "),d("div",{staticClass:"bg-hold w-full"},[d("img",{directives:[{name:"webp",rawName:"v-webp",value:c.$imgL,expression:"$imgL"}],attrs:{src:null===(e=c.personInfo)||void 0===e||null===(e=e.cover)||void 0===e?void 0:e.url,alt:"cover",loading:"lazy",width:"425",height:"58"}})]),c._v(" "),d("div",{staticClass:"content flex"},[d("div",{staticClass:"left-img",on:{click:function(t){return t.stopPropagation(),c.goChatDetail.apply(null,arguments)}}},[d("img",{directives:[{name:"webp",rawName:"v-webp",value:c.$imgL,expression:"$imgL"}],attrs:{src:null===(n=c.personInfo)||void 0===n||null===(n=n.cover)||void 0===n?void 0:n.url,alt:"cover",loading:"lazy",width:"114",height:"162"}})]),c._v(" "),d("div",{staticClass:"right-content flex flex-col"},[d("div",{staticClass:"right-top flex justify-between"},[c.personInfo.author?d("PersonInfo",{attrs:{authorInfo:c.personInfo.author,fontStyle:{fontSize:"14px",color:"#FFFFFF",fontWeight:500},headStyle:{width:"28px",height:"28px",borderRadius:"50%",border:"1px solid #ffffff"}}}):c._e(),c._v(" "),d("div",{staticClass:"right-btns flex"},[d("div",{staticClass:"btns-item"},[d("i",{staticClass:"iconfont icon-users-solid imgBox-num-item-icon"}),c._v(" "),d("span",{staticClass:"imgBox-num-item-text"},[c._v("\n                "+c._s(c.formatNumberForeign((null===(o=c.personInfo)||void 0===o||null===(o=o.stat)||void 0===o?void 0:o.num_of_token)||0))+"\n              ")])]),c._v(" "),d("div",{staticClass:"btns-item",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),c.setCollect(c.personInfo,"character")}}},[d("div",{staticClass:"imgBox-num-item-icon"},[d("i",{staticClass:"iconfont",class:c.setCollectData(c.personInfo)})]),c._v(" "),d("span",{staticClass:"imgBox-num-item-text"},[c._v("\n                "+c._s(c.formatNumberForeign((null===(r=c.personInfo)||void 0===r||null===(r=r.stat)||void 0===r?void 0:r.num_of_collection)||0))+"\n              ")])])])],1),c._v(" "),d("div",{staticClass:"right-middle flex flex-col"},[d("div",{staticClass:"desc text-no-wrap-2"},[c._v(c._s(c.personInfo.evaluation))]),c._v(" "),null!==(l=c.personInfo)&&void 0!==l&&null!==(l=l.categories)&&void 0!==l&&l.length?d("div",{staticClass:"tags flex"},c._l(c.personInfo.categories,(function(t,e){return d("span",{key:"tag"+e,staticClass:"tag",on:{click:function(e){return c.goTag(t)}}},[c._v(c._s(t.name))])})),0):c._e()]),c._v(" "),d("div",{staticClass:"right-bottom flex"},[d("span",{staticClass:"go-to-person flex"},[c._v("\n            "+c._s(c.$t("goChat"))+"\n          ")])])])])]):c._e()])}),[],!1,null,"b700b3b2",null);e.a=component.exports},530:function(t,e,n){"use strict";n(14),n(16),n(28),n(4),n(23),n(37),n(29);var video=n(426),o=n(5),r=n(556),l={name:"VideoRelated",mixins:[n(33).a],props:{videoType:{type:Number,default:0},objType:{type:Number,default:5},isAudioBook:{type:Boolean,default:!1}},components:{PersonInfo:r.a},computed:{videoTime:function(){return function(t){var e;return null==t||null===(e=t.look_book)||void 0===e?void 0:e.duration}},isAiVideo:function(){return 9===this.videoType},isRotate:function(){var t=this;return function(e){return!(t.isAiVideo&&!t.isAudioBook)&&(null==e?void 0:e.cover_width)<(null==e?void 0:e.cover_height)}},dotSource:function(){return this.isAudioBook?"audio_book":this.isAiVideo?"ai_short":"lookbook"}},data:function(){return{timeFormat:o.F,formatNumberForeign:o.i,iconLoad:!1,videoList:[],loading:!1}},methods:{getVideoRelated:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.$route.params.id;if(n){var p={obj_id:n,obj_type:this.objType,page_size:20};e&&(p.scene="click_change"),this.loading=!0,Object(video.a)(p).then((function(e){var n;t.videoList=(null==e||null===(n=e.data)||void 0===n?void 0:n.items)||[],t.videoList[0]&&t.$emit("nextVideo",t.videoList[0].id)})).finally((function(){t.loading=!1}))}},changeData:function(){this.$logEvent("log_actions",{operation:"click_switch",behavior_info:"on_ai_video_detail_page",behavior_info_sub:this.$route.params.id,source:this.dotSource}),this.setIconLoad(),this.getVideoRelated(!0)},setIconLoad:function(){var t=this;this.iconLoad=!0;var e=setTimeout((function(){t.iconLoad=!1,clearTimeout(e)}),500)},toVideo:function(t){var path=5===this.objType?"/video/":"/ai-video/detail/";this.$router.replace(this.localePath("".concat(path).concat(null==t?void 0:t.id)))}}},c=l,d=(n(2538),n(0)),component=Object(d.a)(c,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"video-related"},[e("div",{staticClass:"top flex justify-between items-center"},[e("div",{staticClass:"name"},[t._v(t._s(t.$t("relatedRecommend")))]),t._v(" "),e("div",{staticClass:"btn",on:{click:t.changeData}},[e("i",{staticClass:"iconfont icon-changeit",class:{iconLoad:t.iconLoad}}),t._v("\n      "+t._s(t.$t("changeit"))+"\n    ")])]),t._v(" "),e("div",{staticClass:"video-cards"},t._l(t.videoList,(function(n,o){var r,l,c,d;return e("div",{key:"r_"+(null==n?void 0:n.id)+o,staticClass:"card",on:{click:function(e){return t.toVideo(n)}}},[e("div",{staticClass:"cover-img"},[t.videoTime(n)?e("div",{staticClass:"time-tag"},[t._v("\n          "+t._s(t.timeFormat(t.videoTime(n)))+"\n        ")]):t._e(),t._v(" "),null!=n&&n.cover?e("img",{directives:[{name:"webp",rawName:"v-webp",value:t.$imgL,expression:"$imgL"}],staticClass:"img-cover",class:{rotate:t.isRotate(n)},attrs:{src:null==n?void 0:n.cover,width:"190",height:"107",loading:"lazy",alt:"img-cover"}}):t._e()]),t._v(" "),e("div",{staticClass:"right-info flex flex-col justify-between"},[e("div",{staticClass:"upper flex flex-col"},[e("div",{staticClass:"title text-no-wrap-2"},[t._v("\n            "+t._s((null==n||null===(r=n.look_book)||void 0===r?void 0:r.name)||(null==n||null===(l=n.ai_video)||void 0===l?void 0:l.title))+"\n          ")]),t._v(" "),t.isAiVideo?e("div",{staticClass:"imgNum"},[e("span",[t._v(t._s(t.$t("episodeNum",{num:(null==n||null===(c=n.ai_video)||void 0===c?void 0:c.max_episode)||0})))])]):t._e(),t._v(" "),n.author&&!t.isAiVideo?e("PersonInfo",{attrs:{authorInfo:n.author,headStyle:{width:"20px",height:"20px",borderRadius:"50%"}}}):t._e()],1),t._v(" "),e("div",{staticClass:"down"},[e("div",{staticClass:"btns-item"},[e("i",{staticClass:"iconfont icon-icon_Views"}),t._v(" "),e("span",{staticClass:"imgBox-num-item-text"},[t._v("\n              "+t._s(t.formatNumberForeign((null==n||null===(d=n.stat)||void 0===d?void 0:d.num_of_view)||0))+"\n            ")])])])])])})),0)])}),[],!1,null,"3c7aa535",null);e.a=component.exports},534:function(t,e,n){"use strict";var o=n(42),r={props:{isSkip:{type:Boolean,default:!0}},data:function(){return{}},mounted:function(){},computed:{isZhCN:function(){return"zhCN"===this.$i18n.locale}},methods:{login:function(t){var e="login"===t?"click_login_button":"click_register_button";this.logEvent(e),Object(o.l)()?window.open("/home","_self"):this.$EventBus.$emit("openLoginDialog",{redirect:this.isSkip?"/home":""})},toDiscord:function(){this.logEvent("click_dc_button"),window.open("https://discord.com/invite/gUHDU644vU","_blank")},toEnterprise:function(){this.logEvent("click_pro_button"),window.open("/businessPage","_self")},openChatDialog:function(){this.logEvent("click_qqwx_button"),this.$EventBus.$emit("openJoinGroupModal","")},logEvent:function(t){this.$logEvent("log_actions",{operation:t,behavior_info:"visitor_landing_page"})}}},l=(n(2616),n(0)),component=Object(l.a)(r,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"landing-page-header"},[e("div",{staticClass:"left-container"},[e("img",{staticClass:"logo",attrs:{src:n(124),alt:"Avatar"}}),t._v(" "),e("span",{staticClass:"slogan"},[t._v(t._s(t.$t("SeaArt")))]),t._v(" "),e("span",{staticClass:"ai"},[t._v(".AI")])]),t._v(" "),e("div",{staticClass:"right-container"},[t.isZhCN?e("div",{staticClass:"chat-app",on:{click:t.openChatDialog}},[e("i",{staticClass:"iconfont icon-users-solid"}),t._v(" "),e("span",{staticClass:"words"},[t._v("QQ、微信交流")])]):e("div",{staticClass:"discord",on:{click:t.toDiscord}},[e("img",{staticClass:"discord-icon",attrs:{alt:"discord-icon",src:n(449)}}),t._v(" "),e("span",{staticClass:"words"},[t._v("Discord")])]),t._v(" "),e("el-button",{staticClass:"sign-up",on:{click:function(e){return t.login("register")}}},[t._v("\n\t\t\t\t"+t._s(t.$t("Register"))+"\n\t\t\t")]),t._v(" "),e("el-button",{staticClass:"log-in",on:{click:function(e){return t.login("login")}}},[t._v("\n\t\t\t\t"+t._s(t.$t("Login"))+"\n\t\t\t")])],1)])}),[],!1,null,"d1cf2be0",null);e.a=component.exports},535:function(t,e,n){"use strict";n(10),n(14),n(9),n(11),n(12),n(8),n(6);var o=n(15),r=n(2),l=(n(16),n(7),n(32),n(19),n(4),n(1)),c=n(56),d=n(13);function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var m={name:"soundItem",components:{AudioPlayer:n(150).a,CollectPopover:c.a},data:function(){return{playIconCustomStyle:{position:"absolute",right:"11px",bottom:"9px",zIndex:"999"}}},props:{showHandle:{type:Boolean,default:!0},item:{type:Object,default:function(){}},imgStyle:{type:String,default:"contain"},domId:{type:String,default:""}},computed:v(v({},Object(l.c)("user",["isLoggedIn"])),{},{imgUrl:function(){var t=this.item||{},e="";return t.cover?e=t.cover:t.cover.cover?e=t.cover.cover:e},selfTag:function(){var t,e,n=[];null!==(t=this.item)&&void 0!==t&&null!==(t=t.tags)&&void 0!==t&&t.length&&(n=null===(e=this.item)||void 0===e?void 0:e.tags.map((function(t){return t.title})));return n},attrTags:function(){var t=this,e=[];if(this.item){var n,r,l,c=[],h=[],v=[];if(this.item.gender){var m=d.z.filter((function(e){return e.value===t.item.gender}))||[];m.length&&h.push(m[0].i18Key)}if(this.item.age){var f=d.z.filter((function(e){return e.value===t.item.age}))||[];f.length&&c.push(f[0].i18Key)}if(null!==(n=this.item)&&void 0!==n&&n.tones&&null!==(r=this.item)&&void 0!==r&&r.tones.length)v=null===(l=this.item)||void 0===l?void 0:l.tones.map((function(t){var e=d.z.find((function(e){return e.value===t}));return e?e.i18Key:""}));return e=[].concat(c,h,Object(o.a)(v))}return e}}),methods:{handleClickCollect:function(t){var e=this;this.$logEvent("log_actions",{operation:"click_quick_collect",behavior_info:"on_choose_audio_popup"}),this.isLoggedIn||(t.stopPropagation(),this.$EventBus.$emit("openLoginDialog",{callBack:function(){return e.$emit("newChat")}}))},handleDetail:function(){this.$logEvent("log_actions",{operation:"click_detail",behavior_info:"on_choose_audio_popup"});var t=this.localePath("/ai-audio/detail/".concat(this.item.id));window.open(t,"_blank")}}},f=(n(2664),n(0)),component=Object(f.a)(m,(function(){var t,e,n,o,r,l,c=this,d=c._self._c;return d("div",{staticClass:"sound-item",on:{click:function(t){return c.$emit("handleSelect")}}},[c._t("default"),c._v(" "),c.showHandle?d("div",{staticClass:"cltpop",on:{click:function(t){t.stopPropagation()}}},[d("div",{staticClass:"collect-popover-container",on:{click:function(t){return t.stopPropagation(),c.handleClickCollect.apply(null,arguments)}}},[d("CollectPopover",{attrs:{type:"ai_audio",folder:c.item,from:"waterfall"}})],1),c._v(" "),d("div",{staticClass:"detail-button",on:{click:function(t){return t.stopPropagation(),c.handleDetail(c.item)}}},[c._v("\n      "+c._s(c.$t("Details"))+"\n    ")])]):c._e(),c._v(" "),d("div",{staticClass:"left"},[d("AudioPlayer",{attrs:{logParams:{operation:"click_audition",behavior_info:"on_voice_select_pop",behavior_info_sub:"vioce_name=".concat(null===(t=c.item)||void 0===t?void 0:t.name)},domId:c.domId,modelPlay:"",playIconCustomStyle:c.playIconCustomStyle,item:c.item}}),c._v(" "),["",null,void 0].includes(null===(e=c.item)||void 0===e?void 0:e.cover)?[d("div",{staticClass:"image-empty-sound"},[c._v(c._s(c.$t("EmptyBannerText")))])]:[d("el-image",{staticClass:"list-item-image-card-image",attrs:{fit:c.imgStyle,src:null===(n=c.item)||void 0===n?void 0:n.cover}},[d("template",{slot:"error"},[d("img",{directives:[{name:"webp",rawName:"v-webp",value:c.$imgL,expression:"$imgL"}],staticClass:"error-img",staticStyle:{width:"110px",height:"110px","border-radius":"8px"},attrs:{src:null===(o=c.item)||void 0===o?void 0:o.cover,alt:null===(r=c.item)||void 0===r?void 0:r.name}})])],2)]],2),c._v(" "),d("div",{staticClass:"right",style:{justifyContent:c.attrTags.length||c.selfTag.length?"center":"flex-start"}},[d("div",{staticClass:"right-name",style:{marginTop:c.attrTags.length||c.selfTag.length?"0px":"10px"}},[c._v(c._s(null===(l=c.item)||void 0===l?void 0:l.name)+"\n    ")]),c._v(" "),d("div",{staticClass:"right-tags"},[c.attrTags.length?c._l(c.attrTags,(function(t,e){return d("div",{key:t+e,staticClass:"tag-item"},[c._v("\n          "+c._s(c.$t(t))+"\n        ")])})):c._e(),c._v(" "),c.selfTag.length?c._l(c.selfTag,(function(t,e){return d("div",{key:t+e,staticClass:"tag-item"},[c._v("\n          "+c._s(t)+"\n        ")])})):c._e()],2)])],2)}),[],!1,null,"f25e2cfc",null);e.a=component.exports},538:function(t,e,n){"use strict";n(4);var o=n(126),r={data:function(){return{isShowPopup:!1,loading:!1,submitEvent:null,session_id:""}},methods:{open:function(t,e){this.submitEvent=e,this.session_id=t,this.isShowPopup=!0},close:function(){this.isShowPopup=!1},submit:function(){var t=this;this.loading=!0,Object(o.d)({id:this.session_id}).then((function(e){t.submitEvent&&t.submitEvent(e),t.$message.success(t.$t("deleteSuccess")),t.close()})).finally((function(){t.loading=!1}))}}},l=(n(2678),n(0)),component=Object(l.a)(r,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"custom-dialog delchat-popup",attrs:{visible:t.isShowPopup,"append-to-body":!0,"before-close":t.close},on:{"update:visible":function(e){t.isShowPopup=e}}},[e("div",{staticClass:"popup-body"},[e("div",{staticClass:"title"},[e("i",{staticClass:"iconfont icon-Vector"}),t._v(t._s(t.$t("DelAiChatTitle"))+"\n    ")]),t._v(" "),e("div",{staticClass:"popup-desc"},[t._v("\n      "+t._s(t.$t("DelAiChatDesc1"))+"\n    ")])]),t._v(" "),e("div",{staticClass:"handle-btn",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{staticClass:"cancel-btn",attrs:{type:"default"},on:{click:t.close}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{staticClass:"submit-btn",attrs:{type:"default",loading:t.loading},on:{click:t.submit}},[t._v(t._s(t.$t("Confirm")))])],1)])}),[],!1,null,"38cb3fe7",null);e.a=component.exports},539:function(t,e,n){"use strict";n(14),n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),r=(n(10),n(18),n(212)),l=n(5),c=n(1);n(78);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var v={components:{selectSoundModel:r.a},props:["info","timbreObj"],data:function(){return{coins:[{name:"credit",icon:n(279),type:"calculateCoins",desc:"new_credit_desc"},{name:"stamina",icon:n(280),type:"tempCoins",desc:"new_stamina_desc"}]}},computed:h(h(h(h({},Object(c.c)("user",["isLoggedIn"])),Object(c.e)("payment",["paymentInfo"])),Object(c.e)("user",["userInfo"])),{},{showVoiceIcon:function(){var t,e,n=(null===(t=this.userInfo)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.lang_code)||this.$i18n.locale;return["zhCN","zhTW","ja","en"].includes(n)&&this.$route.name.includes("aiChat")&&1===(null===(e=this.info)||void 0===e?void 0:e.support_voice)},getCoinTitle:function(){var t=this;return function(e){return t.$t(e.type)+"："+t.$t("balance")+" "+(t.paymentInfo[e.type]||0)+", "+t.$t(e.desc)}}}),filters:{formatNumberForeign:l.i},methods:{newChat:function(){console.log("触发"),this.$emit("newChat")},selectModel:function(t){this.$emit("updateTimbreObj",t,"顶部更新音色"),this.$refs.selectSoundModel.handleClose()},handleSelectSound:function(){var t;this.$logEvent("log_actions",{operation:"vioce_select",behavior_info:"on_tarven_detail_page"}),this.$logEvent("log_actions",{operation:"voice_select_pop_show",behavior_info:"on_voice_select_pop"}),null===(t=this.$refs.selectSoundModel)||void 0===t||t.openModal()},toMall:function(t){var e=this;if(this.$logEvent("log_actions",{operation:"click_mall",behavior_info:"on_tavern_sidebar"}),this.isLoggedIn){var n=this.localePath("/mall");window.open(n+t,"_blank")}else this.$EventBus.$emit("openLoginDialog",{callBack:function(){return e.$emit("newChat")}})},openSetting:function(){this.$emit("openSetting"),this.$logEvent("log_actions",{operation:"click_sidebar",behavior_info:"on_chat_detail_page"})},toggleMenu:function(){this.$EventBus.$emit("$_toggleLeftMenu")}}},m=(n(2679),n(0)),component=Object(m.a)(v,(function(){var t,e,o,r=this,l=r._self._c;return l("div",{staticClass:"aichat-head"},[l("div",{staticClass:"flex_m"},[l("div",{directives:[{name:"show",rawName:"v-show",value:r.isLoggedIn,expression:"isLoggedIn"}],staticClass:"detail-menu-icon flex_c_m",on:{click:r.toggleMenu}},[l("i",{staticClass:"iconfont icon-menu"})]),r._v(" "),l("a",{staticClass:"logo flex-center",attrs:{href:r.localePath("/")}},[l("img",{attrs:{src:n(124),alt:""}}),r._v(" "),l("p",[r._v(r._s(r.$t("SeaArt")))])])]),r._v(" "),l("div",{staticClass:"info flex-center"},[r.showVoiceIcon?l("div",{staticClass:"voice-status",on:{click:r.handleSelectSound}},[r._m(0),r._v(" "),l("span",{staticClass:"tip"},[r._v(r._s((null===(t=r.timbreObj)||void 0===t?void 0:t.name)||r.$t("Pls_select")))]),r._v(" "),l("i",{staticClass:"el-icon-arrow-right"})]):r._e(),r._v(" "),l("div",{staticClass:"info-item asset-item flex-center",attrs:{title:r.getCoinTitle(r.coins[0])},on:{click:function(t){return r.toMall("?openTab=Credit&dotFrom=on_tavern_sidebar")}}},[l("img",{attrs:{src:n(279),alt:""}}),r._v(" "),l("span",[r._v(r._s(r._f("formatNumberForeign")(r.paymentInfo.calculateCoins)))])]),r._v(" "),l("div",{staticClass:"info-item asset-item flex-center",attrs:{title:r.getCoinTitle(r.coins[1])},on:{click:function(t){return r.toMall("?openTab=Credit&dotFrom=on_tavern_sidebar")}}},[l("img",{attrs:{src:n(280),alt:""}}),r._v(" "),l("span",[r._v(r._s(r._f("formatNumberForeign")(r.paymentInfo.tempCoins)))])]),r._v(" "),l("div",{staticClass:"info-item vip-item",on:{click:function(t){return r.toMall("?dotFrom=on_tavern_sidebar")}}},[l("img",{attrs:{src:n(319),alt:""}})]),r._v(" "),l("div",{staticClass:"info-item info-set flex-center",on:{click:r.openSetting}},[l("i",{staticClass:"iconfont icon-workflow_icon_list"})])]),r._v(" "),l("selectSoundModel",{ref:"selectSoundModel",attrs:{selectList:null!==(e=r.timbreObj)&&void 0!==e&&e.id?[null===(o=r.timbreObj)||void 0===o?void 0:o.id]:[]},on:{newChat:r.newChat,selectModel:r.selectModel}})],1)}),[function(){var t=this._self._c;return t("div",{staticClass:"voice-icon"},[t("i",{staticClass:"iconfont icon-icon-video1"})])}],!1,null,"4fafbe62",null);e.a=component.exports},540:function(t,e,n){"use strict";n(14);var o=n(15),r=n(3),l=(n(20),n(16),n(47),n(10),n(43),n(23),n(18),n(76),n(37),n(71),n(353)),c=n(26),d={components:{ConfirmModal:l.a},props:{characterId:{type:String,default:""},historyStack:{type:Array,default:function(){return[]}},onlyBack:{type:Boolean,default:!1},fromPage:{type:String,default:""},characterInfo:{type:Object,default:function(){}}},data:function(){return{editIndex:null,curHandle:"edit",isShowLast:!1,editForm:{title:"",id:""},rules:{title:[{required:!0,message:this.$t("enterName"),trigger:"blur"}]},manageMenu:[{title:"Edit",icon:"icon-icon-edit2",key:"edit"},{title:"Delete",icon:"icon-icon-delete",key:"delete"}]}},computed:{lastChatList:{get:function(){var t;return(null===(t=this.characterInfo)||void 0===t?void 0:t.latest_session)||[]},set:function(t){this.characterInfo&&(this.characterInfo.latest_session=t)}}},methods:{handleActions:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};console.log("更多操作--",data);var e=t.key,n=void 0===e?"":e,o=data.session_id,r=void 0===o?"":o;switch(this.curHandle=n,this.$logEvent("log_actions",{operation:"click_".concat(n),behavior_info:"on_tarven_detail_page",behavior_info_sub:"last_chat"}),this.editIndex=this.lastChatList.findIndex((function(t){return t.session_id===r})),n){case"edit":this.editForm.title=data.name||this.formatTimestamp(data.create_at),this.editForm.id=data.session_id,this.$refs.confirmModal.show({title:this.$t("lastChatEditTitle"),customClose:!0});break;case"delete":this.$refs.confirmModal.show({id:r,subTitle:this.$t("lastChatDelTitle"),mainTitle:this.$t("lastChatDelMainTitle"),handleMethods:"Del"})}},submitForm:function(t){var e=arguments,n=this;return Object(r.a)(regeneratorRuntime.mark((function l(){var d,h,v,m;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(d=(e.length>1&&void 0!==e[1]?e[1]:{}).id,!(h=void 0===d?"":d)){l.next=8;break}return l.next=5,Object(c.j)({id:h});case 5:return m=l.sent,1e4===(null===(v=m.status)||void 0===v?void 0:v.code)&&(null!==n.editIndex&&(n.lastChatList.splice(n.editIndex,1),n.editIndex=null),n.$message.success(n.$t("OperateSuccess"))),l.abrupt("return");case 8:n.$refs[t].validate(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(e){var r,l,d,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=7;break}return t.next=3,Object(c.o)(n.editForm);case 3:l=t.sent,1e4===(null===(r=l.status)||void 0===r?void 0:r.code)&&(null!==n.editIndex&&((d=n.lastChatList[n.editIndex]).name=n.editForm.title,(h=Object(o.a)(n.lastChatList))[n.editIndex]=d,n.lastChatList=h,n.editIndex=null),n.$message.success(n.$t("OperateSuccess")),n.$refs.confirmModal.handleClose()),t.next=9;break;case 7:return console.log("error submit!!"),t.abrupt("return",!1);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 9:case"end":return l.stop()}}),l)})))()},resetForm:function(t){this.editIndex=null,this.$refs[t]&&this.$refs[t].resetFields()},handleClickNewChat:function(){this.$logEvent("log_actions",{operation:"click_create_new_chat",behavior_info:"on_tarven_detail_page"}),this.isShowLast=!1,this.$route.name.startsWith("tavernCover")?this.$parent.goChat(-1):this.$parent.newChat()},formatTimestamp:function(t){var e=new Date(t),n=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),l=String(e.getHours()).padStart(2,"0"),c=String(e.getMinutes()).padStart(2,"0"),d=String(e.getSeconds()).padStart(2,"0");return"".concat(n,"-").concat(o,"-").concat(r," ").concat(l,":").concat(c,":").concat(d)},goback:function(){if(1!==window.history.length){var t=this.historyStack.pop();if(this.onlyBack)this.$router.go(-1);else if(t){var e=t.split("/")[3]||"",n=/\d/.test(e);if(t.includes("source=work"))return this.$router.replace(this.localePath("/cyberPub")),!1;if(t.includes("?quickChat=true"))return this.$router.go(-2),!1;if(e)return n?this.$router.go(-1):this.$router.go(-2),!1;this.$router.go(-1)}else this.$router.go(-1)}else{var o=this.localePath("/");this.$router.push(o)}},changeAiChat:function(t){var e=this.characterInfo.id,n=t.session_id;"chatDetail"===this.fromPage?this.$logEvent("log_actions",{operation:"click_last_chat",behavior_info:"on_tavern_detail_page"}):this.$logEvent("log_actions",{operation:"tavern_on_chat_detail_page",behavior_info:"click_recent_chat"}),this.isShowLast=!1,this.$emit("updateSession",{character_id:e,session_id:n})}}},h=d,v=(n(2682),n(0)),component=Object(v.a)(h,(function(){var t,e=this,n=e._self._c;return n("div",{staticClass:"aichat-last"},[n("i",{staticClass:"el-icon-back",on:{click:function(t){return t.stopPropagation(),e.goback.apply(null,arguments)}}}),e._v(" "),n("div",{staticClass:"last-panel",class:{"off-panel":e.isShowLast}},[n("div",{staticClass:"last-title flex-between",on:{click:function(t){e.isShowLast=!e.isShowLast}}},[e._v("\n      "+e._s(e.$t("LastChat"))+"\n      "),n("i",{staticClass:"el-icon-arrow-down"})]),e._v(" "),e.isShowLast&&null!==(t=e.lastChatList)&&void 0!==t&&t.length?n("div",{staticClass:"last-list"},[n("div",{staticClass:"inner-last-list start-new-chat",on:{click:e.handleClickNewChat}},[n("i",{staticClass:"new-chat-btn iconfont icon-icon_xinjianshuziren"}),e._v(" "),n("span",[e._v(e._s(e.$t("StartNewChat")))])]),e._v(" "),e._l(e.lastChatList,(function(t,i){var o,r;return n("div",{key:"lastAiChat_"+i,staticClass:"inner-last-list",class:{"inner-last-list-active":t.session_id===(null===(o=e.$route.query)||void 0===o?void 0:o.s_id)}},[n("span",{staticClass:"avatar",style:{backgroundImage:"url(".concat(null===(r=e.characterInfo)||void 0===r||null===(r=r.cover)||void 0===r?void 0:r.url,")")},on:{click:function(n){return e.changeAiChat(t)}}}),e._v(" "),n("el-tooltip",{attrs:{"popper-class":"custom-tips-popper custom-tips-popper-role",effect:"light",placement:"bottom"}},[n("div",{staticClass:"tooltip-txt",attrs:{slot:"content"},slot:"content"},[e._v("\n            "+e._s(t.name||e.formatTimestamp(t.create_at))+"\n          ")]),e._v(" "),n("span",{staticClass:"time overflow-ellipsis",on:{click:function(n){return e.changeAiChat(t)}}},[e._v("\n            "+e._s(t.name||e.formatTimestamp(t.create_at))+"\n          ")])]),e._v(" "),n("el-popover",{ref:"myPopover",refInFor:!0,attrs:{trigger:"hover",placement:"bottom-end","popper-class":"popover-information","append-to-body":!1,"visible-arrow":!1,"popper-options":{boundariesElement:"body"},width:"167"}},[n("div",{staticClass:"pop-btns"},e._l(e.manageMenu,(function(o){return n("div",{key:o.key,staticClass:"pop-btns-item",on:{click:function(n){return n.preventDefault(),n.stopPropagation(),e.handleActions(o,t)}}},[n("i",{staticClass:"iconfont",class:o.icon}),e._v(" "),n("span",{staticClass:"pop-btns-text"},[e._v(e._s(e.$t(o.title)))])])})),0),e._v(" "),n("div",{staticClass:"el-icon-more-box",attrs:{slot:"reference"},slot:"reference"},[n("i",{staticClass:"el-icon-more"})])])],1)}))],2):e._e()]),e._v(" "),n("ConfirmModal",{ref:"confirmModal",attrs:{dialogWidth:560},on:{confirm:function(t){return e.submitForm("editForm",t)},cancel:function(t){return e.resetForm("editForm")}}},["edit"===e.curHandle?n("template",{slot:"custom_content"},[n("el-form",{ref:"editForm",staticClass:"popup-content-form",attrs:{"label-position":"top",inline:"",model:e.editForm,rules:e.rules,"label-width":"500px"}},[n("el-form-item",{attrs:{label:e.$t("trainName"),prop:"title"}},[n("el-input",{attrs:{maxlength:"30"},model:{value:e.editForm.title,callback:function(t){e.$set(e.editForm,"title",t)},expression:"editForm.title"}})],1)],1)],1):e._e()],2)],1)}),[],!1,null,"512958f6",null);e.a=component.exports},541:function(t,e,n){"use strict";n(14),n(9),n(7),n(11),n(12),n(8);var o=n(3),r=n(2),l=(n(20),n(16),n(75),n(19),n(36),n(4),n(237),n(50),n(110),n(238),n(239),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(6),n(48),n(29),n(39)),c=n(5),d=n(178),h=n(703),v=n.n(h),m=n(704),f=n.n(m),_=n(705),y=n.n(_),w=n(299),C=n.n(w),k=n(78),O=n(1);function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function D(t,e){return'<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">'.concat(e,'</span><span class="code-block-header__copy hidden">').concat(Object(k.a)("copyCode"),'</span></div><code class="hljs code-block-body ').concat(e,'">').concat(t,"</code></pre>")}var S=new v.a({html:!1,linkify:!0,typographer:!0,highlight:function(code,t){if(!(!t||!C.a.getLanguage(t))){var e=t||"";return D(C.a.highlight(code,{language:e}).value,e)}return D(C.a.highlightAuto(code).value,"")}});S.use(y.a,{attrs:{target:"_blank",rel:"noopener"}}),S.use(f.a,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});var P={name:"ChatItem",props:{inAdd:{type:Boolean,default:!1},inGenerate:{type:Boolean,default:!1},item:{type:Object,default:null},msgLoading:{type:Boolean,default:!1},stop:{type:Boolean,default:!1},inStarLilst:{type:Boolean,default:!1}},watch:{inGenerate:{handler:function(t,e){var n=this;!1===t&&!0===e&&(console.log("代码停止",t),this.$nextTick((function(){n.addCopyEvents()})))},immediate:!0},"item.content":{handler:function(t,e){""===e&&t.length>0&&this.typeText()},immediate:!0},stop:{handler:function(t,e){!0===t&&!1===e&&(console.log("watch stop 手动停止, in chatwork",t),this.showText=this.showText||"[Something went wrong]")}}},computed:I(I({},Object(O.e)("user",["userInfo"])),{},{isAi:function(){return 0===this.item.type},text:function(){var t=this.showText||"";return t?S.render(t):t},loading:function(){return""===this.item.content&&this.msgLoading},isCollect:function(){var t=this,e=!1;return this.staredListIds.forEach((function(n){n===t.item.id&&(e=!0)})),e}}),data:function(){return{code:"",showText:"",codeIdx:0,index:0,codeQueue:new d.b(3),codeFlag:!1,halfOpen:!1,codeInType:"",timeOut:null,staredList:[],staredListIds:[],btnTooltips:[{className:"copy",iconFont:"icon-copy-gpt",tipText:Object(k.a)("copy"),action:"copyItem"},{className:"collect",tipText:Object(k.a)("Collect"),action:"toggleCollect"},{className:"delete",iconFont:"icon-delete-gpt",tipText:Object(k.a)("Delete"),action:"deleteItem"},{className:"send",iconFont:"icon-gpt-send",tipText:Object(k.a)("sendTextBtn"),action:"sendToCreate"}]}},mounted:function(){var t=this;this.typeTextExist(),this.$nextTick((function(){t.addCopyEvents()})),this.updateStared()},unmounted:function(){this.removeCopyEvents()},methods:{addCopyEvents:function(){var t=this;if(this.isAi){var e=this.$refs.textRef;if(e)e.querySelectorAll(".code-block-header__copy").forEach((function(e){console.log("绑定的Btn",e),e.classList.remove("hidden"),t.$nextTick((function(){e.addEventListener("click",(function(){var t,code=null===(t=e.parentElement)||void 0===t||null===(t=t.nextElementSibling)||void 0===t?void 0:t.textContent;console.log("复制的内容",code),code&&Object(c.d)(code)}))}))}))}},removeCopyEvents:function(){var t=this.$refs.textRef;t&&t.querySelectorAll(".code-block-header__copy").forEach((function(t){t.removeEventListener("click",(function(){}))}))},formatTime:function(t){return Object(l.e)(t)},onCopy:function(){""!==this.code&&Object(c.d)(this.code)},typeText:function(){var t=this;if(""!==this.item.content)if(this.isAi)if(this.stop)this.showText.length>0&&(this.item.content=this.showText,this.$emit("saveChannel"));else{var e=this.item.content;this.codeQueue.enqueue(e[this.index]),"```"===this.codeQueue.string()?(console.log("代码开始"),this.codeQueue.reset(),this.codeFlag=!0,this.halfOpen=!0,this.codeIdx++):this.codeFlag=!1,this.codeFlag?(this.codeFlag=!1,this.codeIdx%2==1?this.showText+="```":(this.showText=this.showText.slice(0,-3),this.halfOpen=!1)):void 0!==e[this.index+1]&&(this.halfOpen?this.showText=this.showText.slice(0,-3)+e[this.index++]+"```":this.showText+=e[this.index++]);!this.inAdd&&this.index+1>=e.length?(this.showText+=e[this.index],clearTimeout(this.timeOut),this.$nextTick((function(){console.log("打字机绑定"),t.$emit("saveChannel"),t.addCopyEvents()}))):this.timeOut=setTimeout(this.typeText,30)}else this.showText=this.item.content},typeTextExist:function(){""!==this.item.content&&(this.isAi?this.isAi&&!1===this.inGenerate&&(this.showText=this.item.content):this.showText=this.item.content)},copyItem:function(){var text=this.item.content||"";text&&(Object(c.d)(text),this.$message.success(Object(k.a)("CopySuccess")))},deleteStar:function(){var t=this;this.$confirm(this.$t("gpt_chat_del_star"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){t.toggleCollect().then((function(){t.$emit("deleteStar")}))})).catch((function(){}))},toggleCollect:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],!t.isCollect){e.next=7;break}return e.next=4,Object(d.d)(t.item,t.userInfo.id);case 4:n=e.sent,e.next=10;break;case 7:return e.next=9,Object(d.c)(t.item,t.userInfo.id);case 9:n=e.sent;case 10:t.updateStared(n);case 11:case"end":return e.stop()}}),e)})))()},updateStared:function(t){var e=this;t?(this.staredList=Array.from(new Set(t)),this.staredListIds=this.staredList.map((function(t){return t.id}))):Object(d.e)(this.userInfo.id).then((function(t){e.staredList=Array.from(new Set(t)),e.staredListIds=e.staredList.map((function(t){return t.id}))}))},clickBtn:function(t){var e=t.action;e&&this[e]()},deleteItem:function(){var t=this;this.$confirm(this.$t("gpt_chat_del_msg"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){t.$emit("deleteMsg",{id:t.item.id})})).catch((function(){}))},sendToCreate:function(){var text=this.item.content.trim();if(text){var t={prompt:text,category:4,noRefer:!0};this.$EventBus.$emit("openGenerate",{action:1,data:t})}}}},L=(n(2707),n(2708),n(0)),component=Object(L.a)(P,(function(){var t,e,o=this,r=o._self._c;return o.item?r("div",{staticClass:"chat-item flex",class:{isUser:!o.isAi&&!o.inStarLilst}},[r("div",{staticClass:"chat-item-avatar flex justify-center items-center",class:{round:!o.isAi}},[o.isAi?r("img",{attrs:{src:n(124),alt:""}}):o._e(),o._v(" "),!o.isAi&&o.item.senderAvatar?r("img",{attrs:{src:o.item.senderAvatar,alt:""}}):o.isAi?o._e():r("div",{staticClass:"letter flex justify-center items-center"},[o._v(o._s(o.item.name?o.item.name[0].toUpperCase():o.item.senderId[0].toUpperCase()))])]),o._v(" "),r("div",{staticClass:"chat-item-content",class:o.isAi||o.inStarLilst?"m-l":"m-r"},[r("div",{staticClass:"chat-item-content-time",class:{"text-right":!o.isAi}},[o._v(o._s(o.formatTime(o.item.sendTime)))]),o._v(" "),r("div",{staticClass:"chat-item-content-main flex",class:{isUser:!o.isAi&&!o.inStarLilst}},[r("div",{staticClass:"chat-item-content-body"},[null!==(t=o.item)&&void 0!==t&&t.coins?r("div",{staticClass:"chat-item-content-body-cost"},[o._v("Cost:-"+o._s(null===(e=o.item)||void 0===e?void 0:e.coins))]):o._e(),o._v(" "),r("div",{ref:"textRef",staticClass:"chat-item-content-body-text"},[o.isAi&&o.loading?r("span",{staticClass:"loading"},[r("i",{staticClass:"el-icon-loading"})]):r("span",{staticClass:"text"},[r("div",{staticClass:"flex flex-col",domProps:{innerHTML:o._s(o.text)}})])])]),o._v(" "),!o.inStarLilst&&o.item.content&&o.stop?r("div",{staticClass:"chat-item-btns flex flex-wrap"},[o._l(o.btnTooltips,(function(t,e){return[r("el-tooltip",{key:e,staticClass:"btns-tooltip",attrs:{placement:"top",content:t.tipText}},["send"!==t.className||"send"===t.className&&o.isAi&&o.item.content?r("i",{class:["iconfont","item-btn",t.className,t.iconFont?t.iconFont:o.isCollect?"icon-collect_selected":"icon-collect-gpt"],on:{click:function(e){return o.clickBtn(t)}}}):o._e()])]}))],2):o._e()]),o._v(" "),o.inStarLilst?r("div",{staticClass:"chat-item-star flex justify-end"},[r("i",{staticClass:"iconfont icon-copy-gpt item-btn",on:{click:o.copyItem}}),o._v(" "),r("i",{staticClass:"iconfont icon-delete-gpt item-btn",on:{click:o.deleteStar}})]):o._e()])]):o._e()}),[],!1,null,"1322af10",null);e.a=component.exports},542:function(t,e,n){"use strict";var o={props:{isDetail:{type:Boolean,default:!1}},data:function(){return{isShow:!1}},mounted:function(){},methods:{handleClick:function(){this.$EventBus.$emit("openGenerate",{action:1,data:""})}}},r=(n(2907),n(0)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"blog-header"},[e("div",{staticClass:"blog-header-top"}),t._v(" "),e("div",{staticClass:"flex"},[e("div",{staticClass:"blog-header-left"},[e("div",{staticClass:"blog-header-left-title"},[e("div",{staticClass:"text-top"},[e("span",{staticClass:"text-top-gradient"},[t._v(t._s(t.$t("SeaArt")))]),t._v(" "),e("span",[t._v(" "+t._s(t.isDetail?t.$t("blog_title_tips"):t.$t("blog")))])]),t._v(" "),e("div",{staticClass:"text-tips"},[t._v("\n          "+t._s(t.isDetail?t.$t("blog_title_sub"):t.$t("blog_tips"))+"\n        ")]),t._v(" "),e("div",{staticClass:"text-btn",on:{click:t.handleClick}},[t._v(t._s(t.$t("blog_try")))])])]),t._v(" "),e("div",{staticClass:"blog-header-video",on:{click:function(e){t.isShow=!0}}},[e("img",{staticClass:"video",attrs:{src:"https://image.cdn2.seaart.ai/static/upload/20240228/bc964c0d-2bbd-42ae-a81c-e8fb8efbc2fd.webp",alt:t.$t("top_image_alt")}}),t._v(" "),t._m(0)])]),t._v(" "),t.isShow?e("div",{staticClass:"dialog"},[e("iframe",{attrs:{width:"784",height:"441",src:"https://www.youtube.com/embed/X64TBs6ZeRU?si=DtxDnLt4aQMk14WS",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:""}}),t._v(" "),e("i",{staticClass:"el-icon-close",on:{click:function(e){t.isShow=!1}}})]):t._e()])}),[function(){var t=this._self._c;return t("div",{staticClass:"blog-header-video-play"},[t("i",{staticClass:"iconfont icon-a-Vector2900"})])}],!1,null,"27b5033e",null);e.a=component.exports},545:function(t,e,n){"use strict";n(10),n(14),n(9),n(11),n(12),n(8),n(6);var o=n(2),r=(n(16),n(7),n(47),n(19),n(36),n(4),n(23),n(125),n(18),n(118),n(37),n(29),n(5)),l=n(1),c=n(56),d=n(33),h=n(30),v=n(92),m=n(106),f=n(206),_=n(13),y=n(109),w=n(21);function C(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?C(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var O={mixins:[d.a],components:{CollectPopover:c.a,ImgWaterFall:v.a,AdminTag:m.a,ShareDialog:f.a},props:{fromPage:{type:String,default:""},item:{type:Object,default:function(){}},list:{type:Array,default:function(){return[]}},review:{type:Boolean,default:!1},sysTag:{type:Object,default:function(){}},dotReportInfo:{type:Object,default:function(){return{category:"default",view_domain:"",batch_id:""}}}},computed:k(k(k(k({},Object(l.c)("user",["isLoggedIn","accountSettingsData","isCompanyAccount"])),Object(l.e)("user",["userInfo","accountData","adminOff"])),Object(l.e)("payment",["productLevel"])),{},{isMine:function(){var t,e;return(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)==(null===(e=this.userInfo)||void 0===e?void 0:e.id)},inviteCode:function(){var t;return(null===(t=this.userInfo)||void 0===t?void 0:t.invite_user_code)||""},isPC:function(){return"PC"===localStorage.getItem("visitFrom")},setNsfwPlus:function(){return function(t){var e,n;return!(null==t||!t.nsfw_plus)&&(null===(e=this.userInfo)||void 0===e||!e.enable_nsfw_plus||[2,"2"].includes(null===(n=this.userInfo)||void 0===n||null===(n=n.settings)||void 0===n?void 0:n.nsfw_plus))}},isWorkFlowAppDetail:function(){return this.$route.name.includes("workFlowAppDetail")}}),data:function(){return{copyTextToClipboard:r.d,saveImg:r.z,formatNumberForeign:r.i,itemShow:!1,itemShowId:"",collectDotReportInfo:{},from:"waterfall",cntShow:!0,otherShow:!1,workfolwAppLoading:!1}},activated:function(){var video=this.$refs.mainVideo;video&&video.play&&video.play()},mounted:function(){var t=this;setTimeout((function(){t.otherShow=!0}),200)},methods:{goWorkfolwApp:function(t){var e,n=this;if(!this.isLoggedIn)return this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"click_same_create",behavior_info_sub:(null===(e=this.dotReportInfo)||void 0===e?void 0:e.view_domain)||""}),void this.$EventBus.$emit("openLoginDialog");this.isWorkFlowAppDetail?this.$EventBus.$emit("$_workDetailRemix",{artwork_id:t.id}):this.workfolwAppLoading||(this.workfolwAppLoading=!0,Object(y.g)({artwork_id:t.id}).then((function(e){1e4==e.status.code&&n.$router.replace(n.localePath("/workFlowAppDetail/".concat(e.data.id,"?task=mix-").concat(t.id)))})).finally((function(){n.workfolwAppLoading=!1})))},isMP4Link:function(link){return!link||!link.toLowerCase().endsWith(".mp4")},handleMouseUp:function(t,e){if(2===t.which||1===t.button){var n=this.list.findIndex((function(i){return i.id===e.id})),o=(n<10?this.list.slice(0,n):this.list.slice(n-10,n)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));Object(h.g)({items:[k(k({},this.dotReportInfo),{},{negative_ids:o,action:"view",obj_no:e.id,obj_type:1,batch_id:null==e?void 0:e.pt,stat:null==e?void 0:e.stat},this.productLevel&&{vip:this.productLevel})]})}},otherUser:function(t){var path="/user/"+encodeURIComponent(t.author.id);this.userInfo.id==t.author.id&&(path="/personal"),window.open(this.localePath(path),"_blank")},changeItemShow:function(t){this.itemShow=t.show,this.itemShowId=t.id,this.handleCollectPopoverClick(t)},handleCollectPopoverClick:function(t){var e=this.list.findIndex((function(i){return i.id===t.id})),n=(e<10?this.list.slice(0,e):this.list.slice(e-10,e)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));this.collectDotReportInfo=k(k({},this.dotReportInfo),{},{negative_ids:n,action:"collection",obj_no:t.id,obj_type:1})},checkGreen:function(t){return!this.isLoggedIn&&!(null==t||!t.green||![2,"2"].includes(t.green))},handleDetail:function(t,e){var n,o,r=this.checkGreen(e);this.$logEvent("log_actions",{operation:"click_image",behavior_info:e.id,behavior_info_sub:r?"is_cover":"not_cover"});var l="string"==typeof t.target.className&&(null===(n=t.target.className)||void 0===n?void 0:n.includes("boxItem"))&&(null===(o=t.target.className)||void 0===o?void 0:o.includes("defBox"));if("IMG"===t.target.tagName||"VIDEO"===t.target.tagName||"cltpop"===t.target.className||l||"ImgWaterFall"===t.target.className||"green-mode-div"===t.target.className){if(1===e.nsfw)return void this.$message.warning(this.$t("workErrTip"));if(r)return void this.$EventBus.$emit("openLoginDialog",{redirect:"/explore/detail/"+e.id,dotCover:!0});var c=this.list.findIndex((function(i){return i.id===e.id})),d=(c<10?this.list.slice(0,c):this.list.slice(c-10,c)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));Object(h.g)({items:[k(k({},this.dotReportInfo),{},{negative_ids:d,action:"view",obj_no:e.id,obj_type:1,batch_id:null==e?void 0:e.pt,stat:null==e?void 0:e.stat},this.productLevel&&{vip:this.productLevel})]}),this.$router.push(this.localePath("/explore/detail/"+e.id))}},handleClick:function(t){var e;if(!this.isLoggedIn)return this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"click_same_create",behavior_info_sub:(null===(e=this.dotReportInfo)||void 0===e?void 0:e.view_domain)||""}),void this.$EventBus.$emit("openLoginDialog");var n=this.list.findIndex((function(i){return i.id===t.id})),o=(n<10?this.list.slice(0,n):this.list.slice(n-10,n)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));Object(h.g)({items:[k(k({},this.dotReportInfo),{},{negative_ids:o,action:"task",obj_no:t.id,obj_type:1,batch_id:null==t?void 0:t.pt,stat:null==t?void 0:t.stat},this.productLevel&&{vip:this.productLevel})]});var r=Object.assign({},t);r.taskSource=4,r.logEventSource=Object(_.E)(this.$route.name);var l=t.id,c=t.obj_type,d=t.pt;this.$logEvent("log_actions",{operation:"same_create",behavior_info:l,obj_type:c,behavior_info_sub:d}),this.$EventBus.$emit("openGenerate",{action:1,data:{source:r}})},downloadImg:function(t){var e=this.getImageExtensionFromUrl(t.cover),n=(t.author?t.id:"image")+"".concat(e);this.saveImg(t.cover,n)},getImageExtensionFromUrl:function(t){var e=t.match(/\/([^/]+)$/);return e&&e[1].includes(".")?"."+e[1].split(".").pop().toLowerCase():".jpeg"},moreActions:function(t,e){var n,o=this,r=this.item.obj_type;switch(t){case"delete":this.$emit("moreActions","delete",this.item);break;case"pinOrNot":this.$emit("moreActions","pinOrNot",this.item);break;case"flag":this.reportArtwork(e.id),e.propS=!1;break;case"save":this.downloadImg(e),e.propS=!1;break;case"share":this.$logEvent("log_actions",{operation:"click_share",behavior_info:"on_personal_center",behavior_info_sub:r}),this.sharevisible=!0,this.popTime=setTimeout((function(){o.sharevisible=!1}),1e3);var path="".concat(window.location.origin,"/")+"explore/detail/".concat(e.id,"?source=share_link")+(this.inviteCode?"&u_code=".concat(this.inviteCode):""),image=(null==e||null===(n=e.banner)||void 0===n?void 0:n.url)||(null==e?void 0:e.replaceUrl)||(null==e?void 0:e.cover)||(null==e?void 0:e.url)||"";this.$refs.shareDialog.show(path,image,"share","waterfall_flow");break;case"not_interested":Object(h.g)({items:[{action:"not_interested",obj_no:e.id,obj_type:1}]}).then((function(t){var n,r;1e4==(null==t||null===(n=t.status)||void 0===n?void 0:n.code)?(o.$message({message:o.$t("reduceWork"),type:"success"}),e.propS=!1,o.setWaterFallDeleteLits(e.id),o.$emit("resizeListener")):o.$message({message:(null==t||null===(r=t.status)||void 0===r?void 0:r.msg)||o.$t("ServerError"),type:"error"})}))}},tagChange:function(){this.$emit("change")},handleType:function(t){var e=t.type,n=t.channel;return 2===e&&"sdxl"===n||4===e&&"sdxl"===n?"/cell":6===e?"/animate":"/upscale"},handlePopoverShow:function(){var t=this;if("userPage"===this.fromPage){var e=this.item,n=e.id,o=e.obj_type;Object(w.M)({obj_id:n,obj_type:o}).then((function(e){var n,o;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&t.$set(t.item,"isTop",null==e||null===(o=e.data)||void 0===o?void 0:o.is_top)}))}}}},x=(n(2308),n(2309),n(0)),component=Object(x.a)(O,(function(){var t,e,n,o,r,l,c,d,h,v,m,f,_,y,w,C,k,O,x=this,I=x._self._c;return I("a",{staticClass:"Acnt",attrs:{href:x.localePath("/explore/detail/"+x.item.id),target:"_blank"},on:{click:function(t){return t.preventDefault(),x.handleDetail(t,x.item)},mouseup:function(t){return x.handleMouseUp(t,x.item)},mouseover:function(t){x.cntShow=!0}}},[I("div",{ref:"boxItem",staticClass:"defBox marking-item",class:{"bg-nsfw":1===x.item.nsfw,boxItem:!x.setNsfwPlus(x.item)}},[x.item.sys_tag&&x.otherShow?I("div",{staticClass:"SysTag",style:{color:x.sysTag[x.item.sys_tag[0]].color,backgroundColor:x.sysTag[x.item.sys_tag[0]].bg}},[x._v("\n      "+x._s(x.$t(x.sysTag[x.item.sys_tag[0]].txt))+"\n    ")]):x._e(),x._v(" "),I("div",{directives:[{name:"show",rawName:"v-show",value:x.item.NSFWSHOW&&[2,"2"].includes(null===(t=x.userInfo)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.nsfw_plus)&&x.otherShow,expression:"item.NSFWSHOW && [2, '2'].includes(userInfo?.settings?.nsfw_plus) && otherShow"}],staticClass:"NSFWSHOW",style:{right:null!==(e=x.item)&&void 0!==e&&e.nsfw_plus?"10px":"75px",opacity:null!==(n=x.item)&&void 0!==n&&n.nsfw_plus?1:0},on:{click:function(t){var e;t.preventDefault(),t.stopPropagation(),x.item.nsfw_plus=!(null!==(e=x.item)&&void 0!==e&&e.nsfw_plus)}}},[I("i",{staticClass:"iconfont",class:null!==(o=x.item)&&void 0!==o&&o.nsfw_plus?"icon-work-show":"icon-work-hide"})]),x._v(" "),1!==x.item.nsfw&&x.isMP4Link(x.item.cover)?I("ImgWaterFall",{style:{filter:x.setNsfwPlus(x.item)?"blur(19px) saturate(160%)":""},attrs:{item:x.item}}):1!=x.item.nsfw?I("video",{ref:"mainVideo",staticClass:"cntVideo",style:{filter:x.setNsfwPlus(x.item)?"blur(19px) saturate(160%)":""},attrs:{src:x.item.cover,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0}}):x._e(),x._v(" "),I("div",{directives:[{name:"show",rawName:"v-show",value:2!==(null===(r=x.accountData)||void 0===r||null===(r=r.settings)||void 0===r?void 0:r.green_mode)&&x.otherShow,expression:"accountData?.settings?.green_mode !== 2 && otherShow"}]},[[2,"2"].includes(x.item.green)&&!["/personal"].includes(x.$route.path)?I("div",{staticClass:"green-mode-div",staticStyle:{"backdrop-filter":"blur(19px) saturate(160%)",position:"absolute",left:"0",top:"0"},style:{width:x.item.waterWidth+"px",height:x.item.waterHeight+"px"}}):x._e()]),x._v(" "),x.cntShow&&x.otherShow?I("div",["comfyui"==x.item.channel?I("div",{staticClass:"waterfall-hover-try",on:{click:function(t){return t.preventDefault(),x.goWorkfolwApp(x.item)}}},[x._v("\n        "+x._s(x.$t("Remix"))+"\n      ")]):x._e(),x._v(" "),"comfyui"!=x.item.channel?I("div",{staticClass:"waterfall-hover-try",on:{click:function(t){return t.preventDefault(),x.handleClick(x.item)}}},[x._v("\n        "+x._s(x.$t("Remix"))+"\n      ")]):x._e(),x._v(" "),x.isLoggedIn?I("CollectPopover",{staticClass:"CollectPop",style:{opacity:x.itemShow&&x.itemShowId==x.item.id?1:0},attrs:{dotReportInfo:x.collectDotReportInfo,type:"artwork",folder:x.item,from:"waterfall"},on:{showChaneg:x.changeItemShow}}):x._e(),x._v(" "),x.isLoggedIn?I("div",{staticClass:"cltpop",style:{opacity:x.itemShow&&x.itemShowId==x.item.id?1:0}}):x._e(),x._v(" "),x.item.waterHeight>200?I("div",{staticClass:"waterfall-hover-photo"},[I("div",{staticClass:"hoverTop"},[I("span",[x._v(x._s(x.handleType(x.item)))]),x._v(" "),x.item?I("div",{staticClass:"moreEdit"},[x.isLoggedIn?[I("el-popover",{ref:"myPopover",attrs:{placement:"top-end","popper-class":"water-fall-popover","append-to-body":!0,"visible-arrow":!1,"popper-options":{boundariesElement:"body"},width:"100",trigger:"click"},on:{show:x.handlePopoverShow},model:{value:x.item.propS,callback:function(t){x.$set(x.item,"propS",t)},expression:"item.propS"}},[I("div",{staticClass:"pop-btns flex"},[I("button",{directives:[{name:"show",rawName:"v-show",value:"userPage"==x.fromPage&&x.isMine,expression:"fromPage == 'userPage' && isMine"}],on:{click:function(t){return t.preventDefault(),x.moreActions("pinOrNot")}}},[x._v("\n                    "+x._s(x.$t(null!==(l=x.item)&&void 0!==l&&l.isTop?"UnpinOverview":"PinOverview"))+"\n                  ")]),x._v(" "),I("button",{on:{click:function(t){return t.preventDefault(),x.moreActions("flag",x.item)}}},[x._v("\n                    "+x._s(x.$t("Report"))+"\n                  ")]),x._v(" "),I("button",{on:{click:function(t){return t.preventDefault(),x.moreActions("save",x.item)}}},[x._v("\n                    "+x._s(x.$t("Download"))+"\n                  ")]),x._v(" "),I("button",{on:{click:function(t){return t.preventDefault(),x.moreActions("share",x.item)}}},[x._v("\n                    "+x._s(x.$t("ShareLink"))+"\n                  ")]),x._v(" "),I("button",{directives:[{name:"show",rawName:"v-show",value:!(x.item.isSlot||x.item.author&&x.item.author.id==x.userInfo.id),expression:"\n                      !item.isSlot && (!item.author || item.author.id != userInfo.id)\n                    "}],on:{click:function(t){return t.preventDefault(),x.moreActions("not_interested",x.item)}}},[x._v("\n                    "+x._s(x.$t("dislike"))+"\n                  ")]),x._v(" "),I("button",{directives:[{name:"show",rawName:"v-show",value:x.isMine,expression:"isMine"}],on:{click:function(t){return t.preventDefault(),x.moreActions("delete")}}},[x._v("\n                    "+x._s(x.$t("Delete"))+"\n                  ")])]),x._v(" "),I("div",{class:{"login-waterFall-btn-icon":x.isLoggedIn,"noLogin-waterFall-collect-icon prompt-show":!x.isLoggedIn},attrs:{slot:"reference"},slot:"reference"},[I("i",{staticClass:"iconfont icon-more"})])])]:x._e()],2):x._e()]),x._v(" "),I("div",{staticClass:"hoverMiddle"},[x._v("\n          "+x._s(x.item.prompt)+"\n        ")])]):I("div",[x.item?I("div",{staticClass:"short-more-edit"},[x.isLoggedIn?[I("el-popover",{ref:"myPopover",attrs:{placement:"top-end","popper-class":"water-fall-popover","append-to-body":!0,"visible-arrow":!1,"popper-options":{boundariesElement:"body"},width:"100",trigger:"click"},on:{show:x.handlePopoverShow},model:{value:x.item.propS,callback:function(t){x.$set(x.item,"propS",t)},expression:"item.propS"}},[I("div",{staticClass:"pop-btns flex"},[I("button",{directives:[{name:"show",rawName:"v-show",value:"userPage"==x.fromPage&&x.isMine,expression:"fromPage == 'userPage' && isMine"}],on:{click:function(t){return t.preventDefault(),x.moreActions("pinOrNot")}}},[x._v("\n                  "+x._s(x.$t(null!==(c=x.item)&&void 0!==c&&c.isTop?"UnpinOverview":"PinOverview"))+"\n                ")]),x._v(" "),I("button",{on:{click:function(t){return t.preventDefault(),x.moreActions("flag",x.item)}}},[x._v("\n                  "+x._s(x.$t("Report"))+"\n                ")]),x._v(" "),I("button",{on:{click:function(t){return t.preventDefault(),x.moreActions("save",x.item)}}},[x._v("\n                  "+x._s(x.$t("Download"))+"\n                ")]),x._v(" "),I("button",{on:{click:function(t){return t.preventDefault(),x.moreActions("share",x.item)}}},[x._v("\n                  "+x._s(x.$t("ShareLink"))+"\n                ")]),x._v(" "),I("button",{directives:[{name:"show",rawName:"v-show",value:!(x.item.isSlot||x.item.author&&x.item.author.id==x.userInfo.id),expression:"\n                    !item.isSlot && (!item.author || item.author.id != userInfo.id)\n                  "}],on:{click:function(t){return t.preventDefault(),x.moreActions("not_interested",x.item)}}},[x._v("\n                  "+x._s(x.$t("dislike"))+"\n                ")]),x._v(" "),I("button",{directives:[{name:"show",rawName:"v-show",value:x.isMine,expression:"isMine"}],on:{click:function(t){return t.preventDefault(),x.moreActions("delete")}}},[x._v("\n                  "+x._s(x.$t("Delete"))+"\n                ")])]),x._v(" "),I("div",{class:{"login-waterFall-btn-icon":x.isLoggedIn,"noLogin-waterFall-collect-icon prompt-show":!x.isLoggedIn},attrs:{slot:"reference"},slot:"reference"},[I("i",{staticClass:"iconfont icon-more"})])])]:x._e()],2):x._e()]),x._v(" "),I("admin-tag",{attrs:{id:x.item.id,type:"1",item:x.item,review:x.review},on:{change:x.tagChange}})],1):x._e()],1),x._v(" "),x.otherShow?I("div",{staticClass:"author",style:{width:x.item.waterWidth+"px",marginTop:"8px"}},[I("div",{staticClass:"userBox",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),x.otherUser(x.item)}}},[null!==(d=x.item.author)&&void 0!==d&&d.head?I("div",{directives:[{name:"lazyload",rawName:"v-lazyload"}],staticClass:"authorHead"},[I("img",{directives:[{name:"webp",rawName:"v-webp",value:x.$imgL,expression:"$imgL"}],attrs:{"data-src":null===(h=x.item.author)||void 0===h?void 0:h.head,alt:null===(v=x.item.author)||void 0===v||null===(v=v.head)||void 0===v?void 0:v.name}})]):I("div",{staticClass:"authorHead"},[x._v(x._s((null===(m=x.item.author)||void 0===m?void 0:m.name[0])||(null===(f=x.item.author)||void 0===f?void 0:f.id[0])))]),x._v(" "),I("div",{staticClass:"authorName"},[x._v(x._s((null===(_=x.item.author)||void 0===_?void 0:_.name)||(null===(y=x.item.author)||void 0===y?void 0:y.id)))])]),x._v(" "),x.cntShow?I("div",{staticClass:"numItem"},[I("div",{staticClass:"funItem",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),x.setLike(x.item,"artwork","waterfall")}}},[I("i",{staticClass:"iconfont",class:x.setlikeData(x.item)}),x._v(" "),null!==(w=x.item.stat)&&void 0!==w&&w.num_of_like?I("span",[x._v(x._s(x.item.stat.num_of_like))]):x._e()]),x._v(" "),I("div",{staticClass:"funItem",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),x.setCollect(x.item,"artwork")}}},[I("i",{staticClass:"iconfont",class:x.setCollectData(x.item)}),x._v(" "),null!==(C=x.item.stat)&&void 0!==C&&C.num_of_collection?I("span",[x._v(x._s(x.item.stat.num_of_collection))]):x._e()])]):I("div",{staticClass:"numItem"},[I("div",{staticClass:"funItem"},[I("i",{staticClass:"iconfont",class:x.item.liked?"icon-like_selected":"icon-like"}),x._v(" "),null!==(k=x.item.stat)&&void 0!==k&&k.num_of_like?I("span",[x._v(x._s(x.item.stat.num_of_like))]):x._e()]),x._v(" "),I("div",{staticClass:"funItem"},[I("i",{staticClass:"iconfont",class:x.item.collect?"icon-collect_selected":"icon-collect"}),x._v(" "),null!==(O=x.item.stat)&&void 0!==O&&O.num_of_collection?I("span",[x._v(x._s(x.item.stat.num_of_collection))]):x._e()])])]):x._e(),x._v(" "),I("ShareDialog",{ref:"shareDialog",attrs:{type:"artwork"}})],1)}),[],!1,null,"2f902708",null);e.a=component.exports},546:function(t,e,n){"use strict";n(10),n(14),n(9),n(11),n(12),n(8),n(6);var o=n(2),r=(n(7),n(47),n(19),n(36),n(4),n(18),n(29),n(5)),l=n(1),c=n(56),d=n(33),h=n(30),v=n(106),m=n(92),f=n(13),_=n(132),y=n(21),w=n(105);function C(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?C(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var O={mixins:[d.a],components:{CollectPopover:c.a,AdminTag:v.a,ImgWaterFall:m.a},props:{fromPage:{type:String,default:""},item:{type:Object,default:function(){}},list:{type:Array,default:function(){return[]}},sysTag:{type:Object,default:function(){}},dotReportInfo:{type:Object,default:function(){return{category:"default",view_domain:"",batch_id:""}}},isTrainLora:{type:Boolean,default:!1}},computed:k(k(k({},Object(l.c)("user",["isLoggedIn","accountSettingsData"])),Object(l.e)("user",["userInfo","accountData","adminOff"])),{},{authorName:function(){var t,e=null===(t=this.item)||void 0===t?void 0:t.author,n=e.id;return e.name||n},getModelType:function(){var t,e,n,o,r,l,c,d="LORA"===(null===(t=this.item)||void 0===t||null===(t=t.art_model)||void 0===t?void 0:t.type)?"LoRA":null===(e=this.item)||void 0===e||null===(e=e.art_model)||void 0===e?void 0:e.type,h=(null===f.B||void 0===f.B?void 0:f.B.flux)||[],v="TextualInversion"===d,m="Pony"===(null===(n=this.item)||void 0===n||null===(n=n.art_model)||void 0===n?void 0:n.base_model),_=null===(o=this.item)||void 0===o||null===(o=o.art_model)||void 0===o?void 0:o.base_model;return null!==(r=this.item)&&void 0!==r&&null!==(r=r.art_model)&&void 0!==r&&r.base_model.includes("SDXL")&&!m?(v?this.$t("embedding1"):d)+" | XL ":h.includes(_)?"LORA"===(null===(l=this.item.art_model)||void 0===l?void 0:l.type)?"LoRA | F1 ":(null===(c=this.item.art_model)||void 0===c?void 0:c.type)+" | F1 ":v?this.$t("embedding1"):d},isMine:function(){var t,e;return(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)==(null===(e=this.userInfo)||void 0===e?void 0:e.id)},isPC:function(){return"PC"===localStorage.getItem("visitFrom")},setNsfwPlus:function(){return function(t){var e,n;return!(null==t||!t.nsfw_plus)&&(null===(e=this.userInfo)||void 0===e||!e.enable_nsfw_plus||[2,"2"].includes(null===(n=this.userInfo)||void 0===n||null===(n=n.settings)||void 0===n?void 0:n.nsfw_plus))}}}),data:function(){var t;return{isPersonal:null===(t=this.$route.meta)||void 0===t?void 0:t.isPersonal,copyTextToClipboard:r.d,saveImg:r.z,formatNumberForeign:r.i,itemShow:!1,itemShowId:"",collectDotReportInfo:{},cntShow:!0,from:"waterfall",otherShow:!1,loraTrainLoading:!1}},mounted:function(){var t=this;setTimeout((function(){t.otherShow=!0}),200)},methods:k(k({},Object(l.d)("home",["setAllUpdateStatus"])),{},{moreActions:function(t){var e=this,n=this.item,o=n.id,r=void 0===o?"":o,l=n.obj_type;switch(t){case"edit":this.$logEvent("log_actions",{operation:"click_edit",behavior_info:"on_personal_center",behavior_info_sub:l}),this.$router.push({path:this.localePath("/modelEditStep"),query:{id:r}});break;case"report":Object(w.e)({id:r}).then((function(t){e.$message.success(e.$t("ReportSuccess"))}));break;case"delete":this.$emit("moreActions","delete",this.item);break;case"pinOrNot":this.$emit("moreActions","pinOrNot",this.item)}},goLoraTrain:function(t){var e=this;["Checkpoint","LORA","TextualInversion"].includes(t.art_model.type)?this.isLoggedIn?this.loraTrainLoading||(this.loraTrainLoading=!0,Object(_.c)({model_id:t.id}).then((function(n){if(1e4==n.status.code){var o;if(!n.data.train_model_id)return e.$message(e.$t("loraTmpErr")),e.$emit("deleteItem",t.id),void e.setAllUpdateStatus(!0);var r=n.data.ver_id,l=(null===(o=t.art_model)||void 0===o?void 0:o.ver_id)||r;e.$router.push(e.localePath("/loraTrainingEdit?dataSetNo="+n.data.train_model_id+"&modelVerNo="+l))}})).finally((function(){e.loraTrainLoading=!1})),this.$logEvent("log_actions",{operation:"click_train_same_model",behavior_info:"on_template_page",behavior_info_sub:t.id})):this.$EventBus.$emit("openLoginDialog"):this.$message(this.$t("theTypeNocreate"))},handleMouseUp:function(t,e){if(2===t.which||1===t.button){var n=this.list.findIndex((function(i){return i.id===e.id})),o=(n<10?this.list.slice(0,n):this.list.slice(n-10,n)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));Object(h.g)({items:[k(k({},this.dotReportInfo),{},{negative_ids:o,action:"view",obj_no:e.id,obj_type:2})]})}},changeItemShow:function(t){this.itemShow=t.show,this.itemShowId=t.id,this.handleCollectPopoverClick(t)},handleCollectPopoverClick:function(t){var e=this.list.findIndex((function(i){return i.id===t.id})),n=(e<10?this.list.slice(0,e):this.list.slice(e-10,e)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));this.collectDotReportInfo=k(k({},this.dotReportInfo),{},{negative_ids:n,action:"collection",obj_no:t.id,obj_type:2})},checkGreen:function(t){return!this.isLoggedIn&&!(null==t||!t.green||![2,"2"].includes(t.green))},handleDetail:function(t,e){if(this.$logEvent("log_actions",{operation:"click_model",behavior_info:e.id}),"IMG"===t.target.tagName||"cltpop"===t.target.className||t.target.className.includes("boxItem")||t.target.className.includes("defBox")||t.target.className.includes("numItem")||"ImgWaterFall"===t.target.className||"green-mode-div"===t.target.className){if(this.checkGreen(e))return void this.$EventBus.$emit("openLoginDialog",{redirect:"/models/detail/"+e.id});var n=this.list.findIndex((function(i){return i.id===e.id})),o=(n<10?this.list.slice(0,n):this.list.slice(n-10,n)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));Object(h.g)({items:[k(k({},this.dotReportInfo),{},{negative_ids:o,action:"view",obj_no:e.id,obj_type:2,batch_id:null==e?void 0:e.pt,stat:null==e?void 0:e.stat},this.productLevel&&{vip:this.productLevel})]}),this.$router.push(this.localePath("/models/detail/"+e.id))}},handleClick:function(t){var e;if(["Checkpoint","LORA","TextualInversion"].includes(t.art_model.type))if(this.isLoggedIn){var n=Object.assign({},t);n.taskSource=1,n.logEventSource=Object(f.E)(this.$route.name),n.banner={url:n.cover},n.model_ver_no=null===(e=n.art_model)||void 0===e?void 0:e.ver_id,this.$EventBus.$emit("openGenerate",{action:1,data:{source:n}});var o=this.list.findIndex((function(i){return i.id===t.id})),r=(o<10?this.list.slice(0,o):this.list.slice(o-10,o)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));Object(h.g)({items:[k(k({},this.dotReportInfo),{},{negative_ids:r,action:"task",obj_no:t.id,obj_type:2})]});var l=t.id,c=t.obj_type,d=t.pt;this.$logEvent("log_actions",{operation:"same_create",behavior_info:l,obj_type:c,behavior_info_sub:d})}else this.$EventBus.$emit("openLoginDialog");else this.$message(this.$t("theTypeNocreate"))},otherUser:function(t){if(["Checkpoint","LORA","TextualInversion"].includes(t.art_model.type)){var path="/user/"+encodeURIComponent(t.author.id);this.userInfo.id==t.author.id&&(path="/personal"),window.open(this.localePath(path),"_blank")}else this.$message(this.$t("theTypeNocreate"))},tagChange:function(){this.$emit("change")},handlePopoverShow:function(){var t=this;if("userPage"===this.fromPage){var e=this.item,n=e.id,o=e.obj_type;Object(y.M)({obj_id:n,obj_type:o}).then((function(e){var n,o;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&t.$set(t.item,"isTop",null==e||null===(o=e.data)||void 0===o?void 0:o.is_top)}))}}})},x=(n(2310),n(0)),component=Object(x.a)(O,(function(){var t,e,n,o,r,l,c,d,h,v,m,f,_,y,w,C,k,O,x=this,I=x._self._c;return I("a",{attrs:{href:x.localePath("/models/detail/"+x.item.id),target:"_blank"},on:{click:function(t){return t.preventDefault(),x.handleDetail(t,x.item)},mouseup:function(t){return x.handleMouseUp(t,x.item)},mouseover:function(t){x.cntShow=!0}}},[I("div",{staticClass:"defBox marking-item",class:{"bg-nsfw":1===x.item.nsfw,boxItem:!x.setNsfwPlus(x.item)},style:{width:x.item.waterWidth+"px",height:x.item.waterHeight+"px"}},[x.item.sys_tag&&x.otherShow?I("div",{staticClass:"SysTag",style:{color:x.sysTag[x.item.sys_tag].color,backgroundColor:x.sysTag[x.item.sys_tag].bg}},[x._v("\n      "+x._s(x.$t(x.sysTag[x.item.sys_tag].txt))+"\n    ")]):x._e(),x._v(" "),I("div",{directives:[{name:"show",rawName:"v-show",value:x.item.NSFWSHOW&&[2,"2"].includes(null===(t=x.userInfo)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.nsfw_plus)&&x.otherShow,expression:"item.NSFWSHOW && [2, '2'].includes(userInfo?.settings?.nsfw_plus) && otherShow"}],staticClass:"NSFWSHOW",style:{right:null!==(e=x.item)&&void 0!==e&&e.nsfw_plus?"10px":"75px",opacity:null!==(n=x.item)&&void 0!==n&&n.nsfw_plus?1:0},on:{click:function(t){var e;t.preventDefault(),t.stopPropagation(),x.item.nsfw_plus=!(null!==(e=x.item)&&void 0!==e&&e.nsfw_plus)}}},[I("i",{staticClass:"iconfont",class:null!==(o=x.item)&&void 0!==o&&o.nsfw_plus?"icon-work-show":"icon-work-hide"})]),x._v(" "),1!==x.item.nsfw?I("ImgWaterFall",{style:{filter:x.setNsfwPlus(x.item)?"blur(19px) saturate(160%)":""},attrs:{item:x.item,isHeight:!1}}):x._e(),x._v(" "),2!==(null===(r=x.accountData)||void 0===r||null===(r=r.settings)||void 0===r?void 0:r.green_mode)&&x.otherShow?I("div",[[2,"2"].includes(x.item.green)&&!["/personal"].includes(x.$route.path)?I("div",{staticClass:"green-mode-div",staticStyle:{"backdrop-filter":"blur(19px) saturate(160%)",position:"absolute",left:"0",top:"0"},style:{width:x.item.waterWidth+"px",height:x.item.waterHeight+"px"}}):x._e()]):x._e(),x._v(" "),x.otherShow?I("div",{staticClass:"modelType"},[x._v("\n      "+x._s(x.getModelType)+" "),"Pony"===(null===(l=x.item.art_model)||void 0===l?void 0:l.base_model)?I("span",[x._v("| "),I("i",{staticClass:"iconfont icon-icon-horse"})]):x._e()]):x._e(),x._v(" "),x.cntShow&&x.otherShow?I("div",[x.isTrainLora?I("div",{staticClass:"waterfall-hover-try",on:{click:function(t){return t.preventDefault(),x.goLoraTrain(x.item)}}},[x._v("\n        "+x._s(x.$t("navModel"))+"\n      ")]):I("div",{staticClass:"waterfall-hover-try",on:{click:function(t){return t.preventDefault(),x.handleClick(x.item)}}},[x._v("\n        "+x._s("TextualInversion"!==(null===(c=x.item.art_model)||void 0===c?void 0:c.type)?x.$t("Remix"):x.$t("workFlow46"))+"\n      ")]),x._v(" "),I("admin-tag",{attrs:{id:x.item.id,item:x.item,type:"2"},on:{change:x.tagChange}}),x._v(" "),I("CollectPopover",{directives:[{name:"show",rawName:"v-show",value:x.isLoggedIn,expression:"isLoggedIn"}],staticClass:"CollectPop",style:{opacity:x.itemShow&&x.itemShowId==x.item.id?1:0},attrs:{dotReportInfo:x.collectDotReportInfo,type:"model",folder:x.item,from:"waterfall"},on:{showChaneg:x.changeItemShow}}),x._v(" "),I("div",{directives:[{name:"show",rawName:"v-show",value:x.isLoggedIn,expression:"isLoggedIn"}],staticClass:"cltpop",style:{opacity:x.itemShow&&x.itemShowId==x.item.id?1:0}},[I("i",{staticClass:"iconfont",class:x.setCollectData(x.item)})])],1):x._e(),x._v(" "),I("div",{staticClass:"cnt"},[I("div",{staticClass:"user",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),x.otherUser(x.item)}}},[null!==(d=x.item.author)&&void 0!==d&&d.head?I("div",{staticClass:"authorHead"},[I("img",{directives:[{name:"webp",rawName:"v-webp",value:x.$imgL,expression:"$imgL"}],attrs:{src:null===(h=x.item.author)||void 0===h?void 0:h.head,alt:""}})]):I("div",{staticClass:"authorHead"},[x._v(x._s(x.authorName[0]))]),x._v(" "),I("div",{staticClass:"authorName"},[x._v(x._s(x.authorName))])]),x._v(" "),I("div",{staticClass:"title"},[x._v(x._s(null===(v=x.item.art_model)||void 0===v?void 0:v.name))]),x._v(" "),x.item.stat.rating?I("div",{staticClass:"rate"},[I("el-rate",{attrs:{disabled:""},model:{value:x.item.stat.rating,callback:function(t){x.$set(x.item.stat,"rating",t)},expression:"item.stat.rating"}}),x._v(" "),I("span",[x._v(x._s(x.item.stat.rating))])],1):x._e(),x._v(" "),I("div",{staticClass:"numItem"},[x.cntShow?I("div",{staticClass:"funItem",staticStyle:{margin:"0"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),x.setCollect(x.item,"model")}}},[I("i",{staticClass:"iconfont",class:x.setCollectData(x.item)}),x._v(" "),null!==(m=x.item.stat)&&void 0!==m&&m.num_of_collection?I("span",[x._v(x._s(x.item.stat.num_of_collection))]):x._e()]):I("div",{staticClass:"funItem",staticStyle:{margin:"0"}},[I("i",{staticClass:"iconfont",class:x.item.collect?"icon-collect_selected":"icon-collect"}),x._v(" "),null!==(f=x.item.stat)&&void 0!==f&&f.num_of_collection?I("span",[x._v(x._s(x.item.stat.num_of_collection))]):x._e()]),x._v(" "),I("div",{staticClass:"funItem",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),x.handleClick(x.item)}}},[I("i",{staticClass:"iconfont icon-play"}),x._v(" "),null!==(_=x.item.stat)&&void 0!==_&&_.num_of_task?I("span",[x._v(x._s(x.formatNumberForeign(null===(y=x.item.stat)||void 0===y?void 0:y.num_of_task)))]):x._e()]),x._v(" "),I("div",{staticClass:"funItem",staticStyle:{"pointer-events":"none"}},[I("i",{staticClass:"iconfont icon-icon-Download"}),x._v(" "),null!==(w=x.item.stat)&&void 0!==w&&w.num_of_download?I("span",[x._v(x._s(x.formatNumberForeign(null===(C=x.item.stat)||void 0===C?void 0:C.num_of_download)))]):x._e()]),x._v(" "),x.isPersonal?I("el-popover",{ref:"myPopover",attrs:{placement:"top-end","popper-class":"water-fall-popover","append-to-body":!0,"visible-arrow":!1,width:"100",trigger:"hover"},on:{show:x.handlePopoverShow}},[I("div",{staticClass:"pop-btns flex"},[I("button",{directives:[{name:"show",rawName:"v-show",value:"userPage"==x.fromPage&&x.isMine,expression:"fromPage == 'userPage' && isMine"}],on:{click:function(t){return t.preventDefault(),x.moreActions("pinOrNot")}}},[x._v("\n              "+x._s(x.$t(null!==(k=x.item)&&void 0!==k&&k.isTop?"UnpinOverview":"PinOverview"))+"\n            ")]),x._v(" "),I("button",{directives:[{name:"show",rawName:"v-show",value:x.isMine,expression:"isMine"}],on:{click:function(t){return t.preventDefault(),x.moreActions("edit")}}},[x._v("\n              "+x._s(x.$t("Edit"))+"\n            ")]),x._v(" "),I("button",{on:{click:function(t){return t.preventDefault(),x.moreActions("report")}}},[x._v("\n              "+x._s(x.$t("Report"))+"\n            ")]),x._v(" "),I("button",{directives:[{name:"show",rawName:"v-show",value:x.isMine&&1==(null===(O=x.item)||void 0===O?void 0:O.primary),expression:"isMine && item?.primary == 1"}],on:{click:function(t){return t.preventDefault(),x.moreActions("delete")}}},[x._v("\n              "+x._s(x.$t("Delete"))+"\n            ")])]),x._v(" "),I("div",{staticClass:"funItem more-btn-opacity",attrs:{slot:"reference"},slot:"reference"},[I("i",{staticClass:"iconfont icon-more"})])]):x._e()],1)])],1)])}),[],!1,null,"0716e8e1",null);e.a=component.exports},547:function(t,e,n){"use strict";n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),r=n(5),l=n(1);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var h={props:{item:{type:Object,default:function(){}}},computed:d(d({},Object(l.c)("user",["isLoggedIn"])),{},{banners:function(){var t;return(null===(t=this.item)||void 0===t?void 0:t.banner)||[]}}),data:function(){return{replaceImageType:r.x}},methods:{jumpUrl:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(null!=t&&t.url){var e=null==t?void 0:t.url;this.$logEvent("log_actions",{operation:"click_home_banner",page_title:null==t?void 0:t.title,behavior_info:e}),window.open(e,"_blank")}}}},v=h,m=(n(2311),n(2312),n(0)),component=Object(m.a)(v,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"boxItem",style:{width:t.item.waterWidth+"px",height:t.item.waterHeight+"px"}},[e("div",{staticClass:"bannerBox"},[e("el-carousel",{attrs:{height:t.item.waterHeight+"px"}},t._l(t.banners,(function(img){return e("el-carousel-item",{key:img.cover},[e("img",{directives:[{name:"webp",rawName:"v-webp",value:t.$imgL,expression:"$imgL"}],attrs:{src:t.replaceImageType(img.cover),loading:"lazy",alt:""},on:{click:function(e){return t.jumpUrl(img)}}})])})),1)],1)])}),[],!1,null,"5af05414",null);e.a=component.exports},548:function(t,e,n){"use strict";n(9),n(7),n(11),n(12),n(8);var o=n(2),r=(n(4),n(6),n(1));function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var c={props:{item:{type:Object,default:function(){}}},data:function(){return{}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(r.c)("user",["isLoggedIn"])),activated:function(){var video=this.$refs.mainVideo;video&&video.length&&video.forEach((function(t){t.play&&t.play()}))},methods:{setName:function(code){var t="";switch(code){case"hd_repair":t=this.$t("ai_tools_1");break;case"remove_bg":t=this.$t("ai_tools_2");break;case"draft_to_img":t=this.$t("ai_tools_3");break;case"ai_filter":t=this.$t("ai_tools_4");break;case"ai_photography":t=this.$t("ai_tools_10");break;case"ai_exchange_face":t=this.$t("ai_face_changing");break;case"simple_text_to_img":t=this.$t("Text2imgTitle");break;case"ai_makeup":t=this.$t("ai_makeup");break;case"sora":t=this.$t("toolsPage3");break;case"ai_eraser":t=this.$t("ai_erase")}return t},goPage:function(code){var t="image-upscaler";switch(code){case"ai_makeup":t="ai-makeup";break;case"remove_bg":t="remove-background";break;case"draft_to_img":t="scribble2img";break;case"ai_filter":t="ai-filter";break;case"ai_photography":t="ai-portrait";break;case"ai_exchange_face":t="ai-face-swap";break;case"simple_text_to_img":t="text2img";break;case"sora":t="sora";break;case"ai_eraser":t="ai_erase"}this.$logEvent("log_actions",{operation:"click_tools",behavior_info:"on_quick_ai",behavior_info_sub:code,user_status:this.isLoggedIn?"activated":"guest"}),window.open(this.localePath("/ai-tools/"+t),"_blank")}}},d=c,h=(n(2313),n(2314),n(0)),component=Object(h.a)(d,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"videoBanner",style:{width:t.item.waterWidth+"px"}},[e("el-carousel",{attrs:{height:t.item.waterHeight+48+"px",interval:5e3}},t._l(t.item.ai_tool,(function(video){return e("el-carousel-item",{key:null==video?void 0:video.code},[e("div",{on:{click:function(e){return t.goPage(null==video?void 0:video.code)}}},[e("div",{staticClass:"videoBox",style:{width:t.item.waterWidth+"px",height:t.item.waterHeight+"px"}},[e("video",{ref:"mainVideo",refInFor:!0,attrs:{autoplay:"",muted:"",loop:"",src:null==video?void 0:video.url},domProps:{muted:!0}})]),t._v(" "),e("div",{staticClass:"objName"},[t._v(t._s(t.setName(null==video?void 0:video.code)))])])])})),1)],1)}),[],!1,null,"61f83dc0",null);e.a=component.exports},549:function(t,e,n){"use strict";n(10),n(14),n(9),n(7),n(11),n(12),n(8),n(6);var o=n(2),r=(n(4),n(125),n(1)),l=n(30),c=n(5),d=n(33),h=n(106),v=n(21),m=n(115),f=n(92);function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var w={mixins:[d.a],components:{AdminTag:h.a,listCheckbox:m.a,ImgWaterFall:f.a},props:{fromPage:{type:String,default:""},item:{type:Object,default:function(){}},list:{type:Array,default:function(){return[]}},review:{type:Boolean,default:!1},isCheck:{type:Boolean,default:!1},sysTag:{type:Object,default:function(){}}},data:function(){var t;return{isPersonal:null===(t=this.$route.meta)||void 0===t?void 0:t.isPersonal,formatNumberForeign:c.i,deleteLoad:!1,cntShow:!0}},computed:y(y(y({},Object(r.c)("user",["isLoggedIn","accountSettingsData"])),Object(r.e)("user",["userInfo","accountData","adminOff"])),{},{isMine:function(){var t,e;return(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)==(null===(e=this.userInfo)||void 0===e?void 0:e.id)},setNsfwPlus:function(){return function(t){var e,n;return!(null==t||!t.nsfw_plus)&&(null===(e=this.userInfo)||void 0===e||!e.enable_nsfw_plus||[2,"2"].includes(null===(n=this.userInfo)||void 0===n||null===(n=n.settings)||void 0===n?void 0:n.nsfw_plus))}},greenMode:function(){var t;return 2!==(null==this||null===(t=this.accountData)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.green_mode)},showGreenCover:function(){return[2,"2"].includes(this.item.green)&&!["/personal"].includes(this.$route.path)&&this.greenMode}}),activated:function(){var video=this.$refs.mainVideo;video&&video.play&&video.play()},methods:{moreActions:function(t){var e,n,o=this,r=this.item,c=r.id,d=r.obj_type;r.portfolio;switch(t){case"report":Object(l.q)({id:c,obj_type:d}).then((function(t){o.$message({message:o.$t("ReportSuccess"),type:"success"})}));break;case"edit":this.$logEvent("log_actions",{operation:"click_article_edit",behavior_info:"on_personal_center",behavior_info_sub:(null===(e=this.item)||void 0===e?void 0:e.id)||""}),this.$EventBus.$emit("openCreativeCenterModal",{id:(null===(n=this.item)||void 0===n?void 0:n.id)||"",type:"article"});break;case"delete":this.$emit("moreActions","delete",this.item);break;case"pinOrNot":this.$emit("moreActions","pinOrNot",this.item)}},isMP4Link:function(link){return!link||!link.toLowerCase().endsWith(".mp4")},onDelete:function(t){var e=this;this.$confirm(this.$t("postDeleteTip"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){e.deleteLoad||(e.deleteLoad=!0,Object(v.Z)({obj_id:t.id,obj_type:t.obj_type}).then((function(n){e.setWaterFallDeleteLits(t.id),e.$emit("resizeListener"),e.$message({type:"success",message:e.$t("deleteSuccess")})})).finally((function(){e.deleteLoad=!1})))})).catch((function(){}))},handleDetail:function(t,e){var n=this.showGreenCover;this.$logEvent("log_actions",{operation:"click_post",behavior_info:this.$route.path,behavior_info_sub:(n?"gallery_cover,":"gallery,")+e.id}),Object(l.g)({items:[{action:"view",obj_no:e.id,obj_type:4}]}),n&&!this.isLoggedIn?this.$EventBus.$emit("openLoginDialog",{redirect:"/articleDetail/"+e.id,dotCover:!0}):this.$router.push(this.localePath("/articleDetail/"+e.id))},otherUser:function(t){var path="/user/"+encodeURIComponent(t.author.id);this.userInfo.id==t.author.id&&(path="/personal"),window.open(this.localePath(path),"_blank")},tagChange:function(t){if("REVIEW"!==t)this.$emit("change");else{var e=this.$route.params;localStorage.setItem("reviewList",JSON.stringify(this.list));var path="/articleDetail/"+this.item.id+"?review=1&tag="+(null==e?void 0:e.tag);this.$router.push(this.localePath(path))}},handlePopoverShow:function(){var t=this;if("userPage"===this.fromPage){var e=this.item,n=e.id,o=e.obj_type;Object(v.M)({obj_id:n,obj_type:o}).then((function(e){var n,o;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&t.$set(t.item,"isTop",null==e||null===(o=e.data)||void 0===o?void 0:o.is_top)}))}}}},C=(n(2316),n(0)),component=Object(C.a)(w,(function(){var t,e,n,o,r,l,c,d,h,v,m,f,_=this,y=_._self._c;return y("a",{attrs:{href:_.localePath("/articleDetail/"+_.item.id),target:"_blank"},on:{click:function(t){t.preventDefault(),!_.isCheck&&_.handleDetail(t,_.item)},mouseover:function(t){_.cntShow=!0}}},[y("div",{staticClass:"defBox article",class:{"bg-nsfw":1===_.item.nsfw,boxItem:!_.setNsfwPlus(_.item)},style:{width:_.item.waterWidth+"px",height:_.item.waterHeight+"px"}},[_.isCheck&&_.item?y("listCheckbox",{on:{change:function(t){return _.$emit("checkChange")}},model:{value:_.item.isCheck,callback:function(t){_.$set(_.item,"isCheck",t)},expression:"item.isCheck"}}):_._e(),_._v(" "),_.item.sys_tag?y("div",{staticClass:"SysTag",style:{color:_.sysTag[_.item.sys_tag[0]].color,backgroundColor:_.sysTag[_.item.sys_tag[0]].bg}},[_._v("\n      "+_._s(_.$t(_.sysTag[_.item.sys_tag[0]].txt))+"\n    ")]):_._e(),_._v(" "),y("div",{directives:[{name:"show",rawName:"v-show",value:_.item.NSFWSHOW&&[2,"2"].includes(null===(t=_.userInfo)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.nsfw_plus),expression:"item.NSFWSHOW && [2, '2'].includes(userInfo?.settings?.nsfw_plus)"}],staticClass:"NSFWSHOW",style:{opacity:null!==(e=_.item)&&void 0!==e&&e.nsfw_plus?1:0},on:{click:function(t){var e;t.preventDefault(),t.stopPropagation(),_.item.nsfw_plus=!(null!==(e=_.item)&&void 0!==e&&e.nsfw_plus)}}},[y("i",{staticClass:"iconfont",class:null!==(n=_.item)&&void 0!==n&&n.nsfw_plus?"icon-work-show":"icon-work-hide"})]),_._v(" "),1!==_.item.nsfw&&_.isMP4Link(_.item.cover)?y("ImgWaterFall",{class:_.isCheck?"":"cntImg",style:{transform:_.item.isCheck?"scale(0.85)":null,transition:"all 0.3s ease-in-out",filter:_.setNsfwPlus(_.item)?"blur(19px) saturate(160%)":""},attrs:{item:_.item}}):1!=_.item.nsfw?y("video",{ref:"mainVideo",staticClass:"cntVideo",style:{filter:_.setNsfwPlus(_.item)?"blur(19px) saturate(160%)":""},attrs:{src:_.item.cover,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0}}):_._e(),_._v(" "),y("div",{directives:[{name:"show",rawName:"v-show",value:_.greenMode,expression:"greenMode"}]},[y("div",{directives:[{name:"show",rawName:"v-show",value:_.showGreenCover,expression:"showGreenCover"}],staticClass:"green-mode-div",staticStyle:{"backdrop-filter":"blur(19px) saturate(160%)",position:"absolute",left:"0",top:"0"},style:{width:_.item.waterWidth+"px",height:_.item.waterHeight+"px"}})]),_._v(" "),y("div",{staticClass:"article-tag"},[y("span",[_._v(_._s(_.$t("Article")))])]),_._v(" "),3==_.item.status||4==_.item.status||2==_.item.status?y("div",{staticClass:"statusCnt"},[y("div",{staticClass:"statusZg"}),_._v(" "),y("div",{staticClass:"statusBox",style:{color:4==_.item.status||2==_.item.status?"#EF3B3B":"#ffffff"}},[y("i",{staticClass:"iconfont icon-statusBox"}),_._v(" "),y("div",[_._v("\n          "+_._s(4==_.item.status?_.$t("notApproved"):2==_.item.status?_.$t("Ban"):_.$t("underReview"))+"\n        ")])])]):_._e(),_._v(" "),y("div",{staticClass:"cnt"},[y("div",{staticClass:"article-name",attrs:{title:null===(o=_.item)||void 0===o||null===(o=o.portfolio)||void 0===o?void 0:o.name}},[_._v(_._s(null===(r=_.item)||void 0===r||null===(r=r.portfolio)||void 0===r?void 0:r.name))]),_._v(" "),y("div",{staticClass:"article-info"},[y("div",{staticClass:"user",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),_.otherUser(_.item)}}},[null!==(l=_.item.author)&&void 0!==l&&l.head?y("div",{staticClass:"authorHead"},[y("img",{directives:[{name:"webp",rawName:"v-webp",value:_.$imgL,expression:"$imgL"}],attrs:{src:null===(c=_.item.author)||void 0===c?void 0:c.head,alt:""}})]):y("div",{staticClass:"authorHead"},[_._v(_._s(null===(d=_.item.author)||void 0===d?void 0:d.name[0]))]),_._v(" "),y("div",{staticClass:"authorName"},[_._v(_._s(null===(h=_.item.author)||void 0===h?void 0:h.name))])]),_._v(" "),y("div",{staticClass:"numItem"},[y("div",{staticClass:"funItem",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),_.setLike(_.item,"gallery")}}},[y("i",{staticClass:"iconfont",class:_.setlikeData(_.item)}),_._v(" "),null!==(v=_.item.stat)&&void 0!==v&&v.num_of_like?y("span",[_._v(_._s(_.item.stat.num_of_like))]):_._e()]),_._v(" "),y("div",{staticClass:"funItem",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),_.setCollect(_.item,"gallery")}}},[y("i",{staticClass:"iconfont",class:_.setCollectData(_.item)}),_._v(" "),null!==(m=_.item.stat)&&void 0!==m&&m.num_of_collection?y("span",[_._v(_._s(_.item.stat.num_of_collection))]):_._e()]),_._v(" "),_.isPersonal?y("el-popover",{ref:"myPopover",attrs:{placement:"top-end","popper-class":"water-fall-popover","append-to-body":!0,"visible-arrow":!1,width:"100",trigger:"hover"},on:{show:_.handlePopoverShow}},[y("div",{staticClass:"pop-btns flex"},[y("button",{directives:[{name:"show",rawName:"v-show",value:"userPage"==_.fromPage&&_.isMine,expression:"fromPage == 'userPage' && isMine"}],on:{click:function(t){return t.preventDefault(),_.moreActions("pinOrNot")}}},[_._v("\n                "+_._s(_.$t(null!==(f=_.item)&&void 0!==f&&f.isTop?"UnpinOverview":"PinOverview"))+"\n              ")]),_._v(" "),y("button",{directives:[{name:"show",rawName:"v-show",value:_.isMine,expression:"isMine"}],on:{click:function(t){return t.preventDefault(),_.moreActions("edit")}}},[_._v("\n                "+_._s(_.$t("Edit"))+"\n              ")]),_._v(" "),y("button",{on:{click:function(t){return t.preventDefault(),_.moreActions("report")}}},[_._v("\n                "+_._s(_.$t("Report"))+"\n              ")]),_._v(" "),y("button",{directives:[{name:"show",rawName:"v-show",value:3!=_.item.status&&_.isMine,expression:"item.status != 3 && isMine"}],on:{click:function(t){return t.preventDefault(),_.moreActions("delete")}}},[_._v("\n                "+_._s(_.$t("Delete"))+"\n              ")])]),_._v(" "),y("div",{staticClass:"funItem",attrs:{slot:"reference"},slot:"reference"},[y("i",{staticClass:"iconfont icon-more"})])]):_._e()],1)])])],1),_._v(" "),y("admin-tag",{attrs:{id:_.item.id,item:_.item,type:"4",review:_.review},on:{change:_.tagChange}})],1)}),[],!1,null,"f35c46f0",null);e.a=component.exports},55:function(t,e,n){"use strict";n(16),n(9),n(11),n(12),n(8);var o=n(15),r=n(2),l=(n(7),n(10),n(36),n(43),n(28),n(4),n(49),n(18),n(76),n(6),n(29),n(1)),c=n(87),d=n(39),h=n(35),v=n.n(h),m=n(33),f=n(387),_=n(5),y=n(545),w=n(546),C=n(547),k=n(548),O=n(549),x=n(550),I=(n(14),n(47),n(19),n(125),n(30),n(106)),D=n(21),S=n(115),P=n(92);function L(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function j(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?L(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var $={mixins:[m.a],components:{AdminTag:I.a,listCheckbox:S.a,ImgWaterFall:P.a},props:{item:{type:Object,default:function(){}},list:{type:Array,default:function(){return[]}},review:{type:Boolean,default:!1},isCheck:{type:Boolean,default:!1},sysTag:{type:Object,default:function(){}}},data:function(){return{formatNumberForeign:_.i,timeFormat:_.F,collectDotReportInfo:{},deleteLoad:!1,cntShow:!0,itemShow:!1}},computed:j(j(j({},Object(l.c)("user",["isLoggedIn","accountSettingsData"])),Object(l.e)("user",["userInfo","accountData","adminOff"])),{},{setNsfwPlus:function(){return function(t){var e,n;return!(null==t||!t.nsfw_plus)&&(null===(e=this.userInfo)||void 0===e||!e.enable_nsfw_plus||[2,"2"].includes(null===(n=this.userInfo)||void 0===n||null===(n=n.settings)||void 0===n?void 0:n.nsfw_plus))}},greenMode:function(){var t;return 2!==(null==this||null===(t=this.accountData)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.green_mode)},showGreenCover:function(){return[2,"2"].includes(this.item.green)&&!["/personal"].includes(this.$route.path)&&this.greenMode}}),activated:function(){var video=this.$refs.mainVideo;video&&video.play&&video.play()},methods:{isMP4Link:function(link){return!link||!link.toLowerCase().endsWith(".mp4")},handleCollectPopoverClick:function(t){var e=this.list.findIndex((function(i){return i.id===t.id})),n=(e<10?this.list.slice(0,e):this.list.slice(e-10,e)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));this.collectDotReportInfo=j(j({},this.dotReportInfo),{},{negative_ids:n,action:"collection",obj_no:t.id,obj_type:1})},changeItemShow:function(t){this.itemShow=t.show,this.itemShowId=t.id,this.handleCollectPopoverClick(t)},onDelete:function(t){var e=this;this.$confirm(this.$t("postDeleteTip"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){e.deleteLoad||(e.deleteLoad=!0,Object(D.Z)({obj_id:t.id,obj_type:t.obj_type}).then((function(n){e.setWaterFallDeleteLits(t.id),e.$emit("resizeListener"),e.$message({type:"success",message:e.$t("deleteSuccess")})})).finally((function(){e.deleteLoad=!1})))})).catch((function(){}))},handleDetail:function(t,e){this.$logEvent("log_actions",{operation:"click_ai_vedio",behavior_info:"on_homepage_ai_vedio_tab",behavior_info_sub:e}),("IMG"===t.target.tagName||"VIDEO"===t.target.tagName||"cltpop"===t.target.className||t.target.className.includes("imgBox")||"ImgWaterFall"===t.target.className||"green-mode-div"===t.target.className)&&(this.showGreenCover&&!this.isLoggedIn?this.$EventBus.$emit("openLoginDialog"):this.$router.push(this.localePath("/ai-video/detail/"+e.id)))},otherUser:function(t){var path="/user/"+encodeURIComponent(t.author.id);this.userInfo.id==t.author.id&&(path="/personal"),window.open(this.localePath(path),"_blank")},tagChange:function(t){if("REVIEW"===t){var e=this.$route.params;return localStorage.setItem("reviewList",JSON.stringify(this.list)),void this.$router.push(this.localePath("/ai-video/detail/"+this.item.id+"?review=1&tag="+(null==e?void 0:e.tag)))}this.$emit("change")}}},T=(n(2318),n(0)),B=Object(T.a)($,(function(){var t,e,n,o,r,l,c,d,h,v,m,f,_,y,w,C=this,k=C._self._c;return k("a",{attrs:{href:C.localePath("/ai-video/detail/"+C.item.id),target:"_blank"},on:{click:function(t){t.preventDefault(),!C.isCheck&&C.handleDetail(t,C.item)},mouseover:function(t){C.cntShow=!0}}},[k("div",{staticClass:"defBox marking-item",class:{"bg-nsfw":1===C.item.nsfw,boxItem:!C.setNsfwPlus(C.item)},style:{width:C.item.waterWidth+"px",height:C.item.waterHeight+"px"}},[C.isCheck&&C.item?k("listCheckbox",{on:{change:function(t){return C.$emit("checkChange")}},model:{value:C.item.isCheck,callback:function(t){C.$set(C.item,"isCheck",t)},expression:"item.isCheck"}}):C._e(),C._v(" "),C.item.sys_tag?k("div",{staticClass:"SysTag",style:{color:C.sysTag[C.item.sys_tag[0]].color,backgroundColor:C.sysTag[C.item.sys_tag[0]].bg}},[C._v("\n        "+C._s(C.$t(C.sysTag[C.item.sys_tag[0]].txt))+"\n      ")]):C._e(),C._v(" "),k("div",{directives:[{name:"show",rawName:"v-show",value:C.item.NSFWSHOW&&[2,"2"].includes(null===(t=C.userInfo)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.nsfw_plus),expression:"item.NSFWSHOW && [2, '2'].includes(userInfo?.settings?.nsfw_plus)"}],staticClass:"NSFWSHOW",style:{opacity:null!==(e=C.item)&&void 0!==e&&e.nsfw_plus?1:0},on:{click:function(t){var e;t.preventDefault(),t.stopPropagation(),C.item.nsfw_plus=!(null!==(e=C.item)&&void 0!==e&&e.nsfw_plus)}}},[k("i",{staticClass:"iconfont",class:null!==(n=C.item)&&void 0!==n&&n.nsfw_plus?"icon-work-show":"icon-work-hide"})]),C._v(" "),1!==C.item.nsfw&&C.isMP4Link(C.item.cover)?k("ImgWaterFall",{class:C.isCheck?"":"cntImg",style:{transform:C.item.isCheck?"scale(0.85)":null,transition:"all 0.3s ease-in-out",filter:C.setNsfwPlus(C.item)?"blur(19px) saturate(160%)":""},attrs:{item:C.item}}):1!=C.item.nsfw?k("video",{ref:"mainVideo",staticClass:"cntVideo",style:{filter:C.setNsfwPlus(C.item)?"blur(19px) saturate(160%)":""},attrs:{src:C.item.cover,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0}}):C._e(),C._v(" "),k("div",{directives:[{name:"show",rawName:"v-show",value:C.greenMode,expression:"greenMode"}]},[k("div",{directives:[{name:"show",rawName:"v-show",value:C.showGreenCover,expression:"showGreenCover"}],staticClass:"green-mode-div",staticStyle:{"backdrop-filter":"blur(19px) saturate(160%)",position:"absolute",left:"0",top:"0"},style:{width:C.item.waterWidth+"px",height:C.item.waterHeight+"px"}})]),C._v(" "),k("div",{staticClass:"imgNum"},[k("span",[C._v(C._s(C.$t("episodeNum",{num:(null===(o=C.item.ai_video)||void 0===o?void 0:o.max_episode)||0})))])]),C._v(" "),3==C.item.status||4==C.item.status||2==C.item.status?k("div",{staticClass:"statusCnt"},[k("div",{staticClass:"statusZg"}),C._v(" "),k("div",{staticClass:"statusBox",style:{color:4==C.item.status||2==C.item.status?"#EF3B3B":"#ffffff"}},[k("i",{staticClass:"iconfont icon-statusBox"}),C._v(" "),k("div",[C._v("\n            "+C._s(4==C.item.status?C.$t("notApproved"):2==C.item.status?C.$t("Ban"):C.$t("underReview"))+"\n          ")])])]):C._e(),C._v(" "),k("div",{directives:[{name:"show",rawName:"v-show",value:3!=C.item.status&&C.$route.name.includes("Personal")&&C.userInfo.id==C.item.author.id,expression:"\n          item.status != 3 &&\n          $route.name.includes('Personal') &&\n          userInfo.id == item.author.id\n        "}],staticClass:"deleteBox",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),C.onDelete(C.item)}}},[k("i",{staticClass:"iconfont icon-postDelete"})]),C._v(" "),k("div",{staticClass:"foot-box"},[k("div",{staticClass:"num-video-look"},[k("i",{staticClass:"iconfont icon-icon_Views"}),C._v(" "),k("span",[C._v(C._s(C.formatNumberForeign(null===(r=C.item.stat)||void 0===r?void 0:r.num_of_view)))])]),C._v(" "),null!==(l=C.item.ai_video)&&void 0!==l&&l.duration?k("div",{staticClass:"times"},[C._v("\n          "+C._s(C.timeFormat(null===(c=C.item.ai_video)||void 0===c?void 0:c.duration))+"\n        ")]):C._e()])],1),C._v(" "),k("div",{staticClass:"objName",style:{width:C.item.waterWidth+"px"}},[C._v("\n      "+C._s(null===(d=C.item.ai_video)||void 0===d?void 0:d.title)+"\n    ")]),C._v(" "),k("div",{staticClass:"author",style:{width:C.item.waterWidth+"px"}},[k("div",{staticClass:"userBox",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),C.otherUser(C.item)}}},[null!==(h=C.item.author)&&void 0!==h&&h.head?k("div",{staticClass:"authorHead"},[k("img",{directives:[{name:"webp",rawName:"v-webp",value:C.$imgL,expression:"$imgL"}],attrs:{src:null===(v=C.item.author)||void 0===v?void 0:v.head,alt:""}})]):k("div",{staticClass:"authorHead"},[C._v(C._s(null===(m=C.item.author)||void 0===m?void 0:m.name[0]))]),C._v(" "),k("div",{staticClass:"authorName"},[C._v(C._s(null===(f=C.item.author)||void 0===f?void 0:f.name))])]),C._v(" "),C.cntShow?k("div",{staticClass:"numItem"},[k("div",{staticClass:"funItem",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),C.setLike(C.item,"ai_video")}}},[k("i",{staticClass:"iconfont",class:C.setlikeData(C.item)}),C._v(" "),null!==(_=C.item.stat)&&void 0!==_&&_.num_of_like?k("span",[C._v(C._s(C.item.stat.num_of_like))]):C._e()])]):k("div",{staticClass:"numItem"},[k("div",{staticClass:"funItem"},[k("i",{staticClass:"iconfont",class:C.item.liked?"icon-like_selected":"icon-like"}),C._v(" "),null!==(y=C.item.stat)&&void 0!==y&&y.num_of_like?k("span",[C._v(C._s(C.item.stat.num_of_like))]):C._e()]),C._v(" "),k("div",{staticClass:"funItem"},[k("i",{staticClass:"iconfont",class:C.item.collect?"icon-collect_selected":"icon-collect-gpt"}),C._v(" "),null!==(w=C.item.stat)&&void 0!==w&&w.num_of_collection?k("span",[C._v(C._s(C.item.stat.num_of_collection))]):C._e()])])]),C._v(" "),k("admin-tag",{attrs:{id:C.item.id,item:C.item,type:"15",review:C.review},on:{change:C.tagChange}})],1)}),[],!1,null,"9cf09cc4",null).exports,M=n(551),R=n(552),A=n(268),E=n(505),N=n(553),F=n(74);function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function H(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var z=null,V={inject:["app"],mixins:[m.a,f.a],components:{workItem:y.a,modelItem:w.a,bannerItem:C.a,toolItem:k.a,articleItem:O.a,portfolioItem:x.a,aiVideoItem:B,videoItem:M.a,paletteItem:R.a,comfyItem:A.a,cyberBarItem:E.a,aiAudioItem:N.a},props:{isOpen:{type:Boolean,default:!0},isOpenNewTab:{type:Boolean,default:!1},fromPage:{type:String,default:""},list:{type:Array,default:function(){return[]}},container:{type:String,require:!0},activateTab:{type:String,default:""},needHorizontal:{type:Boolean,default:!1},gap:{type:Number,default:16},cols:{type:Number,default:7},colAdd:{type:Number,default:0},review:{type:Boolean,default:!1},isTiemRow:{type:Boolean,default:!1},isCheck:{type:Boolean,default:!1},checkMax:{type:Number,default:-1},dotReportInfo:{type:Object,default:function(){return{category:"default",view_domain:"",batch_id:""}}},isTrainLora:{type:Boolean,default:!1},resetHeight:{type:Boolean,default:!0},isDynamicList:{type:Boolean,default:!0},isShowNullRelatedImg:{type:Boolean,default:!1},activeName:{type:String,default:""},defaultMB:{type:Number,default:80},workAppParam:{type:Object,default:function(){return{isLogin:!0,height:912}}},row:{type:Number,default:1},boxId:{type:String,default:"container"},closeVirtualList:{type:Boolean,default:!0},isReverseLoad:{type:Boolean,default:!1}},data:function(){var t=this;return{isDelete:!1,dataList:this.list,width:0,scrollTop:0,selfCols:6,openWatch:!0,resizeListener:Object(c.a)((function(){return t.resize(t.dataList)}),500),lastTime:null,checkList:{ids:[],collectIds:[],folderNos:[],url:[]},isCheckAll:!1,sysTag:{latest:{color:"#ffffff",bg:"#0ABF94",txt:"New"},essence:{color:"#ffffff",bg:"rgb(241,49,78)",txt:"essence"},exclusive:{color:"#744100",bg:"#F4D292",txt:"exclusive"},first:{color:"#744100",bg:"#F4D292",txt:"debut"},recommended:{color:"#ffffff",bg:"#0ABF94",txt:"Recommend"}},startIndex:0,lastScrollTop:0,isServer:!0,openWaterFall:!1,isTest:!1}},computed:H(H(H({},Object(l.c)("user",["isLoggedIn","accountSettingsData"])),Object(l.e)("user",["userInfo","accountData"])),{},{renderList:function(){var t=this.$parent.$refs[this.container];if(!t||!this.closeVirtualList)return this.dataList;var e=this.scrollTop-t.offsetTop,n=e-window.innerHeight,o=e+window.innerHeight+1e3;if(e>this.lastScrollTop)for(;this.startIndex<this.dataList.length&&(null===(r=this.dataList[this.startIndex])||void 0===r?void 0:r.top)<=n;){var r;this.startIndex++}else for(;this.startIndex>0&&(null===(l=this.dataList[this.startIndex])||void 0===l?void 0:l.top)>=n;){var l;this.startIndex--}for(var c=this.startIndex;c<this.dataList.length&&(null===(d=this.dataList[c])||void 0===d?void 0:d.top)<=o;){var d;c++}this.lastScrollTop=e;var h=this.isDynamicList?this.dataList.slice(this.startIndex,c):this.dataList;return h=h.filter((function(t,e){return t}))},dataInfo:function(){return function(t){var e={id:t.id,type:t.obj_type,pt:t.pt};return JSON.stringify(e)}}}),watch:{isOpen:function(t){this.resizeListener()},cols:{handler:function(t){var e=this;this.$nextTick((function(){e.width=e.getWidth()}))},immediate:!0},list:{handler:function(t){var e=this;this.$nextTick((function(){var n=e.openWatch;e.width;if(n){e.width||(e.width=e.getWidth());var r=v()(t);if(e.dataList.length<100)e.$nextTick((function(){e.updateDataList(r,!1)}));else if(r.length>e.dataList.length){var l=Object(o.a)(r.slice(e.dataList.length));e.updateDataList(l,!0)}else r.length<e.dataList.length&&(e.dataList=[],e.startIndex=0,e.updateDataList(r,!1))}}))},immediate:!0},isCheck:{handler:function(t){this.isCheckAll=!1,this.dataList.forEach((function(t){t.isCheck=!1})),this.checkList={ids:[],collectIds:[],folderNos:[],url:[]},this.$emit("getChecList",this.checkList)}},WaterFallDeleteLits:{handler:function(t){this.isDelete=!0}},"app.showMenu":function(t){this.resizeListener()},isLoggedIn:function(t){!t&&this.resizeListener()}},activated:function(){var t=this;this.openWatch=!0,this.isDelete&&(this.resizeListener(),this.isDelete=!1),window.addEventListener("resize",this.resizeListener),window.addEventListener("scroll",Object(F.throttle)(this.lazyLoad,200),{passive:!0}),this.$nextTick((function(){window.scrollTo(0,t.scrollTop)}))},deactivated:function(){this.openWatch=!1,window.removeEventListener("resize",this.resizeListener),window.removeEventListener("scroll",Object(F.throttle)(this.lazyLoad,200))},mounted:function(){window.addEventListener("resize",this.resizeListener),window.addEventListener("scroll",Object(F.throttle)(this.lazyLoad,200),{passive:!0}),this.isServer=!1},beforeDestroy:function(){window.removeEventListener("resize",this.resizeListener)},methods:H(H({},Object(l.b)("user",["getAccountInfo"])),{},{handleBox:function(t){this.isCheck&&this.selectCheck(t);var e=t.id,n=t.obj_type,o=t.ai_video,r=t.pt;n=o?n+"_"+(null==o?void 0:o.video_type):n,this.$logEvent("log_actions",{operation:"click",obj_type:n,behavior_info:e,behavior_info_sub:r})},moreActions:function(t,e){var n=this,o=e.id,r=void 0===o?"":o,l=e.obj_type;switch(t){case"delete":this.$logEvent("log_actions",{operation:"click_delete",behavior_info:"on_personal_center",behavior_info_sub:l});this.$confirm(this.$t({2:"model_delete_tips",4:"post_delete_tips",5:"post_delete_tips",9:"character_delete_tips",11:"palette_delete_tips",13:"comfyui_delete_tips",16:"audioDeledQuery"}[l]||"canvas_delete_tips"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){Object(D.g)({ids:[r],category:2,obj_type:l}).then((function(t){var e;1e4==(null==t||null===(e=t.status)||void 0===e?void 0:e.code)&&(n.$message({message:n.$t("deleteSuccess"),type:"success"}),n.deleteItem(r))}))})).catch((function(t){console.log("err",t)}));break;case"pinOrNot":this.$logEvent("log_actions",{operation:"click_top_to_overview",behavior_info:"on_personal_center",behavior_info_sub:l});var c={obj_id:r,obj_type:l};null!=e&&e.isTop&&(c.up_type="down"),Object(D.I)(c).then((function(t){var o;1e4==(null==t||null===(o=t.status)||void 0===o?void 0:o.code)&&(n.$message({message:n.$t(null!=e&&e.isTop?"UnpinSuccess":"PinSuccess"),type:"success"}),n.$set(e,"isTop",!e.isTop))}))}},deleteItem:function(t){var e=this.dataList.filter((function(e){return e.id!==t}));this.resize(e)},handleRefresh:function(){},getItemTime:function(t){var e=new Date(t),n=e.getFullYear(),o=(e.getMonth()+1).toString().padStart(2,"0");return"".concat(n,"-").concat(o)},processTimeGroups:function(t){for(var i=0;i<t.length;i++){var e,n,o,r,l=t[i];if(null!=l&&null!==(e=l.folder_no)&&void 0!==e&&e.collect_at)if(this.getItemTime(null==l||null===(n=l.folder_no)||void 0===n?void 0:n.collect_at)!==this.lastTime)t.splice(i,0,{timeItem:this.getItemTime(null==l||null===(o=l.folder_no)||void 0===o?void 0:o.collect_at)}),this.lastTime=this.getItemTime(null==l||null===(r=l.folder_no)||void 0===r?void 0:r.collect_at)}return t},updateDataList:function(t,e){var n=this,o=this.WaterFallDeleteLits,r=this.width,l=this.isCheckAll,c=this.checkList,h=this.isTiemRow;r||(this.width=this.getWidth());var v=t.filter((function(t){return!o.includes(t.id)}));h&&(e||(this.lastTime=null),this.processTimeGroups(v));for(var i=0;i<v.length;i++){var m=v[i];if(m.stat&&(this.$set(m.stat,"num_of_like",m.stat.num_of_like>0?Object(_.i)(m.stat.num_of_like):0),this.$set(m.stat,"num_of_collection",m.stat.num_of_collection>0?Object(_.i)(m.stat.num_of_collection):0)),1==m.obj_type&&this.$set(m,"propS",!1),m.timeItem)m.waterWidth=r,m.waterHeight=30;else{var f,y,w;if(this.$set(m,"NSFWSHOW",(null==m?void 0:m.nsfw_plus)&&(null===(f=this.userInfo)||void 0===f?void 0:f.enable_nsfw_plus)),!l&&c.ids.includes(m.id)?this.$set(m,"isCheck",c.ids.includes(m.id)):this.$set(m,"isCheck",!!l),l&&!c.ids.includes(m.id))c.ids.push(m.id),null!=m&&null!==(y=m.collect)&&void 0!==y&&y.id&&c.collectIds.push(m.collect.id),null!=m&&null!==(w=m.folder_no)&&void 0!==w&&w.id&&c.folderNos.push(m.folder_no.id),null!=m&&m.cover&&c.url.push(m.cover);if(m.timeDiff=Object(d.c)(m.created_at,Date.now(),this.$t),m.waterWidth=r,this.isTiemRow)m.waterHeight=r;else{var C,k=this.getDimensions(m),O=k.intWidth,x=k.inHeight;m.waterHeight=parseInt(x*r/O),"feature"===this.activateTab&&9===m.obj_type&&(m.waterHeight+=60),isNaN(m.waterHeight)&&(m.waterHeight=320),this.needHorizontal&&5==m.obj_type&&(m.needRotate=!0,this.$EventBus.$emit("resetMediaSize",{width:this.width,height:m.waterHeight,resize:!1})),16==m.obj_type&&(m.waterHeight=257),4==m.obj_type&&"article"==(null==m||null===(C=m.portfolio)||void 0===C?void 0:C.sub_channel)&&(m.waterHeight=334)}m.cover&&!m.replaceUrl&&(m.replaceUrl=Object(_.x)(m.cover,13==m.obj_type?"high":"low"))}}e?v.forEach((function(t){n.dataList.push(t)})):this.dataList=v,this.waterfall()},getDimensions:function(t){var e,n=t.cover_width?t.cover_width:308,o=t.cover_height?t.cover_height:308,r=1===(null==t||null===(e=t.ai_video)||void 0===e?void 0:e.video_type);switch(t.obj_type){case 13:n=319,o=411;break;case 2:n=337,o=476;break;case 9:n="feature"===this.activateTab?240:337,o="feature"===this.activateTab?340:620;break;case 5:n=this.needHorizontal?337:n,o=this.needHorizontal?193:o;break;case 15:n=r?337:n,o=r?193:o;break;case 16:n=236,o=256}return{intWidth:n,inHeight:o}},selectCheck:function(t){-1==this.checkMax||this.checkList.ids.length<this.checkMax||t.isCheck?(this.checkList.ids.length==this.dataList.length&&(this.isCheckAll=!0),t.isCheck&&(this.isCheckAll=!1),t.isCheck=!t.isCheck):this.$message({message:this.$t("已超过最大选择上限"),type:"warning"})},checkAll:function(){var t=this;if(this.isCheck){var e=this.dataList.filter((function(t){return!t.timeItem}));this.checkList.ids.length<e.length?(e.forEach((function(e){e.isCheck=!0,t.checkChange(e)})),this.isCheckAll=!0):(e.forEach((function(e){e.isCheck=!1,t.checkChange(e)})),this.isCheckAll=!1)}},clearCheck:function(t){var e=this;t.forEach((function(t){e.dataList.forEach((function(e){t==e.id&&(e.isCheck=!1)})),e.checkList.ids.forEach((function(n,o){t!==n&&t.id!==n||(e.checkList.ids.splice(o,1),e.checkList.collectIds.splice(o,1),e.checkList.folderNos.splice(o,1),e.checkList.url.splice(o,1))}))})),this.$emit("getChecList",this.checkList)},checkChange:function(t){if(t.isCheck){var e,n,o;if(!this.checkList.ids.includes(t.id))this.checkList.ids.push(t.id),null!=t&&null!==(e=t.collect)&&void 0!==e&&e.id&&this.checkList.collectIds.push(t.collect.id),null!=t&&null!==(n=t.folder_no)&&void 0!==n&&n.id&&this.checkList.folderNos.push(t.folder_no.id),null!=t&&null!==(o=t.banner)&&void 0!==o&&o.url&&this.checkList.url.push(t.banner.url)}else{var r,l,c;if(-1==this.checkList.ids.indexOf(t.id))return;this.checkList.ids.splice(this.checkList.ids.indexOf(t.id),1),null!=t&&null!==(r=t.collect)&&void 0!==r&&r.id&&this.checkList.collectIds.splice(this.checkList.collectIds.indexOf(t.collect.id),1),null!=t&&null!==(l=t.folder_no)&&void 0!==l&&l.id&&this.checkList.folderNos.splice(this.checkList.folderNos.indexOf(t.folder_no.id),1),null!=t&&null!==(c=t.banner)&&void 0!==c&&c.url&&this.checkList.url.splice(this.checkList.url.indexOf(t.banner.url),1)}this.$emit("getChecList",this.checkList)},resize:function(t){var e,n=this;this.openWatch&&((null===(e=this.$parent)||void 0===e||null===(e=e.$refs)||void 0===e||null===(e=e[this.container])||void 0===e?void 0:e.offsetWidth)<600||(this.dataList=v()(t).filter((function(t){return!n.WaterFallDeleteLits.includes(t.id)})),this.width=this.getWidth(),this.dataList.forEach((function(t){if(t.timeItem)t.waterWidth=n.width,t.waterHeight=30;else{if(t.timeDiff=Object(d.c)(t.created_at,Date.now(),n.$t),t.waterWidth=n.width,n.isTiemRow)t.waterHeight=n.width;else{var e,o=n.getDimensions(t),r=o.intWidth,l=o.inHeight;t.waterHeight=parseInt(l*n.width/r),isNaN(t.waterHeight)&&(t.waterHeight=320),n.needHorizontal&&5==t.obj_type&&(t.needRotate=!0,n.$EventBus.$emit("resetMediaSize",{width:n.width,height:t.waterHeight,resize:!0})),16==t.obj_type&&(t.waterHeight=257),4==t.obj_type&&"article"==(null==t||null===(e=t.portfolio)||void 0===e?void 0:e.sub_channel)&&(t.waterHeight=334)}t.cover&&!t.replaceUrl&&(t.replaceUrl=Object(_.x)(t.cover,13==t.obj_type?"high":"low"))}})),this.waterfall()))},waterfall:function(){var t=this;try{this.openWaterFall=!1,this.heights=[];for(var e=function(){var e,n=t.dataList[i],o=n.waterHeight,r=6==n.obj_type?0:1==n.obj_type||7==n.obj_type?40:70;if((13==n.obj_type||2==n.obj_type||9==n.obj_type||14==n.obj_type||16==n.obj_type||4==n.obj_type&&"article"==(null==n||null===(e=n.portfolio)||void 0===e?void 0:e.sub_channel))&&(r=0),n.timeItem){n.left=0;var l=t.getMaxIndex(t.heights);n.top=l>-1?t.heights[l]+t.gap:0,t.heights.forEach((function(e,l){t.heights[l]=n.top+o+r}))}else if(t.heights.length<t.selfCols)if(t.dataList[i-1]&&t.dataList[i-1].timeItem)if(n.left=0,n.top=t.dataList[i-1].top+t.dataList[i-1].waterHeight+t.gap,t.heights[0]){var c=t.heights[0]+o+r;t.heights=[c+t.gap]}else t.heights.push(n.top+o+r);else n.top=t.dataList[i-1]?t.dataList[i-1].top:0,n.left=t.heights.length*(t.width+t.gap),t.heights.push(n.top+o+r);else{if(i>=t.selfCols*t.row&&"videoPageList"===t.fromPage)return 1;var d=t.getMinIndex(t.heights),h=t.heights[d]+t.gap;n.top=h,n.left=d*(t.width+t.gap),t.heights[d]=h+o+r}},i=0;i<this.dataList.length&&!e();i++);this.setWaterFallRect(),this.$nextTick((function(){t.openWaterFall=!0}))}catch(t){}},getMinIndex:function(t){var e=Math.min.apply(null,t);return t.indexOf(e)},getMaxIndex:function(t){var e=Math.max.apply(null,t);return t.indexOf(e)},getWidth:function(){var t;this.selfCols=this.cols,"userPage"==this.fromPage&&(this.selfCols=6);var e=null===(t=this.$parent.$refs[this.container])||void 0===t?void 0:t.offsetWidth;if(e||"videoPageList"!==this.fromPage||(e=document.body.clientWidth-154),e){e<1900&&(this.selfCols=6),e<1600&&(this.selfCols=5),e<1300&&(this.selfCols=5),e<1e3&&(this.selfCols=3),e<700&&(this.selfCols=2),e<220&&(this.selfCols=1);var n="cyber_bar"===this.activateTab||"cyberpub"===this.activeName;n&&(this.selfCols=5),n&&e>1600&&(this.selfCols=6),n&&e<1240&&(this.selfCols=4),this.needHorizontal&&(this.selfCols=e<1600?4+this.colAdd:e>1900?6+this.colAdd:5+this.colAdd,this.$emit("setCols",this.selfCols));var o="ai_audio"===this.activateTab;o&&e>1600&&(this.selfCols=7),o&&e>1240&&e<1600&&(this.selfCols=6),o&&e<1240&&(this.selfCols=4);var r=~~((e-(this.selfCols-1)*this.gap)/this.selfCols);return r>180?r:180}},setWaterFallRect:function(){var t=this.$parent.$refs[this.container],e=Math.max.apply(null,this.heights),n=this.workAppParam,o=n.isLogin,r=n.height;this.list.length||!this.resetHeight?(t.style.height=o?e+"px":r+"px",t.style.marginBottom=this.defaultMB+"px"):t.style.height=0},lazyLoad:function(){var t=this.workAppParam.isLogin;if(this.openWatch&&t){var e=document.documentElement.scrollHeight,n=window.innerHeight;this.scrollTop=document.documentElement.scrollTop||document.body.scrollTop||window.pageYOffset,e-this.scrollTop-n<1.5*n&&this.$emit("load"),this.isReverseLoad&&this.reverseLoadFn()}},reverseLoadFn:function(){var t=this.$parent.$refs[this.container].querySelectorAll(".box"),e=t[t.length-1],n=e&&e.getBoundingClientRect(),o=window.innerHeight;e&&n.top<o&&this.$emit("onReverseLoad")},adminHandle:function(t){this.setWaterFallDeleteLits(t),this.resizeListener()},onVideoPlay:function(t){var e=t.fun;clearTimeout(z),z=setTimeout((function(){e()}),1e3)}})},W=(n(2328),Object(T.a)(V,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"homeList",class:{"server-list":t.isServer},attrs:{id:t.boxId}},[t._l(t.renderList,(function(n,o){var r;return e("div",{directives:[{name:"show",rawName:"v-show",value:"videoPageList"!==t.fromPage||o<t.selfCols*t.row,expression:"fromPage === 'videoPageList' ? index < selfCols * row : true"},{name:"observe-visibility",rawName:"v-observe-visibility",value:t.handleVisibility,expression:"handleVisibility"}],key:((null==n?void 0:n.top)||(null==n?void 0:n.id))+","+((null==n?void 0:n.left)||"list"),staticClass:"box marking-item",class:[t.activateTab+"-box"],style:{transform:t.openWaterFall?"translateX(".concat(n.left,"px) translateY(").concat(n.top,"px)"):null,width:n.waterWidth+"px",height:n.waterHeight+"px"},attrs:{"data-info":t.dataInfo(n)},on:{click:function(e){return t.handleBox(n)}}},[n.timeItem?e("div",{staticClass:"timeRow",style:{width:n.waterWidth+"px",height:n.waterHeight+"px"}},[t._v("\n      "+t._s(n.timeItem)+"\n    ")]):t._e(),t._v(" "),1==n.obj_type?e("workItem",{attrs:{item:n,list:t.dataList,dotReportInfo:t.dotReportInfo,review:t.review,sysTag:t.sysTag,fromPage:t.fromPage},on:{resizeListener:t.resizeListener,change:function(e){return t.adminHandle(n.id)},moreActions:t.moreActions}}):t._e(),t._v(" "),2==n.obj_type?e("modelItem",{attrs:{item:n,list:t.dataList,dotReportInfo:t.dotReportInfo,sysTag:t.sysTag,isTrainLora:t.isTrainLora,fromPage:t.fromPage},on:{change:function(e){return t.adminHandle(n.id)},deleteItem:t.deleteItem,moreActions:t.moreActions}}):t._e(),t._v(" "),4==n.obj_type?["article"==(null==n||null===(r=n.portfolio)||void 0===r?void 0:r.sub_channel)?e("articleItem",{attrs:{item:n,list:t.dataList,review:t.review,isCheck:t.isCheck,sysTag:t.sysTag,fromPage:t.fromPage},on:{change:function(e){return t.adminHandle(n.id)},resizeListener:t.resizeListener,checkChange:function(e){return t.checkChange(n)},moreActions:t.moreActions}}):e("portfolioItem",{attrs:{item:n,list:t.dataList,review:t.review,isCheck:t.isCheck,sysTag:t.sysTag,fromPage:t.fromPage},on:{change:function(e){return t.adminHandle(n.id)},resizeListener:t.resizeListener,checkChange:function(e){return t.checkChange(n)},moreActions:t.moreActions}})]:t._e(),t._v(" "),15==n.obj_type?e("aiVideoItem",{attrs:{item:n,list:t.dataList,review:t.review,isCheck:t.isCheck,sysTag:t.sysTag},on:{change:function(e){return t.adminHandle(n.id)},resizeListener:t.resizeListener,checkChange:function(e){return t.checkChange(n)}}}):t._e(),t._v(" "),5==n.obj_type?e("videoItem",{attrs:{item:n,review:t.review,list:t.dataList,isCheck:t.isCheck,sysTag:t.sysTag,fromPage:t.fromPage},on:{change:function(e){return t.adminHandle(n.id)},resizeListener:t.resizeListener,checkChange:function(e){return t.checkChange(n)},onPlay:t.onVideoPlay,moreActions:t.moreActions}}):t._e(),t._v(" "),11==n.obj_type?e("paletteItem",{attrs:{item:n,list:t.dataList,isCheck:t.isCheck,dotReportInfo:t.dotReportInfo,fromPage:t.fromPage},on:{change:function(e){return t.adminHandle(n.id)},checkChange:function(e){return t.checkChange(n)},moreActions:t.moreActions}}):t._e(),t._v(" "),13==n.obj_type||14==n.obj_type?e("comfyItem",{attrs:{isOpenNewTab:t.isOpenNewTab,item:n,list:t.dataList,isCheck:t.isCheck,dotReportInfo:t.dotReportInfo,fromPage:t.fromPage,review:t.review},on:{resizeListener:t.resizeListener,checkChange:function(e){return t.checkChange(n)},moreActions:t.moreActions,change:function(e){return t.adminHandle(n.id)}}}):t._e(),t._v(" "),9==n.obj_type?e("cyberBarItem",{attrs:{item:n,isCheck:t.isCheck,fromPage:t.fromPage,dotReportInfo:t.dotReportInfo,activateTab:t.activateTab,review:t.review},on:{checkChange:function(e){return t.checkChange(n)},moreActions:t.moreActions,change:function(e){return t.adminHandle(n.id)}}}):t._e(),t._v(" "),16==n.obj_type?e("aiAudioItem",{attrs:{item:n,isCheck:t.isCheck,fromPage:t.fromPage},on:{checkChange:function(e){return t.checkChange(n)},moreActions:t.moreActions}}):t._e(),t._v(" "),6==n.obj_type?e("bannerItem",{attrs:{item:n}}):t._e(),t._v(" "),7==n.obj_type?e("toolItem",{attrs:{item:n}}):t._e()],2)})),t._v(" "),t.isShowNullRelatedImg?e("div",{staticClass:"null-data-container"},[e("img",{staticClass:"null-image",attrs:{src:n(289),alt:"null_related_image"},on:{load:function(e){return t.$emit("solveScrollbarStyle")}}}),t._v(" "),e("div",{staticClass:"null-tips"},[t._v(t._s(t.$t("NoRelatedWorks")))])]):t._e(),t._v(" "),e("div",{attrs:{id:"wraperBoxId"}})],2)}),[],!1,null,"8323adf6",null));e.a=W.exports},550:function(t,e,n){"use strict";n(10),n(14),n(9),n(7),n(11),n(12),n(8),n(6);var o=n(2),r=(n(16),n(4),n(125),n(1)),l=n(30),c=n(5),d=n(33),h=n(106),v=n(21),m=n(115),f=n(92);function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var w={mixins:[d.a],components:{AdminTag:h.a,listCheckbox:m.a,ImgWaterFall:f.a},props:{fromPage:{type:String,default:""},item:{type:Object,default:function(){}},list:{type:Array,default:function(){return[]}},review:{type:Boolean,default:!1},isCheck:{type:Boolean,default:!1},sysTag:{type:Object,default:function(){}}},data:function(){var t;return{isPersonal:null===(t=this.$route.meta)||void 0===t?void 0:t.isPersonal,formatNumberForeign:c.i,deleteLoad:!1,cntShow:!0}},computed:y(y(y(y({},Object(r.c)("user",["isLoggedIn","accountSettingsData"])),Object(r.e)("user",["userInfo","accountData","adminOff"])),Object(r.e)("payment",["productLevel"])),{},{isMine:function(){var t,e;return(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)==(null===(e=this.userInfo)||void 0===e?void 0:e.id)},setNsfwPlus:function(){return function(t){var e,n;return!(null==t||!t.nsfw_plus)&&(null===(e=this.userInfo)||void 0===e||!e.enable_nsfw_plus||[2,"2"].includes(null===(n=this.userInfo)||void 0===n||null===(n=n.settings)||void 0===n?void 0:n.nsfw_plus))}},greenMode:function(){var t;return 2!==(null==this||null===(t=this.accountData)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.green_mode)},showGreenCover:function(){return[2,"2"].includes(this.item.green)&&!["/personal"].includes(this.$route.path)&&this.greenMode}}),activated:function(){var video=this.$refs.mainVideo;video&&video.play&&video.play()},methods:{moreActions:function(t){var e=this,n=this.item,o=n.id,r=n.obj_type;switch(t){case"report":Object(l.q)({id:o,obj_type:r}).then((function(t){e.$message({message:e.$t("ReportSuccess"),type:"success"})}));break;case"delete":this.$emit("moreActions","delete",this.item);break;case"pinOrNot":this.$emit("moreActions","pinOrNot",this.item)}},isMP4Link:function(link){return!link||!link.toLowerCase().endsWith(".mp4")},onDelete:function(t){var e=this;this.$confirm(this.$t("postDeleteTip"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){e.deleteLoad||(e.deleteLoad=!0,Object(v.Z)({obj_id:t.id,obj_type:t.obj_type}).then((function(n){e.setWaterFallDeleteLits(t.id),e.$emit("resizeListener"),e.$message({type:"success",message:e.$t("deleteSuccess")})})).finally((function(){e.deleteLoad=!1})))})).catch((function(){}))},handleDetail:function(t,e){var n=this.showGreenCover;this.$logEvent("log_actions",{operation:"click_post",behavior_info:this.$route.path,behavior_info_sub:(n?"gallery_cover,":"gallery,")+e.id}),Object(l.g)({items:[y({action:"view",obj_no:e.id,obj_type:4,batch_id:null==e?void 0:e.pt,stat:null==e?void 0:e.stat},this.productLevel&&{vip:this.productLevel})]}),n&&!this.isLoggedIn?this.$EventBus.$emit("openLoginDialog",{redirect:"/artWorkDetail/"+e.id,dotCover:!0}):this.$router.push(this.localePath("/artWorkDetail/"+e.id))},otherUser:function(t){var path="/user/"+encodeURIComponent(t.author.id);this.userInfo.id==t.author.id&&(path="/personal"),window.open(this.localePath(path),"_blank")},tagChange:function(t){if("REVIEW"===t){var e=this.$route.params;return localStorage.setItem("reviewList",JSON.stringify(this.list)),void this.$router.push(this.localePath("/artWorkDetail/".concat(this.item.id,"?review=1&tag=").concat(null==e?void 0:e.tag)))}this.$emit("change")},handlePopoverShow:function(){var t=this;if("userPage"===this.fromPage){var e=this.item,n=e.id,o=e.obj_type;Object(v.M)({obj_id:n,obj_type:o}).then((function(e){var n,o;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&t.$set(t.item,"isTop",null==e||null===(o=e.data)||void 0===o?void 0:o.is_top)}))}}}},C=(n(2317),n(0)),component=Object(C.a)(w,(function(){var t,e,n,o,r,l,c,d,h,v,m,f,_,y,w=this,C=w._self._c;return C("a",{attrs:{href:w.localePath("/artWorkDetail/"+w.item.id),target:"_blank"},on:{click:function(t){t.preventDefault(),!w.isCheck&&w.handleDetail(t,w.item)},mouseover:function(t){w.cntShow=!0}}},[C("div",{staticClass:"defBox",class:{"bg-nsfw":1===w.item.nsfw,boxItem:!w.setNsfwPlus(w.item)},style:{width:w.item.waterWidth+"px",height:w.item.waterHeight+"px"}},[w.isCheck&&w.item?C("listCheckbox",{on:{change:function(t){return w.$emit("checkChange")}},model:{value:w.item.isCheck,callback:function(t){w.$set(w.item,"isCheck",t)},expression:"item.isCheck"}}):w._e(),w._v(" "),w.item.sys_tag?C("div",{staticClass:"SysTag",style:{color:w.sysTag[w.item.sys_tag[0]].color,backgroundColor:w.sysTag[w.item.sys_tag[0]].bg}},[w._v("\n      "+w._s(w.$t(w.sysTag[w.item.sys_tag[0]].txt))+"\n    ")]):w._e(),w._v(" "),C("div",{directives:[{name:"show",rawName:"v-show",value:w.item.NSFWSHOW&&[2,"2"].includes(null===(t=w.userInfo)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.nsfw_plus),expression:"item.NSFWSHOW && [2, '2'].includes(userInfo?.settings?.nsfw_plus)"}],staticClass:"NSFWSHOW",style:{opacity:null!==(e=w.item)&&void 0!==e&&e.nsfw_plus?1:0},on:{click:function(t){var e;t.preventDefault(),t.stopPropagation(),w.item.nsfw_plus=!(null!==(e=w.item)&&void 0!==e&&e.nsfw_plus)}}},[C("i",{staticClass:"iconfont",class:null!==(n=w.item)&&void 0!==n&&n.nsfw_plus?"icon-work-show":"icon-work-hide"})]),w._v(" "),1!==w.item.nsfw&&w.isMP4Link(w.item.cover)?C("ImgWaterFall",{class:w.isCheck?"":"cntImg",style:{transform:w.item.isCheck?"scale(0.85)":null,transition:"all 0.3s ease-in-out",filter:w.setNsfwPlus(w.item)?"blur(19px) saturate(160%)":""},attrs:{item:w.item}}):1!=w.item.nsfw?C("video",{ref:"mainVideo",staticClass:"cntVideo",style:{filter:w.setNsfwPlus(w.item)?"blur(19px) saturate(160%)":""},attrs:{src:w.item.cover,autoplay:"",loop:"",muted:"",controls:!1},domProps:{muted:!0}}):w._e(),w._v(" "),C("div",{directives:[{name:"show",rawName:"v-show",value:w.greenMode,expression:"greenMode"}]},[C("div",{directives:[{name:"show",rawName:"v-show",value:w.showGreenCover,expression:"showGreenCover"}],staticClass:"green-mode-div",staticStyle:{"backdrop-filter":"blur(19px) saturate(160%)",position:"absolute",left:"0",top:"0"},style:{width:w.item.waterWidth+"px",height:w.item.waterHeight+"px"}})]),w._v(" "),C("div",{staticClass:"imgNum"},[C("i",{staticClass:"iconfont icon-imgNum"}),w._v(" "),C("span",[w._v(w._s(null===(o=w.item.portfolio)||void 0===o?void 0:o.num))])]),w._v(" "),3==w.item.status||4==w.item.status||2==w.item.status?C("div",{staticClass:"statusCnt"},[C("div",{staticClass:"statusZg"}),w._v(" "),C("div",{staticClass:"statusBox",style:{color:4==w.item.status||2==w.item.status?"#EF3B3B":"#ffffff"}},[C("i",{staticClass:"iconfont icon-statusBox"}),w._v(" "),C("div",[w._v("\n          "+w._s(4==w.item.status?w.$t("notApproved"):2==w.item.status?w.$t("Ban"):w.$t("underReview"))+"\n        ")])])]):w._e(),w._v(" "),w.isPersonal?C("el-popover",{ref:"myPopover",attrs:{placement:"top-end","popper-class":"water-fall-popover","append-to-body":!0,"visible-arrow":!1,width:"100",trigger:"hover"},on:{show:w.handlePopoverShow}},[C("div",{staticClass:"pop-btns flex"},[C("button",{directives:[{name:"show",rawName:"v-show",value:"userPage"==w.fromPage&&w.isMine,expression:"fromPage == 'userPage' && isMine"}],on:{click:function(t){return t.preventDefault(),w.moreActions("pinOrNot")}}},[w._v("\n          "+w._s(w.$t(null!==(r=w.item)&&void 0!==r&&r.isTop?"UnpinOverview":"PinOverview"))+"\n        ")]),w._v(" "),C("button",{on:{click:function(t){return t.preventDefault(),w.moreActions("report")}}},[w._v("\n          "+w._s(w.$t("Report"))+"\n        ")]),w._v(" "),C("button",{directives:[{name:"show",rawName:"v-show",value:3!=w.item.status&&w.isMine,expression:"item.status != 3 && isMine"}],on:{click:function(t){return t.preventDefault(),w.moreActions("delete")}}},[w._v("\n          "+w._s(w.$t("Delete"))+"\n        ")])]),w._v(" "),C("div",{staticClass:"more-btn",attrs:{slot:"reference"},slot:"reference"},[C("i",{staticClass:"iconfont icon-more"})])]):w._e()],1),w._v(" "),C("div",{staticClass:"objName",style:{width:w.item.waterWidth+"px"}},[w._v("\n    "+w._s(null===(l=w.item.portfolio)||void 0===l?void 0:l.name)+"\n  ")]),w._v(" "),C("div",{staticClass:"author",style:{width:w.item.waterWidth+"px"}},[C("div",{staticClass:"userBox",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),w.otherUser(w.item)}}},[null!==(c=w.item.author)&&void 0!==c&&c.head?C("div",{staticClass:"authorHead"},[C("img",{directives:[{name:"webp",rawName:"v-webp",value:w.$imgL,expression:"$imgL"}],attrs:{src:null===(d=w.item.author)||void 0===d?void 0:d.head,alt:""}})]):C("div",{staticClass:"authorHead"},[w._v(w._s(null===(h=w.item.author)||void 0===h?void 0:h.name[0]))]),w._v(" "),C("div",{staticClass:"authorName"},[w._v(w._s(null===(v=w.item.author)||void 0===v?void 0:v.name))])]),w._v(" "),w.cntShow?C("div",{staticClass:"numItem"},[C("div",{staticClass:"funItem",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),w.setLike(w.item,"gallery")}}},[C("i",{staticClass:"iconfont",class:w.setlikeData(w.item)}),w._v(" "),null!==(m=w.item.stat)&&void 0!==m&&m.num_of_like?C("span",[w._v(w._s(w.item.stat.num_of_like))]):w._e()]),w._v(" "),C("div",{staticClass:"funItem",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),w.setCollect(w.item,"gallery")}}},[C("i",{staticClass:"iconfont",class:w.setCollectData(w.item)}),w._v(" "),null!==(f=w.item.stat)&&void 0!==f&&f.num_of_collection?C("span",[w._v(w._s(w.item.stat.num_of_collection))]):w._e()])]):C("div",{staticClass:"numItem"},[C("div",{staticClass:"funItem"},[C("i",{staticClass:"iconfont",class:w.item.liked?"icon-like_selected":"icon-like"}),w._v(" "),null!==(_=w.item.stat)&&void 0!==_&&_.num_of_like?C("span",[w._v(w._s(w.item.stat.num_of_like))]):w._e()]),w._v(" "),C("div",{staticClass:"funItem"},[C("i",{staticClass:"iconfont",class:w.item.collect?"icon-collect_selected":"icon-collect"}),w._v(" "),null!==(y=w.item.stat)&&void 0!==y&&y.num_of_collection?C("span",[w._v(w._s(w.item.stat.num_of_collection))]):w._e()])])]),w._v(" "),C("admin-tag",{attrs:{id:w.item.id,item:w.item,type:"4",review:w.review},on:{change:w.tagChange}})],1)}),[],!1,null,"ab228412",null);e.a=component.exports},551:function(t,e,n){"use strict";n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2);n(10),n(14);function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}n(16),n(47),n(19),n(36),n(18),n(29);var c=n(5),d=n(1),h=n(30),v=n(33),m=n(106),f=n(21),_=n(115),y=n(92),w=n(56);function C(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?C(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var O=!1,x={mixins:[v.a],components:{AdminTag:m.a,listCheckbox:_.a,ImgWaterFall:y.a,CollectPopover:w.a},props:{fromPage:{type:String,default:""},item:{type:Object,default:function(){}},list:{type:Array,default:function(){return[]}},review:{type:Boolean,default:!1},isCheck:{type:Boolean,default:!1},sysTag:{type:Object,default:function(){}}},data:function(){var t;return{isPersonal:null===(t=this.$route.meta)||void 0===t?void 0:t.isPersonal,formatNumberForeign:c.i,timeFormat:c.F,collectDotReportInfo:{},videoBgShow:!0,deleteLoad:!1,cntShow:!0,otherShow:!1,itemShow:!1,itemShowId:""}},computed:k(k(k({},Object(d.c)("user",["isLoggedIn","accountSettingsData"])),Object(d.e)("user",["userInfo","accountData","adminOff"])),{},{isMine:function(){var t,e;return(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)==(null===(e=this.userInfo)||void 0===e?void 0:e.id)},setNsfwPlus:function(){return function(t){var e,n;return!(null==t||!t.nsfw_plus)&&(null===(e=this.userInfo)||void 0===e||!e.enable_nsfw_plus||[2,"2"].includes(null===(n=this.userInfo)||void 0===n||null===(n=n.settings)||void 0===n?void 0:n.nsfw_plus))}},isRotate:function(){var t,e,n;return(null===(t=this.item)||void 0===t?void 0:t.needRotate)&&(null===(e=this.item)||void 0===e?void 0:e.cover_width)<(null===(n=this.item)||void 0===n?void 0:n.cover_height)},finalSize:function(){return this.isRotate?{width:this.item.waterHeight+"px",height:this.item.waterWidth+"px"}:{width:"100%",height:"auto"}}}),mounted:function(){var t=this;setTimeout((function(){t.otherShow=!0}),200)},methods:{moreActions:function(t){var e=this,n=this.item,o=n.id,r=n.obj_type;switch(t){case"report":Object(h.q)({id:o,obj_type:r}).then((function(t){e.$message({message:e.$t("ReportSuccess"),type:"success"})}));break;case"delete":this.$emit("moreActions","delete",this.item);break;case"pinOrNot":this.$emit("moreActions","pinOrNot",this.item)}},handleCollectPopoverClick:function(t){var e=this.list.findIndex((function(i){return i.id===t.id})),n=(e<10?this.list.slice(0,e):this.list.slice(e-10,e)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));this.collectDotReportInfo=k(k({},this.dotReportInfo),{},{negative_ids:n,action:"collection",obj_no:t.id,obj_type:1})},changeItemShow:function(t){this.itemShow=t.show,this.itemShowId=t.id,this.handleCollectPopoverClick(t)},handleClick:function(t){var e;if(this.isLoggedIn){var n,o,r,l,c={},path="";if(1==(null==t||null===(e=t.look_book)||void 0===e?void 0:e.video_type))c={template_id:null===(n=t.look_book)||void 0===n?void 0:n.template_id,url:(null===(o=t.look_book)||void 0===o?void 0:o.template_url)||(null===(r=t.look_book)||void 0===r?void 0:r.url),height:t.cover_width,width:t.cover_height,cover:t.cover},path="ai-face-swap",this.$logEvent("log_actions",{operation:"click_create_same_image",behavior_info:"on_show_me_hover"});else c={template_id:null===(l=t.look_book)||void 0===l?void 0:l.template_id},path="ai-video-generator";c=JSON.stringify(c),this.$router.push(this.localePath("/ai-tools/".concat(path,"?info=").concat(c)))}else this.$EventBus.$emit("openLoginDialog")},onDelete:function(t){var e=this;this.$confirm(this.$t("postDeleteTip"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){e.deleteLoad||(e.deleteLoad=!0,Object(f.Z)({obj_id:t.id,obj_type:t.obj_type}).then((function(n){e.setWaterFallDeleteLits(t.id),e.$emit("resizeListener"),e.$message({type:"success",message:e.$t("deleteSuccess")})})).finally((function(){e.deleteLoad=!1})))})).catch((function(){}))},onPlayFun:function(){this.$refs.myVideo&&(this.$refs.myVideo.play(),this.$refs.myVideo.style.opacity=1,this.$refs.myVideo.paused||(this.videoBgShow=!1)),!O&&this.onPause()},onPlay:function(){O=!0,this.$emit("onPlay",{fun:this.onPlayFun})},onPause:function(){O=!1,this.$refs.myVideo&&(this.$refs.myVideo.pause(),this.$refs.myVideo.currentTime=0,this.$refs.myVideo.style.opacity=0),this.videoBgShow=!0},handleDetail:function(t,e){if(this.$logEvent("log_actions",{operation:"click_post",behavior_info:e.id,behavior_info_sub:"video,"+e.id}),"IMG"===t.target.tagName||"VIDEO"===t.target.tagName||"cltpop"===t.target.className||t.target.className.includes("imgBox")||"ImgWaterFall"===t.target.className||"green-mode-div"===t.target.className||"statusCnt"===t.target.className||3==e.status){if(this.checkGreen(e))return void this.$EventBus.$emit("openLoginDialog",{redirect:"/models/detail/"+e.id});this.$router.push(this.localePath("/video/"+e.id))}},checkGreen:function(t){return!this.isLoggedIn&&!(null==t||!t.green||![2,"2"].includes(t.green))},otherUser:function(t){var path="/user/"+encodeURIComponent(t.author.id);this.userInfo.id==t.author.id&&(path="/personal"),window.open(this.localePath(path),"_blank")},tagChange:function(t){if("REVIEW"===t){var e=this.$route.params;return localStorage.setItem("reviewList",JSON.stringify(this.list)),void this.$router.push(this.localePath("/video/".concat(this.item.id,"?review=1&tag=").concat(null==e?void 0:e.tag)))}this.$emit("change")},handlePopoverShow:function(){var t=this;if("userPage"===this.fromPage){var e=this.item,n=e.id,o=e.obj_type;Object(f.M)({obj_id:n,obj_type:o}).then((function(e){var n,o;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&t.$set(t.item,"isTop",null==e||null===(o=e.data)||void 0===o?void 0:o.is_top)}))}}}},I=(n(2319),n(0)),component=Object(I.a)(x,(function(){var t,e,n,o,r,c,d,h,v,m,f,_,y,w,C,k,O,x,I=this,D=I._self._c;return D("a",{attrs:{href:I.localePath("/video/"+I.item.id),target:"_blank"},on:{click:function(t){t.preventDefault(),!I.isCheck&&I.handleDetail(t,I.item)},mouseover:function(t){I.cntShow=!0}}},[D("div",{staticClass:"defBox marking-item",class:{"bg-nsfw":1===I.item.nsfw,boxItem:!I.setNsfwPlus(I.item)},style:{width:I.item.waterWidth+"px",height:I.item.waterHeight+"px"},on:{mouseenter:function(t){!I.isCheck&&I.onPlay()},mouseleave:function(t){!I.isCheck&&I.onPause()}}},[[1,3].includes(null===(t=I.item)||void 0===t||null===(t=t.look_book)||void 0===t?void 0:t.video_type)?D("div",{staticClass:"waterfall-hover-try",on:{click:function(t){return t.preventDefault(),I.handleClick(I.item)}}},[I._v("\n        "+I._s(I.$t("Remix"))+"\n      ")]):I._e(),I._v(" "),D("div",{directives:[{name:"show",rawName:"v-show",value:I.isLoggedIn,expression:"isLoggedIn"}],staticClass:"cltpop",style:{opacity:I.itemShow&&I.itemShowId==I.item.id?1:0}}),I._v(" "),I.isCheck&&I.item&&I.otherShow?D("listCheckbox",{on:{change:function(t){return I.$emit("checkChange")}},model:{value:I.item.isCheck,callback:function(t){I.$set(I.item,"isCheck",t)},expression:"item.isCheck"}}):I._e(),I._v(" "),I.item.sys_tag&&I.otherShow?D("div",{staticClass:"SysTag",style:{color:I.sysTag[I.item.sys_tag[0]].color,backgroundColor:I.sysTag[I.item.sys_tag[0]].bg}},[I._v("\n        "+I._s(I.$t(I.sysTag[I.item.sys_tag[0]].txt))+"\n      ")]):I._e(),I._v(" "),D("div",{directives:[{name:"show",rawName:"v-show",value:I.item.NSFWSHOW&&[2,"2"].includes(null===(e=I.userInfo)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.nsfw_plus),expression:"item.NSFWSHOW && [2, '2'].includes(userInfo?.settings?.nsfw_plus)"}],staticClass:"NSFWSHOW",style:{right:null!==(n=I.item)&&void 0!==n&&n.nsfw_plus?"10px":"75px",opacity:null!==(o=I.item)&&void 0!==o&&o.nsfw_plus?1:0},on:{click:function(t){var e;t.preventDefault(),t.stopPropagation(),I.item.nsfw_plus=!(null!==(e=I.item)&&void 0!==e&&e.nsfw_plus)}}},[D("i",{staticClass:"iconfont",class:null!==(r=I.item)&&void 0!==r&&r.nsfw_plus?"icon-work-show":"icon-work-hide"})]),I._v(" "),1!==I.item.nsfw?D("ImgWaterFall",{style:{transform:I.item.isCheck?"scale(0.85)":null,transition:"all 0.3s ease-in-out",filter:I.setNsfwPlus(I.item)?"blur(19px) saturate(160%)":""},attrs:{item:I.item}}):I._e(),I._v(" "),[!I.isCheck&&I.otherShow?D("video",{ref:"myVideo",class:{rotate:I.isRotate},style:l({filter:I.setNsfwPlus(I.item)?"blur(19px) saturate(160%)":""},I.finalSize),attrs:{loop:"",muted:"",src:null===(c=I.item.look_book)||void 0===c?void 0:c.url,preload:"none"},domProps:{muted:!0}}):I._e()],I._v(" "),D("div",{directives:[{name:"show",rawName:"v-show",value:2!==(null===(d=I.accountData)||void 0===d||null===(d=d.settings)||void 0===d?void 0:d.green_mode)&&I.otherShow,expression:"accountData?.settings?.green_mode !== 2 && otherShow"}]},[[2,"2"].includes(I.item.green)&&!["/personal"].includes(I.$route.path)?D("div",{staticClass:"green-mode-div",staticStyle:{"backdrop-filter":"blur(19px) saturate(160%)",position:"absolute",left:"0",top:"0"},style:{width:I.item.waterWidth+"px",height:I.item.waterHeight+"px"}}):I._e()]),I._v(" "),D("div",{staticClass:"foot-box"},[D("div",{staticClass:"play-times"},[D("i",{staticClass:"iconfont icon-icon_Views"}),I._v(" "),D("span",{staticClass:"imgBox-num-item-text"},[I._v("\n            "+I._s(I.formatNumberForeign((null===(h=I.item)||void 0===h||null===(h=h.stat)||void 0===h?void 0:h.num_of_view)||0))+"\n          ")])]),I._v(" "),I.videoBgShow&&I.otherShow?D("div",{staticClass:"duration"},[I._v("\n          "+I._s(I.timeFormat(null===(v=I.item.look_book)||void 0===v?void 0:v.duration))+"\n        ")]):I._e()]),I._v(" "),D("admin-tag",{attrs:{id:I.item.id,item:I.item,type:"5",review:I.review},on:{change:I.tagChange}}),I._v(" "),3!=I.item.status&&4!=I.item.status&&2!=I.item.status||!I.otherShow?I._e():D("div",{staticClass:"statusCnt"},[D("div",{staticClass:"statusZg"}),I._v(" "),D("div",{staticClass:"statusBox",style:{color:4==I.item.status||2==I.item.status?"#EF3B3B":"#ffffff"}},[D("i",{staticClass:"iconfont icon-statusBox"}),I._v(" "),D("div",[I._v("\n            "+I._s(4==I.item.status?I.$t("notApproved"):2==I.item.status?I.$t("Ban"):I.$t("underReview"))+"\n          ")])])]),I._v(" "),I.isPersonal?D("el-popover",{ref:"myPopover",attrs:{placement:"top-end","popper-class":"water-fall-popover","append-to-body":!0,"visible-arrow":!1,width:"100",trigger:"hover"},on:{show:I.handlePopoverShow}},[D("div",{staticClass:"pop-btns flex"},[D("button",{directives:[{name:"show",rawName:"v-show",value:"userPage"==I.fromPage&&I.isMine,expression:"fromPage == 'userPage' && isMine"}],on:{click:function(t){return t.preventDefault(),I.moreActions("pinOrNot")}}},[I._v("\n            "+I._s(I.$t(null!==(m=I.item)&&void 0!==m&&m.isTop?"UnpinOverview":"PinOverview"))+"\n          ")]),I._v(" "),D("button",{on:{click:function(t){return t.preventDefault(),I.moreActions("report")}}},[I._v("\n            "+I._s(I.$t("Report"))+"\n          ")]),I._v(" "),D("button",{directives:[{name:"show",rawName:"v-show",value:I.isMine,expression:"isMine"}],on:{click:function(t){return t.preventDefault(),I.moreActions("delete")}}},[I._v("\n            "+I._s(I.$t("Delete"))+"\n          ")])]),I._v(" "),3!=I.item.status?D("div",{staticClass:"more-btn",attrs:{slot:"reference"},slot:"reference"},[D("i",{staticClass:"iconfont icon-more"})]):I._e()]):I._e()],2),I._v(" "),I.otherShow?D("div",{staticClass:"objName"},[I._v("\n      "+I._s(null===(f=I.item.look_book)||void 0===f?void 0:f.name)+"\n    ")]):I._e(),I._v(" "),I.otherShow?D("div",{staticClass:"author"},[D("div",{staticClass:"userBox",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),I.otherUser(I.item)}}},[null!==(_=I.item.author)&&void 0!==_&&_.head?D("div",{staticClass:"authorHead"},[D("img",{directives:[{name:"webp",rawName:"v-webp",value:I.$imgL,expression:"$imgL"}],attrs:{src:null===(y=I.item.author)||void 0===y?void 0:y.head,alt:""}})]):D("div",{staticClass:"authorHead"},[I._v(I._s(null===(w=I.item.author)||void 0===w?void 0:w.name[0]))]),I._v(" "),D("div",{staticClass:"authorName"},[I._v(I._s(null===(C=I.item.author)||void 0===C?void 0:C.name))])]),I._v(" "),I.cntShow?D("div",{staticClass:"numItem"},[D("div",{staticClass:"funItem",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),I.setLike(I.item,"lookbook")}}},[D("i",{staticClass:"iconfont",class:I.setlikeData(I.item)}),I._v(" "),null!==(k=I.item.stat)&&void 0!==k&&k.num_of_like?D("span",[I._v(I._s(I.item.stat.num_of_like))]):I._e()])]):D("div",{staticClass:"numItem"},[D("div",{staticClass:"funItem"},[D("i",{staticClass:"iconfont",class:I.item.liked?"icon-like_selected":"icon-like"}),I._v(" "),null!==(O=I.item.stat)&&void 0!==O&&O.num_of_like?D("span",[I._v(I._s(I.item.stat.num_of_like))]):I._e()]),I._v(" "),D("div",{staticClass:"funItem"},[D("i",{class:I.item.collect?"icon-collect_selected":"icon-icon-collect"}),I._v(" "),null!==(x=I.item.stat)&&void 0!==x&&x.num_of_collection?D("span",[I._v(I._s(I.item.stat.num_of_collection))]):I._e()])])]):I._e()])}),[],!1,null,"645f1ebe",null);e.a=component.exports},552:function(t,e,n){"use strict";n(10),n(14),n(9),n(11),n(12),n(8),n(6);var o=n(2),r=(n(16),n(7),n(47),n(19),n(36),n(4),n(18),n(29),n(30)),l=n(33),c=n(92),d=n(1),h=n(56),v=n(115),m=n(106),f=n(21);function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var w={mixins:[l.a],components:{CollectPopover:h.a,ImgWaterFall:c.a,listCheckbox:v.a,AdminTag:m.a},props:{fromPage:{type:String,default:""},item:{type:Object,default:function(){}},list:{type:Array,default:function(){return[]}},isCheck:{type:Boolean,default:!1}},computed:y(y(y({},Object(d.c)("user",["isLoggedIn"])),Object(d.e)("user",["userInfo","accountData"])),{},{isMine:function(){var t,e;return(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)==(null===(e=this.userInfo)||void 0===e?void 0:e.id)},setNsfwPlus:function(){return function(t){var e,n;return!(null==t||!t.nsfw_plus)&&(null===(e=this.userInfo)||void 0===e||!e.enable_nsfw_plus||[2,"2"].includes(null===(n=this.userInfo)||void 0===n||null===(n=n.settings)||void 0===n?void 0:n.nsfw_plus))}}}),data:function(){var t;return{isPersonal:null===(t=this.$route.meta)||void 0===t?void 0:t.isPersonal,cntShow:!0,otherShow:!1,itemShow:!1,itemShowId:"",collectDotReportInfo:{},from:"waterfall"}},mounted:function(){var t=this;setTimeout((function(){t.otherShow=!0}),200)},methods:{moreActions:function(t){switch(t){case"delete":this.$emit("moreActions","delete",this.item);break;case"pinOrNot":this.$emit("moreActions","pinOrNot",this.item)}},handleReport:function(t){var e=this.list.findIndex((function(i){return i.id===t.id})),n=(e<10?this.list.slice(0,e):this.list.slice(e-10,e)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));Object(r.g)({items:[y(y({},this.dotReportInfo),{},{negative_ids:n,action:"view",obj_no:t.id,obj_type:11})]})},handleMouseUp:function(t,e){2!==t.which&&1!==t.button||this.handleReport(e)},handleDetail:function(t,e){var n,o="string"==typeof t.target.className&&(null===(n=t.target.className)||void 0===n?void 0:n.includes("boxItem"));("IMG"===t.target.tagName||"cltpop"===t.target.className||o||"ImgWaterFall"===t.target.className||"green-mode-div"===t.target.className)&&(this.handleReport(e),this.$router.push(this.localePath("/editBoard/detail/"+e.id)))},handleClick:function(t){var e;this.isLoggedIn?(this.$router.push(this.localePath("/editBoard?remix_id=".concat(t.id,"&publish_type=").concat(null===(e=t.palette)||void 0===e?void 0:e.publish_type))),this.$logEvent("log_actions",{operation:"click_create_same_image",behavior_info:"on_canvas_page"})):this.$EventBus.$emit("openLoginDialog")},otherUser:function(t){var path="/user/"+encodeURIComponent(t.author.id);this.userInfo.id==t.author.id&&(path="/personal"),window.open(this.localePath(path),"_blank")},changeItemShow:function(t){this.itemShow=t.show,this.itemShowId=t.id,this.handleCollectPopoverClick(t)},handleCollectPopoverClick:function(t){var e=this.list.findIndex((function(i){return i.id===t.id})),n=(e<10?this.list.slice(0,e):this.list.slice(e-10,e)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}));this.collectDotReportInfo=y(y({},this.dotReportInfo),{},{negative_ids:n,action:"collection",obj_no:t.id,obj_type:11})},tagChange:function(t){this.$emit("change",t)},handlePopoverShow:function(){var t=this;if("userPage"===this.fromPage){var e=this.item,n=e.id,o=e.obj_type;Object(f.M)({obj_id:n,obj_type:o}).then((function(e){var n,o;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&t.$set(t.item,"isTop",null==e||null===(o=e.data)||void 0===o?void 0:o.is_top)}))}}}},C=(n(2320),n(0)),component=Object(C.a)(w,(function(){var t,e,n,o,r,l,c,d,h,v,m,f,_,y,w,C,k,O=this,x=O._self._c;return x("a",{attrs:{href:O.localePath("/editBoard/detail/"+O.item.id)},on:{click:function(t){t.preventDefault(),!O.isCheck&&O.handleDetail(t,O.item)},mouseup:function(t){return O.handleMouseUp(t,O.item)},mouseover:function(t){O.cntShow=!0}}},[x("div",{ref:"boxItem",staticClass:"defBox",class:{"bg-nsfw":1===O.item.nsfw,boxItem:!O.setNsfwPlus(O.item)}},[O.isCheck&&O.item?x("listCheckbox",{on:{change:function(t){return O.$emit("checkChange")}},model:{value:O.item.isCheck,callback:function(t){O.$set(O.item,"isCheck",t)},expression:"item.isCheck"}}):O._e(),O._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:O.item.NSFWSHOW&&[2,"2"].includes(null===(t=O.userInfo)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.nsfw_plus),expression:"item.NSFWSHOW && [2, '2'].includes(userInfo?.settings?.nsfw_plus)"}],staticClass:"NSFWSHOW",style:{right:null!==(e=O.item)&&void 0!==e&&e.nsfw_plus?"10px":"75px",opacity:null!==(n=O.item)&&void 0!==n&&n.nsfw_plus?1:0},on:{click:function(t){var e;t.preventDefault(),t.stopPropagation(),O.item.nsfw_plus=!(null!==(e=O.item)&&void 0!==e&&e.nsfw_plus)}}},[x("i",{staticClass:"iconfont",class:null!==(o=O.item)&&void 0!==o&&o.nsfw_plus?"icon-work-show":"icon-work-hide"})]),O._v(" "),1!==O.item.nsfw?x("ImgWaterFall",{class:O.isCheck?"":"cntImg",style:{transform:O.item.isCheck?"scale(0.85)":null,transition:"all 0.3s ease-in-out",filter:O.setNsfwPlus(O.item)?"blur(19px) saturate(160%)":""},attrs:{item:O.item}}):O._e(),O._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:2!==(null===(r=O.accountData)||void 0===r||null===(r=r.settings)||void 0===r?void 0:r.green_mode)&&O.otherShow,expression:"accountData?.settings?.green_mode !== 2 && otherShow"}]},[[2,"2"].includes(O.item.green)&&!["/personal"].includes(O.$route.path)?x("div",{staticClass:"green-mode-div",staticStyle:{"backdrop-filter":"blur(19px) saturate(160%)",position:"absolute",left:"0",top:"0"},style:{width:O.item.waterWidth+"px",height:O.item.waterHeight+"px"}}):O._e()]),O._v(" "),2==(null===(l=O.item.palette)||void 0===l?void 0:l.publish_type)?x("div",{staticClass:"paletIcon"},[x("i",{staticClass:"iconfont icon-a-VectorStroke"})]):O._e(),O._v(" "),O.cntShow&&O.otherShow&&!O.isCheck?x("div",[x("div",{staticClass:"waterfall-hover-try",on:{click:function(t){return t.preventDefault(),O.handleClick(O.item)}}},[O._v("\n        "+O._s(O.$t("Remix"))+"\n      ")]),O._v(" "),x("CollectPopover",{directives:[{name:"show",rawName:"v-show",value:O.isLoggedIn,expression:"isLoggedIn"}],staticClass:"CollectPop",style:{opacity:O.itemShow&&O.itemShowId==O.item.id?1:0},attrs:{dotReportInfo:O.collectDotReportInfo,type:"palette",folder:O.item,from:"waterfall"},on:{showChaneg:O.changeItemShow}}),O._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:O.isLoggedIn,expression:"isLoggedIn"}],staticClass:"cltpop",style:{opacity:O.itemShow&&O.itemShowId==O.item.id?1:0}}),O._v(" "),O.isPersonal?x("el-popover",{ref:"myPopover",attrs:{placement:"top-end","popper-class":"water-fall-popover","append-to-body":!0,"visible-arrow":!1,width:"100",trigger:"hover"},on:{show:O.handlePopoverShow}},[x("div",{staticClass:"pop-btns flex"},[x("button",{directives:[{name:"show",rawName:"v-show",value:"userPage"==O.fromPage&&O.isMine,expression:"fromPage == 'userPage' && isMine"}],on:{click:function(t){return t.preventDefault(),O.moreActions("pinOrNot")}}},[O._v("\n            "+O._s(O.$t(null!==(c=O.item)&&void 0!==c&&c.isTop?"UnpinOverview":"PinOverview"))+"\n          ")]),O._v(" "),x("button",{directives:[{name:"show",rawName:"v-show",value:3!=O.item.status&&O.isMine,expression:"item.status != 3 && isMine"}],on:{click:function(t){return t.preventDefault(),O.moreActions("delete")}}},[O._v("\n            "+O._s(O.$t("Delete"))+"\n          ")])]),O._v(" "),x("div",{staticClass:"more-btn",attrs:{slot:"reference"},slot:"reference"},[x("i",{staticClass:"iconfont icon-more"})])]):O._e()],1):O._e()],1),O._v(" "),O.otherShow?x("div",{staticClass:"objName",style:{width:O.item.waterWidth+"px"}},[O._v("\n    "+O._s(null===(d=O.item.palette)||void 0===d?void 0:d.title)+"\n  ")]):O._e(),O._v(" "),O.otherShow?x("div",{staticClass:"author",style:{width:O.item.waterWidth+"px",marginTop:"8px"}},[x("div",{staticClass:"userBox",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),O.otherUser(O.item)}}},[null!==(h=O.item.author)&&void 0!==h&&h.head?x("div",{staticClass:"authorHead"},[x("img",{directives:[{name:"webp",rawName:"v-webp",value:O.$imgL,expression:"$imgL"}],attrs:{src:null===(v=O.item.author)||void 0===v?void 0:v.head,alt:null===(m=O.item.author)||void 0===m||null===(m=m.head)||void 0===m?void 0:m.name}})]):x("div",{staticClass:"authorHead"},[O._v(O._s(null===(f=O.item.author)||void 0===f?void 0:f.name[0]))]),O._v(" "),x("div",{staticClass:"authorName"},[O._v(O._s(null===(_=O.item.author)||void 0===_?void 0:_.name))])]),O._v(" "),O.cntShow?x("div",{staticClass:"numItem"},[x("div",{staticClass:"funItem",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),O.setLike(O.item,"palette","waterfall")}}},[x("i",{staticClass:"iconfont",class:O.setlikeData(O.item)}),O._v(" "),null!==(y=O.item.stat)&&void 0!==y&&y.num_of_like?x("span",[O._v(O._s(O.item.stat.num_of_like))]):O._e()]),O._v(" "),x("div",{staticClass:"funItem",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),O.setCollect(O.item,"palette")}}},[x("i",{staticClass:"iconfont",class:O.setCollectData(O.item)}),O._v(" "),null!==(w=O.item.stat)&&void 0!==w&&w.num_of_collection?x("span",[O._v(O._s(O.item.stat.num_of_collection))]):O._e()])]):x("div",{staticClass:"numItem"},[x("div",{staticClass:"funItem"},[x("i",{staticClass:"iconfont",class:O.item.liked?"icon-like_selected":"icon-like"}),O._v(" "),null!==(C=O.item.stat)&&void 0!==C&&C.num_of_like?x("span",[O._v(O._s(O.item.stat.num_of_like))]):O._e()]),O._v(" "),x("div",{staticClass:"funItem"},[x("i",{staticClass:"iconfont",class:O.item.collect?"icon-collect_selected":"icon-collect"}),O._v(" "),null!==(k=O.item.stat)&&void 0!==k&&k.num_of_collection?x("span",[O._v(O._s(O.item.stat.num_of_collection))]):O._e()])]),O._v(" "),x("admin-tag",{attrs:{id:O.item.id,type:"11",item:O.item},on:{change:O.tagChange}})],1):O._e()])}),[],!1,null,"beef9a18",null);e.a=component.exports},553:function(t,e,n){"use strict";n(10),n(14),n(9),n(85),n(101),n(75),n(36),n(11),n(12),n(8),n(23),n(49),n(50),n(6),n(48);var o=n(15),r=n(2),l=(n(16),n(7),n(19),n(4),n(150)),c=n(92),d=n(115),h=n(5),v=n(186),m=n(33),f=n(1),_=n(13),y=n(21),w=n(30);function C(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,a){if(t){if("string"==typeof t)return k(t,a);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?k(t,a):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw l}}}}function k(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,n=Array(a);e<a;e++)n[e]=t[e];return n}function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?O(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var I={components:{ImgWaterFall:c.a,AiChatReport:v.a,AudioPlayer:l.a,listCheckbox:d.a},mixins:[m.a],props:{isCheck:{type:Boolean,default:!1},fromPage:{type:String,default:""},item:{type:Object,default:function(){}},outerClass:{type:String,default:"recList"}},data:function(){return{formatNumberForeign:h.i}},watch:{$route:{handler:function(){var t;null===(t=this.$refs)||void 0===t||null===(t=t.myPopover)||void 0===t||t.doClose()}}},computed:x(x(x(x({},Object(f.e)("user",["token"])),Object(f.c)("user",["isLoggedIn"])),Object(f.e)("user",["userInfo"])),{},{isMine:function(){var t,e;return(null===(t=this.item)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)==(null===(e=this.userInfo)||void 0===e?void 0:e.id)},selfTag:function(){var t,e,n=(null===(t=this.item)||void 0===t?void 0:t.timbre)||null,o=[];return null!=n&&null!==(e=n.tags)&&void 0!==e&&e.length&&(o=null==n?void 0:n.tags.map((function(t){return t.title}))),o},attrTags:function(){var t,e=(null===(t=this.item)||void 0===t?void 0:t.timbre)||null,n=[];if(e){var o=[],r=[],l=[];if(e.gender){var c=_.z.filter((function(t){return t.value===e.gender}))||[];c.length&&r.push(c[0].i18Key)}if(e.age){var d=_.z.filter((function(t){return t.value===e.age}))||[];d.length&&o.push(d[0].i18Key)}if(null!=e&&e.tones&&null!=e&&e.tones.length){var h,v=C(null==e?void 0:e.tones);try{for(v.s();!(h=v.n()).done;){var m,f=h.value,y=C(_.z);try{for(y.s();!(m=y.n()).done;){var w=m.value;w.value===f&&l.push(w.i18Key)}}catch(t){y.e(t)}finally{y.f()}}}catch(t){v.e(t)}finally{v.f()}}return n=[].concat(o,r,l)}return n},getImageUrl:function(){return function(t){var e="";return t.cover&&!["",null,void 0].includes(t.cover)?e=Object(h.x)(t.cover,this.$imgL):e}},renderMoreActions:function(){var t=[{label:"Share",type:"share"}];if(this.isMine){var e,n=[{label:null!==(e=this.item)&&void 0!==e&&e.isTop?"UnpinOverview":"PinOverview",type:"pinOrNot"},{label:"Edit",type:"edit"},{label:"Delete",type:"delete"}];t=[].concat(n,Object(o.a)(t))}return t}}),methods:{handleToCreate:function(){var t,e=this.localePath("/ai-audio/create/".concat(null===(t=this.item)||void 0===t?void 0:t.id));this.$router.push(e)},handleClickSame:function(t){var e=this.localePath("/ai-audio/create/".concat(null==t?void 0:t.id));this.$router.push(e)},goDetail:function(){var t;this.isCheck||this.$router.push(this.localePath("/ai-audio/detail/".concat(null===(t=this.item)||void 0===t?void 0:t.id)))},handleActions:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.item.obj_type;switch(t){case"pinOrNot":this.$emit("moreActions","pinOrNot",this.item);break;case"delete":this.$emit("moreActions","delete",this.item);break;case"report":try{this.$logEvent("log_actions",{operation:"tavern_on_square",behavior_info:"click_report"}),this.$refs.AiChatReport.open()}catch(t){}break;case"share":this.$logEvent("log_actions",{operation:"click_share",behavior_info:"on_personal_center",behavior_info_sub:e}),this.handleShare();break;case"edit":this.$logEvent("log_actions",{operation:"click_edit",behavior_info:"on_personal_center",behavior_info_sub:e}),this.handleEdit();break;case"download":this.handleDownload()}},handleShare:function(){Object(w.g)({items:[{action:"share",obj_no:this.item.id,obj_type:16}]});var t=location.host+this.localePath("/ai-audio/detail/".concat(this.item.id,"/share"));Object(h.d)(t),this.$message.success(this.$t("CopiedURLToClipboard"))},handleDownload:function(){var t,e=this;if(this.isLoggedIn){var n=(null===(t=this.item)||void 0===t?void 0:t.url)||"";Object(h.y)({url:n,scene:3,fileName:"AI_Audio_".concat(formatTime_yyyymmdd_hhmm(),".mp3")})}else this.$EventBus.$emit("openLoginDialog",{callBack:function(){e.handleDownload()}})},handleEdit:function(){var t;this.$router.push(this.localePath("/ai-audio/train/"+(null===(t=this.item)||void 0===t?void 0:t.id)))},otherUser:function(t){this.$logEvent("log_actions",{operation:"click_author_image",behavior_info:"on_ai_audio_waterfall_flow",behavior_info_sub:t.id});var path="/user/"+encodeURIComponent(t.author.id);this.userInfo.id==t.author.id&&(path="/personal"),window.open(this.localePath(path),"_blank")},handlePopoverShow:function(){var t=this;if("userPage"===this.fromPage){var e=this.item,n=e.id,o=e.obj_type;Object(y.M)({obj_id:n,obj_type:o}).then((function(e){var n,o;1e4===(null==e||null===(n=e.status)||void 0===n?void 0:n.code)&&t.$set(t.item,"isTop",null==e||null===(o=e.data)||void 0===o?void 0:o.is_top)}))}}},mounted:function(){}},D=I,S=(n(2327),n(0)),component=Object(S.a)(D,(function(){var t,e,n,o,r,l,c,d,h,v,m,f,_,y,w=this,C=w._self._c;return C("a",{attrs:{href:w.localePath("/ai-audio/detail/".concat(null===(t=w.item)||void 0===t?void 0:t.id))},on:{click:function(t){return t.preventDefault(),w.goDetail.apply(null,arguments)}}},[C("div",{staticClass:"ai-audio-item",style:{width:w.item.waterWidth+"px",height:w.item.waterHeight+"px"}},[w.isCheck&&w.item?C("listCheckbox",{on:{change:function(t){return w.$emit("checkChange")}},model:{value:w.item.isCheck,callback:function(t){w.$set(w.item,"isCheck",t)},expression:"item.isCheck"}}):w._e(),w._v(" "),C("div",{staticClass:"ai-audio-item-top"},[C("el-popover",{ref:"myPopover",attrs:{placement:"bottom-end","popper-class":"water-fall-popover-audio","append-to-body":!1,"visible-arrow":!1,"popper-options":{boundariesElement:"body"},width:"100",trigger:"click"},on:{show:w.handlePopoverShow}},[C("div",{staticClass:"pop-btns flex"},w._l(w.renderMoreActions,(function(t){return C("button",{key:t.type,on:{click:function(e){return e.preventDefault(),e.stopPropagation(),w.handleActions(t.type)}}},[C("span",{staticClass:"pop-btns-text"},[w._v(w._s(w.$t(t.label)))])])})),0),w._v(" "),C("div",{staticClass:"login-waterFall-btn-icon",attrs:{slot:"reference"},on:{click:function(t){t.preventDefault(),t.stopPropagation()}},slot:"reference"},[C("i",{staticClass:"iconfont icon-more"})])]),w._v(" "),C("div",{staticClass:"imgBox"},[["",null,void 0].includes(null===(e=w.item)||void 0===e?void 0:e.cover)?C("div",{staticClass:"avatar-img"},[C("div",{staticClass:"image-empty"},[w._v(w._s(w.$t("EmptyBannerText")))])]):C("el-image",{staticClass:"avatar-img",attrs:{fit:"contain",src:w.getImageUrl(w.item),alt:null===(n=w.item.timbre)||void 0===n?void 0:n.name}},[C("template",{slot:"error"},[C("img",{directives:[{name:"webp",rawName:"v-webp",value:w.$imgL,expression:"$imgL"}],staticClass:"avatar-img",attrs:{src:w.item.cover,alt:null===(o=w.item.timbre)||void 0===o?void 0:o.name}})])],2),w._v(" "),C("AudioPlayer",{attrs:{modelPlay:"",item:w.item.timbre,needBorder:"",logParams:{operation:"click_broadcast",behavior_info:"on_ai_audio_waterfall_flow",behavior_info_sub:null===(r=w.item)||void 0===r?void 0:r.id}}})],1),w._v(" "),C("div",{staticClass:"ai-audio-name",attrs:{title:null===(l=w.item.timbre)||void 0===l?void 0:l.name}},[w._v("\n        "+w._s(null===(c=w.item.timbre)||void 0===c?void 0:c.name)+"\n      ")]),w._v(" "),C("div",{staticClass:"item-content-tags"},[w.attrTags.length?w._l(w.attrTags,(function(t,e){return C("span",{key:t+e,staticClass:"item-content-tags-item"},[w._v("\n            "+w._s(w.$t(t))+"\n          ")])})):w._e(),w._v(" "),w.selfTag.length?w._l(w.selfTag,(function(t,e){return C("span",{key:t+e,staticClass:"item-content-tags-item"},[w._v("\n            "+w._s(t)+"\n          ")])})):w._e(),w._v(" "),C("div",{staticClass:"waterfall-hover-try",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),w.handleClickSame(w.item)}}},[w._v("\n          "+w._s(w.$t("Generate"))+"\n        ")])],2)],1),w._v(" "),C("div",{staticClass:"ai-audio-item-bottom",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[C("div",{staticClass:"author-box",on:{click:function(t){return w.otherUser(w.item)}}},[null!==(d=w.item.author)&&void 0!==d&&d.head?C("div",{staticClass:"authorHead"},[C("img",{directives:[{name:"webp",rawName:"v-webp",value:w.$imgL,expression:"$imgL"}],attrs:{src:null===(h=w.item.author)||void 0===h?void 0:h.head,alt:null===(v=w.item.author)||void 0===v?void 0:v.name}})]):C("div",{staticClass:"authorHead"},[w._v("\n          "+w._s(null===(m=w.item.author)||void 0===m?void 0:m.name[0])+"\n        ")]),w._v(" "),C("div",{staticClass:"authorName"},[C("span",[w._v(w._s(null===(f=w.item.author)||void 0===f?void 0:f.name))])])]),w._v(" "),C("div",{staticClass:"imgBox-num"},[C("div",{staticClass:"imgBox-num-item",on:{click:w.handleToCreate}},[C("i",{staticClass:"iconfont icon-play imgBox-num-item-icon"}),w._v(" "),C("span",{staticClass:"imgBox-num-item-text"},[w._v("\n            "+w._s(w.formatNumberForeign((null===(_=w.item)||void 0===_||null===(_=_.stat)||void 0===_?void 0:_.num_of_task)||0))+"\n          ")])]),w._v(" "),C("div",{staticClass:"imgBox-num-item imgBox-num-item-collect",on:{click:function(t){return w.setCollect(w.item,"ai_audio")}}},[C("div",{staticClass:"imgBox-num-item-icon"},[C("i",{staticClass:"iconfont",class:w.setCollectData(w.item)})]),w._v(" "),C("span",{staticClass:"imgBox-num-item-text"},[w._v("\n            "+w._s(w.formatNumberForeign((null===(y=w.item)||void 0===y||null===(y=y.stat)||void 0===y?void 0:y.num_of_collection)||0))+"\n          ")])])])])],1),w._v(" "),C("ai-chat-report",{ref:"AiChatReport",attrs:{"ai-chat-id":w.item.id}})],1)}),[],!1,null,"6a9a555e",null);e.a=component.exports},555:function(t,e,n){"use strict";n(28),n(8);var o=n(40),r={name:"ClaimDialog",props:{type:{type:[String,Number],default:""}},data:function(){return{dialogVisible:!1,wrote:!1,btnLoading:!1,formData:{userName:"",userID:"",userAccount:"",contractMethod:"",contractInfo:""},rules:{userName:[{required:!0,message:this.$t("plsEnterUserName"),trigger:"blur"}],userID:[{required:!0,message:this.$t("plsEnterUserID"),trigger:"blur"}],userAccount:[{required:!0,message:this.$t("plsEnterUserAccount"),trigger:"blur"}],contractMethod:[{required:!0,message:this.$t("plsSelectContractMethod"),trigger:"change"}],contractInfo:[{required:!0,message:this.$t("plsEnterContractInfo"),trigger:"blur"}]}}},mounted:function(){},computed:{},methods:{showDialog:function(){this.dialogVisible=!0,this.getClaimAwardInfo()},closed:function(){this.dialogVisible=!1,this.wrote=!1,this.btnLoading=!1,this.formData={userName:"",userID:"",userAccount:"",contractMethod:"",contractInfo:""}},getClaimAwardInfo:function(){var t=this;Object(o.getClaimAwardInfo)({rank_type:this.type}).then((function(e){var n,o=null==e||null===(n=e.data)||void 0===n?void 0:n.content;o&&(t.wrote=!0,t.formData=JSON.parse(o))}))},handleSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(!e)return console.log("error submit!!"),!1;t.btnLoading=!0,Object(o.claimAwardSubmit)({rank_type:t.type,content:JSON.stringify(t.formData)}).then((function(e){t.$message.success(t.$t("SubmitSuccess")),t.btnLoading=!1,t.dialogVisible=!1})).catch((function(e){console.log("err",e),t.btnLoading=!1,t.dialogVisible=!1}))}))}}},l=(n(2378),n(0)),component=Object(l.a)(r,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"claim-award",attrs:{visible:t.dialogVisible,width:"858px","modal-append-to-body":!0,"append-to-body":!0,"close-on-click-modal":!1,"custom-class":"SaDialog"},on:{"update:visible":function(e){t.dialogVisible=e},closed:t.closed}},[e("div",{staticClass:"sub-title"},[t._v(t._s(t.$t("ClaimOfAward")))]),t._v(" "),e("el-form",{ref:"form",attrs:{model:t.formData,"status-icon":"",rules:t.rules}},[e("el-form-item",{attrs:{prop:"userName",required:""}},[e("div",{staticClass:"label"},[e("span",{staticClass:"star"},[t._v("*")]),t._v(" "),e("span",{staticClass:"number"},[t._v("1.")]),t._v(" "),e("span",{staticClass:"words"},[t._v(t._s(t.$t("ClaimDialogUserName")))])]),t._v(" "),e("el-input",{attrs:{disabled:t.wrote},model:{value:t.formData.userName,callback:function(e){t.$set(t.formData,"userName",e)},expression:"formData.userName"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"userID",required:""}},[e("div",{staticClass:"label"},[e("span",{staticClass:"star"},[t._v("*")]),t._v(" "),e("span",{staticClass:"number"},[t._v("2.")]),t._v(" "),e("span",{staticClass:"words"},[t._v(t._s(t.$t("ClaimDialogUserID")))])]),t._v(" "),e("el-input",{attrs:{disabled:t.wrote},model:{value:t.formData.userID,callback:function(e){t.$set(t.formData,"userID",e)},expression:"formData.userID"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"userAccount",required:""}},[e("div",{staticClass:"label"},[e("span",{staticClass:"star"},[t._v("*")]),t._v(" "),e("span",{staticClass:"number"},[t._v("3.")]),t._v(" "),e("span",{staticClass:"words"},[t._v(t._s(t.$t("ClaimDialogAccount")))])]),t._v(" "),e("div",{staticClass:"sub-label"},[t._v(t._s(t.$t("ClaimDialogSubLabelOne")))]),t._v(" "),e("el-input",{attrs:{disabled:t.wrote},model:{value:t.formData.userAccount,callback:function(e){t.$set(t.formData,"userAccount",e)},expression:"formData.userAccount"}})],1),t._v(" "),e("el-form-item",{staticClass:"contract-type",attrs:{prop:"contractMethod",required:""}},[e("div",{staticClass:"label"},[e("span",{staticClass:"star"},[t._v("*")]),t._v(" "),e("span",{staticClass:"number"},[t._v("4.")]),t._v(" "),e("span",{staticClass:"words"},[t._v(t._s(t.$t("ClaimDialogContractMethod")))])]),t._v(" "),e("div",{staticClass:"sub-label"},[t._v(t._s(t.$t("ClaimDialogSubLabelTwo")))]),t._v(" "),e("el-select",{attrs:{"popper-class":"custom-select",disabled:t.wrote,placeholder:t.$t("plsSelectContractMethodPlaceholder")},model:{value:t.formData.contractMethod,callback:function(e){t.$set(t.formData,"contractMethod",e)},expression:"formData.contractMethod"}},[e("el-option",{attrs:{label:t.$t("wechat"),value:"wechat"}}),t._v(" "),e("el-option",{attrs:{label:"Discord ID",value:"discord_id"}}),t._v(" "),e("el-option",{attrs:{label:t.$t("Email"),value:"email"}})],1)],1),t._v(" "),e("el-form-item",{staticClass:"contract-info",attrs:{prop:"contractInfo",required:""}},[e("el-input",{attrs:{disabled:t.wrote},model:{value:t.formData.contractInfo,callback:function(e){t.$set(t.formData,"contractInfo",e)},expression:"formData.contractInfo"}})],1)],1),t._v(" "),e("el-button",{staticClass:"submit",attrs:{loading:t.btnLoading,disabled:t.wrote},on:{click:t.handleSubmit}},[t._v("\n\t\t\t"+t._s(t.$t("Submit"))+"\n\t\t")])],1)}),[],!1,null,null,null);e.a=component.exports},556:function(t,e,n){"use strict";n(14),n(9),n(7),n(11),n(12),n(8),n(4),n(6);var o=n(2),r=n(1);function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d={name:"PersonInfo",props:["authorInfo","fontStyle","headStyle"],components:{},computed:c(c(c({},Object(r.e)("user",["userInfo","token"])),Object(r.c)("user",["isLoggedIn","isCompanyAccount"])),{},{headBg:function(){var t;return c(c({},this.headStyle),{},{"background-color":null!==(t=this.authorInfo)&&void 0!==t&&t.head?"transparent":"#ADB8CD"})},authorName:function(){var t,e,n=(null===(t=this.authorInfo)||void 0===t?void 0:t.name)||(null===(e=this.authorInfo)||void 0===e?void 0:e.id);return n?n[0].toUpperCase():"-"}}),data:function(){return{}},mounted:function(){},methods:{getPersonalInfoUrl:function(){var t,e,n=(null===(t=this.authorInfo)||void 0===t?void 0:t.id)||"",o=(null===(e=this.userInfo)||void 0===e?void 0:e.id)||"",path="/user/"+encodeURIComponent(n);return o==n&&(path="/personal"),path},jumpToOtherUser:function(){var path=this.getPersonalInfoUrl();this.$router.push(this.localePath(path))}}},h=(n(2536),n(0)),component=Object(h.a)(d,(function(){var t,e,n=this,o=n._self._c;return o("div",{staticClass:"person-info flex items-center"},[o("div",{staticClass:"head",style:n.headBg,on:{click:function(t){return t.stopPropagation(),n.jumpToOtherUser.apply(null,arguments)}}},[null!==(t=n.authorInfo)&&void 0!==t&&t.head?o("img",{directives:[{name:"webp",rawName:"v-webp",value:n.$imgL,expression:"$imgL"}],staticClass:"avatar",attrs:{src:null===(e=n.authorInfo)||void 0===e?void 0:e.head,width:"40",height:"40",loading:"lazy",alt:"avatar"}}):o("div",{staticClass:"letter"},[n._v("\n      "+n._s(n.authorName)+"\n    ")])]),n._v(" "),o("div",{staticClass:"name flex flex-col",on:{click:function(t){return t.stopPropagation(),n.jumpToOtherUser.apply(null,arguments)}}},[o("a",{staticClass:"personal-info-a",style:n.fontStyle,attrs:{href:n.getPersonalInfoUrl(),rel:"nofollow"},on:{click:function(t){t.preventDefault()}}},[n._v("\n      "+n._s(n.authorInfo.name||n.authorInfo.id)+"\n    ")])])])}),[],!1,null,"752c5a36",null);e.a=component.exports},975:function(t,e,n){t.exports={}},976:function(t,e,n){t.exports={}},977:function(t,e,n){t.exports={}},978:function(t,e,n){t.exports={}},979:function(t,e,n){t.exports={}},980:function(t,e,n){t.exports={}},981:function(t,e,n){t.exports={}},983:function(t,e,n){t.exports={}},984:function(t,e,n){t.exports={}},985:function(t,e,n){t.exports={}},986:function(t,e,n){t.exports={}},987:function(t,e,n){t.exports={}},988:function(t,e,n){t.exports={}},989:function(t,e,n){t.exports={}},990:function(t,e,n){t.exports={}},991:function(t,e,n){t.exports={}},992:function(t,e,n){t.exports={}},994:function(t,e,n){t.exports={}},995:function(t,e,n){t.exports={}}}]);