(window.webpackJsonp=window.webpackJsonp||[]).push([[41,17,75,112,132,141],{132:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return l})),n.d(e,"g",(function(){return c})),n.d(e,"h",(function(){return h})),n.d(e,"i",(function(){return d})),n.d(e,"k",(function(){return f})),n.d(e,"j",(function(){return m})),n.d(e,"d",(function(){return v})),n.d(e,"l",(function(){return y})),n.d(e,"c",(function(){return T})),n.d(e,"f",(function(){return E})),n.d(e,"e",(function(){return k}));var r=n(17);function o(data){return Object(r.a)({url:"/api/v1/train-model/data-set/config",method:"POST",data:data})}function l(data){return Object(r.a)({url:"/api/v1/task/v2/train-model/tags",method:"POST",data:data})}function c(data){return Object(r.a)({url:"/api/v1/train-model/detail",method:"POST",data:data})}function h(data){return Object(r.a)({url:"/api/v1/train-model/history",method:"POST",data:data})}function d(data){return Object(r.a)({url:"/api/v1/train-model/result/detail",method:"POST",data:data})}function f(data){return Object(r.a)({url:"/api/v1/train-model/stop",method:"POST",data:data})}function m(data){return Object(r.a)({url:"/api/v1/train-model/save",method:"POST",data:data})}function v(data){return Object(r.a)({url:"/api/v1/model/train/publish",method:"POST",data:data})}function y(data){return Object(r.a)({url:"/api/v1/train-model/square/detail",method:"POST",data:data})}function T(data){return Object(r.a)({url:"/api/v1/model/lora/template",method:"POST",data:data})}function E(data){return Object(r.a)({url:"/api/v1/train-model/square/create",method:"POST",data:data})}function k(data){return Object(r.a)({url:"/api/v1/train-model/result/download",method:"POST",data:data})}},1929:function(t,e,n){"use strict";n.d(e,"a",(function(){return v}));n(3463);var r=n(233),o=n(234),l=n(3502),c=n(3493),h=n(3503),d=n(3518);function f(t,e,n){return e=Object(c.a)(e),Object(l.a)(t,m()?Reflect.construct(e,n||[],Object(c.a)(t).constructor):e.apply(t,n))}function m(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(m=function(){return!!t})()}var v=function(t){function e(t){var n;return Object(r.a)(this,e),(n=f(this,e,[t])).hlsplayer={},n.HlsModule={},n}return Object(h.a)(e,t),Object(o.a)(e,[{key:"afterPlayerInit",value:function(){var t=this,e=this.player;if("m3u8"===e.config.url.split(".").pop()){var n=new d.a({media:e.media});if(e.config.url)try{n.loadSource(e.config.url||""),n.attachMedia(e.media),n.on(d.a.Events.MANIFEST_PARSED,(function(){t.hlsplayer=n,t.HlsModule=d.a,n.currentLevel=0,e.emit("loadeddata",{hlsEnd:!0})}))}catch(t){}}}},{key:"afterCreate",value:function(){}},{key:"destroy",value:function(){}}],[{key:"pluginName",get:function(){return"HlsPlayerPlugin"}},{key:"defaultConfig",get:function(){return{text:"这是插件demoBasePlugin的默认Text"}}}])}(n(3437).a)},1930:function(t,e,n){"use strict";n.d(e,"a",(function(){return S}));n(9),n(7),n(11),n(12),n(8),n(3463);var r=n(2),o=n(233),l=n(234),c=n(3502),h=n(3493),d=n(3503),f=(n(16),n(32),n(19),n(28),n(4),n(6),n(29),n(3369)),m=(n(3519),n(24));function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function T(t,e,n){return e=Object(h.a)(e),Object(c.a)(t,E()?Reflect.construct(e,n||[],Object(h.a)(t).constructor):e.apply(t,n))}function E(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(E=function(){return!!t})()}var k=f.b.POSITIONS,S=function(t){function e(t){var n;return Object(o.a)(this,e),(n=T(this,e,[t])).definitionList=[],n.videoType="other",n.pluginPlan=null,n.theTrackLevel=1,n.debounceDefinition=Object(m.debounce)(n.getCurrentDefinition,200),n}return Object(d.a)(e,t),Object(l.a)(e,[{key:"beforePlayerInit",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"changeTrackItem",value:function(t){var e=this,n=t.level,r=Number(n),o=this.definitionList.find((function(t){return t.level===r}))||this.definitionList[0],param={action:"change_definition",currentTime:this.player.currentTime,to:{definition:r}};if(this.player.emit("user_action",param),localStorage.setItem("definitionLevel",n),this.definitionList.forEach((function(t){t.active=t.level===r})),"mpd"===this.videoType&&(this.pluginPlan.shakaplayer.selectVariantTrack(o,!1),this.waitForEnoughBuffer().then((function(){e.pluginPlan.shakaplayer.selectVariantTrack(o,!0),e.getCurrentDefinition()}))),"m3u8"===this.videoType){var l=this.pluginPlan.hlsplayer,c=this.pluginPlan.HlsModule;l.nextLevel=r<=0?0:r-1,l.on(c.Events.LEVEL_SWITCHED,(function(t,data){e.debounceDefinition()}))}"other"===this.videoType&&(this.player.plugins.definition.changeDefinition({definition:o.definition,url:o.url}),this.getCurrentDefinition()),this.theTrackLevel=o.level}},{key:"afterCreate",value:function(){var t=this;this.onClick=function(e){var n=e.target.dataset.level;t.changeTrackItem({level:n})},this.bind(".list-box .item","click",this.onClick)}},{key:"waitForEnoughBuffer",value:function(){var t=this;return new Promise((function(e){var n=t.pluginPlan.shakaplayer;!function r(){n.getBufferedInfo().total[0].end-t.player.currentTime>5?e(!0):setTimeout(r,500)}()}))}},{key:"destroy",value:function(){this.unbind("click",this.onClick)}},{key:"changeDefinitionList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[];"mpd"===t.type&&(e=t.plugin.shakaplayer.getVariantTracks()),"m3u8"===t.type&&(e=t.plugin.hlsplayer.levels),"other"===t.type&&(e=t.list);var n=e.map((function(e,n){return y(y({},e),{},{level:"other"!==t.type?n+1:e.level,active:"other"===t.type&&e.active})}));"other"!==t.type&&(n[0].active=!0),this.definitionList=n||[],this.videoType=t.type,this.pluginPlan=t.plugin,this.getCurrentDefinition()}},{key:"getCurrentDefinition",value:function(){var t="";if(this.definitionList&&this.definitionList.forEach((function(e){t+='<div class="item '.concat(e.active&&"act",'" data-level=').concat(e.level,">").concat(e.height,"p</div>")})),this.root.querySelector(".list-box").innerHTML=t,this.definitionList.length){var e=this.definitionList.find((function(t){return t.active}));this.root.querySelector(".cell-name").style.display="block",this.root.querySelector(".cell-name").innerHTML="".concat(e.height,"p")}else this.root.querySelector(".cell-name").style.display="none"}},{key:"render",value:function(){return'\n    <div class="definition-plugin-box">\n      <div class="cell-name"></div>\n      <div class="list-box"></div>\n    </div>\n    '}}],[{key:"pluginName",get:function(){return"UseDefinitionPlugin"}},{key:"defaultConfig",get:function(){return{position:k.CONTROLS_RIGHT,index:2}}}])}(f.b)},1932:function(t,e,n){"use strict";n.d(e,"a",(function(){return y}));n(165),n(4),n(23),n(6);var r=n(69);n(3567),n(3568),n(28),n(3569),n(3570),n(3463);function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,p){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,p)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=l(t);if(e){var c=l(this).constructor;n=Reflect.construct(o,arguments,c)}else n=o.apply(this,arguments);return function(t,e){if(e&&("object"===Object(r.a)(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}(this,n)}}function f(t){var e=function(input,t){if("object"!==Object(r.a)(input)||null===input)return input;var e=input[Symbol.toPrimitive];if(void 0!==e){var n=e.call(input,t||"default");if("object"!==Object(r.a)(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(input)}(t,"string");return"symbol"===Object(r.a)(e)?e:String(e)}var m=n(222),v=n(3421),y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(y,t);var e,n,r,l=d(y);function y(t){var e,n,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,y),e=l.call(this,t),n=h(e),o=function(){e.shakaplayer.getVariantTracks().forEach((function(track){if(track.active)for(var i=0;i<this.content.length;++i){var option=this.content[i];option.value===track.id?option.selected=!0:option.selected=!1}}))},(r=f(r="onAdaptation_"))in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,shaka.polyfill.installAll(),e}return e=y,r=[{key:"pluginName",get:function(){return"ShakaPlugin"}},{key:"defaultConfig",get:function(){return{shakaOpts:{streaming:{rebufferingGoal:.5,bufferingGoal:10,bufferBehind:30,autoLowLatencyMode:!0},abr:{rebufferToAverage:1,enabled:!1},manifest:{dash:{maxSegmentDownloads:1}}}}}},{key:"isSupported",value:function(){return shaka.Player.isBrowserSupported()}}],(n=[{key:"afterCreate",value:function(){var t=this;this.content=[],this.url=this.player.config.url,shaka.Player.isBrowserSupported()&&this.on(m.a.URL_CHANGE,(function(e){/^blob/.test(e)||(t.url=e,"mpd"===t.url.split(".").pop()&&t.loadUrl(e))}))}},{key:"beforePlayerInit",value:function(){if(!shaka.Player.isBrowserSupported())throw new Error("Browser not supported!");"mpd"===this.url.split(".").pop()&&this._initShaka()}},{key:"destroy",value:function(){this.shakaplayer&&(this.shakaplayer.destroy(),this.shakaplayer=null)}},{key:"_initShaka",value:function(){var t=this.player;this.shakaplayer=new shaka.Player(t.video),this.shakaplayer.addEventListener("error",(function(t){console.error("Error code",t.detail.code,"object",t.detail)})),this.config.shakaOpts&&this.shakaplayer.configure(this.config.shakaOpts),this.shakaplayer.getNetworkingEngine().registerRequestFilter((function(t,e){t===shaka.net.NetworkingEngine.RequestType.LICENSE&&(e.headers["CWIP-Auth-Header"]="VGhpc0lzQVRlc3QK")})),this.shakaplayer.addEventListener("adaptation",this.onAdaptation_),this.shakaplayer.configure({abr:{enabled:!1}}),this.loadUrl(this.url)}},{key:"loadUrl",value:function(t){var e=this;this.shakaplayer&&this.shakaplayer.load(t).then((function(){e.onTracksChanged_(),e.player.emit("loadeddata",{hlsEnd:!0})})).catch((function(t){console.trace("event",t),console.error("Error code",t.detail.code,"object",t.detail)}))}},{key:"onTracksChanged_",value:function(){this.updateVariantTracks_()}},{key:"updateVariantTracks_",value:function(){var t=this.shakaplayer.getVariantTracks();t.sort((function(t,e){return t.bandwidth-e.bandwidth})),this.updateTrackOptions_(t)}},{key:"updateTrackOptions_",value:function(t){var e=this,n={variant:function(track){var t="";return track.width&&track.height&&(t+=track.height+"P"),t}};this.content=[],t.forEach((function(track){var option={};option.textContent=n[track.type](track),option.track=track,option.value=track.id,option.selected=track.active,e.content.push(option)})),this.updateDefinition()}},{key:"updateDefinition",value:function(){v.a.device}}])&&o(e.prototype,n),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),y}(n(3437).a)},2011:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=[{name:"Hot",id:"hot",icon:"hot",show:!0},{name:"New",id:"new",icon:"new1",show:!0},{name:"relevanceSearch",id:"score",icon:"icon-icon-relativity",show:!0},{name:"Top",id:"top",icon:"top",show:!0}]},221:function(t,e,n){"use strict";var r=n(46),o=n(720),l=n(568);r({target:"Array",proto:!0},{fill:o}),l("fill")},222:function(t,e,n){"use strict";var r=n(3372);n.d(e,"a",(function(){return r}))},228:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n(47);var r=function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=data.list,e=void 0===t?[]:t,n=data.id,r=void 0===n?"":n;return e.findIndex((function(t){return t.id===r}))||0}},26:function(t,e,n){"use strict";n.d(e,"q",(function(){return h})),n.d(e,"G",(function(){return d})),n.d(e,"I",(function(){return f})),n.d(e,"g",(function(){return m})),n.d(e,"H",(function(){return v})),n.d(e,"L",(function(){return y})),n.d(e,"r",(function(){return T})),n.d(e,"s",(function(){return E})),n.d(e,"m",(function(){return k})),n.d(e,"h",(function(){return S})),n.d(e,"B",(function(){return _})),n.d(e,"C",(function(){return L})),n.d(e,"D",(function(){return C})),n.d(e,"F",(function(){return A})),n.d(e,"J",(function(){return w})),n.d(e,"t",(function(){return O})),n.d(e,"v",(function(){return R})),n.d(e,"K",(function(){return D})),n.d(e,"b",(function(){return I})),n.d(e,"w",(function(){return x})),n.d(e,"x",(function(){return P})),n.d(e,"y",(function(){return M})),n.d(e,"R",(function(){return F})),n.d(e,"u",(function(){return N})),n.d(e,"f",(function(){return j})),n.d(e,"e",(function(){return U})),n.d(e,"S",(function(){return B})),n.d(e,"Q",(function(){return $})),n.d(e,"N",(function(){return H})),n.d(e,"O",(function(){return G})),n.d(e,"P",(function(){return K})),n.d(e,"M",(function(){return V})),n.d(e,"l",(function(){return W})),n.d(e,"E",(function(){return Y})),n.d(e,"A",(function(){return z})),n.d(e,"z",(function(){return X})),n.d(e,"d",(function(){return Q})),n.d(e,"n",(function(){return J})),n.d(e,"i",(function(){return Z})),n.d(e,"a",(function(){return tt})),n.d(e,"c",(function(){return et})),n.d(e,"p",(function(){return it})),n.d(e,"k",(function(){return nt})),n.d(e,"o",(function(){return st})),n.d(e,"j",(function(){return at}));var r=n(17),o="/api/v1/character",l="/api/v1/account/character",c="/api/v1";function h(data){return Object(r.a)({url:o+"/detail",method:"post",data:data})}function d(data){return Object(r.a)({url:"/api/v1/report/ai-character",method:"post",data:data})}function f(data){return Object(r.a)({url:l+"/setting/update",method:"post",data:data})}function m(data){return Object(r.a)({url:o+"/session/create",method:"post",data:data})}function v(data){return Object(r.a)({url:o+"/session/chat/reset",method:"post",data:data})}function y(data){return Object(r.a)({url:o+"/session/chat/start",method:"post",data:data})}function T(data){return Object(r.a)({url:o+"/session/list",method:"post",data:data})}function E(data){return Object(r.a)({url:o+"/session/message/list",method:"post",data:data})}function k(data){return Object(r.a)({url:o+"/session/message/edit",method:"post",data:data})}function S(data){return Object(r.a)({url:o+"/session/message/delete",method:"post",data:data})}function _(data){return Object(r.a)({url:o+"/quick-chat/start",method:"post",data:data})}function L(data){return Object(r.a)({url:o+"/quick-chat/task/progress",method:"post",data:data})}function C(data){return Object(r.a)({url:o+"/quick-chat/can-talk",method:"post",data:data})}function A(data){return Object(r.a)({url:c+"/square/timbre/comprehensive-rec",method:"post",data:data})}function w(data){return Object(r.a)({url:c+"/character/session/timbre/set",method:"post",data:data})}function O(data){return Object(r.a)({url:c+"/square/timbre/my",method:"post",data:data})}function R(data){return Object(r.a)({url:c+"/timbre/detail",method:"post",data:data})}function D(data){return Object(r.a)({url:c+"/timbre/tts",method:"post",data:data,customConfig:{isSilent:!0,timeout:6e4}})}function I(data){return Object(r.a)({url:c+"/timbre/train/progress",method:"post",data:data})}function x(data){return Object(r.a)({url:c+"/square/timbre/list",method:"post",data:data})}function P(data){return Object(r.a)({url:c+"/square/task/timbre/search",method:"post",data:data})}function M(data){return Object(r.a)({url:c+"/square/timbre/voice/list",method:"post",data:data})}function F(data){return Object(r.a)({url:c+"/timbre/train",method:"post",data:data})}function N(data){return Object(r.a)({url:c+"/resource/pre-sign/get",method:"POST",data:data})}function j(data){return Object(r.a)({url:c+"/resource/pre-sign/confirm",method:"POST",data:data,customConfig:{isSilent:!0}})}function U(data){return Object(r.a)({url:c+"/resource/pre-sign/confirmPart",method:"POST",data:data})}function B(data){return Object(r.a)({url:c+"/timbre/train/log",method:"POST",data:data})}function $(data){return Object(r.a)({url:c+"/timbre/edit",method:"POST",data:data})}function H(data){return Object(r.a)({url:c+"/timbre/delete",method:"POST",data:data})}function G(data){return Object(r.a)({url:c+"/timbre/voice/delete",method:"POST",data:data})}function K(data){return Object(r.a)({url:c+"/timbre/voice/get",method:"POST",data:data})}function V(data){return Object(r.a)({url:c+"/tool/text/detection",method:"POST",data:data})}function W(data){return Object(r.a)({url:c+"/dot/log",method:"POST",data:data})}function Y(data){return Object(r.a)({url:o+"/reply/recommend",method:"post",data:data})}function z(data){return Object(r.a)({url:o+"/message/polish",method:"post",data:data})}function X(data){return Object(r.a)({url:c+"/datacard/my",method:"post",data:data})}function Q(data){return Object(r.a)({url:c+"/datacard/detail",method:"post",data:data,customConfig:{isSilent:!0}})}function J(data){return Object(r.a)({url:c+"/datacard/edit",method:"post",data:data})}function Z(data){return Object(r.a)({url:c+"/datacard/delete",method:"post",data:data})}function tt(data){return Object(r.a)({url:c+"/datacard/create",method:"post",data:data})}function et(data){return Object(r.a)({url:o+"/session/bind-datacard",method:"post",data:data})}function it(data){return Object(r.a)({url:"/api/v1/character/session/edit-datacard",method:"post",data:data})}function nt(data){return Object(r.a)({url:o+"/session/remove-datacard",method:"post",data:data})}function st(data){return Object(r.a)({url:o+"/session/edit",method:"post",data:data})}function at(data){return Object(r.a)({url:o+"/session/delete",method:"post",data:data})}},2964:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r={squareMixRecommend:{recommend:"getWaterRecommend",follows:"getWaterHomefollow",hot:"getWaterHomeArtwork",new:"getWaterHomeArtwork"},aiApp:{hot:"getWaterAiApp",new:"getWaterAiApp"},character:{recommend:"getWaterCharacterRecommend",hot:"getWaterCharacter",new:"getWaterCharacter",recently:"getWaterRecentList"},model:{recommend:"getWaterModelRecommend",follows:"getWaterHomefollow",hot:"getWaterfallModel",new:"getWaterfallModel"},post:{recommend:"getWaterArtworkRecommend",follows:"getWaterHomefollow",hot:"getWaterfallPost",new:"getWaterfallPost"},aiVideo:{hot:"getWaterfallAiVideo",new:"getWaterfallAiVideo"},timbre:{hot:"getWaterfallAiAudio",new:"getWaterfallAiAudio"},loraTrain:{recommend:"getWaterLoraRecommend",follows:"getWaterHomefollow",hot:"getWaterfallLoraTrain",new:"getWaterfallLoraTrain"},comfyui:{hot:"getWaterfallWorkfolw",new:"getWaterfallWorkfolw"},designTemplate:{recommend:"getWaterDesigntRecommend",follows:"getWaterHomefollow",hot:"getWaterfallDesignTemp",new:"getWaterfallDesignTemp"}}},33:function(t,e,n){"use strict";n.d(e,"a",(function(){return T}));n(9),n(11),n(12);var r=n(15),o=(n(232),n(44),n(88)),l=n.n(o),c=n(2),h=(n(7),n(47),n(10),n(19),n(36),n(14),n(8),n(4),n(18),n(6),n(21)),d=n(30),f=n(1),m=n(42);function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var T={data:function(){return{isCollecting:!1,followLoading:!1,likeLoading:!1,isAppealLoading:!1}},computed:y(y(y(y({},Object(f.e)("user",["collectData","followData","likeData","portfolioData","WaterFallDeleteLits","likeDataIds","collectDataIds"])),Object(f.c)("user",["isLoggedIn"])),Object(f.e)("payment",["productLevel"])),{},{setCollectData:function(){var t=this.collectData,e=this.collectDataIds;return function(n){if(t&&t.ids&&t.ids.includes(n.id)){var r,o,l;if(null!=t&&null!==(r=t.collect)&&void 0!==r&&r.collection_id&&(null==t||null===(o=t.collect)||void 0===o||!o.id))return"icon-collect_selected";this.$set(n,"collect",t.collect);var c=9===n.obj_type?null===(l=n.character)||void 0===l?void 0:l.stat:n.stat;t.num_of_collection>=0&&c&&this.$set(c,"num_of_collection",t.num_of_collection)}return this.isLoggedIn&&(n.collect||e.includes(n.id))?"icon-collect_selected":"icon-collect-gpt"}},setFollowData:function(){var t=this.followData;return function(e){return t.id==e.id&&this.$set(e.author,"is_follow",t.is_follow),this.isLoggedIn&&e.author.is_follow?"followed":"follow"}},setlikeData:function(){var t=this.likeData,e=this.likeDataIds;return function(n){return t.id==n.id&&(this.$set(n,"liked",t.liked),t.num_of_like>=0&&(n.stat&&this.$set(n.stat,"num_of_like",t.num_of_like),(n.num_of_praise||0==n.num_of_praise)&&this.$set(n,"num_of_praise",t.num_of_like))),this.isLoggedIn&&(n.liked||e.includes(n.id))?"icon-like_selected":"icon-like"}},setPortfolioList:function(){var t=this.portfolioData;return function(e,n){return e.forEach((function(element){var e,n;element&&t.ids&&t.ids.includes(element.id)&&(null!=t&&null!==(e=t.folder_no)&&void 0!==e&&e.collection_id?null!=element&&null!==(n=element.folder_no)&&void 0!==n&&n.collection_id&&(element.folder_no.collection_id=t.folder_no.collection_id,t.folder_no.collection_name&&(element.folder_no.collection_name=t.folder_no.collection_name)):element.folder_no=null)})),"all"==n?e.filter((function(t){return t})):e.filter((function(t){return t.folder_no&&t.folder_no.collection_id==n}))}},setCollectList:function(){var t=this.collectData;return function(e,n){return e.forEach((function(element){var e,n,r;element&&t.ids&&t.ids.includes(element.id)&&(null!=t&&null!==(e=t.collect)&&void 0!==e&&e.collection_id?null!=element&&null!==(n=element.collect)&&void 0!==n&&n.collection_id?(element.collect.collection_id=t.collect.collection_id||"default",null!==(r=t.collect)&&void 0!==r&&r.collection_name&&(element.collect.collection_name=t.collect.collection_name)):element.collect=t.collect:element.collect=null)})),"all"==n?e.filter((function(t){return t.collect})):e.filter((function(t){return t.collect&&t.collect.collection_id==n}))}}}),methods:y(y({},Object(f.d)("user",["changeCollectData","changeFollowData","changeLikeData","changePortfolioData","setWaterFallDeleteLits","changeLikeDataIds","changeCollectDataIds"])),{},{setCollect:function(t,e){var n,r,o=this;if(console.log("点击收藏",t,e,this.isLoggedIn),!this.isLoggedIn)return this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"click_collect",behavior_info_sub:(null==this||null===(n=this.dotReportInfo)||void 0===n?void 0:n.view_domain)||""}),void(null!==(r=this.$route)&&void 0!==r&&null!==(r=r.name)&&void 0!==r&&r.includes("aiChat")?this.$EventBus.$emit("openLoginDialog",{callBack:function(){return o.$emit("newChat")}}):this.$EventBus.$emit("openLoginDialog"));var l=t.collect&&t.collect.id,c=t.id,h=t.obj_type,d=t.ai_video,f=t.pt;h=d?h+"_"+(null==d?void 0:d.video_type):h,this.$logEvent("log_actions",{operation:(l?"cancel_":"")+"collect",obj_type:h,behavior_info:c,behavior_info_sub:f}),l?this.unFavorite(t,e):this.addFavorite(t,e)},setResourceAppeal:function(t){var e=this;this.isAppealLoading||(this.isAppealLoading=!0,Object(h.cb)(t).then((function(t){l()({message:e.$t("appealSuccess"),type:"success",duration:5e3}),e.appealShow=!1})).finally((function(){t.remark&&(t.remark=""),e.isAppealLoading=!1,e.appealShow=!1})))},addFavorite:function(t,e,n,r){var o=this,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5?arguments[5]:void 0;if(console.log("收藏",t,e),this.$emit("addFavorite"),!this.isCollecting){this.isCollecting=!0;var f={collection_no:n?n.id:null};"artwork"==e&&(f.artwork_no=t.id,this.$logEvent("log_actions",{operation:"quick_collect",behavior_info:"click_collect_icon",behavior_info_sub:t.id})),"model"==e&&(f.art_model_no=t.id,this.$logEvent("log_actions",{operation:"collect_model",behavior_info:t.id})),"lookbook"!=e&&"gallery"!=e||(f.post_no=t.id,this.$logEvent("log_actions",{operation:"click_collect_post_button"})),"palette"==e&&(f.tpl_no=t.id),"swtft_app"!=e&&"workflow"!=e||(f.comfy_ui_no=t.id),"character"===e&&(f.character_no=(null==t?void 0:t.id)||"",this.$logEvent("log_actions",{operation:"click_collect",behavior_info:"on_tavern_page"})),"ai_video"===e&&(f.video_no=t.id),"ai_audio"===e&&(f.timbre_no=(null==t?void 0:t.id)||"",this.$logEvent("log_actions",{operation:"click_collect",behavior_info:"on_ai_audio_waterfall_flow",behavior_info_sub:null==t?void 0:t.id}));var m=this.getDotInfo(t,e,"collection");Object(h.f)(f).then((function(l){var h;if(1e4==l.status.code){Object(d.g)({items:[m]});var f={ids:[t.id],collect:{collection_id:n?n.id:"default",collection_name:n?n.name:"default",id:l.data.id}},v=9===t.obj_type&&(null===(h=t.character)||void 0===h?void 0:h.stat)||t.stat;if(v){var y=v.num_of_collection;y++,f.num_of_collection=y,v.num_of_collection=y}o.changeCollectData(f),o.changeCollectDataIds({id:t.id,type:"add"}),o.isCollecting=!1,"function"==typeof r&&r(l.data),c||o.$EventBus.$emit("setCollectMsgBox",t,e,m)}})).catch((function(t){"function"==typeof l&&l(t),o.isCollecting=!1}))}},unFavorite:function(t,e){var n=this;if(console.log("取消收藏",t,e),!this.isCollecting){this.isCollecting=!0;var r=this.getDotInfo(t,e,"cancel_collection");Object(h.h)({id:t.collect.id}).then((function(o){var l;if(1e4==o.status.code){n.$emit("unFavorite",t),Object(d.g)({items:[r]});var c={ids:[t.id],collect:null},h=9===t.obj_type&&(null===(l=t.character)||void 0===l?void 0:l.stat)||t.stat;if(h){var f=h.num_of_collection;f--,c.num_of_collection=f,h.num_of_collection=f}n.changeCollectData(c),n.changeCollectDataIds({id:t.id,type:"del"}),n.isCollecting=!1,"character"===e?(formData.character_no=(null==t?void 0:t.id)||"",n.$logEvent("log_actions",{operation:"click_cancel_collect",behavior_info:"on_tavern_page"})):n.$logEvent("log_actions",{operation:"model"==e?"cancel_collect_model":"cancel_collect_image",behavior_info:t.id})}})).catch((function(t){n.isCollecting=!1}))}},unBatchFavorite:function(t,e,n){var o=this;this.isCollecting||(this.isCollecting=!0,Object(h.g)({ids:e?t.folderNos:t.collectIds,category:e?2:null}).then((function(l){if(1e4==l.status.code){var c=Object(r.a)(t.ids),h={};e?(h={ids:c,folder_no:null},o.changePortfolioData(h)):(h={ids:c,collect:null},o.changeCollectData(h)),o.isCollecting=!1,"function"==typeof n&&n(l.data)}})).catch((function(t){o.isCollecting=!1})))},moveFavorite:function(t,e,n,o){var l=this,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(!this.isCollecting){this.isCollecting=!0;var d={folder_no:e?e.id:null,ids:n?t.folderNos:t.collectIds,category:n?2:null};Object(h.i)(d).then((function(c){if(1e4==c.status.code){var h=Object(r.a)(t.ids),d={};n?(d={ids:h,folder_no:{collection_id:e?e.id:"default",collection_name:e?e.name:"default"}},l.changePortfolioData(d)):(d={ids:h,collect:{collection_id:e?e.id:"default",collection_name:e?e.name:"default"}},l.changeCollectData(d)),l.isCollecting=!1,"function"==typeof o&&o(c.data)}})).catch((function(t){"function"==typeof c&&c(t),l.isCollecting=!1}))}},setFollow:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!this.followLoading){this.followLoading=!0;var r={follow_account_no:t.author.id};t.author.is_follow?Object(h.w)(r).then((function(r){1e4==r.status.code&&(e.$logEvent("log_actions",{operation:"unfollow",behavior_info:n||t.author.id}),e.changeFollowData({id:t.id,is_follow:!1}),e.followLoading=!1)})):Object(h.v)(r).then((function(r){1e4==r.status.code&&(e.$logEvent("log_actions",{operation:"follow",behavior_info:n||t.author.id}),e.changeFollowData({id:t.id,is_follow:!0}),e.followLoading=!1)}))}},setLike:function(t,e,n){var r=this,o={artwork:1,model:2,account:3,gallery:4,post:4,lookbook:5,character:9,palette:11,swtft_app:13,workflow:13,ai_video:15,ai_audio:16};if(!Object(m.l)()){var l;this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"click_like",behavior_info_sub:(null==this||null===(l=this.dotReportInfo)||void 0===l?void 0:l.view_domain)||""});var c={};return"ai_video_detail"==n&&(c={callBack:function(){location.reload()}}),void this.$EventBus.$emit("openLoginDialog",c)}var h=t.id,f=t.obj_type,v=t.ai_video,y=t.pt;if(f=v?f+"_"+(null==v?void 0:v.video_type):f,this.$logEvent("log_actions",{operation:(t.liked?"cancel_":"")+"like",obj_type:f,behavior_info:h,behavior_info_sub:y}),4==o[e])this.$logEvent("log_actions",{operation:"like_post",behavior_info:this.$route.path,behavior_info_sub:("lookbook"==e?"video":e)+","+t.id});else if(5==o[e]){var T,E,k;this.$logEvent("log_actions",{operation:(t.liked?"cancel_like_":"like_")+e,behavior_info:null!=t&&null!==(T=t.author)&&void 0!==T&&T.id?null==t||null===(E=t.author)||void 0===E?void 0:E.id:null==t||null===(k=t.portfolio)||void 0===k?void 0:k.id})}else{var S,_,L;this.$logEvent("log_actions",{operation:(t.liked?"cancel_like_":"like_")+e,behavior_info:null!=t&&null!==(S=t.author)&&void 0!==S&&S.id?null==t||null===(_=t.author)||void 0===_?void 0:_.id:null==t||null===(L=t.portfolio)||void 0===L?void 0:L.id})}if(!this.likeLoading){this.likeLoading=!0;var C=this.getDotInfo(t,e,t.liked?"dislike":"like");Object(d.g)({items:[C]}).then((function(e){var n;if(1e4==(null==e||null===(n=e.status)||void 0===n?void 0:n.code)){var o={id:t.id,liked:!t.liked};if(t.stat){var l=t.stat.num_of_like;t.liked?l--:l++,o.num_of_like=l}if(t.num_of_praise||0==t.num_of_praise){var c=t.num_of_praise;t.liked?c--:c++,o.num_of_like=c}r.changeLikeData(o),r.changeLikeDataIds({id:o.id,type:!0===o.liked?"add":"del"})}else{var h;r.$message({message:(null==e||null===(h=e.status)||void 0===h?void 0:h.msg)||r.$t("ServerError"),type:"error"})}})).finally((function(){r.likeLoading=!1}))}},reportArtwork:function(t){var e=this;Object(d.o)({id:t}).then((function(t){1e4==t.status.code&&l()({message:e.$t("ReportSuccess"),type:"success",duration:5e3})}))},getDotInfo:function(t,e,n){var r,o=[],l={artwork:1,model:2,account:3,gallery:4,post:4,lookbook:5,character:9,palette:11,swtft_app:13,workflow:13,ai_video:15,ai_audio:16};if(this.list){var c=this.list.findIndex((function(i){return i.id===t.id}));o=(c<10?this.list.slice(0,c):this.list.slice(c-10,c)).map((function(t){return t.id})).filter((function(t){return"banner"!=t&&"ai_tool"!=t}))}var h=y({action:n,obj_no:t.id,obj_type:l[e]?l[e]:e,negative_ids:o,batch_id:null==t?void 0:t.pt,stat:null==t?void 0:t.stat},this.productLevel&&{vip:this.productLevel});return h=this.dotReportInfo&&null!==(r=Object.keys(this.dotReportInfo))&&void 0!==r&&r.length?y(y({},this.dotReportInfo),h):y(y({},h),{},{category:"default",view_domain:"",batch_id:""})}})}},334:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return l})),n.d(e,"a",(function(){return c})),n.d(e,"d",(function(){return h}));var r=n(17),path="/api/v1/ai-video";function o(data){return Object(r.a)({url:path+"/detail",method:"POST",data:data})}function l(data){return Object(r.a)({url:path+"/play",method:"POST",data:data})}function c(data){return Object(r.a)({url:path+"/report",method:"POST",data:data})}function h(data){return Object(r.a)({url:"/api/v1/square/ai-video/related/rec-play",method:"POST",data:data})}},3355:function(t,e,n){var r=n(3360),o=n(3362);t.exports=function(source,t,object,e){var n=!object;object||(object={});for(var l=-1,c=t.length;++l<c;){var h=t[l],d=e?e(object[h],source[h],h,object,source):void 0;void 0===d&&(d=source[h]),n?o(object,h,d):r(object,h,d)}return object}},3356:function(t,e,n){var r=n(3413),o=n(3381),l=n(3407);t.exports=function(object){return l(object)?r(object,!0):o(object)}},3357:function(t,e,n){var r=n(3418);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},3358:function(t,e,n){"use strict";function r(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function o(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?r(Object(source),!0).forEach((function(e){f(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):r(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,C(n.key),n)}}function d(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t,e,n){return(e=C(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&y(t,e)}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t,p){return(y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,p)}function T(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function E(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return T(t)}function k(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=v(t);if(e){var o=v(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return E(this,n)}}function S(){return S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var base=function(object,t){for(;!Object.prototype.hasOwnProperty.call(object,t)&&null!==(object=v(object)););return object}(t,e);if(base){var desc=Object.getOwnPropertyDescriptor(base,e);return desc.get?desc.get.call(arguments.length<3?t:n):desc.value}},S.apply(this,arguments)}function _(t){return function(t){if(Array.isArray(t))return L(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return L(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function C(t){var e=function(input,t){if("object"!=typeof input||null===input)return input;var e=input[Symbol.toPrimitive];if(void 0!==e){var n=e.call(input,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(input)}(t,"string");return"symbol"==typeof e?e:String(e)}n.d(e,"a",(function(){return T})),n.d(e,"b",(function(){return c})),n.d(e,"c",(function(){return d})),n.d(e,"d",(function(){return k})),n.d(e,"e",(function(){return f})),n.d(e,"f",(function(){return S})),n.d(e,"g",(function(){return v})),n.d(e,"h",(function(){return m})),n.d(e,"i",(function(){return o})),n.d(e,"j",(function(){return E})),n.d(e,"k",(function(){return _})),n.d(e,"l",(function(){return l}))},3359:function(t,e,n){"use strict";n.d(e,"a",(function(){return v})),n.d(e,"b",(function(){return c})),n.d(e,"c",(function(){return m})),n.d(e,"d",(function(){return f}));var r=n(3358),o=n(3368),l=function(){function t(e){Object(r.b)(this,t),this.bufferedList=e}return Object(r.c)(t,[{key:"start",value:function(t){return this.bufferedList[t].start}},{key:"end",value:function(t){return this.bufferedList[t].end}},{key:"length",get:function(){return this.bufferedList.length}}]),t}(),c={};function h(t){var e=Object(r.l)(t);return null!==t&&("object"===e||"function"===e)}function d(t,e,n){var r,o,l,c,d,f,m=0,v=!1,y=!1,T=!0,E=!e&&0!==e&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function k(time){var e=r,n=o;return r=o=void 0,m=time,c=t.apply(n,e)}function S(t,e){return E?(window.cancelAnimationFrame(d),window.requestAnimationFrame(t)):setTimeout(t,e)}function _(time){var t=time-f;return void 0===f||t>=e||t<0||y&&time-m>=l}function L(){var time=Date.now();if(_(time))return C(time);d=S(L,function(time){var t=time-m,n=e-(time-f);return y?Math.min(n,l-t):n}(time))}function C(time){return d=void 0,T&&r?k(time):(r=o=void 0,c)}function A(){for(var time=Date.now(),t=_(time),n=arguments.length,l=new Array(n),h=0;h<n;h++)l[h]=arguments[h];if(r=l,o=this,f=time,t){if(void 0===d)return function(time){return m=time,d=S(L,e),v?k(time):c}(f);if(y)return d=S(L,e),k(f)}return void 0===d&&(d=S(L,e)),c}return e=+e||0,h(n)&&(v=!!n.leading,l=(y="maxWait"in n)?Math.max(+n.maxWait||0,e):l,T="trailing"in n?!!n.trailing:T),A.cancel=function(){void 0!==d&&function(t){if(E)return window.cancelAnimationFrame(t);clearTimeout(t)}(d),m=0,r=f=o=d=void 0},A.flush=function(){return void 0===d?c:C(Date.now())},A.pending=function(){return void 0!==d},A}function f(t,e,n){var r=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return h(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),d(t,e,{leading:r,trailing:o,maxWait:e})}function m(){var t=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase();return"zh-cn"===t&&(t="zh"),t}function v(element,t,e){if(element){var n=element.getAttribute(e);return!(!n||n!==t||"VIDEO"!==element.tagName&&"AUDIO"!==element.tagName)}}c.createDom=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=document.createElement(t);return o.className=r,o.innerHTML=e,Object.keys(n).forEach((function(e){var r=e,l=n[e];"video"===t||"audio"===t||"live-video"===t?l&&o.setAttribute(r,l):o.setAttribute(r,l)})),o},c.createDomFromHtml=function(html){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{var n=document.createElement("div");n.innerHTML=html;var r=n.children;return n=null,r.length>0?(r=r[0],e&&c.addClass(r,e),t&&Object.keys(t).forEach((function(e){r.setAttribute(e,t[e])})),r):null}catch(t){return o.b.logError("util.createDomFromHtml",t),null}},c.hasClass=function(t,e){if(!t||!e)return!1;try{return Array.prototype.some.call(t.classList,(function(t){return t===e}))}catch(o){var n=t.className&&"object"===Object(r.l)(t.className)?t.getAttribute("class"):t.className;return n&&!!n.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}},c.addClass=function(t,e){if(t&&e)try{e.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(e){e&&t.classList.add(e)}))}catch(n){c.hasClass(t,e)||(t.className&&"object"===Object(r.l)(t.className)?t.setAttribute("class",t.getAttribute("class")+" "+e):t.className+=" "+e)}},c.removeClass=function(t,e){if(t&&e)try{e.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(e){e&&t.classList.remove(e)}))}catch(n){c.hasClass(t,e)&&e.split(/\s+/g).forEach((function(e){var n=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className&&"object"===Object(r.l)(t.className)?t.setAttribute("class",t.getAttribute("class").replace(n," ")):t.className=t.className.replace(n," ")}))}},c.toggleClass=function(t,e){t&&e.split(/\s+/g).forEach((function(e){c.hasClass(t,e)?c.removeClass(t,e):c.addClass(t,e)}))},c.classNames=function(){for(var t=arguments,e=[],n=function(n){"String"===c.typeOf(t[n])?e.push(t[n]):"Object"===c.typeOf(t[n])&&Object.keys(t[n]).map((function(r){t[n][r]&&e.push(r)}))},i=0;i<arguments.length;i++)n(i);return e.join(" ")},c.findDom=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,n=arguments.length>1?arguments[1]:void 0;try{t=e.querySelector(n)}catch(r){o.b.logError("util.findDom",r),0===n.indexOf("#")&&(t=e.getElementById(n.slice(1)))}return t},c.getCss=function(t,e){return t.currentStyle?t.currentStyle[e]:document.defaultView.getComputedStyle(t,!1)[e]},c.padStart=function(t,e,n){for(var r=String(n),o=e|0,l=Math.ceil(o/r.length),c=[],h=String(t);l--;)c.push(r);return c.join("").substring(0,o-h.length)+h},c.format=function(time){if(window.isNaN(time))return"";time=Math.round(time);var t=c.padStart(Math.floor(time/3600),2,0),e=c.padStart(Math.floor((time-3600*t)/60),2,0),n=c.padStart(Math.floor(time-3600*t-60*e),2,0);return("00"===t?[e,n]:[t,e,n]).join(":")},c.event=function(t){if(t.touches){var e=t.touches[0]||t.changedTouches[0];t.clientX=e.clientX||0,t.clientY=e.clientY||0,t.offsetX=e.pageX-e.target.offsetLeft,t.offsetY=e.pageY-e.target.offsetTop}t._target=t.target||t.srcElement},c.typeOf=function(t){return Object.prototype.toString.call(t).match(/([^\s.*]+)(?=]$)/g)[0]},c.deepCopy=function(t,e){if("Object"===c.typeOf(e)&&"Object"===c.typeOf(t))return Object.keys(e).forEach((function(n){"Object"!==c.typeOf(e[n])||e[n]instanceof Node?"Array"===c.typeOf(e[n])?t[n]="Array"===c.typeOf(t[n])?t[n].concat(e[n]):e[n]:t[n]=e[n]:void 0===t[n]||void 0===t[n]?t[n]=e[n]:c.deepCopy(t[n],e[n])})),t},c.deepMerge=function(t,e){return Object.keys(e).map((function(n){var o;"Array"===c.typeOf(e[n])&&"Array"===c.typeOf(t[n])?"Array"===c.typeOf(t[n])&&(o=t[n]).push.apply(o,Object(r.k)(e[n])):c.typeOf(t[n])!==c.typeOf(e[n])||null===t[n]||"Object"!==c.typeOf(t[n])||e[n]instanceof window.Node?null!==e[n]&&(t[n]=e[n]):c.deepMerge(t[n],e[n])})),t},c.getBgImage=function(t){var e=(t.currentStyle||window.getComputedStyle(t,null)).backgroundImage;if(!e||"none"===e)return"";var a=document.createElement("a");return a.href=e.replace(/url\("|"\)/g,""),a.href},c.copyDom=function(t){if(t&&1===t.nodeType){var e=document.createElement(t.tagName);return Array.prototype.forEach.call(t.attributes,(function(t){e.setAttribute(t.name,t.value)})),t.innerHTML&&(e.innerHTML=t.innerHTML),e}return""},c.setInterval=function(t,e,n,r){t._interval[e]||(t._interval[e]=window.setInterval(n.bind(t),r))},c.clearInterval=function(t,e){clearInterval(t._interval[e]),t._interval[e]=null},c.setTimeout=function(t,e,time){t._timers||(t._timers=[]);var n=setTimeout((function(){e(),c.clearTimeout(t,n)}),time);return t._timers.push(n),n},c.clearTimeout=function(t,e){var n=t._timers;if("Array"===c.typeOf(n)){for(var i=0;i<n.length;i++)if(n[i]===e){n.splice(i,1),clearTimeout(e);break}}else clearTimeout(e)},c.clearAllTimers=function(t){var e=t._timers;"Array"===c.typeOf(e)&&(e.map((function(t){clearTimeout(t)})),t._timerIds=[])},c.createImgBtn=function(t,e,n,r){var o,l,h,d=c.createDom("xg-".concat(t),"",{},"xgplayer-".concat(t,"-img"));(d.style.backgroundImage='url("'.concat(e,'")'),n&&r)&&(["px","rem","em","pt","dp","vw","vh","vm","%"].every((function(t){return!(n.indexOf(t)>-1&&r.indexOf(t)>-1)||(o=parseFloat(n.slice(0,n.indexOf(t)).trim()),l=parseFloat(r.slice(0,r.indexOf(t)).trim()),h=t,!1)})),d.style.width="".concat(o).concat(h),d.style.height="".concat(l).concat(h),d.style.backgroundSize="".concat(o).concat(h," ").concat(l).concat(h),d.style.margin="start"===t?"-".concat(l/2).concat(h," auto auto -").concat(o/2).concat(h):"auto 5px auto 5px");return d},c.Hex2RGBA=function(t,e){var n=[];if(/^\#[0-9A-F]{3}$/i.test(t)){var r="#";t.replace(/[0-9A-F]/gi,(function(t){r+=t+t})),t=r}return/^#[0-9A-F]{6}$/i.test(t)?(t.replace(/[0-9A-F]{2}/gi,(function(t){n.push(parseInt(t,16))})),"rgba(".concat(n.join(","),", ").concat(e,")")):"rgba(255, 255, 255, 0.1)"},c.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},c.checkIsFunction=function(t){return t&&"function"==typeof t},c.checkIsObject=function(t){return null!==t&&"object"===Object(r.l)(t)},c.hide=function(t){t.style.display="none"},c.show=function(t,e){t.style.display=e||"block"},c.isUndefined=function(t){if(null==t)return!0},c.isNotNull=function(t){return!(null==t)},c.setStyleFromCsstext=function(t,text){text&&("String"===c.typeOf(text)?text.replace(/\s+/g,"").split(";").map((function(e){if(e){var n=e.split(":");n.length>1&&(t.style[n[0]]=n[1])}})):Object.keys(text).map((function(e){t.style[e]=text[e]})))},c.filterStyleFromText=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],n=t.style.cssText;if(!n)return{};var r=n.replace(/\s+/g,"").split(";"),o={},l={};return r.map((function(t){if(t){var n=t.split(":");n.length>1&&(!function(t,e){for(var i=0,n=e.length;i<n;i++)if(t.indexOf(e[i])>-1)return!0;return!1}(n[0],e)?l[n[0]]=n[1]:o[n[0]]=n[1])}})),t.setAttribute("style",""),Object.keys(l).map((function(e){t.style[e]=l[e]})),o},c.getStyleFromCsstext=function(t){var e=t.style.cssText;if(!e)return{};var n=e.replace(/\s+/g,"").split(";"),r={};return n.map((function(t){if(t){var e=t.split(":");e.length>1&&(r[e[0]]=e[1])}})),r},c.preloadImg=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(t){var img=new window.Image;img.onload=function(t){img=null,e&&e(t)},img.onerror=function(t){img=null,n&&n(t)},img.src=t}},c.stopPropagation=function(t){t&&t.stopPropagation()},c.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},c.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0},c.checkTouchSupport=function(){return"ontouchstart"in window},c.getBuffered2=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=[],i=0;i<t.length;i++)n.push({start:t.start(i)<.5?0:t.start(i),end:t.end(i)});n.sort((function(a,b){var t=a.start-b.start;return t||b.end-a.end}));var r=[];if(e)for(var o=0;o<n.length;o++){var c=r.length;if(c){var h=r[c-1].end;n[o].start-h<e?n[o].end>h&&(r[c-1].end=n[o].end):r.push(n[o])}else r.push(n[o])}else r=n;return new l(r)},c.getEventPos=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.touches&&t.touches.length>0&&(t=t.touches[0]),{x:t.x/e,y:t.y/e,clientX:t.clientX/e,clientY:t.clientY/e,offsetX:t.offsetX/e,offsetY:t.offsetY/e,pageX:t.pageX/e,pageY:t.pageY/e}},c.requestAnimationFrame=function(t){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(e)return e(t)},c.getHostFromUrl=function(t){if("String"!==c.typeOf(t))return"";var e=t.split("/"),n="";return e.length>3&&e[2]&&(n=e[2]),n},c.cancelAnimationFrame=function(t){var e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;e&&e(t)},c.isMSE=function(video){return video.media&&(video=video.media),!!(video&&video instanceof HTMLMediaElement)&&(/^blob/.test(video.currentSrc)||/^blob/.test(video.src))},c.isBlob=function(t){return"string"==typeof t&&/^blob/.test(t)},c.generateSessionId=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=(new Date).getTime();try{t=parseInt(t)}catch(e){t=0}return e+=t,window.performance&&"function"==typeof window.performance.now&&(e+=parseInt(window.performance.now())),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},c.createEvent=function(t){var e;return"function"==typeof window.Event?e=new Event(t):(e=document.createEvent("Event")).initEvent(t,!0,!0),e},c.adjustTimeByDuration=function(time,t,e){return t&&time&&(time>t||e&&time<t)?t:time},c.createPositionBar=function(t,e){var n=c.createDom("xg-bar","",{"data-index":-1},t);return e.appendChild(n),n},c.getTransformStyle=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,scale:1,rotate:0},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n={scale:"".concat(t.scale||1),translate:"".concat(t.x||0,"%, ").concat(t.y||0,"%"),rotate:"".concat(t.rotate||0,"deg")};return Object.keys(n).forEach((function(t){var r=new RegExp("".concat(t,"\\([^\\(]+\\)"),"g"),o="".concat(t,"(").concat(n[t],")");r.test(e)?(r.lastIndex=-1,e=e.replace(r,o)):e+="".concat(o," ")})),e},c.convertDeg=function(t){return Math.abs(t)<=1?360*t:t%360},c.getIndexByTime=function(time,t){var e=t.length,n=-1;if(e<1)return n;if(time<=t[0].end||e<2)n=0;else if(time>t[e-1].end)n=e-1;else for(var i=1;i<e;i++)if(time>t[i-1].end&&time<=t[i].end){n=i;break}return n},c.getOffsetCurrentTime=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=-1;if((r=n>=0&&n<e.length?n:c.getIndexByTime(t,e))<0)return-1;var o=e.length,l=e[r],h=l.start,d=l.end,f=l.cTime,m=l.offset;return t<h?f:t>=h&&t<=d?t-m:t>d&&r>=o-1?d:-1},c.getCurrentTimeByOffset=function(t,e){var n=-1;if(!e||e.length<0)return t;for(var i=0;i<e.length;i++)if(t<=e[i].duration){n=i;break}if(-1!==n){var r=e[n].start;return n-1<0?r+t:r+(t-e[n-1].duration)}return t}},3360:function(t,e,n){var r=n(3362),o=n(3401),l=Object.prototype.hasOwnProperty;t.exports=function(object,t,e){var n=object[t];l.call(object,t)&&o(n,e)&&(void 0!==e||t in object)||r(object,t,e)}},3362:function(t,e,n){var r=n(3412);t.exports=function(object,t,e){"__proto__"==t&&r?r(object,t,{configurable:!0,enumerable:!0,value:e,writable:!0}):object[t]=e}},3363:function(t,e,n){var r=n(3404),o=n(3364),l=n(3377),c=n(3415),h=Object.getOwnPropertySymbols?function(object){for(var t=[];object;)r(t,l(object)),object=o(object);return t}:c;t.exports=h},3364:function(t,e,n){var r=n(3414)(Object.getPrototypeOf,Object);t.exports=r},3368:function(t,e,n){"use strict";n.d(e,"a",(function(){return h})),n.d(e,"b",(function(){return c}));var r="undefined"!=typeof window&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,o={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},l="%c[xgplayer]",c={config:{debug:r?3:0},logInfo:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),c=1;c<n;c++)r[c-1]=arguments[c];this.config.debug>=3&&(e=console).log.apply(e,[l,o.info,t].concat(r))},logWarn:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),c=1;c<n;c++)r[c-1]=arguments[c];this.config.debug>=1&&(e=console).warn.apply(e,[l,o.warn,t].concat(r))},logError:function(t){var e;if(!(this.config.debug<1)){for(var n=this.config.debug>=2?"trace":"error",r=arguments.length,c=new Array(r>1?r-1:0),h=1;h<r;h++)c[h-1]=arguments[h];(e=console)[n].apply(e,[l,o.error,t].concat(c))}}};function h(t){t.logInfo=c.logInfo.bind(t),t.logWarn=c.logWarn.bind(t),t.logError=c.logError.bind(t)}},3369:function(t,e,n){"use strict";n.d(e,"a",(function(){return m})),n.d(e,"b",(function(){return k}));var r=n(3358),o=n(3437),l=n(3450),c=n.n(l),h=n(3368),d=n(3359),f={CONTROLS:"controls",ROOT:"root"},m={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"},v="xg-icon-disable";function y(t){return!!t&&(t.indexOf&&/^(?:http|data:|\/)/.test(t))}function T(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",l=null;if(t instanceof window.Element)return d.b.addClass(t,n),Object.keys(r).map((function(e){t.setAttribute(e,r[e])})),t;if(y(t)||y(t.url))return r.src=y(t)?t:t.url||"",l=d.b.createDom(t.tag||"img","",r,"xg-img ".concat(n));if("function"==typeof t)try{return(l=t())instanceof window.Element?(d.b.addClass(l,n),Object.keys(r).map((function(t){l.setAttribute(t,r[t])})),l):(h.b.logWarn("warn>>icons.".concat(e," in config of plugin named [").concat(o,"] is a function mast return an Element Object")),null)}catch(t){return h.b.logError("Plugin named [".concat(o,"]:createIcon"),t),null}return"string"==typeof t?d.b.createDomFromHtml(t,r,n):(h.b.logWarn("warn>>icons.".concat(e," in config of plugin named [").concat(o,"] is invalid")),null)}function E(t,e){var n=e.config.icons||e.playerConfig.icons;Object.keys(t).map((function(o){var l=t[o],c=l&&l.class?l.class:"",h=l&&l.attr?l.attr:{},d=null;n&&n[o]&&(c=function(t,e){return"object"===Object(r.l)(t)&&t.class&&"string"==typeof t.class?"".concat(e," ").concat(t.class):e}(n[o],c),h=function(t,e){return"object"===Object(r.l)(t)&&t.attr&&"object"===Object(r.l)(t.attr)&&Object.keys(t.attr).map((function(n){e[n]=t.attr[n]})),e}(n[o],h),d=T(n[o],o,c,h,e.pluginName)),!d&&l&&(d=T(l.icon?l.icon:l,h,c,{},e.pluginName)),e.icons[o]=d}))}var k=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(r.b)(this,n),(t=e.call(this,o)).__delegates=[],t}return Object(r.c)(n,[{key:"__init",value:function(t){if(Object(r.f)(Object(r.g)(n.prototype),"__init",this).call(this,t),t.root){var e=t.root,o=null;this.icons={},this.root=null,this.parent=null,E(this.registerIcons()||{},this),this.langText={};var l,c,f=this.registerLanguageTexts()||{};l=f,c=this,Object.keys(l).map((function(t){Object.defineProperty(c.langText,t,{get:function(){var e=c.lang,n=c.i18n;return n[t]?n[t]:l[t]&&l[t][e]||""}})}));var m="";try{m=this.render()}catch(t){throw h.b.logError("Plugin:".concat(this.pluginName,":render"),t),new Error("Plugin:".concat(this.pluginName,":render:").concat(t.message))}if(m)(o=n.insert(m,e,t.index)).setAttribute("data-index",t.index);else{if(!t.tag)return;(o=d.b.createDom(t.tag,"",t.attr,t.name)).setAttribute("data-index",t.index),e.appendChild(o)}this.root=o,this.parent=e;var v=this.config.attr||{},style=this.config.style||{};this.setAttr(v),this.setStyle(style),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var t=this;if(this.root){this._children=[];var e=this.children();e&&"object"===Object(r.l)(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(n){var o,l,c=n,h=e[c],f={root:t.root};"function"==typeof h?(o=t.config[c]||{},l=h):"object"===Object(r.l)(h)&&"function"==typeof h.plugin&&(o=h.options?d.b.deepCopy(t.config[c]||{},h.options):t.config[c]||{},l=h.plugin),f.config=o,void 0!==o.index&&(f.index=o.index),o.root&&(f.root=o.root),t.registerPlugin(l,f,c)}))}}},{key:"updateLang",value:function(t){t||(t=this.lang);var e=this.root,n=this.i18n,r=this.langText;e&&function t(e,n){for(var i=0;i<e.children.length;i++)e.children[i].children.length>0?t(e.children[i],n):n(e.children[i])}(e,(function(e){var o=e.getAttribute&&e.getAttribute("lang-key");if(o){var l=n[o.toUpperCase()]||r[o];l&&(e.innerHTML="function"==typeof l?l(t):l)}}))}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.i18n||{},r=this.langText;t.setAttribute&&t.setAttribute("lang-key",e);var text=n[e]||r[e]||"";text&&(t.innerHTML=text)}},{key:"plugins",value:function(){return this._children}},{key:"disable",value:function(){this.config.disable=!0,d.b.addClass(this.find(".xgplayer-icon"),v)}},{key:"enable",value:function(){this.config.disable=!1,d.b.removeClass(this.find(".xgplayer-icon"),v)}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e.root=e.root||this.root;var l=Object(r.f)(Object(r.g)(n.prototype),"registerPlugin",this).call(this,t,e,o);return this._children.push(l),l}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(t){if(this.root)return this.root.querySelector(t)}},{key:"bind",value:function(t,e,r){var o=this;if(arguments.length<3&&"function"==typeof e)Array.isArray(t)?t.forEach((function(t){o.bindEL(t,e)})):this.bindEL(t,e);else{var l=n.delegate.call(this,this.root,t,e,r);this.__delegates=this.__delegates.concat(l)}}},{key:"unbind",value:function(t,e){var n=this;if(arguments.length<3&&"function"==typeof e)Array.isArray(t)?t.forEach((function(t){n.unbindEL(t,e)})):this.unbindEL(t,e);else for(var r="".concat(t,"_").concat(e),i=0;i<this.__delegates.length;i++)if(this.__delegates[i].key===r){this.__delegates[i].destroy(),this.__delegates.splice(i,1);break}}},{key:"setStyle",value:function(t,e){var n=this;if(this.root)return"String"===d.b.typeOf(t)?this.root.style[t]=e:void("Object"===d.b.typeOf(t)&&Object.keys(t).map((function(e){n.root.style[e]=t[e]})))}},{key:"setAttr",value:function(t,e){var n=this;if(this.root)return"String"===d.b.typeOf(t)?this.root.setAttribute(t,e):void("Object"===d.b.typeOf(t)&&Object.keys(t).map((function(e){n.root.setAttribute(e,t[e])})))}},{key:"setHtml",value:function(t,e){this.root&&(this.root.innerHTML=t,"function"==typeof e&&e())}},{key:"bindEL",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(t)in this.root&&"function"==typeof e&&this.root.addEventListener(t,e,n)}},{key:"unbindEL",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(t)in this.root&&"function"==typeof e&&this.root.removeEventListener(t,e,n)}},{key:"show",value:function(t){if(this.root)return this.root.style.display=void 0!==t?t:"block","none"===window.getComputedStyle(this.root,null).getPropertyValue("display")?this.root.style.display="block":void 0}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(t,e){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!(e&&e instanceof window.Element))return null;try{return"string"==typeof t?this.find(t).appendChild(e):t.appendChild(e)}catch(t){return h.b.logError("Plugin:appendChild",t),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var t=this,e=this.player;this.__delegates.map((function(t){t.destroy()})),this.__delegates=[],this._children instanceof Array&&(this._children.map((function(t){e.unRegisterPlugin(t.pluginName)})),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),Object(r.f)(Object(r.g)(n.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map((function(e){t[e]=null}))}}],[{key:"insert",value:function(html,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.children.length,r=Number(e),o=html instanceof window.Node;if(n){for(var i=0,l=null,c="";i<n;i++){l=t.children[i];var h=Number(l.getAttribute("data-index"));if(h>=r){c="beforebegin";break}h<r&&(c="afterend")}return o?"afterend"===c?t.appendChild(html):t.insertBefore(html,l):l.insertAdjacentHTML(c,html),"afterend"===c?t.children[t.children.length-1]:t.children[i]}return o?t.appendChild(html):t.insertAdjacentHTML("beforeend",html),t.children[t.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(t,e,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=[];if(t instanceof window.Node&&"function"==typeof r)if(Array.isArray(n))n.forEach((function(n){var h=c()(t,e,n,r,o);h.key="".concat(e,"_").concat(n),l.push(h)}));else{var h=c()(t,e,n,r,o);h.key="".concat(e,"_").concat(n),l.push(h)}return l}},{key:"ROOT_TYPES",get:function(){return f}},{key:"POSITIONS",get:function(){return m}}]),n}(o.a)},3372:function(t,e,n){"use strict";n.r(e),n.d(e,"ABORT",(function(){return D})),n.d(e,"AFTER_DEFINITION_CHANGE",(function(){return Z})),n.d(e,"AUTOPLAY_PREVENTED",(function(){return j})),n.d(e,"AUTOPLAY_STARTED",(function(){return N})),n.d(e,"BEFORE_DEFINITION_CHANGE",(function(){return J})),n.d(e,"BUFFER_CHANGE",(function(){return I})),n.d(e,"CANPLAY",(function(){return y})),n.d(e,"CANPLAY_THROUGH",(function(){return T})),n.d(e,"COMPLETE",(function(){return U})),n.d(e,"CSS_FULLSCREEN_CHANGE",(function(){return z})),n.d(e,"DEFINITION_CHANGE",(function(){return Q})),n.d(e,"DESTROY",(function(){return $})),n.d(e,"DOWNLOAD_SPEED_CHANGE",(function(){return G})),n.d(e,"DURATION_CHANGE",(function(){return E})),n.d(e,"EMPTIED",(function(){return w})),n.d(e,"ENDED",(function(){return l})),n.d(e,"ENTER_PLAYER",(function(){return V})),n.d(e,"ERROR",(function(){return h})),n.d(e,"FPS_STUCK",(function(){return yt})),n.d(e,"FULLSCREEN_CHANGE",(function(){return Y})),n.d(e,"LEAVE_PLAYER",(function(){return K})),n.d(e,"LOADED_DATA",(function(){return S})),n.d(e,"LOADED_METADATA",(function(){return _})),n.d(e,"LOADING",(function(){return W})),n.d(e,"LOAD_START",(function(){return A})),n.d(e,"MINI_STATE_CHANGE",(function(){return X})),n.d(e,"PAUSE",(function(){return c})),n.d(e,"PIP_CHANGE",(function(){return nt})),n.d(e,"PLAY",(function(){return r})),n.d(e,"PLAYER_BLUR",(function(){return P})),n.d(e,"PLAYER_FOCUS",(function(){return x})),n.d(e,"PLAYING",(function(){return o})),n.d(e,"PLAYNEXT",(function(){return ot})),n.d(e,"PROGRESS",(function(){return C})),n.d(e,"RATE_CHANGE",(function(){return L})),n.d(e,"READY",(function(){return M})),n.d(e,"REPLAY",(function(){return B})),n.d(e,"RESET",(function(){return ht})),n.d(e,"RETRY",(function(){return et})),n.d(e,"ROTATE",(function(){return st})),n.d(e,"SCREEN_SHOT",(function(){return at})),n.d(e,"SEEKED",(function(){return f})),n.d(e,"SEEKING",(function(){return d})),n.d(e,"SEI_PARSED",(function(){return tt})),n.d(e,"SHORTCUT",(function(){return lt})),n.d(e,"SOURCE_ERROR",(function(){return ft})),n.d(e,"SOURCE_SUCCESS",(function(){return gt})),n.d(e,"STALLED",(function(){return O})),n.d(e,"STATS_EVENTS",(function(){return vt})),n.d(e,"SUSPEND",(function(){return R})),n.d(e,"SWITCH_SUBTITLE",(function(){return pt})),n.d(e,"TIME_UPDATE",(function(){return m})),n.d(e,"URL_CHANGE",(function(){return H})),n.d(e,"URL_NULL",(function(){return F})),n.d(e,"USER_ACTION",(function(){return ut})),n.d(e,"VIDEO_EVENTS",(function(){return mt})),n.d(e,"VIDEO_RESIZE",(function(){return it})),n.d(e,"VOLUME_CHANGE",(function(){return k})),n.d(e,"WAITING",(function(){return v})),n.d(e,"XGLOG",(function(){return ct}));var r="play",o="playing",l="ended",c="pause",h="error",d="seeking",f="seeked",m="timeupdate",v="waiting",y="canplay",T="canplaythrough",E="durationchange",k="volumechange",S="loadeddata",_="loadedmetadata",L="ratechange",C="progress",A="loadstart",w="emptied",O="stalled",R="suspend",D="abort",I="bufferedChange",x="focus",P="blur",M="ready",F="urlNull",N="autoplay_started",j="autoplay_was_prevented",U="complete",B="replay",$="destroy",H="urlchange",G="download_speed_change",K="leaveplayer",V="enterplayer",W="loading",Y="fullscreen_change",z="cssFullscreen_change",X="mini_state_change",Q="definition_change",J="before_definition_change",Z="after_definition_change",tt="SEI_PARSED",et="retry",it="video_resize",nt="pip_change",st="rotate",at="screenShot",ot="playnext",lt="shortcut",ct="xglog",ut="user_action",ht="reset",ft="source_error",gt="source_success",pt="switch_subtitle",mt=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","loadedmetadata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"],vt={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},yt="fps_stuck"},3378:function(t,e,n){var r=n(3409),o=n(3411),l=n(3360),c=n(3379),h=n(3380),d=n(3383),f=n(3403),m=n(3384),v=n(3385),y=n(3416),T=n(3386),E=n(3361),k=n(3387),S=n(3388),_=n(3393),L=n(3400),C=n(3410),A=n(3394),w=n(3370),O=n(3396),R=n(3374),D=n(3356),I="[object Arguments]",x="[object Function]",P="[object Object]",M={};M[I]=M["[object Array]"]=M["[object ArrayBuffer]"]=M["[object DataView]"]=M["[object Boolean]"]=M["[object Date]"]=M["[object Float32Array]"]=M["[object Float64Array]"]=M["[object Int8Array]"]=M["[object Int16Array]"]=M["[object Int32Array]"]=M["[object Map]"]=M["[object Number]"]=M[P]=M["[object RegExp]"]=M["[object Set]"]=M["[object String]"]=M["[object Symbol]"]=M["[object Uint8Array]"]=M["[object Uint8ClampedArray]"]=M["[object Uint16Array]"]=M["[object Uint32Array]"]=!0,M["[object Error]"]=M[x]=M["[object WeakMap]"]=!1,t.exports=function t(e,n,F,N,object,j){var U,B=1&n,$=2&n,H=4&n;if(F&&(U=object?F(e,N,object,j):F(e)),void 0!==U)return U;if(!w(e))return e;var G=L(e);if(G){if(U=k(e),!B)return f(e,U)}else{var K=E(e),V=K==x||"[object GeneratorFunction]"==K;if(C(e))return d(e,B);if(K==P||K==I||V&&!object){if(U=$||V?{}:_(e),!B)return $?v(e,h(U,e)):m(e,c(U,e))}else{if(!M[K])return object?e:{};U=S(e,K,B)}}j||(j=new r);var W=j.get(e);if(W)return W;j.set(e,U),O(e)?e.forEach((function(r){U.add(t(r,n,F,r,e,j))})):A(e)&&e.forEach((function(r,o){U.set(o,t(r,n,F,o,e,j))}));var Y=G?void 0:(H?$?T:y:$?D:R)(e);return o(Y||e,(function(r,o){Y&&(r=e[o=r]),l(U,o,t(r,n,F,o,e,j))})),U}},3379:function(t,e,n){var r=n(3355),o=n(3374);t.exports=function(object,source){return object&&r(source,o(source),object)}},3380:function(t,e,n){var r=n(3355),o=n(3356);t.exports=function(object,source){return object&&r(source,o(source),object)}},3381:function(t,e,n){var r=n(3370),o=n(3376),l=n(3382),c=Object.prototype.hasOwnProperty;t.exports=function(object){if(!r(object))return l(object);var t=o(object),e=[];for(var n in object)("constructor"!=n||!t&&c.call(object,n))&&e.push(n);return e}},3382:function(t,e){t.exports=function(object){var t=[];if(null!=object)for(var e in Object(object))t.push(e);return t}},3383:function(t,e,n){(function(t){var r=n(3399),o=e&&!e.nodeType&&e,l=o&&"object"==typeof t&&t&&!t.nodeType&&t,c=l&&l.exports===o?r.Buffer:void 0,h=c?c.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=h?h(n):new t.constructor(n);return t.copy(r),r}}).call(this,n(1927)(t))},3384:function(t,e,n){var r=n(3355),o=n(3377);t.exports=function(source,object){return r(source,o(source),object)}},3385:function(t,e,n){var r=n(3355),o=n(3363);t.exports=function(source,object){return r(source,o(source),object)}},3386:function(t,e,n){var r=n(3417),o=n(3363),l=n(3356);t.exports=function(object){return r(object,l,o)}},3387:function(t,e){var n=Object.prototype.hasOwnProperty;t.exports=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&n.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},3388:function(t,e,n){var r=n(3357),o=n(3389),l=n(3390),c=n(3391),h=n(3392);t.exports=function(object,t,e){var n=object.constructor;switch(t){case"[object ArrayBuffer]":return r(object);case"[object Boolean]":case"[object Date]":return new n(+object);case"[object DataView]":return o(object,e);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return h(object,e);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(object);case"[object RegExp]":return l(object);case"[object Symbol]":return c(object)}}},3389:function(t,e,n){var r=n(3357);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},3390:function(t,e){var n=/\w*$/;t.exports=function(t){var e=new t.constructor(t.source,n.exec(t));return e.lastIndex=t.lastIndex,e}},3391:function(t,e,n){var r=n(3402),o=r?r.prototype:void 0,l=o?o.valueOf:void 0;t.exports=function(symbol){return l?Object(l.call(symbol)):{}}},3392:function(t,e,n){var r=n(3357);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},3393:function(t,e,n){var r=n(3408),o=n(3364),l=n(3376);t.exports=function(object){return"function"!=typeof object.constructor||l(object)?{}:r(o(object))}},3394:function(t,e,n){var r=n(3395),o=n(3373),l=n(3375),c=l&&l.isMap,h=c?o(c):r;t.exports=h},3395:function(t,e,n){var r=n(3361),o=n(3371);t.exports=function(t){return o(t)&&"[object Map]"==r(t)}},3396:function(t,e,n){var r=n(3397),o=n(3373),l=n(3375),c=l&&l.isSet,h=c?o(c):r;t.exports=h},3397:function(t,e,n){var r=n(3361),o=n(3371);t.exports=function(t){return o(t)&&"[object Set]"==r(t)}},3421:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=/(Android)\s([\d.]+)/,o=/(Version)\/([\d.]+)/,l=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],c={get device(){return c.os.isPc?"pc":"mobile"},get browser(){if("undefined"==typeof navigator)return"";var t=navigator.userAgent.toLowerCase(),e={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(e).filter((function(n){return e[n].test(t)})))[0]},get os(){if("undefined"==typeof navigator)return{};var t=navigator.userAgent,e=/(?:Windows Phone)/.test(t),n=/(?:SymbianOS)/.test(t)||e,r=/(?:Android)/.test(t),o=/(?:Firefox)/.test(t),l=/(?:iPad|PlayBook)/.test(t)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,c=l||r&&!/(?:Mobile)/.test(t)||o&&/(?:Tablet)/.test(t),h=/(?:iPhone)/.test(t)&&!c;return{isTablet:c,isPhone:h,isIpad:l,isIos:h||l,isAndroid:r,isPc:!(h||r||n||c),isSymbian:n,isWindowsPhone:e,isFireFox:o}},get osVersion(){if("undefined"==typeof navigator)return 0;var t=navigator.userAgent,e="",n=(e=/(?:iPhone)|(?:iPad|PlayBook)/.test(t)?o:r)?e.exec(t):[];if(n&&n.length>=3){var l=n[2].split(".");return l.length>0?parseInt(l[0]):0}return 0},get isWeixin(){if("undefined"==typeof navigator)return!1;return!!/(micromessenger)\/([\d.]+)/.exec(navigator.userAgent.toLocaleLowerCase())},isSupportMP4:function(){var t={isSupport:!1,mime:""};if("undefined"==typeof document)return t;if(this.supportResult)return this.supportResult;var a=document.createElement("video");return"function"==typeof a.canPlayType&&l.map((function(e){"probably"===a.canPlayType('video/mp4; codecs="'.concat(e,'"'))&&(t.isSupport=!0,t.mime+="||".concat(e))})),this.supportResult=t,a=null,t},isMSESupport:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if("undefined"==typeof MediaSource||!MediaSource)return!1;try{return MediaSource.isTypeSupported(t)}catch(e){return this._logger.error(t,e),!1}},isHevcSupported:function(){return!("undefined"==typeof MediaSource||!MediaSource.isTypeSupported)&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))},probeConfigSupported:function(t){var e={supported:!1,smooth:!1,powerEfficient:!1};if(!t||"undefined"==typeof navigator)return Promise.resolve(e);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(t);var n=t.video||{},r=t.audio||{};try{var o=MediaSource.isTypeSupported(n.contentType),l=MediaSource.isTypeSupported(r.contentType);return Promise.resolve({supported:o&&l,smooth:!1,powerEfficient:!1})}catch(t){return Promise.resolve(e)}}}},3437:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var r=n(3358),o=n(3359),l=n(3368),c=n(3492);function h(t,e){l.b.logError("[".concat(t,"] event or callback cant be undefined or null when call ").concat(e))}var d=function(){function t(e){Object(r.b)(this,t),o.b.checkIsFunction(this.beforeCreate)&&this.beforeCreate(e),Object(c.a)(this),this.__args=e,this.__events={},this.__onceEvents={},this.config=e.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(e)}return Object(r.c)(t,[{key:"beforeCreate",value:function(t){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(t){this.player=t.player,this.playerConfig=t.player&&t.player.config,this.pluginName=t.pluginName?t.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=t.player&&t.player.logger}},{key:"updateLang",value:function(t){t||(t=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var t=o.b.checkTouchSupport()?"touch":"mouse";return!this.playerConfig||"touch"!==this.playerConfig.domEventType&&"mouse"!==this.playerConfig.domEventType||(t=this.playerConfig.domEventType),t}},{key:"on",value:function(t,e){var n=this;t&&e&&this.player?"string"==typeof t?(this.__events[t]=e,this.player.on(t,e)):Array.isArray(t)&&t.forEach((function(t){n.__events[t]=e,n.player.on(t,e)})):h(this.pluginName,"plugin.on(event, callback)")}},{key:"once",value:function(t,e){var n=this;t&&e&&this.player?"string"==typeof t?(this.__onceEvents[t]=e,this.player.once(t,e)):Array.isArray(t)&&t.forEach((function(r){n.__onceEvents[r]=e,n.player.once(t,e)})):h(this.pluginName,"plugin.once(event, callback)")}},{key:"off",value:function(t,e){var n=this;t&&e&&this.player?"string"==typeof t?(delete this.__events[t],this.player.off(t,e)):Array.isArray(t)&&t.forEach((function(r){delete n.__events[t],n.player.off(r,e)})):h(this.pluginName,"plugin.off(event, callback)")}},{key:"offAll",value:function(){var t=this;["__events","__onceEvents"].forEach((function(e){Object.keys(t[e]).forEach((function(n){t[e][n]&&t.off(n,t[e][n]),n&&delete t[e][n]}))})),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(t){var e;if(this.player){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(e=this.player).emit.apply(e,[t].concat(r))}}},{key:"emitUserAction",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.player){var o=Object(r.i)(Object(r.i)({},n),{},{pluginName:this.pluginName});this.player.emitUserAction(t,e,o)}}},{key:"hook",value:function(t,e){return c.c.call.apply(c.c,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return c.g.call.apply(c.g,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return c.d.call.apply(c.d,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.player)return n&&(e.pluginName=n),this.player.registerPlugin({plugin:t,options:e})}},{key:"getPlugin",value:function(t){return this.player?this.player.getPlugin(t):null}},{key:"__destroy",value:function(){var t=this,e=this.player,n=this.pluginName;this.offAll(),o.b.clearAllTimers(this),o.b.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map((function(e){t[e]=null})),e.unRegisterPlugin(n),Object(c.b)(this)}}],[{key:"defineGetterOrSetter",value:function(t,map){for(var e in map)Object.prototype.hasOwnProperty.call(map,e)&&Object.defineProperty(t,e,map[e])}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),t}()},3445:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r={DEFAULT:"xgplayer",DEFAULT_SKIN:"xgplayer-skin-default",ENTER:"xgplayer-is-enter",PAUSED:"xgplayer-pause",PLAYING:"xgplayer-playing",ENDED:"xgplayer-ended",CANPLAY:"xgplayer-canplay",LOADING:"xgplayer-isloading",ERROR:"xgplayer-is-error",REPLAY:"xgplayer-replay",NO_START:"xgplayer-nostart",ACTIVE:"xgplayer-active",INACTIVE:"xgplayer-inactive",FULLSCREEN:"xgplayer-is-fullscreen",CSS_FULLSCREEN:"xgplayer-is-cssfullscreen",ROTATE_FULLSCREEN:"xgplayer-rotate-fullscreen",PARENT_ROTATE_FULLSCREEN:"xgplayer-rotate-parent",PARENT_FULLSCREEN:"xgplayer-fullscreen-parent",INNER_FULLSCREEN:"xgplayer-fullscreen-inner",NO_CONTROLS:"no-controls",FLEX_CONTROLS:"flex-controls",CONTROLS_FOLLOW:"controls-follow",CONTROLS_AUTOHIDE:"controls-autohide",TOP_BAR_AUTOHIDE:"top-bar-autohide",NOT_ALLOW_AUTOPLAY:"not-allow-autoplay",SEEKING:"seeking",PC:"xgplayer-pc",MOBILE:"xgplayer-mobile",MINI:"xgplayer-mini"}},3450:function(t,e,n){var r=n(3682);function o(element,t,e,n,r){var o=l.apply(this,arguments);return element.addEventListener(e,o,r),{destroy:function(){element.removeEventListener(e,o,r)}}}function l(element,t,e,n){return function(e){e.delegateTarget=r(e.target,t),e.delegateTarget&&n.call(element,e)}}t.exports=function(t,e,n,r,l){return"function"==typeof t.addEventListener?o.apply(null,arguments):"function"==typeof n?o.bind(null,document).apply(null,arguments):("string"==typeof t&&(t=document.querySelectorAll(t)),Array.prototype.map.call(t,(function(element){return o(element,e,n,r,l)})))}},3451:function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return d}));var r=n(3358),o=n(3572),l=n(3359),c={1:"media",2:"media",3:"media",4:"media",5:"media",6:"media"},h={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106},d=Object(r.c)((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};Object(r.b)(this,t);var c=e&&e.i18n?e.i18n.ERROR_TYPES:null;if(e.media){var d=n.mediaError?n.mediaError:e.media.error||{},f=e.duration,m=e.currentTime,v=e.ended,y=e.src,T=e.currentSrc,E=e.media,k=E.readyState,S=E.networkState,_=n.errorCode||d.code;h[_]&&(_=h[_]);var L={playerVersion:o.a,currentTime:m,duration:f,ended:v,readyState:k,networkState:S,src:y||T,errorType:n.errorType,errorCode:_,message:n.errorMessage||d.message,mediaError:d,originError:n.originError?n.originError.stack:"",host:l.b.getHostFromUrl(y||T)};return n.ext&&Object.keys(n.ext).map((function(t){L[t]=n.ext[t]})),L}if(arguments.length>1){for(var C={playerVersion:o.a,domain:document.domain},A=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],i=0;i<arguments.length;i++)C[A[i]]=arguments[i];return C.ex=c?(c[arguments[0]]||{}).msg:"",C}}))},3455:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var r=n(3358),o=n(3359),l={lang:{},langKeys:[],textKeys:[]};function c(t,e){return Object.keys(e).forEach((function(n){var l,h=o.b.typeOf(e[n]),d=o.b.typeOf(t[n]);"Array"===h?("Array"!==d&&(t[n]=[]),(l=t[n]).push.apply(l,Object(r.k)(e[n]))):"Object"===h?("Object"!==d&&(t[n]={}),c(t[n],e[n])):t[n]=e[n]})),t}function h(){Object.keys(l.lang.en).map((function(t){l.textKeys[t]=t}))}function use(t,e){var n=t.LANG;if(e||(e=l),e.lang){var r=t.TEXT||{};"zh"===n&&(n="zh-cn"),e.lang[n]?c(e.lang[n],r):(e.langKeys.push(n),e.lang[n]=r),h()}}use({LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}});var d={get textKeys(){return l.textKeys},get langKeys(){return l.langKeys},get lang(){var t={};return l.langKeys.map((function(e){t[e]=l.lang[e]})),l.lang["zh-cn"]&&(t.zh=l.lang["zh-cn"]||{}),t},extend:function(t,e){var n=[];if(e||(e=l),e.lang){n="Array"!==o.b.typeOf(t)?Object.keys(t).map((function(e){return{LANG:"zh"===e?"zh-cn":e,TEXT:t[e]}})):t;var r=e.lang;n.map((function(t){"zh"===t.LANG&&(t.LANG="zh-cn"),r[t.LANG]?c(r[t.LANG]||{},t.TEXT||{}):use(t,e)})),h()}},use:use,init:function(t){var e,n={lang:{},langKeys:[],textKeys:{},pId:t};return c(n.lang,l.lang),(e=n.langKeys).push.apply(e,Object(r.k)(l.langKeys)),c(n.textKeys,l.textKeys),n}}},3463:function(t,e,n){"use strict";var r=n(46),o=n(180),l=n(278),c=n(3681),h=n(724),d=n(111),f=n(100),m=n(223),v=n(62),y=o("Reflect","construct"),T=Object.prototype,E=[].push,k=v((function(){function t(){}return!(y((function(){}),[],t)instanceof t)})),S=!v((function(){y((function(){}))})),_=k||S;r({target:"Reflect",stat:!0,forced:_,sham:_},{construct:function(t,e){h(t),d(e);var n=arguments.length<3?t:h(arguments[2]);if(S&&!k)return y(t,e,n);if(t===n){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var r=[null];return l(E,r,e),new(l(c,t,r))}var o=n.prototype,v=m(f(o)?o:T),_=l(t,v,e);return f(_)?_:v}})},3476:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o}));var r={INITIAL:1,READY:2,ATTACHING:3,ATTACHED:4,NOTALLOW:5,RUNNING:6,ENDED:7,DESTROYED:8},o=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"]},3492:function(t,e,n){"use strict";n.d(e,"a",(function(){return m})),n.d(e,"b",(function(){return v})),n.d(e,"c",(function(){return l})),n.d(e,"d",(function(){return h})),n.d(e,"e",(function(){return f})),n.d(e,"f",(function(){return y})),n.d(e,"g",(function(){return c})),n.d(e,"h",(function(){return d}));var r=n(3358);function o(t,e,n){for(var r=arguments.length,o=new Array(r>3?r-3:0),l=3;l<r;l++)o[l-3]=arguments[l];var c=e.call.apply(e,[t].concat(o));n&&"function"==typeof n&&(c&&c.then?c.then((function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];n.call.apply(n,[t].concat(r))})):n.call.apply(n,[t].concat(o)))}function l(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[t]&&(this.__hooks[t]=null),function(){var l=arguments,c=this;if(n.pre)try{var h;(h=n.pre).call.apply(h,[this].concat(Array.prototype.slice.call(arguments)))}catch(e){throw e.message="[pluginName: ".concat(this.pluginName,":").concat(t,":pre error] >> ").concat(e.message),e}if(this.__hooks&&this.__hooks[t])try{var d,f=(d=this.__hooks[t]).call.apply(d,[this,this].concat(Array.prototype.slice.call(arguments)));f?f.then?f.then((function(t){!1!==t&&o.apply(void 0,[c,e,n.next].concat(Object(r.k)(l)))})).catch((function(t){throw t})):o.apply(void 0,[this,e,n.next].concat(Array.prototype.slice.call(arguments))):void 0===f&&o.apply(void 0,[this,e,n.next].concat(Array.prototype.slice.call(arguments)))}catch(e){throw e.message="[pluginName: ".concat(this.pluginName,":").concat(t,"] >> ").concat(e.message),e}else o.apply(void 0,[this,e,n.next].concat(Array.prototype.slice.call(arguments)))}.bind(this)}function c(t,e){var n=this.__hooks;if(n)return n.hasOwnProperty(t)?(n&&(n[t]=e),!0):(console.warn("has no supported hook which name [".concat(t,"]")),!1)}function h(t,e){var n=this.__hooks;n&&delete n[t]}function d(t){if(this.plugins&&this.plugins[t.toLowerCase()]){for(var e=this.plugins[t.toLowerCase()],n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return e.useHooks&&e.useHooks.apply(e,r)}}function f(t){if(this.plugins&&this.plugins[t.toLowerCase()]){var e=this.plugins[t.toLowerCase()];if(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return e.removeHooks&&e.removeHooks.apply(e,r)}}}function m(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.__hooks={},e&&e.map((function(e){t.__hooks[e]=null})),Object.defineProperty(t,"hooks",{get:function(){return t.__hooks&&Object.keys(t.__hooks).map((function(e){if(t.__hooks[e])return e}))}})}function v(t){t.__hooks=null}function y(t,e,n){for(var r=arguments.length,o=new Array(r>3?r-3:0),l=3;l<r;l++)o[l-3]=arguments[l];if(!t.__hooks||!t.__hooks[e])return n.call.apply(n,[t,t].concat(o));var c,h=(c=t.__hooks[e]).call.apply(c,[t,t].concat(o));if(h&&h.then)h.then((function(data){return!1===data?null:n.call.apply(n,[t,t].concat(o))})).catch((function(t){console.warn("[runHooks]".concat(e," reject"),t.message)}));else if(!1!==h)return n.call.apply(n,[t,t].concat(o))}},3493:function(t,e,n){"use strict";function r(t){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}n.d(e,"a",(function(){return r}))},3494:function(t,e,n){"use strict";n.d(e,"a",(function(){return h})),n.d(e,"b",(function(){return d}));var r=n(3358),o=n(3520),l={},c=null,h=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"add",value:function(t){t&&(l[t.playerId]=t,1===Object.keys(l).length&&this.setActive(t.playerId,!0))}},{key:"remove",value:function(t){t&&(t.isUserActive,delete l[t.playerId])}},{key:"_iterate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var n in l)if(Object.prototype.hasOwnProperty.call(l,n)){var r=l[n];if(e){if(t(r))break}else t(r)}}},{key:"forEach",value:function(t){this._iterate(t)}},{key:"find",value:function(t){var e=null;return this._iterate((function(n){var r=t(n);return r&&(e=n),r}),!0),e}},{key:"findAll",value:function(t){var e=[];return this._iterate((function(n){t(n)&&e.push(n)})),e}},{key:"setActive",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(l[t])return e?this.forEach((function(e){t===e.playerId?(e.isUserActive=!0,e.isInstNext=!1):e.isUserActive=!1})):l[t].isUserActive=e,t}},{key:"getActiveId",value:function(){for(var t=Object.keys(l),i=0;i<t.length;i++){var e=l[t[i]];if(e&&e.isUserActive)return t[i]}return null}},{key:"setNext",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(l[t])return e?this.forEach((function(e){t===e.playerId?(e.isUserActive=!1,e.isInstNext=!0):e.isInstNext=!1})):l[t].isInstNext=e,t}}],[{key:"getInstance",value:function(){return c||(c=new n),c}}]),n}(o.EventEmitter);function d(t){for(var e=Object.keys(l),i=0;i<e.length;i++){var p=l[e[i]];if(p.root===t)return p}return null}},35:function(t,e,n){var r=n(3378);t.exports=function(t){return r(t,5)}},3502:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(69);function o(t,e){if(e&&("object"==Object(r.a)(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}},3503:function(t,e,n){"use strict";function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&r(t,e)}n.d(e,"a",(function(){return o}))},3518:function(t,e,n){"use strict";function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}n.d(e,"a",(function(){return io}));var o,l,c,h,d,f={exports:{}};o=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,l=/^(?=([^\/?#]*))\1([^]*)$/,c=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,f.exports=d={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),!(e=e.trim())){if(!n.alwaysNormalize)return t;var r=d.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return r.path=d.normalizePath(r.path),d.buildURLFromParts(r)}var o=d.parseURL(e);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=d.normalizePath(o.path),d.buildURLFromParts(o)):e;var c=d.parseURL(t);if(!c)throw new Error("Error trying to parse base URL.");if(!c.netLoc&&c.path&&"/"!==c.path[0]){var h=l.exec(c.path);c.netLoc=h[1],c.path=h[2]}c.netLoc&&!c.path&&(c.path="/");var f={scheme:c.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(f.netLoc=c.netLoc,"/"!==o.path[0]))if(o.path){var m=c.path,v=m.substring(0,m.lastIndexOf("/")+1)+o.path;f.path=d.normalizePath(v)}else f.path=c.path,o.params||(f.params=c.params,o.query||(f.query=c.query));return null===f.path&&(f.path=n.alwaysNormalize?d.normalizePath(o.path):o.path),d.buildURLFromParts(f)},parseURL:function(t){var e=o.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(path){for(path=path.split("").reverse().join("").replace(c,"");path.length!==(path=path.replace(h,"")).length;);return path.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};var m=f.exports;function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){E(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function T(t){var i=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:String(i)}function E(t,e,n){return(e=T(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function k(){return k=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var e in source)Object.prototype.hasOwnProperty.call(source,e)&&(t[e]=source[e])}return t},k.apply(this,arguments)}const S=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},_=Number.isSafeInteger||function(t){return"number"==typeof t&&Math.abs(t)<=L},L=Number.MAX_SAFE_INTEGER||9007199254740991;let C=function(t){return t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached",t.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",t}({}),A=function(t){return t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",t}({}),w=function(t){return t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",t.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",t.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",t.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_PARSING_ERROR="levelParsingError",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.FRAG_GAP="fragGap",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.UNKNOWN="unknown",t}({});const O=function(){},R={trace:O,debug:O,log:O,warn:O,info:O,error:O};let D=R;function I(t,...e){e.forEach((function(e){D[e]=t[e]?t[e].bind(t):function(t){const e=self.console[t];return e?e.bind(self.console,`[${t}] >`):O}(e)}))}const x=D,P=/^(\d+)x(\d+)$/,M=/(.+?)=(".*?"|.*?)(?:,|$)/g;class F{constructor(t){"string"==typeof t&&(t=F.parseAttrList(t)),k(this,t)}get clientAttrs(){return Object.keys(this).filter((t=>"X-"===t.substring(0,2)))}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;const n=new Uint8Array(e.length/2);for(let i=0;i<e.length/2;i++)n[i]=parseInt(e.slice(2*i,2*i+2),16);return n}return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const n=this[t];return n?parseFloat(n):e}enumeratedString(t){return this[t]}bool(t){return"YES"===this[t]}decimalResolution(t){const e=P.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(input){let t;const e={};for(M.lastIndex=0;null!==(t=M.exec(input));){let n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1));e[t[1].trim()]=n}return e}}function N(t){return"SCTE35-OUT"===t||"SCTE35-IN"===t}class j{constructor(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){const n=e.attr;for(const e in n)if(Object.prototype.hasOwnProperty.call(t,e)&&t[e]!==n[e]){x.warn(`DATERANGE tag attribute: "${e}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=e;break}t=k(new F({}),n,t)}if(this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const t=new Date(this.attr["END-DATE"]);S(t.getTime())&&(this._endDate=t)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const t=this.duration;return null!==t?new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(S(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&S(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class U{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var B="audio",$="video",H="audiovideo";class G{constructor(t){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[B]:null,[$]:null,[H]:null},this.baseurl=t}setByteRange(t,e){const n=t.split("@",2);let r;r=1===n.length?(null==e?void 0:e.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=m.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}}class K extends G{constructor(t,e){super(e),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new U,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=t}get decryptdata(){const{levelkeys:t}=this;if(!t&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const t=Object.keys(this.levelkeys);if(1===t.length)return this._decryptdata=this.levelkeys[t[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;if(!S(this.programDateTime))return null;const t=S(this.duration)?this.duration:0;return this.programDateTime+1e3*t}get encrypted(){var t;if(null!=(t=this._decryptdata)&&t.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),e=t.length;if(e>1||1===e&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(t){if(this.levelkeys){const e=this.levelkeys[t];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}}abortRequests(){var t,e;null==(t=this.loader)||t.abort(),null==(e=this.keyLoader)||e.abort()}setElementaryStreamInfo(t,e,n,r,o,l=!1){const{elementaryStreams:c}=this,h=c[t];h?(h.startPTS=Math.min(h.startPTS,e),h.endPTS=Math.max(h.endPTS,n),h.startDTS=Math.min(h.startDTS,r),h.endDTS=Math.max(h.endDTS,o)):c[t]={startPTS:e,endPTS:n,startDTS:r,endDTS:o,partial:l}}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[B]=null,t[$]=null,t[H]=null}}class V extends G{constructor(t,e,n,r,o){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new U,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=r;const l=t.enumeratedString("BYTERANGE");l&&this.setByteRange(l,o),o&&(this.fragOffset=o.fragOffset+o.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}class W{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t)return this.advanced=!0,void(this.updated=!0);const e=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||0===e&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&S(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const t=this.driftEndTime-this.driftStartTime;if(t>0){return 1e3*(this.driftEnd-this.driftStart)/t}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var t;return null!=(t=this.fragments)&&t.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function Y(t){return Uint8Array.from(atob(t),(t=>t.charCodeAt(0)))}function z(t){const e=t.split(":");let n=null;if("data"===e[0]&&2===e.length){const t=e[1].split(";"),r=t[t.length-1].split(",");if(2===r.length){const e="base64"===r[0],data=r[1];e?(t.splice(-1,1),n=Y(data)):n=function(t){const e=X(t).subarray(0,16),n=new Uint8Array(16);return n.set(e,16-e.length),n}(data)}}return n}function X(t){return Uint8Array.from(unescape(encodeURIComponent(t)),(t=>t.charCodeAt(0)))}const Q="undefined"!=typeof self?self:void 0;var J={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Z="org.w3.clearkey",tt="com.apple.streamingkeydelivery",et="com.microsoft.playready",it="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function nt(t){switch(t){case tt:return J.FAIRPLAY;case et:return J.PLAYREADY;case it:return J.WIDEVINE;case Z:return J.CLEARKEY}}var st="edef8ba979d64acea3c827dcd51d21ed";function at(t){switch(t){case J.FAIRPLAY:return tt;case J.PLAYREADY:return et;case J.WIDEVINE:return it;case J.CLEARKEY:return Z}}function ot(t){const{drmSystems:e,widevineLicenseUrl:n}=t,r=e?[J.FAIRPLAY,J.WIDEVINE,J.PLAYREADY,J.CLEARKEY].filter((t=>!!e[t])):[];return!r[J.WIDEVINE]&&n&&r.push(J.WIDEVINE),r}const lt=null!=Q&&null!=(ct=Q.navigator)&&ct.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var ct;function ut(t,e,n){return Uint8Array.prototype.slice?t.slice(e,n):new Uint8Array(Array.prototype.slice.call(t,e,n))}const ht=(data,t)=>t+10<=data.length&&73===data[t]&&68===data[t+1]&&51===data[t+2]&&data[t+3]<255&&data[t+4]<255&&data[t+6]<128&&data[t+7]<128&&data[t+8]<128&&data[t+9]<128,ft=(data,t)=>t+10<=data.length&&51===data[t]&&68===data[t+1]&&73===data[t+2]&&data[t+3]<255&&data[t+4]<255&&data[t+6]<128&&data[t+7]<128&&data[t+8]<128&&data[t+9]<128,gt=(data,t)=>{const e=t;let n=0;for(;ht(data,t);){n+=10;n+=pt(data,t+6),ft(data,t+10)&&(n+=10),t+=n}if(n>0)return data.subarray(e,e+n)},pt=(data,t)=>{let e=0;return e=(127&data[t])<<21,e|=(127&data[t+1])<<14,e|=(127&data[t+2])<<7,e|=127&data[t+3],e},mt=(data,t)=>ht(data,t)&&pt(data,t+6)+10<=data.length-t,vt=data=>{const t=Tt(data);for(let i=0;i<t.length;i++){const e=t[i];if(yt(e))return Lt(e)}},yt=t=>t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info,bt=data=>{const t=String.fromCharCode(data[0],data[1],data[2],data[3]),e=pt(data,4);return{type:t,size:e,data:data.subarray(10,10+e)}},Tt=t=>{let e=0;const n=[];for(;ht(t,e);){const r=pt(t,e+6);e+=10;const o=e+r;for(;e+8<o;){const r=bt(t.subarray(e)),o=Et(r);o&&n.push(o),e+=r.size+10}ft(t,e)&&(e+=10)}return n},Et=t=>"PRIV"===t.type?kt(t):"W"===t.type[0]?_t(t):St(t),kt=t=>{if(t.size<2)return;const e=Ct(t.data,!0),n=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:n.buffer}},St=t=>{if(t.size<2)return;if("TXXX"===t.type){let e=1;const n=Ct(t.data.subarray(e),!0);e+=n.length+1;const r=Ct(t.data.subarray(e));return{key:t.type,info:n,data:r}}const text=Ct(t.data.subarray(1));return{key:t.type,data:text}},_t=t=>{if("WXXX"===t.type){if(t.size<2)return;let e=1;const n=Ct(t.data.subarray(e),!0);e+=n.length+1;const r=Ct(t.data.subarray(e));return{key:t.type,info:n,data:r}}const e=Ct(t.data);return{key:t.type,data:e}},Lt=t=>{if(8===t.data.byteLength){const data=new Uint8Array(t.data),e=1&data[3];let n=(data[4]<<23)+(data[5]<<15)+(data[6]<<7)+data[7];return n/=45,e&&(n+=47721858.84),Math.round(n)}},Ct=(t,e=!1)=>{const n=wt();if(n){const r=n.decode(t);if(e){const t=r.indexOf("\0");return-1!==t?r.substring(0,t):r}return r.replace(/\0/g,"")}const r=t.length;let o,l,c,h="",i=0;for(;i<r;){if(o=t[i++],0===o&&e)return h;if(0!==o&&3!==o)switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:h+=String.fromCharCode(o);break;case 12:case 13:l=t[i++],h+=String.fromCharCode((31&o)<<6|63&l);break;case 14:l=t[i++],c=t[i++],h+=String.fromCharCode((15&o)<<12|(63&l)<<6|63&c)}}return h};let At;function wt(){if(!navigator.userAgent.includes("PlayStation 4"))return At||void 0===self.TextDecoder||(At=new self.TextDecoder("utf-8")),At}const Ot=function(t){let e="";for(let i=0;i<t.length;i++){let n=t[i].toString(16);n.length<2&&(n="0"+n),e+=n}return e},Rt=Math.pow(2,32)-1,Dt=[].push,It={video:1,audio:2,id3:3,text:4};function xt(data){return String.fromCharCode.apply(null,data)}function Pt(t,e){const n=t[e]<<8|t[e+1];return n<0?65536+n:n}function Mt(t,e){const n=Nt(t,e);return n<0?4294967296+n:n}function Ft(t,e){let n=Mt(t,e);return n*=Math.pow(2,32),n+=Mt(t,e+4),n}function Nt(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function jt(t,e,n){t[e]=n>>24,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n}function Ut(data,path){const t=[];if(!path.length)return t;const e=data.byteLength;for(let i=0;i<e;){const n=Mt(data,i),r=n>1?i+n:e;if(xt(data.subarray(i+4,i+8))===path[0])if(1===path.length)t.push(data.subarray(i+8,r));else{const e=Ut(data.subarray(i+8,r),path.slice(1));e.length&&Dt.apply(t,e)}i=r}return t}function Bt(t){const e=[],n=t[0];let r=8;const o=Mt(t,r);r+=4;let l=0,c=0;0===n?(l=Mt(t,r),c=Mt(t,r+4),r+=8):(l=Ft(t,r),c=Ft(t,r+8),r+=16),r+=2;let h=t.length+c;const d=Pt(t,r);r+=2;for(let i=0;i<d;i++){let n=r;const l=Mt(t,n);n+=4;const c=2147483647&l;if(1===(2147483648&l)>>>31)return x.warn("SIDX has hierarchical references (not supported)"),null;const d=Mt(t,n);n+=4,e.push({referenceSize:c,subsegmentDuration:d,info:{duration:d/o,start:h,end:h+c-1}}),h+=c,n+=4,r=n}return{earliestPresentationTime:l,timescale:o,version:n,referencesCount:d,references:e}}function $t(t){const e=[],n=Ut(t,["moov","trak"]);for(let i=0;i<n.length;i++){const t=n[i],r=Ut(t,["tkhd"])[0];if(r){let n=r[0];const o=Mt(r,0===n?12:20),l=Ut(t,["mdia","mdhd"])[0];if(l){n=l[0];const r=Mt(l,0===n?12:20),c=Ut(t,["mdia","hdlr"])[0];if(c){const n=xt(c.subarray(8,12)),l={soun:B,vide:$}[n];if(l){const n=Ht(Ut(t,["mdia","minf","stbl","stsd"])[0]);e[o]={timescale:r,type:l},e[l]=y({timescale:r,id:o},n)}}}}}return Ut(t,["moov","mvex","trex"]).forEach((t=>{const n=Mt(t,4),track=e[n];track&&(track.default={duration:Mt(t,12),flags:Mt(t,20)})})),e}function Ht(t){const e=t.subarray(8),n=e.subarray(86),r=xt(e.subarray(4,8));let o=r;const l="enca"===r||"encv"===r;if(l){const t=Ut(e,[r])[0];Ut(t.subarray("enca"===r?28:78),["sinf"]).forEach((t=>{const e=Ut(t,["schm"])[0];if(e){const n=xt(e.subarray(4,8));if("cbcs"===n||"cenc"===n){const e=Ut(t,["frma"])[0];e&&(o=xt(e))}}}))}switch(o){case"avc1":case"avc2":case"avc3":case"avc4":{const t=Ut(n,["avcC"])[0];o+="."+Kt(t[1])+Kt(t[2])+Kt(t[3]);break}case"mp4a":{const t=Ut(e,[r])[0],n=Ut(t.subarray(28),["esds"])[0];if(n&&n.length>12){let i=4;if(3!==n[i++])break;i=Gt(n,i),i+=2;const t=n[i++];if(128&t&&(i+=2),64&t&&(i+=n[i++]),4!==n[i++])break;i=Gt(n,i);const e=n[i++];if(64!==e)break;if(o+="."+Kt(e),i+=12,5!==n[i++])break;i=Gt(n,i);const r=n[i++];let l=(248&r)>>3;31===l&&(l+=1+((7&r)<<3)+((224&n[i])>>5)),o+="."+l}break}case"hvc1":case"hev1":{const t=Ut(n,["hvcC"])[0],e=t[1],r=["","A","B","C"][e>>6],l=31&e,c=Mt(t,2),h=(32&e)>>5?"H":"L",d=t[12],f=t.subarray(6,12);o+="."+r+l,o+="."+c.toString(16).toUpperCase(),o+="."+h+d;let m="";for(let i=f.length;i--;){const t=f[i];if(t||m){m="."+t.toString(16).toUpperCase()+m}}o+=m;break}case"dvh1":case"dvhe":{const t=Ut(n,["dvcC"])[0],e=t[2]>>1&127,r=t[2]<<5&32|t[3]>>3&31;o+="."+Vt(e)+"."+Vt(r);break}case"vp09":{const t=Ut(n,["vpcC"])[0],e=t[4],r=t[5],l=t[6]>>4&15;o+="."+Vt(e)+"."+Vt(r)+"."+Vt(l);break}case"av01":{const t=Ut(n,["av1C"])[0],e=t[1]>>>5,r=31&t[1],l=t[2]>>>7?"H":"M",c=(64&t[2])>>6,h=(32&t[2])>>5,d=2===e&&c?h?12:10:c?10:8,f=(16&t[2])>>4,m=(8&t[2])>>3,v=(4&t[2])>>2,y=3&t[2],T=1,E=1,k=1,S=0;o+="."+e+"."+Vt(r)+l+"."+Vt(d)+"."+f+"."+m+v+y+"."+Vt(T)+"."+Vt(E)+"."+Vt(k)+"."+S;break}}return{codec:o,encrypted:l}}function Gt(t,i){const e=i+5;for(;128&t[i++]&&i<e;);return i}function Kt(t){return("0"+t.toString(16).toUpperCase()).slice(-2)}function Vt(t){return(t<10?"0":"")+t}function Wt(t){const e=Ut(t,["schm"])[0];if(e){const n=xt(e.subarray(4,8));if("cbcs"===n||"cenc"===n)return Ut(t,["schi","tenc"])[0]}return x.error("[eme] missing 'schm' box"),null}function Yt(t){const e=Mt(t,0);let n=8;1&e&&(n+=4),4&e&&(n+=4);let r=0;const o=Mt(t,4);for(let i=0;i<o;i++){if(256&e){r+=Mt(t,n),n+=4}512&e&&(n+=4),1024&e&&(n+=4),2048&e&&(n+=4)}return r}function qt(t,e){const n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function zt(t,track){const e=[],n=track.samples,r=track.timescale,o=track.id;let l=!1;return Ut(n,["moof"]).map((c=>{const h=c.byteOffset-8;Ut(c,["traf"]).map((c=>{const d=Ut(c,["tfdt"]).map((t=>{const e=t[0];let n=Mt(t,4);return 1===e&&(n*=Math.pow(2,32),n+=Mt(t,8)),n/r}))[0];return void 0!==d&&(t=d),Ut(c,["tfhd"]).map((d=>{const f=Mt(d,4),m=16777215&Mt(d,0);let v=0;const y=!!(16&m);let T=0;const E=!!(32&m);let k=8;f===o&&(!!(1&m)&&(k+=8),!!(2&m)&&(k+=4),!!(8&m)&&(v=Mt(d,k),k+=4),y&&(T=Mt(d,k),k+=4),E&&(k+=4),"video"===track.type&&(l=function(t){if(!t)return!1;const e=t.indexOf("."),n=e<0?t:t.substring(0,e);return"hvc1"===n||"hev1"===n||"dvh1"===n||"dvhe"===n}(track.codec)),Ut(c,["trun"]).map((o=>{const c=o[0],d=16777215&Mt(o,0),f=!!(1&d);let m=0;const y=!!(4&d),E=!!(256&d);let k=0;const S=!!(512&d);let _=0;const L=!!(1024&d),C=!!(2048&d);let A=0;const w=Mt(o,4);let O=8;f&&(m=Mt(o,O),O+=4),y&&(O+=4);let R=m+h;for(let h=0;h<w;h++){if(E?(k=Mt(o,O),O+=4):k=v,S?(_=Mt(o,O),O+=4):_=T,L&&(O+=4),C&&(A=0===c?Mt(o,O):Nt(o,O),O+=4),track.type===$){let o=0;for(;o<_;){const c=Mt(n,R);if(R+=4,Xt(l,n[R])){Qt(n.subarray(R,R+c),l?2:1,t+A/r,e)}R+=c,o+=c+4}}t+=k/r}})))}))}))})),e}function Xt(t,e){if(t){const t=e>>1&63;return 39===t||40===t}return 6===(31&e)}function Qt(t,e,n,r){const data=Jt(t);let o=0;o+=e;let l=0,c=0,b=0;for(;o<data.length;){l=0;do{if(o>=data.length)break;b=data[o++],l+=b}while(255===b);c=0;do{if(o>=data.length)break;b=data[o++],c+=b}while(255===b);const t=data.length-o;let e=o;if(c<t)o+=c;else if(c>t){x.error(`Malformed SEI payload. ${c} is too small, only ${t} bytes left to parse.`);break}if(4===l){if(181===data[e++]){const t=Pt(data,e);if(e+=2,49===t){const t=Mt(data,e);if(e+=4,1195456820===t){const t=data[e++];if(3===t){const o=data[e++],c=64&o,h=c?2+3*(31&o):0,d=new Uint8Array(h);if(c){d[0]=o;for(let i=1;i<h;i++)d[i]=data[e++]}r.push({type:t,payloadType:l,pts:n,bytes:d})}}}}}else if(5===l&&c>16){const t=[];for(let i=0;i<16;i++){const n=data[e++].toString(16);t.push(1==n.length?"0"+n:n),3!==i&&5!==i&&7!==i&&9!==i||t.push("-")}const o=c-16,h=new Uint8Array(o);for(let i=0;i<o;i++)h[i]=data[e++];r.push({payloadType:l,pts:n,uuid:t.join(""),userData:Ct(h),userDataBytes:h})}}}function Jt(data){const t=data.byteLength,e=[];let i=1;for(;i<t-2;)0===data[i]&&0===data[i+1]&&3===data[i+2]?(e.push(i+2),i+=2):i++;if(0===e.length)return data;const n=t-e.length,r=new Uint8Array(n);let o=0;for(i=0;i<n;o++,i++)o===e[0]&&(o++,e.shift()),r[i]=data[o];return r}function Zt(t,e,data){if(16!==t.byteLength)throw new RangeError("Invalid system id");let n,r,o;if(e){n=1,r=new Uint8Array(16*e.length);for(let t=0;t<e.length;t++){const n=e[t];if(16!==n.byteLength)throw new RangeError("Invalid key");r.set(n,16*t)}}else n=0,r=new Uint8Array;n>0?(o=new Uint8Array(4),e.length>0&&new DataView(o.buffer).setUint32(0,e.length,!1)):o=new Uint8Array;const l=new Uint8Array(4);return data&&data.byteLength>0&&new DataView(l.buffer).setUint32(0,data.byteLength,!1),function(t,...e){const n=e.length;let r=8,i=n;for(;i--;)r+=e[i].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=255&r,o.set(t,4),i=0,r=8;i<n;i++)o.set(e[i],r),r+=e[i].byteLength;return o}([112,115,115,104],new Uint8Array([n,0,0,0]),t,o,r,l,data||new Uint8Array)}let te={};class ee{static clearKeyUriToKeyIdMap(){te={}}constructor(t,e,n,r=[1],o=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=n,this.keyFormatVersions=r,this.iv=o,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&"AES-128"!==t}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case tt:case it:case et:case Z:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof t&&("AES-128"!==this.method||this.iv||x.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0);const e=function(t){const e=new Uint8Array(16);for(let i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e}(t);return new ee(this.method,this.uri,"identity",this.keyFormatVersions,e)}const e=z(this.uri);if(e)switch(this.keyFormat){case it:this.pssh=e,e.length>=22&&(this.keyId=e.subarray(e.length-22,e.length-6));break;case et:{const t=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Zt(t,null,e);const n=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),r=String.fromCharCode.apply(null,Array.from(n)),o=r.substring(r.indexOf("<"),r.length),l=(new DOMParser).parseFromString(o,"text/xml").getElementsByTagName("KID")[0];if(l){const t=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(t){const e=Y(t).subarray(0,16);!function(t){const e=function(t,e,n){const r=t[e];t[e]=t[n],t[n]=r};e(t,0,3),e(t,1,2),e(t,4,5),e(t,6,7)}(e),this.keyId=e}}break}default:{let t=e.subarray(0,16);if(16!==t.length){const e=new Uint8Array(16);e.set(t,16-t.length),t=e}this.keyId=t;break}}if(!this.keyId||16!==this.keyId.byteLength){let t=te[this.uri];if(!t){const e=Object.keys(te).length%Number.MAX_SAFE_INTEGER;t=new Uint8Array(16);new DataView(t.buffer,12,4).setUint32(0,e),te[this.uri]=t}this.keyId=t}return this}}const ie=/\{\$([a-zA-Z0-9-_]+)\}/g;function ne(t){return ie.test(t)}function re(t,e,n){if(null!==t.variableList||t.hasVariableRefs)for(let i=n.length;i--;){const r=n[i],o=e[r];o&&(e[r]=se(t,o))}}function se(t,e){if(null!==t.variableList||t.hasVariableRefs){const n=t.variableList;return e.replace(ie,(e=>{const r=e.substring(2,e.length-1),o=null==n?void 0:n[r];return void 0===o?(t.playlistParsingError||(t.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),e):o}))}return e}function ae(t,e,n){let r,o,l=t.variableList;if(l||(t.variableList=l={}),"QUERYPARAM"in e){r=e.QUERYPARAM;try{const t=new self.URL(n).searchParams;if(!t.has(r))throw new Error(`"${r}" does not match any query parameter in URI: "${n}"`);o=t.get(r)}catch(e){t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${e.message}`))}}else r=e.NAME,o=e.VALUE;r in l?t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):l[r]=o||""}function oe(t,e,n){const r=e.IMPORT;if(n&&r in n){let e=t.variableList;e||(t.variableList=e={}),e[r]=n[r]}else t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function le(t=!0){if("undefined"==typeof self)return;return(t||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}const ce={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function ue(t,e,n=!0){return!t.split(",").some((t=>!he(t,e,n)))}function he(t,e,n=!0){var r;const o=le(n);return null!=(r=null==o?void 0:o.isTypeSupported(de(t,e)))&&r}function de(t,e){return`${e}/mp4;codecs="${t}"`}function fe(t){if(t){const e=t.substring(0,4);return ce.video[e]}return 2}function ge(t){return t.split(",").reduce(((t,e)=>{const n=ce.video[e];return n?(2*n+t)/(t?3:2):(ce.audio[e]+t)/(t?2:1)}),0)}const pe={};const me=/flac|opus/i;function ve(t,e=!0){return t.replace(me,(t=>function(t,e=!0){if(pe[t])return pe[t];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[t];for(let i=0;i<n.length;i++)if(he(n[i],"audio",e))return pe[t]=n[i],n[i];return t}(t.toLowerCase(),e)))}function ye(t,e){return t&&"mp4a"!==t?t:e?e.split(",")[0]:e}const be=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Te=/#EXT-X-MEDIA:(.*)/g,Ee=/^#EXT(?:INF|-X-TARGETDURATION):/m,ke=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Se=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class _e{static findGroup(t,e){for(let i=0;i<t.length;i++){const n=t[i];if(n.id===e)return n}}static resolve(t,e){return m.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return Ee.test(t)}static parseMasterPlaylist(t,e){const n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:ne(t)},r=[];let o;for(be.lastIndex=0;null!=(o=be.exec(t));)if(o[1]){var l;const t=new F(o[1]);re(n,t,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const c=se(n,o[2]),h={attrs:t,bitrate:t.decimalInteger("BANDWIDTH")||t.decimalInteger("AVERAGE-BANDWIDTH"),name:t.NAME,url:_e.resolve(c,e)},d=t.decimalResolution("RESOLUTION");d&&(h.width=d.width,h.height=d.height),Ae(t.CODECS,h),null!=(l=h.unknownCodecs)&&l.length||r.push(h),n.levels.push(h)}else if(o[3]){const t=o[3],r=o[4];switch(t){case"SESSION-DATA":{const t=new F(r);re(n,t,["DATA-ID","LANGUAGE","VALUE","URI"]);const e=t["DATA-ID"];e&&(null===n.sessionData&&(n.sessionData={}),n.sessionData[e]=t);break}case"SESSION-KEY":{const t=Le(r,e,n);t.encrypted&&t.isSupported()?(null===n.sessionKeys&&(n.sessionKeys=[]),n.sessionKeys.push(t)):x.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${r}"`);break}case"DEFINE":{const t=new F(r);re(n,t,["NAME","VALUE","QUERYPARAM"]),ae(n,t,e)}break;case"CONTENT-STEERING":{const t=new F(r);re(n,t,["SERVER-URI","PATHWAY-ID"]),n.contentSteering={uri:_e.resolve(t["SERVER-URI"],e),pathwayId:t["PATHWAY-ID"]||"."};break}case"START":n.startTimeOffset=Ce(r)}}const c=r.length>0&&r.length<n.levels.length;return n.levels=c?r:n.levels,0===n.levels.length&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(t,e,n){let r;const o={},l=n.levels,c={AUDIO:l.map((t=>({id:t.attrs.AUDIO,audioCodec:t.audioCodec}))),SUBTITLES:l.map((t=>({id:t.attrs.SUBTITLES,textCodec:t.textCodec}))),"CLOSED-CAPTIONS":[]};let h=0;for(Te.lastIndex=0;null!==(r=Te.exec(t));){const t=new F(r[1]),l=t.TYPE;if(l){const r=c[l],d=o[l]||[];o[l]=d,re(n,t,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const f=t.LANGUAGE,m=t["ASSOC-LANGUAGE"],v=t.CHANNELS,y=t.CHARACTERISTICS,T=t["INSTREAM-ID"],E={attrs:t,bitrate:0,id:h++,groupId:t["GROUP-ID"]||"",name:t.NAME||f||"",type:l,default:t.bool("DEFAULT"),autoselect:t.bool("AUTOSELECT"),forced:t.bool("FORCED"),lang:f,url:t.URI?_e.resolve(t.URI,e):""};if(m&&(E.assocLang=m),v&&(E.channels=v),y&&(E.characteristics=y),T&&(E.instreamId=T),null!=r&&r.length){const t=_e.findGroup(r,E.groupId)||r[0];we(E,t,"audioCodec"),we(E,t,"textCodec")}d.push(E)}}return o}static parseLevelPlaylist(t,e,n,r,o,l){const c=new W(e),h=c.fragments;let d,i,f,m=null,v=0,y=0,T=0,E=0,_=null,L=new K(r,e),C=-1,A=!1,w=null;for(ke.lastIndex=0,c.m3u8=t,c.hasVariableRefs=ne(t);null!==(d=ke.exec(t));){A&&(A=!1,L=new K(r,e),L.start=T,L.sn=v,L.cc=E,L.level=n,m&&(L.initSegment=m,L.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null,w&&(L.setByteRange(w),w=null)));const t=d[1];if(t){L.duration=parseFloat(t);const title=(" "+d[2]).slice(1);L.title=title||null,L.tagList.push(title?["INF",t,title]:["INF",t])}else if(d[3]){if(S(L.duration)){L.start=T,f&&De(L,f,c),L.sn=v,L.level=n,L.cc=E,h.push(L);const t=(" "+d[3]).slice(1);L.relurl=se(c,t),Oe(L,_),_=L,T+=L.duration,v++,y=0,A=!0}}else if(d[4]){const data=(" "+d[4]).slice(1);_?L.setByteRange(data,_):L.setByteRange(data)}else if(d[5])L.rawProgramDateTime=(" "+d[5]).slice(1),L.tagList.push(["PROGRAM-DATE-TIME",L.rawProgramDateTime]),-1===C&&(C=h.length);else{if(d=d[0].match(Se),!d){x.warn("No matches on slow regex match for level playlist!");continue}for(i=1;i<d.length&&void 0===d[i];i++);const t=(" "+d[i]).slice(1),o=(" "+d[i+1]).slice(1),T=d[i+2]?(" "+d[i+2]).slice(1):"";switch(t){case"PLAYLIST-TYPE":c.type=o.toUpperCase();break;case"MEDIA-SEQUENCE":v=c.startSN=parseInt(o);break;case"SKIP":{const t=new F(o);re(c,t,["RECENTLY-REMOVED-DATERANGES"]);const e=t.decimalInteger("SKIPPED-SEGMENTS");if(S(e)){c.skippedSegments=e;for(let t=e;t--;)h.unshift(null);v+=e}const n=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");n&&(c.recentlyRemovedDateranges=n.split("\t"));break}case"TARGETDURATION":c.targetduration=Math.max(parseInt(o),1);break;case"VERSION":c.version=parseInt(o);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(o||T)&&L.tagList.push(T?[o,T]:[o]);break;case"DISCONTINUITY":E++,L.tagList.push(["DIS"]);break;case"GAP":L.gap=!0,L.tagList.push([t]);break;case"BITRATE":L.tagList.push([t,o]);break;case"DATERANGE":{const t=new F(o);re(c,t,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),re(c,t,t.clientAttrs);const e=new j(t,c.dateRanges[t.ID]);e.isValid||c.skippedSegments?c.dateRanges[e.id]=e:x.warn(`Ignoring invalid DATERANGE tag: "${o}"`),L.tagList.push(["EXT-X-DATERANGE",o]);break}case"DEFINE":{const t=new F(o);re(c,t,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in t?oe(c,t,l):ae(c,t,e)}break;case"DISCONTINUITY-SEQUENCE":E=parseInt(o);break;case"KEY":{const t=Le(o,e,c);if(t.isSupported()){if("NONE"===t.method){f=void 0;break}f||(f={}),f[t.keyFormat]&&(f=k({},f)),f[t.keyFormat]=t}else x.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${o}"`);break}case"START":c.startTimeOffset=Ce(o);break;case"MAP":{const t=new F(o);if(re(c,t,["BYTERANGE","URI"]),L.duration){const o=new K(r,e);Re(o,t,n,f),m=o,L.initSegment=m,m.rawProgramDateTime&&!L.rawProgramDateTime&&(L.rawProgramDateTime=m.rawProgramDateTime)}else{const e=L.byteRangeEndOffset;if(e){const t=L.byteRangeStartOffset;w=`${e-t}@${t}`}else w=null;Re(L,t,n,f),m=L,A=!0}break}case"SERVER-CONTROL":{const t=new F(o);c.canBlockReload=t.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=t.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&t.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=t.optionalFloat("PART-HOLD-BACK",0),c.holdBack=t.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const t=new F(o);c.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let t=c.partList;t||(t=c.partList=[]);const n=y>0?t[t.length-1]:void 0,r=y++,l=new F(o);re(c,l,["BYTERANGE","URI"]);const h=new V(l,L,e,r,n);t.push(h),L.duration+=h.duration;break}case"PRELOAD-HINT":{const t=new F(o);re(c,t,["URI"]),c.preloadHint=t;break}case"RENDITION-REPORT":{const t=new F(o);re(c,t,["URI"]),c.renditionReports=c.renditionReports||[],c.renditionReports.push(t);break}default:x.warn(`line parsed but not handled: ${d}`)}}}_&&!_.relurl?(h.pop(),T-=_.duration,c.partList&&(c.fragmentHint=_)):c.partList&&(Oe(L,_),L.cc=E,c.fragmentHint=L,f&&De(L,f,c));const O=h.length,R=h[0],D=h[O-1];if(T+=c.skippedSegments*c.targetduration,T>0&&O&&D){c.averagetargetduration=T/O;const t=D.sn;c.endSN="initSegment"!==t?t:0,c.live||(D.endList=!0),R&&(c.startCC=R.cc)}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(T+=c.fragmentHint.duration),c.totalduration=T,c.endCC=E,C>0&&function(t,e){let n=t[e];for(let i=e;i--;){const e=t[i];if(!e)return;e.programDateTime=n.programDateTime-1e3*e.duration,n=e}}(h,C),c}}function Le(t,e,n){var r,o;const l=new F(t);re(n,l,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const c=null!=(r=l.METHOD)?r:"",h=l.URI,d=l.hexadecimalInteger("IV"),f=l.KEYFORMATVERSIONS,m=null!=(o=l.KEYFORMAT)?o:"identity";h&&l.IV&&!d&&x.error(`Invalid IV: ${l.IV}`);const v=h?_e.resolve(h,e):"",y=(f||"1").split("/").map(Number).filter(Number.isFinite);return new ee(c,v,m,y,d)}function Ce(t){const e=new F(t).decimalFloatingPoint("TIME-OFFSET");return S(e)?e:null}function Ae(t,e){let n=(t||"").split(/[ ,]+/).filter((t=>t));["video","audio","text"].forEach((t=>{const r=n.filter((e=>function(t,e){const n=ce[e];return!!n&&!!n[t.slice(0,4)]}(e,t)));r.length&&(e[`${t}Codec`]=r.join(","),n=n.filter((t=>-1===r.indexOf(t))))})),e.unknownCodecs=n}function we(t,e,n){const r=e[n];r&&(t[n]=r)}function Oe(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),S(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function Re(t,e,n,r){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=n,t.sn="initSegment",r&&(t.levelkeys=r),t.initSegment=null}function De(t,e,n){t.levelkeys=e;const{encryptedFragments:r}=n;r.length&&r[r.length-1].levelkeys===e||!Object.keys(e).some((t=>e[t].isCommonEncryption))||r.push(t)}var Ie="manifest",xe="level",Pe="audioTrack",Me="subtitleTrack",Fe="main",Ne="audio",je="subtitle";function Ue(t){const{type:e}=t;switch(e){case Pe:return Ne;case Me:return je;default:return Fe}}function Be(t,e){let n=t.url;return void 0!==n&&0!==n.indexOf("data:")||(n=e.url),n}class $e{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.LEVEL_LOADING,this.onLevelLoading,this),t.on(C.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(C.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:t}=this;t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.LEVEL_LOADING,this.onLevelLoading,this),t.off(C.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(C.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(t){const e=this.hls.config,n=e.pLoader,r=e.loader,o=new(n||r)(e);return this.loaders[t.type]=o,o}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,data){const{url:e}=data;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ie,url:e,deliveryDirectives:null})}onLevelLoading(t,data){const{id:e,level:n,pathwayId:r,url:o,deliveryDirectives:l}=data;this.load({id:e,level:n,pathwayId:r,responseType:"text",type:xe,url:o,deliveryDirectives:l})}onAudioTrackLoading(t,data){const{id:e,groupId:n,url:r,deliveryDirectives:o}=data;this.load({id:e,groupId:n,level:null,responseType:"text",type:Pe,url:r,deliveryDirectives:o})}onSubtitleTrackLoading(t,data){const{id:e,groupId:n,url:r,deliveryDirectives:o}=data;this.load({id:e,groupId:n,level:null,responseType:"text",type:Me,url:r,deliveryDirectives:o})}load(t){var e;const n=this.hls.config;let r,o=this.getInternalLoader(t);if(o){const e=o.context;if(e&&e.url===t.url&&e.level===t.level)return void x.trace("[playlist-loader]: playlist request ongoing");x.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),o.abort()}if(r=t.type===Ie?n.manifestLoadPolicy.default:k({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),o=this.createInternalLoader(t),S(null==(e=t.deliveryDirectives)?void 0:e.part)){let e;if(t.type===xe&&null!==t.level?e=this.hls.levels[t.level].details:t.type===Pe&&null!==t.id?e=this.hls.audioTracks[t.id].details:t.type===Me&&null!==t.id&&(e=this.hls.subtitleTracks[t.id].details),e){const t=e.partTarget,n=e.targetduration;if(t&&n){const e=1e3*Math.max(3*t,.8*n);r=k({},r,{maxTimeToFirstByteMs:Math.min(e,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(e,r.maxTimeToFirstByteMs)})}}}const l=r.errorRetry||r.timeoutRetry||{},c={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},h={onSuccess:(t,e,n,r)=>{const o=this.getInternalLoader(n);this.resetInternalLoader(n.type);const l=t.data;0===l.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),_e.isMediaPlaylist(l)?this.handleTrackOrLevelPlaylist(t,e,n,r||null,o):this.handleMasterPlaylist(t,e,n,r)):this.handleManifestParsingError(t,n,new Error("no EXTM3U delimiter"),r||null,e)},onError:(t,e,n,r)=>{this.handleNetworkError(e,n,!1,t,r)},onTimeout:(t,e,n)=>{this.handleNetworkError(e,n,!0,void 0,t)}};o.load(t,c,h)}handleMasterPlaylist(t,e,n,r){const o=this.hls,l=t.data,c=Be(t,n),h=_e.parseMasterPlaylist(l,c);if(h.playlistParsingError)return void this.handleManifestParsingError(t,n,h.playlistParsingError,r,e);const{contentSteering:d,levels:f,sessionData:m,sessionKeys:v,startTimeOffset:y,variableList:T}=h;this.variableList=T;const{AUDIO:E=[],SUBTITLES:k,"CLOSED-CAPTIONS":S}=_e.parseMasterPlaylistMedia(l,c,h);if(E.length){E.some((t=>!t.url))||!f[0].audioCodec||f[0].attrs.AUDIO||(x.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new F({}),bitrate:0,url:""}))}o.trigger(C.MANIFEST_LOADED,{levels:f,audioTracks:E,subtitles:k,captions:S,contentSteering:d,url:c,stats:e,networkDetails:r,sessionData:m,sessionKeys:v,startTimeOffset:y,variableList:T})}handleTrackOrLevelPlaylist(t,e,n,r,o){const l=this.hls,{id:c,level:h,type:d}=n,f=Be(t,n),m=S(h)?h:S(c)?c:0,v=Ue(n),y=_e.parseLevelPlaylist(t.data,f,m,v,0,this.variableList);if(d===Ie){const t={attrs:new F({}),bitrate:0,details:y,name:"",url:f};l.trigger(C.MANIFEST_LOADED,{levels:[t],audioTracks:[],url:f,stats:e,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),n.levelDetails=y,this.handlePlaylistLoaded(y,t,e,n,r,o)}handleManifestParsingError(t,e,n,r,o){this.hls.trigger(C.ERROR,{type:A.NETWORK_ERROR,details:w.MANIFEST_PARSING_ERROR,fatal:e.type===Ie,url:t.url,err:n,error:n,reason:n.message,response:t,context:e,networkDetails:r,stats:o})}handleNetworkError(t,e,n=!1,r,o){let l=`A network ${n?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${t.type}`;t.type===xe?l+=`: ${t.level} id: ${t.id}`:t.type!==Pe&&t.type!==Me||(l+=` id: ${t.id} group-id: "${t.groupId}"`);const c=new Error(l);x.warn(`[playlist-loader]: ${l}`);let details=w.UNKNOWN,h=!1;const d=this.getInternalLoader(t);switch(t.type){case Ie:details=n?w.MANIFEST_LOAD_TIMEOUT:w.MANIFEST_LOAD_ERROR,h=!0;break;case xe:details=n?w.LEVEL_LOAD_TIMEOUT:w.LEVEL_LOAD_ERROR,h=!1;break;case Pe:details=n?w.AUDIO_TRACK_LOAD_TIMEOUT:w.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case Me:details=n?w.SUBTITLE_TRACK_LOAD_TIMEOUT:w.SUBTITLE_LOAD_ERROR,h=!1}d&&this.resetInternalLoader(t.type);const f={type:A.NETWORK_ERROR,details:details,fatal:h,url:t.url,loader:d,context:t,error:c,networkDetails:e,stats:o};if(r){const n=(null==e?void 0:e.url)||t.url;f.response=y({url:n,data:void 0},r)}this.hls.trigger(C.ERROR,f)}handlePlaylistLoaded(t,e,n,r,o,l){const c=this.hls,{type:h,level:d,id:f,groupId:m,deliveryDirectives:v}=r,y=Be(e,r),T=Ue(r),E="number"==typeof r.level&&T===Fe?d:void 0;if(!t.fragments.length){const t=new Error("No Segments found in Playlist");return void c.trigger(C.ERROR,{type:A.NETWORK_ERROR,details:w.LEVEL_EMPTY_ERROR,fatal:!1,url:y,error:t,reason:t.message,response:e,context:r,level:E,parent:T,networkDetails:o,stats:n})}t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));const k=t.playlistParsingError;if(k)c.trigger(C.ERROR,{type:A.NETWORK_ERROR,details:w.LEVEL_PARSING_ERROR,fatal:!1,url:y,error:k,reason:k.message,response:e,context:r,level:E,parent:T,networkDetails:o,stats:n});else switch(t.live&&l&&(l.getCacheAge&&(t.ageHeader=l.getCacheAge()||0),l.getCacheAge&&!isNaN(t.ageHeader)||(t.ageHeader=0)),h){case Ie:case xe:c.trigger(C.LEVEL_LOADED,{details:t,level:E||0,id:f||0,stats:n,networkDetails:o,deliveryDirectives:v});break;case Pe:c.trigger(C.AUDIO_TRACK_LOADED,{details:t,id:f||0,groupId:m||"",stats:n,networkDetails:o,deliveryDirectives:v});break;case Me:c.trigger(C.SUBTITLE_TRACK_LOADED,{details:t,id:f||0,groupId:m||"",stats:n,networkDetails:o,deliveryDirectives:v})}}}function He(track,t){let e;try{e=new Event("addtrack")}catch(t){e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=track,t.dispatchEvent(e)}function Ge(track,t){const e=track.mode;if("disabled"===e&&(track.mode="hidden"),track.cues&&!track.cues.getCueById(t.id))try{if(track.addCue(t),!track.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(e){x.debug(`[texttrack-utils]: ${e}`);try{const e=new self.TextTrackCue(t.startTime,t.endTime,t.text);e.id=t.id,track.addCue(e)}catch(t){x.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${t}`)}}"disabled"===e&&(track.mode=e)}function Ke(track){const t=track.mode;if("disabled"===t&&(track.mode="hidden"),track.cues)for(let i=track.cues.length;i--;)track.removeCue(track.cues[i]);"disabled"===t&&(track.mode=t)}function Ve(track,t,e,n){const r=track.mode;if("disabled"===r&&(track.mode="hidden"),track.cues&&track.cues.length>0){const r=function(t,e,n){const r=[],o=function(t,time){if(time<t[0].startTime)return 0;const e=t.length-1;if(time>t[e].endTime)return-1;let n=0,r=e;for(;n<=r;){const o=Math.floor((r+n)/2);if(time<t[o].startTime)r=o-1;else{if(!(time>t[o].startTime&&n<e))return o;n=o+1}}return t[n].startTime-time<time-t[r].startTime?n:r}(t,e);if(o>-1)for(let i=o,l=t.length;i<l;i++){const o=t[i];if(o.startTime>=e&&o.endTime<=n)r.push(o);else if(o.startTime>n)return r}return r}(track.cues,t,e);for(let i=0;i<r.length;i++)n&&!n(r[i])||track.removeCue(r[i])}"disabled"===r&&(track.mode=r)}function We(t){const e=[];for(let i=0;i<t.length;i++){const track=t[i];"subtitles"!==track.kind&&"captions"!==track.kind||!track.label||e.push(t[i])}return e}var Ye="org.id3",qe="com.apple.quicktime.HLS",ze="https://aomedia.org/emsg/ID3";function Xe(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function Qe(t,e,n,data,r){let o=new t(e,n,"");try{o.value=data,r&&(o.type=r)}catch(l){o=new t(e,n,JSON.stringify(r?y({type:r},data):data))}return o}const Je=(()=>{const t=Xe();try{t&&new t(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Ze(t,e){return t.getTime()/1e3-e}class ti{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:t}=this;t.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(C.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:t}=this;t.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(C.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(t,data){this.media=data.media}onMediaDetaching(){this.id3Track&&(Ke(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const track=this.getID3Track(t.textTracks);return track.mode="hidden",track}getID3Track(t){if(this.media){for(let i=0;i<t.length;i++){const e=t[i];if("metadata"===e.kind&&"id3"===e.label)return He(e,this.media),e}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,data){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:e,enableID3MetadataCues:n}}}=this;if(!e&&!n)return;const{samples:r}=data;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Xe();if(o)for(let i=0;i<r.length;i++){const t=r[i].type;if(t===ze&&!e||!n)continue;const l=Tt(r[i].data);if(l){const e=r[i].pts;let n=e+r[i].duration;n>Je&&(n=Je);n-e<=0&&(n=e+.25);for(let r=0;r<l.length;r++){const c=l[r];if(!yt(c)){this.updateId3CueEnds(e,t);const r=Qe(o,e,n,c,t);r&&this.id3Track.addCue(r)}}}}}updateId3CueEnds(t,e){var n;const r=null==(n=this.id3Track)?void 0:n.cues;if(r)for(let i=r.length;i--;){const n=r[i];n.type===e&&n.startTime<t&&n.endTime===Je&&(n.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:n,type:r}){const{id3Track:o,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:h}}=l;if(o&&(c||h)){let t;t="audio"===r?t=>t.type===Ye&&h:"video"===r?t=>t.type===ze&&c:t=>t.type===Ye&&h||t.type===ze&&c,Ve(o,e,n,t)}}onLevelUpdated(t,{details:details}){if(!this.media||!details.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:e,id3Track:n}=this,{dateRanges:r}=details,o=Object.keys(r);if(n){const t=Object.keys(e).filter((t=>!o.includes(t)));for(let i=t.length;i--;){const r=t[i];Object.keys(e[r].cues).forEach((t=>{n.removeCue(e[r].cues[t])})),delete e[r]}}const l=details.fragments[details.fragments.length-1];if(0===o.length||!S(null==l?void 0:l.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const c=l.programDateTime/1e3-l.start,h=Xe();for(let i=0;i<o.length;i++){const t=o[i],n=r[t],l=Ze(n.startDate,c),m=e[t],v=(null==m?void 0:m.cues)||{};let y=(null==m?void 0:m.durationKnown)||!1,T=Je;const E=n.endDate;if(E)T=Ze(E,c),y=!0;else if(n.endOnNext&&!y){const t=o.reduce(((t,e)=>{if(e!==n.id){const o=r[e];if(o.class===n.class&&o.startDate>n.startDate&&(!t||n.startDate<t.startDate))return o}return t}),null);t&&(T=Ze(t.startDate,c),y=!0)}const k=Object.keys(n.attr);for(let e=0;e<k.length;e++){const r=k[e];if("ID"===(f=r)||"CLASS"===f||"START-DATE"===f||"DURATION"===f||"END-DATE"===f||"END-ON-NEXT"===f)continue;const o=v[r];if(o)y&&!m.durationKnown&&(o.endTime=T);else if(h){let data=n.attr[r];N(r)&&(d=data,data=Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);const e=Qe(h,l,T,{key:r,data:data},qe);e&&(e.id=t,this.id3Track.addCue(e),v[r]=e)}}e[t]={cues:v,dateRange:n,durationKnown:y}}var d,f}}class ei{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=t,this.config=t.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:t,levelDetails:e}=this;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const{levelDetails:t}=this;if(null===t)return null;const{holdBack:e,partHoldBack:n,targetduration:r}=t,{liveSyncDuration:o,liveSyncDurationCount:l,lowLatencyMode:c}=this.config,h=this.hls.userConfig;let d=c&&n||e;(h.liveSyncDuration||h.liveSyncDurationCount||0===d)&&(d=void 0!==o?o:l*r);const f=r;return d+Math.min(1*this.stallCount,f)}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency,n=this.levelDetails;if(null===t||null===e||null===n)return null;const r=n.edge,o=t-e-this.edgeStalled,l=r-n.totalduration,c=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(l,o),c)}get drift(){const{levelDetails:t}=this;return null===t?1:t.drift}get edgeStalled(){const{levelDetails:t}=this;if(null===t)return 0;const e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t,levelDetails:e}=this;if(!t||!e)return 0;const n=t.buffered.length;return(n?t.buffered.end(n-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(C.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(C.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(C.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(C.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(C.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(C.ERROR,this.onError,this)}onMediaAttached(t,data){this.media=data.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:details}){this.levelDetails=details,details.advanced&&this.timeupdate(),!details.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(t,data){var e;data.details===w.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(e=this.levelDetails)&&e.live&&x.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:t,levelDetails:e}=this;if(!t||!e)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(null===n)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:o}=this.config;if(!r||1===o||!e.live)return;const l=this.targetLatency;if(null===l)return;const c=n-l;if(c<Math.min(this.maxLatency,l+e.targetduration)&&c>.05&&this.forwardBufferLength>1){const e=Math.min(2,Math.max(1,o)),n=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20;t.playbackRate=Math.min(e,Math.max(1,n))}else 1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1)}estimateLiveEdge(){const{levelDetails:t}=this;return null===t?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return null===t?null:t-this.currentTime}}const ii=["NONE","TYPE-0","TYPE-1",null];const ni=["SDR","PQ","HLG"];var ri="",si="YES",ai="v2";function oi(details){const{canSkipUntil:t,canSkipDateRanges:e,age:n}=details;return t&&n<t/2?e?ai:si:ri}class ci{constructor(t,e,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=n}addDirectives(t){const e=new self.URL(t);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class ui{constructor(data){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[data.url],this._attrs=[data.attrs],this.bitrate=data.bitrate,data.details&&(this.details=data.details),this.id=data.id||0,this.name=data.name,this.width=data.width||0,this.height=data.height||0,this.frameRate=data.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=data.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=data.audioCodec,this.videoCodec=data.videoCodec,this.codecSet=[data.videoCodec,data.audioCodec].filter((t=>!!t)).map((s=>s.substring(0,4))).join(","),this.addGroupId("audio",data.attrs.AUDIO),this.addGroupId("text",data.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(t){return hi(this._audioGroups,t)}hasSubtitleGroup(t){return hi(this._subtitleGroups,t)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(t,e){if(e)if("audio"===t){let t=this._audioGroups;t||(t=this._audioGroups=[]),-1===t.indexOf(e)&&t.push(e)}else if("text"===t){let t=this._subtitleGroups;t||(t=this._subtitleGroups=[]),-1===t.indexOf(e)&&t.push(e)}}get urlId(){return 0}set urlId(t){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var t;return null==(t=this.audioGroups)?void 0:t[0]}get textGroupId(){var t;return null==(t=this.subtitleGroups)?void 0:t[0]}addFallback(){}}function hi(t,e){return!(!e||!t)&&-1!==t.indexOf(e)}function di(t,e){const n=e.startPTS;if(S(n)){let r,o=0;e.sn>t.sn?(o=n-t.start,r=t):(o=t.start-n,r=e),r.duration!==o&&(r.duration=o)}else if(e.sn>t.sn){t.cc===e.cc&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration}else e.start=Math.max(t.start-e.duration,0)}function fi(details,t,e,n,r,o){n-e<=0&&(x.warn("Fragment should have a positive duration",t),n=e+t.duration,o=r+t.duration);let l=e,c=n;const h=t.startPTS,d=t.endPTS;if(S(h)){const f=Math.abs(h-e);S(t.deltaPTS)?t.deltaPTS=Math.max(f,t.deltaPTS):t.deltaPTS=f,l=Math.max(e,h),e=Math.min(e,h),r=Math.min(r,t.startDTS),c=Math.min(n,d),n=Math.max(n,d),o=Math.max(o,t.endDTS)}const f=e-t.start;0!==t.start&&(t.start=e),t.duration=n-t.start,t.startPTS=e,t.maxStartPTS=l,t.startDTS=r,t.endPTS=n,t.minEndPTS=c,t.endDTS=o;const m=t.sn;if(!details||m<details.startSN||m>details.endSN)return 0;let i;const v=m-details.startSN,y=details.fragments;for(y[v]=t,i=v;i>0;i--)di(y[i],y[i-1]);for(i=v;i<y.length-1;i++)di(y[i],y[i+1]);return details.fragmentHint&&di(y[y.length-1],details.fragmentHint),details.PTSKnown=details.alignedSliding=!0,f}function gi(t,e){let n=null;const r=t.fragments;for(let i=r.length-1;i>=0;i--){const t=r[i].initSegment;if(t){n=t;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;let o,l=0;if(function(t,e,n){const r=e.skippedSegments,o=Math.max(t.startSN,e.startSN)-e.startSN,l=(t.fragmentHint?1:0)+(r?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,c=e.startSN-t.startSN,h=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;for(let i=o;i<=l;i++){const t=d[c+i];let o=h[i];r&&!o&&i<r&&(o=e.fragments[i]=t),t&&o&&n(t,o)}}(t,e,((t,r)=>{t.relurl&&(l=t.cc-r.cc),S(t.startPTS)&&S(t.endPTS)&&(r.start=r.startPTS=t.startPTS,r.startDTS=t.startDTS,r.maxStartPTS=t.maxStartPTS,r.endPTS=t.endPTS,r.endDTS=t.endDTS,r.minEndPTS=t.minEndPTS,r.duration=t.endPTS-t.startPTS,r.duration&&(o=r),e.PTSKnown=e.alignedSliding=!0),r.elementaryStreams=t.elementaryStreams,r.loader=t.loader,r.stats=t.stats,t.initSegment&&(r.initSegment=t.initSegment,n=t.initSegment)})),n){(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach((t=>{var e;!t||t.initSegment&&t.initSegment.relurl!==(null==(e=n)?void 0:e.relurl)||(t.initSegment=n)}))}if(e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some((t=>!t)),e.deltaUpdateFailed){x.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let i=e.skippedSegments;i--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=function(t,e,n){const r=k({},t);n&&n.forEach((t=>{delete r[t]}));return Object.keys(e).forEach((t=>{const n=new j(e[t].attr,r[t]);n.isValid?r[t]=n:x.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[t].attr)}"`)})),r}(t.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const c=e.fragments;if(l){x.warn("discontinuity sliding from playlist, take drift into account");for(let i=0;i<c.length;i++)c[i].cc+=l}e.skippedSegments&&(e.startCC=e.fragments[0].cc),function(t,e,n){if(t&&e){let r=0;for(let i=0,o=t.length;i<=o;i++){const o=t[i],l=e[i+r];o&&l&&o.index===l.index&&o.fragment.sn===l.fragment.sn?n(o,l):r--}}}(t.partList,e.partList,((t,e)=>{e.elementaryStreams=t.elementaryStreams,e.stats=t.stats})),o?fi(e,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS):pi(t,e),c.length&&(e.totalduration=e.edge-c[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;const h=e.advancedDateTime;if(e.advanced&&h){const t=e.edge;e.driftStart||(e.driftStartTime=h,e.driftStart=t),e.driftEndTime=h,e.driftEnd=t}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime}function pi(t,e){const n=e.startSN+e.skippedSegments-t.startSN,r=t.fragments;n<0||n>=r.length||mi(e,r[n].start)}function mi(details,t){if(t){const e=details.fragments;for(let i=details.skippedSegments;i<e.length;i++)e[i].start+=t;details.fragmentHint&&(details.fragmentHint.start+=t)}}function vi(t,e,n){var r;return null!=t&&t.details?yi(null==(r=t.details)?void 0:r.partList,e,n):null}function yi(t,e,n){if(t)for(let i=t.length;i--;){const r=t[i];if(r.index===n&&r.fragment.sn===e)return r}return null}function bi(t){t.forEach(((t,e)=>{const{details:details}=t;null!=details&&details.fragments&&details.fragments.forEach((t=>{t.level=e}))}))}function Ti(t){switch(t.details){case w.FRAG_LOAD_TIMEOUT:case w.KEY_LOAD_TIMEOUT:case w.LEVEL_LOAD_TIMEOUT:case w.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ei(t,e){const n=Ti(e);return t.default[(n?"timeout":"error")+"Retry"]}function ki(t,e){const n="linear"===t.backoff?1:Math.pow(2,e);return Math.min(n*t.retryDelayMs,t.maxRetryDelayMs)}function Si(t){return y(y({},t),{errorRetry:null,timeoutRetry:null})}function _i(t,e,n,r){if(!t)return!1;const o=null==r?void 0:r.code,l=e<t.maxNumRetry&&(function(t){return 0===t&&!1===navigator.onLine||!!t&&(t<400||t>499)}(o)||!!n);return t.shouldRetry?t.shouldRetry(t,e,n,r,l):l}const Li=function(t,e){let n=0,r=t.length-1,o=null,l=null;for(;n<=r;){o=(n+r)/2|0,l=t[o];const c=e(l);if(c>0)n=o+1;else{if(!(c<0))return l;r=o-1}}return null};function Ci(t,e,n=0,r=0,o=.005){let l=null;if(t){l=e[t.sn-e[0].sn+1]||null;const r=t.endDTS-n;r>0&&r<15e-7&&(n+=15e-7)}else 0===n&&0===e[0].start&&(l=e[0]);if(l&&((!t||t.level===l.level)&&0===Ai(n,r,l)||function(t,e,n){if(e&&0===e.start&&e.level<t.level&&(e.endPTS||0)>0){const r=e.tagList.reduce(((t,e)=>("INF"===e[0]&&(t+=parseFloat(e[1])),t)),n);return t.start<=r}return!1}(l,t,Math.min(o,r))))return l;const c=Li(e,Ai.bind(null,n,r));return!c||c===t&&l?l:c}function Ai(t=0,e=0,n){if(n.start<=t&&n.start+n.duration>t)return 0;const r=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=t?1:n.start-r>t&&n.start?-1:0}function wi(t,e,n){const r=1e3*Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>t}var Oi=0,Ri=2,Di=3,Ii=5,xi=0,Pi=1,Mi=2;class Fi{constructor(t,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=x.log.bind(x,`${e}:`),this.warn=x.warn.bind(x,`${e}:`),this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e,n){const r=null==e?void 0:e.renditionReports;if(r){let o=-1;for(let i=0;i<r.length;i++){const n=r[i];let l;try{l=new self.URL(n.URI,e.url).href}catch(t){x.warn(`Could not construct new URL for Rendition Report: ${t}`),l=n.URI||""}if(l===t){o=i;break}l===t.substring(0,l.length)&&(o=i)}if(-1!==o){const t=r[o],l=parseInt(t["LAST-MSN"])||(null==e?void 0:e.lastPartSn);let c=parseInt(t["LAST-PART"])||(null==e?void 0:e.lastPartIndex);if(this.hls.config.lowLatencyMode){const t=Math.min(e.age-e.partTarget,e.targetduration);c>=0&&t>e.partTarget&&(c+=1)}const h=n&&oi(n);return new ci(l,c>=0?c:void 0,h)}}}loadPlaylist(t){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}shouldReloadPlaylist(t){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(t)}playlistLoaded(t,data,e){const{details:details,stats:n}=data,r=self.performance.now(),o=n.loading.first?Math.max(0,r-n.loading.first):0;if(details.advancedDateTime=Date.now()-o,details.live||null!=e&&e.live){if(details.reloaded(e),e&&this.log(`live playlist ${t} ${details.advanced?"REFRESHED "+details.lastPartSn+"-"+details.lastPartIndex:details.updated?"UPDATED":"MISSED"}`),e&&details.fragments.length>0&&gi(e,details),!this.canLoad||!details.live)return;let o,l,c;if(details.canBlockReload&&details.endSN&&details.advanced){const t=this.hls.config.lowLatencyMode,n=details.lastPartSn,r=details.endSN,h=details.lastPartIndex,d=n===r;-1!==h?(l=d?r+1:n,c=d?t?0:h:h+1):l=r+1;const f=details.age,m=f+details.ageHeader;let v=Math.min(m-details.partTarget,1.5*details.targetduration);if(v>0){if(e&&v>e.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${e.tuneInGoal} to: ${v} with playlist age: ${details.age}`),v=0;else{const t=Math.floor(v/details.targetduration);if(l+=t,void 0!==c){c+=Math.round(v%details.targetduration/details.partTarget)}this.log(`CDN Tune-in age: ${details.ageHeader}s last advanced ${f.toFixed(2)}s goal: ${v} skip sn ${t} to part ${c}`)}details.tuneInGoal=v}if(o=this.getDeliveryDirectives(details,data.deliveryDirectives,l,c),t||!d)return void this.loadPlaylist(o)}else(details.canBlockReload||details.canSkipUntil)&&(o=this.getDeliveryDirectives(details,data.deliveryDirectives,l,c));const h=this.hls.mainForwardBufferInfo,d=h?h.end-h.len:0,f=function(t,e=1/0){let n=1e3*t.targetduration;if(t.updated){const r=t.fragments,o=4;if(r.length&&n*o>e){const t=1e3*r[r.length-1].duration;t<n&&(n=t)}}else n/=2;return Math.round(n)}(details,1e3*(details.edge-d));details.updated&&r>this.requestScheduled+f&&(this.requestScheduled=n.loading.start),void 0!==l&&details.canBlockReload?this.requestScheduled=n.loading.first+f-(1e3*details.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+f<r?this.requestScheduled=r:this.requestScheduled-r<=0&&(this.requestScheduled+=f);let m=this.requestScheduled-r;m=Math.max(0,m),this.log(`reload live playlist ${t} in ${Math.round(m)} ms`),this.timer=self.setTimeout((()=>this.loadPlaylist(o)),m)}else this.clearTimer()}getDeliveryDirectives(details,t,e,n){let r=oi(details);return null!=t&&t.skip&&details.deltaUpdateFailed&&(e=t.msn,n=t.part,r=ri),new ci(e,n,r)}checkRetry(t){const e=t.details,n=Ti(t),r=t.errorAction,{action:o,retryCount:l=0,retryConfig:c}=r||{},h=!!r&&!!c&&(o===Ii||!r.resolved&&o===Ri);if(h){var d;if(this.requestScheduled=-1,l>=c.maxNumRetry)return!1;if(n&&null!=(d=t.context)&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const t=ki(c,l);this.timer=self.setTimeout((()=>this.loadPlaylist()),t),this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${e}" in ${t}ms`)}t.levelRetry=!0,r.resolved=!0}return h}}class Ni{constructor(t,e=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=n}sample(t,e){const n=Math.pow(this.alpha_,t);this.estimate_=e*(1-n)+n*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class ji{constructor(t,e,n,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ni(t),this.fast_=new Ni(e),this.defaultTTFB_=r,this.ttfb_=new Ni(t)}update(t,e){const{slow_:n,fast_:r,ttfb_:o}=this;n.halfLife!==t&&(this.slow_=new Ni(t,n.getEstimate(),n.getTotalWeight())),r.halfLife!==e&&(this.fast_=new Ni(e,r.getEstimate(),r.getTotalWeight())),o.halfLife!==t&&(this.ttfb_=new Ni(t,o.getEstimate(),o.getTotalWeight()))}sample(t,e){const n=(t=Math.max(t,this.minDelayMs_))/1e3,r=8*e/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(t){const e=t/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(n,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const Ui={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},Bi={};function $i(t,e,n,r,o,l){const c=t.audioCodec?t.audioGroups:null,h=null==l?void 0:l.audioCodec,d=null==l?void 0:l.channels,f=d?parseInt(d):h?1/0:2;let m=null;if(null!=c&&c.length)try{m=1===c.length&&c[0]?e.groups[c[0]].channels:c.reduce(((t,n)=>{if(n){const r=e.groups[n];if(!r)throw new Error(`Audio track group ${n} not found`);Object.keys(r.channels).forEach((e=>{t[e]=(t[e]||0)+r.channels[e]}))}return t}),{2:0})}catch(t){return!0}return void 0!==t.videoCodec&&(t.width>1920&&t.height>1088||t.height>1920&&t.width>1088||t.frameRate>Math.max(r,30)||"SDR"!==t.videoRange&&t.videoRange!==n||t.bitrate>Math.max(o,8e6))||!!m&&S(f)&&Object.keys(m).some((t=>parseInt(t)>f))}function Hi(t,e,n){const r=t.videoCodec,o=t.audioCodec;if(!r||!o||!n)return Promise.resolve(Ui);const l={width:t.width,height:t.height,bitrate:Math.ceil(Math.max(.9*t.bitrate,t.averageBitrate)),framerate:t.frameRate||30},c=t.videoRange;"SDR"!==c&&(l.transferFunction=c.toLowerCase());const h=r.split(",").map((t=>({type:"media-source",video:y(y({},l),{},{contentType:de(t,"video")})})));return o&&t.audioGroups&&t.audioGroups.forEach((t=>{var n;t&&(null==(n=e.groups[t])||n.tracks.forEach((e=>{if(e.groupId===t){const t=e.channels||"",n=parseFloat(t);S(n)&&n>2&&h.push.apply(h,o.split(",").map((t=>({type:"media-source",audio:{contentType:de(t,"audio"),channels:""+n}}))))}})))})),Promise.all(h.map((t=>{const e=function(t){const{audio:audio,video:video}=t,e=video||audio;if(e){const t=e.contentType.split('"')[1];if(video)return`r${video.height}x${video.width}f${Math.ceil(video.framerate)}${video.transferFunction||"sd"}_${t}_${Math.ceil(video.bitrate/1e5)}`;if(audio)return`c${audio.channels}${audio.spatialRendering?"s":"n"}_${t}`}return""}(t);return Bi[e]||(Bi[e]=n.decodingInfo(t))}))).then((t=>({supported:!t.some((t=>!t.supported)),configurations:h,decodingInfoResults:t}))).catch((t=>({supported:!1,configurations:h,decodingInfoResults:[],error:t})))}function Gi(t,e){let n=!1,r=[];return t&&(n="SDR"!==t,r=[t]),e&&(r=e.allowedVideoRanges||ni.slice(0),n=void 0!==e.preferHDR?e.preferHDR:function(){if("function"==typeof matchMedia){const t=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(t.media!==e.media)return!0===t.matches}return!1}(),r=n?r.filter((t=>"SDR"!==t)):["SDR"]),{preferHDR:n,allowedVideoRanges:r}}function Ki(t,e){x.log(`[abr] start candidates with "${t}" ignored because ${e}`)}function Vi(option,t,e){if("attrs"in option){const e=t.indexOf(option);if(-1!==e)return e}for(let i=0;i<t.length;i++){if(Wi(option,t[i],e))return i}return-1}function Wi(option,track,t){const{groupId:e,name:n,lang:r,assocLang:o,characteristics:l,default:c}=option,h=option.forced;return(void 0===e||track.groupId===e)&&(void 0===n||track.name===n)&&(void 0===r||track.lang===r)&&(void 0===r||track.assocLang===o)&&(void 0===c||track.default===c)&&(void 0===h||track.forced===h)&&(void 0===l||function(t,e=""){const n=t.split(","),r=e.split(",");return n.length===r.length&&!n.some((t=>-1===r.indexOf(t)))}(l,track.characteristics))&&(void 0===t||t(option,track))}function Yi(option,track){const{audioCodec:t,channels:e}=option;return!(void 0!==t&&(track.audioCodec||"").substring(0,4)!==t.substring(0,4)||void 0!==e&&e!==(track.channels||"2"))}function qi(t,e,n){for(let i=e;i;i--)if(n(t[i]))return i;for(let i=e+1;i<t.length;i++)if(n(t[i]))return i;return-1}class zi{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var Xi="NOT_LOADED",Qi="APPENDING",Ji="PARTIAL",Zi="OK";class tn{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(C.BUFFER_APPENDED,this.onBufferAppended,this),t.on(C.FRAG_BUFFERED,this.onFragBuffered,this),t.on(C.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:t}=this;t.off(C.BUFFER_APPENDED,this.onBufferAppended,this),t.off(C.FRAG_BUFFERED,this.onFragBuffered,this),t.off(C.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const n=this.activePartLists[e];if(n)for(let i=n.length;i--;){const e=n[i];if(!e)break;const r=e.end;if(e.start<=t&&null!==r&&t<=r)return e}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){const{fragments:n}=this,r=Object.keys(n);for(let i=r.length;i--;){const o=n[r[i]];if((null==o?void 0:o.body.type)===e&&o.buffered){const e=o.body;if(e.start<=t&&t<=e.end)return e}}return null}detectEvictedFragments(t,e,n,r){this.timeRanges&&(this.timeRanges[t]=e);const o=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach((r=>{const l=this.fragments[r];if(!l)return;if(o>=l.body.sn)return;if(!l.buffered&&!l.loaded)return void(l.body.type===n&&this.removeFragment(l.body));const c=l.range[t];c&&c.time.some((time=>{const t=!this.isTimeBuffered(time.startPTS,time.endPTS,e);return t&&this.removeFragment(l.body),t}))}))}detectPartialFragments(data){const t=this.timeRanges,{frag:e,part:n}=data;if(!t||"initSegment"===e.sn)return;const r=nn(e),o=this.fragments[r];if(!o||o.buffered&&e.gap)return;const l=!e.relurl;if(Object.keys(t).forEach((r=>{const c=e.elementaryStreams[r];if(!c)return;const h=t[r],d=l||!0===c.partial;o.range[r]=this.getBufferedTimes(e,n,d,h)})),o.loaded=null,Object.keys(o.range).length){o.buffered=!0;(o.body.endList=e.endList||o.body.endList)&&(this.endListFragments[o.body.type]=o),en(o)||this.removeParts(e.sn-1,e.type)}else this.removeFragment(o.body)}removeParts(t,e){const n=this.activePartLists[e];n&&(this.activePartLists[e]=n.filter((e=>e.fragment.sn>=t)))}fragBuffered(t,e){const n=nn(t);let r=this.fragments[n];!r&&e&&(r=this.fragments[n]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(t,e,n,r){const o={time:[],partial:n},l=t.start,c=t.end,h=t.minEndPTS||c,d=t.maxStartPTS||l;for(let i=0;i<r.length;i++){const t=r.start(i)-this.bufferPadding,e=r.end(i)+this.bufferPadding;if(d>=t&&h<=e){o.time.push({startPTS:Math.max(l,r.start(i)),endPTS:Math.min(c,r.end(i))});break}if(l<e&&c>t){const t=Math.max(l,r.start(i)),e=Math.min(c,r.end(i));e>t&&(o.partial=!0,o.time.push({startPTS:t,endPTS:e}))}else if(c<=t)break}return o}getPartialFragment(time){let t,e,n,r=null,o=0;const{bufferPadding:l,fragments:c}=this;return Object.keys(c).forEach((h=>{const d=c[h];d&&en(d)&&(e=d.body.start-l,n=d.body.end+l,time>=e&&time<=n&&(t=Math.min(time-e,n-time),o<=t&&(r=d.body,o=t)))})),r}isEndListAppended(t){const e=this.endListFragments[t];return void 0!==e&&(e.buffered||en(e))}getState(t){const e=nn(t),n=this.fragments[e];return n?n.buffered?en(n)?Ji:Zi:Qi:Xi}isTimeBuffered(t,e,n){let r,o;for(let i=0;i<n.length;i++){if(r=n.start(i)-this.bufferPadding,o=n.end(i)+this.bufferPadding,t>=r&&e<=o)return!0;if(e<=r)return!1}return!1}onFragLoaded(t,data){const{frag:e,part:n}=data;if("initSegment"===e.sn||e.bitrateTest)return;const r=n?null:data,o=nn(e);this.fragments[o]={body:e,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(t,data){const{frag:e,part:n,timeRanges:r}=data;if("initSegment"===e.sn)return;const o=e.type;if(n){let t=this.activePartLists[o];t||(this.activePartLists[o]=t=[]),t.push(n)}this.timeRanges=r,Object.keys(r).forEach((t=>{const e=r[t];this.detectEvictedFragments(t,e,o,n)}))}onFragBuffered(t,data){this.detectPartialFragments(data)}hasFragment(t){const e=nn(t);return!!this.fragments[e]}hasParts(t){var e;return!(null==(e=this.activePartLists[t])||!e.length)}removeFragmentsInRange(t,e,n,r,o){r&&!this.hasGaps||Object.keys(this.fragments).forEach((l=>{const c=this.fragments[l];if(!c)return;const h=c.body;h.type!==n||r&&!h.gap||h.start<e&&h.end>t&&(c.buffered||o)&&this.removeFragment(h)}))}removeFragment(t){const e=nn(t);t.stats.loaded=0,t.clearElementaryStreamInfo();const n=this.activePartLists[t.type];if(n){const e=t.sn;this.activePartLists[t.type]=n.filter((t=>t.fragment.sn!==e))}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function en(t){var e,n,r;return t.buffered&&(t.body.gap||(null==(e=t.range.video)?void 0:e.partial)||(null==(n=t.range.audio)?void 0:n.partial)||(null==(r=t.range.audiovideo)?void 0:r.partial))}function nn(t){return`${t.type}_${t.level}_${t.sn}`}const rn={length:0,start:()=>0,end:()=>0};class sn{static isBuffered(t,e){try{if(t){const n=sn.getBuffered(t);for(let i=0;i<n.length;i++)if(e>=n.start(i)&&e<=n.end(i))return!0}}catch(t){}return!1}static bufferInfo(t,e,n){try{if(t){const r=sn.getBuffered(t),o=[];let i;for(i=0;i<r.length;i++)o.push({start:r.start(i),end:r.end(i)});return this.bufferedInfo(o,e,n)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}}static bufferedInfo(t,e,n){e=Math.max(0,e),t.sort((function(a,b){const t=a.start-b.start;return t||b.end-a.end}));let r=[];if(n)for(let i=0;i<t.length;i++){const e=r.length;if(e){const o=r[e-1].end;t[i].start-o<n?t[i].end>o&&(r[e-1].end=t[i].end):r.push(t[i])}else r.push(t[i])}else r=t;let o,l=0,c=e,h=e;for(let i=0;i<r.length;i++){const t=r[i].start,d=r[i].end;if(e+n>=t&&e<d)c=t,h=d,l=h-e;else if(e+n<t){o=t;break}}return{len:l,start:c||0,end:h||0,nextStart:o}}static getBuffered(t){try{return t.buffered}catch(t){return x.log("failed to get media.buffered",t),rn}}}class an{constructor(t,e,n,r=0,o=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=n,this.size=r,this.part=o,this.partial=l}}function on(t,e){for(let i=0,r=t.length;i<r;i++){var n;if((null==(n=t[i])?void 0:n.cc)===e)return t[i]}return null}function ln(t,e){if(t){const n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}}function cn(t,details){const e=details.fragments;for(let i=0,n=e.length;i<n;i++)ln(e[i],t);details.fragmentHint&&ln(details.fragmentHint,t),details.alignedSliding=!0}function un(t,e,details){e&&(!function(t,details,e){if(function(t,e,details){return!(!e||!(details.endCC>details.startCC||t&&t.cc<details.startCC))}(t,e,details)){const t=function(t,e){const n=t.fragments,r=e.fragments;if(!r.length||!n.length)return void x.log("No fragments to align");const o=on(n,r[0].cc);if(o&&(!o||o.startPTS))return o;x.log("No frag in previous level to align on")}(e,details);t&&S(t.start)&&(x.log(`Adjusting PTS using last level due to CC increase within current level ${details.url}`),cn(t.start,details))}}(t,details,e),!details.alignedSliding&&e&&hn(details,e),details.alignedSliding||!e||details.skippedSegments||pi(e,details))}function hn(details,t){if(!details.hasProgramDateTime||!t.hasProgramDateTime)return;const e=details.fragments,n=t.fragments;if(!e.length||!n.length)return;let r,o;const l=Math.min(t.endCC,details.endCC);t.startCC<l&&details.startCC<l&&(r=on(n,l),o=on(e,l)),r&&o||(r=n[Math.floor(n.length/2)],o=on(e,r.cc)||e[Math.floor(e.length/2)]);const c=r.programDateTime,h=o.programDateTime;if(!c||!h)return;cn((h-c)/1e3-(o.start-r.start),details)}const dn=Math.pow(2,17);class fn{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const n=t.url;if(!n)return Promise.reject(new mn({type:A.NETWORK_ERROR,details:w.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error("Fragment does not have a "+(n?"part list":"url")),networkDetails:null}));this.abort();const r=this.config,o=r.fLoader,l=r.loader;return new Promise(((c,h)=>{if(this.loader&&this.loader.destroy(),t.gap){if(t.tagList.some((t=>"GAP"===t[0])))return void h(pn(t));t.gap=!1}const d=this.loader=t.loader=o?new o(r):new l(r),f=gn(t),m=Si(r.fragLoadPolicy.default),v={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===t.sn?1/0:dn};t.stats=d.stats,d.load(f,v,{onSuccess:(e,n,r,o)=>{this.resetLoader(t,d);let l=e.data;r.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(l.slice(0,16)),l=l.slice(16)),c({frag:t,part:null,payload:l,networkDetails:o})},onError:(e,r,o,l)=>{this.resetLoader(t,d),h(new mn({type:A.NETWORK_ERROR,details:w.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:y({url:n,data:void 0},e),error:new Error(`HTTP Error ${e.code} ${e.text}`),networkDetails:o,stats:l}))},onAbort:(e,n,r)=>{this.resetLoader(t,d),h(new mn({type:A.NETWORK_ERROR,details:w.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:r,stats:e}))},onTimeout:(e,n,r)=>{this.resetLoader(t,d),h(new mn({type:A.NETWORK_ERROR,details:w.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:r,stats:e}))},onProgress:(n,r,data,o)=>{e&&e({frag:t,part:null,payload:data,networkDetails:o})}})}))}loadPart(t,e,n){this.abort();const r=this.config,o=r.fLoader,l=r.loader;return new Promise(((c,h)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap)return void h(pn(t,e));const d=this.loader=t.loader=o?new o(r):new l(r),f=gn(t,e),m=Si(r.fragLoadPolicy.default),v={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:dn};e.stats=d.stats,d.load(f,v,{onSuccess:(r,o,l,h)=>{this.resetLoader(t,d),this.updateStatsFromPart(t,e);const f={frag:t,part:e,payload:r.data,networkDetails:h};n(f),c(f)},onError:(n,r,o,l)=>{this.resetLoader(t,d),h(new mn({type:A.NETWORK_ERROR,details:w.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:y({url:f.url,data:void 0},n),error:new Error(`HTTP Error ${n.code} ${n.text}`),networkDetails:o,stats:l}))},onAbort:(n,r,o)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,d),h(new mn({type:A.NETWORK_ERROR,details:w.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:o,stats:n}))},onTimeout:(n,r,o)=>{this.resetLoader(t,d),h(new mn({type:A.NETWORK_ERROR,details:w.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:o,stats:n}))}})}))}updateStatsFromPart(t,e){const n=t.stats,r=e.stats,o=r.total;if(n.loaded+=r.loaded,o){const r=Math.round(t.duration/e.duration),l=Math.min(Math.round(n.loaded/o),r),c=(r-l)*Math.round(n.loaded/l);n.total=n.loaded+c}else n.total=Math.max(n.loaded,n.total);const l=n.loading,c=r.loading;l.start?l.first+=c.first-c.start:(l.start=c.start,l.first=c.first),l.end=c.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function gn(t,e=null){const n=e||t,r={frag:t,part:e,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},o=n.byteRangeStartOffset,l=n.byteRangeEndOffset;if(S(o)&&S(l)){var c;let e=o,n=l;if("initSegment"===t.sn&&"AES-128"===(null==(c=t.decryptdata)?void 0:c.method)){const t=l-o;t%16&&(n=l+(16-t%16)),0!==o&&(r.resetIV=!0,e=o-16)}r.rangeStart=e,r.rangeEnd=n}return r}function pn(t,e){const n=new Error(`GAP ${t.gap?"tag":"attribute"} found`),r={type:A.MEDIA_ERROR,details:w.FRAG_GAP,fatal:!1,frag:t,error:n,networkDetails:null};return e&&(r.part=e),(e||t).stats.aborted=!0,new mn(r)}class mn extends Error{constructor(data){super(data.error.message),this.data=void 0,this.data=data}}class vn{constructor(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}decrypt(data,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,data)}}class yn{constructor(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class bn{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const view=new DataView(t),e=new Uint32Array(4);for(let i=0;i<4;i++)e[i]=view.getUint32(4*i);return e}initTable(){const t=this.sBox,e=this.invSBox,n=this.subMix,r=n[0],o=n[1],l=n[2],c=n[3],h=this.invSubMix,d=h[0],f=h[1],m=h[2],v=h[3],y=new Uint32Array(256);let T=0,E=0,i=0;for(i=0;i<256;i++)y[i]=i<128?i<<1:i<<1^283;for(i=0;i<256;i++){let n=E^E<<1^E<<2^E<<3^E<<4;n=n>>>8^255&n^99,t[T]=n,e[n]=T;const h=y[T],k=y[h],S=y[k];let _=257*y[n]^16843008*n;r[T]=_<<24|_>>>8,o[T]=_<<16|_>>>16,l[T]=_<<8|_>>>24,c[T]=_,_=16843009*S^65537*k^257*h^16843008*T,d[n]=_<<24|_>>>8,f[n]=_<<16|_>>>16,m[n]=_<<8|_>>>24,v[n]=_,T?(T=h^y[y[y[S^h]]],E^=y[y[E]]):T=E=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let n=!0,r=0;for(;r<e.length&&n;)n=e[r]===this.key[r],r++;if(n)return;this.key=e;const o=this.keySize=e.length;if(4!==o&&6!==o&&8!==o)throw new Error("Invalid aes key size="+o);const l=this.ksRows=4*(o+6+1);let c,h;const d=this.keySchedule=new Uint32Array(l),f=this.invKeySchedule=new Uint32Array(l),m=this.sBox,v=this.rcon,y=this.invSubMix,T=y[0],E=y[1],k=y[2],S=y[3];let _,L;for(c=0;c<l;c++)c<o?_=d[c]=e[c]:(L=_,c%o==0?(L=L<<8|L>>>24,L=m[L>>>24]<<24|m[L>>>16&255]<<16|m[L>>>8&255]<<8|m[255&L],L^=v[c/o|0]<<24):o>6&&c%o==4&&(L=m[L>>>24]<<24|m[L>>>16&255]<<16|m[L>>>8&255]<<8|m[255&L]),d[c]=_=(d[c-o]^L)>>>0);for(h=0;h<l;h++)c=l-h,L=3&h?d[c]:d[c-4],f[h]=h<4||c<=4?L:T[m[L>>>24]]^E[m[L>>>16&255]]^k[m[L>>>8&255]]^S[m[255&L]],f[h]=f[h]>>>0}networkToHostOrderSwap(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24}decrypt(t,e,n){const r=this.keySize+6,o=this.invKeySchedule,l=this.invSBox,c=this.invSubMix,h=c[0],d=c[1],f=c[2],m=c[3],v=this.uint8ArrayToUint32Array_(n);let y=v[0],T=v[1],E=v[2],k=v[3];const S=new Int32Array(t),_=new Int32Array(S.length);let L,C,A,w,O,R,D,I,x,P,M,F,N,i;const j=this.networkToHostOrderSwap;for(;e<S.length;){for(x=j(S[e]),P=j(S[e+1]),M=j(S[e+2]),F=j(S[e+3]),O=x^o[0],R=F^o[1],D=M^o[2],I=P^o[3],N=4,i=1;i<r;i++)L=h[O>>>24]^d[R>>16&255]^f[D>>8&255]^m[255&I]^o[N],C=h[R>>>24]^d[D>>16&255]^f[I>>8&255]^m[255&O]^o[N+1],A=h[D>>>24]^d[I>>16&255]^f[O>>8&255]^m[255&R]^o[N+2],w=h[I>>>24]^d[O>>16&255]^f[R>>8&255]^m[255&D]^o[N+3],O=L,R=C,D=A,I=w,N+=4;L=l[O>>>24]<<24^l[R>>16&255]<<16^l[D>>8&255]<<8^l[255&I]^o[N],C=l[R>>>24]<<24^l[D>>16&255]<<16^l[I>>8&255]<<8^l[255&O]^o[N+1],A=l[D>>>24]<<24^l[I>>16&255]<<16^l[O>>8&255]<<8^l[255&R]^o[N+2],w=l[I>>>24]<<24^l[O>>16&255]<<16^l[R>>8&255]<<8^l[255&D]^o[N+3],_[e]=j(L^y),_[e+1]=j(w^T),_[e+2]=j(A^E),_[e+3]=j(C^k),y=x,T=P,E=M,k=F,e+=4}return _.buffer}}class Tn{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const t=self.crypto;t&&(this.subtle=t.subtle||t.webkitSubtle)}catch(t){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const data=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?function(t){const e=t.byteLength,n=e&&new DataView(t.buffer).getUint8(e-1);return n?ut(t,0,e-n):t}(data):data}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(data,t,e){return this.useSoftware?new Promise(((n,r)=>{this.softwareDecrypt(new Uint8Array(data),t,e);const o=this.flush();o?n(o.buffer):r(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(data),t,e)}softwareDecrypt(data,t,e){const{currentIV:n,currentResult:r,remainderData:o}=this;this.logOnce("JS AES decrypt"),o&&(data=qt(o,data),this.remainderData=null);const l=this.getValidChunk(data);if(!l.length)return null;n&&(e=n);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new bn),c.expandKey(t);const h=r;return this.currentResult=c.decrypt(l.buffer,0,e),this.currentIV=ut(l,-16).buffer,h||null}webCryptoDecrypt(data,t,e){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(data,t,e));this.key=t,this.fastAesKey=new yn(this.subtle,t)}return this.fastAesKey.expandKey().then((t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new vn(this.subtle,new Uint8Array(e)).decrypt(data.buffer,t)})).catch((n=>(x.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(data,t,e))))}onWebCryptoError(data,t,e){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(data,t,e);const n=this.flush();if(n)return n.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(data){let t=data;const e=data.length-data.length%16;return e!==data.length&&(t=ut(data,0,e),this.remainderData=ut(data,e)),t}logOnce(t){this.logEnabled&&(x.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const En=function(t){let e="";const n=t.length;for(let i=0;i<n;i++)e+=`[${t.start(i).toFixed(3)}-${t.end(i).toFixed(3)}]`;return e},kn="STOPPED",Sn="IDLE",_n="KEY_LOADING",Ln="FRAG_LOADING",Cn="FRAG_LOADING_WAITING_RETRY",An="WAITING_TRACK",wn="PARSING",On="PARSED",Rn="ENDED",Dn="ERROR",In="WAITING_INIT_PTS",xn="WAITING_LEVEL";class Pn extends zi{constructor(t,e,n,r,o){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=kn,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=o,this.logPrefix=r,this.log=x.log.bind(x,`${r}:`),this.warn=x.warn.bind(x,`${r}:`),this.hls=t,this.fragmentLoader=new fn(t.config),this.keyLoader=n,this.fragmentTracker=e,this.config=t.config,this.decrypter=new Tn(t.config),t.on(C.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;null!=t&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=kn}_streamEnded(t,e){if(e.live||t.nextStart||!t.end||!this.media)return!1;const n=e.partList;if(null!=n&&n.length){const t=n[n.length-1];return sn.isBuffered(this.media,t.start+t.duration/2)}const r=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(r)}getLevelDetails(){var t;if(this.levels&&null!==this.levelLastLoaded)return null==(t=this.levelLastLoaded)?void 0:t.details}onMediaAttached(t,data){const e=this.media=this.mediaBuffer=data.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);const n=this.config;this.levels&&n.autoStartLoad&&this.state===kn&&this.startLoad(n.startPosition)}onMediaDetaching(){const t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:t,fragCurrent:e,media:n,mediaBuffer:r,state:o}=this,l=n?n.currentTime:0,c=sn.bufferInfo(r||n,l,t.maxBufferHole);if(this.log(`media seeking to ${S(l)?l.toFixed(3):l}, state: ${o}`),this.state===Rn)this.resetLoadingState();else if(e){const n=t.maxFragLookUpTolerance,r=e.start-n,o=e.start+e.duration+n;if(!c.len||o<c.start||r>c.end){const t=l>o;(l<r||t)&&(t&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}n&&(this.fragmentTracker.removeFragmentsInRange(l,1/0,this.playlistType,!0),this.lastCurrentTime=l),this.loadedmetadata||c.len||(this.nextLoadPosition=this.startPosition=l),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(t,data){this.startTimeOffset=data.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=kn,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,n){this._loadFragForPlayback(t,e,n)}_loadFragForPlayback(t,e,n){this._doFragLoad(t,e,n,(data=>{if(this.fragContextChanged(t))return this.warn(`Fragment ${t.sn}${data.part?" p: "+data.part.index:""} of level ${t.level} was dropped during download.`),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(data)})).then((data=>{if(!data)return;const e=this.state;this.fragContextChanged(t)?(e===Ln||!this.fragCurrent&&e===wn)&&(this.fragmentTracker.removeFragment(t),this.state=Sn):("payload"in data&&(this.log(`Loaded fragment ${t.sn} of level ${t.level}`),this.hls.trigger(C.FRAG_LOADED,data)),this._handleFragmentLoadComplete(data))})).catch((e=>{this.state!==kn&&this.state!==Dn&&(this.warn(`Frag error: ${(null==e?void 0:e.message)||e}`),this.resetFragmentLoading(t))}))}clearTrackerIfNeeded(t){var e;const{fragmentTracker:n}=this;if(n.getState(t)===Qi){const e=t.type,r=this.getFwdBufferInfo(this.mediaBuffer,e),o=Math.max(t.duration,r?r.len:this.config.maxBufferLength),l=this.backtrackFragment;(1===(l?t.sn-l.sn:0)||this.reduceMaxBufferLength(o,t.duration))&&n.removeFragment(t)}else 0===(null==(e=this.mediaBuffer)?void 0:e.buffered.length)?n.removeAllFragments():n.hasParts(t.type)&&(n.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),n.getState(t)===Ji&&n.removeFragment(t))}checkLiveUpdate(details){if(details.updated&&!details.live){const t=details.fragments[details.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}details.fragments[0]||(details.deltaUpdateFailed=!0)}flushMainBuffer(t,e,n=null){if(!(t-e))return;const r={startOffset:t,endOffset:e,type:n};this.hls.trigger(C.BUFFER_FLUSHING,r)}_loadInitSegment(t,e){this._doFragLoad(t,e).then((data=>{if(!data||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return data})).then((data=>{const{hls:e}=this,{payload:n}=data,r=t.decryptdata;if(n&&n.byteLength>0&&null!=r&&r.key&&r.iv&&"AES-128"===r.method){const o=self.performance.now();return this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer).catch((n=>{throw e.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.FRAG_DECRYPT_ERROR,fatal:!1,error:n,reason:n.message,frag:t}),n})).then((n=>{const r=self.performance.now();return e.trigger(C.FRAG_DECRYPTED,{frag:t,payload:n,stats:{tstart:o,tdecrypt:r}}),data.payload=n,this.completeInitSegmentLoad(data)}))}return this.completeInitSegmentLoad(data)})).catch((e=>{this.state!==kn&&this.state!==Dn&&(this.warn(e),this.resetFragmentLoading(t))}))}completeInitSegmentLoad(data){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const e=data.frag.stats;this.state=Sn,data.frag.data=new Uint8Array(data.payload),e.parsing.start=e.buffering.start=self.performance.now(),e.parsing.end=e.buffering.end=self.performance.now(),this.tick()}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.sn!==e.sn||t.level!==e.level}fragBufferedComplete(t,e){var n,r,o,l;const c=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.playlistType===Fe?"level":"track"} ${t.level} (frag:[${(null!=(n=t.startPTS)?n:NaN).toFixed(3)}-${(null!=(r=t.endPTS)?r:NaN).toFixed(3)}] > buffer:${c?En(sn.getBuffered(c)):"(detached)"})`),"initSegment"!==t.sn){var h;if(t.type!==je){const e=t.elementaryStreams;if(!Object.keys(e).some((t=>!!e[t])))return void(this.state=Sn)}const e=null==(h=this.levels)?void 0:h[t.level];null!=e&&e.fragmentError&&(this.log(`Resetting level fragment error count of ${e.fragmentError} on frag buffered`),e.fragmentError=0)}this.state=Sn,c&&(!this.loadedmetadata&&t.type==Fe&&c.buffered.length&&(null==(o=this.fragCurrent)?void 0:o.sn)===(null==(l=this.fragPrevious)?void 0:l.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:n,part:r,partsLoaded:o}=t,l=!o||0===o.length||o.some((t=>!t)),c=new an(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!l);e.flush(c)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,n=null,r){var o;const details=null==e?void 0:e.details;if(!this.levels||!details)throw new Error(`frag load aborted, missing level${details?"":" detail"}s`);let l=null;if(!t.encrypted||null!=(o=t.decryptdata)&&o.key?!t.encrypted&&details.encryptedFragments.length&&this.keyLoader.loadClear(t,details.encryptedFragments):(this.log(`Loading key for ${t.sn} of [${details.startSN}-${details.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${t.level}`),this.state=_n,this.fragCurrent=t,l=this.keyLoader.load(t).then((t=>{if(!this.fragContextChanged(t.frag))return this.hls.trigger(C.KEY_LOADED,t),this.state===_n&&(this.state=Sn),t})),this.hls.trigger(C.KEY_LOADING,{frag:t}),null===this.fragCurrent&&(l=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),n=Math.max(t.start,n||0),this.config.lowLatencyMode&&"initSegment"!==t.sn){const o=details.partList;if(o&&r){n>t.end&&details.fragmentHint&&(t=details.fragmentHint);const c=this.getNextPart(o,t,n);if(c>-1){const h=o[c];let d;return this.log(`Loading part sn: ${t.sn} p: ${h.index} cc: ${t.cc} of playlist [${details.startSN}-${details.endSN}] parts [0-${c}-${o.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${t.level}, target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=h.start+h.duration,this.state=Ln,d=l?l.then((n=>!n||this.fragContextChanged(n.frag)?null:this.doFragPartsLoad(t,h,e,r))).catch((t=>this.handleFragLoadError(t))):this.doFragPartsLoad(t,h,e,r).catch((t=>this.handleFragLoadError(t))),this.hls.trigger(C.FRAG_LOADING,{frag:t,part:h,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):d}if(!t.url||this.loadedEndOfParts(o,n))return Promise.resolve(null)}}this.log(`Loading fragment ${t.sn} cc: ${t.cc} ${details?"of ["+details.startSN+"-"+details.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${t.level}, target: ${parseFloat(n.toFixed(3))}`),S(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=Ln;const c=this.config.progressive;let h;return h=c&&l?l.then((e=>!e||this.fragContextChanged(null==e?void 0:e.frag)?null:this.fragmentLoader.load(t,r))).catch((t=>this.handleFragLoadError(t))):Promise.all([this.fragmentLoader.load(t,c?r:void 0),l]).then((([t])=>(!c&&t&&r&&r(t),t))).catch((t=>this.handleFragLoadError(t))),this.hls.trigger(C.FRAG_LOADING,{frag:t,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(t,e,n,r){return new Promise(((o,l)=>{var c;const h=[],d=null==(c=n.details)?void 0:c.partList,f=e=>{this.fragmentLoader.loadPart(t,e,r).then((r=>{h[e.index]=r;const l=r.part;this.hls.trigger(C.FRAG_LOADED,r);const c=vi(n,t.sn,e.index+1)||yi(d,t.sn,e.index+1);if(!c)return o({frag:t,part:l,partsLoaded:h});f(c)})).catch(l)};f(e)}))}handleFragLoadError(t){if("data"in t){const data=t.data;t.data&&data.details===w.INTERNAL_ABORTED?this.handleFragLoadAborted(data.frag,data.part):this.hls.trigger(C.ERROR,data)}else this.hls.trigger(C.ERROR,{type:A.OTHER_ERROR,details:w.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==wn)return void(this.fragCurrent||this.state===kn||this.state===Dn||(this.state=Sn));const{frag:n,part:r,level:o}=e,l=self.performance.now();n.stats.parsing.end=l,r&&(r.stats.parsing.end=l),this.updateLevelTiming(n,r,o,t.partial)}getCurrentContext(t){const{levels:e,fragCurrent:n}=this,{level:r,sn:o,part:l}=t;if(null==e||!e[r])return this.warn(`Levels object was unset while buffering fragment ${o} of level ${r}. The current chunk will not be buffered.`),null;const c=e[r],h=l>-1?vi(c,o,l):null,d=h?h.fragment:function(t,e,n){if(null==t||!t.details)return null;const r=t.details;let o=r.fragments[e-r.startSN];return o||(o=r.fragmentHint,o&&o.sn===e?o:e<r.startSN&&n&&n.sn===e?n:null)}(c,o,n);return d?(n&&n!==d&&(d.stats=n.stats),{frag:d,part:h,level:c}):null}bufferFragmentData(data,t,e,n,r){var o;if(!data||this.state!==wn)return;const{data1:l,data2:c}=data;let h=l;if(l&&c&&(h=qt(l,c)),null==(o=h)||!o.length)return;const d={type:data.type,frag:t,part:e,chunkMeta:n,parent:t.type,data:h};if(this.hls.trigger(C.BUFFER_APPENDING,d),data.dropped&&data.independent&&!e){if(r)return;this.flushBufferGap(t)}}flushBufferGap(t){const e=this.media;if(!e)return;if(!sn.isBuffered(e,e.currentTime))return void this.flushMainBuffer(0,t.start);const n=e.currentTime,r=sn.bufferInfo(e,n,0),o=t.duration,l=Math.min(2*this.config.maxFragLookUpTolerance,.25*o),c=Math.max(Math.min(t.start-l,r.end-l),n+l);t.start-c>l&&this.flushMainBuffer(c,t.start)}getFwdBufferInfo(t,e){const n=this.getLoadPosition();return S(n)?this.getFwdBufferInfoAtPos(t,n,e):null}getFwdBufferInfoAtPos(t,e,n){const{config:{maxBufferHole:r}}=this,o=sn.bufferInfo(t,e,r);if(0===o.len&&void 0!==o.nextStart){const l=this.fragmentTracker.getBufferedFrag(e,n);if(l&&o.nextStart<l.end)return sn.bufferInfo(t,e,Math.max(o.nextStart,r))}return o}getMaxBufferLength(t){const{config:e}=this;let n;return n=t?Math.max(8*e.maxBufferSize/t,e.maxBufferLength):e.maxBufferLength,Math.min(n,e.maxMaxBufferLength)}reduceMaxBufferLength(t,e){const n=this.config,r=Math.max(Math.min(t-e,n.maxBufferLength),e),o=Math.max(t-3*e,n.maxMaxBufferLength/2,r);return o>=r&&(n.maxMaxBufferLength=o,this.warn(`Reduce max buffer length to ${o}s`),!0)}getAppendedFrag(t,e=Fe){const n=this.fragmentTracker.getAppendedFrag(t,Fe);return n&&"fragment"in n?n.fragment:n}getNextFragment(t,e){const n=e.fragments,r=n.length;if(!r)return null;const{config:o}=this,l=n[0].start;let c;if(e.live){const h=o.initialLiveManifestSize;if(r<h)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${h})`),null;(!e.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||t<l)&&(c=this.getInitialLiveFragment(e,n),this.startPosition=this.nextLoadPosition=c?this.hls.liveSyncPosition||c.start:t)}else t<=l&&(c=n[0]);if(!c){const n=o.lowLatencyMode?e.partEnd:e.fragmentEnd;c=this.getFragmentAtPosition(t,n,e)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(t,e){const n=this.fragmentTracker.getState(t);return(n===Zi||n===Ji&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,n,r,o){const l=t.gap,c=this.getNextFragment(this.nextLoadPosition,e);if(null===c)return c;if(t=c,l&&t&&!t.gap&&n.nextStart){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r);if(null!==e&&n.len+e.len>=o)return this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${t.sn}`),null}return t}mapToInitFragWhenRequired(t){return null==t||!t.initSegment||null!=t&&t.initSegment.data||this.bitrateTest?t:t.initSegment}getNextPart(t,e,n){let r=-1,o=!1,l=!0;for(let i=0,c=t.length;i<c;i++){const c=t[i];if(l=l&&!c.independent,r>-1&&n<c.start)break;const h=c.loaded;h?r=-1:(o||c.independent||l)&&c.fragment===e&&(r=i),o=h}return r}loadedEndOfParts(t,e){const n=t[t.length-1];return n&&e>n.start&&n.loaded}getInitialLiveFragment(t,e){const n=this.fragPrevious;let r=null;if(n){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),r=function(t,e,n){if(null===e||!Array.isArray(t)||!t.length||!S(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;n=n||0;for(let r=0;r<t.length;++r){const o=t[r];if(wi(e,n,o))return o}return null}(e,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const o=n.sn+1;if(o>=t.startSN&&o<=t.endSN){const l=e[o-t.startSN];n.cc===l.cc&&(r=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=function(t,e){return Li(t,(t=>t.cc<e?1:t.cc>e?-1:0))}(e,n.cc),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const e=this.hls.liveSyncPosition;null!==e&&(r=this.getFragmentAtPosition(e,this.bitrateTest?t.fragmentEnd:t.edge,t))}return r}getFragmentAtPosition(t,e,n){const{config:r}=this;let{fragPrevious:o}=this,{fragments:l,endSN:c}=n;const{fragmentHint:h}=n,{maxFragLookUpTolerance:d}=r,f=n.partList,m=!!(r.lowLatencyMode&&null!=f&&f.length&&h);let v;if(m&&h&&!this.bitrateTest&&(l=l.concat(h),c=h.sn),t<e){v=Ci(o,l,t,t>e-d?0:d)}else v=l[l.length-1];if(v){const t=v.sn-n.startSN,e=this.fragmentTracker.getState(v);if((e===Zi||e===Ji&&v.gap)&&(o=v),o&&v.sn===o.sn&&(!m||f[0].fragment.sn>v.sn)){if(o&&v.level===o.level){const e=l[t+1];v=v.sn<c&&this.fragmentTracker.getState(e)!==Zi?e:null}}}return v}synchronizeToLiveEdge(t){const{config:e,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,o=n.currentTime,l=t.fragments[0].start,c=t.edge,h=o>=l-e.maxFragLookUpTolerance&&o<=c;if(null!==r&&n.duration>r&&(o<r||!h)){const l=void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;(!h&&n.readyState<4||o<c-l)&&(this.loadedmetadata||(this.nextLoadPosition=r),n.readyState&&(this.warn(`Playback: ${o.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${r.toFixed(3)}`),n.currentTime=r))}}alignPlaylists(details,t,e){const n=details.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const r=details.fragments[0].start,o=!t,l=details.alignedSliding&&S(r);if(o||!l&&!r){const{fragPrevious:r}=this;un(r,e,details);const o=details.fragments[0].start;return this.log(`Live playlist sliding: ${o.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${details.startSN} prev-sn: ${r?r.sn:"na"} fragments: ${n}`),o}return r}waitForCdnTuneIn(details){return details.live&&details.canBlockReload&&details.partTarget&&details.tuneInGoal>Math.max(details.partHoldBack,3*details.partTarget)}setStartPosition(details,t){let e=this.startPosition;if(e<t&&(e=-1),-1===e||-1===this.lastCurrentTime){const n=null!==this.startTimeOffset,r=n?this.startTimeOffset:details.startTimeOffset;null!==r&&S(r)?(e=t+r,r<0&&(e+=details.totalduration),e=Math.min(Math.max(t,e),t+details.totalduration),this.log(`Start time offset ${r} found in ${n?"multivariant":"media"} playlist, adjust startPosition to ${e}`),this.startPosition=e):details.live?e=this.hls.liveSyncPosition||t:this.startPosition=e=0,this.lastCurrentTime=e}this.nextLoadPosition=e}getLoadPosition(){const{media:t}=this;let e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e}handleFragLoadAborted(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn(`Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===Cn)||(this.state=Sn)}onFragmentOrKeyLoadError(t,data){if(data.chunkMeta&&!data.frag){const t=this.getCurrentContext(data.chunkMeta);t&&(data.frag=t.frag)}const e=data.frag;if(!e||e.type!==t||!this.levels)return;var n;if(this.fragContextChanged(e))return void this.warn(`Frag load error must match current frag to retry ${e.url} > ${null==(n=this.fragCurrent)?void 0:n.url}`);const r=data.details===w.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(e,!0);const o=data.errorAction,{action:l,retryCount:c=0,retryConfig:h}=o||{};if(o&&l===Ii&&h){this.resetStartWhenNotLoaded(this.levelLastLoaded);const n=ki(h,c);this.warn(`Fragment ${e.sn} of ${t} ${e.level} errored with ${data.details}, retrying loading ${c+1}/${h.maxNumRetry} in ${n}ms`),o.resolved=!0,this.retryDate=self.performance.now()+n,this.state=Cn}else if(h&&o){if(this.resetFragmentErrors(t),!(c<h.maxNumRetry))return void x.warn(`${data.details} reached or exceeded max retry (${c})`);r||l===Di||(o.resolved=!0)}else(null==o?void 0:o.action)===Ri?this.state=xn:this.state=Dn;this.tickImmediate()}reduceLengthAndFlushBuffer(data){if(this.state===wn||this.state===On){const t=data.frag,e=data.parent,n=this.getFwdBufferInfo(this.mediaBuffer,e),r=n&&n.len>.5;r&&this.reduceMaxBufferLength(n.len,(null==t?void 0:t.duration)||10);const o=!r;return o&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${e} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(t){t===Ne&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==kn&&(this.state=Sn)}afterBufferFlushed(t,e,n){if(!t)return;const r=sn.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,r,n),this.state===Rn&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Sn}resetStartWhenNotLoaded(t){if(!this.loadedmetadata){this.startFragRequested=!1;const details=t?t.details:null;null!=details&&details.live?(this.startPosition=-1,this.setStartPosition(details,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.warn(`The loading context changed while buffering fragment ${t.sn} of level ${t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,n,r){var o;const details=n.details;if(!details)return void this.warn("level.details undefined");if(!Object.keys(t.elementaryStreams).reduce(((e,o)=>{const l=t.elementaryStreams[o];if(l){const c=l.endPTS-l.startPTS;if(c<=0)return this.warn(`Could not parse fragment ${t.sn} ${o} duration reliably (${c})`),e||!1;const h=r?0:fi(details,t,l.startPTS,l.endPTS,l.startDTS,l.endDTS);return this.hls.trigger(C.LEVEL_PTS_UPDATED,{details:details,level:n,drift:h,type:o,frag:t,start:l.startPTS,end:l.endPTS}),!0}return e}),!1)&&null===(null==(o=this.transmuxer)?void 0:o.error)){const e=new Error(`Found no media in fragment ${t.sn} of level ${t.level} resetting transmuxer to fallback to playlist timing`);if(0===n.fragmentError&&(n.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)),this.warn(e.message),this.hls.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!1,error:e,frag:t,reason:`Found no media in msn ${t.sn} of level "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=On,this.hls.trigger(C.FRAG_PARSED,{frag:t,part:e})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(data){"demuxerWorker"===data.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}class Mn{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let n;return t.length?(n=1===t.length?t[0]:function(t,e){const n=new Uint8Array(e);let r=0;for(let i=0;i<t.length;i++){const e=t[i];n.set(e,r),r+=e.length}return n}(t,e),this.reset(),n):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function Fn(t="",e=9e4){return{type:t,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Nn{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(data,t){return!1}appendFrame(track,data,t){}demux(data,t){this.cachedData&&(data=qt(this.cachedData,data),this.cachedData=null);let e,n=gt(data,0),r=n?n.length:0;const track=this._audioTrack,o=this._id3Track,l=n?vt(n):void 0,c=data.length;for((null===this.basePTS||0===this.frameIndex&&S(l))&&(this.basePTS=jn(l,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),n&&n.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Ye,duration:Number.POSITIVE_INFINITY});r<c;){if(this.canParse(data,r)){const t=this.appendFrame(track,data,r);t?(this.frameIndex++,this.lastPTS=t.sample.pts,r+=t.length,e=r):r=c}else mt(data,r)?(n=gt(data,r),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Ye,duration:Number.POSITIVE_INFINITY}),r+=n.length,e=r):r++;if(r===c&&e!==c){const t=ut(data,e);this.cachedData?this.cachedData=qt(this.cachedData,t):this.cachedData=t}}return{audioTrack:track,videoTrack:Fn(),id3Track:o,textTrack:Fn()}}demuxSampleAes(data,t,e){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Fn(),id3Track:this._id3Track,textTrack:Fn()}}destroy(){}}const jn=(t,e,n)=>{if(S(t))return 90*t;return 9e4*e+(n?9e4*n.baseTime/n.timescale:0)};function Un(data,t){return 255===data[t]&&240==(246&data[t+1])}function Bn(data,t){return 1&data[t+1]?7:9}function $n(data,t){return(3&data[t+3])<<11|data[t+4]<<3|(224&data[t+5])>>>5}function Hn(data,t){return t+1<data.length&&Un(data,t)}function Gn(data,t){if(Hn(data,t)){const e=Bn(data,t);if(t+e>=data.length)return!1;const n=$n(data,t);if(n<=e)return!1;const r=t+n;return r===data.length||Hn(data,r)}return!1}function Kn(track,t,data,e,n){if(!track.samplerate){const r=function(t,data,e,n){let r,o,l,c;const h=navigator.userAgent.toLowerCase(),d=n,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=1+((192&data[e+2])>>>6);const m=(60&data[e+2])>>>2;if(!(m>f.length-1))return l=(1&data[e+2])<<2,l|=(192&data[e+3])>>>6,x.log(`manifest codec:${n}, ADTS type:${r}, samplingIndex:${m}`),/firefox/i.test(h)?m>=6?(r=5,c=new Array(4),o=m-3):(r=2,c=new Array(2),o=m):-1!==h.indexOf("android")?(r=2,c=new Array(2),o=m):(r=5,c=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&m>=6?o=m-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(m>=6&&1===l||/vivaldi/i.test(h))||!n&&1===l)&&(r=2,c=new Array(2)),o=m)),c[0]=r<<3,c[0]|=(14&m)>>1,c[1]|=(1&m)<<7,c[1]|=l<<3,5===r&&(c[1]|=(14&o)>>1,c[2]=(1&o)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:f[m],channelCount:l,codec:"mp4a.40."+r,manifestCodec:d};{const e=new Error(`invalid ADTS sampling index:${m}`);t.emit(C.ERROR,C.ERROR,{type:A.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!0,error:e,reason:e.message})}}(t,data,e,n);if(!r)return;track.config=r.config,track.samplerate=r.samplerate,track.channelCount=r.channelCount,track.codec=r.codec,track.manifestCodec=r.manifestCodec,x.log(`parsed codec:${track.codec}, rate:${r.samplerate}, channels:${r.channelCount}`)}}function Vn(t){return 9216e4/t}function Wn(track,data,t,e,n){const r=e+n*Vn(track.samplerate),header=function(data,t){const e=Bn(data,t);if(t+e<=data.length){const n=$n(data,t)-e;if(n>0)return{headerLength:e,frameLength:n}}}(data,t);let o;if(header){const{frameLength:e,headerLength:n}=header,l=n+e,c=Math.max(0,t+l-data.length);c?(o=new Uint8Array(l-n),o.set(data.subarray(t+n,data.length),0)):o=data.subarray(t+n,t+l);const h={unit:o,pts:r};return c||track.samples.push(h),{sample:h,length:l,missing:c}}const l=data.length-t;o=new Uint8Array(l),o.set(data.subarray(t,data.length),0);return{sample:{unit:o,pts:r},length:l,missing:-1}}let Yn=null;const qn=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],zn=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Xn=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Qn=[0,1,1,4];function Jn(track,data,t,e,n){if(t+24>data.length)return;const header=Zn(data,t);if(header&&t+header.frameLength<=data.length){const r=e+n*(9e4*header.samplesPerFrame/header.sampleRate),o={unit:data.subarray(t,t+header.frameLength),pts:r,dts:r};return track.config=[],track.channelCount=header.channelCount,track.samplerate=header.sampleRate,track.samples.push(o),{sample:o,length:header.frameLength,missing:0}}}function Zn(data,t){const e=data[t+1]>>3&3,n=data[t+1]>>1&3,r=data[t+2]>>4&15,o=data[t+2]>>2&3;if(1!==e&&0!==r&&15!==r&&3!==o){const l=data[t+2]>>1&1,c=data[t+3]>>6,h=1e3*qn[14*(3===e?3-n:3===n?3:4)+r-1],d=zn[3*(3===e?0:2===e?1:2)+o],f=3===c?1:2,m=Xn[e][n],v=Qn[n],y=8*m*v,T=Math.floor(m*h/d+l)*v;if(null===Yn){const t=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Yn=t?parseInt(t[1]):0}return!!Yn&&Yn<=87&&2===n&&h>=224e3&&0===c&&(data[t+3]=128|data[t+3]),{sampleRate:d,channelCount:f,frameLength:T,samplesPerFrame:y}}}function er(data,t){return!(255!==data[t]||224&~data[t+1]||!(6&data[t+1]))}function ir(data,t){return t+1<data.length&&er(data,t)}function nr(data,t){if(t+1<data.length&&er(data,t)){const e=4,header=Zn(data,t);let n=e;null!=header&&header.frameLength&&(n=header.frameLength);const r=t+n;return r===data.length||ir(data,r)}return!1}const rr=/\/emsg[-/]ID3/i;const sr=(data,t)=>{let e=0,n=5;t+=n;const r=new Uint32Array(1),mask=new Uint32Array(1),o=new Uint8Array(1);for(;n>0;){o[0]=data[t];const l=Math.min(n,8),c=8-l;mask[0]=4278190080>>>24+c<<c,r[0]=(o[0]&mask[0])>>c,e=e?e<<l|r[0]:r[0],t+=1,n-=l}return e};class ar extends Nn{constructor(t){super(),this.observer=void 0,this.observer=t}resetInitSegment(t,e,n,r){super.resetInitSegment(t,e,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}canParse(data,t){return t+64<data.length}appendFrame(track,data,t){const e=or(track,data,t,this.basePTS,this.frameIndex);if(-1!==e){return{sample:track.samples[track.samples.length-1],length:e,missing:0}}}static probe(data){if(!data)return!1;const t=gt(data,0);if(!t)return!1;const e=t.length;return 11===data[e]&&119===data[e+1]&&void 0!==vt(t)&&sr(data,e)<16}}function or(track,data,t,e,n){if(t+8>data.length)return-1;if(11!==data[t]||119!==data[t+1])return-1;const r=data[t+4]>>6;if(r>=3)return-1;const o=[48e3,44100,32e3][r],l=63&data[t+4],c=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*l+r];if(t+c>data.length)return-1;const h=data[t+6]>>5;let d=0;2===h?d+=2:(1&h&&1!==h&&(d+=2),4&h&&(d+=2));const f=(data[t+6]<<8|data[t+7])>>12-d&1,m=[2,1,2,3,3,4,4,5][h]+f,v=data[t+5]>>3,y=7&data[t+5],T=new Uint8Array([r<<6|v<<1|y>>2,(3&y)<<6|h<<3|f<<2|l>>4,l<<4&224]),E=e+n*(1536/o*9e4),k=data.subarray(t,t+c);return track.config=T,track.channelCount=m,track.samplerate=o,track.samples.push({unit:k,pts:E}),c}class lr{constructor(){this.VideoSample=null}createVideoSample(t,e,n,r){return{key:t,frame:!1,pts:e,dts:n,units:[],debug:r,length:0}}getLastNalUnit(t){var e;let n,r=this.VideoSample;if(r&&0!==r.units.length||(r=t[t.length-1]),null!=(e=r)&&e.units){const t=r.units;n=t[t.length-1]}return n}pushAccessUnit(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){const n=e.samples,r=n.length;if(!r)return void e.dropped++;{const e=n[r-1];t.pts=e.pts,t.dts=e.dts}}e.samples.push(t)}t.debug.length&&x.log(t.pts+"/"+t.dts+":"+t.debug)}}class cr{constructor(data){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=data,this.bytesAvailable=data.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const data=this.data,t=this.bytesAvailable,e=data.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");n.set(data.subarray(e,e+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(t){let e;t=Math.min(t,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(e=(t-=this.bitsAvailable)>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const n=this.word>>>32-e;if(t>32&&x.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return e=t-e,e>0&&this.bitsAvailable?n<<e|this.readBits(e):n}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if(this.word&2147483648>>>t)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(t){let e,n=8,r=8;for(let o=0;o<t;o++)0!==r&&(e=this.readEG(),r=(n+e+256)%256),n=0===r?n:r}readSPS(){let t,e,i,n=0,r=0,o=0,l=0;const c=this.readUByte.bind(this),h=this.readBits.bind(this),d=this.readUEG.bind(this),f=this.readBoolean.bind(this),m=this.skipBits.bind(this),v=this.skipEG.bind(this),y=this.skipUEG.bind(this),T=this.skipScalingList.bind(this);c();const E=c();if(h(5),m(3),c(),y(),100===E||110===E||122===E||244===E||44===E||83===E||86===E||118===E||128===E){const t=d();if(3===t&&m(1),y(),y(),m(1),f())for(e=3!==t?8:12,i=0;i<e;i++)f()&&T(i<6?16:64)}y();const k=d();if(0===k)d();else if(1===k)for(m(1),v(),v(),t=d(),i=0;i<t;i++)v();y(),m(1);const S=d(),_=d(),L=h(1);0===L&&m(1),m(1),f()&&(n=d(),r=d(),o=d(),l=d());let C=[1,1];if(f()&&f()){switch(c()){case 1:C=[1,1];break;case 2:C=[12,11];break;case 3:C=[10,11];break;case 4:C=[16,11];break;case 5:C=[40,33];break;case 6:C=[24,11];break;case 7:C=[20,11];break;case 8:C=[32,11];break;case 9:C=[80,33];break;case 10:C=[18,11];break;case 11:C=[15,11];break;case 12:C=[64,33];break;case 13:C=[160,99];break;case 14:C=[4,3];break;case 15:C=[3,2];break;case 16:C=[2,1];break;case 255:C=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(S+1)-2*n-2*r),height:(2-L)*(_+1)*16-(L?2:4)*(o+l),pixelRatio:C}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class ur extends lr{parseAVCPES(track,t,e,n,r){const o=this.parseAVCNALu(track,e.data);let l,c=this.VideoSample,h=!1;e.data=null,c&&o.length&&!track.audFound&&(this.pushAccessUnit(c,track),c=this.VideoSample=this.createVideoSample(!1,e.pts,e.dts,"")),o.forEach((n=>{var o;switch(n.type){case 1:{let t=!1;l=!0;const data=n.data;if(h&&data.length>4){const e=new cr(data).readSliceType();2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var d;if(t)null!=(d=c)&&d.frame&&!c.key&&(this.pushAccessUnit(c,track),c=this.VideoSample=null);c||(c=this.VideoSample=this.createVideoSample(!0,e.pts,e.dts,"")),c.frame=!0,c.key=t;break}case 5:l=!0,null!=(o=c)&&o.frame&&!c.key&&(this.pushAccessUnit(c,track),c=this.VideoSample=null),c||(c=this.VideoSample=this.createVideoSample(!0,e.pts,e.dts,"")),c.key=!0,c.frame=!0;break;case 6:l=!0,Qt(n.data,1,e.pts,t.samples);break;case 7:{var f,m;l=!0,h=!0;const t=n.data,e=new cr(t).readSPS();if(!track.sps||track.width!==e.width||track.height!==e.height||(null==(f=track.pixelRatio)?void 0:f[0])!==e.pixelRatio[0]||(null==(m=track.pixelRatio)?void 0:m[1])!==e.pixelRatio[1]){track.width=e.width,track.height=e.height,track.pixelRatio=e.pixelRatio,track.sps=[t],track.duration=r;const n=t.subarray(1,4);let o="avc1.";for(let i=0;i<3;i++){let t=n[i].toString(16);t.length<2&&(t="0"+t),o+=t}track.codec=o}break}case 8:l=!0,track.pps=[n.data];break;case 9:l=!0,track.audFound=!0,c&&this.pushAccessUnit(c,track),c=this.VideoSample=this.createVideoSample(!1,e.pts,e.dts,"");break;case 12:l=!0;break;default:l=!1,c&&(c.debug+="unknown NAL "+n.type+" ")}if(c&&l){c.units.push(n)}})),n&&c&&(this.pushAccessUnit(c,track),this.VideoSample=null)}parseAVCNALu(track,t){const e=t.byteLength;let n=track.naluState||0;const r=n,o=[];let l,c,h,i=0,d=-1,f=0;for(-1===n&&(d=0,f=31&t[0],n=0,i=1);i<e;)if(l=t[i++],n)if(1!==n)if(l)if(1===l){if(c=i-n-1,d>=0){const e={data:t.subarray(d,c),type:f};o.push(e)}else{const e=this.getLastNalUnit(track.samples);e&&(r&&i<=4-r&&e.state&&(e.data=e.data.subarray(0,e.data.byteLength-r)),c>0&&(e.data=qt(e.data,t.subarray(0,c)),e.state=0))}i<e?(h=31&t[i],d=i,f=h,n=0):n=-1}else n=0;else n=3;else n=l?0:2;else n=l?0:1;if(d>=0&&n>=0){const r={data:t.subarray(d,e),type:f,state:n};o.push(r)}if(0===o.length){const e=this.getLastNalUnit(track.samples);e&&(e.data=qt(e.data,t))}return track.naluState=n,o}}class dr{constructor(t,e,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Tn(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(t,e,n){const r=t[e].unit;if(r.length<=16)return;const o=r.subarray(16,r.length-r.length%16),l=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(l).then((o=>{const l=new Uint8Array(o);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,n)}))}decryptAacSamples(t,e,n){for(;;e++){if(e>=t.length)return void n();if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(t){const e=16*Math.floor((t.length-48)/160)+16,n=new Int8Array(e);let r=0;for(let e=32;e<t.length-16;e+=160,r+=16)n.set(t.subarray(e,e+16),r);return n}getAvcDecryptedUnit(t,e){const n=new Uint8Array(e);let r=0;for(let e=32;e<t.length-16;e+=160,r+=16)t.set(n.subarray(r,r+16),e);return t}decryptAvcSample(t,e,n,r,o){const l=Jt(o.data),c=this.getAvcEncryptedData(l);this.decryptBuffer(c.buffer).then((c=>{o.data=this.getAvcDecryptedUnit(l,c),this.decrypter.isSync()||this.decryptAvcSamples(t,e,n+1,r)}))}decryptAvcSamples(t,e,n,r){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,n=0){if(e>=t.length)return void r();const o=t[e].units;for(;!(n>=o.length);n++){const l=o[n];if(!(l.data.length<=48||1!==l.type&&5!==l.type||(this.decryptAvcSample(t,e,n,r,l),this.decrypter.isSync())))return}}}}const fr=188;class gr{constructor(t,e,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=e,this.typeSupported=n,this.videoParser=new ur}static probe(data){const t=gr.syncOffset(data);return t>0&&x.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(data){const t=data.length;let e=Math.min(940,t-fr)+1,i=0;for(;i<e;){let n=!1,r=-1,o=0;for(let l=i;l<t;l+=fr){if(71!==data[l]||t-l!==fr&&71!==data[l+fr]){if(o)return-1;break}if(o++,-1===r&&(r=l,0!==r&&(e=Math.min(r+18612,data.length-fr)+1)),n||(n=0===pr(data,l)),n&&o>1&&(0===r&&o>2||l+fr>e))return r}i++}return-1}static createTrack(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:It[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}}resetInitSegment(t,e,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=gr.createTrack("video"),this._audioTrack=gr.createTrack("audio",r),this._id3Track=gr.createTrack("id3"),this._txtTrack=gr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=n,this._duration=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_videoTrack:e,_id3Track:n}=this;t&&(t.pesData=null),e&&(e.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(data,t,e=!1,n=!1){let r;e||(this.sampleAes=null);const o=this._videoTrack,l=this._audioTrack,c=this._id3Track,h=this._txtTrack;let d=o.pid,f=o.pesData,m=l.pid,v=c.pid,y=l.pesData,T=c.pesData,E=null,k=this.pmtParsed,S=this._pmtId,_=data.length;if(this.remainderData&&(_=(data=qt(this.remainderData,data)).length,this.remainderData=null),_<fr&&!n)return this.remainderData=data,{audioTrack:l,videoTrack:o,id3Track:c,textTrack:h};const L=Math.max(0,gr.syncOffset(data));_-=(_-L)%fr,_<data.byteLength&&!n&&(this.remainderData=new Uint8Array(data.buffer,_,data.buffer.byteLength-_));let C=0;for(let t=L;t<_;t+=fr)if(71===data[t]){const n=!!(64&data[t+1]),_=pr(data,t);let C;if((48&data[t+3])>>4>1){if(C=t+5+data[t+4],C===t+fr)continue}else C=t+4;switch(_){case d:n&&(f&&(r=Er(f))&&this.videoParser.parseAVCPES(o,h,r,!1,this._duration),f={data:[],size:0}),f&&(f.data.push(data.subarray(C,t+fr)),f.size+=t+fr-C);break;case m:if(n){if(y&&(r=Er(y)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,r);break;case"mp3":this.parseMPEGPES(l,r);break;case"ac3":this.parseAC3PES(l,r)}y={data:[],size:0}}y&&(y.data.push(data.subarray(C,t+fr)),y.size+=t+fr-C);break;case v:n&&(T&&(r=Er(T))&&this.parseID3PES(c,r),T={data:[],size:0}),T&&(T.data.push(data.subarray(C,t+fr)),T.size+=t+fr-C);break;case 0:n&&(C+=data[C]+1),S=this._pmtId=mr(data,C);break;case S:{n&&(C+=data[C]+1);const r=vr(data,C,this.typeSupported,e,this.observer);d=r.videoPid,d>0&&(o.pid=d,o.segmentCodec=r.segmentVideoCodec),m=r.audioPid,m>0&&(l.pid=m,l.segmentCodec=r.segmentAudioCodec),v=r.id3Pid,v>0&&(c.pid=v),null===E||k||(x.warn(`MPEG-TS PMT found at ${t} after unknown PID '${E}'. Backtracking to sync byte @${L} to parse all TS packets.`),E=null,t=L-188),k=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=_}}else C++;C>0&&yr(this.observer,new Error(`Found ${C} TS packet/s that do not start with 0x47`)),o.pesData=f,l.pesData=y,c.pesData=T;const A={audioTrack:l,videoTrack:o,id3Track:c,textTrack:h};return n&&this.extractRemainingSamples(A),A}flush(){const{remainderData:t}=this;let e;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:n,id3Track:r,textTrack:o}=t,l=n.pesData,c=e.pesData,h=r.pesData;let d;if(l&&(d=Er(l))?(this.videoParser.parseAVCPES(n,o,d,!0,this._duration),n.pesData=null):n.pesData=l,c&&(d=Er(c))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,d);break;case"mp3":this.parseMPEGPES(e,d);break;case"ac3":this.parseAC3PES(e,d)}e.pesData=null}else null!=c&&c.size&&x.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=c;h&&(d=Er(h))?(this.parseID3PES(r,d),r.pesData=null):r.pesData=h}demuxSampleAes(data,t,e){const n=this.demux(data,e,!0,!this.config.progressive),r=this.sampleAes=new dr(this.observer,this.config,t);return this.decrypt(n,r)}decrypt(t,e){return new Promise((n=>{const{audioTrack:r,videoTrack:o}=t;r.samples&&"aac"===r.segmentCodec?e.decryptAacSamples(r.samples,0,(()=>{o.samples?e.decryptAvcSamples(o.samples,0,0,(()=>{n(t)})):n(t)})):o.samples&&e.decryptAvcSamples(o.samples,0,0,(()=>{n(t)}))}))}destroy(){this._duration=0}parseAACPES(track,t){let e=0;const n=this.aacOverFlow;let r,o,l,data=t.data;if(n){this.aacOverFlow=null;const t=n.missing,r=n.sample.unit.byteLength;if(-1===t)data=qt(n.sample.unit,data);else{const o=r-t;n.sample.unit.set(data.subarray(0,t),o),track.samples.push(n.sample),e=n.missing}}for(r=e,o=data.length;r<o-1&&!Hn(data,r);r++);if(r!==e){let t;const e=r<o-1;if(t=e?`AAC PES did not start with ADTS header,offset:${r}`:"No ADTS header found in AAC PES",yr(this.observer,new Error(t),e),!e)return}if(Kn(track,this.observer,data,r,this.audioCodec),void 0!==t.pts)l=t.pts;else{if(!n)return void x.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=Vn(track.samplerate);l=n.sample.pts+t}}let c,h=0;for(;r<o;){if(c=Wn(track,data,r,l,h),r+=c.length,c.missing){this.aacOverFlow=c;break}for(h++;r<o-1&&!Hn(data,r);r++);}}parseMPEGPES(track,t){const data=t.data,e=data.length;let n=0,r=0;const o=t.pts;if(void 0!==o)for(;r<e;)if(ir(data,r)){const t=Jn(track,data,r,o,n);if(!t)break;r+=t.length,n++}else r++;else x.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(track,t){{const data=t.data,e=t.pts;if(void 0===e)return void x.warn("[tsdemuxer]: AC3 PES unknown PTS");const n=data.length;let r,o=0,l=0;for(;l<n&&(r=or(track,data,l,e,o++))>0;)l+=r}}parseID3PES(t,e){if(void 0===e.pts)return void x.warn("[tsdemuxer]: ID3 PES unknown PTS");const n=k({},e,{type:this._videoTrack?ze:Ye,duration:Number.POSITIVE_INFINITY});t.samples.push(n)}}function pr(data,t){return((31&data[t+1])<<8)+data[t+2]}function mr(data,t){return(31&data[t+10])<<8|data[t+11]}function vr(data,t,e,n,r){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},l=t+3+((15&data[t+1])<<8|data[t+2])-4;for(t+=12+((15&data[t+10])<<8|data[t+11]);t<l;){const l=pr(data,t),c=(15&data[t+3])<<8|data[t+4];switch(data[t]){case 207:if(!n){Tr("ADTS AAC");break}case 15:-1===o.audioPid&&(o.audioPid=l);break;case 21:-1===o.id3Pid&&(o.id3Pid=l);break;case 219:if(!n){Tr("H.264");break}case 27:-1===o.videoPid&&(o.videoPid=l,o.segmentVideoCodec="avc");break;case 3:case 4:e.mpeg||e.mp3?-1===o.audioPid&&(o.audioPid=l,o.segmentAudioCodec="mp3"):x.log("MPEG audio found, not supported in this browser");break;case 193:if(!n){Tr("AC-3");break}case 129:e.ac3?-1===o.audioPid&&(o.audioPid=l,o.segmentAudioCodec="ac3"):x.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===o.audioPid&&c>0){let n=t+5,r=c;for(;r>2;){if(106===data[n])!0!==e.ac3?x.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=l,o.segmentAudioCodec="ac3");const t=data[n+1]+2;n+=t,r-=t}}break;case 194:case 135:return yr(r,new Error("Unsupported EC-3 in M2TS found")),o;case 36:return yr(r,new Error("Unsupported HEVC in M2TS found")),o}t+=c+5}return o}function yr(t,e,n){x.warn(`parsing error: ${e.message}`),t.emit(C.ERROR,C.ERROR,{type:A.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:e,reason:e.message})}function Tr(t){x.log(`${t} with AES-128-CBC encryption found in unencrypted stream`)}function Er(t){let e,n,r,o,l,i=0;const data=t.data;if(!t||0===t.size)return null;for(;data[0].length<19&&data.length>1;)data[0]=qt(data[0],data[1]),data.splice(1,1);e=data[0];if(1===(e[0]<<16)+(e[1]<<8)+e[2]){if(n=(e[4]<<8)+e[5],n&&n>t.size-6)return null;const c=e[7];192&c&&(o=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&c?(l=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2,o-l>54e5&&(x.warn(`${Math.round((o-l)/9e4)}s delta between PTS and DTS, align them`),o=l)):l=o),r=e[8];let h=r+9;if(t.size<=h)return null;t.size-=h;const d=new Uint8Array(t.size);for(let t=0,n=data.length;t<n;t++){e=data[t];let n=e.byteLength;if(h){if(h>n){h-=n;continue}e=e.subarray(h),n-=h,h=0}d.set(e,i),i+=n}return n&&(n-=r+3),{data:d,pts:o,dts:l,len:n}}return null}class kr{static getSilentFrame(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const Sr=Math.pow(2,32)-1;class _r{static init(){let i;for(i in _r.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},_r.types)_r.types.hasOwnProperty(i)&&(_r.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);_r.HDLR_TYPES={video:t,audio:e};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);_r.STTS=_r.STSC=_r.STCO=r,_r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),_r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),_r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),_r.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);_r.FTYP=_r.box(_r.types.ftyp,o,c,o,l),_r.DINF=_r.box(_r.types.dinf,_r.box(_r.types.dref,n))}static box(t,...e){let n=8,i=e.length;const r=i;for(;i--;)n+=e[i].byteLength;const o=new Uint8Array(n);for(o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=255&n,o.set(t,4),i=0,n=8;i<r;i++)o.set(e[i],n),n+=e[i].byteLength;return o}static hdlr(t){return _r.box(_r.types.hdlr,_r.HDLR_TYPES[t])}static mdat(data){return _r.box(_r.types.mdat,data)}static mdhd(t,e){e*=t;const n=Math.floor(e/(Sr+1)),r=Math.floor(e%(Sr+1));return _r.box(_r.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}static mdia(track){return _r.box(_r.types.mdia,_r.mdhd(track.timescale,track.duration),_r.hdlr(track.type),_r.minf(track))}static mfhd(t){return _r.box(_r.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}static minf(track){return"audio"===track.type?_r.box(_r.types.minf,_r.box(_r.types.smhd,_r.SMHD),_r.DINF,_r.stbl(track)):_r.box(_r.types.minf,_r.box(_r.types.vmhd,_r.VMHD),_r.DINF,_r.stbl(track))}static moof(t,e,track){return _r.box(_r.types.moof,_r.mfhd(t),_r.traf(track,e))}static moov(t){let i=t.length;const e=[];for(;i--;)e[i]=_r.trak(t[i]);return _r.box.apply(null,[_r.types.moov,_r.mvhd(t[0].timescale,t[0].duration)].concat(e).concat(_r.mvex(t)))}static mvex(t){let i=t.length;const e=[];for(;i--;)e[i]=_r.trex(t[i]);return _r.box.apply(null,[_r.types.mvex,...e])}static mvhd(t,e){e*=t;const n=Math.floor(e/(Sr+1)),r=Math.floor(e%(Sr+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return _r.box(_r.types.mvhd,o)}static sdtp(track){const t=track.samples||[],e=new Uint8Array(4+t.length);let i,n;for(i=0;i<t.length;i++)n=t[i].flags,e[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return _r.box(_r.types.sdtp,e)}static stbl(track){return _r.box(_r.types.stbl,_r.stsd(track),_r.box(_r.types.stts,_r.STTS),_r.box(_r.types.stsc,_r.STSC),_r.box(_r.types.stsz,_r.STSZ),_r.box(_r.types.stco,_r.STCO))}static avc1(track){let i,data,t,e=[],n=[];for(i=0;i<track.sps.length;i++)data=track.sps[i],t=data.byteLength,e.push(t>>>8&255),e.push(255&t),e=e.concat(Array.prototype.slice.call(data));for(i=0;i<track.pps.length;i++)data=track.pps[i],t=data.byteLength,n.push(t>>>8&255),n.push(255&t),n=n.concat(Array.prototype.slice.call(data));const r=_r.box(_r.types.avcC,new Uint8Array([1,e[3],e[4],e[5],255,224|track.sps.length].concat(e).concat([track.pps.length]).concat(n))),o=track.width,l=track.height,c=track.pixelRatio[0],h=track.pixelRatio[1];return _r.box(_r.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),r,_r.box(_r.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),_r.box(_r.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,h>>24,h>>16&255,h>>8&255,255&h])))}static esds(track){const t=track.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(track.config).concat([6,1,2]))}static audioStsd(track){const t=track.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,track.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(track){return _r.box(_r.types.mp4a,_r.audioStsd(track),_r.box(_r.types.esds,_r.esds(track)))}static mp3(track){return _r.box(_r.types[".mp3"],_r.audioStsd(track))}static ac3(track){return _r.box(_r.types["ac-3"],_r.audioStsd(track),_r.box(_r.types.dac3,track.config))}static stsd(track){return"audio"===track.type?"mp3"===track.segmentCodec&&"mp3"===track.codec?_r.box(_r.types.stsd,_r.STSD,_r.mp3(track)):"ac3"===track.segmentCodec?_r.box(_r.types.stsd,_r.STSD,_r.ac3(track)):_r.box(_r.types.stsd,_r.STSD,_r.mp4a(track)):_r.box(_r.types.stsd,_r.STSD,_r.avc1(track))}static tkhd(track){const t=track.id,e=track.duration*track.timescale,n=track.width,r=track.height,o=Math.floor(e/(Sr+1)),l=Math.floor(e%(Sr+1));return _r.box(_r.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,r>>8&255,255&r,0,0]))}static traf(track,t){const e=_r.sdtp(track),n=track.id,r=Math.floor(t/(Sr+1)),o=Math.floor(t%(Sr+1));return _r.box(_r.types.traf,_r.box(_r.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),_r.box(_r.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,o>>24,o>>16&255,o>>8&255,255&o])),_r.trun(track,e.length+16+20+8+16+8+8),e)}static trak(track){return track.duration=track.duration||4294967295,_r.box(_r.types.trak,_r.tkhd(track),_r.mdia(track))}static trex(track){const t=track.id;return _r.box(_r.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(track,t){const e=track.samples||[],n=e.length,r=12+16*n,o=new Uint8Array(r);let i,l,c,h,d,f;for(t+=8+r,o.set(["video"===track.type?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),i=0;i<n;i++)l=e[i],c=l.duration,h=l.size,d=l.flags,f=l.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,255&c,h>>>24&255,h>>>16&255,h>>>8&255,255&h,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,61440&d.degradPrio,15&d.degradPrio,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*i);return _r.box(_r.types.trun,o)}static initSegment(t){_r.types||_r.init();const e=_r.moov(t);return qt(_r.FTYP,e)}}_r.types=void 0,_r.HDLR_TYPES=void 0,_r.STTS=void 0,_r.STSC=void 0,_r.STCO=void 0,_r.STSZ=void 0,_r.VMHD=void 0,_r.SMHD=void 0,_r.STSD=void 0,_r.FTYP=void 0,_r.DINF=void 0;const Lr=9e4;function Cr(t,e,n=1,r=!1){const o=t*e*n;return r?Math.round(o):o}function Ar(t,e=!1){return Cr(t,1e3,1/Lr,e)}let wr,Or=null,Rr=null;class Dr{constructor(t,e,n,r=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=e,this.typeSupported=n,this.ISGenerated=!1,null===Or){const t=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Or=t?parseInt(t[1]):0}if(null===Rr){const t=navigator.userAgent.match(/Safari\/(\d+)/i);Rr=t?parseInt(t[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(t){x.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t}resetNextTimestamp(){x.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){x.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(t){let e=!1;const n=t.reduce(((t,n)=>{const r=n.pts-t;return r<-4294967296?(e=!0,Ir(t,n.pts)):r>0?t:n.pts}),t[0].pts);return e&&x.debug("PTS rollover detected"),n}remux(t,e,n,r,o,l,c,h){let video,audio,d,text,f,m,v=o,y=o;const T=t.pid>-1,E=e.pid>-1,k=e.samples.length,S=t.samples.length>0,_=c&&k>0||k>1;if((!T||S)&&(!E||_)||this.ISGenerated||c){if(this.ISGenerated){var L,C,A,w;const t=this.videoTrackConfig;!t||e.width===t.width&&e.height===t.height&&(null==(L=e.pixelRatio)?void 0:L[0])===(null==(C=t.pixelRatio)?void 0:C[0])&&(null==(A=e.pixelRatio)?void 0:A[1])===(null==(w=t.pixelRatio)?void 0:w[1])||this.resetInitSegment()}else d=this.generateIS(t,e,o,l);const n=this.isVideoContiguous;let r,c=-1;if(_&&(c=function(t){for(let i=0;i<t.length;i++)if(t[i].key)return i;return-1}(e.samples),!n&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,c>0){x.warn(`[mp4-remuxer]: Dropped ${c} out of ${k} video samples due to a missing keyframe`);const t=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(c),e.dropped+=c,y+=(e.samples[0].pts-t)/e.inputTimeScale,r=y}else-1===c&&(x.warn(`[mp4-remuxer]: No keyframe found out of ${k} video samples`),m=!1);if(this.ISGenerated){if(S&&_){const n=this.getVideoStartPts(e.samples),r=(Ir(t.samples[0].pts,n)-n)/e.inputTimeScale;v+=Math.max(0,r),y+=Math.max(0,-r)}if(S){if(t.samplerate||(x.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(t,e,o,l)),audio=this.remuxAudio(t,v,this.isAudioContiguous,l,E||_||h===Ne?y:void 0),_){const r=audio?audio.endPTS-audio.startPTS:0;e.inputTimeScale||(x.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(t,e,o,l)),video=this.remuxVideo(e,y,n,r)}}else _&&(video=this.remuxVideo(e,y,n,0));video&&(video.firstKeyFrame=c,video.independent=-1!==c,video.firstKeyFramePTS=r)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(f=xr(n,o,this._initPTS,this._initDTS)),r.samples.length&&(text=Pr(r,o,this._initPTS))),{audio:audio,video:video,initSegment:d,independent:m,text:text,id3:f}}generateIS(t,e,n,r){const o=t.samples,l=e.samples,c=this.typeSupported,h={},d=this._initPTS;let f,m,v,y=!d||r,T="audio/mp4";if(y&&(f=m=1/0),t.config&&o.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":c.mpeg?(T="audio/mpeg",t.codec=""):c.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3"}h.audio={id:"audio",container:T,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&c.mpeg?new Uint8Array(0):_r.initSegment([t]),metadata:{channelCount:t.channelCount}},y&&(v=t.inputTimeScale,d&&v===d.timescale?y=!1:f=m=o[0].pts-Math.round(v*n))}if(e.sps&&e.pps&&l.length){if(e.timescale=e.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:_r.initSegment([e]),metadata:{width:e.width,height:e.height}},y)if(v=e.inputTimeScale,d&&v===d.timescale)y=!1;else{const t=this.getVideoStartPts(l),e=Math.round(v*n);m=Math.min(m,Ir(l[0].dts,t)-e),f=Math.min(f,t-e)}this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,y?(this._initPTS={baseTime:f,timescale:v},this._initDTS={baseTime:m,timescale:v}):f=v=void 0,{tracks:h,initPTS:f,timescale:v}}remuxVideo(track,t,e,n){const r=track.inputTimeScale,o=track.samples,l=[],c=o.length,h=this._initPTS;let d,f,m=this.nextAvcDts,v=8,y=this.videoSampleDuration,T=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,S=!1;if(!e||null===m){const n=t*r,l=o[0].pts-Ir(o[0].dts,o[0].pts);Or&&null!==m&&Math.abs(n-l-m)<15e3?e=!0:m=n-l}const _=h.baseTime*r/h.timescale;for(let i=0;i<c;i++){const t=o[i];t.pts=Ir(t.pts-_,m),t.dts=Ir(t.dts-_,m),t.dts<o[i>0?i-1:i].dts&&(S=!0)}S&&o.sort((function(a,b){const t=a.dts-b.dts,e=a.pts-b.pts;return t||e})),d=o[0].dts,f=o[o.length-1].dts;const L=f-d,O=L?Math.round(L/(c-1)):y||track.inputTimeScale/30;if(e){const e=d-m,n=e>O,r=e<-1;if((n||r)&&(n?x.warn(`AVC: ${Ar(e,!0)} ms (${e}dts) hole between fragments detected at ${t.toFixed(3)}`):x.warn(`AVC: ${Ar(-e,!0)} ms (${e}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!r||m>=o[0].pts||Or)){d=m;const t=o[0].pts-e;if(n)o[0].dts=d,o[0].pts=t;else for(let i=0;i<o.length&&!(o[i].dts>t);i++)o[i].dts-=e,o[i].pts-=e;x.log(`Video: Initial PTS/DTS adjusted: ${Ar(t,!0)}/${Ar(d,!0)}, delta: ${Ar(e,!0)} ms`)}}d=Math.max(0,d);let R=0,D=0,I=d;for(let i=0;i<c;i++){const t=o[i],e=t.units,n=e.length;let r=0;for(let t=0;t<n;t++)r+=e[t].data.length;D+=r,R+=n,t.length=r,t.dts<I?(t.dts=I,I+=O/4|0||1):I=t.dts,T=Math.min(t.pts,T),E=Math.max(t.pts,E)}f=o[c-1].dts;const P=D+4*R+8;let M;try{M=new Uint8Array(P)}catch(t){return void this.observer.emit(C.ERROR,C.ERROR,{type:A.MUX_ERROR,details:w.REMUX_ALLOC_ERROR,fatal:!1,error:t,bytes:P,reason:`fail allocating video mdat ${P}`})}const view=new DataView(M.buffer);view.setUint32(0,P),M.set(_r.types.mdat,4);let F=!1,N=Number.POSITIVE_INFINITY,j=Number.POSITIVE_INFINITY,U=Number.NEGATIVE_INFINITY,B=Number.NEGATIVE_INFINITY;for(let i=0;i<c;i++){const t=o[i],e=t.units;let h,d=0;for(let t=0,n=e.length;t<n;t++){const n=e[t],r=n.data,o=n.data.byteLength;view.setUint32(v,o),v+=4,M.set(r,v),v+=o,d+=4+o}if(i<c-1)y=o[i+1].dts-t.dts,h=o[i+1].pts-t.pts;else{const e=this.config,l=i>0?t.dts-o[i-1].dts:O;if(h=i>0?t.pts-o[i-1].pts:O,e.stretchShortVideoTrack&&null!==this.nextAudioPts){const o=Math.floor(e.maxBufferHole*r),c=(n?T+n*r:this.nextAudioPts)-t.pts;c>o?(y=c-l,y<0?y=l:F=!0,x.log(`[mp4-remuxer]: It is approximately ${c/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=l}else y=l}const f=Math.round(t.pts-t.dts);N=Math.min(N,y),U=Math.max(U,y),j=Math.min(j,h),B=Math.max(B,h),l.push(new Mr(t.key,y,d,f))}if(l.length)if(Or){if(Or<70){const t=l[0].flags;t.dependsOn=2,t.isNonSync=0}}else if(Rr&&B-j<U-N&&O/U<.025&&0===l[0].cts){x.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let t=d;for(let i=0,e=l.length;i<e;i++){const n=t+l[i].duration,r=t+l[i].cts;if(i<e-1){const t=n+l[i+1].cts;l[i].duration=t-r}else l[i].duration=i?l[i-1].duration:O;l[i].cts=0,t=n}}y=F||!y?O:y,this.nextAvcDts=m=f+y,this.videoSampleDuration=y,this.isVideoContiguous=!0;const data={data1:_r.moof(track.sequenceNumber++,d,k({},track,{samples:l})),data2:M,startPTS:T/r,endPTS:(E+y)/r,startDTS:d/r,endDTS:m/r,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:track.dropped};return track.samples=[],track.dropped=0,data}getSamplesPerFrame(track){switch(track.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(track,t,e,n,r){const o=track.inputTimeScale,l=o/(track.samplerate?track.samplerate:o),c=this.getSamplesPerFrame(track),h=c*l,d=this._initPTS,f="mp3"===track.segmentCodec&&this.typeSupported.mpeg,m=[],v=void 0!==r;let y=track.samples,T=f?0:8,E=this.nextAudioPts||-1;const S=t*o,_=d.baseTime*o/d.timescale;if(this.isAudioContiguous=e=e||y.length&&E>0&&(n&&Math.abs(S-E)<9e3||Math.abs(Ir(y[0].pts-_,S)-E)<20*h),y.forEach((function(t){t.pts=Ir(t.pts-_,S)})),!e||E<0){if(y=y.filter((t=>t.pts>=0)),!y.length)return;E=0===r?0:n&&!v?Math.max(0,S):y[0].pts}if("aac"===track.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let i=0,e=E;i<y.length;i++){const n=y[i],r=n.pts,l=r-e,c=Math.abs(1e3*l/o);if(l<=-t*h&&v)0===i&&(x.warn(`Audio frame @ ${(r/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*l/o)} ms.`),this.nextAudioPts=E=e=r);else if(l>=t*h&&c<1e4&&v){let t=Math.round(l/h);e=r-t*h,e<0&&(t--,e+=h),0===i&&(this.nextAudioPts=E=e),x.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(e/o).toFixed(3)}s due to ${Math.round(1e3*l/o)} ms gap.`);for(let r=0;r<t;r++){const t=Math.max(e,0);let r=kr.getSilentFrame(track.manifestCodec||track.codec,track.channelCount);r||(x.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),r=n.unit.subarray()),y.splice(i,0,{unit:r,pts:t}),e+=h,i++}}n.pts=e,e+=h}}let L,O=null,R=null,D=0,I=y.length;for(;I--;)D+=y[I].unit.byteLength;for(let t=0,n=y.length;t<n;t++){const n=y[t],r=n.unit;let o=n.pts;if(null!==R){m[t-1].duration=Math.round((o-R)/l)}else{if(e&&"aac"===track.segmentCodec&&(o=E),O=o,!(D>0))return;D+=T;try{L=new Uint8Array(D)}catch(t){return void this.observer.emit(C.ERROR,C.ERROR,{type:A.MUX_ERROR,details:w.REMUX_ALLOC_ERROR,fatal:!1,error:t,bytes:D,reason:`fail allocating audio mdat ${D}`})}if(!f){new DataView(L.buffer).setUint32(0,D),L.set(_r.types.mdat,4)}}L.set(r,T);const h=r.byteLength;T+=h,m.push(new Mr(!0,c,h,0)),R=o}const P=m.length;if(!P)return;const M=m[m.length-1];this.nextAudioPts=E=R+l*M.duration;const F=f?new Uint8Array(0):_r.moof(track.sequenceNumber++,O/l,k({},track,{samples:m}));track.samples=[];const N=O/o,j=E/o,U={data1:F,data2:L,startPTS:N,endPTS:j,startDTS:N,endDTS:j,type:"audio",hasAudio:!0,hasVideo:!1,nb:P};return this.isAudioContiguous=!0,U}remuxEmptyAudio(track,t,e,n){const r=track.inputTimeScale,o=r/(track.samplerate?track.samplerate:r),l=this.nextAudioPts,c=this._initDTS,h=9e4*c.baseTime/c.timescale,d=(null!==l?l:n.startDTS*r)+h,f=n.endDTS*r+h,m=1024*o,v=Math.ceil((f-d)/m),y=kr.getSilentFrame(track.manifestCodec||track.codec,track.channelCount);if(x.warn("[mp4-remuxer]: remux empty Audio"),!y)return void x.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const T=[];for(let i=0;i<v;i++){const t=d+i*m;T.push({unit:y,pts:t,dts:t})}return track.samples=T,this.remuxAudio(track,t,e,!1)}}function Ir(t,e){let n;if(null===e)return t;for(n=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=n;return t}function xr(track,t,e,n){const r=track.samples.length;if(!r)return;const o=track.inputTimeScale;for(let l=0;l<r;l++){const r=track.samples[l];r.pts=Ir(r.pts-e.baseTime*o/e.timescale,t*o)/o,r.dts=Ir(r.dts-n.baseTime*o/n.timescale,t*o)/o}const l=track.samples;return track.samples=[],{samples:l}}function Pr(track,t,e){const n=track.samples.length;if(!n)return;const r=track.inputTimeScale;for(let o=0;o<n;o++){const n=track.samples[o];n.pts=Ir(n.pts-e.baseTime*r/e.timescale,t*r)/r}track.samples.sort(((a,b)=>a.pts-b.pts));const o=track.samples;return track.samples=[],{samples:o}}class Mr{constructor(t,e,n,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=n,this.cts=r,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:t?2:1,isNonSync:t?0:1}}}function Fr(track,t){const e=null==track?void 0:track.codec;if(e&&e.length>4)return e;if(t===B){if("ec-3"===e||"ac-3"===e||"alac"===e)return e;if("fLaC"===e||"Opus"===e){return ve(e,!1)}const t="mp4a.40.5";return x.info(`Parsed audio codec "${e}" or audio object type not handled. Using "${t}"`),t}return x.warn(`Unhandled video codec "${e}"`),"hvc1"===e||"hev1"===e?"hvc1.1.6.L120.90":"av01"===e?"av01.0.04M.08":"avc1.42e01e"}try{wr=self.performance.now.bind(self.performance)}catch(t){x.debug("Unable to use Performance API on this environment"),wr=null==Q?void 0:Q.Date.now}const Nr=[{demux:class{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,n,r){const o=this.videoTrack=Fn("video",1),l=this.audioTrack=Fn("audio",1),c=this.txtTrack=Fn("text",1);if(this.id3Track=Fn("id3",1),this.timeOffset=0,null==t||!t.byteLength)return;const h=$t(t);if(h.video){const{id:t,timescale:e,codec:n}=h.video;o.id=t,o.timescale=c.timescale=e,o.codec=n}if(h.audio){const{id:t,timescale:e,codec:n}=h.audio;l.id=t,l.timescale=e,l.codec=n}c.id=It.text,o.sampleDuration=0,o.duration=l.duration=r}resetContiguity(){this.remainderData=null}static probe(data){return function(data){const t=data.byteLength;for(let i=0;i<t;){const e=Mt(data,i);if(e>8&&109===data[i+4]&&111===data[i+5]&&111===data[i+6]&&102===data[i+7])return!0;i=e>1?i+e:t}return!1}(data)}demux(data,t){this.timeOffset=t;let e=data;const n=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(e=qt(this.remainderData,data));const t=function(data){const t={valid:null,remainder:null},e=Ut(data,["moof"]);if(e.length<2)return t.remainder=data,t;const n=e[e.length-1];return t.valid=ut(data,0,n.byteOffset-8),t.remainder=ut(data,n.byteOffset-8),t}(e);this.remainderData=t.remainder,n.samples=t.valid||new Uint8Array}else n.samples=e;const o=this.extractID3Track(n,t);return r.samples=zt(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,n=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(e,this.timeOffset);return n.samples=zt(t,e),{videoTrack:e,audioTrack:Fn(),id3Track:r,textTrack:Fn()}}extractID3Track(t,e){const n=this.id3Track;if(t.samples.length){const r=Ut(t.samples,["emsg"]);r&&r.forEach((data=>{const t=function(data){const t=data[0];let e="",n="",r=0,o=0,l=0,c=0,h=0,d=0;if(0===t){for(;"\0"!==xt(data.subarray(d,d+1));)e+=xt(data.subarray(d,d+1)),d+=1;for(e+=xt(data.subarray(d,d+1)),d+=1;"\0"!==xt(data.subarray(d,d+1));)n+=xt(data.subarray(d,d+1)),d+=1;n+=xt(data.subarray(d,d+1)),d+=1,r=Mt(data,12),o=Mt(data,16),c=Mt(data,20),h=Mt(data,24),d=28}else if(1===t){d+=4,r=Mt(data,d),d+=4;const t=Mt(data,d);d+=4;const o=Mt(data,d);for(d+=4,l=2**32*t+o,_(l)||(l=Number.MAX_SAFE_INTEGER,x.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Mt(data,d),d+=4,h=Mt(data,d),d+=4;"\0"!==xt(data.subarray(d,d+1));)e+=xt(data.subarray(d,d+1)),d+=1;for(e+=xt(data.subarray(d,d+1)),d+=1;"\0"!==xt(data.subarray(d,d+1));)n+=xt(data.subarray(d,d+1)),d+=1;n+=xt(data.subarray(d,d+1)),d+=1}return{schemeIdUri:e,value:n,timeScale:r,presentationTime:l,presentationTimeDelta:o,eventDuration:c,id:h,payload:data.subarray(d,data.byteLength)}}(data);if(rr.test(t.schemeIdUri)){const r=S(t.presentationTime)?t.presentationTime/t.timeScale:e+t.presentationTimeDelta/t.timeScale;let o=4294967295===t.eventDuration?Number.POSITIVE_INFINITY:t.eventDuration/t.timeScale;o<=.001&&(o=Number.POSITIVE_INFINITY);const l=t.payload;n.samples.push({data:l,len:l.byteLength,dts:r,pts:r,type:ze,duration:o})}}))}return n}demuxSampleAes(data,t,e){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(t){this.initPTS=t,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(t,e,n,r){this.audioCodec=e,this.videoCodec=n,this.generateInitSegment(function(t,e){if(!t||!e)return t;const n=e.keyId;n&&e.isCommonEncryption&&Ut(t,["moov","trak"]).forEach((t=>{const e=Ut(t,["mdia","minf","stbl","stsd"])[0].subarray(8);let r=Ut(e,["enca"]);const o=r.length>0;o||(r=Ut(e,["encv"])),r.forEach((t=>{Ut(o?t.subarray(28):t.subarray(78),["sinf"]).forEach((t=>{const e=Wt(t);if(e){const t=e.subarray(8,24);t.some((b=>0!==b))||(x.log(`[eme] Patching keyId in 'enc${o?"a":"v"}>sinf>>tenc' box: ${Ot(t)} -> ${Ot(n)}`),e.set(n,8))}}))}))}));return t}(t,r)),this.emitInitSegment=!0}generateInitSegment(t){let{audioCodec:e,videoCodec:n}=this;if(null==t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const r=this.initData=$t(t);r.audio&&(e=Fr(r.audio,B)),r.video&&(n=Fr(r.video,$));const o={};r.audio&&r.video?o.audiovideo={container:"video/mp4",codec:e+","+n,initSegment:t,id:"main"}:r.audio?o.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:r.video?o.video={container:"video/mp4",codec:n,initSegment:t,id:"main"}:x.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(t,e,n,r,o,l){var c,h;let{initPTS:d,lastEndTime:f}=this;const m={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};S(f)||(f=this.lastEndTime=o||0);const data=e.samples;if(null==data||!data.length)return m;const v={initPTS:void 0,timescale:1};let y=this.initData;if(null!=(c=y)&&c.length||(this.generateInitSegment(data),y=this.initData),null==(h=y)||!h.length)return x.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),m;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);const T=function(data,t){let e=0,n=0,r=0;const o=Ut(data,["moof","traf"]);for(let i=0;i<o.length;i++){const l=o[i],c=Ut(l,["tfhd"])[0],track=t[Mt(c,4)];if(!track)continue;const h=track.default,d=Mt(c,0)|(null==h?void 0:h.flags);let f=null==h?void 0:h.duration;8&d&&(f=Mt(c,2&d?12:8));const m=track.timescale||9e4,v=Ut(l,["trun"]);for(let t=0;t<v.length;t++)e=Yt(v[t]),!e&&f&&(e=f*Mt(v[t],4)),track.type===$?n+=e/m:track.type===B&&(r+=e/m)}if(0===n&&0===r){let t=1/0,e=0,n=0;const r=Ut(data,["sidx"]);for(let i=0;i<r.length;i++){const o=Bt(r[i]);if(null!=o&&o.references){t=Math.min(t,o.earliestPresentationTime/o.timescale);const r=o.references.reduce(((t,e)=>t+e.info.duration||0),0);e=Math.max(e,r+o.earliestPresentationTime/o.timescale),n=e-t}}if(n&&S(n))return n}return n||r}(data,y),E=function(t,e){return Ut(e,["moof","traf"]).reduce(((e,n)=>{const r=Ut(n,["tfdt"])[0],o=r[0],l=Ut(n,["tfhd"]).reduce(((e,n)=>{const l=Mt(n,4),track=t[l];if(track){let t=Mt(r,4);if(1===o){if(t===Rt)return x.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),e;t*=Rt+1,t+=Mt(r,8)}const n=t/(track.timescale||9e4);if(S(n)&&(null===e||n<e))return n}return e}),null);return null!==l&&S(l)&&(null===e||l<e)?l:e}),null)}(y,data),k=null===E?o:E;(function(t,e,n,r){if(null===t)return!0;const o=Math.max(r,1),l=e-t.baseTime/t.timescale;return Math.abs(l-n)>o}(d,k,o,T)||v.timescale!==d.timescale&&l)&&(v.initPTS=k-o,d&&1===d.timescale&&x.warn("Adjusting initPTS by "+(v.initPTS-d.baseTime)),this.initPTS=d={baseTime:v.initPTS,timescale:1});const _=t?k-d.baseTime/d.timescale:f,L=_+T;!function(t,e,n){Ut(e,["moof","traf"]).forEach((e=>{Ut(e,["tfhd"]).forEach((r=>{const o=Mt(r,4),track=t[o];if(!track)return;const l=track.timescale||9e4;Ut(e,["tfdt"]).forEach((t=>{const e=t[0],r=n*l;if(r){let n=Mt(t,4);if(0===e)n-=r,n=Math.max(n,0),jt(t,4,n);else{n*=Math.pow(2,32),n+=Mt(t,8),n-=r,n=Math.max(n,0);const e=Math.floor(n/(Rt+1)),o=Math.floor(n%(Rt+1));jt(t,4,e),jt(t,8,o)}}}))}))}))}(y,data,d.baseTime/d.timescale),T>0?this.lastEndTime=L:(x.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const C=!!y.audio,A=!!y.video;let w="";C&&(w+="audio"),A&&(w+="video");const track={data1:data,startPTS:_,startDTS:_,endPTS:L,endDTS:L,type:w,hasAudio:C,hasVideo:A,nb:1,dropped:0};return m.audio="audio"===track.type?track:void 0,m.video="audio"!==track.type?track:void 0,m.initSegment=v,m.id3=xr(n,o,d,d),r.samples.length&&(m.text=Pr(r,o,d)),m}}},{demux:gr,remux:Dr},{demux:class extends Nn{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,n,r){super.resetInitSegment(t,e,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(data){if(!data)return!1;const t=gt(data,0);let e=(null==t?void 0:t.length)||0;if(nr(data,e))return!1;for(let t=data.length;e<t;e++)if(Gn(data,e))return x.log("ADTS sync word found !"),!0;return!1}canParse(data,t){return function(data,t){return function(data,t){return t+5<data.length}(data,t)&&Un(data,t)&&$n(data,t)<=data.length-t}(data,t)}appendFrame(track,data,t){Kn(track,this.observer,data,t,track.manifestCodec);const e=Wn(track,data,t,this.basePTS,this.frameIndex);if(e&&0===e.missing)return e}},remux:Dr},{demux:class extends Nn{resetInitSegment(t,e,n,r){super.resetInitSegment(t,e,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(data){if(!data)return!1;const t=gt(data,0);let e=(null==t?void 0:t.length)||0;if(t&&11===data[e]&&119===data[e+1]&&void 0!==vt(t)&&sr(data,e)<=16)return!1;for(let t=data.length;e<t;e++)if(nr(data,e))return x.log("MPEG Audio sync word found !"),!0;return!1}canParse(data,t){return function(data,t){return er(data,t)&&4<=data.length-t}(data,t)}appendFrame(track,data,t){if(null!==this.basePTS)return Jn(track,data,t,this.basePTS,this.frameIndex)}},remux:Dr}];Nr.splice(2,0,{demux:ar,remux:Dr});class jr{constructor(t,e,n,r,o){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=n,this.vendor=r,this.id=o}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(data,t,e,n){const r=e.transmuxing;r.executeStart=wr();let o=new Uint8Array(data);const{currentTransmuxState:l,transmuxConfig:c}=this;n&&(this.currentTransmuxState=n);const{contiguous:h,discontinuity:d,trackSwitch:f,accurateTimeOffset:m,timeOffset:v,initSegmentChange:y}=n||l,{audioCodec:T,videoCodec:E,defaultInitPts:k,duration:S,initSegmentData:_}=c,L=function(data,t){let e=null;data.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(e=t);return e}(o,t);if(L&&"AES-128"===L.method){const t=this.getDecrypter();if(!t.isSync())return this.decryptionPromise=t.webCryptoDecrypt(o,L.key.buffer,L.iv.buffer).then((t=>{const n=this.push(t,null,e);return this.decryptionPromise=null,n})),this.decryptionPromise;{let n=t.softwareDecrypt(o,L.key.buffer,L.iv.buffer);if(e.part>-1&&(n=t.flush()),!n)return r.executeEnd=wr(),Ur(e);o=new Uint8Array(n)}}const O=this.needsProbing(d,f);if(O){const t=this.configureTransmuxer(o);if(t)return x.warn(`[transmuxer] ${t.message}`),this.observer.emit(C.ERROR,C.ERROR,{type:A.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,fatal:!1,error:t,reason:t.message}),r.executeEnd=wr(),Ur(e)}(d||f||y||O)&&this.resetInitSegment(_,T,E,S,t),(d||y||O)&&this.resetInitialTimestamp(k),h||this.resetContiguity();const R=this.transmux(o,L,v,m,e),D=this.currentTransmuxState;return D.contiguous=!0,D.discontinuity=!1,D.trackSwitch=!1,r.executeEnd=wr(),R}flush(t){const e=t.transmuxing;e.executeStart=wr();const{decrypter:n,currentTransmuxState:r,decryptionPromise:o}=this;if(o)return o.then((()=>this.flush(t)));const l=[],{timeOffset:c}=r;if(n){const e=n.flush();e&&l.push(this.push(e,null,t))}const{demuxer:h,remuxer:d}=this;if(!h||!d)return e.executeEnd=wr(),[Ur(t)];const f=h.flush(c);return Br(f)?f.then((e=>(this.flushRemux(l,e,t),l))):(this.flushRemux(l,f,t),l)}flushRemux(t,e,n){const{audioTrack:r,videoTrack:o,id3Track:l,textTrack:c}=e,{accurateTimeOffset:h,timeOffset:d}=this.currentTransmuxState;x.log(`[transmuxer.ts]: Flushed fragment ${n.sn}${n.part>-1?" p: "+n.part:""} of level ${n.level}`);const f=this.remuxer.remux(r,o,l,c,d,h,!0,this.id);t.push({remuxResult:f,chunkMeta:n}),n.transmuxing.executeEnd=wr()}resetInitialTimestamp(t){const{demuxer:e,remuxer:n}=this;e&&n&&(e.resetTimeStamp(t),n.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,n,r,o){const{demuxer:l,remuxer:c}=this;l&&c&&(l.resetInitSegment(t,e,n,r),c.resetInitSegment(t,e,n,o))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(data,t,e,n,r){let o;return o=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(data,t,e,n,r):this.transmuxUnencrypted(data,e,n,r),o}transmuxUnencrypted(data,t,e,n){const{audioTrack:r,videoTrack:o,id3Track:l,textTrack:c}=this.demuxer.demux(data,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,o,l,c,t,e,!1,this.id),chunkMeta:n}}transmuxSampleAes(data,t,e,n,r){return this.demuxer.demuxSampleAes(data,t,e).then((t=>({remuxResult:this.remuxer.remux(t.audioTrack,t.videoTrack,t.id3Track,t.textTrack,e,n,!1,this.id),chunkMeta:r})))}configureTransmuxer(data){const{config:t,observer:e,typeSupported:n,vendor:r}=this;let o;for(let i=0,t=Nr.length;i<t;i++){var l;if(null!=(l=Nr[i].demux)&&l.probe(data)){o=Nr[i];break}}if(!o)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,h=this.remuxer,d=o.remux,f=o.demux;h&&h instanceof d||(this.remuxer=new d(e,t,n,r)),c&&c instanceof f||(this.demuxer=new f(e,t,n),this.probe=f.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new Tn(this.config)),t}}const Ur=t=>({remuxResult:{},chunkMeta:t});function Br(p){return"then"in p&&p.then instanceof Function}class $r{constructor(t,e,n,r,o){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=n,this.duration=r,this.defaultInitPts=o||null}}class Hr{constructor(t,e,n,r,o,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=o,this.initSegmentChange=l}}var Gr={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function l(t,e,r,l,c){if("function"!=typeof r)throw new TypeError("The listener must be a function");var h=new o(r,l||t,c),d=n?n+e:e;return t._events[d]?t._events[d].fn?t._events[d]=[t._events[d],h]:t._events[d].push(h):(t._events[d]=h,t._eventsCount++),t}function c(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function h(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),h.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},h.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,l=new Array(o);i<o;i++)l[i]=r[i].fn;return l},h.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},h.prototype.emit=function(t,e,r,o,l,c){var h=n?n+t:t;if(!this._events[h])return!1;var d,i,f=this._events[h],m=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),m){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,r),!0;case 4:return f.fn.call(f.context,e,r,o),!0;case 5:return f.fn.call(f.context,e,r,o,l),!0;case 6:return f.fn.call(f.context,e,r,o,l,c),!0}for(i=1,d=new Array(m-1);i<m;i++)d[i-1]=arguments[i];f.fn.apply(f.context,d)}else{var v,y=f.length;for(i=0;i<y;i++)switch(f[i].once&&this.removeListener(t,f[i].fn,void 0,!0),m){case 1:f[i].fn.call(f[i].context);break;case 2:f[i].fn.call(f[i].context,e);break;case 3:f[i].fn.call(f[i].context,e,r);break;case 4:f[i].fn.call(f[i].context,e,r,o);break;default:if(!d)for(v=1,d=new Array(m-1);v<m;v++)d[v-1]=arguments[v];f[i].fn.apply(f[i].context,d)}}return!0},h.prototype.on=function(t,e,n){return l(this,t,e,n,!1)},h.prototype.once=function(t,e,n){return l(this,t,e,n,!0)},h.prototype.removeListener=function(t,e,r,o){var l=n?n+t:t;if(!this._events[l])return this;if(!e)return c(this,l),this;var h=this._events[l];if(h.fn)h.fn!==e||o&&!h.once||r&&h.context!==r||c(this,l);else{for(var i=0,d=[],f=h.length;i<f;i++)(h[i].fn!==e||o&&!h[i].once||r&&h[i].context!==r)&&d.push(h[i]);d.length?this._events[l]=1===d.length?d[0]:d:c(this,l)}return this},h.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&c(this,e)):(this._events=new r,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=n,h.EventEmitter=h,t.exports=h}(Gr);var Kr=r(Gr.exports);class Vr{constructor(t,e,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const o=t.config;this.hls=t,this.id=e,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const l=(t,data)=>{(data=data||{}).frag=this.frag,data.id=this.id,t===C.ERROR&&(this.error=data.error),this.hls.trigger(t,data)};this.observer=new Kr,this.observer.on(C.FRAG_DECRYPTED,l),this.observer.on(C.ERROR,l);const c=le(o.preferManagedMediaSource)||{isTypeSupported:()=>!1},h={mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:c.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&"undefined"!=typeof Worker){if(o.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{o.workerPath?(x.log(`loading Web Worker ${o.workerPath} for "${e}"`),this.workerContext=function(path){const t=new self.URL(path,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}(o.workerPath)):(x.log(`injecting Web Worker for "${e}"`),this.workerContext=function(){const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(t);return{worker:new self.Worker(e),objectURL:e}}()),this.onwmsg=t=>this.onWorkerMessage(t);const{worker:t}=this.workerContext;t.addEventListener("message",this.onwmsg),t.onerror=t=>{const n=new Error(`${t.message}  (${t.filename}:${t.lineno})`);o.enableWorker=!1,x.warn(`Error in "${e}" Web Worker, fallback to inline`),this.hls.trigger(C.ERROR,{type:A.OTHER_ERROR,details:w.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:n})},t.postMessage({cmd:"init",typeSupported:h,vendor:"",id:e,config:JSON.stringify(o)})}catch(t){x.warn(`Error setting up "${e}" Web Worker, fallback to inline`,t),this.resetWorker(),this.error=null,this.transmuxer=new jr(this.observer,h,o,"",e)}return}}this.transmuxer=new jr(this.observer,h,o,"",e)}resetWorker(){if(this.workerContext){const{worker:t,objectURL:e}=this.workerContext;e&&self.URL.revokeObjectURL(e),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(data,t,e,n,r,o,l,c,h,d){var f,m;h.transmuxing.start=self.performance.now();const{transmuxer:v}=this,y=o?o.start:r.start,T=r.decryptdata,E=this.frag,k=!(E&&r.cc===E.cc),S=!(E&&h.level===E.level),_=E?h.sn-E.sn:-1,L=this.part?h.part-this.part.index:-1,C=0===_&&h.id>1&&h.id===(null==E?void 0:E.stats.chunkCount),A=!S&&(1===_||0===_&&(1===L||C&&L<=0)),w=self.performance.now();(S||_||0===r.stats.parsing.start)&&(r.stats.parsing.start=w),!o||!L&&A||(o.stats.parsing.start=w);const O=!(E&&(null==(f=r.initSegment)?void 0:f.url)===(null==(m=E.initSegment)?void 0:m.url)),R=new Hr(k,A,c,S,y,O);if(!A||k||O){x.log(`[transmuxer-interface, ${r.type}]: Starting new transmux session for sn: ${h.sn} p: ${h.part} level: ${h.level} id: ${h.id}\n        discontinuity: ${k}\n        trackSwitch: ${S}\n        contiguous: ${A}\n        accurateTimeOffset: ${c}\n        timeOffset: ${y}\n        initSegmentChange: ${O}`);const o=new $r(e,n,t,l,d);this.configureTransmuxer(o)}if(this.frag=r,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:data,decryptdata:T,chunkMeta:h,state:R},data instanceof ArrayBuffer?[data]:[]);else if(v){const t=v.push(data,T,h,R);Br(t)?(v.async=!0,t.then((data=>{this.handleTransmuxComplete(data)})).catch((t=>{this.transmuxerError(t,h,"transmuxer-interface push error")}))):(v.async=!1,this.handleTransmuxComplete(t))}}flush(t){t.transmuxing.start=self.performance.now();const{transmuxer:e}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:t});else if(e){let n=e.flush(t);Br(n)||e.async?(Br(n)||(n=Promise.resolve(n)),n.then((data=>{this.handleFlushResult(data,t)})).catch((e=>{this.transmuxerError(e,t,"transmuxer-interface flush error")}))):this.handleFlushResult(n,t)}}transmuxerError(t,e,n){this.hls&&(this.error=t,this.hls.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,fatal:!1,error:t,err:t,reason:n}))}handleFlushResult(t,e){t.forEach((t=>{this.handleTransmuxComplete(t)})),this.onFlush(e)}onWorkerMessage(t){const data=t.data;if(null==data||!data.event)return void x.warn("worker message received with no "+(data?"event name":"data"));const e=this.hls;if(this.hls)switch(data.event){case"init":{var n;const t=null==(n=this.workerContext)?void 0:n.objectURL;t&&self.URL.revokeObjectURL(t);break}case"transmuxComplete":this.handleTransmuxComplete(data.data);break;case"flush":this.onFlush(data.data);break;case"workerLog":x[data.data.logType]&&x[data.data.logType](data.data.message);break;default:data.data=data.data||{},data.data.frag=this.frag,data.data.id=this.id,e.trigger(data.event,data.data)}}configureTransmuxer(t){const{transmuxer:e}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:t}):e&&e.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}function Wr(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Yr(t[i].attrs,e[i].attrs))return!1;return!0}function Yr(t,e,n){const r=t["STABLE-RENDITION-ID"];return r&&!n?r===e["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((n=>t[n]!==e[n]))}function qr(t,e){return e.label.toLowerCase()===t.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(t.lang||"").toLowerCase())}class zr{constructor(t){this.buffered=void 0;const e=(e,n,r)=>{if((n>>>=0)>r-1)throw new DOMException(`Failed to execute '${e}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${r})`);return t[n][e]};this.buffered={get length(){return t.length},end:n=>e("end",n,t.length),start:n=>e("start",n,t.length)}}}class Xr{constructor(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}append(t,e,n){const r=this.queues[e];r.push(t),1!==r.length||n||this.executeNext(e)}insertAbort(t,e){this.queues[e].unshift(t),this.executeNext(e)}appendBlocker(t){let e;const n=new Promise((t=>{e=t})),r={execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(r,t),n}executeNext(t){const e=this.queues[t];if(e.length){const n=e[0];try{n.execute()}catch(e){x.warn(`[buffer-operation-queue]: Exception executing "${t}" SourceBuffer operation: ${e}`),n.onError(e);const r=this.buffers[t];null!=r&&r.updating||this.shiftAndExecuteNext(t)}}}shiftAndExecuteNext(t){this.queues[t].shift(),this.executeNext(t)}current(t){return this.queues[t][0]}}const Qr=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;function Jr(t){const e=t.querySelectorAll("source");[].slice.call(e).forEach((source=>{t.removeChild(source)}))}const Zr={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ts=t=>String.fromCharCode(Zr[t]||t),es=15,is=100,ns={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rs={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ss={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},as={25:2,26:4,29:6,30:8,31:10,27:13,28:15},os=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class ls{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const n="function"==typeof e?e():e;x.log(`${this.time} [${t}] ${n}`)}}}const cs=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].toString(16));return e};class us{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let i=0;i<e.length;i++){const style=e[i];t.hasOwnProperty(style)&&(this[style]=t[style])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class hs{constructor(){this.uchar=" ",this.penState=new us}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class ds{constructor(t){this.chars=[],this.pos=0,this.currPenState=new us,this.cueStartTime=null,this.logger=void 0;for(let i=0;i<is;i++)this.chars.push(new hs);this.logger=t}equals(t){for(let i=0;i<is;i++)if(!this.chars[i].equals(t.chars[i]))return!1;return!0}copy(t){for(let i=0;i<is;i++)this.chars[i].copy(t.chars[i])}isEmpty(){let t=!0;for(let i=0;i<is;i++)if(!this.chars[i].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>is&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=is)}moveCursor(t){const e=this.pos+t;if(t>1)for(let i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=ts(t);this.pos>=is?this.logger.log(0,(()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))}clearFromPos(t){let i;for(i=t;i<is;i++)this.chars[i].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let i=0;i<is;i++){const n=this.chars[i].uchar;" "!==n&&(e=!1),t.push(n)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t);this.chars[this.pos].setPenState(this.currPenState)}}class fs{constructor(t){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let i=0;i<es;i++)this.rows.push(new ds(t));this.logger=t}reset(){for(let i=0;i<es;i++)this.rows[i].clear();this.currRow=14}equals(t){let e=!0;for(let i=0;i<es;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e}copy(t){for(let i=0;i<es;i++)this.rows[i].copy(t.rows[i])}isEmpty(){let t=!0;for(let i=0;i<es;i++)if(!this.rows[i].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t);this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,(()=>"pacData = "+JSON.stringify(t)));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let i=0;i<es;i++)this.rows[i].clear();const t=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const r=n.rows[t].cueStartTime,time=this.logger.time;if(null!==r&&null!==time&&r<time)for(let i=0;i<this.nrRollUpRows;i++)this.rows[e-this.nrRollUpRows+i+1].copy(n.rows[t+i])}}this.currRow=e;const n=this.rows[this.currRow];if(null!==t.indent){const e=t.indent,r=Math.max(e-1,0);n.setCursor(t.indent),t.color=n.chars[r].penState.foreground}const r={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(t){this.logger.log(2,(()=>"bkgData = "+JSON.stringify(t))),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let text="",n=-1;for(let i=0;i<es;i++){const r=this.rows[i].getTextString();r&&(n=i+1,t?e.push("Row "+n+": '"+r+"'"):e.push(r.trim()))}return e.length>0&&(text=t?"["+e.join(" | ")+"]":e.join("\n")),text}getTextAndFormat(){return this.rows}}class gs{constructor(t,e,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new fs(n),this.nonDisplayedMemory=new fs(n),this.lastOutputScreen=new fs(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,(()=>"MODE="+t)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let i=0;i<t.length;i++)this.writeScreen.insertChar(t[i]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>e+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{const n=Math.floor(t/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=r[n]}this.logger.log(2,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const time=this.logger.time;null!==time&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,time,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:time):this.cueStartTime=time,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class ps{constructor(t,e,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const r=this.logger=new ls;this.channels=[null,new gs(t,e,r),new gs(t+1,n,r)]}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(time,t){this.logger.time=time;for(let i=0;i<t.length;i+=2){const a=127&t[i],b=127&t[i+1];let e=!1,n=null;if(0===a&&0===b)continue;this.logger.log(3,(()=>"["+cs([t[i],t[i+1]])+"] -> ("+cs([a,b])+")"));const r=this.cmdHistory;if(a>=16&&a<=31){if(vs(a,b,r)){ms(null,null,r),this.logger.log(3,(()=>"Repeated command ("+cs([a,b])+") is dropped"));continue}ms(a,b,this.cmdHistory),e=this.parseCmd(a,b),e||(e=this.parseMidrow(a,b)),e||(e=this.parsePAC(a,b)),e||(e=this.parseBackgroundAttributes(a,b))}else ms(null,null,r);if(!e&&(n=this.parseChars(a,b),n)){const t=this.currentChannel;if(t&&t>0){this.channels[t].insertChars(n)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}e||n||this.logger.log(2,(()=>"Couldn't parse cleaned data "+cs([a,b])+" orig: "+cs([t[i],t[i+1]])))}}parseCmd(a,b){if(!((20===a||28===a||21===a||29===a)&&b>=32&&b<=47)&&!((23===a||31===a)&&b>=33&&b<=35))return!1;const t=20===a||21===a||23===a?1:2,e=this.channels[t];return 20===a||21===a||28===a||29===a?32===b?e.ccRCL():33===b?e.ccBS():34===b?e.ccAOF():35===b?e.ccAON():36===b?e.ccDER():37===b?e.ccRU(2):38===b?e.ccRU(3):39===b?e.ccRU(4):40===b?e.ccFON():41===b?e.ccRDC():42===b?e.ccTR():43===b?e.ccRTD():44===b?e.ccEDM():45===b?e.ccCR():46===b?e.ccENM():47===b&&e.ccEOC():e.ccTO(b-32),this.currentChannel=t,!0}parseMidrow(a,b){let t=0;if((17===a||25===a)&&b>=32&&b<=47){if(t=17===a?1:2,t!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const e=this.channels[t];return!!e&&(e.ccMIDROW(b),this.logger.log(3,(()=>"MIDROW ("+cs([a,b])+")")),!0)}return!1}parsePAC(a,b){let t;if(!((a>=17&&a<=23||a>=25&&a<=31)&&b>=64&&b<=127)&&!((16===a||24===a)&&b>=64&&b<=95))return!1;const e=a<=23?1:2;t=b>=64&&b<=95?1===e?ns[a]:ss[a]:1===e?rs[a]:as[a];const n=this.channels[e];return!!n&&(n.setPAC(this.interpretPAC(t,b)),this.currentChannel=e,!0)}interpretPAC(t,e){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:t};return n=e>95?e-96:e-64,r.underline=!(1&~n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r}parseChars(a,b){let t,e=null,n=null;if(a>=25?(t=2,n=a-8):(t=1,n=a),n>=17&&n<=19){let r;r=17===n?b+80:18===n?b+112:b+144,this.logger.log(2,(()=>"Special char '"+ts(r)+"' in channel "+t)),e=[r]}else a>=32&&a<=127&&(e=0===b?[a]:[a,b]);return e&&this.logger.log(3,(()=>"Char codes =  "+cs(e).join(","))),e}parseBackgroundAttributes(a,b){if(!((16===a||24===a)&&b>=32&&b<=47)&&!((23===a||31===a)&&b>=45&&b<=47))return!1;let t;const e={};16===a||24===a?(t=Math.floor((b-32)/2),e.background=os[t],b%2==1&&(e.background=e.background+"_semi")):45===b?e.background="transparent":(e.foreground="black",47===b&&(e.underline=!0));const n=a<=23?1:2;return this.channels[n].setBkgData(e),!0}reset(){for(let i=0;i<Object.keys(this.channels).length;i++){const t=this.channels[i];t&&t.reset()}ms(null,null,this.cmdHistory)}cueSplitAtTime(t){for(let i=0;i<this.channels.length;i++){const e=this.channels[i];e&&e.cueSplitAtTime(t)}}}function ms(a,b,t){t.a=a,t.b=b}function vs(a,b,t){return t.a===a&&t.b===b}class ys{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,n){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var bs=function(){if(null!=Q&&Q.VTTCue)return self.VTTCue;const t=["","lr","rl"],e=["start","middle","end","left","right"];function n(t,e){if("string"!=typeof e)return!1;if(!Array.isArray(t))return!1;const n=e.toLowerCase();return!!~t.indexOf(n)&&n}function r(t){return n(e,t)}function o(t,...e){let i=1;for(;i<arguments.length;i++){const e=arguments[i];for(const p in e)t[p]=e[p]}return t}function l(e,l,text){const c=this,h={enumerable:!0};c.hasBeenReset=!1;let d="",f=!1,m=e,v=l,y=text,T=null,E="",k=!0,S="auto",_="start",L=50,C="middle",A=50,w="middle";Object.defineProperty(c,"id",o({},h,{get:function(){return d},set:function(t){d=""+t}})),Object.defineProperty(c,"pauseOnExit",o({},h,{get:function(){return f},set:function(t){f=!!t}})),Object.defineProperty(c,"startTime",o({},h,{get:function(){return m},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",o({},h,{get:function(){return v},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",o({},h,{get:function(){return y},set:function(t){y=""+t,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",o({},h,{get:function(){return T},set:function(t){T=t,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",o({},h,{get:function(){return E},set:function(e){const r=function(e){return n(t,e)}(e);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");E=r,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",o({},h,{get:function(){return k},set:function(t){k=!!t,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",o({},h,{get:function(){return S},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");S=t,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",o({},h,{get:function(){return _},set:function(t){const e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",o({},h,{get:function(){return L},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");L=t,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",o({},h,{get:function(){return C},set:function(t){const e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");C=e,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",o({},h,{get:function(){return A},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");A=t,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",o({},h,{get:function(){return w},set:function(t){const e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");w=e,this.hasBeenReset=!0}})),c.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l}();class Ts{decode(data,t){if(!data)return"";if("string"!=typeof data)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(data))}}function Es(input){function t(t,e,s,n){return 3600*(0|t)+60*(0|e)+(0|s)+parseFloat(n||0)}const e=input.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?t(e[2],e[3],0,e[4]):t(e[1],e[2],e[3],e[4]):null}class ks{constructor(){this.values=Object.create(null)}set(t,e){this.get(t)||""===e||(this.values[t]=e)}get(t,e,n){return n?this.has(t)?this.values[t]:e[n]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,a){for(let n=0;n<a.length;++n)if(e===a[n]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const n=parseFloat(e);if(n>=0&&n<=100)return this.set(t,n),!0}return!1}}function Ss(input,t,e,n){const r=n?input.split(n):[input];for(const i in r){if("string"!=typeof r[i])continue;const n=r[i].split(e);if(2!==n.length)continue;t(n[0],n[1])}}const _s=new bs(0,0,""),Ls="middle"===_s.align?"middle":"center";function Cs(input,t,e){const n=input;function r(){const t=Es(input);if(null===t)throw new Error("Malformed timestamp: "+n);return input=input.replace(/^[^\sa-zA-Z-]+/,""),t}function o(){input=input.replace(/^\s+/,"")}if(o(),t.startTime=r(),o(),"--\x3e"!==input.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);input=input.slice(3),o(),t.endTime=r(),o(),function(input,t){const n=new ks;Ss(input,(function(t,r){let o;switch(t){case"region":for(let i=e.length-1;i>=0;i--)if(e[i].id===r){n.set(t,e[i].region);break}break;case"vertical":n.alt(t,r,["rl","lr"]);break;case"line":o=r.split(","),n.integer(t,o[0]),n.percent(t,o[0])&&n.set("snapToLines",!1),n.alt(t,o[0],["auto"]),2===o.length&&n.alt("lineAlign",o[1],["start",Ls,"end"]);break;case"position":o=r.split(","),n.percent(t,o[0]),2===o.length&&n.alt("positionAlign",o[1],["start",Ls,"end","line-left","line-right","auto"]);break;case"size":n.percent(t,r);break;case"align":n.alt(t,r,["start",Ls,"end","left","right"])}}),/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");let line=n.get("line","auto");"auto"===line&&-1===_s.line&&(line=-1),t.line=line,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",Ls);let r=n.get("position","auto");"auto"===r&&50===_s.position&&(r="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=r}(input,t)}function As(input){return input.replace(/<br(?: \/)?>/gi,"\n")}class ws{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Ts,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(data){const t=this;function e(){let e=t.buffer,n=0;for(e=As(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;const line=e.slice(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.slice(n),line}data&&(t.buffer+=t.decoder.decode(data,{stream:!0}));try{let line="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;line=e();const n=line.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==n||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let n=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(n?n=!1:line=e(),t.state){case"HEADER":/:/.test(line)?Ss(line,(function(t,e){}),/:/):line||(t.state="ID");continue;case"NOTE":line||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(line)){t.state="NOTE";break}if(!line)continue;if(t.cue=new bs(0,0,""),t.state="CUE",-1===line.indexOf("--\x3e")){t.cue.id=line;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Cs(line,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const e=-1!==line.indexOf("--\x3e");if(!line||e&&(n=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=line}continue;case"BADCUE":line||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const Os=/\r\n|\n\r|\n|\r/g,Rs=function(t,e,n=0){return t.slice(n,n+e.length)===e},Ds=function(text){let t=5381,i=text.length;for(;i;)t=33*t^text.charCodeAt(--i);return(t>>>0).toString()};function Is(t,e,text){return Ds(t.toString())+Ds(e.toString())+Ds(text)}function xs(t,e,n,r,o,l,c){const h=new ws,d=Ct(new Uint8Array(t)).trim().replace(Os,"\n").split("\n"),f=[],m=e?function(t,e=1){return Cr(t,Lr,1/e)}(e.baseTime,e.timescale):0;let v,y="00:00.000",T=0,E=0,k=!0;h.oncue=function(t){const l=n[r];let c=n.ccOffset;const h=(T-m)/9e4;if(null!=l&&l.new&&(void 0!==E?c=n.ccOffset=l.start:function(t,e,n){let r=t[e],o=t[r.prevCC];if(!o||!o.new&&r.new)return t.ccOffset=t.presentationOffset=r.start,void(r.new=!1);for(;null!=(l=o)&&l.new;){var l;t.ccOffset+=r.start-o.start,r.new=!1,r=o,o=t[r.prevCC]}t.presentationOffset=n}(n,r,h)),h){if(!e)return void(v=new Error("Missing initPTS for VTT MPEGTS"));c=h-n.presentationOffset}const d=t.endTime-t.startTime,y=Ir(9e4*(t.startTime+c-E),9e4*o)/9e4;t.startTime=Math.max(y,0),t.endTime=Math.max(y+d,0);const text=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(text)),t.id||(t.id=Is(t.startTime,t.endTime,text)),t.endTime>0&&f.push(t)},h.onparsingerror=function(t){v=t},h.onflush=function(){v?c(v):l(f)},d.forEach((line=>{if(k){if(Rs(line,"X-TIMESTAMP-MAP=")){k=!1,line.slice(16).split(",").forEach((t=>{Rs(t,"LOCAL:")?y=t.slice(6):Rs(t,"MPEGTS:")&&(T=parseInt(t.slice(7)))}));try{E=function(t){let e=parseInt(t.slice(-3));const n=parseInt(t.slice(-6,-4)),r=parseInt(t.slice(-9,-7)),o=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!(S(e)&&S(n)&&S(r)&&S(o)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${t}`);return e+=1e3*n,e+=6e4*r,e+=36e5*o,e}(y)/1e3}catch(t){v=t}return}""===line&&(k=!1)}h.parse(line+"\n")})),h.flush()}const Ps="stpp.ttml.im1t",Ms=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Fs=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Ns={left:"start",center:"center",right:"end",start:"start",end:"end"};function js(t,e,n,r){const o=Ut(new Uint8Array(t),["mdat"]);if(0===o.length)return void r(new Error("Could not parse IMSC1 mdat"));const l=o.map((t=>Ct(t))),c=function(t,e,n=1,r=!1){return Cr(t,e,1/n,r)}(e.baseTime,1,e.timescale);try{l.forEach((t=>n(function(t,e){const n=(new DOMParser).parseFromString(t,"text/xml"),r=n.getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const o={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(o).reduce(((t,e)=>(t[e]=r.getAttribute(`ttp:${e}`)||o[e],t)),{}),c="preserve"!==r.getAttribute("xml:space"),h=Bs(Us(r,"styling","style")),d=Bs(Us(r,"layout","region")),f=Us(r,"body","[begin]");return[].map.call(f,(t=>{const n=$s(t,c);if(!n||!t.hasAttribute("begin"))return null;const r=Ks(t.getAttribute("begin"),l),o=Ks(t.getAttribute("dur"),l);let f=Ks(t.getAttribute("end"),l);if(null===r)throw Gs(t);if(null===f){if(null===o)throw Gs(t);f=r+o}const m=new bs(r-e,f-e,n);m.id=Is(m.startTime,m.endTime,m.text);const v=function(t,style,e){const n="http://www.w3.org/ns/ttml#styling";let r=null;const o=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=null!=t&&t.hasAttribute("style")?t.getAttribute("style"):null;l&&e.hasOwnProperty(l)&&(r=e[l]);return o.reduce(((e,o)=>{const l=Hs(style,n,o)||Hs(t,n,o)||Hs(r,n,o);return l&&(e[o]=l),e}),{})}(d[t.getAttribute("region")],h[t.getAttribute("style")],h),{textAlign:y}=v;if(y){const t=Ns[y];t&&(m.lineAlign=t),m.align=y}return k(m,v),m})).filter((t=>null!==t))}(t,c))))}catch(t){r(t)}}function Us(t,e,n){const r=t.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function Bs(t){return t.reduce(((t,element)=>{const e=element.getAttribute("xml:id");return e&&(t[e]=element),t}),{})}function $s(element,t){return[].slice.call(element.childNodes).reduce(((e,n,i)=>{var r;return"br"===n.nodeName&&i?e+"\n":null!=(r=n.childNodes)&&r.length?$s(n,t):t?e+n.textContent.trim().replace(/\s+/g," "):e+n.textContent}),"")}function Hs(element,t,e){return element&&element.hasAttributeNS(t,e)?element.getAttributeNS(t,e):null}function Gs(t){return new Error(`Could not parse ttml timestamp ${t}`)}function Ks(t,e){if(!t)return null;let n=Es(t);return null===n&&(Ms.test(t)?n=function(t,e){const n=Ms.exec(t),r=(0|n[4])+(0|n[5])/e.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+r/e.frameRate}(t,e):Fs.test(t)&&(n=function(t,e){const n=Fs.exec(t),r=Number(n[1]);switch(n[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}(t,e))),n}function Vs(track){return track.characteristics&&/transcribes-spoken-dialog/gi.test(track.characteristics)&&/describes-music-and-sound/gi.test(track.characteristics)?"captions":"subtitles"}function Ws(t,e){return!!t&&t.kind===Vs(e)&&qr(e,t)}class Ys{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(C.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(C.MANIFEST_PARSED,this.onManifestParsed,this),t.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(C.BUFFER_CODECS,this.onBufferCodecs,this),t.on(C.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(C.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(C.MANIFEST_PARSED,this.onManifestParsed,this),t.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(C.BUFFER_CODECS,this.onBufferCodecs,this),t.off(C.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,data){const e=this.hls.levels[data.droppedLevel];this.isLevelAllowed(e)&&this.restrictedLevels.push({bitrate:e.bitrate,height:e.height,width:e.width})}onMediaAttaching(t,data){this.media=data.media instanceof HTMLVideoElement?data.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(t,data){const e=this.hls;this.restrictedLevels=[],this.firstLevel=data.firstLevel,e.config.capLevelToPlayerSize&&data.video&&this.startCapping()}onLevelsUpdated(t,data){this.timer&&S(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(t,data){this.hls.config.capLevelToPlayerSize&&data.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const t=this.hls.levels;if(t.length){const e=this.hls,n=this.getMaxLevel(t.length-1);n!==this.autoLevelCapping&&x.log(`Setting autoLevelCapping to ${n}: ${t[n].height}p@${t[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),e.autoLevelCapping=n,e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const n=e.filter(((e,n)=>this.isLevelAllowed(e)&&n<=t));return this.clientRect=null,Ys.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const n=t.getBoundingClientRect();e.width=n.width,e.height=n.height,e.width||e.height||(e.width=n.right-n.left||t.width||0,e.height=n.bottom-n.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(t){}return t}isLevelAllowed(t){return!this.restrictedLevels.some((e=>t.bitrate===e.bitrate&&t.width===e.width&&t.height===e.height))}static getMaxLevelByMediaSize(t,e,n){if(null==t||!t.length)return-1;let r=t.length-1;const o=Math.max(e,n);for(let i=0;i<t.length;i+=1){const e=t[i];if((e.width>=o||e.height>=o)&&(l=e,!(c=t[i+1])||l.width!==c.width||l.height!==c.height)){r=i;break}}var l,c;return r}}const qs="[eme]";class zs{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=zs.CDMCleanupPromise?[zs.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=x.debug.bind(x,qs),this.log=x.log.bind(x,qs),this.warn=x.warn.bind(x,qs),this.error=x.error.bind(x,qs),this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(C.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(C.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(C.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(C.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(C.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(C.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:n}=this.config,r=e[t];if(r)return r.licenseUrl;if(t===J.WIDEVINE&&n)return n;throw new Error(`no license server URL configured for key-system "${t}"`)}getServerCertificateUrl(t){const{drmSystems:e}=this.config,n=e[t];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const e=this.hls.levels,n=(t,i,a)=>!!t&&a.indexOf(t)===i,r=e.map((t=>t.audioCodec)).filter(n),o=e.map((t=>t.videoCodec)).filter(n);return r.length+o.length===0&&o.push("avc1.42e01e"),new Promise(((e,n)=>{const l=t=>{const c=t.shift();this.getMediaKeysPromise(c,r,o).then((t=>e({keySystem:c,mediaKeys:t}))).catch((e=>{t.length?l(t):n(e instanceof Xs?e:new Xs({type:A.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_NO_ACCESS,error:e,fatal:!0},e.message))}))};l(t)}))}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:n}=this.config;if("function"!=typeof n){let t=`Configured requestMediaKeySystemAccess is not a function ${n}`;return null===lt&&"http:"===self.location.protocol&&(t=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(t))}return n(t,e)}getMediaKeysPromise(t,e,n){const r=function(t,e,n,r){let o;switch(t){case J.FAIRPLAY:o=["cenc","sinf"];break;case J.WIDEVINE:case J.PLAYREADY:o=["cenc"];break;case J.CLEARKEY:o=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${t}`)}return function(t,e,n,r){return[{initDataTypes:t,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map((t=>({contentType:`audio/mp4; codecs="${t}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null}))),videoCapabilities:n.map((t=>({contentType:`video/mp4; codecs="${t}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null})))}]}(o,e,n,r)}(t,e,n,this.config.drmSystemOptions),o=this.keySystemAccessPromises[t];let l=null==o?void 0:o.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${t}" key-system access with config: ${JSON.stringify(r)}`),l=this.requestMediaKeySystemAccess(t,r);const e=this.keySystemAccessPromises[t]={keySystemAccess:l};return l.catch((e=>{this.log(`Failed to obtain access to key-system "${t}": ${e}`)})),l.then((n=>{this.log(`Access for key-system "${n.keySystem}" obtained`);const r=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),e.mediaKeys=n.createMediaKeys().then((e=>(this.log(`Media-keys created for "${t}"`),r.then((n=>n?this.setMediaKeysServerCertificate(e,t,n):e))))),e.mediaKeys.catch((e=>{this.error(`Failed to create media-keys for "${t}"}: ${e}`)})),e.mediaKeys}))}return l.then((()=>o.mediaKeys))}createMediaKeySessionContext({decryptdata:t,keySystem:e,mediaKeys:n}){this.log(`Creating key-system session "${e}" keyId: ${Ot(t.keyId||[])}`);const r=n.createSession(),o={decryptdata:t,keySystem:e,mediaKeys:n,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const n=this.createMediaKeySessionContext(t),r=this.getKeyIdString(e),o="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,o,e.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(null===t.keyId)throw new Error("keyId is null");return Ot(t.keyId)}updateKeySession(t,data){var e;const n=t.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyID ${Ot((null==(e=t.decryptdata)?void 0:e.keyId)||[])}\n      } (data length: ${data?data.byteLength:data})`),n.update(data)}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){return new Promise(((e,n)=>{const r=ot(this.config),o=t.map(nt).filter((t=>!!t&&-1!==r.indexOf(t)));return this.getKeySystemSelectionPromise(o).then((({keySystem:t})=>{const r=at(t);r?e(r):n(new Error(`Unable to find format for key-system "${t}"`))})).catch(n)}))}loadKey(data){const t=data.keyInfo.decryptdata,e=this.getKeyIdString(t),n=`(keyId: ${e} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);let r=this.keyIdToKeySessionPromise[e];return r||(r=this.keyIdToKeySessionPromise[e]=this.getKeySystemForKeyPromise(t).then((({keySystem:e,mediaKeys:r})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${data.frag.sn} ${data.frag.type}: ${data.frag.level} using key ${n}`),this.attemptSetMediaKeys(e,r).then((()=>{this.throwIfDestroyed();const n=this.createMediaKeySessionContext({keySystem:e,mediaKeys:r,decryptdata:t});return this.generateRequestWithPreferredKeySession(n,"cenc",t.pssh,"playlist-key")}))))),r.catch((t=>this.handleError(t)))),r}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){this.hls&&(this.error(t.message),t instanceof Xs?this.hls.trigger(C.ERROR,t.data):this.hls.trigger(C.ERROR,{type:A.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){const e=this.getKeyIdString(t),n=this.keyIdToKeySessionPromise[e];if(!n){const e=nt(t.keyFormat),n=e?[e]:ot(this.config);return this.attemptKeySystemAccess(n)}return n}getKeySystemSelectionPromise(t){if(t.length||(t=ot(this.config)),0===t.length)throw new Xs({type:A.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}_onMediaEncrypted(t){const{initDataType:e,initData:n}=t;if(this.debug(`"${t.type}" event: init data type: "${e}"`),null===n)return;let r,o;if("sinf"===e&&this.config.drmSystems[J.FAIRPLAY]){const t=xt(new Uint8Array(n));try{const e=Y(JSON.parse(t).sinf),n=Wt(new Uint8Array(e));if(!n)return;r=n.subarray(8,24),o=J.FAIRPLAY}catch(t){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const t=function(t){if(!(t instanceof ArrayBuffer)||t.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},view=new DataView(t),n=view.getUint32(0);if(t.byteLength!==n&&n>44)return null;if(1886614376!==view.getUint32(4))return null;if(e.version=view.getUint32(8)>>>24,e.version>1)return null;e.systemId=Ot(new Uint8Array(t,12,16));const r=view.getUint32(28);if(0===e.version){if(n-32<r)return null;e.data=new Uint8Array(t,32,r)}else if(1===e.version){e.kids=[];for(let i=0;i<r;i++)e.kids.push(new Uint8Array(t,32+16*i,16))}return e}(n);if(null===t)return;0===t.version&&t.systemId===st&&t.data&&(r=t.data.subarray(8,24)),o=function(t){if(t===st)return J.WIDEVINE}(t.systemId)}if(!o||!r)return;const l=Ot(r),{keyIdToKeySessionPromise:c,mediaKeySessions:h}=this;let d=c[l];for(let i=0;i<h.length;i++){const t=h[i],o=t.decryptdata;if(o.pssh||!o.keyId)continue;const f=Ot(o.keyId);if(l===f||-1!==o.uri.replace(/-/g,"").indexOf(l)){d=c[f],delete c[f],o.pssh=new Uint8Array(n),o.keyId=r,d=c[l]=d.then((()=>this.generateRequestWithPreferredKeySession(t,e,n,"encrypted-event-key-match")));break}}d||(d=c[l]=this.getKeySystemSelectionPromise([o]).then((({keySystem:t,mediaKeys:o})=>{var c;this.throwIfDestroyed();const h=new ee("ISO-23001-7",l,null!=(c=at(t))?c:"");return h.pssh=new Uint8Array(n),h.keyId=r,this.attemptSetMediaKeys(t,o).then((()=>{this.throwIfDestroyed();const r=this.createMediaKeySessionContext({decryptdata:h,keySystem:t,mediaKeys:o});return this.generateRequestWithPreferredKeySession(r,e,n,"encrypted-event-no-match")}))}))),d.catch((t=>this.handleError(t)))}_onWaitingForKey(t){this.log(`"${t.type}" event`)}attemptSetMediaKeys(t,e){const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const r=Promise.all(n).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(e)}));return this.setMediaKeysQueue.push(r),r.then((()=>{this.log(`Media-keys set for "${t}"`),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((p=>-1===n.indexOf(p)))}))}generateRequestWithPreferredKeySession(t,e,n,r){var o,l;const c=null==(o=this.config.drmSystems)||null==(l=o[t.keySystem])?void 0:l.generateRequest;if(c)try{const r=c.call(this.hls,e,n,t);if(!r)throw new Error("Invalid response from configured generateRequest filter");e=r.initDataType,n=t.decryptdata.pssh=r.initData?new Uint8Array(r.initData):null}catch(t){var h;if(this.warn(t.message),null!=(h=this.hls)&&h.config.debug)throw t}if(null===n)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(t);const d=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${r}": ${d} (init data type: ${e} length: ${n?n.byteLength:null})`);const f=new Kr,m=t._onmessage=e=>{const n=t.mediaKeysSession;if(!n)return void f.emit("error",new Error("invalid state"));const{messageType:r,message:o}=e;this.log(`"${r}" message event for session "${n.sessionId}" message size: ${o.byteLength}`),"license-request"===r||"license-renewal"===r?this.renewLicense(t,o).catch((t=>{this.handleError(t),f.emit("error",t)})):"license-release"===r?t.keySystem===J.FAIRPLAY&&(this.updateKeySession(t,X("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${r}"`)},v=t._onkeystatuseschange=e=>{if(!t.mediaKeysSession)return void f.emit("error",new Error("invalid state"));this.onKeyStatusChange(t);const n=t.keyStatus;f.emit("keyStatus",n),"expired"===n&&(this.warn(`${t.keySystem} expired for key ${d}`),this.renewKeySession(t))};t.mediaKeysSession.addEventListener("message",m),t.mediaKeysSession.addEventListener("keystatuseschange",v);const y=new Promise(((t,e)=>{f.on("error",e),f.on("keyStatus",(n=>{n.startsWith("usable")?t():"output-restricted"===n?e(new Xs({type:A.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===n?e(new Xs({type:A.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${n}"`)):"expired"===n?e(new Error("key expired while generating request")):this.warn(`unhandled key status change "${n}"`)}))}));return t.mediaKeysSession.generateRequest(e,n).then((()=>{var e;this.log(`Request generated for key-session "${null==(e=t.mediaKeysSession)?void 0:e.sessionId}" keyId: ${d}`)})).catch((t=>{throw new Xs({type:A.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_NO_SESSION,error:t,fatal:!1},`Error generating key-session request: ${t}`)})).then((()=>y)).catch((e=>{throw f.removeAllListeners(),this.removeSession(t),e})).then((()=>(f.removeAllListeners(),t)))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach(((e,n)=>{this.log(`key status change "${e}" for keyStatuses keyId: ${Ot("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${Ot(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=e}))}fetchServerCertificate(t){const e=this.config,n=new(0,e.loader)(e),r=this.getServerCertificateUrl(t);return r?(this.log(`Fetching server certificate for "${t}"`),new Promise(((o,l)=>{const c={responseType:"arraybuffer",url:r},h=e.certLoadPolicy.default,d={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(t,e,n,r)=>{o(t.data)},onError:(e,n,o,h)=>{l(new Xs({type:A.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:y({url:c.url,data:void 0},e)},`"${t}" certificate request failed (${r}). Status: ${e.code} (${e.text})`))},onTimeout:(e,n,o)=>{l(new Xs({type:A.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:c.url,data:void 0}},`"${t}" certificate request timed out (${r})`))},onAbort:(t,e,n)=>{l(new Error("aborted"))}};n.load(c,d,f)}))):Promise.resolve()}setMediaKeysServerCertificate(t,e,n){return new Promise(((r,o)=>{t.setServerCertificate(n).then((o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${null==n?void 0:n.byteLength}) on "${e}"`),r(t)})).catch((t=>{o(new Xs({type:A.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:t,fatal:!0},t.message))}))}))}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then((data=>this.updateKeySession(t,new Uint8Array(data)).catch((t=>{throw new Xs({type:A.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:t,fatal:!0},t.message)}))))}unpackPlayReadyKeyMessage(t,e){const n=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!n.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;const r=(new DOMParser).parseFromString(n,"application/xml"),o=r.querySelectorAll("HttpHeader");if(o.length>0){let header;for(let i=0,e=o.length;i<e;i++){var l,c;header=o[i];const e=null==(l=header.querySelector("name"))?void 0:l.textContent,n=null==(c=header.querySelector("value"))?void 0:c.textContent;e&&n&&t.setRequestHeader(e,n)}}const h=r.querySelector("Challenge"),d=null==h?void 0:h.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return X(atob(d))}setupLicenseXHR(t,e,n,r){const o=this.config.licenseXhrSetup;return o?Promise.resolve().then((()=>{if(!n.decryptdata)throw new Error("Key removed");return o.call(this.hls,t,e,n,r)})).catch((l=>{if(!n.decryptdata)throw l;return t.open("POST",e,!0),o.call(this.hls,t,e,n,r)})).then((n=>{t.readyState||t.open("POST",e,!0);return{xhr:t,licenseChallenge:n||r}})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:r}))}requestLicense(t,e){const n=this.config.keyLoadPolicy.default;return new Promise(((r,o)=>{const l=this.getLicenseServerUrl(t.keySystem);this.log(`Sending license request to URL: ${l}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return o(new Error("invalid state"));if(4===c.readyState)if(200===c.status){this._requestLicenseFailureCount=0;let data=c.response;this.log(`License received ${data instanceof ArrayBuffer?data.byteLength:data}`);const e=this.config.licenseResponseCallback;if(e)try{data=e.call(this.hls,c,l,t)}catch(t){this.error(t)}r(data)}else{const h=n.errorRetry,d=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||c.status>=400&&c.status<500)o(new Xs({type:A.KEY_SYSTEM_ERROR,details:w.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:c,response:{url:l,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${l}). Status: ${c.status} (${c.statusText})`));else{const n=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${n} attempts left`),this.requestLicense(t,e).then(r,o)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=c,this.setupLicenseXHR(c,l,t,e).then((({xhr:e,licenseChallenge:n})=>{t.keySystem==J.PLAYREADY&&(n=this.unpackPlayReadyKeyMessage(e,n)),e.send(n)}))}))}onMediaAttached(t,data){if(!this.config.emeEnabled)return;const e=data.media;this.media=e,e.addEventListener("encrypted",this.onMediaEncrypted),e.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const t=this.media,e=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},ee.clearKeyUriToKeyIdMap();const n=e.length;zs.CDMCleanupPromise=Promise.all(e.map((t=>this.removeSession(t))).concat(null==t?void 0:t.setMediaKeys(null).catch((t=>{this.log(`Could not clear media keys: ${t}`)})))).then((()=>{n&&(this.log("finished closing key sessions and clearing media keys"),e.length=0)})).catch((t=>{this.log(`Could not close sessions and clear media keys: ${t}`)}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:e}){if(e&&this.config.emeEnabled&&!this.keyFormatPromise){const t=e.reduce(((t,e)=>(-1===t.indexOf(e.keyFormat)&&t.push(e.keyFormat),t)),[]);this.log(`Selecting key-system from session-keys ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:n}=t;if(e){this.log(`Remove licenses and keys and close session ${e.sessionId}`),t._onmessage&&(e.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(e.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(t);return r>-1&&this.mediaKeySessions.splice(r,1),e.remove().catch((t=>{this.log(`Could not remove session: ${t}`)})).then((()=>e.close())).catch((t=>{this.log(`Could not close session: ${t}`)}))}}}zs.CDMCleanupPromise=void 0;class Xs extends Error{constructor(data,t){super(t),this.data=void 0,data.error||(data.error=new Error(t)),this.data=data,data.err=data.error}}var Qs,Js,Zs;!function(t){t.MANIFEST="m",t.AUDIO="a",t.VIDEO="v",t.MUXED="av",t.INIT="i",t.CAPTION="c",t.TIMED_TEXT="tt",t.KEY="k",t.OTHER="o"}(Qs||(Qs={})),function(t){t.DASH="d",t.HLS="h",t.SMOOTH="s",t.OTHER="o"}(Js||(Js={})),function(t){t.OBJECT="CMCD-Object",t.REQUEST="CMCD-Request",t.SESSION="CMCD-Session",t.STATUS="CMCD-Status"}(Zs||(Zs={}));const ta={[Zs.OBJECT]:["br","d","ot","tb"],[Zs.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Zs.SESSION]:["cid","pr","sf","sid","st","v"],[Zs.STATUS]:["bs","rtp"]};class ea{constructor(t,e){this.value=void 0,this.params=void 0,Array.isArray(t)&&(t=t.map((t=>t instanceof ea?t:new ea(t)))),this.value=t,this.params=e}}class ia{constructor(t){this.description=void 0,this.description=t}}const na="Dict";function ra(t,e,n,r){return new Error(`failed to ${t} "${o=e,Array.isArray(o)?JSON.stringify(o):o instanceof Map?"Map{}":o instanceof Set?"Set{}":"object"==typeof o?JSON.stringify(o):String(o)}" as ${n}`,{cause:r});var o}const sa="Bare Item",aa="Boolean",oa="Byte Sequence",la="Decimal",ca="Integer";const ua=/[\x00-\x1f\x7f]+/,ha="Token",da="Key";function fa(t,e,n){return ra("serialize",t,e,n)}function ga(t){if(!1===ArrayBuffer.isView(t))throw fa(t,oa);return`:${e=t,btoa(String.fromCharCode(...e))}:`;var e}function pa(t){if(function(t){return t<-999999999999999||999999999999999<t}(t))throw fa(t,ca);return t.toString()}function ma(t,e){if(t<0)return-ma(-t,e);const n=Math.pow(10,e);if(Math.abs(t*n%1-.5)<Number.EPSILON){const e=Math.floor(t*n);return(e%2==0?e:e+1)/n}return Math.round(t*n)/n}function va(t){const e=ma(t,3);if(Math.floor(Math.abs(e)).toString().length>12)throw fa(t,la);const n=e.toString();return n.includes(".")?n:`${n}.0`}const ya="String";function ba(t){const e=(symbol=t).description||symbol.toString().slice(7,-1);var symbol;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e))throw fa(e,ha);return e}function Ta(t){switch(typeof t){case"number":if(!S(t))throw fa(t,sa);return Number.isInteger(t)?pa(t):va(t);case"string":return function(t){if(ua.test(t))throw fa(t,ya);return`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(t);case"symbol":return ba(t);case"boolean":return function(t){if("boolean"!=typeof t)throw fa(t,aa);return t?"?1":"?0"}(t);case"object":if(t instanceof Date)return function(t){return`@${pa(t.getTime()/1e3)}`}(t);if(t instanceof Uint8Array)return ga(t);if(t instanceof ia)return ba(t);default:throw fa(t,sa)}}function Ea(t){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(t))throw fa(t,da);return t}function ka(t){return null==t?"":Object.entries(t).map((([t,e])=>!0===e?`;${Ea(t)}`:`;${Ea(t)}=${Ta(e)}`)).join("")}function Sa(t){return t instanceof ea?`${Ta(t.value)}${ka(t.params)}`:Ta(t)}function _a(t,e={whitespace:!0}){if("object"!=typeof t)throw fa(t,na);const n=t instanceof Map?t.entries():Object.entries(t),r=null!=e&&e.whitespace?" ":"";return Array.from(n).map((([t,e])=>{e instanceof ea==!1&&(e=new ea(e));let output=Ea(t);var n;return!0===e.value?output+=ka(e.params):(output+="=",Array.isArray(e.value)?output+=`(${(n=e).value.map(Sa).join(" ")})${ka(n.params)}`:output+=Sa(e)),output})).join(`,${r}`)}const La=t=>"ot"===t||"sf"===t||"st"===t,Ca=t=>"number"==typeof t?S(t):null!=t&&""!==t&&!1!==t;const Aa=t=>Math.round(t),wa=t=>100*Aa(t/100),Oa={br:Aa,d:Aa,bl:wa,dl:wa,mtp:wa,nor:(t,e)=>(null!=e&&e.baseUrl&&(t=function(t,base){const e=new URL(t),n=new URL(base);if(e.origin!==n.origin)return t;const r=e.pathname.split("/").slice(1),o=n.pathname.split("/").slice(1,-1);for(;r[0]===o[0];)r.shift(),o.shift();for(;o.length;)o.shift(),r.unshift("..");return r.join("/")}(t,e.baseUrl)),encodeURIComponent(t)),rtp:wa,tb:Aa};function Ra(t,e={}){return t?function(t,e){return _a(t,e)}(function(t,e){const n={};if(null==t||"object"!=typeof t)return n;const r=Object.keys(t).sort(),o=k({},Oa,null==e?void 0:e.formatters),filter=null==e?void 0:e.filter;return r.forEach((r=>{if(null!=filter&&filter(r))return;let l=t[r];const c=o[r];c&&(l=c(l,e)),"v"===r&&1===l||"pr"==r&&1===l||Ca(l)&&(La(r)&&"string"==typeof l&&(l=new ia(l)),n[r]=l)})),n}(t,e),k({whitespace:!1},e)):""}function Da(t,e,n){return k(t,function(t,e={}){if(!t)return{};const n=Object.entries(t),r=Object.entries(ta).concat(Object.entries((null==e?void 0:e.customHeaderMap)||{})),o=n.reduce(((t,e)=>{var n;const[o,l]=e,c=(null==(n=r.find((t=>t[1].includes(o))))?void 0:n[0])||Zs.REQUEST;return null!=t[c]||(t[c]={}),t[c][o]=l,t}),{});return Object.entries(o).reduce(((t,[n,r])=>(t[n]=Ra(r,e),t)),{})}(e,n))}const Ia="CMCD";const xa=/CMCD=[^&#]+/;function Pa(t,e,n){const r=function(t,e={}){if(!t)return"";const n=Ra(t,e);return`${Ia}=${encodeURIComponent(n)}`}(e,n);if(!r)return t;if(xa.test(t))return t.replace(xa,r);const o=t.includes("?")?"&":"?";return`${t}${o}${r}`}function Ma(t,e,n,r){t&&Object.keys(e).forEach((o=>{const l=t.filter((track=>track.groupId===o)).map((track=>{const t=k({},track);return t.details=void 0,t.attrs=new F(t.attrs),t.url=t.attrs.URI=Fa(track.url,track.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),t.groupId=t.attrs["GROUP-ID"]=e[o],t.attrs["PATHWAY-ID"]=r,t}));t.push(...l)}))}function Fa(t,e,n,r){const{HOST:o,PARAMS:l,[n]:c}=r;let h;e&&(h=null==c?void 0:c[e],h&&(t=h));const d=new self.URL(t);return o&&!h&&(d.host=o),l&&Object.keys(l).sort().forEach((t=>{t&&d.searchParams.set(t,l[t])})),d.href}const Na=/^age:\s*[\d.]+\s*$/im;class ja{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new U,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t||!e)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const o=this.xhrSetup;o?Promise.resolve().then((()=>{if(this.loader===n&&!this.stats.aborted)return o(n,e.url)})).catch((t=>{if(this.loader===n&&!this.stats.aborted)return n.open("GET",e.url,!0),o(n,e.url)})).then((()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,e,t)})).catch((t=>{this.callbacks.onError({code:n.status,text:t.message},e,n,r)})):this.openAndSendXhr(n,e,t)}openAndSendXhr(t,e,n){t.readyState||t.open("GET",e.url,!0);const r=e.headers,{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=n.loadPolicy;if(r)for(const header in r)t.setRequestHeader(header,r[header]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),n.timeout=o&&S(o)?o:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:n}=this;if(!t||!e)return;const r=e.readyState,o=this.config;if(!n.aborted&&r>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),o.timeout!==o.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),o.timeout=o.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===r)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const r=e.status,l="text"!==e.responseType;if(r>=200&&r<300&&(l&&e.response||null!==e.responseText)){n.loading.end=Math.max(self.performance.now(),n.loading.first);const data=l?e.response:e.responseText,o="arraybuffer"===e.responseType?data.byteLength:data.length;if(n.loaded=n.total=o,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first),!this.callbacks)return;const c=this.callbacks.onProgress;if(c&&c(n,t,data,e),!this.callbacks)return;const h={url:e.responseURL,data:data,code:r};this.callbacks.onSuccess(h,n,t,e)}else{const l=o.loadPolicy.errorRetry;_i(l,n.retry,!1,{url:t.url,data:void 0,code:r})?this.retry(l):(x.error(`${r} while loading ${t.url}`),this.callbacks.onError({code:r,text:e.statusText},t,e,n))}}}loadtimeout(){if(!this.config)return;const t=this.config.loadPolicy.timeoutRetry;if(_i(t,this.stats.retry,!0))this.retry(t);else{var e;x.warn(`timeout while loading ${null==(e=this.context)?void 0:e.url}`);const t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:n}=this;this.retryDelay=ki(t,n.retry),n.retry++,x.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==e?void 0:e.url}, retrying ${n.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&Na.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}const Ua=/(\d+)-(\d+)\/(\d+)/;class Ba{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||$a,this.controller=new self.AbortController,this.stats=new U}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const o=function(t,e){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(k({},t.headers))};t.rangeEnd&&n.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1));return n}(t,this.controller.signal),l=n.onProgress,c="arraybuffer"===t.responseType,h=c?"byteLength":"length",{maxTimeToFirstByteMs:d,maxLoadTimeMs:f}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=n,this.request=this.fetchSetup(t,o),self.clearTimeout(this.requestTimeout),e.timeout=d&&S(d)?d:f,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),n.onTimeout(r,t,this.response)}),e.timeout),self.fetch(this.request).then((o=>{this.response=this.loader=o;const h=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=f,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),n.onTimeout(r,t,this.response)}),f-(h-r.loading.start)),!o.ok){const{status:t,statusText:e}=o;throw new Ha(e||"fetch, bad network response",t,o)}return r.loading.first=h,r.total=function(t){const e=t.get("Content-Range");if(e){const t=function(t){const e=Ua.exec(t);if(e)return parseInt(e[2])-parseInt(e[1])+1}(e);if(S(t))return t}const n=t.get("Content-Length");if(n)return parseInt(n)}(o.headers)||r.total,l&&S(e.highWaterMark)?this.loadProgressively(o,r,t,e.highWaterMark,l):c?o.arrayBuffer():"json"===t.responseType?o.json():o.text()})).then((o=>{const c=this.response;if(!c)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const d=o[h];d&&(r.loaded=r.total=d);const f={url:c.url,data:o,code:c.status};l&&!S(e.highWaterMark)&&l(r,t,o,c),n.onSuccess(f,r,t,c)})).catch((e=>{if(self.clearTimeout(this.requestTimeout),r.aborted)return;const code=e&&e.code||0,text=e?e.message:null;n.onError({code:code,text:text},t,e?e.details:null,r)}))}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,n,r=0,o){const l=new Mn,c=t.body.getReader(),h=()=>c.read().then((data=>{if(data.done)return l.dataLength&&o(e,n,l.flush(),t),Promise.resolve(new ArrayBuffer(0));const c=data.value,d=c.length;return e.loaded+=d,d<r||l.dataLength?(l.push(c),l.dataLength>=r&&o(e,n,l.flush(),t)):o(e,n,c,t),h()})).catch((()=>Promise.reject()));return h()}}function $a(t,e){return new self.Request(t.url,e)}class Ha extends Error{constructor(t,code,details){super(t),this.code=void 0,this.details=void 0,this.code=code,this.details=details}}const Ga=/\s/,Ka={newCue(track,t,e,n){const r=[];let o,l,c,h,text;const d=self.VTTCue||self.TextTrackCue;for(let m=0;m<n.rows.length;m++)if(o=n.rows[m],c=!0,h=0,text="",!o.isEmpty()){var f;for(let t=0;t<o.chars.length;t++)Ga.test(o.chars[t].uchar)&&c?h++:(text+=o.chars[t].uchar,c=!1);o.cueStartTime=t,t===e&&(e+=1e-4),h>=16?h--:h++;const n=As(text.trim()),v=Is(t,e,n);null!=track&&null!=(f=track.cues)&&f.getCueById(v)||(l=new d(t,e,n),l.id=v,l.line=m+1,l.align="left",l.position=10+Math.min(80,10*Math.floor(8*h/32)),r.push(l))}return track&&r.length&&(r.sort(((t,e)=>"auto"===t.line||"auto"===e.line?0:t.line>8&&e.line>8?e.line-t.line:t.line-e.line)),r.forEach((t=>Ge(track,t)))),r}},Va=y(y({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:ja,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(t){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:t,partCurrent:e,hls:n}=this,{autoLevelEnabled:r,media:o}=n;if(!t||!o)return;const l=performance.now(),c=e?e.stats:t.stats,h=e?e.duration:t.duration,d=l-c.loading.start,f=n.minAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||t.level<=f)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!r||o.paused||!o.playbackRate||!o.readyState)return;const m=n.mainForwardBufferInfo;if(null===m)return;const v=this.bwEstimator.getEstimateTTFB(),y=Math.abs(o.playbackRate);if(d<=Math.max(v,h/(2*y)*1e3))return;const T=m.len/y,E=c.loading.first?c.loading.first-c.loading.start:-1,k=c.loaded&&E>-1,_=this.getBwEstimate(),L=n.levels,A=L[t.level],w=c.total||Math.max(c.loaded,Math.round(h*A.averageBitrate/8));let O=k?d-E:d;O<1&&k&&(O=Math.min(d,8*c.loaded/_));const R=k?1e3*c.loaded/O:0,D=R?(w-c.loaded)/R:8*w/_+v/1e3;if(D<=T)return;const I=R?8*R:_;let P,M=Number.POSITIVE_INFINITY;for(P=t.level-1;P>f;P--){const t=L[P].maxBitrate;if(M=this.getTimeToLoadFrag(v/1e3,I,h*t,!L[P].details),M<T)break}if(M>=D)return;if(M>10*h)return;n.nextLoadLevel=n.nextAutoLevel=P,k?this.bwEstimator.sample(d-Math.min(v,E),c.loaded):this.bwEstimator.sampleTTFB(d);const F=L[P].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>F&&this.resetEstimator(F),this.clearTimer(),x.warn(`[abr] Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} is loading too slowly;\n      Time to underbuffer: ${T.toFixed(3)} s\n      Estimated load time for current fragment: ${D.toFixed(3)} s\n      Estimated load time for down switch fragment: ${M.toFixed(3)} s\n      TTFB estimate: ${0|E} ms\n      Current BW estimate: ${S(_)?0|_:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${P} @ ${0|F} bps`),n.trigger(C.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:c})},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(t){t&&(x.log(`setting initial bwe to ${t}`),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const t=this.hls.config;return new ji(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)}registerListeners(){const{hls:t}=this;t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.FRAG_LOADING,this.onFragLoading,this),t.on(C.FRAG_LOADED,this.onFragLoaded,this),t.on(C.FRAG_BUFFERED,this.onFragBuffered,this),t.on(C.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(C.LEVEL_LOADED,this.onLevelLoaded,this),t.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(C.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t&&(t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.FRAG_LOADING,this.onFragLoading,this),t.off(C.FRAG_LOADED,this.onFragLoaded,this),t.off(C.FRAG_BUFFERED,this.onFragBuffered,this),t.off(C.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(C.LEVEL_LOADED,this.onLevelLoaded,this),t.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(C.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(C.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(t,data){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(t,data){const e=data.frag;if(!this.ignoreFragment(e)){var n;if(!e.bitrateTest)this.fragCurrent=e,this.partCurrent=null!=(n=data.part)?n:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(t,data){this.clearTimer()}onError(t,data){if(!data.fatal)switch(data.details){case w.BUFFER_ADD_CODEC_ERROR:case w.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case w.FRAG_LOAD_TIMEOUT:{const t=data.frag,{fragCurrent:e,partCurrent:n}=this;if(t&&e&&t.sn===e.sn&&t.level===e.level){const e=performance.now(),r=n?n.stats:t.stats,o=e-r.loading.start,l=r.loading.first?r.loading.first-r.loading.start:-1;if(r.loaded&&l>-1){const t=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(o-Math.min(t,l),r.loaded)}else this.bwEstimator.sampleTTFB(o)}break}}}getTimeToLoadFrag(t,e,n,r){return t+n/e+(r?this.lastLevelLoadSec:0)}onLevelLoaded(t,data){const e=this.hls.config,{loading:n}=data.stats,r=n.end-n.start;S(r)&&(this.lastLevelLoadSec=r/1e3),data.details.live?this.bwEstimator.update(e.abrEwmaSlowLive,e.abrEwmaFastLive):this.bwEstimator.update(e.abrEwmaSlowVoD,e.abrEwmaFastVoD)}onFragLoaded(t,{frag:e,part:n}){const r=n?n.stats:e.stats;if(e.type===Fe&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),e.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const t=n?n.duration:e.duration,o=this.hls.levels[e.level],l=(o.loaded?o.loaded.bytes:0)+r.loaded,c=(o.loaded?o.loaded.duration:0)+t;o.loaded={bytes:l,duration:c},o.realBitrate=Math.round(8*l/c)}if(e.bitrateTest){const t={stats:r,frag:e,part:n,id:e.type};this.onFragBuffered(C.FRAG_BUFFERED,t),e.bitrateTest=!1}else this.lastLoadedFragLevel=e.level}}onFragBuffered(t,data){const{frag:e,part:n}=data,r=null!=n&&n.stats.loaded?n.stats:e.stats;if(r.aborted)return;if(this.ignoreFragment(e))return;const o=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,r.loaded),r.bwEstimate=this.getBwEstimate(),e.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==Fe||"initSegment"===t.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:t,minAutoLevel:e}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,o=this.findBestLevel(n,e,t,0,r,1,1);if(o>-1)return o;const l=this.hls.firstLevel,c=Math.min(Math.max(l,e),t);return x.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const t=this.forcedAutoLevel,e=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(!(-1===t||e&&n&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return t;const r=e&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==t){const e=this.hls.levels;if(e.length>Math.max(t,r)&&e[t].loadError<=e[r].loadError)return t}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:n}=this,{maxAutoLevel:r,config:o,minAutoLevel:l}=n,c=e?e.duration:t?t.duration:0,h=this.getBwEstimate(),d=this.getStarvationDelay();let f=o.abrBandWidthFactor,m=o.abrBandWidthUpFactor;if(d){const t=this.findBestLevel(h,l,r,d,0,f,m);if(t>=0)return t}let v=c?Math.min(c,o.maxStarvationDelay):o.maxStarvationDelay;if(!d){const t=this.bitrateTestDelay;if(t){v=(c?Math.min(c,o.maxLoadingDelay):o.maxLoadingDelay)-t,x.info(`[abr] bitrate test took ${Math.round(1e3*t)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),f=m=1}}const y=this.findBestLevel(h,l,r,d,v,f,m);if(x.info(`[abr] ${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`),y>-1)return y;const T=n.levels[l],E=n.levels[n.loadLevel];return(null==T?void 0:T.bitrate)<(null==E?void 0:E.bitrate)?l:n.loadLevel}getStarvationDelay(){const t=this.hls,e=t.media;if(!e)return 1/0;const n=e&&0!==e.playbackRate?Math.abs(e.playbackRate):1,r=t.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(t,e,n,r,o,l,c){var h;const d=r+o,f=this.lastLoadedFragLevel,m=-1===f?this.hls.firstLevel:f,{fragCurrent:v,partCurrent:y}=this,{levels:T,allAudioTracks:E,loadLevel:k,config:_}=this.hls;if(1===T.length)return 0;const L=T[m],C=!(null==L||null==(h=L.details)||!h.live),A=-1===k||-1===f;let w,O="SDR",R=(null==L?void 0:L.frameRate)||0;const{audioPreference:D,videoPreference:I}=_,P=this.audioTracksByGroup||(this.audioTracksByGroup=function(t){return t.reduce(((t,track)=>{let e=t.groups[track.groupId];e||(e=t.groups[track.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),e.tracks.push(track);const n=track.channels||"2";return e.channels[n]=(e.channels[n]||0)+1,e.hasDefault=e.hasDefault||track.default,e.hasAutoSelect=e.hasAutoSelect||track.autoselect,e.hasDefault&&(t.hasDefaultAudio=!0),e.hasAutoSelect&&(t.hasAutoSelectAudio=!0),t}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}(E));if(A){if(-1!==this.firstSelection)return this.firstSelection;const r=this.codecTiers||(this.codecTiers=function(t,e,n,r){return t.slice(n,r+1).reduce(((t,n)=>{if(!n.codecSet)return t;const r=n.audioGroups;let o=t[n.codecSet];o||(t[n.codecSet]=o={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!r,fragmentError:0}),o.minBitrate=Math.min(o.minBitrate,n.bitrate);const l=Math.min(n.height,n.width);return o.minHeight=Math.min(o.minHeight,l),o.minFramerate=Math.min(o.minFramerate,n.frameRate),o.maxScore=Math.max(o.maxScore,n.score),o.fragmentError+=n.fragmentError,o.videoRanges[n.videoRange]=(o.videoRanges[n.videoRange]||0)+1,r&&r.forEach((t=>{if(!t)return;const n=e.groups[t];n&&(o.hasDefaultAudio=o.hasDefaultAudio||e.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(n.channels).forEach((t=>{o.channels[t]=(o.channels[t]||0)+n.channels[t]})))})),t}),{})}(T,P,e,n)),o=function(t,e,n,r,o){const l=Object.keys(t),c=null==r?void 0:r.channels,h=null==r?void 0:r.audioCodec,d=c&&2===parseInt(c);let f=!0,m=!1,v=1/0,y=1/0,T=1/0,E=0,k=[];const{preferHDR:_,allowedVideoRanges:L}=Gi(e,o);for(let i=l.length;i--;){const e=t[l[i]];f=e.channels[2]>0,v=Math.min(v,e.minHeight),y=Math.min(y,e.minFramerate),T=Math.min(T,e.minBitrate);const n=L.filter((t=>e.videoRanges[t]>0));n.length>0&&(m=!0,k=n)}v=S(v)?v:0,y=S(y)?y:0;const C=Math.max(1080,v),A=Math.max(30,y);return T=S(T)?T:n,n=Math.max(T,n),m||(e=void 0,k=[]),{codecSet:l.reduce(((e,r)=>{const o=t[r];if(r===e)return e;if(o.minBitrate>n)return Ki(r,`min bitrate of ${o.minBitrate} > current estimate of ${n}`),e;if(!o.hasDefaultAudio)return Ki(r,"no renditions with default or auto-select sound found"),e;if(h&&r.indexOf(h.substring(0,4))%5!=0)return Ki(r,`audio codec preference "${h}" not found`),e;if(c&&!d){if(!o.channels[c])return Ki(r,`no renditions with ${c} channel sound found (channels options: ${Object.keys(o.channels)})`),e}else if((!h||d)&&f&&0===o.channels[2])return Ki(r,"no renditions with stereo sound found"),e;return o.minHeight>C?(Ki(r,`min resolution of ${o.minHeight} > maximum of ${C}`),e):o.minFramerate>A?(Ki(r,`min framerate of ${o.minFramerate} > maximum of ${A}`),e):k.some((t=>o.videoRanges[t]>0))?o.maxScore<E?(Ki(r,`max score of ${o.maxScore} < selected max of ${E}`),e):e&&(ge(r)>=ge(e)||o.fragmentError>t[e].fragmentError)?e:(E=o.maxScore,r):(Ki(r,`no variants with VIDEO-RANGE of ${JSON.stringify(k)} found`),e)}),void 0),videoRanges:k,preferHDR:_,minFramerate:y,minBitrate:T}}(r,O,t,D,I),{codecSet:l,videoRanges:c,minFramerate:h,minBitrate:d,preferHDR:f}=o;w=l,O=f?c[c.length-1]:c[0],R=h,t=Math.max(t,d),x.log(`[abr] picked start tier ${JSON.stringify(o)}`)}else w=null==L?void 0:L.codecSet,O=null==L?void 0:L.videoRange;const M=y?y.duration:v?v.duration:0,F=this.bwEstimator.getEstimateTTFB()/1e3,N=[];for(let i=n;i>=e;i--){var j;const e=T[i],h=i>m;if(!e)continue;if(_.useMediaCapabilities&&!e.supportedResult&&!e.supportedPromise){const n=navigator.mediaCapabilities;"function"==typeof(null==n?void 0:n.decodingInfo)&&$i(e,P,O,R,t,D)?(e.supportedPromise=Hi(e,P,n),e.supportedPromise.then((t=>{if(!this.hls)return;e.supportedResult=t;const n=this.hls.levels,r=n.indexOf(e);t.error?x.warn(`[abr] MediaCapabilities decodingInfo error: "${t.error}" for level ${r} ${JSON.stringify(t)}`):t.supported||(x.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${r} ${JSON.stringify(t)}`),r>-1&&n.length>1&&(x.log(`[abr] Removing unsupported level ${r}`),this.hls.removeLevel(r)))}))):e.supportedResult=Ui}if(w&&e.codecSet!==w||O&&e.videoRange!==O||h&&R>e.frameRate||!h&&R>0&&R<e.frameRate||e.supportedResult&&(null==(j=e.supportedResult.decodingInfoResults)||!j[0].smooth)){N.push(i);continue}const v=e.details,E=(y?null==v?void 0:v.partTarget:null==v?void 0:v.averagetargetduration)||M;let I;I=h?c*t:l*t;const U=M&&r>=2*M&&0===o?T[i].averageBitrate:T[i].maxBitrate,B=this.getTimeToLoadFrag(F,I,U*E,void 0===v);if(I>=U&&(i===f||0===e.loadError&&0===e.fragmentError)&&(B<=F||!S(B)||C&&!this.bitrateTestDelay||B<d)){const t=this.forcedAutoLevel;return i===k||-1!==t&&t===k||(N.length&&x.trace(`[abr] Skipped level(s) ${N.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${T[N[0]].codecs}" ${T[N[0]].videoRange}; not compatible with "${L.codecs}" ${O}`),x.info(`[abr] switch candidate:${m}->${i} adjustedbw(${Math.round(I)})-bitrate=${Math.round(I-U)} ttfb:${F.toFixed(1)} avgDuration:${E.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${B.toFixed(1)} firstSelection:${A} codecSet:${w} videoRange:${O} hls.loadLevel:${k}`)),A&&(this.firstSelection=i),i}}return-1}set nextAutoLevel(t){const{maxAutoLevel:e,minAutoLevel:n}=this.hls,r=Math.min(Math.max(t,n),e);this._nextAutoLevel!==r&&(this.nextAutoLevelKey="",this._nextAutoLevel=r)}},bufferController:class{constructor(t){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=t=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=t=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:t,mediaSource:e}=this;this.log("Media source opened"),t&&(t.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(C.MEDIA_ATTACHED,{media:t,mediaSource:e})),e&&e.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:t,_objectUrl:e}=this;t!==e&&x.error(`Media element src was set while attaching MediaSource (${e} > ${t})`)},this.hls=t;const e="[buffer-controller]";var source;this.appendSource=(source=le(t.config.preferManagedMediaSource),"undefined"!=typeof self&&source===self.ManagedMediaSource),this.log=x.log.bind(x,e),this.warn=x.warn.bind(x,e),this.error=x.error.bind(x,e),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:t}=this;t.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.MANIFEST_PARSED,this.onManifestParsed,this),t.on(C.BUFFER_RESET,this.onBufferReset,this),t.on(C.BUFFER_APPENDING,this.onBufferAppending,this),t.on(C.BUFFER_CODECS,this.onBufferCodecs,this),t.on(C.BUFFER_EOS,this.onBufferEos,this),t.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(C.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(C.FRAG_PARSED,this.onFragParsed,this),t.on(C.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:t}=this;t.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.MANIFEST_PARSED,this.onManifestParsed,this),t.off(C.BUFFER_RESET,this.onBufferReset,this),t.off(C.BUFFER_APPENDING,this.onBufferAppending,this),t.off(C.BUFFER_CODECS,this.onBufferCodecs,this),t.off(C.BUFFER_EOS,this.onBufferEos,this),t.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(C.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(C.FRAG_PARSED,this.onFragParsed,this),t.off(C.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new Xr(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,data){let e=2;(data.audio&&!data.video||!data.altAudio)&&(e=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(t,data){const e=this.media=data.media,n=le(this.appendSource);if(e&&n){var r;const t=this.mediaSource=new n;this.log(`created media source: ${null==(r=t.constructor)?void 0:r.name}`),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming));const o=this._objectUrl=self.URL.createObjectURL(t);if(this.appendSource)try{e.removeAttribute("src");const n=self.ManagedMediaSource;e.disableRemotePlayback=e.disableRemotePlayback||n&&t instanceof n,Jr(e),function(t,e){const source=self.document.createElement("source");source.type="video/mp4",source.src=e,t.appendChild(source)}(e,o),e.load()}catch(t){e.src=o}else e.src=o;e.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:t,mediaSource:e,_objectUrl:n}=this;if(e){if(this.log("media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(t){this.warn(`onMediaDetaching: ${t.message} while calling endOfStream`)}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.removeEventListener("startstreaming",this._onStartStreaming),e.removeEventListener("endstreaming",this._onEndStreaming)),t&&(t.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),this.mediaSrc===n?(t.removeAttribute("src"),this.appendSource&&Jr(t),t.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(C.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach((t=>{this.resetBuffer(t)})),this._initSourceBuffer()}resetBuffer(t){const e=this.sourceBuffer[t];try{var n;if(e)this.removeBufferListeners(t),this.sourceBuffer[t]=void 0,null!=(n=this.mediaSource)&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(e)}catch(e){this.warn(`onBufferReset ${t}`,e)}}onBufferCodecs(t,data){const e=this.getSourceBufferTypes().length,n=Object.keys(data);if(n.forEach((t=>{if(e){const track=this.tracks[t];if(track&&"function"==typeof track.buffer.changeType){var n;const{id:e,codec:r,levelCodec:o,container:l,metadata:c}=data[t],h=ye(track.codec,track.levelCodec),d=null==h?void 0:h.replace(Qr,"$1");let f=ye(r,o);const m=null==(n=f)?void 0:n.replace(Qr,"$1");if(f&&d!==m){"audio"===t.slice(0,5)&&(f=ve(f,this.appendSource));const n=`${l};codecs=${f}`;this.appendChangeType(t,n),this.log(`switching codec ${h} to ${f}`),this.tracks[t]={buffer:track.buffer,codec:r,container:l,levelCodec:o,metadata:c,id:e}}}}else this.pendingTracks[t]=data[t]})),e)return;const r=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==r&&(this.log(`${r} bufferCodec event(s) expected ${n.join(",")}`),this.bufferCodecEventsExpected=r),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}appendChangeType(t,e){const{operationQueue:n}=this,r={execute:()=>{const r=this.sourceBuffer[t];r&&(this.log(`changing ${t} sourceBuffer type to ${e}`),r.changeType(e)),n.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn(`Failed to change ${t} SourceBuffer type`,e)}};n.append(r,t,!!this.pendingTracks[t])}onBufferAppending(t,e){const{hls:n,operationQueue:r,tracks:o}=this,{data:data,type:l,frag:c,part:h,chunkMeta:d}=e,f=d.buffering[l],m=self.performance.now();f.start=m;const v=c.stats.buffering,y=h?h.stats.buffering:null;0===v.start&&(v.start=m),y&&0===y.start&&(y.start=m);const T=o.audio;let E=!1;"audio"===l&&"audio/mpeg"===(null==T?void 0:T.container)&&(E=!this.lastMpegAudioChunk||1===d.id||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const k=c.start,S={execute:()=>{if(f.executeStart=self.performance.now(),E){const t=this.sourceBuffer[l];if(t){const e=k-t.timestampOffset;Math.abs(e)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${k} (delta: ${e}) sn: ${c.sn})`),t.timestampOffset=k)}}this.appendExecutor(data,l)},onStart:()=>{},onComplete:()=>{const t=self.performance.now();f.executeEnd=f.end=t,0===v.first&&(v.first=t),y&&0===y.first&&(y.first=t);const{sourceBuffer:e}=this,n={};for(const t in e)n[t]=sn.getBuffered(e[t]);this.appendErrors[l]=0,"audio"===l||"video"===l?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(C.BUFFER_APPENDED,{type:l,frag:c,part:h,chunkMeta:d,parent:c.type,timeRanges:n})},onError:t=>{const e={type:A.MEDIA_ERROR,parent:c.type,details:w.BUFFER_APPEND_ERROR,sourceBufferName:l,frag:c,part:h,chunkMeta:d,error:t,err:t,fatal:!1};if(t.code===DOMException.QUOTA_EXCEEDED_ERR)e.details=w.BUFFER_FULL_ERROR;else{const t=++this.appendErrors[l];e.details=w.BUFFER_APPEND_ERROR,this.warn(`Failed ${t}/${n.config.appendErrorMaxRetry} times to append segment in "${l}" sourceBuffer`),t>=n.config.appendErrorMaxRetry&&(e.fatal=!0)}n.trigger(C.ERROR,e)}};r.append(S,l,!!this.pendingTracks[l])}onBufferFlushing(t,data){const{operationQueue:e}=this,n=t=>({execute:this.removeExecutor.bind(this,t,data.startOffset,data.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(C.BUFFER_FLUSHED,{type:t})},onError:e=>{this.warn(`Failed to remove from ${t} SourceBuffer`,e)}});data.type?e.append(n(data.type),data.type):this.getSourceBufferTypes().forEach((t=>{e.append(n(t),t)}))}onFragParsed(t,data){const{frag:e,part:n}=data,r=[],o=n?n.elementaryStreams:e.elementaryStreams;o[H]?r.push("audiovideo"):(o[B]&&r.push("audio"),o[$]&&r.push("video"));0===r.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${e.type} level: ${e.level} sn: ${e.sn}`),this.blockBuffers((()=>{const t=self.performance.now();e.stats.buffering.end=t,n&&(n.stats.buffering.end=t);const r=n?n.stats:e.stats;this.hls.trigger(C.FRAG_BUFFERED,{frag:e,part:n,stats:r,id:e.type})}),r)}onFragChanged(t,data){this.trimBuffers()}onBufferEos(t,data){this.getSourceBufferTypes().reduce(((t,e)=>{const n=this.sourceBuffer[e];return!n||data.type&&data.type!==e||(n.ending=!0,n.ended||(n.ended=!0,this.log(`${e} sourceBuffer now EOS`))),t&&!(n&&!n.ended)}),!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers((()=>{this.getSourceBufferTypes().forEach((t=>{const e=this.sourceBuffer[t];e&&(e.ending=!1)}));const{mediaSource:t}=this;t&&"open"===t.readyState?(this.log("Calling mediaSource.endOfStream()"),t.endOfStream()):t&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${t.readyState}`)})))}onLevelUpdated(t,{details:details}){details.fragments.length&&(this.details=details,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:t,details:details,media:e}=this;if(!e||null===details)return;if(!this.getSourceBufferTypes().length)return;const n=t.config,r=e.currentTime,o=details.levelTargetDuration,l=details.live&&null!==n.liveBackBufferLength?n.liveBackBufferLength:n.backBufferLength;if(S(l)&&l>0){const t=Math.max(l,o),e=Math.floor(r/o)*o-t;this.flushBackBuffer(r,o,e)}if(S(n.frontBufferFlushThreshold)&&n.frontBufferFlushThreshold>0){const t=Math.max(n.maxBufferLength,n.frontBufferFlushThreshold),e=Math.max(t,o),l=Math.floor(r/o)*o+e;this.flushFrontBuffer(r,o,l)}}flushBackBuffer(t,e,n){const{details:details,sourceBuffer:r}=this;this.getSourceBufferTypes().forEach((o=>{const l=r[o];if(l){const r=sn.getBuffered(l);if(r.length>0&&n>r.start(0)){if(this.hls.trigger(C.BACK_BUFFER_REACHED,{bufferEnd:n}),null!=details&&details.live)this.hls.trigger(C.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(l.ended&&r.end(r.length-1)-t<2*e)return void this.log(`Cannot flush ${o} back buffer while SourceBuffer is in ended state`);this.hls.trigger(C.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:o})}}}))}flushFrontBuffer(t,e,n){const{sourceBuffer:r}=this;this.getSourceBufferTypes().forEach((o=>{const l=r[o];if(l){const r=sn.getBuffered(l),c=r.length;if(c<2)return;const h=r.start(c-1),d=r.end(c-1);if(n>h||t>=h&&t<=d)return;if(l.ended&&t-d<2*e)return void this.log(`Cannot flush ${o} front buffer while SourceBuffer is in ended state`);this.hls.trigger(C.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:o})}}))}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:details,hls:t,media:e,mediaSource:n}=this,r=details.fragments[0].start+details.totalduration,o=e.duration,l=S(n.duration)?n.duration:0;details.live&&t.config.liveDurationInfinity?(n.duration=1/0,this.updateSeekableRange(details)):(r>l&&r>o||!S(o))&&(this.log(`Updating Media Source duration to ${r.toFixed(3)}`),n.duration=r)}updateSeekableRange(t){const e=this.mediaSource,n=t.fragments;if(n.length&&t.live&&null!=e&&e.setLiveSeekableRange){const r=Math.max(0,n[0].start),o=Math.max(r,r+t.totalduration);this.log(`Media Source duration is set to ${e.duration}. Setting seekable range to ${r}-${o}.`),e.setLiveSeekableRange(r,o)}}checkPendingTracks(){const{bufferCodecEventsExpected:t,operationQueue:e,pendingTracks:n}=this,r=Object.keys(n).length;if(r&&(!t||2===r||"audiovideo"in n)){this.createSourceBuffers(n),this.pendingTracks={};const t=this.getSourceBufferTypes();if(t.length)this.hls.trigger(C.BUFFER_CREATED,{tracks:this.tracks}),t.forEach((t=>{e.executeNext(t)}));else{const t=new Error("could not create source buffer for media codec(s)");this.hls.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:t,reason:t.message})}}}createSourceBuffers(t){const{sourceBuffer:e,mediaSource:n}=this;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(const o in t)if(!e[o]){var r;const track=t[o];if(!track)throw Error(`source buffer exists for track ${o}, however track does not`);let l=-1===(null==(r=track.levelCodec)?void 0:r.indexOf(","))?track.levelCodec:track.codec;l&&"audio"===o.slice(0,5)&&(l=ve(l,this.appendSource));const c=`${track.container};codecs=${l}`;this.log(`creating sourceBuffer(${c})`);try{const t=e[o]=n.addSourceBuffer(c),r=o;this.addBufferListener(r,"updatestart",this._onSBUpdateStart),this.addBufferListener(r,"updateend",this._onSBUpdateEnd),this.addBufferListener(r,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(r,"bufferedchange",((t,e)=>{const n=e.removedRanges;null!=n&&n.length&&this.hls.trigger(C.BUFFER_FLUSHED,{type:o})})),this.tracks[o]={buffer:t,codec:l,container:track.container,levelCodec:track.levelCodec,metadata:track.metadata,id:track.id}}catch(t){this.error(`error while trying to add sourceBuffer: ${t.message}`),this.hls.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,sourceBufferName:o,mimeType:c})}}}get mediaSrc(){var t,e;const n=(null==(t=this.media)||null==(e=t.querySelector)?void 0:e.call(t,"source"))||this.media;return null==n?void 0:n.src}_onSBUpdateStart(t){const{operationQueue:e}=this;e.current(t).onStart()}_onSBUpdateEnd(t){var e;if("closed"===(null==(e=this.mediaSource)?void 0:e.readyState))return void this.resetBuffer(t);const{operationQueue:n}=this;n.current(t).onComplete(),n.shiftAndExecuteNext(t)}_onSBUpdateError(t,e){var n;const r=new Error(`${t} SourceBuffer error. MediaSource readyState: ${null==(n=this.mediaSource)?void 0:n.readyState}`);this.error(`${r}`,e),this.hls.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:r,fatal:!1});const o=this.operationQueue.current(t);o&&o.onError(r)}removeExecutor(t,e,n){const{media:r,mediaSource:o,operationQueue:l,sourceBuffer:c}=this,h=c[t];if(!r||!o||!h)return this.warn(`Attempting to remove from the ${t} SourceBuffer, but it does not exist`),void l.shiftAndExecuteNext(t);const d=S(r.duration)?r.duration:1/0,f=S(o.duration)?o.duration:1/0,m=Math.max(0,e),v=Math.min(n,d,f);v>m&&(!h.ending||h.ended)?(h.ended=!1,this.log(`Removing [${m},${v}] from the ${t} SourceBuffer`),h.remove(m,v)):l.shiftAndExecuteNext(t)}appendExecutor(data,t){const e=this.sourceBuffer[t];if(e)e.ended=!1,e.appendBuffer(data);else if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`)}blockBuffers(t,e=this.getSourceBufferTypes()){if(!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(t);const{operationQueue:n}=this,r=e.map((t=>n.appendBlocker(t)));Promise.all(r).then((()=>{t(),e.forEach((t=>{const e=this.sourceBuffer[t];null!=e&&e.updating||n.shiftAndExecuteNext(t)}))}))}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(t,e,n){const r=this.sourceBuffer[t];if(!r)return;const o=n.bind(this,t);this.listeners[t].push({event:e,listener:o}),r.addEventListener(e,o)}removeBufferListeners(t){const e=this.sourceBuffer[t];e&&this.listeners[t].forEach((t=>{e.removeEventListener(t.event,t.listener)}))}},capLevelController:Ys,errorController:class{constructor(t){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=x.log.bind(x,"[info]:"),this.warn=x.warn.bind(x,"[warning]:"),this.error=x.error.bind(x,"[error]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(C.ERROR,this.onError,this),t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;t&&(t.off(C.ERROR,this.onError,this),t.off(C.ERROR,this.onErrorOut,this),t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(t){}stopLoad(){this.playlistError=0}getVariantLevelIndex(t){return(null==t?void 0:t.type)===Fe?t.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(t,data){var e,n;if(data.fatal)return;const r=this.hls,o=data.context;switch(data.details){case w.FRAG_LOAD_ERROR:case w.FRAG_LOAD_TIMEOUT:case w.KEY_LOAD_ERROR:case w.KEY_LOAD_TIMEOUT:return void(data.errorAction=this.getFragRetryOrSwitchAction(data));case w.FRAG_PARSING_ERROR:if(null!=(e=data.frag)&&e.gap)return void(data.errorAction={action:Oi,flags:xi});case w.FRAG_GAP:case w.FRAG_DECRYPT_ERROR:return data.errorAction=this.getFragRetryOrSwitchAction(data),void(data.errorAction.action=Ri);case w.LEVEL_EMPTY_ERROR:case w.LEVEL_PARSING_ERROR:{var l,c;const t=data.parent===Fe?data.level:r.loadLevel;data.details===w.LEVEL_EMPTY_ERROR&&null!=(l=data.context)&&null!=(c=l.levelDetails)&&c.live?data.errorAction=this.getPlaylistRetryOrSwitchAction(data,t):(data.levelRetry=!1,data.errorAction=this.getLevelSwitchAction(data,t))}return;case w.LEVEL_LOAD_ERROR:case w.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==o?void 0:o.level)&&(data.errorAction=this.getPlaylistRetryOrSwitchAction(data,o.level)));case w.AUDIO_TRACK_LOAD_ERROR:case w.AUDIO_TRACK_LOAD_TIMEOUT:case w.SUBTITLE_LOAD_ERROR:case w.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){const t=r.levels[r.loadLevel];if(t&&(o.type===Pe&&t.hasAudioGroup(o.groupId)||o.type===Me&&t.hasSubtitleGroup(o.groupId)))return data.errorAction=this.getPlaylistRetryOrSwitchAction(data,r.loadLevel),data.errorAction.action=Ri,void(data.errorAction.flags=Pi)}return;case w.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const t=r.levels[r.loadLevel],e=null==t?void 0:t.attrs["HDCP-LEVEL"];e?data.errorAction={action:Ri,flags:Mi,hdcpLevel:e}:this.keySystemError(data)}return;case w.BUFFER_ADD_CODEC_ERROR:case w.REMUX_ALLOC_ERROR:case w.BUFFER_APPEND_ERROR:return void(data.errorAction=this.getLevelSwitchAction(data,null!=(n=data.level)?n:r.loadLevel));case w.INTERNAL_EXCEPTION:case w.BUFFER_APPENDING_ERROR:case w.BUFFER_FULL_ERROR:case w.LEVEL_SWITCH_ERROR:case w.BUFFER_STALLED_ERROR:case w.BUFFER_SEEK_OVER_HOLE:case w.BUFFER_NUDGE_ON_STALL:return void(data.errorAction={action:Oi,flags:xi})}data.type===A.KEY_SYSTEM_ERROR&&this.keySystemError(data)}keySystemError(data){const t=this.getVariantLevelIndex(data.frag);data.levelRetry=!1,data.errorAction=this.getLevelSwitchAction(data,t)}getPlaylistRetryOrSwitchAction(data,t){const e=Ei(this.hls.config.playlistLoadPolicy,data),n=this.playlistError++;if(_i(e,n,Ti(data),data.response))return{action:Ii,flags:xi,retryConfig:e,retryCount:n};const r=this.getLevelSwitchAction(data,t);return e&&(r.retryConfig=e,r.retryCount=n),r}getFragRetryOrSwitchAction(data){const t=this.hls,e=this.getVariantLevelIndex(data.frag),n=t.levels[e],{fragLoadPolicy:r,keyLoadPolicy:o}=t.config,l=Ei(data.details.startsWith("key")?o:r,data),c=t.levels.reduce(((t,e)=>t+e.fragmentError),0);if(n){data.details!==w.FRAG_GAP&&n.fragmentError++;if(_i(l,c,Ti(data),data.response))return{action:Ii,flags:xi,retryConfig:l,retryCount:c}}const h=this.getLevelSwitchAction(data,e);return l&&(h.retryConfig=l,h.retryCount=c),h}getLevelSwitchAction(data,t){const e=this.hls;null==t&&(t=e.loadLevel);const n=this.hls.levels[t];if(n){var r,o;const t=data.details;n.loadError++,t===w.BUFFER_APPEND_ERROR&&n.fragmentError++;let h=-1;const{levels:d,loadLevel:f,minAutoLevel:m,maxAutoLevel:v}=e;e.autoLevelEnabled||(e.loadLevel=-1);const y=null==(r=data.frag)?void 0:r.type,T=(y===Ne&&t===w.FRAG_PARSING_ERROR||"audio"===data.sourceBufferName&&(t===w.BUFFER_ADD_CODEC_ERROR||t===w.BUFFER_APPEND_ERROR))&&d.some((({audioCodec:t})=>n.audioCodec!==t)),E="video"===data.sourceBufferName&&(t===w.BUFFER_ADD_CODEC_ERROR||t===w.BUFFER_APPEND_ERROR)&&d.some((({codecSet:t,audioCodec:e})=>n.codecSet!==t&&n.audioCodec===e)),{type:k,groupId:S}=null!=(o=data.context)?o:{};for(let i=d.length;i--;){const e=(i+f)%d.length;if(e!==f&&e>=m&&e<=v&&0===d[e].loadError){var l,c;const r=d[e];if(t===w.FRAG_GAP&&y===Fe&&data.frag){const t=d[e].details;if(t){const e=Ci(data.frag,t.fragments,data.frag.start);if(null!=e&&e.gap)continue}}else{if(k===Pe&&r.hasAudioGroup(S)||k===Me&&r.hasSubtitleGroup(S))continue;if(y===Ne&&null!=(l=n.audioGroups)&&l.some((t=>r.hasAudioGroup(t)))||y===je&&null!=(c=n.subtitleGroups)&&c.some((t=>r.hasSubtitleGroup(t)))||T&&n.audioCodec===r.audioCodec||!T&&n.audioCodec!==r.audioCodec||E&&n.codecSet===r.codecSet)continue}h=e;break}}if(h>-1&&e.loadLevel!==h)return data.levelRetry=!0,this.playlistError=0,{action:Ri,flags:xi,nextAutoLevel:h}}return{action:Ri,flags:Pi}}onErrorOut(t,data){var e;switch(null==(e=data.errorAction)?void 0:e.action){case Oi:break;case Ri:this.sendAlternateToPenaltyBox(data),data.errorAction.resolved||data.details===w.FRAG_GAP?/MediaSource readyState: ended/.test(data.error.message)&&(this.warn(`MediaSource ended after "${data.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):data.fatal=!0}data.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(data){const t=this.hls,e=data.errorAction;if(!e)return;const{flags:n,hdcpLevel:r,nextAutoLevel:o}=e;switch(n){case xi:this.switchLevel(data,o);break;case Mi:r&&(t.maxHdcpLevel=ii[ii.indexOf(r)-1],e.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}e.resolved||this.switchLevel(data,o)}switchLevel(data,t){void 0!==t&&data.errorAction&&(this.warn(`switching to level ${t} after ${data.details}`),this.hls.nextAutoLevel=t,data.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}},fpsController:class{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,data){const e=this.hls.config;if(e.capLevelOnFPSDrop){const t=data.media instanceof self.HTMLVideoElement?data.media:null;this.media=t,t&&"function"==typeof t.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod)}}checkFPS(video,t,e){const n=performance.now();if(t){if(this.lastTime){const r=n-this.lastTime,o=e-this.lastDroppedFrames,l=t-this.lastDecodedFrames,c=1e3*o/r,h=this.hls;if(h.trigger(C.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:e}),c>0&&o>h.config.fpsDroppedMonitoringThreshold*l){let t=h.currentLevel;x.warn("drop FPS ratio greater than max allowed value for currentLevel: "+t),t>0&&(-1===h.autoLevelCapping||h.autoLevelCapping>=t)&&(t-=1,h.trigger(C.FPS_DROP_LEVEL_CAPPING,{level:t,droppedLevel:h.currentLevel}),h.autoLevelCapping=t,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=e,this.lastDecodedFrames=t}}checkFPSInterval(){const video=this.media;if(video)if(this.isVideoPlaybackQualityAvailable){const t=video.getVideoPlaybackQuality();this.checkFPS(video,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(video,video.webkitDecodedFrameCount,video.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:lt,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Ka,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends Pn{constructor(t,e,n){super(t,e,n,"[subtitle-stream-controller]",je),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:t}=this;t.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.LEVEL_LOADED,this.onLevelLoaded,this),t.on(C.ERROR,this.onError,this),t.on(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(C.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(C.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(C.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.LEVEL_LOADED,this.onLevelLoaded,this),t.off(C.ERROR,this.onError,this),t.off(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(C.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(C.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(C.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(t){this.stopLoad(),this.state=Sn,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(t,data){this.mainDetails=data.details}onSubtitleFragProcessed(t,data){const{frag:e,success:n}=data;if(this.fragPrevious=e,this.state=Sn,!n)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let o;const l=e.start;for(let i=0;i<r.length;i++)if(l>=r[i].start&&l<=r[i].end){o=r[i];break}const c=e.start+e.duration;o?o.end=c:(o={start:l,end:c},r.push(o)),this.fragmentTracker.fragBuffered(e),this.fragBufferedComplete(e,null)}onBufferFlushing(t,data){const{startOffset:e,endOffset:n}=data;if(0===e&&n!==Number.POSITIVE_INFINITY){const t=n-1;if(t<=0)return;data.endOffsetSubtitles=Math.max(0,t),this.tracksBuffered.forEach((e=>{for(let i=0;i<e.length;)if(e[i].end<=t)e.shift();else{if(!(e[i].start<t))break;e[i].start=t,i++}})),this.fragmentTracker.removeFragmentsInRange(e,t,je)}}onFragBuffered(t,data){var e;this.loadedmetadata||data.frag.type!==Fe||null!=(e=this.media)&&e.buffered.length&&(this.loadedmetadata=!0)}onError(t,data){const e=data.frag;(null==e?void 0:e.type)===je&&(data.details===w.FRAG_GAP&&this.fragmentTracker.fragBuffered(e,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==kn&&(this.state=Sn))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){this.levels&&Wr(this.levels,e)?this.levels=e.map((t=>new ui(t))):(this.tracksBuffered=[],this.levels=e.map((t=>{const e=new ui(t);return this.tracksBuffered[e.id]=[],e})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,je),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(t,data){var e;if(this.currentTrackId=data.id,null==(e=this.levels)||!e.length||-1===this.currentTrackId)return void this.clearInterval();const n=this.levels[this.currentTrackId];null!=n&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(500)}onSubtitleTrackLoaded(t,data){var e;const{currentTrackId:n,levels:r}=this,{details:o,id:l}=data;if(!r)return void this.warn(`Subtitle tracks were reset while loading level ${l}`);const track=r[l];if(l>=r.length||!track)return;this.log(`Subtitle track ${l} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||null!=(e=track.details)&&e.live){const t=this.mainDetails;if(o.deltaUpdateFailed||!t)return;const e=t.fragments[0];var h;if(track.details)c=this.alignPlaylists(o,track.details,null==(h=this.levelLastLoaded)?void 0:h.details),0===c&&e&&(c=e.start,mi(o,c));else o.hasProgramDateTime&&t.hasProgramDateTime?(hn(o,t),c=o.fragments[0].start):e&&(c=e.start,mi(o,c))}if(track.details=o,this.levelLastLoaded=track,l===n&&(this.startFragRequested||!this.mainDetails&&o.live||this.setStartPosition(this.mainDetails||o,c),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===Sn)){Ci(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),track.details=void 0)}}_handleFragmentLoadComplete(t){const{frag:e,payload:n}=t,r=e.decryptdata,o=this.hls;if(!this.fragContextChanged(e)&&n&&n.byteLength>0&&null!=r&&r.key&&r.iv&&"AES-128"===r.method){const t=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer).catch((t=>{throw o.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((n=>{const r=performance.now();o.trigger(C.FRAG_DECRYPTED,{frag:e,payload:n,stats:{tstart:t,tdecrypt:r}})})).catch((t=>{this.warn(`${t.name}: ${t.message}`),this.state=Sn}))}}doTick(){if(this.media){if(this.state===Sn){const{currentTrackId:t,levels:e}=this,track=null==e?void 0:e[t];if(!track||!e.length||!track.details)return;const{config:n}=this,r=this.getLoadPosition(),o=sn.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,n.maxBufferHole),{end:l,len:c}=o,h=this.getFwdBufferInfo(this.media,Fe),d=track.details;if(c>this.getMaxBufferLength(null==h?void 0:h.len)+d.levelTargetDuration)return;const f=d.fragments,m=f.length,v=d.edge;let y=null;const T=this.fragPrevious;if(l<v){const t=n.maxFragLookUpTolerance,e=l>v-t?0:t;y=Ci(T,f,Math.max(f[0].start,l),e),!y&&T&&T.start<f[0].start&&(y=f[0])}else y=f[m-1];if(!y)return;if(y=this.mapToInitFragWhenRequired(y),"initSegment"!==y.sn){const t=f[y.sn-d.startSN-1];t&&t.cc===y.cc&&this.fragmentTracker.getState(t)===Xi&&(y=t)}this.fragmentTracker.getState(y)===Xi&&this.loadFragment(y,track,l)}}else this.state=Sn}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.max(e,t):e}loadFragment(t,e,n){this.fragCurrent=t,"initSegment"===t.sn?this._loadInitSegment(t,e):(this.startFragRequested=!0,super.loadFragment(t,e,n))}get mediaBufferTimeRanges(){return new zr(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends Fi{constructor(t){super(t,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const e=We(this.media.textTracks);for(let i=0;i<e.length;i++)if("hidden"===e[i].mode)t=e[i];else if("showing"===e[i].mode){t=e[i];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:t}=this;t.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.MANIFEST_PARSED,this.onManifestParsed,this),t.on(C.LEVEL_LOADING,this.onLevelLoading,this),t.on(C.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.MANIFEST_PARSED,this.onManifestParsed,this),t.off(C.LEVEL_LOADING,this.onLevelLoading,this),t.off(C.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(C.ERROR,this.onError,this)}onMediaAttached(t,data){this.media=data.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);We(this.media.textTracks).forEach((track=>{Ke(track)})),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,data){this.tracks=data.subtitleTracks}onSubtitleTrackLoaded(t,data){const{id:e,groupId:n,details:details}=data,r=this.tracksInGroup[e];if(!r||r.groupId!==n)return void this.warn(`Subtitle track with id:${e} and group:${n} not found in active group ${null==r?void 0:r.groupId}`);const o=r.details;r.details=data.details,this.log(`Subtitle track ${e} "${r.name}" lang:${r.lang} group:${n} loaded [${details.startSN}-${details.endSN}]`),e===this.trackId&&this.playlistLoaded(e,data,o)}onLevelLoading(t,data){this.switchLevel(data.level)}onLevelSwitching(t,data){this.switchLevel(data.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const n=e.subtitleGroups||null,r=this.groupIds;let o=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some((t=>-1===(null==r?void 0:r.indexOf(t))))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const t=this.tracks.filter((track=>!n||-1!==n.indexOf(track.groupId)));if(t.length)this.selectDefaultTrack&&!t.some((track=>track.default))&&(this.selectDefaultTrack=!1),t.forEach(((track,i)=>{track.id=i}));else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=t;const e=this.hls.config.subtitlePreference;if(!o&&e){this.selectDefaultTrack=!1;const n=Vi(e,t);if(n>-1)o=t[n];else{const t=Vi(e,this.tracks);o=this.tracks[t]}}let r=this.findTrackId(o);-1===r&&o&&(r=this.findTrackId(null));const l={subtitleTracks:t};this.log(`Updating subtitle tracks, ${t.length} track(s) found in "${null==n?void 0:n.join(",")}" group-id`),this.hls.trigger(C.SUBTITLE_TRACKS_UPDATED,l),-1!==r&&-1===this.trackId&&this.setSubtitleTrack(r)}else this.shouldReloadPlaylist(o)&&this.setSubtitleTrack(this.trackId)}findTrackId(t){const e=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<e.length;i++){const track=e[i];if((!n||track.default)&&(n||t)&&(!t||Wi(track,t)))return i}if(t){for(let i=0;i<e.length;i++){const track=e[i];if(Yr(t.attrs,track.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<e.length;i++){const track=e[i];if(Yr(t.attrs,track.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(t){if(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){if(qr(e[i],t))return i}}return-1}onError(t,data){!data.fatal&&data.context&&(data.context.type!==Me||data.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(data.context.groupId)||this.checkRetry(data))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}setSubtitleOption(t){if(this.hls.config.subtitlePreference=t,t){const e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){const n=this.currentTrack;if(n&&Wi(t,n))return n;const r=Vi(t,this.tracksInGroup);if(r>-1){const track=this.tracksInGroup[r];return this.setSubtitleTrack(r),track}if(n)return null;{const n=Vi(t,e);if(n>-1)return e[n]}}}return null}loadPlaylist(t){super.loadPlaylist();const e=this.currentTrack;if(this.shouldLoadPlaylist(e)&&e){const n=e.id,r=e.groupId;let o=e.url;if(t)try{o=t.addDirectives(o)}catch(t){this.warn(`Could not construct new URL with HLS Delivery Directives: ${t}`)}this.log(`Loading subtitle playlist for id ${n}`),this.hls.trigger(C.SUBTITLE_TRACK_LOADING,{url:o,id:n,groupId:r,deliveryDirectives:t||null})}}toggleTrackModes(){const{media:t}=this;if(!t)return;const e=We(t.textTracks),n=this.currentTrack;let r;if(n&&(r=e.filter((t=>qr(n,t)))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(e).forEach((track=>{"disabled"!==track.mode&&track!==r&&(track.mode="disabled")})),r){const t=this.subtitleDisplay?"showing":"hidden";r.mode!==t&&(r.mode=t)}}setSubtitleTrack(t){const e=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=t);if(t<-1||t>=e.length||!S(t))return void this.warn(`Invalid subtitle track id: ${t}`);this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,track=e[t]||null;if(this.trackId=t,this.currentTrack=track,this.toggleTrackModes(),!track)return void this.hls.trigger(C.SUBTITLE_TRACK_SWITCH,{id:t});const r=!!track.details&&!track.details.live;if(t===this.trackId&&track===n&&r)return;this.log(`Switching to subtitle-track ${t}`+(track?` "${track.name}" lang:${track.lang} group:${track.groupId}`:""));const{id:o,groupId:l="",name:c,type:h,url:d}=track;this.hls.trigger(C.SUBTITLE_TRACK_SWITCH,{id:o,groupId:l,name:c,type:h,url:d});const f=this.switchParams(track.url,null==n?void 0:n.details,track.details);this.loadPlaylist(f)}},timelineController:class{constructor(t){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(C.FRAG_LOADING,this.onFragLoading,this),t.on(C.FRAG_LOADED,this.onFragLoaded,this),t.on(C.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(C.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(C.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(C.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(C.FRAG_LOADING,this.onFragLoading,this),t.off(C.FRAG_LOADED,this.onFragLoaded,this),t.off(C.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(C.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(C.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(C.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const t=new ys(this,"textTrack1"),e=new ys(this,"textTrack2"),n=new ys(this,"textTrack3"),r=new ys(this,"textTrack4");this.cea608Parser1=new ps(1,t,e),this.cea608Parser2=new ps(3,n,r)}}addCues(t,e,n,r,o){let l=!1;for(let i=o.length;i--;){const t=o[i],r=(c=t[0],h=t[1],d=e,f=n,Math.min(h,f)-Math.max(c,d));if(r>=0&&(t[0]=Math.min(t[0],e),t[1]=Math.max(t[1],n),l=!0,r/(n-e)>.5))return}var c,h,d,f;if(l||o.push([e,n]),this.config.renderTextTracksNatively){const track=this.captionsTracks[t];this.Cues.newCue(track,e,n,r)}else{const o=this.Cues.newCue(null,e,n,r);this.hls.trigger(C.CUES_PARSED,{type:"captions",cues:o,track:t})}}onInitPtsFound(t,{frag:e,id:n,initPTS:r,timescale:o}){const{unparsedVttFrags:l}=this;"main"===n&&(this.initPTS[e.cc]={baseTime:r,timescale:o}),l.length&&(this.unparsedVttFrags=[],l.forEach((t=>{this.onFragLoaded(C.FRAG_LOADED,t)})))}getExistingTrack(label,t){const{media:e}=this;if(e)for(let i=0;i<e.textTracks.length;i++){const n=e.textTracks[i];if(Ws(n,{name:label,lang:t,attrs:{}}))return n}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:n,media:r}=this,{label:label,languageCode:o}=e[t],l=this.getExistingTrack(label,o);if(l)n[t]=l,Ke(n[t]),He(n[t],r);else{const e=this.createTextTrack("captions",label,o);e&&(e[t]=!0,n[t]=e)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const track={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=track,this.hls.trigger(C.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[track]})}createTextTrack(t,label,e){const n=this.media;if(n)return n.addTextTrack(t,label,e)}onMediaAttaching(t,data){this.media=data.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:t}=this;Object.keys(t).forEach((e=>{Ke(t[e]),delete t[e]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let i=0;i<e.length;i++)Ke(e[i])}onSubtitleTracksUpdated(t,data){const e=data.subtitleTracks||[],n=e.some((track=>track.textCodec===Ps));if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(Wr(this.tracks,e))return void(this.tracks=e);if(this.textTracks=[],this.tracks=e,this.config.renderTextTracksNatively){const t=this.media,e=t?We(t.textTracks):null;if(this.tracks.forEach(((track,t)=>{let n;if(e){let t=null;for(let i=0;i<e.length;i++)if(e[i]&&Ws(e[i],track)){t=e[i],e[i]=null;break}t&&(n=t)}if(n)Ke(n);else{const t=Vs(track);n=this.createTextTrack(t,track.name,track.lang),n&&(n.mode="disabled")}n&&this.textTracks.push(n)})),null!=e&&e.length){const t=e.filter((t=>null!==t)).map((t=>t.label));t.length&&x.warn(`Media element contains unused subtitle tracks: ${t.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const t=this.tracks.map((track=>({label:track.name,kind:track.type.toLowerCase(),default:track.default,subtitleTrack:track})));this.hls.trigger(C.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:t})}}}onManifestLoaded(t,data){this.config.enableCEA708Captions&&data.captions&&data.captions.forEach((t=>{const e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(!e)return;const n=`textTrack${e[1]}`,r=this.captionsProperties[n];r&&(r.label=t.name,t.lang&&(r.languageCode=t.lang),r.media=t)}))}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return null==e?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,data){if(this.enabled&&data.frag.type===Fe){var e,n;const{cea608Parser1:t,cea608Parser2:r,lastSn:o}=this,{cc:l,sn:c}=data.frag,h=null!=(e=null==(n=data.part)?void 0:n.index)?e:-1;t&&r&&(c!==o+1||c===o&&h!==this.lastPartIndex+1||l!==this.lastCc)&&(t.reset(),r.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=h}}onFragLoaded(t,data){const{frag:e,payload:n}=data;if(e.type===je)if(n.byteLength){const t=e.decryptdata,r="stats"in data;if(null==t||!t.encrypted||r){const t=this.tracks[e.level],r=this.vttCCs;r[e.cc]||(r[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc),t&&t.textCodec===Ps?this._parseIMSC1(e,n):this._parseVTTs(data)}}else this.hls.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const n=this.hls;js(e,this.initPTS[t.cc],(e=>{this._appendCues(e,t.level),n.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(e=>{x.log(`Failed to parse IMSC1: ${e}`),n.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:e})}))}_parseVTTs(data){var t;const{frag:e,payload:n}=data,{initPTS:r,unparsedVttFrags:o}=this,l=r.length-1;if(!r[e.cc]&&-1===l)return void o.push(data);const c=this.hls;xs(null!=(t=e.initSegment)&&t.data?qt(e.initSegment.data,new Uint8Array(n)):n,this.initPTS[e.cc],this.vttCCs,e.cc,e.start,(t=>{this._appendCues(t,e.level),c.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(t=>{const r="Missing initPTS for VTT MPEGTS"===t.message;r?o.push(data):this._fallbackToIMSC1(e,n),x.log(`Failed to parse VTT cue: ${t}`),r&&l>e.cc||c.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}_fallbackToIMSC1(t,e){const n=this.tracks[t.level];n.textCodec||js(e,this.initPTS[t.cc],(()=>{n.textCodec=Ps,this._parseIMSC1(t,e)}),(()=>{n.textCodec="wvtt"}))}_appendCues(t,e){const n=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[e];if(!n||"disabled"===n.mode)return;t.forEach((t=>Ge(n,t)))}else{const r=this.tracks[e];if(!r)return;const track=r.default?"default":"subtitles"+e;n.trigger(C.CUES_PARSED,{type:"subtitles",cues:t,track:track})}}onFragDecrypted(t,data){const{frag:e}=data;e.type===je&&this.onFragLoaded(C.FRAG_LOADED,data)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,data){this.initCea608Parsers();const{cea608Parser1:e,cea608Parser2:n}=this;if(!this.enabled||!e||!n)return;const{frag:r,samples:o}=data;if(r.type!==Fe||"NONE"!==this.closedCaptionsForLevel(r))for(let i=0;i<o.length;i++){const t=o[i].bytes;if(t){const r=this.extractCea608Data(t);e.addData(o[i].pts,r[0]),n.addData(o[i].pts,r[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:n,endOffsetSubtitles:r,type:o}){const{media:l}=this;if(l&&!(l.currentTime<n)){if(!o||"video"===o){const{captionsTracks:t}=this;Object.keys(t).forEach((r=>Ve(t[r],e,n)))}if(this.config.renderTextTracksNatively&&0===e&&void 0!==r){const{textTracks:t}=this;Object.keys(t).forEach((n=>Ve(t[n],e,r)))}}}extractCea608Data(t){const e=[[],[]],n=31&t[0];let r=2;for(let o=0;o<n;o++){const n=t[r++],o=127&t[r++],l=127&t[r++];if(0===o&&0===l)continue;if(!!(4&n)){const t=3&n;0!==t&&1!==t||(e[t].push(o),e[t].push(l))}}return e}},audioStreamController:class extends Pn{constructor(t,e,n){super(t,e,n,"[audio-stream-controller]",Ne),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:t}=this;t.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.LEVEL_LOADED,this.onLevelLoaded,this),t.on(C.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(C.ERROR,this.onError,this),t.on(C.BUFFER_RESET,this.onBufferReset,this),t.on(C.BUFFER_CREATED,this.onBufferCreated,this),t.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(C.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(C.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(C.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.LEVEL_LOADED,this.onLevelLoaded,this),t.off(C.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(C.ERROR,this.onError,this),t.off(C.BUFFER_RESET,this.onBufferReset,this),t.off(C.BUFFER_CREATED,this.onBufferCreated,this),t.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(C.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(C.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(C.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(t,{frag:e,id:n,initPTS:r,timescale:o}){if("main"===n){const t=e.cc;this.initPTS[e.cc]={baseTime:r,timescale:o},this.log(`InitPTS for cc: ${t} found from main: ${r}`),this.videoTrackCC=t,this.state===In&&this.tick()}}startLoad(t){if(!this.levels)return this.startPosition=t,void(this.state=kn);const e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),e>0&&-1===t?(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e,this.state=Sn):(this.loadedmetadata=!1,this.state=An),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}doTick(){switch(this.state){case Sn:this.doTickIdle();break;case An:{var t;const{levels:e,trackId:n}=this,details=null==e||null==(t=e[n])?void 0:t.details;if(details){if(this.waitForCdnTuneIn(details))break;this.state=In}break}case Cn:{var e;const t=performance.now(),n=this.retryDate;if(!n||t>=n||null!=(e=this.media)&&e.seeking){const{levels:t,trackId:e}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==t?void 0:t[e])||null),this.state=Sn}break}case In:{const t=this.waitingData;if(t){const{frag:e,part:n,cache:r,complete:o}=t;if(void 0!==this.initPTS[e.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=Ln;const data={frag:e,part:n,payload:r.flush(),networkDetails:null};this._handleFragmentLoadProgress(data),o&&super._handleFragmentLoadComplete(data)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${e.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const t=this.getLoadPosition(),n=sn.bufferInfo(this.mediaBuffer,t,this.config.maxBufferHole);Ai(n.end,this.config.maxFragLookUpTolerance,e)<0&&(this.log(`Waiting fragment cc (${e.cc}) @ ${e.start} cancelled because another fragment at ${n.end} is needed`),this.clearWaitingFragment())}}else this.state=Sn}}this.onTickEnd()}clearWaitingFragment(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Sn)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:t}=this;null!=t&&t.readyState&&(this.lastCurrentTime=t.currentTime)}doTickIdle(){const{hls:t,levels:e,media:n,trackId:r}=this,o=t.config;if(!n&&(this.startFragRequested||!o.startFragPrefetch)||null==e||!e[r])return;const l=e[r],c=l.details;if(!c||c.live&&this.levelLastLoaded!==l||this.waitForCdnTuneIn(c))return void(this.state=An);const h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,B,Ne));const d=this.getFwdBufferInfo(h,Ne);if(null===d)return;const{bufferedTrack:f,switchingTrack:m}=this;if(!m&&this._streamEnded(d,c))return t.trigger(C.BUFFER_EOS,{type:"audio"}),void(this.state=Rn);const v=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Fe),y=d.len,T=this.getMaxBufferLength(null==v?void 0:v.len),E=c.fragments,k=E[0].start;let S=this.flushing?this.getLoadPosition():d.end;if(m&&n){const t=this.getLoadPosition();f&&!Yr(m.attrs,f.attrs)&&(S=t),c.PTSKnown&&t<k&&(d.end>k||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=k+.05)}if(y>=T&&!m&&S<E[E.length-1].start)return;let _=this.getNextFragment(S,c),L=!1;if(_&&this.isLoopLoading(_,S)&&(L=!!_.gap,_=this.getNextFragmentLoopLoading(_,c,d,Fe,T)),!_)return void(this.bufferFlushed=!0);const A=v&&_.start>v.end+c.targetduration;if(A||(null==v||!v.len)&&d.len){const t=this.getAppendedFrag(_.start,Fe);if(null===t)return;if(L||(L=!!t.gap||!!A&&0===v.len),A&&!L||L&&d.nextStart&&d.nextStart<t.end)return}this.loadFragment(_,l,S)}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.min(Math.max(e,t),this.config.maxMaxBufferLength):e}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map((t=>new ui(t)))}onAudioTrackSwitching(t,data){const e=!!data.url;this.trackId=data.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),e?this.setInterval(100):this.resetTransmuxer(),e?(this.switchingTrack=data,this.state=Sn,this.flushAudioIfNeeded(data)):(this.switchingTrack=null,this.bufferedTrack=data,this.state=kn),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(t,data){this.mainDetails=data.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(C.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(t,data){var e;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=data);const{levels:n}=this,{details:r,id:o}=data;if(!n)return void this.warn(`Audio tracks were reset while loading level ${o}`);this.log(`Audio track ${o} loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const track=n[o];let l=0;if(r.live||null!=(e=track.details)&&e.live){this.checkLiveUpdate(r);const t=this.mainDetails;if(r.deltaUpdateFailed||!t)return;var c;if(!track.details&&r.hasProgramDateTime&&t.hasProgramDateTime)hn(r,t),l=r.fragments[0].start;else l=this.alignPlaylists(r,track.details,null==(c=this.levelLastLoaded)?void 0:c.details)}track.details=r,this.levelLastLoaded=track,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(this.mainDetails||r,l),this.state!==An||this.waitForCdnTuneIn(r)||(this.state=Sn),this.tick()}_handleFragmentLoadProgress(data){var t;const{frag:e,part:n,payload:r}=data,{config:o,trackId:l,levels:c}=this;if(!c)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${e.sn} of level ${e.level} will not be buffered`);const track=c[l];if(!track)return void this.warn("Audio track is undefined on fragment load progress");const details=track.details;if(!details)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(e.start);const h=o.defaultAudioCodec||track.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new Vr(this.hls,Ne,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[e.cc],m=null==(t=e.initSegment)?void 0:t.data;if(void 0!==f){const t=!1,o=n?n.index:-1,l=-1!==o,c=new an(e.level,e.sn,e.stats.chunkCount,r.byteLength,o,l);d.push(r,m,h,"",e,n,details.totalduration,t,c,f)}else{this.log(`Unknown video PTS for cc ${e.cc}, waiting for video PTS before demuxing audio frag ${e.sn} of [${details.startSN} ,${details.endSN}],track ${l}`);const{cache:t}=this.waitingData=this.waitingData||{frag:e,part:n,cache:new Mn,complete:!1};t.push(new Uint8Array(r)),this.waitingVideoCC=this.videoTrackCC,this.state=In}}_handleFragmentLoadComplete(t){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(t,data){const e=data.tracks.audio;e&&(this.mediaBuffer=e.buffer||null),data.tracks.video&&(this.videoBuffer=data.tracks.video.buffer||null)}onFragBuffered(t,data){const{frag:e,part:n}=data;if(e.type===Ne)if(this.fragContextChanged(e))this.warn(`Fragment ${e.sn}${n?" p: "+n.index:""} of level ${e.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==e.sn){this.fragPrevious=e;const track=this.switchingTrack;track&&(this.bufferedTrack=track,this.switchingTrack=null,this.hls.trigger(C.AUDIO_TRACK_SWITCHED,y({},track)))}this.fragBufferedComplete(e,n)}else if(!this.loadedmetadata&&e.type===Fe){const t=this.videoBuffer||this.media;if(t){sn.getBuffered(t).length&&(this.loadedmetadata=!0)}}}onError(t,data){var e;if(data.fatal)this.state=Dn;else switch(data.details){case w.FRAG_GAP:case w.FRAG_PARSING_ERROR:case w.FRAG_DECRYPT_ERROR:case w.FRAG_LOAD_ERROR:case w.FRAG_LOAD_TIMEOUT:case w.KEY_LOAD_ERROR:case w.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ne,data);break;case w.AUDIO_TRACK_LOAD_ERROR:case w.AUDIO_TRACK_LOAD_TIMEOUT:case w.LEVEL_PARSING_ERROR:data.levelRetry||this.state!==An||(null==(e=data.context)?void 0:e.type)!==Pe||(this.state=Sn);break;case w.BUFFER_APPEND_ERROR:case w.BUFFER_FULL_ERROR:if(!data.parent||"audio"!==data.parent)return;if(data.details===w.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(data)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case w.INTERNAL_EXCEPTION:this.recoverWorkerError(data)}}onBufferFlushing(t,{type:e}){e!==$&&(this.flushing=!0)}onBufferFlushed(t,{type:e}){if(e!==$){this.flushing=!1,this.bufferFlushed=!0,this.state===Rn&&(this.state=Sn);const t=this.mediaBuffer||this.media;t&&(this.afterBufferFlushed(t,e,Ne),this.tick())}}_handleTransmuxComplete(t){var e;const n="audio",{hls:r}=this,{remuxResult:o,chunkMeta:l}=t,c=this.getCurrentContext(l);if(!c)return void this.resetWhenMissingContext(l);const{frag:h,part:d,level:f}=c,{details:details}=f,{audio:audio,text:text,id3:m,initSegment:v}=o;if(!this.fragContextChanged(h)&&details){if(this.state=wn,this.switchingTrack&&audio&&this.completeAudioSwitch(this.switchingTrack),null!=v&&v.tracks){const t=h.initSegment||h;this._bufferInitSegment(f,v.tracks,t,l),r.trigger(C.FRAG_PARSING_INIT_SEGMENT,{frag:t,id:n,tracks:v.tracks})}if(audio){const{startPTS:t,endPTS:e,startDTS:n,endDTS:r}=audio;d&&(d.elementaryStreams[B]={startPTS:t,endPTS:e,startDTS:n,endDTS:r}),h.setElementaryStreamInfo(B,t,e,n,r),this.bufferFragmentData(audio,h,d,l)}if(null!=m&&null!=(e=m.samples)&&e.length){const t=k({id:n,frag:h,details:details},m);r.trigger(C.FRAG_PARSING_METADATA,t)}if(text){const t=k({id:n,frag:h,details:details},text);r.trigger(C.FRAG_PARSING_USERDATA,t)}}else this.fragmentTracker.removeFragment(h)}_bufferInitSegment(t,e,n,r){if(this.state!==wn)return;e.video&&delete e.video;const track=e.audio;if(!track)return;track.id="audio";const o=t.audioCodec;this.log(`Init audio buffer, container:${track.container}, codecs[level/parsed]=[${o}/${track.codec}]`),o&&1===o.split(",").length&&(track.levelCodec=o),this.hls.trigger(C.BUFFER_CODECS,e);const l=track.initSegment;if(null!=l&&l.byteLength){const t={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:l};this.hls.trigger(C.BUFFER_APPENDING,t)}this.tickImmediate()}loadFragment(t,track,e){const n=this.fragmentTracker.getState(t);var r;if(this.fragCurrent=t,this.switchingTrack||n===Xi||n===Ji)if("initSegment"===t.sn)this._loadInitSegment(t,track);else if(null!=(r=track.details)&&r.live&&!this.initPTS[t.cc]){this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state=In;const e=this.mainDetails;e&&e.fragments[0].start!==track.details.fragments[0].start&&hn(track.details,e)}else this.startFragRequested=!0,super.loadFragment(t,track,e);else this.clearTrackerIfNeeded(t)}flushAudioIfNeeded(t){const{media:e,bufferedTrack:n}=this,r=null==n?void 0:n.attrs,o=t.attrs;e&&r&&(r.CHANNELS!==o.CHANNELS||n.name!==t.name||n.lang!==t.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(t){const{hls:e}=this;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(C.AUDIO_TRACK_SWITCHED,y({},t))}},audioTrackController:class extends Fi{constructor(t){super(t,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.MANIFEST_PARSED,this.onManifestParsed,this),t.on(C.LEVEL_LOADING,this.onLevelLoading,this),t.on(C.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.MANIFEST_PARSED,this.onManifestParsed,this),t.off(C.LEVEL_LOADING,this.onLevelLoading,this),t.off(C.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(C.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,data){this.tracks=data.audioTracks||[]}onAudioTrackLoaded(t,data){const{id:e,groupId:n,details:details}=data,r=this.tracksInGroup[e];if(!r||r.groupId!==n)return void this.warn(`Audio track with id:${e} and group:${n} not found in active group ${null==r?void 0:r.groupId}`);const o=r.details;r.details=data.details,this.log(`Audio track ${e} "${r.name}" lang:${r.lang} group:${n} loaded [${details.startSN}-${details.endSN}]`),e===this.trackId&&this.playlistLoaded(e,data,o)}onLevelLoading(t,data){this.switchLevel(data.level)}onLevelSwitching(t,data){this.switchLevel(data.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const n=e.audioGroups||null,r=this.groupIds;let o=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some((t=>-1===(null==r?void 0:r.indexOf(t))))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const t=this.tracks.filter((track=>!n||-1!==n.indexOf(track.groupId)));if(t.length)this.selectDefaultTrack&&!t.some((track=>track.default))&&(this.selectDefaultTrack=!1),t.forEach(((track,i)=>{track.id=i}));else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=t;const e=this.hls.config.audioPreference;if(!o&&e){const n=Vi(e,t,Yi);if(n>-1)o=t[n];else{const t=Vi(e,this.tracks);o=this.tracks[t]}}let r=this.findTrackId(o);-1===r&&o&&(r=this.findTrackId(null));const c={audioTracks:t};this.log(`Updating audio tracks, ${t.length} track(s) found in group(s): ${null==n?void 0:n.join(",")}`),this.hls.trigger(C.AUDIO_TRACKS_UPDATED,c);const h=this.trackId;if(-1!==r&&-1===h)this.setAudioTrack(r);else if(t.length&&-1===h){var l;const e=new Error(`No audio track selected for current audio group-ID(s): ${null==(l=this.groupIds)?void 0:l.join(",")} track count: ${t.length}`);this.warn(e.message),this.hls.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:e})}}else this.shouldReloadPlaylist(o)&&this.setAudioTrack(this.trackId)}onError(t,data){!data.fatal&&data.context&&(data.context.type!==Pe||data.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(data.context.groupId)||(this.requestScheduled=-1,this.checkRetry(data)))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioOption(t){const e=this.hls;if(e.config.audioPreference=t,t){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&Wi(t,r,Yi))return r;const o=Vi(t,this.tracksInGroup,Yi);if(o>-1){const track=this.tracksInGroup[o];return this.setAudioTrack(o),track}if(r){let r=e.loadLevel;-1===r&&(r=e.firstAutoLevel);const o=function(option,t,e,n,r){const o=t[n],l=t.reduce(((t,e,n)=>{const r=e.uri;return(t[r]||(t[r]=[])).push(n),t}),{})[o.uri];l.length>1&&(n=Math.max.apply(Math,l));const c=o.videoRange,h=o.frameRate,d=o.codecSet.substring(0,4),f=qi(t,n,(t=>{if(t.videoRange!==c||t.frameRate!==h||t.codecSet.substring(0,4)!==d)return!1;const n=t.audioGroups,o=e.filter((track=>!n||-1!==n.indexOf(track.groupId)));return Vi(option,o,r)>-1}));return f>-1?f:qi(t,n,(t=>{const n=t.audioGroups,o=e.filter((track=>!n||-1!==n.indexOf(track.groupId)));return Vi(option,o,r)>-1}))}(t,e.levels,n,r,Yi);if(-1===o)return null;e.nextLoadLevel=o}if(t.channels||t.audioCodec){const e=Vi(t,n);if(e>-1)return n[e]}}}return null}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length)return void this.warn(`Invalid audio track id: ${t}`);this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,track=e[t],r=track.details&&!track.details.live;if(t===this.trackId&&track===n&&r)return;if(this.log(`Switching to audio-track ${t} "${track.name}" lang:${track.lang} group:${track.groupId} channels:${track.channels}`),this.trackId=t,this.currentTrack=track,this.hls.trigger(C.AUDIO_TRACK_SWITCHING,y({},track)),r)return;const o=this.switchParams(track.url,null==n?void 0:n.details,track.details);this.loadPlaylist(o)}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const track=e[i];if((!this.selectDefaultTrack||track.default)&&(!t||Wi(t,track,Yi)))return i}if(t){const{name:n,lang:r,assocLang:o,characteristics:l,audioCodec:c,channels:h}=t;for(let i=0;i<e.length;i++){if(Wi({name:n,lang:r,assocLang:o,characteristics:l,audioCodec:c,channels:h},e[i],Yi))return i}for(let i=0;i<e.length;i++){const track=e[i];if(Yr(t.attrs,track.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<e.length;i++){const track=e[i];if(Yr(t.attrs,track.attrs,["LANGUAGE"]))return i}}return-1}loadPlaylist(t){const e=this.currentTrack;if(this.shouldLoadPlaylist(e)&&e){super.loadPlaylist();const n=e.id,r=e.groupId;let o=e.url;if(t)try{o=t.addDirectives(o)}catch(t){this.warn(`Could not construct new URL with HLS Delivery Directives: ${t}`)}this.log(`loading audio-track playlist ${n} "${e.name}" lang:${e.lang} group:${r}`),this.clearTimer(),this.hls.trigger(C.AUDIO_TRACK_LOADING,{url:o,id:n,groupId:r,deliveryDirectives:t||null})}}},emeController:zs,cmcdController:class{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=t=>{try{this.apply(t,{ot:Qs.MANIFEST,su:!this.initialized})}catch(t){x.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=t=>{try{const e=t.frag,n=this.hls.levels[e.level],r=this.getObjectType(e),data={d:1e3*e.duration,ot:r};r!==Qs.VIDEO&&r!==Qs.AUDIO&&r!=Qs.MUXED||(data.br=n.bitrate/1e3,data.tb=this.getTopBandwidth(r)/1e3,data.bl=this.getBufferLength(r)),this.apply(t,data)}catch(t){x.warn("Could not generate segment CMCD data.",t)}},this.hls=t;const e=this.config=t.config,{cmcd:n}=e;null!=n&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||function(){try{return crypto.randomUUID()}catch(t){try{const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}catch(t){let dt=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=(dt+16*Math.random())%16|0;return dt=Math.floor(dt/16),("x"==t?e:3&e|8).toString(16)}))}}}(),this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const t=this.hls;t.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(C.MEDIA_DETACHED,this.onMediaDetached,this),t.on(C.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(C.MEDIA_DETACHED,this.onMediaDetached,this),t.off(C.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(t,data){this.media=data.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,data){var e,n;this.audioBuffer=null==(e=data.tracks.audio)?void 0:e.buffer,this.videoBuffer=null==(n=data.tracks.video)?void 0:n.buffer}createData(){var t;return{v:1,sf:Js.HLS,sid:this.sid,cid:this.cid,pr:null==(t=this.media)?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,data={}){k(data,this.createData());const e=data.ot===Qs.INIT||data.ot===Qs.VIDEO||data.ot===Qs.MUXED;this.starved&&e&&(data.bs=!0,data.su=!0,this.starved=!1),null==data.su&&(data.su=this.buffering);const{includeKeys:n}=this;n&&(data=Object.keys(data).reduce(((t,e)=>(n.includes(e)&&(t[e]=data[e]),t)),{})),this.useHeaders?(t.headers||(t.headers={}),Da(t.headers,data)):t.url=Pa(t.url,data)}getObjectType(t){const{type:e}=t;return"subtitle"===e?Qs.TIMED_TEXT:"initSegment"===t.sn?Qs.INIT:"audio"===e?Qs.AUDIO:"main"===e?this.hls.audioTracks.length?Qs.VIDEO:Qs.MUXED:void 0}getTopBandwidth(t){let e,n=0;const r=this.hls;if(t===Qs.AUDIO)e=r.audioTracks;else{const t=r.maxAutoLevel,n=t>-1?t+1:r.levels.length;e=r.levels.slice(0,n)}for(const t of e)t.bitrate>n&&(n=t.bitrate);return n>0?n:NaN}getBufferLength(t){const e=this.hls.media,n=t===Qs.AUDIO?this.audioBuffer:this.videoBuffer;if(!n||!e)return NaN;return 1e3*sn.bufferInfo(n,e.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,n=t||this.config.loader;return class{constructor(t){this.loader=void 0,this.loader=new n(t)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(t,n,r){e(t),this.loader.load(t,n,r)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,n=t||this.config.loader;return class{constructor(t){this.loader=void 0,this.loader=new n(t)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(t,n,r){e(t),this.loader.load(t,n,r)}}}},contentSteeringController:class{constructor(t){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=x.log.bind(x,"[content-steering]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(C.MANIFEST_PARSED,this.onManifestParsed,this),t.on(C.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;t&&(t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(C.MANIFEST_PARSED,this.onManifestParsed,this),t.off(C.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const t=1e3*this.timeToLoad-(performance.now()-this.updated);if(t>0)return void this.scheduleRefresh(this.uri,t)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter((e=>e!==t)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,data){const{contentSteering:e}=data;null!==e&&(this.pathwayId=e.pathwayId,this.uri=e.uri,this.started&&this.startLoad())}onManifestParsed(t,data){this.audioTracks=data.audioTracks,this.subtitleTracks=data.subtitleTracks}onError(t,data){const{errorAction:e}=data;if((null==e?void 0:e.action)===Ri&&e.flags===Pi){const t=this.levels;let n=this.pathwayPriority,r=this.pathwayId;if(data.context){const{groupId:e,pathwayId:n,type:o}=data.context;e&&t?r=this.getPathwayForGroupId(e,o,r):n&&(r=n)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!n&&t&&(n=t.reduce(((t,e)=>(-1===t.indexOf(e.pathwayId)&&t.push(e.pathwayId),t)),[])),n&&n.length>1&&(this.updatePathwayPriority(n),e.resolved=this.pathwayId!==r),e.resolved||x.warn(`Could not resolve ${data.details} ("${data.error.message}") with content-steering for Pathway: ${r} levels: ${t?t.length:t} priorities: ${JSON.stringify(n)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(0===e.length){const n=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),e=this.getLevelsForPathway(n),this.pathwayId=n}return e.length!==t.length?(this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e):t}getLevelsForPathway(t){return null===this.levels?[]:this.levels.filter((e=>t===e.pathwayId))}updatePathwayPriority(t){let e;this.pathwayPriority=t;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach((t=>{r-n[t]>3e5&&delete n[t]}));for(let i=0;i<t.length;i++){const r=t[i];if(r in n)continue;if(r===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(e=this.getLevelsForPathway(r),e.length>0){this.log(`Setting Pathway to "${r}"`),this.pathwayId=r,bi(e),this.hls.trigger(C.LEVELS_UPDATED,{levels:e});const t=this.hls.levels[o];l&&t&&this.levels&&(t.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&t.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${t.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(t,e,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let i=0;i<r.length;i++)if(e===Pe&&r[i].hasAudioGroup(t)||e===Me&&r[i].hasSubtitleGroup(t))return r[i].pathwayId;return n}clonePathways(t){const e=this.levels;if(!e)return;const n={},r={};t.forEach((t=>{const{ID:o,"BASE-ID":l,"URI-REPLACEMENT":c}=t;if(e.some((t=>t.pathwayId===o)))return;const h=this.getLevelsForPathway(l).map((t=>{const e=new F(t.attrs);e["PATHWAY-ID"]=o;const l=e.AUDIO&&`${e.AUDIO}_clone_${o}`,h=e.SUBTITLES&&`${e.SUBTITLES}_clone_${o}`;l&&(n[e.AUDIO]=l,e.AUDIO=l),h&&(r[e.SUBTITLES]=h,e.SUBTITLES=h);const d=Fa(t.uri,e["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",c),f=new ui({attrs:e,audioCodec:t.audioCodec,bitrate:t.bitrate,height:t.height,name:t.name,url:d,videoCodec:t.videoCodec,width:t.width});if(t.audioGroups)for(let i=1;i<t.audioGroups.length;i++)f.addGroupId("audio",`${t.audioGroups[i]}_clone_${o}`);if(t.subtitleGroups)for(let i=1;i<t.subtitleGroups.length;i++)f.addGroupId("text",`${t.subtitleGroups[i]}_clone_${o}`);return f}));e.push(...h),Ma(this.audioTracks,n,c,o),Ma(this.subtitleTracks,r,c,o)}))}loadSteeringManifest(t){const e=this.hls.config,n=e.loader;let r;this.loader&&this.loader.destroy(),this.loader=new n(e);try{r=new self.URL(t)}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${t}`)}if("data:"!==r.protocol){const t=0|(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate);r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+t)}const o={responseType:"json",url:r.href},l=e.steeringManifestLoadPolicy.default,c=l.errorRetry||l.timeoutRetry||{},h={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},d={onSuccess:(t,e,n,o)=>{this.log(`Loaded steering manifest: "${r}"`);const l=t.data;if(1!==l.VERSION)return void this.log(`Steering VERSION ${l.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=l.TTL;const{"RELOAD-URI":c,"PATHWAY-CLONES":h,"PATHWAY-PRIORITY":d}=l;if(c)try{this.uri=new self.URL(c,r).href}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${c}`)}this.scheduleRefresh(this.uri||n.url),h&&this.clonePathways(h);const f={steeringManifest:l,url:r.toString()};this.hls.trigger(C.STEERING_MANIFEST_LOADED,f),d&&this.updatePathwayPriority(d)},onError:(t,e,n,r)=>{if(this.log(`Error loading steering manifest: ${t.code} ${t.text} (${e.url})`),this.stopLoad(),410===t.code)return this.enabled=!1,void this.log(`Steering manifest ${e.url} no longer available`);let o=1e3*this.timeToLoad;if(429!==t.code)this.scheduleRefresh(this.uri||e.url,o);else{const t=this.loader;if("function"==typeof(null==t?void 0:t.getResponseHeader)){const e=t.getResponseHeader("Retry-After");e&&(o=1e3*parseFloat(e))}this.log(`Steering manifest ${e.url} rate limited`)}},onTimeout:(t,e,n)=>{this.log(`Timeout loading steering manifest (${e.url})`),this.scheduleRefresh(this.uri||e.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(o,h,d)}scheduleRefresh(t,e=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout((()=>{var e;const n=null==(e=this.hls)?void 0:e.media;!n||n.ended?this.scheduleRefresh(t,1e3*this.timeToLoad):this.loadSteeringManifest(t)}),e)}}});function Wa(t){return t&&"object"==typeof t?Array.isArray(t)?t.map(Wa):Object.keys(t).reduce(((e,n)=>(e[n]=Wa(t[n]),e)),{}):t}function Ya(t){const e=t.loader;if(e!==Ba&&e!==ja)x.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1})()&&(t.loader=Ba,t.progressive=!0,t.enableSoftwareAES=!0,x.log("[config]: Progressive streaming enabled, using FetchLoader"))}}let qa;class za extends Fi{constructor(t,e){super(t,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(C.LEVEL_LOADED,this.onLevelLoaded,this),t.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(C.FRAG_BUFFERED,this.onFragBuffered,this),t.on(C.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(C.LEVEL_LOADED,this.onLevelLoaded,this),t.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(C.FRAG_BUFFERED,this.onFragBuffered,this),t.off(C.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach((t=>{t.loadError=0,t.fragmentError=0})),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(t,data){this.resetLevels()}onManifestLoaded(t,data){const e=this.hls.config.preferManagedMediaSource,n=[],r={},o={};let l=!1,c=!1,h=!1;data.levels.forEach((t=>{var d,f;const m=t.attrs;let{audioCodec:v,videoCodec:y}=t;-1!==(null==(d=v)?void 0:d.indexOf("mp4a.40.34"))&&(qa||(qa=/chrome|firefox/i.test(navigator.userAgent)),qa&&(t.audioCodec=v=void 0)),v&&(t.audioCodec=v=ve(v,e)),0===(null==(f=y)?void 0:f.indexOf("avc1"))&&(y=t.videoCodec=function(t){const e=t.split(",");for(let i=0;i<e.length;i++){const t=e[i].split(".");if(t.length>2){let n=t.shift()+".";n+=parseInt(t.shift()).toString(16),n+=("000"+parseInt(t.shift()).toString(16)).slice(-4),e[i]=n}}return e.join(",")}(y));const{width:T,height:E,unknownCodecs:k}=t;if(l||(l=!(!T||!E)),c||(c=!!y),h||(h=!!v),null!=k&&k.length||v&&!ue(v,"audio",e)||y&&!ue(y,"video",e))return;const{CODECS:S,"FRAME-RATE":_,"HDCP-LEVEL":L,"PATHWAY-ID":C,RESOLUTION:A,"VIDEO-RANGE":w}=m,O=`${`${C||"."}-`}${t.bitrate}-${A}-${_}-${S}-${w}-${L}`;if(r[O])if(r[O].uri===t.url||t.attrs["PATHWAY-ID"])r[O].addGroupId("audio",m.AUDIO),r[O].addGroupId("text",m.SUBTITLES);else{const e=o[O]+=1;t.attrs["PATHWAY-ID"]=new Array(e+1).join(".");const l=new ui(t);r[O]=l,n.push(l)}else{const e=new ui(t);r[O]=e,o[O]=1,n.push(e)}})),this.filterAndSortMediaOptions(n,data,l,c,h)}filterAndSortMediaOptions(t,data,e,n,r){let o=[],l=[],c=t;if((e||n)&&r&&(c=c.filter((({videoCodec:t,videoRange:e,width:n,height:r})=>{return(!!t||!(!n||!r))&&(!!(o=e)&&ni.indexOf(o)>-1);var o}))),0===c.length)return void Promise.resolve().then((()=>{if(this.hls){data.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(data.levels[0].attrs)}`);const t=new Error("no level with compatible codecs found in manifest");this.hls.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:data.url,error:t,reason:t.message})}}));if(data.audioTracks){const{preferManagedMediaSource:t}=this.hls.config;o=data.audioTracks.filter((track=>!track.audioCodec||ue(track.audioCodec,"audio",t))),Xa(o)}data.subtitles&&(l=data.subtitles,Xa(l));const h=c.slice(0);c.sort(((a,b)=>{if(a.attrs["HDCP-LEVEL"]!==b.attrs["HDCP-LEVEL"])return(a.attrs["HDCP-LEVEL"]||"")>(b.attrs["HDCP-LEVEL"]||"")?1:-1;if(e&&a.height!==b.height)return a.height-b.height;if(a.frameRate!==b.frameRate)return a.frameRate-b.frameRate;if(a.videoRange!==b.videoRange)return ni.indexOf(a.videoRange)-ni.indexOf(b.videoRange);if(a.videoCodec!==b.videoCodec){const t=fe(a.videoCodec),e=fe(b.videoCodec);if(t!==e)return e-t}if(a.uri===b.uri&&a.codecSet!==b.codecSet){const t=ge(a.codecSet),e=ge(b.codecSet);if(t!==e)return e-t}return a.averageBitrate!==b.averageBitrate?a.averageBitrate-b.averageBitrate:0}));let d=h[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==h.length))for(let i=0;i<h.length;i++)if(h[i].pathwayId===c[0].pathwayId){d=h[i];break}this._levels=c;for(let i=0;i<c.length;i++)if(c[i]===d){var f;this._firstLevel=i;const t=d.bitrate,e=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${t}`),void 0===(null==(f=this.hls.userConfig)?void 0:f.abrEwmaDefaultEstimate)){const n=Math.min(t,this.hls.config.abrEwmaDefaultEstimateMax);n>e&&e===Va.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=n)}break}const m=r&&!n,v={levels:c,audioTracks:o,subtitleTracks:l,sessionData:data.sessionData,sessionKeys:data.sessionKeys,firstLevel:this._firstLevel,stats:data.stats,audio:r,video:n,altAudio:!m&&o.some((t=>!!t.url))};this.hls.trigger(C.MANIFEST_PARSED,v),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(0===e.length)return;if(t<0||t>=e.length){const n=new Error("invalid level idx"),r=t<0;if(this.hls.trigger(C.ERROR,{type:A.OTHER_ERROR,details:w.LEVEL_SWITCH_ERROR,level:t,fatal:r,error:n,reason:n.message}),r)return;t=Math.min(t,e.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,o=r?r.attrs["PATHWAY-ID"]:void 0,l=e[t],c=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=l,n===t&&l.details&&r&&o===c)return;this.log(`Switching to level ${t} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${c?" with Pathway "+c:""} from level ${n}${o?" with Pathway "+o:""}`);const h={level:t,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(C.LEVEL_SWITCHING,h);const d=l.details;if(!d||d.live){const t=this.switchParams(l.uri,null==r?void 0:r.details,d);this.loadPlaylist(t)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(void 0===this._startLevel){const t=this.hls.config.startLevel;return void 0!==t?t:this.hls.firstAutoLevel}return this._startLevel}set startLevel(t){this._startLevel=t}onError(t,data){!data.fatal&&data.context&&data.context.type===xe&&data.context.level===this.level&&this.checkRetry(data)}onFragBuffered(t,{frag:e}){if(void 0!==e&&e.type===Fe){const t=e.elementaryStreams;if(!Object.keys(t).some((e=>!!t[e])))return;const n=this._levels[e.level];null!=n&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(t,data){var e;const{level:n,details:details}=data,r=this._levels[n];var o;if(!r)return this.warn(`Invalid level index ${n}`),void(null!=(o=data.deliveryDirectives)&&o.skip&&(details.deltaUpdateFailed=!0));n===this.currentLevelIndex?(0===r.fragmentError&&(r.loadError=0),this.playlistLoaded(n,data,r.details)):null!=(e=data.deliveryDirectives)&&e.skip&&(details.deltaUpdateFailed=!0)}loadPlaylist(t){super.loadPlaylist();const e=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){let r=n.uri;if(t)try{r=t.addDirectives(r)}catch(t){this.warn(`Could not construct new URL with HLS Delivery Directives: ${t}`)}const o=n.attrs["PATHWAY-ID"];this.log(`Loading level index ${e}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""} with${o?" Pathway "+o:""} ${r}`),this.clearTimer(),this.hls.trigger(C.LEVEL_LOADING,{url:r,level:e,pathwayId:n.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}removeLevel(t){var e;const n=this._levels.filter(((e,n)=>n!==t||(this.steering&&this.steering.removeLevel(e),e===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,e.details&&e.details.fragments.forEach((t=>t.level=-1))),!1)));bi(n),this._levels=n,this.currentLevelIndex>-1&&null!=(e=this.currentLevel)&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(C.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(t,{levels:e}){this._levels=e}checkMaxAutoUpdated(){const{autoLevelCapping:t,maxAutoLevel:e,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==e&&(this._maxAutoLevel=e,this.hls.trigger(C.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:e,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function Xa(t){const e={};t.forEach((track=>{const t=track.groupId||"";track.id=e[t]=e[t]||0,e[t]++}))}class Qa{constructor(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const n in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[n].loader;if(r){var e;if(t&&t!==(null==(e=r.context)?void 0:e.frag.type))return;r.abort()}}}detach(){for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(t,details=w.KEY_LOAD_ERROR,e,n,r){return new mn({type:A.NETWORK_ERROR,details:details,fatal:!1,frag:t,response:r,error:e,networkDetails:n})}loadClear(t,e){if(this.emeController&&this.config.emeEnabled){const{sn:n,cc:r}=t;for(let i=0;i<e.length;i++){const t=e[i];if(r<=t.cc&&("initSegment"===n||"initSegment"===t.sn||n<t.sn)){this.emeController.selectKeySystemFormat(t).then((e=>{t.setKeyFormat(e)}));break}}}}load(t){return!t.decryptdata&&t.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(t).then((e=>this.loadInternal(t,e))):this.loadInternal(t)}loadInternal(t,e){var n,r;e&&t.setKeyFormat(e);const o=t.decryptdata;if(!o){const n=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,w.KEY_LOAD_ERROR,n))}const l=o.uri;if(!l)return Promise.reject(this.createKeyLoadError(t,w.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));let c=this.keyUriToKeyInfo[l];if(null!=(n=c)&&n.decryptdata.key)return o.key=c.decryptdata.key,Promise.resolve({frag:t,keyInfo:c});var h;if(null!=(r=c)&&r.keyLoadPromise)switch(null==(h=c.mediaKeySessionContext)?void 0:h.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise.then((e=>(o.key=e.keyInfo.decryptdata.key,{frag:t,keyInfo:c})))}switch(c=this.keyUriToKeyInfo[l]={decryptdata:o,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},o.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===o.keyFormat?this.loadKeyHTTP(c,t):this.loadKeyEME(c,t);case"AES-128":return this.loadKeyHTTP(c,t);default:return Promise.reject(this.createKeyLoadError(t,w.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${o.method}"`)))}}loadKeyEME(t,e){const n={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){const e=this.emeController.loadKey(n);if(e)return(t.keyLoadPromise=e.then((e=>(t.mediaKeySessionContext=e,n)))).catch((e=>{throw t.keyLoadPromise=null,e}))}return Promise.resolve(n)}loadKeyHTTP(t,e){const n=this.config,r=new(0,n.loader)(n);return e.keyLoader=t.loader=r,t.keyLoadPromise=new Promise(((o,l)=>{const c={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},h=n.keyLoadPolicy.default,d={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(t,e,n,r)=>{const{frag:c,keyInfo:h,url:d}=n;if(!c.decryptdata||h!==this.keyUriToKeyInfo[d])return l(this.createKeyLoadError(c,w.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));h.decryptdata.key=c.decryptdata.key=new Uint8Array(t.data),c.keyLoader=null,h.loader=null,o({frag:c,keyInfo:h})},onError:(t,n,r,o)=>{this.resetLoader(n),l(this.createKeyLoadError(e,w.KEY_LOAD_ERROR,new Error(`HTTP Error ${t.code} loading key ${t.text}`),r,y({url:c.url,data:void 0},t)))},onTimeout:(t,n,r)=>{this.resetLoader(n),l(this.createKeyLoadError(e,w.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:(t,n,r)=>{this.resetLoader(n),l(this.createKeyLoadError(e,w.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};r.load(c,d,f)}))}resetLoader(t){const{frag:e,keyInfo:n,url:r}=t,o=n.loader;e.keyLoader===o&&(e.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[r],o&&o.destroy()}}function Ja(){return self.SourceBuffer||self.WebKitSourceBuffer}function Za(){if(!le())return!1;const t=Ja();return!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove}class to{constructor(t,e,n,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=n,this.hls=r}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(t,e){const{config:n,media:r,stalled:o}=this;if(null===r)return;const{currentTime:l,seeking:c}=r,h=this.seeking&&!c,d=!this.seeking&&c;if(this.seeking=c,l!==t){if(this.moved=!0,c||(this.nudgeRetry=0),null!==o){if(this.stallReported){const t=self.performance.now()-o;x.warn(`playback not stuck anymore @${l}, after ${Math.round(t)}ms`),this.stallReported=!1}this.stalled=null}return}if(d||h)return void(this.stalled=null);if(r.paused&&!c||r.ended||0===r.playbackRate||!sn.getBuffered(r).length)return void(this.nudgeRetry=0);const f=sn.bufferInfo(r,l,0),m=f.nextStart||0;if(c){const t=f.len>2,n=!m||e&&e.start<=l||m-l>2&&!this.fragmentTracker.getPartialFragment(l);if(t||n)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var v;if(!(f.len>0)&&!m)return;const t=Math.max(m,f.start||0)-l,e=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,n=(null==e||null==(v=e.details)?void 0:v.live)?2*e.details.targetduration:2,o=this.fragmentTracker.getPartialFragment(l);if(t>0&&(t<=n||o))return void(r.paused||this._trySkipBufferHole(o))}const y=self.performance.now();if(null===o)return void(this.stalled=y);const T=y-o;if(!c&&T>=250&&(this._reportStall(f),!this.media))return;const E=sn.bufferInfo(r,l,n.maxBufferHole);this._tryFixBufferStall(E,T)}_tryFixBufferStall(t,e){const{config:n,fragmentTracker:r,media:o}=this;if(null===o)return;const l=o.currentTime,c=r.getPartialFragment(l);if(c){if(this._trySkipBufferHole(c)||!this.media)return}(t.len>n.maxBufferHole||t.nextStart&&t.nextStart-l<n.maxBufferHole)&&e>1e3*n.highBufferWatchdogPeriod&&(x.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(t){const{hls:e,media:n,stallReported:r}=this;if(!r&&n){this.stallReported=!0;const r=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${JSON.stringify(t)})`);x.warn(r.message),e.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:t.len})}}_trySkipBufferHole(t){const{config:e,hls:n,media:r}=this;if(null===r)return 0;const o=r.currentTime,l=sn.bufferInfo(r,o,0),c=o<l.start?l.start:l.nextStart;if(c){const h=l.len<=e.maxBufferHole,d=l.len>0&&l.len<1&&r.readyState<3,f=c-o;if(f>0&&(h||d)){if(f>e.maxBufferHole){const{fragmentTracker:e}=this;let n=!1;if(0===o){const t=e.getAppendedFrag(0,Fe);t&&c<t.end&&(n=!0)}if(!n){const n=t||e.getAppendedFrag(o,Fe);if(n){let t=!1,r=n.end;for(;r<c;){const n=e.getPartialFragment(r);if(!n){t=!0;break}r+=n.duration}if(t)return 0}}}const l=Math.max(c+.05,o+.1);if(x.warn(`skipping hole, adjusting currentTime from ${o} to ${l}`),this.moved=!0,this.stalled=null,r.currentTime=l,t&&!t.gap){const e=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${l}`);n.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:e,reason:e.message,frag:t})}return l}}return 0}_tryNudgeBuffer(){const{config:t,hls:e,media:n,nudgeRetry:r}=this;if(null===n)return;const o=n.currentTime;if(this.nudgeRetry++,r<t.nudgeMaxRetry){const l=o+(r+1)*t.nudgeOffset,c=new Error(`Nudging 'currentTime' from ${o} to ${l}`);x.warn(c.message),n.currentTime=l,e.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1})}else{const n=new Error(`Playhead still not moving while enough data buffered @${o} after ${t.nudgeMaxRetry} nudges`);x.error(n.message),e.trigger(C.ERROR,{type:A.MEDIA_ERROR,details:w.BUFFER_STALLED_ERROR,error:n,fatal:!0})}}}class eo extends Pn{constructor(t,e,n){super(t,e,n,"[stream-controller]",Fe),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(C.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.MANIFEST_PARSED,this.onManifestParsed,this),t.on(C.LEVEL_LOADING,this.onLevelLoading,this),t.on(C.LEVEL_LOADED,this.onLevelLoaded,this),t.on(C.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(C.ERROR,this.onError,this),t.on(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(C.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(C.BUFFER_CREATED,this.onBufferCreated,this),t.on(C.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(C.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(C.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.MANIFEST_PARSED,this.onManifestParsed,this),t.off(C.LEVEL_LOADED,this.onLevelLoaded,this),t.off(C.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(C.ERROR,this.onError,this),t.off(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(C.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(C.BUFFER_CREATED,this.onBufferCreated,this),t.off(C.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(C.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(t){if(this.levels){const{lastCurrentTime:e,hls:n}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let t=n.startLevel;-1===t&&(n.config.testBandwidth&&this.levels.length>1?(t=0,this.bitrateTest=!0):t=n.firstAutoLevel),n.nextLoadLevel=t,this.level=n.loadLevel,this.loadedmetadata=!1}e>0&&-1===t&&(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e),this.state=Sn,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=kn}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case xn:{const{levels:t,level:e}=this,n=null==t?void 0:t[e],details=null==n?void 0:n.details;if(details&&(!details.live||this.levelLastLoaded===n)){if(this.waitForCdnTuneIn(details))break;this.state=Sn;break}if(this.hls.nextLoadLevel!==this.level){this.state=Sn;break}break}case Cn:{var t;const e=self.performance.now(),n=this.retryDate;if(!n||e>=n||null!=(t=this.media)&&t.seeking){const{levels:t,level:e}=this,n=null==t?void 0:t[e];this.resetStartWhenNotLoaded(n||null),this.state=Sn}}}this.state===Sn&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:n,media:r}=this;if(null===e||!r&&(this.startFragRequested||!t.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const o=t.nextLoadLevel;if(null==n||!n[o])return;const l=n[o],c=this.getMainFwdBufferInfo();if(null===c)return;const h=this.getLevelDetails();if(h&&this._streamEnded(c,h)){const data={};return this.altAudio&&(data.type="video"),this.hls.trigger(C.BUFFER_EOS,data),void(this.state=Rn)}t.loadLevel!==o&&-1===t.manualLevel&&this.log(`Adapting to level ${o} from level ${this.level}`),this.level=t.nextLoadLevel=o;const d=l.details;if(!d||this.state===xn||d.live&&this.levelLastLoaded!==l)return this.level=o,void(this.state=xn);const f=c.len,m=this.getMaxBufferLength(l.maxBitrate);if(f>=m)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:c.end;let y=this.getNextFragment(v,d);if(this.couldBacktrack&&!this.fragPrevious&&y&&"initSegment"!==y.sn&&this.fragmentTracker.getState(y)!==Zi){var T;const t=(null!=(T=this.backtrackFragment)?T:y).sn-d.startSN,e=d.fragments[t-1];e&&y.cc===e.cc&&(y=e,this.fragmentTracker.removeFragment(e))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,v)){if(!y.gap){const t=this.audioOnly&&!this.altAudio?B:$,e=(t===$?this.videoBuffer:this.mediaBuffer)||this.media;e&&this.afterBufferFlushed(e,t,Fe)}y=this.getNextFragmentLoopLoading(y,d,c,Fe,m)}y&&(!y.initSegment||y.initSegment.data||this.bitrateTest||(y=y.initSegment),this.loadFragment(y,l,v))}loadFragment(t,e,n){const r=this.fragmentTracker.getState(t);this.fragCurrent=t,r===Xi||r===Ji?"initSegment"===t.sn?this._loadInitSegment(t,e):this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):(this.startFragRequested=!0,super.loadFragment(t,e,n)):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,Fe)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(null!=e&&e.readyState){let n;const r=this.getAppendedFrag(e.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const o=this.getLevelDetails();if(null!=o&&o.live){const t=this.getMainFwdBufferInfo();if(!t||t.len<2*o.targetduration)return}if(!e.paused&&t){const e=t[this.hls.nextLoadLevel],r=this.fragLastKbps;n=r&&this.fragCurrent?this.fragCurrent.duration*e.maxBitrate/(1e3*r)+1:0}else n=0;const l=this.getBufferedFrag(e.currentTime+n);if(l){const t=this.followingBufferedFrag(l);if(t){this.abortCurrentFrag();const e=t.maxStartPTS?t.maxStartPTS:t.start,n=t.duration,r=Math.max(l.end,e+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,n*(this.couldBacktrack?.5:.125)),n*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(r,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case _n:case Ln:case Cn:case wn:case On:this.state=Sn}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,this.altAudio?"video":null)}onMediaAttached(t,data){super.onMediaAttached(t,data);const e=data.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.addEventListener("playing",this.onvplaying),e.addEventListener("seeked",this.onvseeked),this.gapController=new to(this.config,e,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:t}=this;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const t=this.media,e=t?t.currentTime:null;S(e)&&this.log(`Media seeked to ${e.toFixed(3)}`);const n=this.getMainFwdBufferInfo();null!==n&&0!==n.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${n?n.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(C.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(t,data){let e=!1,n=!1;data.levels.forEach((t=>{const r=t.audioCodec;r&&(e=e||-1!==r.indexOf("mp4a.40.2"),n=n||-1!==r.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=e&&n&&!function(){var t;const e=Ja();return"function"==typeof(null==e||null==(t=e.prototype)?void 0:t.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=data.levels,this.startFragRequested=!1}onLevelLoading(t,data){const{levels:e}=this;if(!e||this.state!==Sn)return;const n=e[data.level];(!n.details||n.details.live&&this.levelLastLoaded!==n||this.waitForCdnTuneIn(n.details))&&(this.state=xn)}onLevelLoaded(t,data){var e;const{levels:n}=this,r=data.level,o=data.details,l=o.totalduration;if(!n)return void this.warn(`Levels were reset while loading level ${r}`);this.log(`Level ${r} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const c=n[r],h=this.fragCurrent;!h||this.state!==Ln&&this.state!==Cn||h.level!==data.level&&h.loader&&this.abortCurrentFrag();let d=0;if(o.live||null!=(e=c.details)&&e.live){var f;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,c.details,null==(f=this.levelLastLoaded)?void 0:f.details)}if(c.details=o,this.levelLastLoaded=c,this.hls.trigger(C.LEVEL_UPDATED,{details:o,level:r}),this.state===xn){if(this.waitForCdnTuneIn(o))return;this.state=Sn}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,d),this.tick()}_handleFragmentLoadProgress(data){var t;const{frag:e,part:n,payload:r}=data,{levels:o}=this;if(!o)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${e.sn} of level ${e.level} will not be buffered`);const l=o[e.level],details=l.details;if(!details)return this.warn(`Dropping fragment ${e.sn} of level ${e.level} after level details were reset`),void this.fragmentTracker.removeFragment(e);const c=l.videoCodec,h=details.PTSKnown||!details.live,d=null==(t=e.initSegment)?void 0:t.data,f=this._getAudioCodec(l),m=this.transmuxer=this.transmuxer||new Vr(this.hls,Fe,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=n?n.index:-1,y=-1!==v,T=new an(e.level,e.sn,e.stats.chunkCount,r.byteLength,v,y),E=this.initPTS[e.cc];m.push(r,d,f,c,e,n,details.totalduration,h,T,E)}onAudioTrackSwitching(t,data){const e=this.altAudio;if(!!!data.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const t=this.fragCurrent;t&&(this.log("Switching to main audio track, cancel main fragment load"),t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const t=this.hls;e&&(t.trigger(C.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),t.trigger(C.AUDIO_TRACK_SWITCHED,data)}}onAudioTrackSwitched(t,data){const e=data.id,n=!!this.hls.audioTracks[e].url;if(n){const t=this.videoBuffer;t&&this.mediaBuffer!==t&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=t)}this.altAudio=n,this.tick()}onBufferCreated(t,data){const e=data.tracks;let n,r,o=!1;for(const t in e){const track=e[t];if("main"===track.id){if(r=t,n=track,"video"===t){const n=e[t];n&&(this.videoBuffer=n.buffer)}}else o=!0}o&&n?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(t,data){const{frag:e,part:n}=data;if(e&&e.type!==Fe)return;if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${n?" p: "+n.index:""} of level ${e.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===On&&(this.state=Sn));const r=n?n.stats:e.stats;this.fragLastKbps=Math.round(8*r.total/(r.buffering.end-r.loading.first)),"initSegment"!==e.sn&&(this.fragPrevious=e),this.fragBufferedComplete(e,n)}onError(t,data){var e;if(data.fatal)this.state=Dn;else switch(data.details){case w.FRAG_GAP:case w.FRAG_PARSING_ERROR:case w.FRAG_DECRYPT_ERROR:case w.FRAG_LOAD_ERROR:case w.FRAG_LOAD_TIMEOUT:case w.KEY_LOAD_ERROR:case w.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Fe,data);break;case w.LEVEL_LOAD_ERROR:case w.LEVEL_LOAD_TIMEOUT:case w.LEVEL_PARSING_ERROR:data.levelRetry||this.state!==xn||(null==(e=data.context)?void 0:e.type)!==xe||(this.state=Sn);break;case w.BUFFER_APPEND_ERROR:case w.BUFFER_FULL_ERROR:if(!data.parent||"main"!==data.parent)return;if(data.details===w.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(data)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case w.INTERNAL_EXCEPTION:this.recoverWorkerError(data)}}checkBuffer(){const{media:t,gapController:e}=this;if(t&&e&&t.readyState){if(this.loadedmetadata||!sn.getBuffered(t).length){const t=this.state!==Sn?this.fragCurrent:null;e.poll(this.lastCurrentTime,t)}this.lastCurrentTime=t.currentTime}}onFragLoadEmergencyAborted(){this.state=Sn,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(t,{type:e}){if(e!==B||this.audioOnly&&!this.altAudio){const t=(e===$?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(t,e,Fe),this.tick()}}onLevelsUpdated(t,data){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=data.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let n=this.startPosition;if(n>=0&&e<n){if(t.seeking)return void this.log(`could not seek to ${n}, already seeking at ${e}`);const r=sn.getBuffered(t),o=(r.length?r.start(0):0)-n;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${o} to match buffer start`),n+=o,this.startPosition=n),this.log(`seek to target start position ${n} from current time ${e}`),t.currentTime=n}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then((data=>{const{hls:n}=this;if(!data||this.fragContextChanged(t))return;e.fragmentError=0,this.state=Sn,this.startFragRequested=!1,this.bitrateTest=!1;const r=t.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),n.trigger(C.FRAG_LOADED,data),t.bitrateTest=!1}))}_handleTransmuxComplete(t){var e;const n="main",{hls:r}=this,{remuxResult:o,chunkMeta:l}=t,c=this.getCurrentContext(l);if(!c)return void this.resetWhenMissingContext(l);const{frag:h,part:d,level:f}=c,{video:video,text:text,id3:m,initSegment:v}=o,{details:details}=f,audio=this.altAudio?void 0:o.audio;if(this.fragContextChanged(h))this.fragmentTracker.removeFragment(h);else{if(this.state=wn,v){if(null!=v&&v.tracks){const t=h.initSegment||h;this._bufferInitSegment(f,v.tracks,t,l),r.trigger(C.FRAG_PARSING_INIT_SEGMENT,{frag:t,id:n,tracks:v.tracks})}const t=v.initPTS,e=v.timescale;S(t)&&(this.initPTS[h.cc]={baseTime:t,timescale:e},r.trigger(C.INIT_PTS_FOUND,{frag:h,id:n,initPTS:t,timescale:e}))}if(video&&details&&"initSegment"!==h.sn){const t=details.fragments[h.sn-1-details.startSN],e=h.sn===details.startSN,n=!t||h.cc>t.cc;if(!1!==o.independent){const{startPTS:t,endPTS:r,startDTS:o,endDTS:c}=video;if(d)d.elementaryStreams[video.type]={startPTS:t,endPTS:r,startDTS:o,endDTS:c};else if(video.firstKeyFrame&&video.independent&&1===l.id&&!n&&(this.couldBacktrack=!0),video.dropped&&video.independent){const o=this.getMainFwdBufferInfo(),l=(o?o.end:this.getLoadPosition())+this.config.maxBufferHole,d=video.firstKeyFramePTS?video.firstKeyFramePTS:t;if(!e&&l<d-this.config.maxBufferHole&&!n)return void this.backtrack(h);n&&(h.gap=!0),h.setElementaryStreamInfo(video.type,h.start,r,h.start,c,!0)}else e&&t>2&&(h.gap=!0);h.setElementaryStreamInfo(video.type,t,r,o,c),this.backtrackFragment&&(this.backtrackFragment=h),this.bufferFragmentData(video,h,d,l,e||n)}else{if(!e&&!n)return void this.backtrack(h);h.gap=!0}}if(audio){const{startPTS:t,endPTS:e,startDTS:n,endDTS:r}=audio;d&&(d.elementaryStreams[B]={startPTS:t,endPTS:e,startDTS:n,endDTS:r}),h.setElementaryStreamInfo(B,t,e,n,r),this.bufferFragmentData(audio,h,d,l)}if(details&&null!=m&&null!=(e=m.samples)&&e.length){const t={id:n,frag:h,details:details,samples:m.samples};r.trigger(C.FRAG_PARSING_METADATA,t)}if(details&&text){const t={id:n,frag:h,details:details,samples:text.samples};r.trigger(C.FRAG_PARSING_USERDATA,t)}}}_bufferInitSegment(t,e,n,r){if(this.state!==wn)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;const{audio:audio,video:video,audiovideo:o}=e;if(audio){let e=t.audioCodec;const n=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){e&&(e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const t=audio.metadata;t&&"channelCount"in t&&1!==(t.channelCount||1)&&-1===n.indexOf("firefox")&&(e="mp4a.40.5")}e&&-1!==e.indexOf("mp4a.40.5")&&-1!==n.indexOf("android")&&"audio/mpeg"!==audio.container&&(e="mp4a.40.2",this.log(`Android: force audio codec to ${e}`)),t.audioCodec&&t.audioCodec!==e&&this.log(`Swapping manifest audio codec "${t.audioCodec}" for "${e}"`),audio.levelCodec=e,audio.id="main",this.log(`Init audio buffer, container:${audio.container}, codecs[selected/level/parsed]=[${e||""}/${t.audioCodec||""}/${audio.codec}]`)}video&&(video.levelCodec=t.videoCodec,video.id="main",this.log(`Init video buffer, container:${video.container}, codecs[level/parsed]=[${t.videoCodec||""}/${video.codec}]`)),o&&this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${t.codecs}/${o.codec}]`),this.hls.trigger(C.BUFFER_CODECS,e),Object.keys(e).forEach((t=>{const o=e[t].initSegment;null!=o&&o.byteLength&&this.hls.trigger(C.BUFFER_APPENDING,{type:t,data:o,frag:n,part:null,chunkMeta:r,parent:n.type})})),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Fe)}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=Sn}checkFragmentChanged(){const video=this.media;let t=null;if(video&&video.readyState>1&&!1===video.seeking){const e=video.currentTime;if(sn.isBuffered(video,e)?t=this.getAppendedFrag(e):sn.isBuffered(video,e+.1)&&(t=this.getAppendedFrag(e+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,n=t.level;e&&t.sn===e.sn&&e.level===n||(this.fragPlaying=t,this.hls.trigger(C.FRAG_CHANGED,{frag:t}),e&&e.level===n||this.hls.trigger(C.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){const t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}get currentProgramDateTime(){const t=this.media;if(t){const e=t.currentTime,n=this.currentFrag;if(n&&S(e)&&S(n.programDateTime)){const t=n.programDateTime+1e3*(e-n.start);return new Date(t)}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class io{static get version(){return"1.5.14"}static isMSESupported(){return Za()}static isSupported(){return function(){if(!Za())return!1;const t=le();return"function"==typeof(null==t?void 0:t.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((e=>t.isTypeSupported(de(e,"video"))))||["mp4a.40.2","fLaC"].some((e=>t.isTypeSupported(de(e,"audio")))))}()}static getMediaSource(){return le()}static get Events(){return C}static get ErrorTypes(){return A}static get ErrorDetails(){return w}static get DefaultConfig(){return io.defaultConfig?io.defaultConfig:Va}static set DefaultConfig(t){io.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new Kr,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,function(t,e){if("object"==typeof console&&!0===t||"object"==typeof t){I(t,"debug","log","info","warn","error");try{D.log(`Debug logs enabled for "${e}" in hls.js version 1.5.14`)}catch(t){D=R}}else D=R}(t.debug||!1,"Hls instance");const e=this.config=function(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=Wa(t),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((t=>{const o=`${"level"===t?"playlist":t}LoadPolicy`,l=void 0===e[o],c=[];r.forEach((r=>{const h=`${t}Loading${r}`,d=e[h];if(void 0!==d&&l){c.push(h);const t=n[o].default;switch(e[o]={default:t},r){case"TimeOut":t.maxLoadTimeMs=d,t.maxTimeToFirstByteMs=d;break;case"MaxRetry":t.errorRetry.maxNumRetry=d,t.timeoutRetry.maxNumRetry=d;break;case"RetryDelay":t.errorRetry.retryDelayMs=d,t.timeoutRetry.retryDelayMs=d;break;case"MaxRetryTimeout":t.errorRetry.maxRetryDelayMs=d,t.timeoutRetry.maxRetryDelayMs=d}}})),c.length&&x.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${o}": ${JSON.stringify(e[o])}`)})),y(y({},n),e)}(io.DefaultConfig,t);this.userConfig=t,e.progressive&&Ya(e);const{abrController:n,bufferController:r,capLevelController:o,errorController:l,fpsController:c}=e,h=new l(this),d=this.abrController=new n(this),f=this.bufferController=new r(this),m=this.capLevelController=new o(this),v=new c(this),T=new $e(this),E=new ti(this),k=e.contentSteeringController,S=k?new k(this):null,_=this.levelController=new za(this,S),L=new tn(this),A=new Qa(this.config),w=this.streamController=new eo(this,L,A);m.setStreamController(w),v.setStreamController(w);const O=[T,_,w];S&&O.splice(1,0,S),this.networkControllers=O;const P=[d,f,m,v,E,L];this.audioTrackController=this.createController(e.audioTrackController,O);const M=e.audioStreamController;M&&O.push(new M(this,L,A)),this.subtitleTrackController=this.createController(e.subtitleTrackController,O);const F=e.subtitleStreamController;F&&O.push(new F(this,L,A)),this.createController(e.timelineController,P),A.emeController=this.emeController=this.createController(e.emeController,P),this.cmcdController=this.createController(e.cmcdController,P),this.latencyController=this.createController(ei,P),this.coreComponents=P,O.push(h);const N=h.onErrorOut;"function"==typeof N&&this.on(C.ERROR,N,h)}createController(t,e){if(t){const n=new t(this);return e&&e.push(n),n}return null}on(t,e,n=this){this._emitter.on(t,e,n)}once(t,e,n=this){this._emitter.once(t,e,n)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,n=this,r){this._emitter.off(t,e,n,r)}listeners(t){return this._emitter.listeners(t)}emit(t,e,n){return this._emitter.emit(t,e,n)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(e){if(x.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),!this.triggeringException){this.triggeringException=!0;const n=t===C.ERROR;this.trigger(C.ERROR,{type:A.OTHER_ERROR,details:w.INTERNAL_EXCEPTION,fatal:n,event:t,error:e}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){x.log("destroy"),this.trigger(C.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((component=>component.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((component=>component.destroy())),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){x.log("attachMedia"),this._media=t,this.trigger(C.MEDIA_ATTACHING,{media:t})}detachMedia(){x.log("detachMedia"),this.trigger(C.MEDIA_DETACHING,void 0),this._media=null}loadSource(t){this.stopLoad();const e=this.media,n=this.url,r=this.url=m.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,x.log(`loadSource:${r}`),e&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(C.MANIFEST_LOADING,{url:t})}startLoad(t=-1){x.log(`startLoad(${t})`),this.started=!0,this.networkControllers.forEach((e=>{e.startLoad(t)}))}stopLoad(){x.log("stopLoad"),this.started=!1,this.networkControllers.forEach((t=>{t.stopLoad()}))}resumeBuffering(){this.started&&this.networkControllers.forEach((t=>{"fragmentLoader"in t&&t.startLoad(-1)}))}pauseBuffering(){this.networkControllers.forEach((t=>{"fragmentLoader"in t&&t.stopLoad()}))}swapAudioCodec(){x.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){x.log("recoverMediaError");const t=this._media;this.detachMedia(),t&&this.attachMedia(t)}removeLevel(t){this.levelController.removeLevel(t)}get levels(){const t=this.levelController.levels;return t||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){x.log(`set currentLevel:${t}`),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){x.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){x.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){x.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){const t=this.levelController.startLevel;return-1===t&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){x.log(`set startLevel:${t}`),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(x.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){(function(t){return ii.indexOf(t)>-1})(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const n=t.length;for(let i=0;i<n;i++)if(t[i].maxBitrate>=e)return i;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:n}=this;let r;if(r=-1===e&&null!=t&&t.length?t.length-1:e,n)for(let i=r;i--;){const e=t[i].attrs["HDCP-LEVEL"];if(e&&e<=n)return i}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(t){var e;return null==(e=this.audioTrackController)?void 0:e.setAudioOption(t)}setSubtitleOption(t){var e;return null==(e=this.subtitleTrackController)||e.setSubtitleOption(t),null}get allAudioTracks(){const t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get allSubtitleTracks(){const t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return!!t&&t.subtitleDisplay}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}io.defaultConfig=void 0},3519:function(t,e,n){t.exports={}},3520:function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,o="~";function l(){}function c(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function h(t,e,n,r,l){if("function"!=typeof n)throw new TypeError("The listener must be a function");var h=new c(n,r||t,l),d=o?o+e:e;return t._events[d]?t._events[d].fn?t._events[d]=[t._events[d],h]:t._events[d].push(h):(t._events[d]=h,t._eventsCount++),t}function d(t,e){0==--t._eventsCount?t._events=new l:delete t._events[e]}function f(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),(new l).__proto__||(o=!1)),f.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(o?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},f.prototype.listeners=function(t){var e=o?o+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,r=n.length,l=new Array(r);i<r;i++)l[i]=n[i].fn;return l},f.prototype.listenerCount=function(t){var e=o?o+t:t,n=this._events[e];return n?n.fn?1:n.length:0},f.prototype.emit=function(t,e,n,r,l,c){var h=o?o+t:t;if(!this._events[h])return!1;var d,i,f=this._events[h],m=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),m){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,r),!0;case 5:return f.fn.call(f.context,e,n,r,l),!0;case 6:return f.fn.call(f.context,e,n,r,l,c),!0}for(i=1,d=new Array(m-1);i<m;i++)d[i-1]=arguments[i];f.fn.apply(f.context,d)}else{var v,y=f.length;for(i=0;i<y;i++)switch(f[i].once&&this.removeListener(t,f[i].fn,void 0,!0),m){case 1:f[i].fn.call(f[i].context);break;case 2:f[i].fn.call(f[i].context,e);break;case 3:f[i].fn.call(f[i].context,e,n);break;case 4:f[i].fn.call(f[i].context,e,n,r);break;default:if(!d)for(v=1,d=new Array(m-1);v<m;v++)d[v-1]=arguments[v];f[i].fn.apply(f[i].context,d)}}return!0},f.prototype.on=function(t,e,n){return h(this,t,e,n,!1)},f.prototype.once=function(t,e,n){return h(this,t,e,n,!0)},f.prototype.removeListener=function(t,e,n,r){var l=o?o+t:t;if(!this._events[l])return this;if(!e)return d(this,l),this;var c=this._events[l];if(c.fn)c.fn!==e||r&&!c.once||n&&c.context!==n||d(this,l);else{for(var i=0,h=[],f=c.length;i<f;i++)(c[i].fn!==e||r&&!c[i].once||n&&c[i].context!==n)&&h.push(c[i]);h.length?this._events[l]=1===h.length?h[0]:h:d(this,l)}return this},f.prototype.removeAllListeners=function(t){var e;return t?(e=o?o+t:t,this._events[e]&&d(this,e)):(this._events=new l,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=o,f.EventEmitter=f,t.exports=f},3521:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:"视频下载错误"},mse:{code:2,msg:"流追加错误"},parse:{code:3,msg:"解析错误"},format:{code:4,msg:"格式错误"},decoder:{code:5,msg:"解码错误"},runtime:{code:6,msg:"语法错误"},timeout:{code:7,msg:"播放超时"},other:{code:8,msg:"其他错误"}},HAVE_NOTHING:"没有关于音频/视频是否就绪的信息",HAVE_METADATA:"音频/视频的元数据已就绪",HAVE_CURRENT_DATA:"关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒",HAVE_FUTURE_DATA:"当前及至少下一帧的数据是可用的",HAVE_ENOUGH_DATA:"可用数据足以开始播放",NETWORK_EMPTY:"音频/视频尚未初始化",NETWORK_IDLE:"音频/视频是活动的且已选取资源，但并未使用网络",NETWORK_LOADING:"浏览器正在下载数据",NETWORK_NO_SOURCE:"未找到音频/视频来源",MEDIA_ERR_ABORTED:"取回过程被用户中止",MEDIA_ERR_NETWORK:"网络错误",MEDIA_ERR_DECODE:"解码错误",MEDIA_ERR_SRC_NOT_SUPPORTED:"不支持的音频/视频格式",REPLAY:"重播",ERROR:"网络连接似乎出现了问题",PLAY_TIPS:"播放",PAUSE_TIPS:"暂停",PLAYNEXT_TIPS:"下一集",DOWNLOAD_TIPS:"下载",ROTATE_TIPS:"旋转",RELOAD_TIPS:"重新载入",FULLSCREEN_TIPS:"进入全屏",EXITFULLSCREEN_TIPS:"退出全屏",CSSFULLSCREEN_TIPS:"进入样式全屏",EXITCSSFULLSCREEN_TIPS:"退出样式全屏",TEXTTRACK:"字幕",PIP:"画中画",SCREENSHOT:"截图",LIVE:"正在直播",OFF:"关闭",OPEN:"开启",MINI_DRAG:"点击按住可拖动视频",MINISCREEN:"小屏幕",REFRESH_TIPS:"请试试",REFRESH:"刷新",FORWARD:"快进中",LIVE_TIP:"直播"}}},3535:function(t,e,n){"use strict";n.d(e,"a",(function(){return Ge}));var r=n(3358),o=n(3421),l=n(3359),c=n(3372),h=n(3368),d=n(3369);function f(){return(new Date).getTime()}var m="loadstart",v="loadeddata",y="firstFrame",T="waitingStart",E="waitingEnd",k="seekStart",S="seekEnd",_=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return t=e.call.apply(e,[this].concat(c)),Object(r.e)(Object(r.a)(t),"_onTimeupdate",(function(){t._state.isTimeUpdate=!0,t._state.autoplayStart&&(h.b.logInfo("[xgLogger]".concat(t.player.playerId," _onTimeupdate")),t._sendFF("onTimeupdate"))})),Object(r.e)(Object(r.a)(t),"_onAutoplayStart",(function(){h.b.logInfo("[xgLogger]".concat(t.player.playerId," _onAutoplayStart")),t._state.autoplayStart=!0,t.vt&&t._sendFF("onAutoplayStart")})),Object(r.e)(Object(r.a)(t),"_onReset",(function(){t._state={autoplayStart:!1,isFFLoading:!1,isTimeUpdate:!1,isFFSend:!1,isLs:!1},t.vt=0,t.pt=0,t.fvt=0,t.newPointTime=f(),t.loadedCostTime=0,t.startCostTime=0,t._isSeeking=!1,t.seekingStart=0,t.waitingStart=0,t.fixedWaitingStart=0,t._isWaiting=!1,t._waitTimer&&l.b.clearTimeout(Object(r.a)(t),t._waitTimer),t._waittTimer&&l.b.clearTimeout(Object(r.a)(t),t._waittTimer),t._waitTimer=null,t._waittTimer=null,t._waitType=0})),Object(r.e)(Object(r.a)(t),"_onSeeking",(function(){t.seekingStart||(t.suspendWaitingStatus("seek"),t.seekingStart=f(),t.emitLog(k,{start:f()}))})),Object(r.e)(Object(r.a)(t),"_onSeeked",(function(){t.suspendSeekingStatus("seeked")})),Object(r.e)(Object(r.a)(t),"_onWaitingLoadStart",(function(){t._isWaiting||t.vt||(t._isWaiting=!0,t.waitingStart=f(),t.fixedWaitingStart=f(),t._waitType=1,t.emitLog(T,{fixedStart:t.fixedWaitingStart,start:t.waitingStart,type:1,endType:"loadstart"}))})),Object(r.e)(Object(r.a)(t),"_onWaiting",(function(){!t._isWaiting&&t.vt&&(t._isWaiting=!0,t.vt?t.seekingStart?t._waitType=2:t._waitType=0:t._waitType=1,t.fixedWaitingStart=f(),t._waitTimer=l.b.setTimeout(Object(r.a)(t),(function(){t._isWaiting&&(t.waitingStart=f(),l.b.clearTimeout(Object(r.a)(t),t._waitTimer),t._waitTimer=null,t._startWaitTimeout(),t.emitLog(T,{fixedStart:t.fixedWaitingStart,start:t.waitingStart,type:t._waitType,endType:2===t._waitType?"seek":"playing"}))}),200))})),Object(r.e)(Object(r.a)(t),"_onError",(function(){t.suspendSeekingStatus("error"),t.suspendWaitingStatus("error")})),Object(r.e)(Object(r.a)(t),"_onPlaying",(function(){t._isWaiting&&t.suspendWaitingStatus("playing")})),t}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this;this._onReset(),this._waitType="firstFrame",this._initOnceEvents(),this.newPointTime=f(),this.loadedCostTime=0,this.startCostTime=0,this.on(c.LOAD_START,(function(){var e=t._state,n=e.autoplayStart,r=e.isFFSend;t.startCostTime=f()-t.newPointTime,h.b.logInfo("[xgLogger]".concat(t.player.playerId," LOAD_START"),"autoplayStart:".concat(n," isFFSend:").concat(r," startCostTime:").concat(t.startCostTime," newPointTime").concat(t.newPointTime)),r||(!e.isLs&&t.emitLog(m,{}),e.isLs=!0,e.isTimeUpdate=!1,e.isFFLoading=!0,t.pt=f(),t.vt=0,t.fvt=0,t._initOnceEvents(),t._onWaitingLoadStart())})),this.on(c.LOADED_DATA,(function(){t.vt=f(),t.fvt=t.vt-t.pt,t.loadedCostTime=t.vt-t.newPointTime;var e=t._state,n=e.isTimeUpdate,r=e.isFFSend,o=e.autoplayStart;h.b.logInfo("[xgLogger]".concat(t.player.playerId," LOADED_DATA"),"fvt:".concat(t.fvt," isTimeUpdate:").concat(t._state.isTimeUpdate," loadedCostTime:").concat(t.loadedCostTime)),(n||o)&&t._sendFF("loadedData"),r||t.emitLog(v,{}),t.suspendWaitingStatus("loadeddata")})),this.on(c.SEEKING,this._onSeeking),this.on(c.SEEKED,this._onSeeked),this.on(c.DESTROY,(function(){t.endState("destroy")})),this.on(c.URL_CHANGE,(function(){t.endState("urlChange"),h.b.logInfo("[xgLogger]".concat(t.player.playerId," URL_CHANGE")),t._state.isFFSend&&t._onReset()})),this.on([c.PLAYING,c.CANPLAY],this._onPlaying),this.on(c.WAITING,this._onWaiting),this.on(c.ERROR,this._onError),this.on(c.RESET,(function(){h.b.logInfo("[xgLogger]".concat(t.player.playerId," RESET")),t.endState("reset"),t._initOnceEvents(),t._onReset()}))}},{key:"_initOnceEvents",value:function(){this.off(c.AUTOPLAY_STARTED,this._onAutoplayStart),this.off(c.TIME_UPDATE,this._onTimeupdate),this.once(c.AUTOPLAY_STARTED,this._onAutoplayStart),this.once(c.TIME_UPDATE,this._onTimeupdate)}},{key:"_sendFF",value:function(t){this.s=f();var e=this._state,n=e.isFFLoading,r=e.isFFSend;h.b.logInfo("[xgLogger]".concat(this.player.playerId," _sendFF"),"".concat(t," fvt:").concat(this.fvt," isFFLoading:").concat(n," !isFFSend:").concat(!r)),this.vt>0&&n&&!r&&(h.b.logInfo("[xgLogger]".concat(this.player.playerId," emitLog_firstFrame"),t),this._state.isFFLoading=!1,this._state.isFFSend=!0,this.emitLog(y,{fvt:this.fvt,costTime:this.fvt,vt:this.vt,startCostTime:this.startCostTime,loadedCostTime:this.loadedCostTime}))}},{key:"_startWaitTimeout",value:function(){var t=this;this._waittTimer&&l.b.clearTimeout(this,this._waittTimer),this._waittTimer=l.b.setTimeout(this,(function(){t.suspendWaitingStatus("timeout"),l.b.clearTimeout(t,t._waittTimer),t._waittTimer=null}),this.config.waitTimeout)}},{key:"endState",value:function(t){this.suspendWaitingStatus(t),this.suspendSeekingStatus(t)}},{key:"suspendSeekingStatus",value:function(t){if(this.seekingStart){var e=f(),n=e-this.seekingStart;this.seekingStart=0,this.emitLog(S,{end:e,costTime:n,endType:t})}}},{key:"suspendWaitingStatus",value:function(t){if(this._waitTimer&&(l.b.clearTimeout(this,this._waitTimer),this._waitTimer=null),this._waittTimer&&(l.b.clearTimeout(this,this._waittTimer),this._waittTimer=null),this._isWaiting=!1,this.waitingStart){var e=f(),n=e-this.waitingStart,r=e-this.fixedWaitingStart,o=this.config.waitTimeout;this._isWaiting=!1,this.waitingStart=0,this.fixedWaitingStart=0,this.emitLog(E,{fixedCostTime:r>o?o:r,costTime:n>o?o:n,type:"loadeddata"===t?1:this._waitType,endType:2===this._waitType?"seek":t})}}},{key:"emitLog",value:function(t,data){var e=this.player;this.emit(c.XGLOG,Object(r.i)({t:f(),host:l.b.getHostFromUrl(e.currentSrc),vtype:e.vtype,eventType:t,currentTime:this.player.currentTime,readyState:e.video.readyState,networkState:e.video.networkState},data))}}],[{key:"pluginName",get:function(){return"xgLogger"}},{key:"defaultConfig",get:function(){return{waitTimeout:1e4}}}]),n}(d.b);function L(){return(new DOMParser).parseFromString('<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78" width="78" height="78">\n  <path fill="#fff" transform="translate(20, 20)" d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>\n</svg>\n',"image/svg+xml").firstChild}var C=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"registerIcons",value:function(){return{replay:L}}},{key:"afterCreate",value:function(){var t=this;d.b.insert(this.icons.replay,this.root,0),this.__handleReplay=this.hook("replayClick",(function(){t.player.replay()}),{pre:function(t){t.preventDefault(),t.stopPropagation()}}),this.bind(".xgplayer-replay",["click","touchend"],this.__handleReplay),this.on(c.ENDED,(function(){if(t.playerConfig.loop||l.b.addClass(t.player.root,"replay"),!t.config.disable){t.show();var path=t.root.querySelector("path");if(path){var e=window.getComputedStyle(path).getPropertyValue("transform");if("string"==typeof e&&e.indexOf("none")>-1)return null;path.setAttribute("transform",e)}}})),this.on(c.PLAY,(function(){t.hide()}))}},{key:"handleReplay",value:function(t){t.preventDefault(),t.stopPropagation(),this.player.replay(),l.b.removeClass(this.player.root,"replay")}},{key:"show",value:function(t){this.config.disable||(this.root.style.display="flex")}},{key:"enable",value:function(){this.config.disable=!1}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){this.unbind(".xgplayer-replay",["click","touchend"],this.__handleReplay)}},{key:"render",value:function(){return'<xg-replay class="xgplayer-replay">\n      <xg-replay-txt class="xgplayer-replay-txt" lang-key="'.concat(this.i18nKeys.REPLAY,'">').concat(this.i18n.REPLAY,"</xg-replay-txt>\n    </xg-replay>")}}],[{key:"pluginName",get:function(){return"replay"}},{key:"defaultConfig",get:function(){return{disable:!1}}}]),n}(d.b),A=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"isEndedShow",get:function(){return this.config.isEndedShow},set:function(t){this.config.isEndedShow=t}},{key:"hide",value:function(){l.b.addClass(this.root,"hide")}},{key:"show",value:function(t){l.b.removeClass(this.root,"hide")}},{key:"beforeCreate",value:function(t){"string"==typeof t.player.config.poster&&(t.config.poster=t.player.config.poster)}},{key:"afterCreate",value:function(){var t=this;this.on(c.ENDED,(function(){t.isEndedShow&&l.b.removeClass(t.root,"hide")})),this.config.hideCanplay?(this.once(c.TIME_UPDATE,(function(){t.onTimeUpdate()})),this.on(c.URL_CHANGE,(function(){l.b.removeClass(t.root,"hide"),l.b.addClass(t.root,"xg-showplay"),t.once(c.TIME_UPDATE,(function(){t.onTimeUpdate()}))}))):this.on(c.PLAY,(function(){l.b.addClass(t.root,"hide")}))}},{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){e.config[n]=t[n]}));var n=this.config.poster;this.update(n)}},{key:"onTimeUpdate",value:function(){var t=this;this.player.currentTime?l.b.removeClass(this.root,"xg-showplay"):this.once(c.TIME_UPDATE,(function(){t.onTimeUpdate()}))}},{key:"update",value:function(t){t&&(this.config.poster=t,this.root.style.backgroundImage="url(".concat(t,")"))}},{key:"getBgSize",value:function(t){var e="";switch(t){case"cover":e="cover";break;case"contain":e="contain";break;case"fixHeight":e="auto 100%";break;default:e=""}return e?"background-size: ".concat(e,";"):""}},{key:"render",value:function(){var t=this.config,e=t.poster,n=t.hideCanplay,r=t.fillMode,o=t.notHidden,l=this.getBgSize(r),style=e?"background-image:url(".concat(e,");").concat(l):l;return'<xg-poster class="xgplayer-poster '.concat(o?"xg-not-hidden":n?"xg-showplay":"",'" style="').concat(style,'">\n    </xg-poster>')}}],[{key:"pluginName",get:function(){return"poster"}},{key:"defaultConfig",get:function(){return{isEndedShow:!0,hideCanplay:!1,notHidden:!1,poster:"",fillMode:"fixWidth"}}}]),n}(d.b),w=n(3476);function O(){return(new DOMParser).parseFromString('<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>\n</svg>\n',"image/svg+xml").firstChild}function R(){return(new DOMParser).parseFromString('<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>\n</svg>\n',"image/svg+xml").firstChild}var D={};function I(t){t?window.clearTimeout(t):Object.keys(D).map((function(t){window.clearTimeout(D[t].id),delete D[t]}))}var x=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),o=e.call(this,t),Object(r.e)(Object(r.a)(o),"onPlayerReset",(function(){o.autoPlayStart=!1;var t="auto"===o.config.mode?"auto-hide":"hide";o.setAttr("data-state","play"),l.b.removeClass(o.root,t),o.show()})),Object(r.e)(Object(r.a)(o),"onAutoplayStart",(function(){if(!o.autoPlayStart){var t="auto"===o.config.mode?"auto-hide":"hide";l.b.addClass(o.root,t),o.autoPlayStart=!0,o.onPlayPause("play")}})),o.autoPlayStart=!1,o}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this,e=this.player,n=this.playerConfig;this.initIcons(),this.once(c.READY,(function(){n&&(n.lang&&"en"===n.lang?l.b.addClass(e.root,"lang-is-en"):"jp"===n.lang&&l.b.addClass(e.root,"lang-is-jp"))})),this.on(c.AUTOPLAY_STARTED,this.onAutoplayStart),n.autoplay||this.show(),this.on(c.AUTOPLAY_PREVENTED,(function(){var e="auto"===t.config.mode?"auto-hide":"hide";t.setAttr("data-state","play"),l.b.removeClass(t.root,e),t.show()})),this.on(c.PLAY,(function(){t.onPlayPause("play")})),this.on(c.PAUSE,(function(){t.onPlayPause("pause")})),this.on(c.RESET,(function(){t.onPlayerReset()})),this.clickHandler=this.hook("startClick",this.switchPausePlay,{pre:function(e){e.cancelable&&e.preventDefault(),e.stopPropagation();var n=t.player.paused;t.emitUserAction(e,"switch_play_pause",{props:"paused",from:n,to:!n})}}),this.bind(["click","touchend"],this.clickHandler)}},{key:"registerIcons",value:function(){return{startPlay:{icon:O,class:"xg-icon-play"},startPause:{icon:R,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild("xg-start-inner",t.startPlay),this.appendChild("xg-start-inner",t.startPause)}},{key:"hide",value:function(){l.b.addClass(this.root,"hide")}},{key:"show",value:function(t){l.b.removeClass(this.root,"hide")}},{key:"focusHide",value:function(){l.b.addClass(this.root,"focus-hide")}},{key:"recover",value:function(){l.b.removeClass(this.root,"focus-hide")}},{key:"switchStatus",value:function(t){t?this.setAttr("data-state",this.player.paused?"pause":"play"):this.setAttr("data-state",this.player.paused?"play":"pause")}},{key:"animate",value:function(t){var e=this;this._animateId=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{start:null,end:null};return D[t]&&window.clearTimeout(D[t].id),D[t]={},n.start&&n.start(),D[t].id=window.setTimeout((function(){n.end&&n.end(),window.clearTimeout(D[t].id),delete D[t]}),e),D[t].id}("pauseplay",400,{start:function(){l.b.addClass(e.root,"interact"),e.show(),e.switchStatus(!0)},end:function(){l.b.removeClass(e.root,"interact"),!t&&e.hide(),e._animateId=null}})}},{key:"endAnimate",value:function(){l.b.removeClass(this.root,"interact"),I(this._animateId),this._animateId=null}},{key:"switchPausePlay",value:function(t){var e=this.player;(t.cancelable&&t.preventDefault(),t.stopPropagation(),e.state<w.a.READY)||(this.player.paused||e.state!==w.a.RUNNING?e.play():e.pause())}},{key:"onPlayPause",value:function(t){var e=this.config,n=this.player;if(n&&!(n.state<w.a.RUNNING)&&this.autoPlayStart){if("show"===e.mode)return this.switchStatus(),void this.show();if("auto"!==e.mode){if(e.isShowPause&&n.paused&&!n.ended||e.isShowEnd&&n.ended)return this.switchStatus(),this.show(),void this.endAnimate();if(e.disableAnimate)return this.switchStatus(),void this.hide();if("play"===t)this.autoPlayStart?this.animate():this.hide();else{if(!this.autoPlayStart||n.ended)return;this.animate()}}else this.switchStatus()}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.clickHandler),I(this._animateId)}},{key:"render",value:function(){var t=this.playerConfig.autoplay?"auto"===this.config.mode?"auto-hide":"hide":"";return'\n    <xg-start class="xgplayer-start '.concat(t,'">\n    <xg-start-inner></xg-start-inner>\n    </xg-start>')}}],[{key:"pluginName",get:function(){return"start"}},{key:"defaultConfig",get:function(){return{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"}}}]),n}(d.b),P=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"render",value:function(){var t=this.config.innerHtml,e=l.b.createDom("xg-enter","",{},"xgplayer-enter");if(t&&t instanceof window.HTMLElement)e.appendChild(t);else if(t&&"string"==typeof t)e.innerHTML=t;else{for(var n="",i=1;i<=12;i++)n+='<div class="xgplayer-enter-bar'.concat(i,'"></div>');e.innerHTML='<div class="xgplayer-enter-spinner">'.concat(n,"</div>")}return e}}],[{key:"pluginName",get:function(){return"enter"}},{key:"defaultConfig",get:function(){return{innerHtml:"",logo:""}}}]),n}(d.b);function M(t,e,n){try{return' <div class="xg-tips '.concat(n?"hide":" ",'" lang-key="').concat(t.i18nKeys[e],'">\n    ').concat(t.i18n[e],"\n    </div>")}catch(t){return'<div class="xg-tips hide"></div>'}}var F=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"afterCreate",value:function(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}},{key:"getMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"exitMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var t="MINISCREEN";return'\n      <xg-icon class="xgplayer-miniicon">\n      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="'.concat(this.i18nKeys[t],'">').concat(this.i18n[t],"</span></div>\n      </xg-icon>")}}],[{key:"pluginName",get:function(){return"miniscreenIcon"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_RIGHT,index:10}}}]),n}(d.b),N=n(3520),j=n.n(N);function U(t){var e=parseFloat(t);return-1===t.indexOf("%")&&!Number.isNaN(e)&&e}var B=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],$=B.length;function H(t){if("string"==typeof t&&(t=document.querySelector(t)),t&&"object"===Object(r.l)(t)&&t.nodeType){var style=function(t){return window.getComputedStyle(t)}(t);if("none"===style.display)return function(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},i=0;i<$;i++)t[B[i]]=0;return t}();var e={};e.width=t.offsetWidth,e.height=t.offsetHeight;for(var n=e.isBorderBox="border-box"===style.boxSizing,i=0;i<$;i++){var o=B[i],l=style[o],c=parseFloat(l);e[o]=Number.isNaN(c)?0:c}var h=e.paddingLeft+e.paddingRight,d=e.paddingTop+e.paddingBottom,f=e.marginLeft+e.marginRight,m=e.marginTop+e.marginBottom,v=e.borderLeftWidth+e.borderRightWidth,y=e.borderTopWidth+e.borderBottomWidth,T=n,E=U(style.width);!1!==E&&(e.width=E+(T?0:h+v));var k=U(style.height);return!1!==k&&(e.height=k+(T?0:d+y)),e.innerWidth=e.width-(h+v),e.innerHeight=e.height-(d+y),e.outerWidth=e.width+f,e.outerHeight=e.height+m,e}}function G(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(n.identifier===e)return n}}var K="dragStart",V="dragMove",W="dragEnded",Y={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},z=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(r.b)(this,n),(o=e.call(this)).isEnabled=!0,o.isDragging=!1,o.isDown=!1,o.position={},o.downPoint={},o.dragPoint={x:0,y:0},o.startPos={x:0,y:0},o._root=t instanceof Element?t:document.querySelector(t),o._handlerDom=l.handle instanceof Element?l.handle:document.querySelector(l.handle),o._root&&o._handlerDom?(o._bindStartEvent(),o):Object(r.j)(o)}return Object(r.c)(n,[{key:"_bindStartEvent",value:function(){var t=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),Y[this._startKey].map((function(e){t["on".concat(e)]=t["on".concat(e)].bind(t)}))}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(t){var e=this;if(t){var n=Y[this._startKey];n.map((function(t){window.addEventListener(t,e["on".concat(t)])})),this._boundPointerEvents=n}}},{key:"_unbindPostStartEvents",value:function(){var t=this;this._boundPointerEvents&&(this._boundPointerEvents.map((function(e){window.removeEventListener(e,t["on".concat(e)])})),delete this._boundPointerEvents)}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(t){this.onUp()}},{key:"animate",value:function(){var t=this;this.isDragging&&(this.positionDrag(),window.requestAnimationFrame((function(){t.animate()})))}},{key:"positionDrag",value:function(){var t="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=t,this._root.style.webKitTransform=t}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(t){this.dragStart(t,t)}},{key:"onmousemove",value:function(t){this.dragMove(t,t)}},{key:"onmouseup",value:function(t){this.dragEnd(t,t)}},{key:"ontouchstart",value:function(t){var e=t.changedTouches[0];this.dragStart(t,e),this.touchIdentifier=void 0!==e.pointerId?e.pointerId:e.identifier,t.preventDefault()}},{key:"ontouchmove",value:function(t){var e=G(t.changedTouches,this.touchIdentifier);e&&this.dragMove(t,e)}},{key:"ontouchend",value:function(t){var e=G(t.changedTouches,this.touchIdentifier);e&&this.dragEnd(t,e),t.preventDefault()}},{key:"ontouchcancel",value:function(t){var e=G(t.changedTouches,this.touchIdentifier);e&&this.dragCancel(t,e)}},{key:"dragStart",value:function(t,e){if(this._root&&!this.isDown&&this.isEnabled){this.downPoint=e,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var n=H(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-n.height,this.startPos.maxX=window.innerWidth-n.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(t)}}},{key:"dragRealStart",value:function(t,e){this.isDragging=!0,this.animate(),this.emit(K,this.startPos)}},{key:"dragEnd",value:function(t,e){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(W)),this.presetInfo())}},{key:"_dragPointerMove",value:function(t,e){var n={x:e.pageX-this.downPoint.pageX,y:e.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(n)&&this.dragRealStart(t,e),n}},{key:"dragMove",value:function(t,e){if(t=t||window.event,this.isDown){var n=this.startPos,r=n.x,o=n.y,l=this._dragPointerMove(t,e),c=l.x,h=l.y;c=this.checkContain("x",c,r),h=this.checkContain("y",h,o),this.position.x=r+c,this.position.y=o+h,this.dragPoint.x=c,this.dragPoint.y=h,this.emit(V,this.position)}}},{key:"dragCancel",value:function(t,e){this.dragEnd(t,e)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(t){return Math.abs(t.x)>3||Math.abs(t.y)>3}},{key:"checkContain",value:function(t,e,n){return e+n<0?0-n:"x"===t&&e+n>this.startPos.maxX?this.startPos.maxX-n:"y"===t&&e+n>this.startPos.maxY?this.startPos.maxY-n:e}},{key:"_getPosition",value:function(){var style=window.getComputedStyle(this._root),t=this._getPositionCoord(style.left,"width"),e=this._getPositionCoord(style.top,"height");this.position.x=Number.isNaN(t)?0:t,this.position.y=Number.isNaN(e)?0:e,this._addTransformPosition(style)}},{key:"_addTransformPosition",value:function(style){var t=style.transform;if(0===t.indexOf("matrix")){var e=t.split(","),n=0===t.indexOf("matrix3d")?12:4,r=parseInt(e[n],10),o=parseInt(e[n+1],10);this.position.x+=r,this.position.y+=o}}},{key:"_getPositionCoord",value:function(t,e){if(-1!==t.indexOf("%")){var n=H(this._root.parentNode);return n?parseFloat(t)/100*n[e]:0}return parseInt(t,10)}}]),n}(j.a),X=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;Object(r.b)(this,n),o=e.call(this,t),Object(r.e)(Object(r.a)(o),"onCancelClick",(function(t){o.exitMini(),o.isClose=!0})),Object(r.e)(Object(r.a)(o),"onCenterClick",(function(t){var e=Object(r.a)(o).player;e.paused?e.play():e.pause()})),Object(r.e)(Object(r.a)(o),"onScroll",(function(t){if(!(!window.scrollY&&0!==window.scrollY||Math.abs(window.scrollY-o.pos.scrollY)<50)){var e=parseInt(l.b.getCss(o.player.root,"height"));e+=o.config.scrollTop,o.pos.scrollY=window.scrollY,window.scrollY>e+5?!o.isMini&&!o.isClose&&o.getMini():window.scrollY<=e&&(o.isMini&&o.exitMini(),o.isClose=!1)}})),o.isMini=!1,o.isClose=!1;var c=Object(r.a)(o).config;return o.pos={left:c.left<0?window.innerWidth-c.width-20:c.left,top:c.top<0?window.innerHeight-c.height-20:c.top,height:o.config.height,width:o.config.width,scrollY:window.scrollY||0},o.lastStyle=null,o}return Object(r.c)(n,[{key:"beforeCreate",value:function(t){"boolean"==typeof t.player.config.mini&&(t.config.isShowIcon=t.player.config.mini)}},{key:"afterCreate",value:function(){var t=this;this.initIcons(),this.on(c.PAUSE,(function(){t.setAttr("data-state","pause")})),this.on(c.PLAY,(function(){t.setAttr("data-state","play")}))}},{key:"onPluginsReady",value:function(){var t=this,e=this.player;if(!this.config.disable){if(this.config.isShowIcon){var n={config:{onClick:function(){t.getMini()}}};e.controls.registerPlugin(F,n,F.pluginName)}var r=l.b.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",r,this.onCancelClick),this.bind(".play-icon",r,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new z(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:O,class:"xg-icon-play"},pause:{icon:R,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild(".play-icon",t.play),this.appendChild(".play-icon",t.pause)}},{key:"getMini",value:function(){var t=this;if(!this.isMini){var e=this.player,n=this.playerConfig,r=this.config.target||this.player.root;this.lastStyle={},l.b.addClass(e.root,"xgplayer-mini"),["width","height","top","left"].map((function(e){t.lastStyle[e]=r.style[e],r.style[e]="".concat(t.pos[e],"px")})),n.fluid&&(r.style["padding-top"]=""),this.emit(c.MINI_STATE_CHANGE,!0),e.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var t=this;if(!this.isMini)return!1;var e=this.player,n=this.playerConfig,r=this.config.target||this.player.root;l.b.removeClass(e.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map((function(e){r.style[e]=t.lastStyle[e]})),this.lastStyle=null,n.fluid&&(e.root.style.width="100%",e.root.style.height="0",e.root.style["padding-top"]="".concat(100*n.height/n.width,"%")),this.emit(c.MINI_STATE_CHANGE,!1),this.isMini=e.isMini=!1}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var t=l.b.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",t,this.onCancelClick),this.unbind(".play-icon",t,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return'\n      <xg-mini-layer class="xg-mini-layer">\n      <xg-mini-header class="xgplayer-mini-header">\n      '.concat(M(this,"MINI_DRAG",this.playerConfig.isHideTips),'\n      </xg-mini-header>\n      <div class="mini-cancel-btn">\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">\n          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>\n        </svg>\n      </div>\n      <div class="play-icon">\n      </div>\n      </xg-mini-layer>')}}],[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}]),n}(d.b),Q=n(3437),J=(n(3450),n(3492)),Z={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},tt=["videoClick","videoDbClick"],et=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,l=new Array(o),h=0;h<o;h++)l[h]=arguments[h];return t=e.call.apply(e,[this].concat(l)),Object(r.e)(Object(r.a)(t),"onMouseMove",(function(e){var n=Object(r.a)(t),o=n.player,l=n.playerConfig;o.isActive||(o.focus({autoHide:!l.closeDelayBlur}),!l.closeFocusVideoFocus&&o.media.focus())})),Object(r.e)(Object(r.a)(t),"onMouseEnter",(function(e){var n=Object(r.a)(t),o=n.playerConfig,l=n.player;!o.closeFocusVideoFocus&&l.media.focus(),o.closeDelayBlur?l.focus({autoHide:!1}):l.focus(),t.emit(c.ENTER_PLAYER)})),Object(r.e)(Object(r.a)(t),"onMouseLeave",(function(e){var n=t.playerConfig,r=n.closePlayerBlur,o=n.leavePlayerTime,l=n.closeDelayBlur;r||l||(o?t.player.focus({autoHide:!0,delay:o}):t.player.blur({ignorePaused:!0})),t.emit(c.LEAVE_PLAYER)})),Object(r.e)(Object(r.a)(t),"onVideoClick",(function(e){var n=Object(r.a)(t),o=n.player,l=n.playerConfig;e.target&&l.closeVideoClick||e.target!==o.root&&e.target!==o.media&&e.target!==o.innerContainer&&e.target!==o.media.__canvas||(e.preventDefault(),l.closeVideoStopPropagation||e.stopPropagation(),t._clickCount++,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),t.clickTimer=setTimeout((function(){t._clickCount&&(t._clickCount--,Object(J.f)(Object(r.a)(t),tt[0],(function(e,data){t.switchPlayPause(data.e)}),{e:e,paused:o.paused}),clearTimeout(t.clickTimer),t.clickTimer=null)}),300))})),Object(r.e)(Object(r.a)(t),"onVideoDblClick",(function(e){var n=Object(r.a)(t),o=n.player,l=n.playerConfig;l.closeVideoDblclick||!e.target||e.target!==o.media&&e.target!==o.media.__canvas||(!l.closeVideoClick&&t._clickCount<2?t._clickCount=0:(t._clickCount=0,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),e.preventDefault(),e.stopPropagation(),Object(J.f)(Object(r.a)(t),tt[1],(function(e,data){t.emitUserAction(data.e,"switch_fullscreen",{props:"fullscreen",from:o.fullscreen,to:!o.fullscreen}),o.fullscreen?o.exitFullscreen():o.getFullscreen()}),{e:e,fullscreen:o.fullscreen})))})),t}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this;this._clickCount=0,tt.map((function(e){t.__hooks[e]=null})),"mobile"===this.playerConfig.isMobileSimulateMode||"mobile"===o.a.device&&!o.a.os.isIpad||this.initEvents()}},{key:"initEvents",value:function(){var t=this,e=this.player,n=e.media,r=e.root,o=this.playerConfig.enableContextmenu;r&&r.addEventListener("click",this.onVideoClick,!1),r&&r.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(Z).map((function(e){r.addEventListener(e,t[Z[e]],!1)})),!o&&n&&n.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"switchPlayPause",value:function(t){var e=this.player;this.emitUserAction(t,"switch_play_pause",{props:"paused",from:e.paused,to:!e.paused}),e.ended?e.duration!==1/0&&e.duration>0&&e.replay():e.paused?e.play():e.pause()}},{key:"onContextmenu",value:function(t){(t=t||window.event).preventDefault&&t.preventDefault(),t.stopPropagation?t.stopPropagation():(t.returnValue=!1,t.cancelBubble=!0)}},{key:"destroy",value:function(){var t=this,e=this.player,video=e.video,n=e.root;this.clickTimer&&clearTimeout(this.clickTimer),n.removeEventListener("click",this.onVideoClick,!1),n.removeEventListener("dblclick",this.onVideoDblClick,!1),video.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(Z).map((function(e){n.removeEventListener(e,t[Z[e]],!1)}))}}],[{key:"pluginName",get:function(){return"pc"}},{key:"defaultConfig",get:function(){return{}}}]),n}(Q.a),it="press",nt="pressend",st="doubleclick",at="click",ot="touchmove",lt="touchstart",ct="touchend",ut={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},ht={start:"mousedown",end:"mouseup",move:"mousemove",cancel:"mouseleave"};function ft(t){return t&&t.length>0?t[t.length-1]:null}var gt=function(){function t(e){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{eventType:"touch"};Object(r.b)(this,t),Object(r.e)(this,"onTouchStart",(function(t){var e=n._pos,r=n.root,o=ft(t.touches);e.x=o?parseInt(o.pageX,10):t.pageX,e.y=o?parseInt(o.pageX,10):t.pageX,e.start=!0,n.__setPress(t),r.addEventListener(n.events.end,n.onTouchEnd),r.addEventListener(n.events.cancel,n.onTouchCancel),r.addEventListener(n.events.move,n.onTouchMove),n.trigger(lt,t)})),Object(r.e)(this,"onTouchCancel",(function(t){n.onTouchEnd(t)})),Object(r.e)(this,"onTouchEnd",(function(t){var e=n._pos,r=n.root;n.__clearPress(),r.removeEventListener(n.events.cancel,n.onTouchCancel),r.removeEventListener(n.events.end,n.onTouchEnd),r.removeEventListener(n.events.move,n.onTouchMove),t.moving=e.moving,t.press=e.press,e.press&&n.trigger(nt,t),n.trigger(ct,t),!e.press&&!e.moving&&n.__setDb(t),e.press=!1,e.start=!1,e.moving=!1})),Object(r.e)(this,"onTouchMove",(function(t){var e=n._pos,r=n.config,o=ft(t.touches),l=o?parseInt(o.pageX,10):t.pageX,c=o?parseInt(o.pageY,10):t.pageX,h=l-e.x,d=c-e.y;Math.abs(d)<r.miniStep&&Math.abs(h)<r.miniStep||(n.__clearPress(),e.press&&n.trigger(nt,t),e.press=!1,e.moving=!0,n.trigger(ot,t))})),this._pos={moving:!1,start:!1,x:0,y:0},this.config={pressDelay:600,dbClickDelay:200,disablePress:!1,disableDbClick:!1,miniStep:2,needPreventDefault:!0},Object.keys(o).map((function(t){n.config[t]=o[t]})),this.root=e,this.events="mouse"===o.eventType?ht:ut,this.pressIntrvalId=null,this.dbIntrvalId=null,this.__handlers={},this._initEvent()}return Object(r.c)(t,[{key:"_initEvent",value:function(){this.root.addEventListener(this.events.start,this.onTouchStart)}},{key:"__setPress",value:function(t){var e=this,n=this.config;this.pressIntrvalId&&this.__clearPress(),this.pressIntrvalId=setTimeout((function(){e.trigger(it,t),e._pos.press=!0,e.__clearPress()}),n.pressDelay)}},{key:"__clearPress",value:function(){window.clearTimeout(this.pressIntrvalId),this.pressIntrvalId=null}},{key:"__setDb",value:function(t){var e=this,n=this.config;if(this.dbIntrvalId)return this.__clearDb(),void this.trigger(st,t);this.dbIntrvalId=setTimeout((function(){e.__clearDb(),e._pos.start||e._pos.press||e._pos.moving||e.trigger(at,t)}),n.dbClickDelay)}},{key:"__clearDb",value:function(){clearTimeout(this.dbIntrvalId),this.dbIntrvalId=null}},{key:"on",value:function(t,e){this.__handlers[t]||(this.__handlers[t]=[]),this.__handlers[t].push(e)}},{key:"off",value:function(t,e){if(this.__handlers[t]){for(var n=this.__handlers[t],r=-1,i=0;i<n.length;i++)if(n[i]===e){r=i;break}r>=0&&this.__handlers[t].splice(r,1)}}},{key:"trigger",value:function(t,e){this.__handlers[t]&&this.__handlers[t].map((function(n){try{n(e)}catch(e){console.error("trigger>>:".concat(t),e)}}))}},{key:"destroy",value:function(){var t=this,map={touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"};Object.keys(map).forEach((function(e){t.root.removeEventListener(e,t[map[e]])}))}}]),t}();function pt(){return(new DOMParser).parseFromString('<svg width="20" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg"\n  xmlns:xlink="http://www.w3.org/1999/xlink">\n  <path opacity="0.54"\n    d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z"\n    fill="white" />\n  <path transform="translate(5 0)" d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z" fill="white"/>\n</svg>',"image/svg+xml").firstChild}var mt="auto",vt="seeking",yt="playbackrate",bt=["videoClick","videoDbClick"],Tt=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),o=e.call(this,t),Object(r.e)(Object(r.a)(o),"onTouchStart",(function(t){var e=Object(r.a)(o),n=e.player,c=e.config,h=e.pos,d=e.playerConfig,f=o.getTouche(t);if(f&&!c.disableGesture&&o.duration>0&&!n.ended){h.isStart=!0,o.timer&&clearTimeout(o.timer),l.b.checkIsFunction(d.disableSwipeHandler)&&d.disableSwipeHandler(),o.find(".xg-dur").innerHTML=l.b.format(o.duration);var rect=o.root.getBoundingClientRect();90===n.rotateDeg?(h.top=rect.left,h.left=rect.top,h.width=rect.height,h.height=rect.width):(h.top=rect.top,h.left=rect.left,h.width=rect.width,h.height=rect.height);var m=parseInt(f.pageX-h.left,10),v=parseInt(f.pageY-h.top,10);h.x=90===n.rotateDeg?v:m,h.y=90===n.rotateDeg?m:v,h.scopeL=c.scopeL*h.width,h.scopeR=(1-c.scopeR)*h.width,h.scopeM1=h.width*(1-c.scopeM)/2,h.scopeM2=h.width-h.scopeM1}})),Object(r.e)(Object(r.a)(o),"onTouchMove",(function(t){var e=o.getTouche(t),n=Object(r.a)(o),l=n.pos,c=n.config,h=n.player;if(e&&!c.disableGesture&&o.duration&&l.isStart){var d=c.miniMoveStep,f=c.hideControlsActive,m=parseInt(e.pageX-l.left,10),v=parseInt(e.pageY-l.top,10),y=90===h.rotateDeg?v:m,T=90===h.rotateDeg?m:v;if(Math.abs(y-l.x)>d||Math.abs(T-l.y)>d){var E=y-l.x,k=T-l.y,S=l.scope;if(-1===S&&(0===(S=o.checkScope(y,T,E,k,l))&&(f?h.blur():h.focus({autoHide:!1}),!l.time&&(l.time=parseInt(1e3*h.currentTime,10)+1e3*o.timeOffset)),l.scope=S),-1===S||S>0&&!c.gestureY||0===S&&!c.gestureX)return;o.executeMove(E,k,S,l.width,l.height),l.x=y,l.y=T}}})),Object(r.e)(Object(r.a)(o),"onTouchEnd",(function(t){var e=Object(r.a)(o),n=e.player,c=e.pos,h=e.playerConfig;if(setTimeout((function(){n.getPlugin("progress")&&n.getPlugin("progress").resetSeekState()}),10),c.isStart){c.scope>-1&&t.cancelable&&t.preventDefault();var d=o.config,f=d.disableGesture,m=d.gestureX;!f&&m?o.endLastMove(c.scope):c.time=0,c.scope=-1,o.resetPos(),l.b.checkIsFunction(h.enableSwipeHandler)&&h.enableSwipeHandler(),o.changeAction(mt)}})),Object(r.e)(Object(r.a)(o),"onRootTouchMove",(function(t){!o.config.disableGesture&&o.config.gestureX&&o.checkIsRootTarget(t)&&(t.stopPropagation(),o.pos.isStart?o.onTouchMove(t):o.onTouchStart(t))})),Object(r.e)(Object(r.a)(o),"onRootTouchEnd",(function(t){o.pos.scope>-1&&o.onTouchEnd(t)})),o.pos={isStart:!1,x:0,y:0,time:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1},o.timer=null,o}return Object(r.c)(n,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"registerIcons",value:function(){return{seekTipIcon:{icon:pt,class:"xg-seek-pre"}}}},{key:"afterCreate",value:function(){var t=this;bt.map((function(e){t.__hooks[e]=null}));var e=this.playerConfig,n=this.config,r=this.player;!0===e.closeVideoDblclick&&(n.closedbClick=!0),this.resetPos(),l.b.isUndefined(e.disableGesture)||(n.disableGesture=!!e.disableGesture),this.appendChild(".xg-seek-icon",this.icons.seekTipIcon),this.xgMask=l.b.createDom("xg-mask","",{},"xgmask"),r.root.appendChild(this.xgMask),this.initCustomStyle(),this.registerThumbnail();var o="mouse"===this.domEventType?"mouse":"touch";this.touch=new gt(this.root,{eventType:o,needPreventDefault:!this.config.disableGesture}),this.root.addEventListener("contextmenu",(function(t){t.preventDefault()})),r.root.addEventListener("touchmove",this.onRootTouchMove,!0),r.root.addEventListener("touchend",this.onRootTouchEnd,!0),r.root.addEventListener("touchcancel",this.onRootTouchEnd,!0);var h=this.player.controls;h&&h.center&&(h.center.addEventListener("touchmove",this.onRootTouchMove,!0),h.center.addEventListener("touchend",this.onRootTouchEnd,!0),h.center.addEventListener("touchcancel",this.onRootTouchEnd,!0)),this.on(c.DURATION_CHANGE,(function(){var e=t.player,n=t.config;1e3*e.duration<n.moveDuration&&(n.moveDuration=1e3*e.duration)})),this.on([c.CANPLAY,c.ENDED],(function(){var e=t.pos,time=e.time;!e.isStart&&time>0&&(t.pos.time=0)}));var d={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",press:"onPress",pressend:"onPressEnd",click:"onClick",doubleclick:"onDbClick"};if(Object.keys(d).map((function(e){t.touch.on(e,(function(n){t[d[e]](n)}))})),!n.disableActive){var f=r.plugins.progress;f&&(f.addCallBack("dragmove",(function(data){t.activeSeekNote(data.currentTime,data.forward)})),["dragend","click"].forEach((function(e){f.addCallBack(e,(function(){t.changeAction(mt)}))})))}}},{key:"registerThumbnail",value:function(){var t=this.player.plugins.thumbnail;if(t&&t.usable){this.thumbnail=t.createThumbnail(null,"mobile-thumbnail");var e=this.find(".time-preview");e.insertBefore(this.thumbnail,e.children[0])}}},{key:"initCustomStyle",value:function(){var t=(this.playerConfig||{}).commonStyle,e=t.playedColor,n=t.progressColor,r=t.timePreviewStyle,o=t.curTimeColor,c=t.durationColor;if(e&&(this.find(".xg-curbar").style.backgroundColor=e),n&&(this.find(".xg-bar").style.backgroundColor=n),r){var h=this.find(".time-preview");Object.keys(r).forEach((function(t){h.style[t]=r[t]}))}var d=o||e,f=c;d&&(this.find(".xg-cur").style.color=d),f&&(this.find(".xg-dur").style.color=f),this.config.disableTimeProgress&&l.b.addClass(this.find(".xg-timebar"),"hide")}},{key:"resetPos",value:function(){var t=this;this.pos?(this.pos.isStart=!1,this.pos.scope=-1,["x","y","width","height","scopeL","scopeR","scopeM1","scopeM2"].map((function(e){t.pos[e]=0}))):this.pos={isStart:!1,x:0,y:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1,time:0}}},{key:"changeAction",value:function(t){var e=this.player;this.root.setAttribute("data-xg-action",t);var n=e.plugins.start;n&&n.recover()}},{key:"getTouche",value:function(t){this.player.rotateDeg;var e=t.touches&&t.touches.length>0?t.touches[t.touches.length-1]:t;return{pageX:e.pageX,pageY:e.pageY}}},{key:"checkScope",value:function(t,e,n,r,o){var l=o.width,c=-1;if(t<0||t>l)return c;var h=0===r?Math.abs(n):Math.abs(n/r);return Math.abs(n)>0&&h>=1.73&&t>o.scopeM1&&t<o.scopeM2?c=0:(0===Math.abs(n)||h<=.57)&&(c=t<o.scopeL?1:t>o.scopeR?2:3),c}},{key:"executeMove",value:function(t,e,n,r,l){switch(n){case 0:this.updateTime(t/r*this.config.scopeM);break;case 1:this.updateBrightness(e/l);break;case 2:o.a.os.isIos||this.updateVolume(e/l)}}},{key:"endLastMove",value:function(t){var e=this,n=this.pos,r=this.player,o=this.config,time=(n.time-this.timeOffset)/1e3;if(0===t)r.seek(Number(time).toFixed(1)),o.hideControlsEnd?r.blur():r.focus(),this.timer=setTimeout((function(){e.pos.time=0}),500);this.changeAction(mt)}},{key:"checkIsRootTarget",value:function(t){var e=this.player.plugins||{};return(!e.progress||!e.progress.root.contains(t.target))&&(e.start&&e.start.root.contains(t.target)||e.controls&&e.controls.root.contains(t.target))}},{key:"sendUseAction",value:function(t){var e=this.player.paused;this.emitUserAction(t,"switch_play_pause",{prop:"paused",from:e,to:!e})}},{key:"clickHandler",value:function(t){var e=this.player,n=this.config,r=this.playerConfig;e.state<w.a.RUNNING?r.closeVideoClick||(this.sendUseAction(l.b.createEvent("click")),e.play()):!n.closedbClick||r.closeVideoClick?e.isActive?e.blur():e.focus():r.closeVideoClick||((e.isActive||n.focusVideoClick)&&(this.sendUseAction(l.b.createEvent("click")),this.switchPlayPause()),e.focus())}},{key:"dbClickHandler",value:function(t){var e=this.config,n=this.player;!e.closedbClick&&n.state>=w.a.RUNNING&&(this.sendUseAction(l.b.createEvent("dblclick")),this.switchPlayPause())}},{key:"onClick",value:function(t){var e=this,n=this.player;Object(J.f)(this,bt[0],(function(t,data){e.clickHandler(data.e)}),{e:t,paused:n.paused})}},{key:"onDbClick",value:function(t){var e=this,n=this.player;Object(J.f)(this,bt[1],(function(t,data){e.dbClickHandler(data.e)}),{e:t,paused:n.paused})}},{key:"onPress",value:function(t){var e=this.pos,n=this.config,r=this.player;n.disablePress||(e.rate=this.player.playbackRate,this.emitUserAction("press","change_rate",{prop:"playbackRate",from:r.playbackRate,to:n.pressRate}),r.playbackRate=n.pressRate,this.changeAction(yt))}},{key:"onPressEnd",value:function(t){var e=this.pos,n=this.config,r=this.player;n.disablePress||(this.emitUserAction("pressend","change_rate",{prop:"playbackRate",from:r.playbackRate,to:e.rate}),r.playbackRate=e.rate,e.rate=1,this.changeAction(mt))}},{key:"updateTime",value:function(t){var e=this.player,n=this.config,r=this.player.duration;t=Number(t.toFixed(4));var time=parseInt(t*n.moveDuration,10)+this.timeOffset;time=(time+=this.pos.time)<0?0:time>1e3*r?1e3*r-200:time,e.getPlugin("time")&&e.getPlugin("time").updateTime(time/1e3),e.getPlugin("progress")&&e.getPlugin("progress").updatePercent(time/1e3/this.duration,!0),this.activeSeekNote(time/1e3,t>0),n.isTouchingSeek&&e.seek(Number((time-this.timeOffset)/1e3).toFixed(1)),this.pos.time=time}},{key:"updateVolume",value:function(t){this.player.rotateDeg&&(t=-t);var e=this.player,n=this.pos;if(t=parseInt(100*t,10),n.volume+=t,!(Math.abs(n.volume)<10)){var r=parseInt(10*e.volume,10)-parseInt(n.volume/10,10);r=r>10?10:r<1?0:r,e.volume=r/10,n.volume=0}}},{key:"updateBrightness",value:function(t){var e=this.pos,n=this.config,r=this.xgMask;if(n.darkness){this.player.rotateDeg&&(t=-t);var o=e.light+.8*t;o=o>n.maxDarkness?n.maxDarkness:o<0?0:o,r&&(r.style.backgroundColor="rgba(0,0,0,".concat(o,")")),e.light=o}}},{key:"activeSeekNote",value:function(time){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=this.player,n=this.config,r=!(this.duration!==1/0&&this.duration>0);if(time&&"number"==typeof time&&!r&&!n.disableActive){time<0?time=0:time>e.duration&&(time=e.duration-.2),this.changeAction(vt);var o=e.plugins.start;o&&o.focusHide(),this.find(".xg-dur").innerHTML=l.b.format(this.duration),this.find(".xg-cur").innerHTML=l.b.format(time),this.find(".xg-curbar").style.width="".concat(time/this.duration*100,"%"),t?l.b.removeClass(this.find(".xg-seek-show"),"xg-back"):l.b.addClass(this.find(".xg-seek-show"),"xg-back"),this.updateThumbnails(time)}}},{key:"updateThumbnails",value:function(time){var t=this.player.plugins.thumbnail;t&&t.usable&&this.thumbnail&&t.update(this.thumbnail,time,160,90)}},{key:"switchPlayPause",value:function(){var t=this.player;if(t.state<w.a.ATTACHED)return!1;t.ended||(t.paused?t.play():t.pause())}},{key:"disableGesture",value:function(){this.config.disableGesture=!1}},{key:"enableGesture",value:function(){this.config.disableGesture=!0}},{key:"destroy",value:function(){var t=this.player;this.timer&&clearTimeout(this.timer),this.thumbnail=null,t.root.removeChild(this.xgMask),this.xgMask=null,this.touch&&this.touch.destroy(),this.touch=null,t.root.removeEventListener("touchmove",this.onRootTouchMove,!0),t.root.removeEventListener("touchend",this.onRootTouchEnd,!0),t.root.removeEventListener("touchcancel",this.onRootTouchEnd,!0);var e=this.player.controls;e&&e.center&&(e.center.removeEventListener("touchmove",this.onRootTouchMove,!0),e.center.removeEventListener("touchend",this.onRootTouchEnd,!0),e.center.removeEventListener("touchcancel",this.onRootTouchEnd,!0))}},{key:"render",value:function(){var t="normal"!==this.config.gradient?"gradient ".concat(this.config.gradient):"gradient";return'\n     <xg-trigger class="trigger">\n     <div class="'.concat(t,'"></div>\n        <div class="time-preview">\n            <div class="xg-seek-show ').concat(this.config.disableSeekIcon?" hide-seek-icon":"",'">\n              <i class="xg-seek-icon"></i>\n              <span class="xg-cur">00:00</span>\n              <span class="xg-separator">/</span>\n              <span class="xg-dur">00:00</span>\n            </div>\n              <div class="xg-bar xg-timebar">\n                <div class="xg-curbar"></div>\n              </div>\n        </div>\n        <div class="xg-playbackrate xg-top-note">\n            <span><i>').concat(this.config.pressRate,"X</i>").concat(this.i18n.FORWARD,"</span>\n        </div>\n     </xg-trigger>\n    ")}}],[{key:"pluginName",get:function(){return"mobile"}},{key:"defaultConfig",get:function(){return{index:0,disableGesture:!1,gestureX:!0,gestureY:!0,gradient:"normal",isTouchingSeek:!1,miniMoveStep:5,miniYPer:5,scopeL:.25,scopeR:.25,scopeM:.9,pressRate:2,darkness:!0,maxDarkness:.8,disableActive:!1,disableTimeProgress:!1,hideControlsActive:!1,hideControlsEnd:!1,moveDuration:36e4,closedbClick:!1,disablePress:!0,disableSeekIcon:!1,focusVideoClick:!1}}}]),n}(d.b);function Et(t){var e=t.tagName;return!("INPUT"!==e&&"TEXTAREA"!==e&&!t.isContentEditable)}var kt=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return t=e.call.apply(e,[this].concat(l)),Object(r.e)(Object(r.a)(t),"onBodyKeyDown",(function(e){if(t.player){var n=e||window.event,o=n.keyCode,l=Object(r.a)(t),c=l._keyState,h=l.player,d=t.config,f=d.disable,m=d.disableBodyTrigger,v=d.isIgnoreUserActive;f||m||!h.isUserActive&&!v||Et(n.target)||!t.checkIsVisible()||n.metaKey||n.altKey||n.ctrlKey?c.isBodyKeyDown=!1:(e.repeat||c.isKeyDown||((n.target===document.body||t.config.isGlobalTrigger&&!Et(n.target))&&t.checkCode(o,!0)&&(c.isBodyKeyDown=!0),document.addEventListener("keyup",t.onBodyKeyUp)),c.isBodyKeyDown&&t.handleKeyDown(n))}})),Object(r.e)(Object(r.a)(t),"onBodyKeyUp",(function(e){t.player&&(document.removeEventListener("keyup",t.onBodyKeyUp),t.handleKeyUp(e))})),Object(r.e)(Object(r.a)(t),"onKeydown",(function(e){if(t.player){var n=e||window.event,o=Object(r.a)(t)._keyState;if(!n.repeat){if(t.config.disable||t.config.disableRootTrigger||n.metaKey||n.altKey||n.ctrlKey)return;!n||37!==n.keyCode&&!t.checkCode(n.keyCode)||n.target!==t.player.root&&n.target!==t.player.video&&n.target!==t.player.controls.el||(o.isKeyDown=!0),t.player.root.addEventListener("keyup",t.onKeyup)}o.isKeyDown&&t.handleKeyDown(n)}})),Object(r.e)(Object(r.a)(t),"onKeyup",(function(e){t.player&&(t.player.root.removeEventListener("keyup",t.onKeyup),t.handleKeyUp(e))})),t}return Object(r.c)(n,[{key:"mergekeyCodeMap",value:function(){var t=this,e=this.config.keyCodeMap;e&&Object.keys(e).map((function(n){t.keyCodeMap[n]?["keyCode","action","disable","pressAction","disablePress","isBodyTarget"].map((function(r){e[n][r]&&(t.keyCodeMap[n][r]=e[n][r])})):t.keyCodeMap[n]=e[n]}))}},{key:"afterCreate",value:function(){this.config.disable=!this.playerConfig.keyShortcut;var t="function"==typeof this.config.seekStep?this.config.seekStep(this.player):this.config.seekStep;t&&"number"==typeof t&&(this.seekStep=t),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,disablePress:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,disablePress:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,disablePress:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disablePress:!1,disable:!1},right:{keyCode:39,action:"seek",pressAction:"changePlaybackRate",disablePress:!1,disable:!1},esc:{keyCode:27,action:"exitFullscreen",disablePress:!0,disable:!1}},this.mergekeyCodeMap(),this._keyState={isKeyDown:!1,isBodyKeyDown:!1,isPress:!1,tt:0,playbackRate:0},this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}},{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){e.config[n]=t[n]}))}},{key:"checkIsVisible",value:function(){if(!this.config.checkVisible)return!0;var t=this.player.root.getBoundingClientRect(),e=t.height,n=t.top,r=t.bottom,o=window.innerHeight;return!(n<0&&n<0-.9*e||r>0&&r-o>.9*e)}},{key:"checkCode",value:function(code,t){var e=this,n=!1;return Object.keys(this.keyCodeMap).map((function(r){e.keyCodeMap[r]&&code===e.keyCodeMap[r].keyCode&&!e.keyCodeMap[r].disable&&(n=!t||t&&!e.keyCodeMap[r].noBodyTarget)})),n}},{key:"downVolume",value:function(t){var e=this.player;if(!(e.volume<=0)){var n=parseFloat((e.volume-.1).toFixed(1)),r={volume:{from:e.volume,to:n}};this.emitUserAction(t,"change_volume",{props:r}),e.volume=n>=0?n:0}}},{key:"upVolume",value:function(t){var e=this.player;if(!(e.volume>=1)){var n=parseFloat((e.volume+.1).toFixed(1)),r={volume:{from:e.volume,to:n}};this.emitUserAction(t,"change_volume",{props:r}),e.volume=n<=1?n:1}}},{key:"seek",value:function(t){var e=this.player,n=e.currentTime,r=e.offsetCurrentTime,o=e.duration,c=e.offsetDuration,h=e.timeSegments,d=r>-1?r:n,f=c||o,m=t.repeat&&this.seekStep>=4?parseInt(this.seekStep/2,10):this.seekStep;d+m<=f?d+=m:d=f;var v=l.b.getCurrentTimeByOffset(d,h),y={currentTime:{from:n,to:v}};this.emitUserAction(t,"seek",{props:y}),this.player.currentTime=v}},{key:"seekBack",value:function(t){var e=this.player,n=e.currentTime,r=e.offsetCurrentTime,o=e.timeSegments,c=(r>-1?r:n)-(t.repeat?parseInt(this.seekStep/2,10):this.seekStep);c<0&&(c=0);var h={currentTime:{from:n,to:c=l.b.getCurrentTimeByOffset(c,o)}};this.emitUserAction(t,"seek",{props:h}),this.player.currentTime=c}},{key:"changePlaybackRate",value:function(t){var e=this._keyState,n=this.config,r=this.player;0===e.playbackRate&&(e.playbackRate=r.playbackRate,r.playbackRate=n.playbackRate)}},{key:"playPause",value:function(t){var e=this.player;e&&(this.emitUserAction(t,"switch_play_pause"),e.paused?e.play():e.pause())}},{key:"exitFullscreen",value:function(t){var e=this.player,n=e.fullscreen,r=e.cssfullscreen;n&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:n,to:!n}),e.exitFullscreen()),r&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:r,to:!r}),e.exitCssFullscreen())}},{key:"handleKeyDown",value:function(t){var e=this._keyState;if(t.repeat){e.isPress=!0;var n=Date.now();if(n-e.tt<200)return;e.tt=n}this.handleKeyCode(t.keyCode,t,e.isPress)}},{key:"handleKeyUp",value:function(t){var e=this._keyState;e.playbackRate>0&&(this.player.playbackRate=e.playbackRate,e.playbackRate=0),e.isKeyDown=!1,e.isPress=!1,e.tt=0}},{key:"handleKeyCode",value:function(t,e,n){for(var o,l=Object.keys(this.keyCodeMap),i=0;i<l.length;i++){var h=this.keyCodeMap[l[i]],d=h.action,f=h.keyCode,m=h.disable,v=h.pressAction,y=h.disablePress;if(f===t){if(!(m||n&&y)){var T=n&&v||d;"function"==typeof T?d(e,this.player,n):"string"==typeof T&&"function"==typeof this[T]&&this[T](e,this.player,n),this.emit(c.SHORTCUT,Object(r.i)({key:l[i],target:e.target,isPress:n},this.keyCodeMap[l[i]]))}(o=e).preventDefault(),o.returnValue=!1,e.stopPropagation();break}}}},{key:"destroy",value:function(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown),this.player.root.removeEventListener("keyup",this.onKeyup),document.removeEventListener("keyup",this.onBodyKeyUp)}},{key:"disable",value:function(){this.config.disable=!0}},{key:"enable",value:function(){this.config.disable=!1}}],[{key:"pluginName",get:function(){return"keyboard"}},{key:"defaultConfig",get:function(){return{seekStep:10,checkVisible:!1,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!0,keyCodeMap:{},disable:!1,playbackRate:2,isIgnoreUserActive:!0}}}]),n}(Q.a);function St(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110">\n  <path d="M100,50A50,50,0,1,1,50,0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"></path>\n</svg>\n',"image/svg+xml").firstChild}var _t=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"registerIcons",value:function(){return{loadingIcon:St}}},{key:"afterCreate",value:function(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}},{key:"render",value:function(){return'\n    <xg-loading class="xgplayer-loading">\n      <xg-loading-inner></xg-loading-inner>\n    </xg-loading>'}}],[{key:"pluginName",get:function(){return"loading"}},{key:"defaultConfig",get:function(){return{position:d.a.ROOT}}}]),n}(d.b),Lt=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played",styleKey:"playedColor"}],Ct=function(){function t(e){Object(r.b)(this,t),this.fragments=e.fragments||[],0===this.fragments.length&&this.fragments.push({percent:1}),this._callBack=e.actionCallback,this.fragConfig={fragFocusClass:e.fragFocusClass||"inner-focus-point",fragAutoFocus:!!e.fragAutoFocus,fragClass:e.fragClass||""},this.style=e.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0,this.focusIndex=-1}return Object(r.c)(t,[{key:"updateDuration",value:function(t){var e=this;this.duration=t;var n=0,r=this.fragments;this.fragments=r.map((function(t){return t.start=parseInt(n,10),t.end=parseInt(n+t.percent*e.duration,10),t.duration=parseInt(t.percent*e.duration,10),n+=t.percent*e.duration,t}))}},{key:"updateProgress",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"played",data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},e=this.progressList,n=this.fragments;if(!(e.length<1)){var r=data.newIndex,o=data.curIndex,l=data.millisecond;r!==o&&e.map((function(e,n){n<r?e[t].style.width="100%":n>r&&(e[t].style.width=0)}));var c=n[r],h=0===l?0:(l-c.start)/c.duration;e[r][t].style.width=h<0?0:"".concat(100*h,"%")}}},{key:"updateFocus",value:function(data){if(this.fragConfig.fragAutoFocus&&!(this.fragments.length<2))if(data){var t=this.findIndex(1e3*data.currentTime,this.focusIndex);if(t>=0&&t!==this.focusIndex){this.focusIndex>-1&&this.unHightLight(this.focusIndex),this.setHightLight(t);var e={index:t,preIndex:this.focusIndex,fragment:this.fragments[this.focusIndex]};this.focusIndex=t,this._callBack&&this._callBack(e)}}else if(this.focusIndex>-1){this.unHightLight(this.focusIndex);var n={index:-1,preIndex:this.focusIndex,fragment:null};this._callBack&&this._callBack(n),this.focusIndex=-1}}},{key:"update",value:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;if(!this.duration||parseInt(1e3*t,10)!==this.duration){if(!t&&0!==t)return;this.updateDuration(parseInt(1e3*t,10))}var e=this.playedIndex,n=this.cachedIndex;if("Undefined"!==l.b.typeOf(data.played)){var r=this.findIndex(1e3*data.played,e);if(r<0)return;this.updateProgress("played",{newIndex:r,curIndex:e,millisecond:parseInt(1e3*data.played,10)}),this.playedIndex=r}if("Undefined"!==l.b.typeOf(data.cached)){var o=this.findIndex(1e3*data.cached,n);if(o<0)return;this.updateProgress("cached",{newIndex:o,curIndex:n,millisecond:parseInt(1e3*data.cached,10)}),this.cachedIndex=o}}},{key:"findIndex",value:function(time,t){var e=this.fragments;if(!e||0===e.length)return-1;if(1===e.length)return 0;if(t>-1&&t<e.length&&time>e[t].start&&time<e[t].end)return t;if(time>e[e.length-1].start)return e.length-1;for(var i=0;i<e.length;i++)if(time>e[i].start&&time<=e[i].end){t=i;break}return t}},{key:"findHightLight",value:function(){for(var t=this.root.children,i=0;i<t.length;i++)if(l.b.hasClass(t[i],this.fragConfig.fragFocusClass))return{dom:t[i],pos:t[i].getBoundingClientRect()}}},{key:"findFragment",value:function(t){var e=this.root.children;return t<0||t>=e.length?null:{dom:e[t],pos:e[t].getBoundingClientRect()}}},{key:"unHightLight",value:function(){for(var t=this.root.children,i=0;i<t.length;i++)l.b.removeClass(t[i],this.fragConfig.fragFocusClass)}},{key:"setHightLight",value:function(t){var e=this.root.children;if(t<e.length)return l.b.addClass(e[t],this.fragConfig.fragFocusClass),{dom:e[t],pos:e[t].getBoundingClientRect()}}},{key:"destroy",value:function(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}},{key:"reset",value:function(t){var e=this;if(Object.keys(this.fragConfig).forEach((function(n){void 0!==t[n]&&(e.fragConfig[n]=t[n])})),t.fragments){if(this.fragments=0===t.fragments.length?[{percent:1}]:t.fragments,this.updateDuration(this.duration),this.playedIndex=0,this.cachedIndex=0,this.root)for(var n=this.root.children;n.length>0;)this.root.removeChild(n[0]);this.render()}}},{key:"render",value:function(){var t=this,e=this.style.progressColor;if(this.root||(this.root=l.b.createDom("xg-inners","",{},"progress-list")),this.fragments){var n=this.fragConfig,r=n.fragClass,o=n.fragFocusClass;this.progressList=this.fragments.map((function(n){var c=l.b.createDom("xg-inner","",{style:e?"background:".concat(e,"; flex: ").concat(n.percent):"flex: ".concat(n.percent)},"".concat(n.isFocus?o:""," xgplayer-progress-inner ").concat(r));return t.root.appendChild(c),Lt.forEach((function(e){c.appendChild(l.b.createDom(e.tag,"",{style:e.styleKey?"background: ".concat(t.style[e.styleKey],"; width:0;"):"width:0;"},e.className))})),{cached:c.children[0],played:c.children[1]}}))}return this.root}}]),t}(),At={POINT:"inner-focus-point",HIGHLIGHT:"inner-focus-highlight"},wt=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),o=e.call(this,t),Object(r.e)(Object(r.a)(o),"onMoveOnly",(function(t,data){var e=Object(r.a)(o),n=e.pos,c=e.config,h=e.player,d=data;if(t){l.b.event(t);var f=l.b.getEventPos(t,h.zoom),m=90===h.rotateDeg?f.clientY:f.clientX;if(n.moving&&Math.abs(n.x-m)<c.miniMoveStep)return;n.moving=!0,n.x=m,d=o.computeTime(t,m)}o.triggerCallbacks("dragmove",d,t),o._updateInnerFocus(d)})),Object(r.e)(Object(r.a)(o),"onBodyClick",(function(t){o.pos.isLocked&&(o.pos.isLocked=!1,t.preventDefault(),t.stopPropagation())})),Object(r.e)(Object(r.a)(o),"_mouseDownHandler",(function(t,data){o._state.time=data.currentTime,o.updateWidth(data.currentTime,data.seekTime,data.percent,0),o._updateInnerFocus(data)})),Object(r.e)(Object(r.a)(o),"_mouseUpHandler",(function(t,data){Object(r.a)(o).pos.moving&&o.updateWidth(data.currentTime,data.seekTime,data.percent,2)})),Object(r.e)(Object(r.a)(o),"_mouseMoveHandler",(function(t,data){var e=Object(r.a)(o),n=e._state,l=e.pos,c=e.config,h=e.player;n.time<data.currentTime?data.forward=!0:data.forward=!1,n.time=data.currentTime,l.isDown&&!l.moving&&(l.moving=!0,c.isPauseMoving&&h.pause(),o.triggerCallbacks("dragstart",data,t),o.emitUserAction("drag","dragstart",data)),o.updateWidth(data.currentTime,data.seekTime,data.percent,1),o.triggerCallbacks("dragmove",data,t),o._updateInnerFocus(data)})),Object(r.e)(Object(r.a)(o),"onMouseDown",(function(t){var e=Object(r.a)(o),n=e._state,c=e.player,h=e.pos,d=e.config,f=e.playerConfig,m=l.b.getEventPos(t,c.zoom),v=90===c.rotateDeg?m.clientY:m.clientX;if(!(c.isMini||d.closeMoveSeek||!f.allowSeekAfterEnded&&c.ended)){if(c.duration||c.isPlaying){t.stopPropagation(),o.focus(),l.b.checkIsFunction(f.disableSwipeHandler)&&f.disableSwipeHandler(),l.b.checkIsFunction(d.onMoveStart)&&d.onMoveStart(),l.b.event(t),h.x=v,h.isDown=!0,h.moving=!1,n.prePlayTime=c.currentTime,c.focus({autoHide:!1}),o.isProgressMoving=!0,l.b.addClass(o.progressBtn,"active");var y=o.computeTime(t,v);return y.prePlayTime=n.prePlayTime,o._mouseDownHandlerHook(t,y),"touchstart"===t.type?(o.root.addEventListener("touchmove",o.onMouseMove),o.root.addEventListener("touchend",o.onMouseUp),o.root.addEventListener("touchcancel",o.onMouseUp)):(o.unbind("mousemove",o.onMoveOnly),document.addEventListener("mousemove",o.onMouseMove,!1),document.addEventListener("mouseup",o.onMouseUp,!1)),!0}c.play()}})),Object(r.e)(Object(r.a)(o),"onMouseUp",(function(t){var e=Object(r.a)(o),n=e.player,c=e.config,h=e.pos,d=e.playerConfig,f=e._state;t.stopPropagation(),t.preventDefault(),l.b.checkIsFunction(d.enableSwipeHandler)&&d.enableSwipeHandler(),l.b.checkIsFunction(c.onMoveEnd)&&c.onMoveEnd(),l.b.event(t),l.b.removeClass(o.progressBtn,"active");var m=o.computeTime(t,h.x);m.prePlayTime=f.prePlayTime,h.moving?(o.triggerCallbacks("dragend",m,t),o.emitUserAction("drag","dragend",m)):(o.triggerCallbacks("click",m,t),o.emitUserAction("click","click",m)),o._mouseUpHandlerHook(t,m),h.moving=!1,h.isDown=!1,h.x=0,h.y=0,h.isLocked=!0,f.prePlayTime=0,f.time=0;var v=t.type;"touchend"===v||"touchcancel"===v?(o.root.removeEventListener("touchmove",o.onMouseMove),o.root.removeEventListener("touchend",o.onMouseUp),o.root.removeEventListener("touchcancel",o.onMouseUp),o.blur()):(document.removeEventListener("mousemove",o.onMouseMove,!1),document.removeEventListener("mouseup",o.onMouseUp,!1),h.isEnter?"mobile"!==d.isMobileSimulateMode&&o.bind("mousemove",o.onMoveOnly):o.onMouseLeave(t)),l.b.setTimeout(Object(r.a)(o),(function(){o.resetSeekState()}),1),n.focus()})),Object(r.e)(Object(r.a)(o),"onMouseMove",(function(t){var e=Object(r.a)(o),n=e._state,c=e.pos,h=e.player,d=e.config;l.b.checkTouchSupport()&&t.preventDefault(),l.b.event(t);var f=l.b.getEventPos(t,h.zoom),m=90===h.rotateDeg?f.clientY:f.clientX,v=Math.abs(c.x-m);if(!(c.moving&&v<d.miniMoveStep||!c.moving&&v<d.miniStartStep)){c.x=m;var y=o.computeTime(t,m);y.prePlayTime=n.prePlayTime,o._mouseMoveHandlerHook(t,y)}})),Object(r.e)(Object(r.a)(o),"onMouseOut",(function(t){o.triggerCallbacks("mouseout",null,t)})),Object(r.e)(Object(r.a)(o),"onMouseOver",(function(t){o.triggerCallbacks("mouseover",null,t)})),Object(r.e)(Object(r.a)(o),"onMouseEnter",(function(t){var e=Object(r.a)(o),n=e.player,c=e.pos;if(!(c.isDown||c.isEnter||n.isMini||!n.config.allowSeekAfterEnded&&n.ended)){c.isEnter=!0,o.bind("mousemove",o.onMoveOnly),o.bind("mouseleave",o.onMouseLeave),l.b.event(t);var h=l.b.getEventPos(t,n.zoom),d=90===n.rotateDeg?h.clientY:h.clientX,f=o.computeTime(t,d);o.triggerCallbacks("mouseenter",f,t),o.focus()}})),Object(r.e)(Object(r.a)(o),"onMouseLeave",(function(t){o.triggerCallbacks("mouseleave",null,t),o.unlock(),o._updateInnerFocus(null)})),Object(r.e)(Object(r.a)(o),"onVideoResize",(function(){var t=o.pos,e=t.x,n=t.isDown;if(t.isEnter&&!n){var r=o.computeTime(null,e);o.onMoveOnly(null,r)}})),o.useable=!1,o.isProgressMoving=!1,o.__dragCallBacks=[],o._state={now:-1,direc:0,time:0,prePlayTime:-1},o._disableBlur=!1,o}return Object(r.c)(n,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"currentTime",get:function(){var t=this.player,e=t.offsetCurrentTime,n=t.currentTime;return e>=0?e:n+this.timeOffset}},{key:"changeState",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.useable=t}},{key:"show",value:function(t){this.root&&(this.root.style.display="flex")}},{key:"_initInner",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e&&0!==e.length||(e=[{percent:1}]);var o=Object(r.i)(Object(r.i)({fragments:e},n),{},{actionCallback:function(data){t.emitUserAction("fragment_focus","fragment_focus",data)}});this.innerList?this.innerList.reset(o):(this.innerList=new Ct(o),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map((function(e){t[e]=t.innerList[e].bind(t.innerList)})))}},{key:"_updateInnerFocus",value:function(data){this.innerList&&this.innerList.updateFocus(data)}},{key:"afterCreate",value:function(){var t=this;if(!this.config.disable&&!this.playerConfig.isLive){this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1,isLocked:!1},this.outer=this.find("xg-outer");var e=this.config,n=e.fragFocusClass,r=e.fragAutoFocus,l=e.fragClass;this._initInner(this.config.fragments,{fragFocusClass:n,fragAutoFocus:r,fragClass:l,style:this.playerConfig.commonStyle||{}}),"mobile"===o.a.device&&(this.config.isDragingSeek=!1,this.isMobile=!0),this.progressBtn=this.find(".xgplayer-progress-btn"),this.on(c.DURATION_CHANGE,(function(){t.onMouseLeave()})),this.on(c.TIME_UPDATE,(function(){t.onTimeupdate()})),this.on(c.SEEKED,(function(){t.onTimeupdate(),t.onCacheUpdate()})),this.on(c.PROGRESS,(function(){t.onCacheUpdate()})),this.on(c.ENDED,(function(){t.onCacheUpdate(!0),t.onTimeupdate(!0),t._state.now=0})),this.on(c.EMPTIED,(function(){t.onReset()})),this.on(c.VIDEO_RESIZE,(function(){t.onVideoResize()})),this.bindDomEvents(),this.initCustomStyle()}}},{key:"setConfig",value:function(t){var e=this,n=null;Object.keys(t).forEach((function(r){e.config[r]=t[r],"fragments"===r&&(n=t[r])})),n&&this._initInner(n,t)}},{key:"initCustomStyle",value:function(){var t=(this.playerConfig||{}).commonStyle.sliderBtnStyle,e=this.progressBtn;t&&("string"==typeof t?e.style.boxShadow=t:"object"===Object(r.l)(t)&&Object.keys(t).map((function(n){e.style[n]=t[n]})))}},{key:"triggerCallbacks",value:function(t,data,e){this.__dragCallBacks.length>0&&this.__dragCallBacks.map((function(n){if(n&&n.handler&&n.type===t)try{n.handler(data,e)}catch(t){console.error("[XGPLAYER][triggerCallbacks] ".concat(n," error"),t)}}))}},{key:"addCallBack",value:function(t,e){e&&"function"==typeof e&&this.__dragCallBacks.push({type:t,handler:e})}},{key:"removeCallBack",value:function(t,e){var n=this.__dragCallBacks,r=-1;n.map((function(n,o){n&&n.type===t&&n.handler===e&&(r=o)})),r>-1&&n.splice(r,1)}},{key:"unlock",value:function(){var t=this.player,e=this.pos;e.isEnter=!1,e.isLocked=!1,t.isMini||(this.unbind("mousemove",this.onMoveOnly),e.isDown?this.unbind("mouseleave",this.onMouseLeave):this.blur())}},{key:"bindDomEvents",value:function(){var t=this.player.config;this._mouseDownHandlerHook=this.hook("dragstart",this._mouseDownHandler),this._mouseUpHandlerHook=this.hook("dragend",this._mouseUpHandler),this._mouseMoveHandlerHook=this.hook("drag",this._mouseMoveHandler),"touch"!==this.domEventType&&"compatible"!==this.domEventType||this.root.addEventListener("touchstart",this.onMouseDown),"mouse"!==this.domEventType&&"compatible"!==this.domEventType||(this.bind("mousedown",this.onMouseDown),"mobile"!==t.isMobileSimulateMode&&this.bind("mouseenter",this.onMouseEnter),this.bind("mouseover",this.onMouseOver),this.bind("mouseout",this.onMouseOut),this.player.root.addEventListener("click",this.onBodyClick,!0))}},{key:"focus",value:function(){this.player.controls.pauseAutoHide(),l.b.addClass(this.root,"active")}},{key:"blur",value:function(){this._disableBlur||(this.player.controls.recoverAutoHide(),l.b.removeClass(this.root,"active"))}},{key:"disableBlur",value:function(){this._disableBlur=!0}},{key:"enableBlur",value:function(){this._disableBlur=!1}},{key:"updateWidth",value:function(t,e,n,r){var o=this.config,l=this.player;if(!o.isCloseClickSeek||0!==r){var c=e=e>=l.duration?l.duration-o.endedDiff:Number(e).toFixed(1);this.updatePercent(n),this.updateTime(t),(1!==r||o.isDragingSeek&&"audio"!==l.config.mediaType)&&(this._state.now=c,this._state.direc=c>l.currentTime?0:1,l.seek(c))}}},{key:"computeTime",value:function(t,e){var n,r,o=this.player,c=this.root.getBoundingClientRect(),h=c.width,d=c.height,f=c.top,m=c.left,v=e;90===o.rotateDeg?(n=d,r=f):(n=h,r=m);var y=v-r,T=(y=y>n?n:y<0?0:y)/n;T=T<0?0:T>1?1:T;var E=parseInt(T*this.offsetDuration*1e3,10)/1e3;return{percent:T,currentTime:E,seekTime:l.b.getCurrentTimeByOffset(E,o.timeSegments),offset:y,width:n,left:r,e:t}}},{key:"updateTime",value:function(time){var t=this.player,e=this.duration;time>e?time=e:time<0&&(time=0);var n=t.plugins.time;n&&n.updateTime(time)}},{key:"resetSeekState",value:function(){this.isProgressMoving=!1;var t=this.player.plugins.time;t&&t.resetActive()}},{key:"updatePercent",value:function(t,e){if(this.isProgressMoving=!0,!this.config.disable){t=t>1?1:t<0?0:t,this.progressBtn.style.left="".concat(100*t,"%"),this.innerList.update({played:t*this.offsetDuration},this.offsetDuration);var n=this.player.plugins.miniprogress;n&&n.update({played:t*this.offsetDuration},this.offsetDuration)}}},{key:"onTimeupdate",value:function(t){var e=this.player,n=this._state,r=this.offsetDuration;if(!(e.isSeeking&&e.media.seeking||this.isProgressMoving)&&e.hasStart){if(n.now>-1){var o=parseInt(1e3*n.now,10)-parseInt(1e3*e.currentTime,10);if(0===n.direc&&o>300||1===n.direc&&o>-300)return void(n.now=-1);n.now=-1}var time=this.currentTime;time=l.b.adjustTimeByDuration(time,r,t),this.innerList.update({played:time},r),this.progressBtn.style.left="".concat(time/r*100,"%")}}},{key:"onCacheUpdate",value:function(t){var e=this.player,n=this.duration;if(e){var r=e.bufferedPoint.end;r=l.b.adjustTimeByDuration(r,n,t),this.innerList.update({cached:r},n)}}},{key:"onReset",value:function(){this.innerList.update({played:0,cached:0},0),this.progressBtn.style.left="0%"}},{key:"destroy",value:function(){var t=this.player;this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null;var e=this.domEventType;"touch"!==e&&"compatible"!==e||(this.root.removeEventListener("touchstart",this.onMouseDown),this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),this.root.removeEventListener("touchcancel",this.onMouseUp)),"mouse"!==e&&"compatible"!==e||(this.unbind("mousedown",this.onMouseDown),this.unbind("mouseenter",this.onMouseEnter),this.unbind("mousemove",this.onMoveOnly),this.unbind("mouseleave",this.onMouseLeave),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),t.root.removeEventListener("click",this.onBodyClick,!0))}},{key:"render",value:function(){if(!this.config.disable&&!this.playerConfig.isLive){var t=this.player.controls?this.player.controls.config.mode:"";return'\n    <xg-progress class="xgplayer-progress '.concat("bottom"===t?"xgplayer-progress-bottom":"",'">\n      <xg-outer class="xgplayer-progress-outer">\n        <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>\n      </xg-outer>\n    </xg-progress>\n    ')}}}],[{key:"pluginName",get:function(){return"progress"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_CENTER,index:0,disable:!1,isDragingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],fragFocusClass:At.POINT,fragClass:"",fragAutoFocus:!1,miniMoveStep:5,miniStartStep:2,onMoveStart:function(){},onMoveEnd:function(){},endedDiff:.2}}},{key:"FRAGMENT_FOCUS_CLASS",get:function(){return At}}]),n}(d.b),Ot=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return t=e.call.apply(e,[this].concat(l)),Object(r.e)(Object(r.a)(t),"_onMouseenter",(function(e){t.emit("icon_mouseenter",{pluginName:t.pluginName})})),Object(r.e)(Object(r.a)(t),"_onMouseLeave",(function(e){t.emit("icon_mouseleave",{pluginName:t.pluginName})})),t}return Object(r.c)(n,[{key:"afterCreate",value:function(){this.bind("mouseenter",this._onMouseenter),this.bind("mouseleave",this._onMouseLeave),this.config.disable&&this.disable()}},{key:"destroy",value:function(){this.unbind("mouseenter",this._onMouseenter),this.unbind("mouseleave",this._onMouseLeave)}}]),n}(d.b),Rt=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this;Object(r.f)(Object(r.g)(n.prototype),"afterCreate",this).call(this);var e=this.player;this.config.disable||(this.initIcons(),this.btnClick=this.btnClick.bind(this),this.bind(["touchend","click"],this.btnClick),this.on([c.PAUSE,c.ERROR,c.EMPTIED],(function(){t.animate(e.paused)})),this.on(c.PLAY,(function(){t.animate(e.paused)})),this.animate(!0))}},{key:"registerIcons",value:function(){return{play:{icon:O,class:"xg-icon-play"},pause:{icon:R,class:"xg-icon-pause"}}}},{key:"btnClick",value:function(t){t.preventDefault(),t.stopPropagation();var e=this.player;return this.emitUserAction(t,"switch_play_pause",{prop:"paused",from:e.paused,to:!e.paused}),e.ended?e.replay():e.paused?(e.play(),this.animate(!1)):(e.pause(),this.animate(!0)),!1}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild(".xgplayer-icon",t.play),this.appendChild(".xgplayer-icon",t.pause)}},{key:"animate",value:function(t){if(this.player){var e=this.i18nKeys,n=this.find(".xg-tips");t?(this.setAttr("data-state","pause"),n&&this.changeLangTextKey(n,e.PLAY_TIPS)):(this.setAttr("data-state","play"),n&&this.changeLangTextKey(n,e.PAUSE_TIPS))}}},{key:"destroy",value:function(){Object(r.f)(Object(r.g)(n.prototype),"destroy",this).call(this),this.unbind(["touchend","click"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-play">\n    <div class="xgplayer-icon">\n    </div>\n    '.concat(M(this,"PLAY_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"play"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_LEFT,index:0,disable:!1}}}]),n}(Ot);function Dt(){return(new DOMParser).parseFromString('<svg width="32px" height="40px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <path d="M11.2374369,14 L17.6187184,7.61871843 C17.9604272,7.27700968 17.9604272,6.72299032 17.6187184,6.38128157 C17.2770097,6.03957281 16.7229903,6.03957281 16.3812816,6.38128157 L9.38128157,13.3812816 C9.03957281,13.7229903 9.03957281,14.2770097 9.38128157,14.6187184 L16.3812816,21.6187184 C16.7229903,21.9604272 17.2770097,21.9604272 17.6187184,21.6187184 C17.9604272,21.2770097 17.9604272,20.7229903 17.6187184,20.3812816 L11.2374369,14 L11.2374369,14 Z" fill="#FFFFFF"></path>\n    </g>\n</svg>',"image/svg+xml").firstChild}var It=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this;this.initIcons(),this.onClick=function(e){e.preventDefault(),e.stopPropagation(),t.config.onClick(e)},this.bind(["click","touchend"],this.onClick)}},{key:"registerIcons",value:function(){return{screenBack:{icon:Dt,class:"xg-fullscreen-back"}}}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild(this.root,t.screenBack)}},{key:"show",value:function(){l.b.addClass(this.root,"show")}},{key:"hide",value:function(){l.b.removeClass(this.root,"show")}},{key:"render",value:function(){return'<xg-icon class="xgplayer-back">\n    </xg-icon>'}}],[{key:"pluginName",get:function(){return"topbackicon"}},{key:"defaultConfig",get:function(){return{position:d.a.ROOT_TOP,index:0}}}]),n}(d.b);function xt(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>\n</svg>\n',"image/svg+xml").firstChild}function Pt(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Mt=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return t=e.call.apply(e,[this].concat(l)),Object(r.e)(Object(r.a)(t),"_onOrientationChange",(function(e){t.player.fullscreen&&t.config.rotateFullscreen&&(90===window.orientation||-90===window.orientation?t.player.setRotateDeg(0):t.player.setRotateDeg(90))})),t}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this;Object(r.f)(Object(r.g)(n.prototype),"afterCreate",this).call(this);var e=this.config,h=this.playerConfig;if(!e.disable){e.target&&(this.playerConfig.fullscreenTarget=this.config.target);var d=l.b.getFullScreenEl();h.fullscreenTarget===d&&this.player.getFullscreen().catch((function(t){})),this.initIcons(),this.handleFullscreen=this.hook("fullscreenChange",this.toggleFullScreen,{pre:function(e){var n=t.player.fullscreen;t.emitUserAction(e,"switch_fullscreen",{prop:"fullscreen",from:n,to:!n})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(c.FULLSCREEN_CHANGE,(function(e){var n=t.find(".xg-tips");n&&t.changeLangTextKey(n,e?t.i18nKeys.EXITFULLSCREEN_TIPS:t.i18nKeys.FULLSCREEN_TIPS),t.animate(e)})),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:It,options:{config:{onClick:function(e){t.handleFullscreen(e)}}}})),"mobile"===o.a.device&&window.addEventListener("orientationchange",this._onOrientationChange)}}},{key:"registerIcons",value:function(){return{fullscreen:{icon:xt,class:"xg-get-fullscreen"},exitFullscreen:{icon:Pt,class:"xg-exit-fullscreen"}}}},{key:"destroy",value:function(){Object(r.f)(Object(r.g)(n.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon","mobile"===o.a.device?"touchend":"click",this.handleFullscreen),"mobile"===o.a.device&&window.removeEventListener("orientationchange",this._onOrientationChange)}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild(".xgplayer-icon",t.fullscreen),this.appendChild(".xgplayer-icon",t.exitFullscreen)}},{key:"toggleFullScreen",value:function(t){t&&(t.preventDefault(),t.stopPropagation());var e=this.player,n=this.config;!0===n.useCssFullscreen||"function"==typeof n.useCssFullscreen&&n.useCssFullscreen()?(e.fullscreen?e.exitCssFullscreen():e.getCssFullscreen(),this.animate(e.fullscreen)):n.rotateFullscreen?(e.fullscreen?e.exitRotateFullscreen():e.getRotateFullscreen(),this.animate(e.fullscreen)):n.switchCallback&&"function"==typeof n.switchCallback?n.switchCallback(e.fullscreen):e.fullscreen?(e.exitFullscreen(),n.useScreenOrientation&&this.unlockScreen()):(e.getFullscreen().catch((function(t){})),n.useScreenOrientation&&e.aspectRatio>1&&this.lockScreen(n.lockOrientationType))}},{key:"animate",value:function(t){t?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(t?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}},{key:"render",value:function(){if(!this.config.disable){return'<xg-icon class="xgplayer-fullscreen">\n    <div class="xgplayer-icon">\n    </div>\n    '.concat(M(this,"FULLSCREEN_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}},{key:"lockScreen",value:function(t){try{screen.orientation.lock(t).catch((function(t){}))}catch(t){}}},{key:"unlockScreen",value:function(){try{screen.orientation.unlock().catch((function(t){}))}catch(t){}}}],[{key:"pluginName",get:function(){return"fullscreen"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,useScreenOrientation:!1,lockOrientationType:"landscape",switchCallback:null,target:null,disable:!1,needBackIcon:!1}}}]),n}(Ot),Ft=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),(o=e.call(this,t)).isActiving=!1,o}return Object(r.c)(n,[{key:"duration",get:function(){var t=this.player,e=t.offsetDuration,n=t.duration;return this.playerConfig.customDuration||e||n}},{key:"currentTime",get:function(){var t=this.player,e=t.offsetCurrentTime,n=t.currentTime;return e>=0?e:n}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"afterCreate",value:function(){var t=this,e=this.player.controls.config.mode;this.mode="flex"===e?"flex":"normal",this.config.disable||("flex"===this.mode&&(this.createCenterTime(),this.root.style.display="none"),this.durationDom=this.find(".time-duration"),this.timeDom=this.find(".time-current"),this.on([c.DURATION_CHANGE,c.SEEKED,c.TIME_UPDATE],(function(e){"durationchange"===e.eventName&&(t.isActiving=!1),t.onTimeUpdate()})),this.on(c.ENDED,(function(){t.onTimeUpdate(!0)})),this.on(c.EMPTIED,(function(){t.onReset()})))}},{key:"show",value:function(t){if("flex"===this.mode)return this.centerCurDom&&(this.centerCurDom.style.display="block"),void(this.centerDurDom&&(this.centerDurDom.style.display="block"));this.root.style.display="block"}},{key:"hide",value:function(){if("flex"===this.mode)return this.centerCurDom&&(this.centerCurDom.style.display="none"),void(this.centerDurDom&&(this.centerDurDom.style.display="none"));this.root.style.display="none"}},{key:"onTimeUpdate",value:function(t){var e=this.player,n=this.config,r=this.duration;if(!n.disable&&!this.isActiving&&e.hasStart){var o=this.currentTime+this.timeOffset;o=l.b.adjustTimeByDuration(o,r,t),"flex"===this.mode?(this.centerCurDom.innerHTML=this.minWidthTime(l.b.format(o)),r!==1/0&&r>0&&(this.centerDurDom.innerHTML=l.b.format(r))):(this.timeDom.innerHTML=this.minWidthTime(l.b.format(o)),r!==1/0&&r>0&&(this.durationDom.innerHTML=l.b.format(r)))}}},{key:"onReset",value:function(){"flex"===this.mode?(this.centerCurDom.innerHTML=this.minWidthTime(l.b.format(0)),this.centerDurDom.innerHTML=l.b.format(0)):(this.timeDom.innerHTML=this.minWidthTime(l.b.format(0)),this.durationDom.innerHTML=l.b.format(0))}},{key:"createCenterTime",value:function(){var t=this.player;if(t.controls&&t.controls.center){var e=t.controls.center;this.centerCurDom=l.b.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-left"),this.centerDurDom=l.b.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-right"),e.children.length>0?e.insertBefore(this.centerCurDom,e.children[0]):e.appendChild(this.centerCurDom),e.appendChild(this.centerDurDom)}}},{key:"afterPlayerInit",value:function(){var t=this.config;this.duration===1/0||this.playerConfig.isLive?(l.b.hide(this.durationDom),l.b.hide(this.timeDom),l.b.hide(this.find(".time-separator")),l.b.show(this.find(".time-live-tag"))):l.b.hide(this.find(".time-live-tag")),t.hide?this.hide():this.show()}},{key:"changeLiveState",value:function(t){t?(l.b.hide(this.durationDom),l.b.hide(this.timeDom),l.b.hide(this.find(".time-separator")),l.b.show(this.find(".time-live-tag"))):(l.b.hide(this.find(".time-live-tag")),l.b.show(this.find(".time-separator")),l.b.show(this.durationDom),l.b.show(this.timeDom))}},{key:"updateTime",value:function(time){this.isActiving=!0,!time&&0!==time||time>this.duration||("flex"!==this.mode?this.timeDom.innerHTML=this.minWidthTime(l.b.format(time)):this.centerCurDom.innerHTML=this.minWidthTime(l.b.format(time)))}},{key:"minWidthTime",value:function(t){return t.split(":").map((function(t){return'<span class="time-min-width">'.concat(t,"</span>")})).join(":")}},{key:"resetActive",value:function(){var t=this,e=this.player,n=function(){t.isActiving=!1};this.off(c.SEEKED,n),e.isSeeking&&e.media.seeking?this.once(c.SEEKED,n):this.isActiving=!1}},{key:"destroy",value:function(){var t=this.player.controls.center;this.centerCurDom&&t.removeChild(this.centerCurDom),this.centerCurDom=null,this.centerDurDom&&t.removeChild(this.centerDurDom),this.centerDurDom=null}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-time">\n    <span class="time-current">00:00</span>\n    <span class="time-separator">/</span>\n    <span class="time-duration">00:00</span>\n    <span class="time-live-tag">'.concat(this.i18n.LIVE_TIP,"</span>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"time"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_LEFT,index:2,disable:!1}}}]),n}(d.b),Nt=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,c=new Array(o),h=0;h<o;h++)c[h]=arguments[h];return t=e.call.apply(e,[this].concat(c)),Object(r.e)(Object(r.a)(t),"_onDurationChange",(function(){t.updateSegments();var e=t.player,n=e.currentTime,r=e.timeSegments;if(t._checkIfEnabled(r)){var o=l.b.getIndexByTime(n,r),time=l.b.getOffsetCurrentTime(n,r,o);t.player.offsetCurrentTime=time,t.changeIndex(o,r)}})),Object(r.e)(Object(r.a)(t),"_onLoadedData",(function(){var e=t.player.timeSegments;if(t._checkIfEnabled(e)){var time=l.b.getOffsetCurrentTime(0,e);t.player.offsetCurrentTime=time,t.changeIndex(0,e),t.curPos.start>0&&(t.player.currentTime=t.curPos.start)}})),Object(r.e)(Object(r.a)(t),"_onTimeupdate",(function(){var e=t.player,n=e.currentTime,r=e.timeSegments;if(t._checkIfEnabled(r)){var o=r.length;t.lastCurrentTime=n;var c=l.b.getIndexByTime(n,r);c!==t.curIndex&&t.changeIndex(c,r);var h=l.b.getOffsetCurrentTime(n,r,c);if(t.player.offsetCurrentTime=h,t.curPos){var d=t.curPos,f=d.start,m=d.end;n<f?t.player.currentTime=f:n>m&&c>=o-1&&t.player.pause()}}})),Object(r.e)(Object(r.a)(t),"_onSeeking",(function(){var e=t.player,n=e.currentTime,r=e.timeSegments;if(t._checkIfEnabled(r))if(n<r[0].start)t.player.currentTime=r[0].start;else if(n>r[r.length-1].end)t.player.currentTime=r[r.length-1].end;else{var o=l.b.getIndexByTime(n,r);if(o>=0){var c=t.getSeekTime(n,t.lastCurrentTime,o,r);c>=0&&(t.player.currentTime=c)}}})),Object(r.e)(Object(r.a)(t),"_onPlay",(function(){var e=t.player,n=e.currentTime,r=e.timeSegments;t._checkIfEnabled(r)&&n>=r[r.length-1].end&&(t.player.currentTime=r[0].start)})),t}return Object(r.c)(n,[{key:"afterCreate",value:function(){this.curIndex=-1,this.curPos=null,this.lastCurrentTime=0,this.updateSegments(),this.on(c.DURATION_CHANGE,this._onDurationChange),this.on(c.LOADED_DATA,this._onLoadedData),this.on(c.TIME_UPDATE,this._onTimeupdate),this.on(c.SEEKING,this._onSeeking),this.on(c.PLAY,this._onPlay)}},{key:"setConfig",value:function(t){var e=this;if(t){var n=Object.keys(t);n.length<1||(n.forEach((function(n){e.config[n]=t[n]})),this.updateSegments())}}},{key:"updateSegments",value:function(){var t=this.config,e=t.disable,n=t.segments,r=this.player;if(e||!n||0===n.length)r.timeSegments=[],r.offsetDuration=0,r.offsetCurrentTime=-1;else{var o=this.formatTimeSegments(n,r.duration);r.timeSegments=o,r.offsetDuration=o.length>0?o[o.length-1].duration:0}}},{key:"formatTimeSegments",value:function(t,e){var n=[];return t?(t.sort((function(a,b){return a.start-b.start})),t.forEach((function(t,r){var o={};if(o.start=t.start<0?0:t.start,o.end=e>0&&t.end>e?e:t.end,!(e>0&&o.start>e)){n.push(o);var l=o.end-o.start;if(0===r)o.offset=t.start,o.cTime=0,o.segDuration=l,o.duration=l;else{var c=n[r-1];o.offset=c.offset+(o.start-c.end),o.cTime=c.duration+c.cTime,o.segDuration=l,o.duration=c.duration+l}}})),n):[]}},{key:"getSeekTime",value:function(t,e,n,r){var o=-1,l=r[n],c=l.start,h=l.end;if(t>=c&&t<=h)return o;var d=t-e;if(d<0&&t<c){var f=e>c?e-c:0;return o=n-1>=0?r[n-1].end+d+f:0}return-1}},{key:"_checkIfEnabled",value:function(t){return!(!t||t.length<1)}},{key:"changeIndex",value:function(t,e){this.curIndex=t,t>=0&&e.length>0?this.curPos=e[t]:this.curPos=null}}],[{key:"pluginName",get:function(){return"TimeSegmentsControls"}},{key:"defaultConfig",get:function(){return{disable:!0,segments:[]}}}]),n}(Q.a);function jt(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function Ut(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function Bt(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>\n</svg>\n',"image/svg+xml").firstChild}var $t=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,c=new Array(o),h=0;h<o;h++)c[h]=arguments[h];return t=e.call.apply(e,[this].concat(c)),Object(r.e)(Object(r.a)(t),"onBarMousedown",(function(e){var n=Object(r.a)(t).player,o=t.find(".xgplayer-bar");l.b.event(e);var c=o.getBoundingClientRect(),h=l.b.getEventPos(e,n.zoom),d=c.height-(h.clientY-c.top);if(h.h=d,h.barH=c.height,t.pos=h,!(d<-2))return t.updateVolumePos(d,e),document.addEventListener("mouseup",t.onBarMouseUp),t._d.isStart=!0,!1})),Object(r.e)(Object(r.a)(t),"onBarMouseMove",(function(e){var n=Object(r.a)(t)._d;if(n.isStart){var o=Object(r.a)(t),c=o.pos,h=o.player;e.preventDefault(),e.stopPropagation(),l.b.event(e);var d=l.b.getEventPos(e,h.zoom);n.isMoving=!0;var f=c.h-d.clientY+c.clientY;f>c.barH||t.updateVolumePos(f,e)}})),Object(r.e)(Object(r.a)(t),"onBarMouseUp",(function(e){l.b.event(e),document.removeEventListener("mouseup",t.onBarMouseUp);var n=Object(r.a)(t)._d;n.isStart=!1,n.isMoving=!1})),Object(r.e)(Object(r.a)(t),"onMouseenter",(function(e){t._d.isActive=!0,t.focus(),t.emit("icon_mouseenter",{pluginName:t.pluginName})})),Object(r.e)(Object(r.a)(t),"onMouseleave",(function(e){t._d.isActive=!1,t.unFocus(100,!1,e),t.emit("icon_mouseleave",{pluginName:t.pluginName})})),Object(r.e)(Object(r.a)(t),"onVolumeChange",(function(e){if(t.player){var n=t.player,r=n.muted,o=n.volume;t._d.isMoving||(t.find(".xgplayer-drag").style.height=r||0===o?"4px":"".concat(100*o,"%"),t.config.showValueLabel&&t.updateVolumeValue()),t.animate(r,o)}})),t}return Object(r.c)(n,[{key:"registerIcons",value:function(){return{volumeSmall:{icon:Ut,class:"xg-volume-small"},volumeLarge:{icon:jt,class:"xg-volume"},volumeMuted:{icon:Bt,class:"xg-volume-mute"}}}},{key:"afterCreate",value:function(){var t=this;if(this._timerId=null,this._d={isStart:!1,isMoving:!1,isActive:!1},!this.config.disable){this.initIcons();var e=this.playerConfig,n=e.commonStyle,r=e.volume;n.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=n.volumeColor),this.changeMutedHandler=this.hook("mutedChange",(function(e){t.changeMuted(e)}),{pre:function(t){t.preventDefault(),t.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),"mobile"!==o.a.device&&"mobile"!==this.playerConfig.isMobileSimulateMode&&(this.bind("mouseenter",this._onMouseenterHandler),this.bind(["blur","mouseleave"],this._onMouseleaveHandler),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(c.VOLUME_CHANGE,this.onVolumeChange),this.once(c.LOADED_DATA,this.onVolumeChange),"Number"!==l.b.typeOf(r)&&(this.player.volume=this.config.default),this.onVolumeChange()}}},{key:"updateVolumePos",value:function(t,e){var n=this.player,r=this.find(".xgplayer-drag"),o=this.find(".xgplayer-bar");if(o&&r){var l=parseInt(t/o.getBoundingClientRect().height*1e3,10);r.style.height="".concat(t,"px");var c=Math.max(Math.min(l/1e3,1),0),h={volume:{from:n.volume,to:c}};n.muted&&(h.muted={from:!0,to:!1}),this.emitUserAction(e,"change_volume",{muted:n.muted,volume:n.volume,props:h}),n.volume=Math.max(Math.min(l/1e3,1),0),n.muted&&(n.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}}},{key:"updateVolumeValue",value:function(){var t=this.player,e=t.volume,n=t.muted,r=this.find(".xgplayer-value-label"),o=Math.max(Math.min(e,1),0);r.innerText=n?0:Math.round(100*o)}},{key:"focus",value:function(){this.player.focus({autoHide:!1}),this._timerId&&(l.b.clearTimeout(this,this._timerId),this._timerId=null),l.b.addClass(this.root,"slide-show")}},{key:"unFocus",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,o=this._d,c=this.player;o.isActive||(this._timerId&&(l.b.clearTimeout(this,this._timerId),this._timerId=null),this._timerId=l.b.setTimeout(this,(function(){o.isActive||(n?c.blur():c.focus(),l.b.removeClass(t.root,"slide-show"),o.isStart&&t.onBarMouseUp(r)),t._timerId=null}),e))}},{key:"changeMuted",value:function(t){t&&t.stopPropagation();var e=this.player;this._d.isStart&&this.onBarMouseUp(t),this.emitUserAction(t,"change_muted",{muted:e.muted,volume:e.volume,props:{muted:{from:e.muted,to:!e.muted}}}),e.volume>0&&(e.muted=!e.muted),e.volume<.01&&(e.volume=this.config.miniVolume)}},{key:"animate",value:function(t,e){t||0===e?this.setAttr("data-state","mute"):e<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild(".xgplayer-icon",t.volumeSmall),this.appendChild(".xgplayer-icon",t.volumeLarge),this.appendChild(".xgplayer-icon",t.volumeMuted)}},{key:"destroy",value:function(){this._timerId&&(l.b.clearTimeout(this,this._timerId),this._timerId=null),this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon","mobile"===o.a.device?"touchend":"click",this.changeMutedHandler)}},{key:"render",value:function(){if(!this.config.disable){var t=this.config.default||this.player.volume,e=this.config.showValueLabel;return'\n    <xg-icon class="xgplayer-volume" data-state="normal">\n      <div class="xgplayer-icon">\n      </div>\n      <xg-slider class="xgplayer-slider">\n        '.concat(e?'<div class="xgplayer-value-label">'.concat(100*t,"</div>"):"",'\n        <div class="xgplayer-bar">\n          <xg-drag class="xgplayer-drag" style="height: ').concat(100*t,'%"></xg-drag>\n        </div>\n      </xg-slider>\n    </xg-icon>')}}}],[{key:"pluginName",get:function(){return"volume"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}}]),n}(d.b);function Ht(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">\n  <g clip-path="url(#clip0)">\n    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>\n    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>\n  </g>\n  <defs>\n    <clipPath id="clip0">\n      <rect width="40" height="40" fill="white"/>\n    </clipPath>\n  </defs>\n</svg>\n',"image/svg+xml").firstChild}var Gt=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),(o=e.call(this,t)).rotateDeg=o.config.rotateDeg||0,o}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this;if(!this.config.disable){Object(r.f)(Object(r.g)(n.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(c.VIDEO_RESIZE,(function(){t.rotateDeg&&t.config.innerRotate&&l.b.setTimeout(t,(function(){t.updateRotateDeg(t.rotateDeg,t.config.innerRotate)}),100)}));var e=this.player.root;this.rootWidth=e.style.width||e.offsetWidth||e.clientWidth,this.rootHeight=e.style.height||e.offsetHeight||e.clientHeight,this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate)}}},{key:"destroy",value:function(){Object(r.f)(Object(r.g)(n.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"onBtnClick",value:function(t){t.preventDefault(),t.stopPropagation(),this.emitUserAction(t,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}},{key:"updateRotateDeg",value:function(t,e){if(t||(t=0),e)this.player.videoRotateDeg=t;else{var n=this.player,r=this.rootWidth,o=this.rootHeight,l=n.root,c=n.innerContainer,video=n.media,h=l.offsetWidth,d=c&&e?c.offsetHeight:l.offsetHeight,f=r,m=o,v=0,y=0;.75!==t&&.25!==t||(f="".concat(d,"px"),m="".concat(h,"px"),v=-(d-h)/2,y=-(h-d)/2);var T="translate(".concat(v,"px,").concat(y,"px) rotate(").concat(t,"turn)"),E={transformOrigin:"center center",transform:T,webKitTransform:T,height:m,width:f},k=e?video:l,S=e?n.getPlugin("poster"):null;Object.keys(E).map((function(t){k.style[t]=E[t],S&&S.root&&(S.root.style[t]=E[t])}))}}},{key:"rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=this.player;this.rotateDeg||(this.rotateDeg=0);var o=t?1:-1;this.rotateDeg=(this.rotateDeg+1+.25*o*n)%1,this.updateRotateDeg(this.rotateDeg,e),r.emit(c.ROTATE,360*this.rotateDeg)}},{key:"registerIcons",value:function(){return{rotate:Ht}}},{key:"render",value:function(){if(!this.config.disable)return'\n    <xg-icon class="xgplayer-rotate">\n      <div class="xgplayer-icon">\n      </div>\n      '.concat(M(this,"ROTATE_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),n}(Ot);function Kt(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}function Vt(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M9.4998 7.7C9.77595 7.7 9.9998 7.47614 9.9998 7.2V6.5C9.9998 6.22386 9.77595 6 9.4998 6H5.5402L5.52754 6.00016H5.5C5.22386 6.00016 5 6.22401 5 6.50016V10.4598C5 10.7359 5.22386 10.9598 5.5 10.9598H6.2C6.47614 10.9598 6.7 10.7359 6.7 10.4598V8.83005L8.76983 10.9386C8.96327 11.1357 9.27984 11.1386 9.47691 10.9451L9.97645 10.4548C10.1735 10.2613 10.1764 9.94476 9.983 9.7477L7.97289 7.7H9.4998Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}var Wt="picture-in-picture",Yt="inline",qt="fullscreen",zt=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return t=e.call.apply(e,[this].concat(l)),Object(r.e)(Object(r.a)(t),"switchPIP",(function(e){if(!t.isPIPAvailable())return!1;e.stopPropagation&&e.stopPropagation(),t.isPip?(t.exitPIP(),t.emitUserAction(e,"change_pip",{props:"pip",from:!0,to:!1}),t.setAttr("data-state","normal")):4===t.player.media.readyState&&(t.requestPIP(),t.emitUserAction(e,"change_pip",{props:"pip",from:!1,to:!0}),t.setAttr("data-state","pip"))})),t}return Object(r.c)(n,[{key:"beforeCreate",value:function(t){"boolean"==typeof t.player.config.pip&&(t.config.showIcon=t.player.config.pip)}},{key:"afterCreate",value:function(){var t=this;this.isPIPAvailable()&&(Object(r.f)(Object(r.g)(n.prototype),"afterCreate",this).call(this),this.pMode=Yt,this.initPipEvents(),this.config.showIcon&&this.initIcons(),this.once(c.COMPLETE,(function(){t.config.showIcon&&(l.b.removeClass(t.find(".xgplayer-icon"),"xg-icon-disable"),t.bind("click",t.switchPIP))})))}},{key:"registerIcons",value:function(){return{pipIcon:{icon:Kt,class:"xg-get-pip"},pipIconExit:{icon:Vt,class:"xg-exit-pip"}}}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild(".xgplayer-icon",t.pipIcon),this.appendChild(".xgplayer-icon",t.pipIconExit)}},{key:"initPipEvents",value:function(){var t=this,e=this.player;this.leavePIPCallback=function(){var n=e.paused;l.b.setTimeout(t,(function(){!n&&e.mediaPlay()}),0),!n&&e.mediaPlay(),t.setAttr("data-state","normal"),t.pipWindow=null,e.emit(c.PIP_CHANGE,!1)},this.enterPIPCallback=function(n){e.emit(c.PIP_CHANGE,!0),null!=n&&n.pictureInPictureWindow&&(t.pipWindow=n.pictureInPictureWindow),t.setAttr("data-state","pip")},this.onWebkitpresentationmodechanged=function(n){var r=e.media.webkitPresentationMode;t.pMode===qt&&r!==qt&&e.onFullscreenChange(null,!1),t.pMode=r,r===Wt?t.enterPIPCallback(n):r===Yt&&t.leavePIPCallback(n)},e.media&&(e.media.addEventListener("enterpictureinpicture",this.enterPIPCallback),e.media.addEventListener("leavepictureinpicture",this.leavePIPCallback),n.checkWebkitSetPresentationMode(e.media)&&e.media.addEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged))}},{key:"copyStyleIntoPiPWindow",value:function(t){var e=Object(r.k)(document.styleSheets).map((function(e){try{return Object(r.k)(e.cssRules).map((function(t){return t.cssText})).join("")}catch(n){var link=document.createElement("link");link.rel="stylesheet",link.type=e.type,link.media=e.media,link.href=e.href,t.document.head.appendChild(link)}return""})).filter(Boolean).join("\n"),style=document.createElement("style");style.textContent=e,t.document.head.appendChild(style)}},{key:"requestPIP",value:function(){var t=this,e=this.player,r=this.playerConfig,o=this.config;if(this.isPIPAvailable()&&!this.isPip)try{var c=r.poster;if(c&&(e.media.poster="String"===l.b.typeOf(c)?c:c.poster),o.preferDocument&&this.isDocPIPAvailable()){var h={};if(o.width&&o.height)h.width=o.width,h.height=o.height;else{var d=e.root.getBoundingClientRect();h.width=d.width,h.height=d.height}documentPictureInPicture.requestWindow(h).then((function(n){var r=o.docPiPNode,l=o.docPiPStyle;t.enterPIPCallback();var c=r||e.root,h=c.parentElement,d=c.previousSibling,f=c.nextSibling;t.copyStyleIntoPiPWindow(n);var m=document.createElement("style");if(m.append("body{padding:0; margin:0;}"),l){var v="";"string"==typeof l?v=l:"function"==typeof l&&(v=l.call(o)),v&&m.append(v)}else c===e.root&&m.append("\n              .xgplayer{width: 100%!important; height: 100%!important;}\n            ");n.document.head.append(m),n.document.body.append(c),n.addEventListener("pagehide",(function(e){h&&(f?h.insertBefore(c,f):d?h.insertBefore(c,d.nextSibling):h.appendChild(c)),t.leavePIPCallback()}),{once:!0})}))}else n.checkWebkitSetPresentationMode(e.media)?e.media.webkitSetPresentationMode("picture-in-picture"):e.media.requestPictureInPicture();return!0}catch(t){return console.error("requestPiP",t),!1}}},{key:"exitPIP",value:function(){var t=this.player;try{var e;if(this.isPIPAvailable()&&this.isPip)this.isDocPIPAvailable()&&null!==(e=documentPictureInPicture)&&void 0!==e&&e.window?documentPictureInPicture.window.close():n.checkWebkitSetPresentationMode(t.media)?t.media.webkitSetPresentationMode("inline"):document.exitPictureInPicture();return!0}catch(t){return console.error("exitPIP",t),!1}}},{key:"isPip",get:function(){var t,e=this.player;return!(!this.isDocPIPAvailable()||null===(t=documentPictureInPicture)||void 0===t||!t.window)||document.pictureInPictureElement&&document.pictureInPictureElement===e.media||e.media.webkitPresentationMode===Wt}},{key:"isPIPAvailable",value:function(){var video=this.player.media;return("Boolean"!==l.b.typeOf(document.pictureInPictureEnabled)||document.pictureInPictureEnabled)&&("Boolean"===l.b.typeOf(video.disablePictureInPicture)&&!video.disablePictureInPicture||video.webkitSupportsPresentationMode&&"Function"===l.b.typeOf(video.webkitSetPresentationMode))||this.isDocPIPAvailable()}},{key:"isDocPIPAvailable",value:function(){return"documentPictureInPicture"in window&&/^(https|file)/.test(location.protocol)}},{key:"destroy",value:function(){Object(r.f)(Object(r.g)(n.prototype),"destroy",this).call(this);var t=this.player;t.media.removeEventListener("enterpictureinpicture",this.enterPIPCallback),t.media.removeEventListener("leavepictureinpicture",this.leavePIPCallback),n.checkWebkitSetPresentationMode(t.media)&&t.media.removeEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged),this.exitPIP(),this.unbind("click",this.btnClick)}},{key:"render",value:function(){if(this.config.showIcon&&this.isPIPAvailable())return'<xg-icon class="xgplayer-pip">\n      <div class="xgplayer-icon xg-icon-disable">\n      </div>\n      '.concat(M(this,"PIP",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"pip"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_RIGHT,index:6,showIcon:!1,preferDocument:!1,width:void 0,height:void 0,docPiPNode:void 0,docPiPStyle:void 0}}},{key:"checkWebkitSetPresentationMode",value:function(video){return"function"==typeof video.webkitSetPresentationMode}}]),n}(Ot);function Xt(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">\n  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Qt=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),o=e.call(this,t),Object(r.e)(Object(r.a)(o),"playNext",(function(t){var e=Object(r.a)(o).player;t.preventDefault(),t.stopPropagation(),o.idx+1<o.config.urlList.length?(o.idx++,o.nextHandler(o.config.urlList[o.idx],o.idx),e.emit(c.PLAYNEXT,o.idx+1)):(o.nextHandler(),e.emit(c.PLAYNEXT))})),o.idx=-1,o}return Object(r.c)(n,[{key:"afterCreate",value:function(){this.config.urlList&&0!==this.config.urlList.length&&(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}},{key:"registerIcons",value:function(){return{playNext:Xt}}},{key:"initEvents",value:function(){this.nextHandler=this.hook("nextClick",this.changeSrc);var t="mobile"===o.a.device?"touchend":"click";this.bind(t,this.playNext),this.show()}},{key:"changeSrc",value:function(t){var e=this.player;t&&(e.pause(),e.currentTime=0,e.switchURL?e.switchURL(t):e.src=t,e.config.url=t,e.play())}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.playNext)}},{key:"render",value:function(){if(this.config.urlList&&0!==this.config.urlList.length)return'\n     <xg-icon class="xgplayer-playnext">\n      <div class="xgplayer-icon">\n      </div>\n      '.concat(M(this,"PLAYNEXT_TIPS",this.playerConfig.isHideTips),"\n     </xg-icon>\n    ")}}],[{key:"pluginName",get:function(){return"playNext"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_LEFT,index:1,url:null,urlList:[]}}}]),n}(d.b),Jt=n(3683),Zt=n.n(Jt);function te(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">\n  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">\n      <g id="Group-2">\n        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">\n          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>\n          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>\n          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>\n          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>\n        </g>\n      </g>\n    </g>\n  </g>\n</svg>\n',"image/svg+xml").firstChild}var ee=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),o=e.call(this,t),Object(r.e)(Object(r.a)(o),"download",(function(t){if(!o.isLock){o.emitUserAction(t,"download");var e=o.playerConfig.url,n="";"String"===l.b.typeOf(e)?n=e:"Array"===l.b.typeOf(e)&&e.length>0&&(n=e[0].src);var r=o.getAbsoluteURL(n);Zt()(r),o.isLock=!0,o.timer=window.setTimeout((function(){o.isLock=!1,window.clearTimeout(o.timer),o.timer=null}),300)}})),o.timer=null,o.isLock=!1,o}return Object(r.c)(n,[{key:"afterCreate",value:function(){Object(r.f)(Object(r.g)(n.prototype),"afterCreate",this).call(this),this.config.disable||(this.appendChild(".xgplayer-icon",this.icons.download),this._handler=this.hook("click",this.download,{pre:function(t){t.preventDefault(),t.stopPropagation()}}),this.bind(["click","touchend"],this._handler))}},{key:"registerIcons",value:function(){return{download:te}}},{key:"getAbsoluteURL",value:function(t){if(!t.match(/^https?:\/\//)){var div=document.createElement("div");div.innerHTML='<a href="'.concat(t,'">x</a>'),t=div.firstChild.href}return t}},{key:"destroy",value:function(){Object(r.f)(Object(r.g)(n.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-download">\n   <div class="xgplayer-icon">\n   </div>\n   '.concat(M(this,"DOWNLOAD_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"download"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_RIGHT,index:3,disable:!0}}}]),n}(Ot),ie=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"beforeCreate",value:function(t){"boolean"==typeof t.player.config.screenShot&&(t.config.disable=!t.player.config.screenShot)}},{key:"afterCreate",value:function(){Object(r.f)(Object(r.g)(n.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);var t=this.config;this.initSize=function(data){t.fitVideo&&(t.width=data.vWidth,t.height=data.vHeight)},this.once(c.VIDEO_RESIZE,this.initSize)}},{key:"onPluginsReady",value:function(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}},{key:"saveScreenShot",value:function(data,t){var e,n=document.createElement("a");n.href=data,n.download=t;try{"undefined"!=typeof MouseEvent?e=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}):(e=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null)}catch(t){console.error("MouseEvent unsupported",t)}e&&n.dispatchEvent(e)}},{key:"createCanvas",value:function(t,e){var canvas=document.createElement("canvas"),n=canvas.getContext("2d");this.canvasCtx=n,this.canvas=canvas,canvas.width=t||this.config.width,canvas.height=e||this.config.height,n.imageSmoothingEnabled=!0,n.imageSmoothingEnabled&&(n.imageSmoothingQuality="high")}},{key:"onClickBtn",value:function(t){var e=this;t.preventDefault(),t.stopPropagation(),this.emitUserAction(t,"shot");var n=this.config;this.shot(n.width,n.height).then((function(data){e.emit(c.SCREEN_SHOT,data),n.saveImg&&e.saveScreenShot(data,n.name+n.format)}))}},{key:"shot",value:function(t,e){var n=this,option=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{quality:.92,type:"image/png"},r=this.config,o=this.player,l=option.quality||r.quality,c=option.type||r.type;return new Promise((function(h,d){var f,canvas=null;if(o.media.canvas)canvas=o.media.canvas;else{n.canvas?(n.canvas.width=t||r.width,n.canvas.height=e||r.height):n.createCanvas(t,e),canvas=n.canvas,f=n.canvasCtx;var m,v,y,T,E=o.media.videoWidth/o.media.videoHeight,k=canvas.width/canvas.height,S=o.media.videoWidth,_=o.media.videoHeight;E>k?(y=canvas.width,T=canvas.width/E,m=0,v=Math.round((canvas.height-T)/2)):E===k?(y=canvas.width,T=canvas.height,m=0,v=0):E<k&&(y=canvas.height*E,T=canvas.height,m=Math.round((canvas.width-y)/2),v=0),f.drawImage(o.media,0,0,S,_,m,v,y,T)}var L=canvas.toDataURL(c,l).replace(c,"image/octet-stream");h(L=L.replace(/^data:image\/[^;]+/,"data:application/octet-stream"))}))}},{key:"registerIcons",value:function(){return{screenshotIcon:null}}},{key:"destroy",value:function(){Object(r.f)(Object(r.g)(n.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.onClickBtn),this.off(c.VIDEO_RESIZE,this.initSize)}},{key:"render",value:function(){if(!this.config.disable){var t=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",e="SCREENSHOT";return'\n      <xg-icon class="xgplayer-shot">\n      <div class="'.concat(t,'">\n      ').concat(this.icons.screenshotIcon?"":'<span lang-key="'.concat(this.i18nKeys[e],'">').concat(this.i18n[e],"</span>"),"\n      </div>\n    </xg-icon>")}}}],[{key:"pluginName",get:function(){return"screenShot"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,saveImg:!0,fitVideo:!0,disable:!1,name:"screenshot"}}}]),n}(Ot),ne=function(){function t(e){Object(r.b)(this,t),this.config=e.config,this.parent=e.root,this.root=l.b.createDom("ul","",{},"xg-options-list xg-list-slide-scroll ".concat(this.config.className)),e.root.appendChild(this.root);var n=this.config.maxHeight;n&&this.setStyle({maxHeight:n}),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var o="touch"===this.config.domEventType?"touchend":"click";this._delegates=d.b.delegate.call(this,this.root,"li",o,this.onItemClick)}return Object(r.c)(t,[{key:"renderItemList",value:function(data){var t=this,e=this.config,n=this.root;data?e.data=data:data=e.data,e.style&&Object.keys(e.style).map((function(t){n.style[t]=e[t]})),data.length>0&&(this.attrKeys=Object.keys(data[0])),this.root.innerHTML="",data.map((function(e,n){var r=e.selected?"option-item selected":"option-item";e["data-index"]=n,t.root.appendChild(l.b.createDom("li","<span>".concat(e.showText,"</span>"),e,r))}))}},{key:"onItemClick",value:function(t){t.delegateTarget||(t.delegateTarget=t.target);var e=t.delegateTarget;if(e&&l.b.hasClass(e,"selected"))return!1;var n="function"==typeof this.config.onItemClick?this.config.onItemClick:null,r=this.root.querySelector(".selected");l.b.addClass(e,"selected"),r&&l.b.removeClass(r,"selected"),n(t,{from:r?this.getAttrObj(r,this.attrKeys):null,to:this.getAttrObj(e,this.attrKeys)})}},{key:"getAttrObj",value:function(t,e){if(!t||!e)return{};var n={};e.map((function(e){n[e]=t.getAttribute(e)}));var r=t.getAttribute("data-index");return r&&(n.index=Number(r)),n}},{key:"show",value:function(){l.b.removeClass(this.root,"hide"),l.b.addClass(this.root,"active")}},{key:"hide",value:function(){l.b.removeClass(this.root,"active"),l.b.addClass(this.root,"hide")}},{key:"setStyle",value:function(style){var t=this;Object.keys(style).forEach((function(e){t.root.style[e]=style[e]}))}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map((function(t){t.destroy&&t.destroy()})),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),t}(),re="side",se="middle",ae="default",oe="click",le="hover";var ce="mobile"===o.a.device,ue=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),o=e.call(this,t),Object(r.e)(Object(r.a)(o),"onEnter",(function(t){t.stopPropagation(),o.emit("icon_mouseenter",{pluginName:o.pluginName}),o.switchActiveState(t)})),Object(r.e)(Object(r.a)(o),"switchActiveState",(function(t){t.stopPropagation(),o.config.toggleMode===oe?o.toggle(!o.isActive):o.toggle(!0)})),Object(r.e)(Object(r.a)(o),"onLeave",(function(t){t.stopPropagation(),o.emit("icon_mouseleave",{pluginName:o.pluginName}),o.config.listType!==re&&o.isActive&&o.toggle(!1)})),Object(r.e)(Object(r.a)(o),"onListEnter",(function(t){o.enterType=2})),Object(r.e)(Object(r.a)(o),"onListLeave",(function(t){o.enterType=0,o.isActive&&o.toggle(!1)})),o.isIcons=!1,o.isActive=!1,o.curValue=null,o.curIndex=0,o}return Object(r.c)(n,[{key:"updateLang",value:function(t){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var t=this,e=this.config;this.initIcons(),(ce=ce||"touch"===this.domEventType)&&"mobile"===o.a.device&&e.listType===ae&&(e.listType=re),e.hidePortrait&&l.b.addClass(this.root,"portrait"),this.on([c.VIDEO_RESIZE,c.FULLSCREEN_CHANGE],(function(){t._resizeList()})),this.once(c.CANPLAY,(function(){e.list&&e.list.length>0&&(t.renderItemList(e.list),t.show())})),ce&&this.on(c.PLAYER_FOCUS,(function(){t.isActive&&(t.optionsList&&t.optionsList.hide(),t.isActive=!1)})),ce?(e.toggleMode=oe,this.activeEvent="touchend"):this.activeEvent=e.toggleMode===oe?"click":"mouseenter",e.toggleMode===oe?this.bind(this.activeEvent,this.switchActiveState):(this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)),this.isIcons&&this.bind("click",this.onIconClick)}},{key:"initIcons",value:function(){var t=this,e=this.icons,n=Object.keys(e),r=!1;n.length>0&&(n.forEach((function(n){t.appendChild(".xgplayer-icon",e[n]),!r&&(r=e[n])})),this.isIcons=r),r||(this.appendChild(".xgplayer-icon",l.b.createDom("span","",{},"icon-text")),l.b.addClass(this.find(".xgplayer-icon"),"btn-text"))}},{key:"show",value:function(t){!this.config.list||this.config.list.length<2||l.b.addClass(this.root,"show")}},{key:"hide",value:function(){l.b.removeClass(this.root,"show")}},{key:"getTextByLang",value:function(t,e,n){if(void 0===t)return"";var o=this.config.list;!n&&(n=this.player.lang),e=!e||l.b.isUndefined(t[e])?"text":e,"number"==typeof t&&(t=o[t]);try{return"object"===Object(r.l)(t[e])?t[e][n]||t[e].en:t[e]}catch(t){return console.warn(t),""}}},{key:"toggle",value:function(t){if(t!==this.isActive&&!this.config.disable){var e=this.player.controls,n=this.config.listType;t?(n===re?e.blur():e.focus(),this.optionsList&&this.optionsList.show()):(n===re?e.focus():e.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=t}}},{key:"onItemClick",value:function(t,data){t.stopPropagation();var e=this.config,n=e.listType,r=e.list;this.curIndex=data.to.index,this.curItem=r[this.curIndex],this.changeCurrentText(),(this.config.isItemClickHide||ce||n===re)&&this.toggle(!1)}},{key:"onIconClick",value:function(t){}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var t=this.config.list,e=t[this.curIndex<t.length?this.curIndex:0];e&&(this.find(".icon-text").innerHTML=this.getTextByLang(e,"iconText"))}}},{key:"renderItemList",value:function(t,e){var n=this,r=this.config,o=this.optionsList,l=this.player;if("number"==typeof e&&(this.curIndex=e,this.curItem=r.list[e]),o)return o.renderItemList(t),void this.changeCurrentText();var c,h,f={config:{data:t||[],className:(c=r.listType,h=r.position,c===re?h===d.a.CONTROLS_LEFT?"xg-side-list xg-left-side":"xg-side-list xg-right-side":""),onItemClick:function(t,data){n.onItemClick(t,data)},domEventType:ce?"touch":"mouse"},root:r.listType===re?l.innerContainer||l.root:this.root};if(this.config.isShowIcon){var m=this.player.root.getBoundingClientRect().height,v=r.listType===se?m-50:m;v&&r.heightLimit&&(f.config.maxHeight="".concat(v,"px")),this.optionsList=new ne(f),this.changeCurrentText(),this.show()}this._resizeList()}},{key:"_resizeList",value:function(){if(this.config.heightLimit){var t=this.player.root.getBoundingClientRect().height,e=this.config.listType===se?t-50:t;this.optionsList&&this.optionsList.setStyle({maxHeight:"".concat(e,"px")})}}},{key:"destroy",value:function(){this.config.toggleMode===oe?this.unbind(this.activeEvent,this.switchActiveState):(this.unbind(this.activeEvent,this.onEnter),this.unbind("mouseleave",this.onLeave)),this.isIcons&&this.unbind("click",this.onIconClick),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",'">\n    <div class="xgplayer-icon">\n    </div>\n   </xg-icon>')}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_RIGHT,index:100,list:[],listType:"default",listStyle:{},hidePortrait:!0,isShowIcon:!1,isItemClickHide:!0,toggleMode:le,heightLimit:!0}}}]),n}(d.b),he=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),(o=e.call(this,t)).curTime=0,o.isPaused=!0,o}return Object(r.c)(n,[{key:"beforeCreate",value:function(t){var e=t.config.list;Array.isArray(e)&&e.length>0&&(t.config.list=e.map((function(t){return!t.text&&t.name&&(t.text=t.name),t.text||(t.text=t.definition),t})))}},{key:"afterCreate",value:function(){var t=this;Object(r.f)(Object(r.g)(n.prototype),"afterCreate",this).call(this),this.on("resourceReady",(function(e){t.changeDefinitionList(e)})),this.on(c.DEFINITION_CHANGE,(function(data){t.renderItemList(t.config.list,data.to)})),this.player.definitionList.length<2&&this.hide()}},{key:"show",value:function(t){!this.config.list||this.config.list.length<2||l.b.addClass(this.root,"show")}},{key:"initDefinition",value:function(){var t=this.config,e=t.list,n=t.defaultDefinition;if(e.length>0){var r=null;e.map((function(t){t.definition===n&&(r=t)})),r||(r=e[0]),this.changeDefinition(r)}}},{key:"renderItemList",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.list||[],o=arguments.length>1?arguments[1]:void 0,l=o&&o.definition?o.definition:this.config.defaultDefinition;o&&e.forEach((function(t){t.selected=!1}));var c=0,h=e.map((function(e,n){var o=Object(r.i)(Object(r.i)({},e),{},{showText:t.getTextByLang(e)||e.definition,selected:!1});return(e.selected||e.definition&&e.definition==l)&&(o.selected=!0,c=n),o}));Object(r.f)(Object(r.g)(n.prototype),"renderItemList",this).call(this,h,c)}},{key:"changeDefinitionList",value:function(t){Array.isArray(t)&&(this.config.list=t.map((function(t){return!t.text&&t.name&&(t.text=t.name),t.text||(t.text=t.definition),t})),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}},{key:"changeDefinition",value:function(t,e){this.player.changeDefinition(t,e)}},{key:"onItemClick",value:function(t,data){var e=this.player.definitionList;Object(r.f)(Object(r.g)(n.prototype),"onItemClick",this).apply(this,arguments),this.emitUserAction(t,"change_definition",{from:data.from,to:data.to});for(var i=0;i<e.length;i++)data.to&&e[i].definition===data.to.definition&&(data.to.url=e[i].url),data.from&&e[i].definition===data.from.definition&&(data.from.url=e[i].url);this.player.changeDefinition(data.to,data.from)}}],[{key:"pluginName",get:function(){return"definition"}},{key:"defaultConfig",get:function(){return Object(r.i)(Object(r.i)({},ue.defaultConfig),{},{position:d.a.CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0})}}]),n}(ue),de=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),(o=e.call(this,t)).curRate=1,o}return Object(r.c)(n,[{key:"beforeCreate",value:function(t){var e=t.player.config.playbackRate,n=e?Array.isArray(e)?e:t.config.list:[];Array.isArray(n)&&(t.config.list=n.map((function(t){return"number"==typeof t?t={rate:t,text:"".concat(t,"x")}:!t.text&&t.rate&&(t.text="".concat(t.rate,"x")),t})))}},{key:"afterCreate",value:function(){var t=this;Object(r.f)(Object(r.g)(n.prototype),"afterCreate",this).call(this),this.on(c.RATE_CHANGE,(function(){t.curValue!==t.player.playbackRate&&t.renderItemList()})),this.renderItemList()}},{key:"show",value:function(t){this.config.list&&0!==this.config.list.length&&Object(r.f)(Object(r.g)(n.prototype),"show",this).call(this)}},{key:"onItemClick",value:function(t,e){Object(r.f)(Object(r.g)(n.prototype),"onItemClick",this).call(this,t,e);var o=t.delegateTarget,l=Number(o.getAttribute("rate"));if(!l||l===this.curValue)return!1;var c={playbackRate:{from:this.player.playbackRate,to:l}};this.emitUserAction(t,"change_rate",{props:c}),this.curValue=l,this.player.playbackRate=l}},{key:"renderItemList",value:function(){var t=this,e=this.player.playbackRate||1;this.curValue=e;var o=-1,l=this.config.list.map((function(n,r){var l={rate:n.rate};return l.rate===e&&(l.selected=!0,o=r),l.showText=t.getTextByLang(n),l}));Object(r.f)(Object(r.g)(n.prototype),"renderItemList",this).call(this,l,o)}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var t=this.config.list,e=t[this.curIndex<t.length?this.curIndex:0],n="";n=!e||this.curIndex<0?"".concat(this.player.playbackRate,"x"):this.getTextByLang(e,"iconText"),this.find(".icon-text").innerHTML=n}}},{key:"destroy",value:function(){Object(r.f)(Object(r.g)(n.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"playbackRate"}},{key:"defaultConfig",get:function(){return Object(r.i)(Object(r.i)({},ue.defaultConfig),{},{position:d.a.CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1})}}]),n}(ue);function fe(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" class=\'path_full\' d="M9,10v1a.9.9,0,0,1-1,1,.9.9,0,0,1-1-1V9A.9.9,0,0,1,8,8h2a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1Zm6,4V13a1,1,0,0,1,2,0v2a.9.9,0,0,1-1,1H14a1,1,0,0,1,0-2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}function ge(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" d="M9,10V9a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1v2a.9.9,0,0,1-1,1H8a.9.9,0,0,1-1-1,.9.9,0,0,1,1-1Zm6,4v1a1,1,0,0,1-2,0V13a.9.9,0,0,1,1-1h2a1,1,0,0,1,0,2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}var pe=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"beforeCreate",value:function(t){"boolean"==typeof t.player.config.cssFullscreen&&(t.config.disable=!t.player.config.cssFullscreen)}},{key:"afterCreate",value:function(){var t=this;Object(r.f)(Object(r.g)(n.prototype),"afterCreate",this).call(this),this.config.disable||(this.config.target&&(this.playerConfig.fullscreenTarget=this.config.target),this.initIcons(),this.on(c.CSS_FULLSCREEN_CHANGE,(function(e){t.animate(e)})),this.btnClick=this.btnClick.bind(this),this.handleCssFullscreen=this.hook("cssFullscreen_change",this.btnClick,{pre:function(t){t.preventDefault(),t.stopPropagation()}}),this.bind(["click","touchend"],this.handleCssFullscreen))}},{key:"initIcons",value:function(){var t=this.icons,e=this.find(".xgplayer-icon");e.appendChild(t.cssFullscreen),e.appendChild(t.exitCssFullscreen)}},{key:"btnClick",value:function(t){t.preventDefault(),t.stopPropagation();var e=this.player.isCssfullScreen;this.emitUserAction(t,"switch_cssfullscreen",{cssfullscreen:e}),e?this.player.exitCssFullscreen():this.player.getCssFullscreen()}},{key:"animate",value:function(t){this.root&&(t?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.switchTips(t))}},{key:"switchTips",value:function(t){var e=this.i18nKeys,n=this.find(".xg-tips");n&&this.changeLangTextKey(n,t?e.EXITCSSFULLSCREEN_TIPS:e.CSSFULLSCREEN_TIPS)}},{key:"registerIcons",value:function(){return{cssFullscreen:{icon:fe,class:"xg-get-cssfull"},exitCssFullscreen:{icon:ge,class:"xg-exit-cssfull"}}}},{key:"destroy",value:function(){Object(r.f)(Object(r.g)(n.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return"<xg-icon class='xgplayer-cssfullscreen'>\n    <div class=\"xgplayer-icon\">\n    </div>\n    ".concat(M(this,"CSSFULLSCREEN_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"cssFullscreen"}},{key:"defaultConfig",get:function(){return{position:d.a.CONTROLS_RIGHT,index:1,disable:!1,target:null}}}]),n}(Ot),me=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this;this.clickHandler=this.hook("errorRetry",this.errorRetry,{pre:function(t){t.preventDefault(),t.stopPropagation()}}),this.onError=this.hook("showError",this.handleError),this.bind(".xgplayer-error-refresh","click",this.clickHandler),this.on(c.ERROR,(function(e){t.onError(e)}))}},{key:"errorRetry",value:function(t){this.emitUserAction(t,"error_retry",{}),this.player.retry()}},{key:"handleError",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.player,n=t.errorType,r=e.errorNote?this.i18n[e.errorNote]:"";if(!r)switch(n){case"decoder":r=this.i18n.MEDIA_ERR_DECODE;break;case"network":r=this.i18n.MEDIA_ERR_NETWORK;break;default:r=this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED}this.find(".xgplayer-error-text").innerHTML=r,this.find(".xgplayer-error-tips").innerHTML="".concat(this.i18n.REFRESH_TIPS,'<span class="xgplayer-error-refresh">').concat(this.i18n.REFRESH,"</span>")}},{key:"destroy",value:function(){this.unbind(".xgplayer-error-refresh","click",this.clickHandler)}},{key:"render",value:function(){return'<xg-error class="xgplayer-error">\n      <div class="xgplayer-errornote">\n       <span class="xgplayer-error-text"></span>\n       <span class="xgplayer-error-tips"><em class="xgplayer-error-refresh"></em></span>\n      </div>\n    </xg-error>'}}],[{key:"pluginName",get:function(){return"error"}}]),n}(d.b),ve=n(3445),ye=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this;this.intervalId=0,this.customConfig=null,this.bind(".highlight",["click","touchend"],(function(e){(t.config.onClick||t.customOnClick)&&(e.preventDefault(),e.stopPropagation(),t.customOnClick?t.customOnClick(e):t.config.onClick(e))})),this.player.showPrompt=function(){t.showPrompt.apply(t,arguments)},this.player.hidePrompt=function(){t.hide()}}},{key:"setStyle",value:function(style){var t=this;Object.keys(style).map((function(e){t.root.style[e]=style[e]}))}},{key:"showPrompt",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(t){this.customOnClick=r;var o=this.config.interval;if(this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),l.b.addClass(this.root,"show"),"arrow"===n.mode&&l.b.addClass(this.root,"arrow"),this.find(".xgplayer-prompt-detail").innerHTML="string"==typeof t?t:"".concat(t.text||"")+"".concat(t.highlight?'<i class="highlight">'.concat(t.highlight,"</i>"):""),n.style&&this.setStyle(n.style),"boolean"==typeof n.autoHide?n.autoHide:this.config.autoHide){var c=n.interval||o;this.intervalId=setTimeout((function(){e.hide()}),c)}}}},{key:"hide",value:function(){l.b.removeClass(this.root,"show"),l.b.removeClass(this.root,"arrow"),this.root.removeAttribute("style"),this.customOnClick=null}},{key:"render",value:function(){return'<xg-prompt class="xgplayer-prompt '.concat(ve.a.CONTROLS_FOLLOW,'">\n    <span class="xgplayer-prompt-detail"></span>\n    </xg-prompt>')}}],[{key:"pluginName",get:function(){return"prompt"}},{key:"defaultConfig",get:function(){return{interval:3e3,style:{},mode:"arrow",autoHide:!0,detail:{text:"",highlight:""},onClick:function(){}}}}]),n}(d.b),be={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function Te(t){Object.keys(be).map((function(e){void 0===t[e]&&(t[e]=be[e])}))}var Ee={_updateDotDom:function(t,e){if(e){var n=this.calcuPosition(t.time,t.duration),style=t.style||{};style.left="".concat(n.left,"%"),style.width="".concat(n.width,"%"),e.setAttribute("data-text",t.text),e.setAttribute("data-time",t.time),n.isMini?l.b.addClass(e,"mini"):l.b.removeClass(e,"mini"),Object.keys(style).map((function(t){e.style[t]=style[t]}))}},initDots:function(){var t=this;this._ispots.map((function(e){t.createDot(e,!1)})),this.ispotsInit=!0},createDot:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],progress=this.player.plugins.progress;if(progress&&(e&&(Te(t),this._ispots.push(t)),this.ispotsInit||!e)){var n=this.calcuPosition(t.time,t.duration),style=t.style||{};style.left="".concat(n.left,"%"),style.width="".concat(n.width,"%");var r="xgspot_".concat(t.id," xgplayer-spot");n.isMini&&(r+=" mini");var o=t.template?'<div class="xgplayer-spot-pop">'.concat(t.template,"</div>"):"",c=l.b.createDom("xg-spot",o,{"data-text":t.text,"data-time":t.time,"data-id":t.id},r);Object.keys(style).map((function(t){c.style[t]=style[t]})),progress.outer&&progress.outer.appendChild(c),this.positionDot(c,t.id)}},findDot:function(t){if(this.player.plugins.progress){var e=this._ispots.filter((function(e,n){return e.id===t}));return e.length>0?e[0]:null}},updateDot:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],progress=this.player.plugins.progress;if(progress){var n=this.findDot(t.id);if(n&&Object.keys(t).map((function(e){n[e]=t[e]})),this.ispotsInit){var r=progress.find('xg-spot[data-id="'.concat(t.id,'"]'));r&&(this._updateDotDom(t,r),e&&this.showDot(t.id))}}},deleteDot:function(t){var e=this._ispots,progress=this.player.plugins.progress;if(progress){for(var del=[],i=0;i<e.length;i++)e[i].id===t&&del.push(i);for(var n=del.length-1;n>=0;n--)if(e.splice(del[n],1),this.ispotsInit){var r=progress.find('xg-spot[data-id="'.concat(t,'"]'));r&&r.parentElement.removeChild(r)}}},deleteAllDots:function(){var progress=this.player.plugins.progress;if(progress)if(this.ispotsInit){for(var t=progress.root.getElementsByTagName("xg-spot"),i=t.length-1;i>=0;i--)progress.outer.removeChild(t[i]);this._ispots=[]}else this._ispots=[]},updateAllDots:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],progress=this.player.plugins.progress;if(progress)if(this.ispotsInit){this._ispots=[];var n=progress.root.getElementsByTagName("xg-spot"),r=n.length;if(r>e.length)for(var i=r-1;i>e.length-1;i--)progress.outer.removeChild(n[i]);e.forEach((function(e,o){o<r?(n[o].setAttribute("data-id","".concat(e.id)),t._ispots.push(e),t.updateDot(e)):t.createDot(e)}))}else this._ispots=e},positionDots:function(){var t=this,e=this._ispots,n=this.playerSize,r=this.player.sizeInfo,progress=this.player.plugins.progress;progress&&r.width!==n.width&&(n.width=r.width,n.left=r.left,e.forEach((function(e){var n=progress.find('xg-spot[data-id="'.concat(e.id,'"]'));n&&t.positionDot(n,e.id)})))},positionDot:function(t,e){var n=l.b.findDom(t,".xgplayer-spot-pop");if(n){var r=this.playerSize,o=t.getBoundingClientRect(),rect=n.getBoundingClientRect(),c=o.left-r.left,h=r.width-c-o.width/2;if(c<rect.width/2||r.width<rect.width){var d=rect.width/2-c;n.style.left="".concat(d,"px")}else if(h<rect.width/2){var f=h-rect.width/2+o.width/2;n.style.left="".concat(f,"px")}else n.style.left="50%"}},updateDuration:function(){var t=this,progress=this.player.plugins.progress;progress&&this._ispots.forEach((function(e){var n=progress.find('xg-spot[data-id="'.concat(e.id,'"]'));t._updateDotDom(e,n)}))},getAllDotsDom:function(){var progress=this.player.plugins.progress;return progress?progress.root.getElementsByTagName("xg-spot"):[]},getDotDom:function(t){var progress=this.player.plugins.progress;if(progress)return progress.find('xg-spot[data-id="'.concat(t,'"]'))}};var ke={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver",mouseenter:"onProgressMouseOver"},Se=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),o=e.call(this,t),Object(r.e)(Object(r.a)(o),"onMousemove",(function(t){o.config.disable||(l.b.hasClass(t.target,"xg-spot-content")&&o.config.isHideThumbnailHover?o.player.plugins.progress.onMouseLeave(t):(o._state.f||l.b.hasClass(t.target,"xg-spot-content"))&&(l.b.event(t),t.stopPropagation()))})),Object(r.e)(Object(r.a)(o),"onMousedown",(function(t){o.config.disable||(o._state.f||l.b.hasClass(t.target,"xg-spot-content"))&&(l.b.event(t),t.stopPropagation())})),Object(r.e)(Object(r.a)(o),"onMouseup",(function(t){if(o.isDrag){var progress=o.player.plugins.progress;progress&&progress.pos&&(progress.onMouseUp(t),!progress.pos.isEnter&&progress.onMouseLeave(t))}})),Object(r.e)(Object(r.a)(o),"onDotMouseLeave",(function(t){if(!o.config.disable){o._curDot.removeEventListener("mouseleave",o.onDotMouseLeave),o.blurDot(t.target),o._curDot=null;var progress=o.player.plugins.progress;progress&&progress.enableBlur(),o.show()}})),Object(r.e)(Object(r.a)(o),"onProgressMouseOver",(function(data,t){if(!o.config.disable&&l.b.hasClass(t.target,"xgplayer-spot")&&!o._curDot){o._curDot=t.target,o.focusDot(t.target),o._curDot.children.length>0&&o.hide();var progress=o.player.plugins.progress;progress&&progress.disableBlur(),o._curDot.addEventListener("mouseleave",o.onDotMouseLeave)}})),o._ispots=[],o.videoPreview=null,o.videothumbnail=null,o.thumbnail=null,o.timeStr="",o._state={now:0,f:!1},o}return Object(r.c)(n,[{key:"beforeCreate",value:function(t){var progress=t.player.plugins.progress;progress&&(t.root=progress.root)}},{key:"afterCreate",value:function(){var t=this;this._curDot=null,this.handlerSpotClick=this.hook("spotClick",(function(e,data){data.seekTime&&t.player.seek(data.seekTime)})),this.transformTimeHook=this.hook("transformTime",(function(time){t.setTimeContent(l.b.format(time))})),function(t){var e=t.config,n=t.player;Object.keys(Ee).map((function(e){t[e]=Ee[e].bind(t)}));var r=n.config.progressDot||e.ispots||[];t._ispots=r.map((function(t){return Te(t),t})),t.ispotsInit=!1,t.playerSize={left:n.sizeInfo.left,width:n.sizeInfo.width},t.on(c.DURATION_CHANGE,(function(){t.ispotsInit?t.updateDuration():t.initDots()})),t.on(c.VIDEO_RESIZE,(function(){t.positionDots()}))}(this),this.on(c.DURATION_CHANGE,(function(){t.show()})),this.config.disable&&this.disable(),this.extTextRoot=this.find(".xg-spot-ext-text")}},{key:"setConfig",value:function(t){var e=this;t&&Object.keys(t).map((function(n){e.config[n]=t[n]}))}},{key:"onPluginsReady",value:function(){this.player.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}},{key:"bindEvents",value:function(){var t=this,progress=this.player.plugins.progress;if(progress&&(Object.keys(ke).map((function(e){t[ke[e]]=t[ke[e]].bind(t),progress.addCallBack(e,t[ke[e]])})),"mobile"!==o.a.device)){this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown),this.bind(".xg-spot-info","mouseup",this.onMouseup);var e=this.hook("previewClick",(function(){}));this.handlerPreviewClick=function(n){n.stopPropagation(),e(parseInt(1e3*t._state.now,10)/1e3,n)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}}},{key:"onProgressMove",value:function(data,t){!this.config.disable&&this.player.duration&&this.updatePosition(data.offset,data.width,data.currentTime,data.e)}},{key:"onProgressDragStart",value:function(data){!this.config.disable&&this.player.duration&&(this.isDrag=!0,this.videoPreview&&l.b.addClass(this.videoPreview,"show"))}},{key:"onProgressDragEnd",value:function(data){!this.config.disable&&this.player.duration&&(this.isDrag=!1,this.videoPreview&&l.b.removeClass(this.videoPreview,"show"))}},{key:"onProgressClick",value:function(data,t){this.config.disable||l.b.hasClass(t.target,"xgplayer-spot")&&(t.stopPropagation(),t.preventDefault(),["time","id","text"].map((function(e){data[e]=t.target.getAttribute("data-".concat(e))})),data.time&&(data.time=Number(data.time)),this.handlerSpotClick(t,data))}},{key:"updateLinePos",value:function(t,e){var n=this.root,r=this.previewLine,o=this.player,l=this.config,c="flex"===o.controls.mode,h=n.getBoundingClientRect().width;if(h||!this._hasThumnail){var d,f=t-(h=this._hasThumnail&&h<l.width?l.width:h)/2;f<0&&!c?(f=0,d=t-h/2):f>e-h&&!c?(d=f-(e-h),f=e-h):d=0,void 0!==d&&(r.style.transform="translateX(".concat(d.toFixed(2),"px)")),n.style.transform="translateX(".concat(f.toFixed(2),"px) translateZ(0)")}}},{key:"updateTimeText",value:function(t){var e=this.timeText,n=this.timePoint;e.innerHTML=t,!this.thumbnail&&(n.innerHTML=t)}},{key:"updatePosition",value:function(t,e,time,n){var r=this.root,o=this.config,c=this._state;if(r){c.now=time,this.transformTimeHook(time);var h=this.timeStr;n&&n.target&&l.b.hasClass(n.target,"xgplayer-spot")?(this.showTips(n.target.getAttribute("data-text"),!1,h),this.focusDot(n.target),c.f=!0,o.isFocusDots&&c.f&&(c.now=parseInt(n.target.getAttribute("data-time"),10))):o.defaultText?(c.f=!1,this.showTips(o.defaultText,!0,h)):(c.f=!1,this.hideTips("")),this.updateTimeText(h),this.updateThumbnails(c.now),this.updateLinePos(t,e)}}},{key:"setTimeContent",value:function(t){this.timeStr=t}},{key:"updateThumbnails",value:function(time){var t=this.player,e=this.videoPreview,n=this.config,r=t.plugins.thumbnail;if(r&&r.usable){this.thumbnail&&r.update(this.thumbnail,time,n.width,n.height);var rect=e&&e.getBoundingClientRect();this.videothumbnail&&r.update(this.videothumbnail,time,rect.width,rect.height)}}},{key:"registerThumbnail",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("mobile"!==o.a.device){var e=this.player,n=this.config,r=e.getPlugin("thumbnail");if(r&&r.setConfig(t),r&&r.usable&&n.isShowThumbnail){l.b.removeClass(this.root,"short-line no-thumbnail"),"short"===n.mode&&l.b.addClass(this.root,"short-line"),this._hasThumnail=!0;var c=this.find(".xg-spot-thumbnail");this.thumbnail=r.createThumbnail(c,"progress-thumbnail"),n.isShowCoverPreview&&(this.videoPreview=l.b.createDom("xg-video-preview","",{},"xgvideo-preview"),e.root.appendChild(this.videoPreview),this.videothumbnail=r.createThumbnail(this.videoPreview,"xgvideo-thumbnail")),this.updateThumbnails(0)}else l.b.addClass(this.root,"short-line no-thumbnail")}}},{key:"calcuPosition",value:function(time,t){var progress=this.player.plugins.progress,e=this.player,n=progress.root.getBoundingClientRect().width,r=e.duration/n*6;return time+t>e.duration&&(t=e.duration-time),e.duration,e.duration,{left:time/e.duration*100,width:t/e.duration*100,isMini:t<r}}},{key:"showDot",value:function(t){var e=this.findDot(t);if(e){var n=this.root.getBoundingClientRect().width,r=e.time/this.player.duration*n;this.updatePosition(r,n,e.time)}}},{key:"focusDot",value:function(t,e){t&&(e||(e=t.getAttribute("data-id")),l.b.addClass(t,"active"),this._activeDotId=e)}},{key:"blurDot",value:function(t){if(!t){var e=this._activeDotId;t=this.getDotDom(e)}t&&(l.b.removeClass(t,"active"),this._activeDotId=null)}},{key:"showTips",value:function(text,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";l.b.addClass(this.root,"no-timepoint"),text&&(l.b.addClass(this.find(".xg-spot-content"),"show-text"),t&&"production"===this.config.mode?(l.b.addClass(this.root,"product"),this.tipText.textContent=text):(l.b.removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?text:"".concat(e," ").concat(text)))}},{key:"hideTips",value:function(){l.b.removeClass(this.root,"no-timepoint"),this.tipText.textContent="",l.b.removeClass(this.find(".xg-spot-content"),"show-text"),l.b.removeClass(this.root,"product")}},{key:"hide",value:function(){l.b.addClass(this.root,"hide")}},{key:"show",value:function(t){l.b.removeClass(this.root,"hide")}},{key:"enable",value:function(){var t=this.config,e=this.playerConfig;this.config.disable=!1,this.show(),!this.thumbnail&&t.isShowThumbnail&&this.registerThumbnail(e.thumbnail||{})}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){var t=this,progress=this.player.plugins.progress;progress&&Object.keys(ke).map((function(e){progress.removeCallBack(e,t[ke[e]])})),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-info","mouseup",this.onMouseup),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}},{key:"render",value:function(){return"mobile"===o.a.device||"mobile"===this.playerConfig.isMobileSimulateMode?"":'<div class="xg-spot-info hide '.concat("short"===this.config.mode?"short-line":"",'">\n      <div class="xg-spot-content">\n        <div class="xg-spot-thumbnail">\n          <span class="xg-spot-time"></span>\n        </div>\n        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>\n      </div>\n      <div class="xgplayer-progress-point">00:00</div>\n      <div class="xg-spot-ext-text"></div>\n      <div class="xg-spot-line"></div>\n    </div>')}}],[{key:"pluginName",get:function(){return"progresspreview"}},{key:"defaultConfig",get:function(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isHideThumbnailHover:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:"",disable:!1,width:160,height:90}}}]),n}(d.b),_e=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;return Object(r.b)(this,n),(o=e.call(this,t)).ratio=1,o.interval=null,o._preloadMark={},o}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this;this.usable&&this.initThumbnail(),this.on([c.DURATION_CHANGE],(function(){var e=t.config,n=e.pic_num,r=e.interval;t.usable&&(t.interval=r>0?r:Math.round(1e3*t.player.duration/n)/1e3)}))}},{key:"setConfig",value:function(t){var e=this;if(t){var n=Object.keys(t);n.length<1||(n.forEach((function(n){e.config[n]=t[n]})),this.usable&&this.initThumbnail())}}},{key:"usable",get:function(){var t=this.config,e=t.urls,n=t.pic_num;return e&&e.length>0&&n>0}},{key:"initThumbnail",value:function(){var t=this.config,e=t.width,n=t.height,r=t.pic_num,o=t.interval;this.ratio=e/n*100,this.interval=o||Math.round(this.player.duration/r),this._preloadMark={}}},{key:"getUrlByIndex",value:function(t){return t>=0&&t<this.config.urls.length?this.config.urls[t]:""}},{key:"preload",value:function(t){var e=this;if(!this._preloadMark[t]){var n=this.config.urls,r=n.length,o=[];t>0&&o.push(t-1),o.push(t),t>0&&t<r-1&&o.push(t+1),o.map((function(t){!e._preloadMark[t]&&t>=0&&t<r&&(e._preloadMark[t]=1,l.b.preloadImg(n[t],(function(){e._preloadMark[t]=2})))}))}}},{key:"getPosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.config,o=r.pic_num,l=r.row,col=r.col,c=r.width,h=r.height;this.interval=Math.round(this.player.duration/o);var d=Math.ceil(t/this.interval),f=(d=d>o?o:d)<l*col?0:Math.ceil(d/(l*col))-1,m=d-f*(col*l),v=m>0?Math.ceil(m/col)-1:0,y=m>0?m-v*col-1:0,T=0,E=0;e&&n?e/n<c/h?T=(E=n)*(c/h):E=(T=e)/(c/h):n?e||(T=(E=n||h)*(c/h)):E=(T=e||c)/(c/h);var k=this.getUrlByIndex(f);return{urlIndex:f,rowIndex:v,colIndex:y,url:k,height:E,width:T,style:{backgroundImage:"url(".concat(k,")"),backgroundSize:"".concat(T*col,"px auto"),backgroundPosition:"-".concat(y*T,"px -").concat(v*E,"px"),width:"".concat(T,"px"),height:"".concat(E,"px")}}}},{key:"update",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",l=this.config,c=l.pic_num,h=l.urls;if(!(c<=0)&&h&&0!==h.length){var d=this.getPosition(e,n,r);this.preload(d.urlIndex),Object.keys(d.style).map((function(e){t.style[e]=d.style[e]})),Object.keys(o).map((function(e){t.style[e]=o[e]}))}}},{key:"changeConfig",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setConfig(t)}},{key:"createThumbnail",value:function(t,e){var n=l.b.createDom("xg-thumbnail","",{},"thumbnail ".concat(e));return t&&t.appendChild(n),n}}],[{key:"pluginName",get:function(){return"thumbnail"}},{key:"defaultConfig",get:function(){return{isShow:!1,urls:[],pic_num:0,col:0,row:0,height:90,width:160,scale:1,className:"",hidePortrait:!1}}}]),n}(d.b);function Le(t){return t?"background:".concat(t,";"):""}var Ce=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,c=new Array(o),h=0;h<o;h++)c[h]=arguments[h];return t=e.call.apply(e,[this].concat(c)),Object(r.e)(Object(r.a)(t),"onTimeupdate",(function(){var e=t.player.ended,n=Object(r.a)(t).offsetDuration,time=t.currentTime;time=l.b.adjustTimeByDuration(time,n,e),t.update({played:time},n)})),t}return Object(r.c)(n,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"currentTime",get:function(){var t=this.player,e=t.offsetCurrentTime,n=t.currentTime;return e>=0?e:n}},{key:"afterCreate",value:function(){var t=this;this.root&&(this.on(c.TIME_UPDATE,this.onTimeupdate),this.on(c.EMPTIED,(function(){t.reset()})))}},{key:"reset",value:function(){this.update({played:0,cached:0},0)}},{key:"update",value:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;t&&this.root&&(data.cached&&(this.find("xg-mini-progress-cache").style.width="".concat(data.cached/t*100,"%")),data.played&&(this.find("xg-mini-progress-played").style.width="".concat(data.played/t*100,"%")))}},{key:"render",value:function(){var t=this.playerConfig,e=t.commonStyle;if(t.miniprogress){var n=this.config,r=n.mode,o=n.height,l={cached:Le(e.cachedColor),played:Le(e.playedColor),progress:Le(e.progressColor),height:o>0&&2!==o?"height: ".concat(o,"px;"):""};return'<xg-mini-progress class="xg-mini-progress '.concat("show"===r?"xg-mini-progress-show":"",'" style="').concat(l.progress," ").concat(l.height,'">\n    <xg-mini-progress-cache class="xg-mini-progress-cache" style="').concat(l.cached,'"></xg-mini-progress-cache>\n    <xg-mini-progress-played class="xg-mini-progress-played" style="').concat(l.played,'"></xg-mini-progress-played>\n    </xg-mini-progress>')}}}],[{key:"pluginName",get:function(){return"MiniProgress"}},{key:"defaultConfig",get:function(){return{mode:"auto",height:2}}}]),n}(d.b),Ae="realtime",we="firstframe",Oe="poster";var Re=null,De=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,h=new Array(o),d=0;d<o;d++)h[d]=arguments[d];return t=e.call.apply(e,[this].concat(h)),Object(r.e)(Object(r.a)(t),"onLoadedData",(function(e){t.player&&(t._frameCount=t.config.startFrameCount,t.stop(),t.renderOnTimeupdate(e),t.off(c.TIME_UPDATE,t.renderOnTimeupdate),t.on(c.TIME_UPDATE,t.renderOnTimeupdate))})),Object(r.e)(Object(r.a)(t),"onVisibilitychange",(function(e){"visible"===document.visibilityState?t._checkIfCanStart()&&t.start():"hidden"===document.visibilityState&&t.stop()})),Object(r.e)(Object(r.a)(t),"renderOnTimeupdate",(function(e){if(t._frameCount>0)t.renderOnce(),t._frameCount--;else{t._isLoaded=!0,t.off(c.TIME_UPDATE,t.renderOnTimeupdate);var n=t.config.startInterval;!t.player.paused&&t._checkIfCanStart()&&t.start(0,n)}})),Object(r.e)(Object(r.a)(t),"start",(function(time,e){var video=t.player.video,n=function(){try{return parseInt(window.performance.now(),10)}catch(t){return(new Date).getTime()}}(),o=t.checkVideoIsSupport(video);o&&t.canvasCtx&&(e||(e=t.interval),t.stop(),video.videoWidth&&video.videoHeight&&(t.videoPI=video.videoHeight>0?parseInt(video.videoWidth/video.videoHeight*100,10):0,(t.config.mode===Ae||n-t.preTime>=e)&&(video&&video.videoWidth&&t.update(o,t.videoPI),t.preTime=n)),t.frameId="timer"===t._loopType?l.b.setTimeout(Object(r.a)(t),t.start,e):l.b.requestAnimationFrame(t.start))})),Object(r.e)(Object(r.a)(t),"stop",(function(){t.frameId&&("timer"===t._loopType?l.b.clearTimeout(Object(r.a)(t),t.frameId):l.b.cancelAnimationFrame(t.frameId),t.frameId=null)})),t}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this;!0===this.playerConfig.dynamicBg&&(this.config.disable=!1),n.isSupport||(this.config.disable=!0);var e=this.config,r=e.disable,o=e.mode,l=e.frameRate;r||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this._isLoaded=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/l,10),this.canvas=null,this.canvasCtx=null,this._frameCount=0,this._loopType=this.config.mode!==Ae&&this.interval>=1e3?"timer":"animation",this.once(c.COMPLETE,(function(){t.player&&(t.init(),t.renderByPoster(),t.player.paused||t.start())})),o!==Oe&&(o!==we&&(this.on(c.EMPTIED,(function(){t.stop()})),this.on(c.PLAY,(function(){var e=t.config.startInterval;t._checkIfCanStart()&&t.start(0,e)})),this.on(c.PAUSE,(function(){t.stop()}))),this.on(c.LOADED_DATA,this.onLoadedData),this.on(c.LOAD_START,(function(){t._isLoaded=!1,t.stop()})),document.addEventListener("visibilitychange",this.onVisibilitychange)))}},{key:"setConfig",value:function(t){var e=this;Object.keys(t).forEach((function(n){"root"===n&&t[n]!==e.config[n]?e.reRender(t[n]):"frameRate"===n?e.interval=parseInt(1e3/t[n],10):"disable"===n&&t[n]&&e.stop(),e.config[n]=t[n]}))}},{key:"init",value:function(t){var e=this.player,r=this.config;this.canvasFilter=n.supportCanvasFilter();try{var o=t||r.root;o||(o=r.isInnerRender&&e.innerContainer||e.root),o.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg" data-index="'.concat(r.index,'"><canvas>\n        </canvas><xgmask></xgmask></div>')),this.root=o.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=r.filter,this.canvas.style.webkitFilter=r.filter),this.mask=this.find("xgmask"),r.addMask&&(this.mask.style.background=r.maskBg),this.canvasCtx=this.canvas.getContext("2d")}catch(t){h.b.logError("plugin:DynamicBg",t)}}},{key:"reRender",value:function(t){if(this.config.disable||this.root){this.stop();var e=this.root?this.root.parentElement:null;if(e!==t&&e.removeChild(this.root),t){this.init(t),this.renderOnce();var n=this.config.startInterval;this._checkIfCanStart()&&this.start(0,n)}else this.root=null}}},{key:"checkVideoIsSupport",value:function(video){if(!video)return null;var t=video&&video instanceof window.HTMLVideoElement?video:video.canvas?video.canvas:video.flyVideo?video.flyVideo:null;if(t&&("safari"!==o.a.browser||!l.b.isMSE(t)))return t;var e=t?t.tagName.toLowerCase():"";return"canvas"===e||"img"===e?t:null}},{key:"renderByPoster",value:function(){var t=this.playerConfig.poster;if(t){var e="String"===l.b.typeOf(t)?t:"String"===l.b.typeOf(t.poster)?t.poster:null;this.updateImg(e)}}},{key:"_checkIfCanStart",value:function(){var t=this.config.mode;return this._isLoaded&&!this.player.paused&&t!==we&&t!==Oe}},{key:"renderOnce",value:function(){var video=this.player.video;if(video.videoWidth&&video.videoHeight){this.videoPI=parseInt(video.videoWidth/video.videoHeight*100,10);var t=this.checkVideoIsSupport(video);t&&this.update(t,this.videoPI)}}},{key:"updateImg",value:function(t){var e=this;if(t){var n=this.canvas.getBoundingClientRect(),r=n.width,o=n.height,image=new window.Image;image.onload=function(){if(e.canvas&&!e.frameId&&!e.isStart){e.canvas.height=o,e.canvas.width=r;var t=parseInt(r/o*100,10);e.update(image,t),image=null}},image.src=t}}},{key:"update",value:function(video,t){if(this.canvas&&this.canvasCtx&&t)try{var e=this._pos,n=this.config,r=this.canvas.getBoundingClientRect(),o=r.width,l=r.height;if(o!==e.width||l!==e.height||e.pi!==t){var c=parseInt(o/l*100,10);e.pi=t,e.width!==o&&(e.width=this.canvas.width=o),e.height!==l&&(e.height=this.canvas.height=l);var d=l,f=o;c<t?f=parseInt(l*t/100,10):c>t&&(d=parseInt(100*o/t,10)),e.rwidth=f*n.multiple,e.rheight=d*n.multiple,e.x=(o-e.rwidth)/2,e.y=(l-e.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=n.filter),this.canvasCtx.drawImage(video,e.x,e.y,e.rwidth,e.rheight)}catch(t){h.b.logError("plugin:DynamicBg",t)}}},{key:"destroy",value:function(){this.stop(),document.removeEventListener("visibilitychange",this.onVisibilitychange),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,index:-1,mode:"framerate",frameRate:10,filter:"blur(50px)",startFrameCount:2,startInterval:0,addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return"boolean"==typeof Re?Re:Re=function(){try{return!!document.createElement("canvas").getContext}catch(t){return!1}}()}},{key:"supportCanvasFilter",value:function(){return!("safari"===o.a.browser||"firefox"===o.a.browser)}}]),n}(d.b),Ie=n(3521),xe="info",Pe=c.STATS_EVENTS,Me=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return t=e.call.apply(e,[this].concat(l)),Object(r.e)(Object(r.a)(t),"_recordUserActions",(function(e){var time=t._getTime(),n=Object.assign({},e,{msg:e.msg||e.action});t._stats[xe].push(Object(r.i)(Object(r.i)({type:"userAction"},time),{},{payload:n}))})),Object(r.e)(Object(r.a)(t),"_onReset",(function(){t.reset()})),Object(r.e)(Object(r.a)(t),"_recordInfo",(function(data){t.info(data)})),Object(r.e)(Object(r.a)(t),"_downloadStats",(function(){var e=t.getStats(),n=new Blob([JSON.stringify(e)],{type:"application/json"}),r=window.URL.createObjectURL(n),link=document.createElement("a");link.style.display="none",link.href=r,link.download="player.txt",link.disabled=!1,link.click()})),t}return Object(r.c)(n,[{key:"_getTime",value:function(){return{timestamp:Date.now(),timeFormat:(new Date).toISOString()}}},{key:"afterCreate",value:function(){this.reset(),this.on(c.USER_ACTION,this._recordUserActions),this.on(Pe.STATS_INFO,this._recordInfo),this.on(Pe.STATS_DOWNLOAD,this._downloadStats),this.on(Pe.STATS_RESET,this._onReset)}},{key:"destroy",value:function(){this.offAll()}},{key:"downloadStats",value:function(){this._downloadStats()}},{key:"info",value:function(data){data.profile?this._infoProfile(data):this._info(data)}},{key:"_info",value:function(data){var time=this._getTime();this._stats[xe].push(Object(r.i)(Object(r.i)({},time),{},{payload:data}))}},{key:"_infoProfile",value:function(data){if(data&&data.startMs){var t=Date.now()-data.startMs,e=Object(r.i)({cat:"function",dur:t,name:data.name||data.msg,ph:"X",pid:0,tid:0,ts:data.startMs,profile:!0},data);this._info(e)}else console.warn("infoProfile need object data, include startMs")}},{key:"reset",value:function(){var t;this._stats=(t={},Object(r.e)(t,xe,[]),Object(r.e)(t,"media",{}),t)}},{key:"getStats",value:function(){for(var t=this.player.media,e=[],i=0;i<t.buffered.length;i++)e.push({start:t.buffered.start(i),end:t.buffered.end(i)});var n={currentTime:t.currentTime,readyState:t.readyState,buffered:e,paused:t.paused,ended:t.ended};return this._stats.media=n,{raw:this._stats,timestat:this._getTimeStats(),profile:this._getProfile()}}},{key:"_getTimeStats",value:function(){return this._stats[xe].map((function(t){var data=t.payload.data,e="";try{data instanceof Error?e=data.msg:void 0!==data&&(e=JSON.stringify(data))}catch(t){console.log("err",t)}return"[".concat(t.timeFormat,"] : ").concat(t.payload.msg," ").concat(e," ")}))}},{key:"_getProfile",value:function(){var t={traceEvents:[]};return this._stats[xe].forEach((function(e){e.payload.profile&&t.traceEvents.push(e.payload)})),t}}],[{key:"pluginName",get:function(){return"stats"}},{key:"defaultConfig",get:function(){return{}}}]),n}(Q.a),Fe=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return t=e.call.apply(e,[this].concat(l)),Object(r.e)(Object(r.a)(t),"onGapJump",(function(){var e=Object(r.a)(t),o=e.player,l=e.config;if(o.media.readyState!==HTMLMediaElement.HAVE_NOTHING){if(o.media.seeking){if(!t.seekingEventReceived)return}else t.seekingEventReceived=!1;if(!o.media.paused||0===o.media.currentTime||!t.hasPlayed){var c=o.media.buffered,h=l.smallGapLimit||.5,d=l.gapDetectionThreshold||.3,f=o.media.currentTime,m=t._getIndex(c,f,d);if(null!==m&&0!==m){console.log("GapJump  bufferRange ",c.start(m),c.end(m));var v=c.start(m)+.1;if(!(v>o.media.duration)){var y=v-f,T=y<=h;y<n.BROWSER_GAP_TOLERANCE||T&&(!1!==l.useGapJump&&(o.media.currentTime=t.isSafari?v+.1:v),t.player&&t.player.emit("detectGap"),console.log("gapJump gapIndex",m," isGapSamll:",T," currentTime:",o.media.currentTime," jumpSize:",f-o.media.currentTime),.08!==v&&o&&o.emit("log",{type:"oneevent",end_type:"gap",vid:o.config.vid,ext:{video_postion:Math.floor(1e3*v)}}))}}}}})),t}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this;!1!==this.config.useGapJump&&(this.hasPlayed=!1,this.seekingEventReceived=!1,this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),this.on(c.WAITING,this.onGapJump),this.on(c.PLAY,(function(){t.hasPlayed=!0})),this.on(c.SEEKING,(function(){t.seekingEventReceived=!0})))}},{key:"_getIndex",value:function(t,time,e){if(!t||!t.length)return null;if(1===t.length&&t.end(0)-t.start(0)<1e-6)return null;for(var n=this._getBuffered(t),r=null,i=0;i<n.length;i++){if(n[i].start>time&&(0===i||n[i-1].end-time<=e)){r=i;break}}return r}},{key:"_getBuffered",value:function(b){if(!b)return[];for(var t=[],i=0;i<b.length;i++)t.push({start:b.start(i),end:b.end(i)});return t}}],[{key:"pluginName",get:function(){return"gapJump"}},{key:"defaultConfig",get:function(){return{useGapJump:!1,smallGapLimit:.5,gapDetectionThreshold:.3}}}]),n}(d.b);Fe.BROWSER_GAP_TOLERANCE=.001;var Ne=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return t=e.call.apply(e,[this].concat(l)),Object(r.e)(Object(r.a)(t),"onWaiting",(function(){var e=Object(r.a)(t).config;t.jumpCnt>e.jumpCntMax||t.timer||!1===e.useWaitingTimeoutJump||(t.timer=setTimeout(t.onJump,1e3*e.waitingTime))})),Object(r.e)(Object(r.a)(t),"onJump",(function(){var e=Object(r.a)(t),n=e.player,o=e.config;if(clearTimeout(t.timer),t.timer=null,!(t.jumpCnt>o.jumpCntMax||!1===o.useWaitingTimeoutJump||n.media.paused&&0!==n.media.currentTime&&t.hasPlayed)){t.jumpSize=o.jumpSize*(t.jumpCnt+1),t.jumpCnt===o.jumpSize&&t.jumpSize<6&&(t.jumpSize=6);var l=n.currentTime+t.jumpSize;l>n.media.duration||(t.jumpCnt++,n.currentTime=l)}})),t}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this,e=this.config,n=e.useWaitingTimeoutJump,r=e.jumpSize;!1!==n&&(this.hasPlayed=!1,this.jumpCnt=0,this.timer=null,this.jumpSize=r,this.on(c.WAITING,this.onWaiting),this.on([c.PLAYING,c.CANPLAY],(function(){clearTimeout(t.timer),t.timer=null,t.jumpSize=t.config.jumpSize})),this.on(c.PLAY,(function(){t.hasPlayed=!0})))}}],[{key:"pluginName",get:function(){return"waitingTimeoutJump"}},{key:"defaultConfig",get:function(){return{useWaitingTimeoutJump:!1,waitingTime:15,jumpSize:2,jumpCntMax:4}}}]),n}(d.b),je="cdn",Ue=["cdn"],Be=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,h=new Array(o),d=0;d<o;d++)h[d]=arguments[d];return t=e.call.apply(e,[this].concat(h)),Object(r.e)(Object(r.a)(t),"getSpeed",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:je;if(!t.speedListCache||!t.speedListCache[e])return 0;if(t.speedListCache[e].length<=0)return 0;var n=0;return t.speedListCache[e].map((function(t){n+=t})),Math.floor(n/t.speedListCache[e].length)})),Object(r.e)(Object(r.a)(t),"startTimer",(function(){l.b.isMSE(t.player.video)||(t.initSpeedList(),t.cnt=0,t.timer=setTimeout(t.testSpeed,t.config.testTimeStep))})),Object(r.e)(Object(r.a)(t),"initSpeedList",(function(){t.speedListCache={},Ue.forEach((function(e){t.speedListCache[e]=[]}))})),Object(r.e)(Object(r.a)(t),"_onRealSpeedChange",(function(data){data.speed&&t.appendList(data.speed,data.type||je)})),Object(r.e)(Object(r.a)(t),"testSpeed",(function(){if(clearTimeout(t.timer),t.timer=null,t.player&&t.config.openSpeed){var e=t.config,n=e.url,r=e.loadSize,o=e.testCnt,l=e.testTimeStep,c=n+(n.indexOf("?")<0?"?testst=":"&testst=")+Date.now();if(!(t.cnt>=o)){t.cnt++;try{var h=(new Date).getTime(),d=null,f=new XMLHttpRequest;t.xhr=f,f.open("GET",c);var m={},v=Math.floor(10*Math.random());m.Range="bytes="+v+"-"+(r+v),m&&Object.keys(m).forEach((function(t){f.setRequestHeader(t,m[t])})),f.onreadystatechange=function(){if(4===f.readyState){t.xhr=null,d=(new Date).getTime();var e=f.getResponseHeader("Content-Length")/1024*8,n=Math.round(1e3*e/(d-h));t.appendList(n),t.timer=setTimeout(t.testSpeed,l)}},f.send()}catch(t){console.error(t)}}}})),Object(r.e)(Object(r.a)(t),"appendList",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:je;if(t.speedListCache&&t.speedListCache[n]){var o=t.config.saveSpeedMax;t.speedListCache[n].length>=o&&t.speedListCache[n].shift(),t.speedListCache[n].push(e);var l=Object(r.a)(t).player;l&&(n===je?l.realTimeSpeed=e:l[t.getSpeedName("realTime",n)]=e),t.updateSpeed(n)}})),Object(r.e)(Object(r.a)(t),"updateSpeed",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:je,n=t.getSpeed(e),o=Object(r.a)(t).player;if(o)if(e===je)o.avgSpeed&&n===o.avgSpeed||(o.avgSpeed=n,o.emit(c.DOWNLOAD_SPEED_CHANGE,{speed:n,realTimeSpeed:o.realTimeSpeed}));else{var l=t.getSpeedName("avg",e);o[l]&&n===o[l]||(o[l]=n,o.emit(c.DOWNLOAD_SPEED_CHANGE,{speed:n,realTimeSpeed:o.realTimeSpeed}))}})),t}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this.config,e=t.openSpeed,n=t.addSpeedTypeList;(null==n?void 0:n.length)>0&&Ue.push.apply(Ue,Object(r.k)(n)),this.initSpeedList(),this.on("real_time_speed",this._onRealSpeedChange),this.timer=null,this.cnt=0,this.xhr=null,e&&this.on([c.LOADED_DATA,c.REPLAY],this.startTimer)}},{key:"getSpeedName",value:function(t,e){return t+"Speed"+e.toUpperCase()}},{key:"openSpeed",get:function(){return this.config.openSpeed},set:function(t){if(this.config.openSpeed=t,!t&&this.timer)return clearTimeout(this.timer),void(this.timer=null);if(this.config.openSpeed){if(this.timer)return;this.timer=setTimeout(this.testSpeed,this.config.testTimeStep)}}},{key:"destroy",value:function(){var t=this;this.off("real_time_speed",this._onRealSpeedChange),this.off([c.LOADED_DATA,c.REPLAY],this.startTimer),Ue.forEach((function(e){t.speedListCache&&t.speedListCache[e]&&(t.speedListCache[e]=[])})),this.speedListCache&&(this.speedListCache={}),clearTimeout(this.timer),this.timer=null,this.xhr&&4!==this.xhr.readyState&&(this.xhr.cancel&&this.xhr.cancel(),this.xhr=null)}}],[{key:"pluginName",get:function(){return"testspeed"}},{key:"defaultConfig",get:function(){return{openSpeed:!1,testCnt:3,loadSize:204800,testTimeStep:3e3,url:"",saveSpeedMax:5,addSpeedTypeList:[]}}}]),n}(d.b),$e=n(3455),He=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n,[{key:"afterCreate",value:function(){var t=this,e=this.player,n=this.config,r=e.media||e.video;(this.timer=null,this._lastDecodedFrames=0,this._currentStuckCount=0,this._lastCheckPoint=null,this._payload=[],n.disabled)||r.getVideoPlaybackQuality&&(this.on(c.PLAY,(function(){t._startTick()})),this.on(c.PAUSE,(function(){t._stopTick()})),this.on(c.ENDED,(function(){t._stopTick()})),this.on(c.EMPTIED,(function(){t._stopTick()})))}},{key:"_startTick",value:function(){var t=this;this._stopTick(),this._timer=setTimeout((function(){t._checkDecodeFPS(),t._startTick()}),this.config.tick)}},{key:"_stopTick",value:function(){clearTimeout(this._timer),this._timer=null}},{key:"_checkBuffer",value:function(t,e){for(var n=!1,r=[],i=0;i<e.length;i++){var o=e.start(i),l=e.end(i);if(r.push({start:o,end:l}),o<=t&&t<=l-1){n=!0;break}}return{enoughBuffer:n,buffers:r}}},{key:"_checkStuck",value:function(t,e,n,r){var o=this.player.media||this.player.video,l=document.hidden,h=o.paused,d=o.readyState,f=o.currentTime,m=o.buffered;if(!(l||h||d<4)){var v=this._checkBuffer(f,m),y=v.enoughBuffer,T=v.buffers;y&&(t<=this.config.reportFrame?(this._currentStuckCount++,this._payload.push({currentTime:f,buffers:T,curDecodedFrames:t,totalVideoFrames:e,droppedVideoFrames:n,checkInterval:r}),this._currentStuckCount>=this.config.stuckCount&&(this.emit(c.FPS_STUCK,this._payload),this._reset())):this._reset())}}},{key:"_reset",value:function(){this._payload=[],this._currentStuckCount=0}},{key:"_checkDecodeFPS",value:function(){var t=this.player.media||this.player.video;if(t){var e=t.getVideoPlaybackQuality(),n=e.totalVideoFrames,r=e.droppedVideoFrames,o=performance.now();if(n&&this._lastCheckPoint){var l=n-this._lastDecodedFrames,c=o-this._lastCheckPoint;this._checkStuck(l,n,r,c)}this._lastDecodedFrames=n,this._lastCheckPoint=o}}},{key:"destroy",value:function(){this._stopTick()}}],[{key:"pluginName",get:function(){return"FpsDetect"}},{key:"defaultConfig",get:function(){return{disabled:!1,tick:1e3,stuckCount:3,reportFrame:0}}}]),n}(d.b);$e.a.use(Ie.a);var Ge=Object(r.c)((function t(e,n){var l,c,h;Object(r.b)(this,t);var d=n&&"mobile"===n.isMobileSimulateMode,f=n.isLive,m=[].concat(f?[]:[Nt,wt,Ce,Se,Ft],[Rt,Mt,Gt,Qt,he,de,ee,ie,$t,zt]),v=[C,A,x,_t,P,me,ye,_e,X];this.plugins=[Me,_].concat(Object(r.k)(m),v,[Fe,Ne]);var y=d?"mobile":o.a.device;switch(y){case"pc":(l=this.plugins).push.apply(l,[kt,et,pe,Be,He]);break;case"mobile":(c=this.plugins).push.apply(c,[Tt]);break;default:(h=this.plugins).push.apply(h,[kt,et,pe])}(o.a.os.isIpad||"pc"===y)&&this.plugins.push(De),o.a.os.isIpad&&this.plugins.push(et),this.ignores=[],this.i18n=[]}))},3536:function(t,e,n){"use strict";n.d(e,"a",(function(){return H}));var r=n(3358),o=n(3520),l=n.n(o),c=n(3359),h=n(3421),d=n(3451),f=n(3372);function m(t,e){this&&this.emit&&("error"===t?this.errorHandler(t,e.error):this.emit(t,e))}var v=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;Object(r.b)(this,n),(o=e.call(this,t))._hasStart=!1,o._currentTime=0,o._duration=0,o._internalOp={},o._lastMuted=!1,o.vtype="MP4",o._rate=-1,o.mediaConfig=Object.assign({},{controls:!1,autoplay:t.autoplay,playsinline:t.playsinline,"x5-playsinline":t.playsinline,"webkit-playsinline":t.playsinline,"x5-video-player-fullscreen":t["x5-video-player-fullscreen"]||t.x5VideoPlayerFullscreen,"x5-video-orientation":t["x5-video-orientation"]||t.x5VideoOrientation,airplay:t.airplay,"webkit-airplay":t.airplay,tabindex:0|t.tabindex,mediaType:t.mediaType||"video","data-index":-1},t.videoConfig,t.videoAttributes);var l=t["x5-video-player-type"]||t.x5VideoPlayerType;return h.a.isWeixin&&h.a.os.isAndroid&&l&&(o.mediaConfig["x5-video-player-type"]=l,delete o.mediaConfig.playsinline,delete o.mediaConfig["webkit-playsinline"],delete o.mediaConfig["x5-playsinline"]),t.loop&&(o.mediaConfig.loop="loop"),t.autoplayMuted&&!Object.prototype.hasOwnProperty.call(o.mediaConfig,"muted")&&(o.mediaConfig.muted=!0),o.media=c.b.createDom(o.mediaConfig.mediaType,"",o.mediaConfig,""),t.defaultPlaybackRate&&(o.media.defaultPlaybackRate=o.media.playbackRate=t.defaultPlaybackRate),"Number"===c.b.typeOf(t.volume)&&(o.volume=t.volume),t.autoplayMuted&&(o.media.muted=!0,o._lastMuted=!0),t.autoplay&&(o.media.autoplay=!0),o._interval={},o.mediaEventMiddleware={},o.attachVideoEvents(),o}return Object(r.c)(n,[{key:"setEventsMiddleware",value:function(t){var e=this;Object.keys(t).map((function(n){e.mediaEventMiddleware[n]=t[n]}))}},{key:"removeEventsMiddleware",value:function(t){var e=this;Object.keys(t).map((function(t){delete e.mediaEventMiddleware[t]}))}},{key:"attachVideoEvents",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.media;this._evHandlers||(this._evHandlers=f.VIDEO_EVENTS.map((function(e){var n="on".concat(e.charAt(0).toUpperCase()).concat(e.slice(1));return"function"==typeof t[n]&&t.on(e,t[n]),Object(r.e)({},e,function(t,e){return function(n,r){var o={player:e,eventName:t,originalEvent:n,detail:n.detail||{},timeStamp:n.timeStamp,currentTime:e.currentTime,duration:e.duration,paused:e.paused,ended:e.ended,isInternalOp:!!e._internalOp[n.type],muted:e.muted,volume:e.volume,host:c.b.getHostFromUrl(e.currentSrc),vtype:e.vtype};if(e.removeInnerOP(n.type),"timeupdate"===t&&(e._currentTime=e.media&&e.media.currentTime),"ratechange"===t){var l=e.media?e.media.playbackRate:0;if(l&&e._rate===l)return;e._rate=e.media&&e.media.playbackRate}if("durationchange"===t&&(e._duration=e.media.duration),"volumechange"===t&&(o.isMutedChange=e._lastMuted!==e.muted,e._lastMuted=e.muted),"error"===t&&(o.error=r||e.video.error),e.mediaEventMiddleware[t]){var h=m.bind(e,t,o);try{e.mediaEventMiddleware[t].call(e,o,h)}catch(n){throw m.call(e,t,o),n}}else m.call(e,t,o)}}(e,t))}))),this._evHandlers.forEach((function(t){var n=Object.keys(t)[0];e.addEventListener(n,t[n],!1)}))}},{key:"detachVideoEvents",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.media;this._evHandlers.forEach((function(t){var n=Object.keys(t)[0];e.removeEventListener(n,t[n],!1)})),this._evHandlers.forEach((function(e){var n=Object.keys(e)[0],r="on".concat(n.charAt(0).toUpperCase()).concat(n.slice(1));"function"==typeof t[r]&&t.off(n,t[r])})),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(video,t){var e=this;video.removeAttribute("src"),video.load(),t.forEach((function(t,n){e.media.appendChild(c.b.createDom("source","",{src:"".concat(t.src),type:"".concat(t.type||""),"data-index":n+1}))}));var n=video.children;if(n){this._videoSourceCount=n.length,this._videoSourceIndex=n.length,this._vLoadeddata=function(t){e.emit(f.SOURCE_SUCCESS,{src:t.target.currentSrc,host:c.b.getHostFromUrl(t.target.currentSrc)})};for(var r=null,i=0;i<this._evHandlers.length;i++)if("error"===Object.keys(this._evHandlers[i])[0]){r=this._evHandlers[i];break}!this._sourceError&&(this._sourceError=function(t){var n=parseInt(t.target.getAttribute("data-index"),10);if(e._videoSourceIndex--,0===e._videoSourceIndex||n>=e._videoSourceCount){var o={code:4,message:"sources_load_error"};r?r.error(t,o):e.errorHandler("error",o)}var l=d.a[4];e.emit(f.SOURCE_ERROR,new d.b(e,{errorType:l,errorCode:4,errorMessage:"sources_load_error",mediaError:{code:4,message:"sources_load_error"},src:t.target.src}))});for(var o=0;o<n.length;o++)n[o].addEventListener("error",this._sourceError);video.addEventListener("loadeddata",this._vLoadeddata)}}},{key:"_detachSourceEvents",value:function(video){var t=video.children;if(t&&0!==t.length&&this._sourceError){for(var i=0;i<t.length;i++)t[i].removeEventListener("error",this._sourceError);for(;t.length>0;)video.removeChild(t[0]);this._vLoadeddata&&video.removeEventListener("loadeddata",this._vLoadeddata)}}},{key:"errorHandler",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.media&&(this.media.error||e)){var n=this.media.error||e,r=n.code?d.a[n.code]:"other";n.message;this.media.currentSrc||(n={code:6,message:"empty_src"}),this.emit(t,new d.b(this,{errorType:r,errorCode:n.code,errorMessage:n.message||"",mediaError:n}))}}},{key:"destroy",value:function(){for(var t in this.media&&(this.media.pause&&(this.media.pause(),this.media.muted=!0),this.media.removeAttribute("src"),this.media.load()),this._currentTime=0,this._duration=0,this.mediaConfig=null,this._interval)Object.prototype.hasOwnProperty.call(this._interval,t)&&(clearInterval(this._interval[t]),this._interval[t]=null);this.detachVideoEvents(),this.media=null,this.mediaEventMiddleware={},this.removeAllListeners()}},{key:"video",get:function(){return this.media},set:function(t){this.media=t}},{key:"play",value:function(){return this.media?this.media.play():null}},{key:"pause",value:function(){this.media&&this.media.pause()}},{key:"load",value:function(){this.media&&this.media.load()}},{key:"canPlayType",value:function(t){return!!this.media&&this.media.canPlayType(t)}},{key:"getBufferedRange",value:function(t){var e=[0,0];if(!this.media)return e;t||(t=this.media.buffered);var n=this.media.currentTime;if(t)for(var i=0,r=t.length;i<r&&(e[0]=t.start(i),e[1]=t.end(i),!(e[0]<=n&&n<=e[1]));i++);return e[0]-n<=0&&n-e[1]<=0?e:[0,0]}},{key:"autoplay",get:function(){return!!this.media&&this.media.autoplay},set:function(t){this.media&&(this.media.autoplay=t)}},{key:"buffered",get:function(){return this.media?this.media.buffered:null}},{key:"buffered2",get:function(){return this.media&&this.media.buffered?c.b.getBuffered2(this.media.buffered):null}},{key:"bufferedPoint",get:function(){var t={start:0,end:0};if(!this.media)return t;var e=this.media.buffered;if(!e||0===e.length)return t;for(var i=0;i<e.length;i++)if((e.start(i)<=this.currentTime||e.start(i)<.1)&&e.end(i)>=this.currentTime)return{start:e.start(i),end:e.end(i)};return t}},{key:"crossOrigin",get:function(){return this.media?this.media.crossOrigin:""},set:function(t){this.media&&(this.media.crossOrigin=t)}},{key:"currentSrc",get:function(){return this.media?this.media.currentSrc:""},set:function(t){this.media&&(this.media.currentSrc=t)}},{key:"currentTime",get:function(){return this.media?void 0!==this.media.currentTime?this.media.currentTime:this._currentTime:0},set:function(time){this.media&&(this.media.currentTime=time)}},{key:"defaultMuted",get:function(){return!!this.media&&this.media.defaultMuted},set:function(t){this.media&&(this.media.defaultMuted=t)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return!!this.media&&this.media.ended}},{key:"error",get:function(){return this.media.error}},{key:"errorNote",get:function(){if(!this.media.error)return"";return["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"][this.media.error.code-1]}},{key:"loop",get:function(){return!!this.media&&this.media.loop},set:function(t){this.media&&(this.media.loop=t)}},{key:"muted",get:function(){return!!this.media&&this.media.muted},set:function(t){this.media&&this.media.muted!==t&&(this._lastMuted=this.media.muted,this.media.muted=t)}},{key:"networkState",get:function(){return this.media.networkState}},{key:"paused",get:function(){return!this.media||this.media.paused}},{key:"playbackRate",get:function(){return this.media?this.media.playbackRate:0},set:function(t){this.media&&t!==1/0&&(this.media.defaultPlaybackRate=t,this.media.playbackRate=t)}},{key:"played",get:function(){return this.media?this.media.played:null}},{key:"preload",get:function(){return!!this.media&&this.media.preload},set:function(t){this.media&&(this.media.preload=t)}},{key:"readyState",get:function(){return this.media.readyState}},{key:"seekable",get:function(){return!!this.media&&this.media.seekable}},{key:"seeking",get:function(){return!!this.media&&this.media.seeking}},{key:"src",get:function(){return this.media?this.media.src:""},set:function(t){this.media&&(this.emit(f.URL_CHANGE,t),this.emit(f.WAITING),this._currentTime=0,this._duration=0,c.b.isMSE(this.media)?this.onWaiting():(this._detachSourceEvents(this.media),"Array"===c.b.typeOf(t)?this._attachSourceEvents(this.media,t):t?this.media.src=t:this.media.removeAttribute("src"),this.load()))}},{key:"volume",get:function(){return this.media?this.media.volume:0},set:function(t){t!==1/0&&this.media&&(this.media.volume=t)}},{key:"aspectRatio",get:function(){return this.media?this.media.videoWidth/this.media.videoHeight:0}},{key:"addInnerOP",value:function(t){this._internalOp[t]=!0}},{key:"removeInnerOP",value:function(t){delete this._internalOp[t]}},{key:"emit",value:function(t,data){for(var e,o=arguments.length,l=new Array(o>2?o-2:0),c=2;c<o;c++)l[c-2]=arguments[c];(e=Object(r.f)(Object(r.g)(n.prototype),"emit",this)).call.apply(e,[this,t,data].concat(l))}},{key:"on",value:function(t,e){for(var o,l=arguments.length,c=new Array(l>2?l-2:0),h=2;h<l;h++)c[h-2]=arguments[h];(o=Object(r.f)(Object(r.g)(n.prototype),"on",this)).call.apply(o,[this,t,e].concat(c))}},{key:"once",value:function(t,e){for(var o,l=arguments.length,c=new Array(l>2?l-2:0),h=2;h<l;h++)c[h-2]=arguments[h];(o=Object(r.f)(Object(r.g)(n.prototype),"once",this)).call.apply(o,[this,t,e].concat(c))}},{key:"off",value:function(t,e){for(var o,l=arguments.length,c=new Array(l>2?l-2:0),h=2;h<l;h++)c[h-2]=arguments[h];(o=Object(r.f)(Object(r.g)(n.prototype),"off",this)).call.apply(o,[this,t,e].concat(c))}},{key:"offAll",value:function(){Object(r.f)(Object(r.g)(n.prototype),"removeAllListeners",this).call(this)}}]),n}(l.a),y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};Object(r.b)(this,t),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=e}return Object(r.c)(t,[{key:"openDB",value:function(t){var e=this,n=this,r=this.myDB.version||1,o=n.indexedDB.open(n.myDB.name,r);o.onerror=function(t){},o.onsuccess=function(r){e.myDB.db=r.target.result,t.call(n)},o.onupgradeneeded=function(t){var e=t.target.result;t.target.transaction,e.objectStoreNames.contains(n.myDB.ojstore.name)||e.createObjectStore(n.myDB.ojstore.name,{keyPath:n.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){this.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(t,data){for(var e,n=this.myDB.db.transaction(t,"readwrite").objectStore(t),i=0;i<data.length;i++)(e=n.add(data[i])).onerror=function(){},e.onsuccess=function(){}}},{key:"putData",value:function(t,data){for(var e,n=this.myDB.db.transaction(t,"readwrite").objectStore(t),i=0;i<data.length;i++)(e=n.put(data[i])).onerror=function(){},e.onsuccess=function(){}}},{key:"getDataByKey",value:function(t,e,n){var r=this,o=this.myDB.db.transaction(t,"readwrite").objectStore(t).get(e);o.onerror=function(){n.call(r,null)},o.onsuccess=function(t){var e=t.target.result;n.call(r,e)}}},{key:"deleteData",value:function(t,e){this.myDB.db.transaction(t,"readwrite").objectStore(t).delete(e)}},{key:"clearData",value:function(t){this.myDB.db.transaction(t,"readwrite").objectStore(t).clear()}}]),t}(),T=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],E=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],k=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],S="data-xgplayerid",_=n(3369),L=n(3437),C=function(){function t(){var e=this;if(Object(r.b)(this,t),Object(r.e)(this,"__trigger",(function(t){var n=(new Date).getTime();e.timeStamp=n;for(var i=0;i<t.length;i++)e.__runHandler(t[i].target)})),this.__handlers=[],this.timeStamp=0,this.observer=null,window.ResizeObserver)try{this.observer=new window.ResizeObserver(Object(c.d)(this.__trigger,100,{trailing:!0})),this.timeStamp=(new Date).getTime()}catch(t){console.error(t)}}return Object(r.c)(t,[{key:"addObserver",value:function(t,e){if(this.observer){this.observer&&this.observer.observe(t);for(var n=t.getAttribute(S),r=this.__handlers,o=-1,i=0;i<r.length;i++)r[i]&&t===r[i].target&&(o=i);o>-1?this.__handlers[o].handler=e:this.__handlers.push({target:t,handler:e,playerId:n})}}},{key:"unObserver",value:function(t){var i=-1;this.__handlers.map((function(e,n){t===e.target&&(i=n)}));try{this.observer&&this.observer.unobserve(t)}catch(t){}this.observer&&this.observer.unobserve(t),i>-1&&this.__handlers.splice(i,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(t){for(var e=this.__handlers,i=0;i<e.length;i++)if(e[i]&&t===e[i].target){try{e[i].handler(t)}catch(t){console.error(t)}return!0}return!1}}]),t}(),A=null;var w={pluginGroup:{},init:function(t){var e,n,r=t._pluginInfoId;r||(r=(new Date).getTime(),t._pluginInfoId=r),!t.config.closeResizeObserver&&(e=t.root,n=function(){t.resize()},A||(A=new C),A.addObserver(e,n)),this.pluginGroup[r]={_originalOptions:t.config||{},_plugins:{}}},formatPluginInfo:function(t,e){var n=null,r=null;return t.plugin&&"function"==typeof t.plugin?(n=t.plugin,r=t.options):(n=t,r={}),e&&(r.config=e||{}),{PLUFGIN:n,options:r}},checkPluginIfExits:function(t,e){for(var i=0;i<e.length;i++)if(t.toLowerCase()===e[i].pluginName.toLowerCase())return!0;return!1},getRootByConfig:function(t,e){for(var n=Object.keys(e),r=null,i=0;i<n.length;i++)if(t.toLowerCase()===n[i].toLowerCase()){r=e[n[i]];break}return"Object"===c.b.typeOf(r)?{root:r.root,position:r.position}:{}},lazyRegister:function(t,e){var n=this,r=e.timeout||1500;return Promise.race([e.loader().then((function(e){var r;r=e&&e.__esModule?e.default:e,n.register(t,r,e.options)})),new Promise((function(t,e){setTimeout((function(){e(new Error("timeout"))}),r)}))])},register:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&e&&"function"==typeof e&&void 0!==e.prototype){var r=t._pluginInfoId;if(r&&this.pluginGroup[r]){this.pluginGroup[r]._plugins||(this.pluginGroup[r]._plugins={});var o=this.pluginGroup[r]._plugins,l=this.pluginGroup[r]._originalOptions;n.player=t;var h=n.pluginName||e.pluginName;if(!h)throw new Error("The property pluginName is necessary");if(!e.isSupported||e.isSupported(t.config.mediaType,t.config.codecType)){n.config||(n.config={});for(var d=Object.keys(l),i=0;i<d.length;i++)if(h.toLowerCase()===d[i].toLowerCase()){var f=l[d[i]];"Object"===c.b.typeOf(f)?n.config=Object.assign({},n.config,l[d[i]]):"Boolean"===c.b.typeOf(f)&&(n.config.disable=!f);break}e.defaultConfig&&Object.keys(e.defaultConfig).forEach((function(t){void 0===n.config[t]&&(n.config[t]=e.defaultConfig[t])})),n.root?"string"==typeof n.root&&(n.root=t[n.root]):n.root=t.root,n.index=n.config.index||0;try{o[h.toLowerCase()]&&(this.unRegister(r,h.toLowerCase()),console.warn("the is one plugin with same pluginName [".concat(h,"] exist, destroy the old instance")));var m=new e(n);return o[h.toLowerCase()]=m,o[h.toLowerCase()].func=e,m&&"function"==typeof m.afterCreate&&m.afterCreate(),m}catch(t){throw console.error(t),t}}else console.warn("not supported plugin [".concat(h,"]"))}}},unRegister:function(t,e){t._pluginInfoId&&(t=t._pluginInfoId),e=e.toLowerCase();try{var n=this.pluginGroup[t]._plugins[e];n&&(n.pluginName&&n.__destroy(),delete this.pluginGroup[t]._plugins[e])}catch(n){console.error("[unRegister:".concat(e,"] cgid:[").concat(t,"] error"),n)}},deletePlugin:function(t,e){var n=t._pluginInfoId;n&&this.pluginGroup[n]&&this.pluginGroup[n]._plugins&&delete this.pluginGroup[n]._plugins[e]},getPlugins:function(t){var e=t._pluginInfoId;return e&&this.pluginGroup[e]?this.pluginGroup[e]._plugins:{}},findPlugin:function(t,e){var n=t._pluginInfoId;if(!n||!this.pluginGroup[n])return null;var r=e.toLowerCase();return this.pluginGroup[n]._plugins[r]},beforeInit:function(t){var e=this;function n(t){return t&&t.then?t:new Promise((function(t){t()}))}return new Promise((function(r){if(e.pluginGroup)return(t._loadingPlugins&&t._loadingPlugins.length?Promise.all(t._loadingPlugins):Promise.resolve()).then((function(){var o=t._pluginInfoId;if(e.pluginGroup[o]){var l=e.pluginGroup[o]._plugins,c=[];Object.keys(l).forEach((function(t){if(l[t]&&l[t].beforePlayerInit)try{var e=l[t].beforePlayerInit();c.push(n(e))}catch(t){throw c.push(n(null)),t}})),Promise.all([].concat(c)).then((function(){r()})).catch((function(t){console.error(t),r()}))}else r()}))}))},afterInit:function(t){var e=t._pluginInfoId;if(e&&this.pluginGroup[e]){var n=this.pluginGroup[e]._plugins;Object.keys(n).forEach((function(t){n[t]&&n[t].afterPlayerInit&&n[t].afterPlayerInit()}))}},setLang:function(t,e){var n=e._pluginInfoId;if(n&&this.pluginGroup[n]){var r=this.pluginGroup[n]._plugins;Object.keys(r).forEach((function(e){if(r[e].updateLang)r[e].updateLang(t);else try{r[e].lang=t}catch(t){console.warn("".concat(e," setLang"))}}))}},reRender:function(t){var e=this,n=t._pluginInfoId;if(n&&this.pluginGroup[n]){var r=[],o=this.pluginGroup[n]._plugins;Object.keys(o).forEach((function(t){"controls"!==t&&o[t]&&(r.push({plugin:o[t].func,options:o[t].__args}),e.unRegister(n,t))})),r.forEach((function(n){e.register(t,n.plugin,n.options)}))}},onPluginsReady:function(t){var e=t._pluginInfoId;if(e&&this.pluginGroup[e]){var n=this.pluginGroup[e]._plugins||{};Object.keys(n).forEach((function(t){n[t].onPluginsReady&&"function"==typeof n[t].onPluginsReady&&n[t].onPluginsReady()}))}},destroy:function(t){var e=t._pluginInfoId;if(this.pluginGroup[e]){var n,r;n=t.root,A.unObserver(n,r);for(var o=this.pluginGroup[e]._plugins,l=0,c=Object.keys(o);l<c.length;l++){var h=c[l];this.unRegister(e,h)}delete this.pluginGroup[e],delete t._pluginInfoId}}},O=n(3445);function R(){return{id:"",el:null,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!0,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},preProcessUrl:null,ignores:[],whitelist:[],inactive:3e3,lang:Object(c.c)(),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],tabindex:0,thumbnail:null,videoConfig:{},isHideTips:!1,minWaitDelay:200,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}var D=n(3492),I=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){var t;Object(r.b)(this,n);for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return t=e.call.apply(e,[this].concat(l)),Object(r.e)(Object(r.a)(t),"onMouseEnter",(function(e){var n=Object(r.a)(t),o=n.player;n.playerConfig.closeControlsBlur&&o.focus({autoHide:!1})})),Object(r.e)(Object(r.a)(t),"onMouseLeave",(function(e){Object(r.a)(t).player.focus()})),t}return Object(r.c)(n,[{key:"beforeCreate",value:function(t){t.config.mode||"mobile"!==h.a.device||(t.config.mode="flex"),t.player.config.marginControls&&(t.config.autoHide=!1)}},{key:"afterCreate",value:function(){var t=this,e=this.config,n=e.disable,r=e.height,o=e.mode;if(!n){"flex"===o&&this.player.addClass(O.a.FLEX_CONTROLS);var style={height:"".concat(r,"px")};Object.keys(style).map((function(e){t.root.style[e]=style[e]})),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on(f.MINI_STATE_CHANGE,(function(e){e?c.b.addClass(t.root,"mini-controls"):c.b.removeClass(t.root,"mini-controls")}));var l=this.playerConfig.isMobileSimulateMode;"mobile"!==h.a.device&&"mobile"!==l&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&c.b.addClass(this.root,O.a.CONTROLS_AUTOHIDE)}},{key:"pauseAutoHide",value:function(){c.b.removeClass(this.root,O.a.CONTROLS_AUTOHIDE)}},{key:"show",value:function(t){this.root.style.display="",this.player.focus()}},{key:"hide",value:function(){this.root.style.display="none"}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(this.root){var l=t.defaultConfig||{};if(!e.root){switch(e.position?e.position:e.config&&e.config.position?e.config.position:l.position){case _.a.CONTROLS_LEFT:e.root=this.left;break;case _.a.CONTROLS_RIGHT:e.root=this.right;break;case _.a.CONTROLS_CENTER:e.root=this.center;break;case _.a.CONTROLS:e.root=this.root;break;default:e.root=this.left}return Object(r.f)(Object(r.g)(n.prototype),"registerPlugin",this).call(this,t,e,o)}}}},{key:"destroy",value:function(){"mobile"!==h.a.device&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave))}},{key:"render",value:function(){var t=this.config,e=t.mode,n=t.autoHide,o=t.initShow;if(!t.disable){var l=c.b.classNames({"xgplayer-controls":!0},{"flex-controls":"flex"===e},{"bottom-controls":"bottom"===e},Object(r.e)({},O.a.CONTROLS_AUTOHIDE,n),{"xgplayer-controls-initshow":o||!n});return'<xg-controls class="'.concat(l,'" unselectable="on">\n    <xg-inner-controls class="xg-inner-controls xg-pos">\n      <xg-left-grid class="xg-left-grid">\n      </xg-left-grid>\n      <xg-center-grid class="xg-center-grid"></xg-center-grid>\n      <xg-right-grid class="xg-right-grid">\n      </xg-right-grid>\n    </xg-inner-controls>\n    </xg-controls>')}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}]),n}(_.b),x=n(3368),P=n(3455),M=n(3572),F=n(3476),N=n(3494),j=["play","pause","replay","retry"],U=0,B=0,$=null,H=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(t){var o;Object(r.b)(this,n);var l=c.b.deepMerge(R(),t);o=e.call(this,l),Object(r.e)(Object(r.a)(o),"canPlayFunc",(function(){if(o.config){var t=o.config,e=t.autoplay,n=t.defaultPlaybackRate;x.b.logInfo("player","canPlayFunc, startTime",o.__startTime),o._seekToStartTime(),o.playbackRate=n,(e||o._useAutoplay)&&o.mediaPlay(),o.off(f.CANPLAY,o.canPlayFunc),o.removeClass(O.a.ENTER)}})),Object(r.e)(Object(r.a)(o),"onFullscreenChange",(function(t,e){var n=function(){c.b.setTimeout(Object(r.a)(o),(function(){o.resize()}),100)},l=c.b.getFullScreenEl();o._fullActionFrom?o._fullActionFrom="":o.emit(f.USER_ACTION,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:o.currentTime,duration:o.duration,props:[{prop:"fullscreen",from:!0,to:!1}]});var h=Object(c.a)(l,o.playerId,S);if(e||l&&(l===o._fullscreenEl||h))n(),!o.config.closeFocusVideoFocus&&o.media.focus(),o.fullscreen=!0,o.changeFullStyle(o.root,l,O.a.FULLSCREEN),o.emit(f.FULLSCREEN_CHANGE,!0,o._fullScreenOffset),o.cssfullscreen&&o.exitCssFullscreen();else if(o.fullscreen){n();var d=Object(r.a)(o),m=d._fullScreenOffset;if(d.config.needFullscreenScroll?(window.scrollTo(m.left,m.top),c.b.setTimeout(Object(r.a)(o),(function(){o.fullscreen=!1,o._fullScreenOffset=null}),100)):(!o.config.closeFocusVideoFocus&&o.media.focus(),o.fullscreen=!1,o._fullScreenOffset=null),o.cssfullscreen)o.removeClass(O.a.FULLSCREEN);else{var v=o._fullscreenEl;v||!o.root.contains(t.target)&&t.target!==o.root||(v=t.target),o.recoverFullStyle(o.root,v,O.a.FULLSCREEN)}o._fullscreenEl=null,o.emit(f.FULLSCREEN_CHANGE,!1)}})),Object(r.e)(Object(r.a)(o),"_onWebkitbeginfullscreen",(function(t){o._fullscreenEl=o.media,o.onFullscreenChange(t,!0)})),Object(r.e)(Object(r.a)(o),"_onWebkitendfullscreen",(function(t){o.onFullscreenChange(t,!1)})),Object(D.a)(Object(r.a)(o),j),o.config=l,o._pluginInfoId=c.b.generateSessionId(),Object(x.a)(Object(r.a)(o));var d=o.constructor.defaultPreset;if(o.config.presets.length){var m=o.config.presets.indexOf("default");m>=0&&d&&(o.config.presets[m]=d)}else d&&o.config.presets.push(d);if(o.userTimer=null,o.waitTimer=null,o.handleSource=!0,o._state=F.a.INITIAL,o.isError=!1,o._hasStart=!1,o.isSeeking=!1,o.isCanplay=!1,o._useAutoplay=!1,o.__startTime=-1,o.rotateDeg=0,o.isActive=!1,o.fullscreen=!1,o.cssfullscreen=!1,o.isRotateFullscreen=!1,o._fullscreenEl=null,o.timeSegments=[],o._cssfullscreenEl=null,o.curDefinition=null,o._orgCss="",o._fullScreenOffset=null,o._videoHeight=0,o._videoWidth=0,o.videoPos={pi:1,scale:0,rotate:-1,x:0,y:0,h:-1,w:-1,vy:0,vx:0},o.sizeInfo={width:0,height:0,left:0,top:0},o._accPlayed={t:0,acc:0,loopAcc:0},o._offsetInfo={currentTime:-1,duration:0},o.innerContainer=null,o.controls=null,o.topBar=null,o.root=null,o.__i18n=P.a.init(o._pluginInfoId),h.a.os.isAndroid&&h.a.osVersion>0&&h.a.osVersion<6&&(o.config.autoplay=!1),o.database=new y,o.isUserActive=!1,o._onceSeekCanplay=null,o._isPauseBeforeSeek=0,o.innerStates={isActiveLocked:!1},o.instManager=$,!o._initDOM())return console.error(new Error("can't find the dom which id is ".concat(o.config.id," or this.config.el does not exist"))),Object(r.j)(o);var v=o.config,T=v.definition,E=void 0===T?{}:T;if(!v.url&&E.list&&E.list.length>0){var k=E.list.find((function(t){return t.definition&&t.definition===E.defaultDefinition}));k||(E.defaultDefinition=E.list[0].definition,k=E.list[0]),o.config.url=k.url,o.curDefinition=k}return o._bindEvents(),o._registerPresets(),o._registerPlugins(),w.onPluginsReady(Object(r.a)(o)),o.getInitDefinition(),o.setState(F.a.READY),c.b.setTimeout(Object(r.a)(o),(function(){o.emit(f.READY)}),0),o.onReady&&o.onReady(),(o.config.videoInit||o.config.autoplay)&&(!o.hasStart||o.state<F.a.ATTACHED)&&o.start(),o}return Object(r.c)(n,[{key:"_initDOM",value:function(){var t,e=this;if(this.root=this.config.id?document.getElementById(this.config.id):null,!this.root){var n=this.config.el;if(!n||1!==n.nodeType)return this.emit(f.ERROR,new d.b("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1;this.root=n}var r=Object(N.b)(this.root);r&&(x.b.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),r.destroy()),this.root.setAttribute(S,this.playerId),null===(t=$)||void 0===t||t.add(this),w.init(this),this._initBaseDoms();var o=this.constructor.XgVideoProxy;if(o&&this.mediaConfig.mediaType===o.mediaType){var l=this.innerContainer||this.root;this.detachVideoEvents(this.media);var c=new o(l,this.config,this.mediaConfig);this.attachVideoEvents(c),this.media=c}if(this.media.setAttribute(S,this.playerId),this.config.controls){var m=this.config.controls.root||null,v=w.register(this,I,{root:m});this.controls=v}var y="mobile"===this.config.isMobileSimulateMode?"mobile":h.a.device;if(this.addClass("".concat(O.a.DEFAULT," ").concat(O.a.INACTIVE," xgplayer-").concat(y," ").concat(this.config.controls?"":O.a.NO_CONTROLS)),this.config.autoplay?this.addClass(O.a.ENTER):this.addClass(O.a.NO_START),this.config.fluid){var T=this.config,E=T.width,k=T.height;"number"==typeof E&&"number"==typeof k||(E=600,k=337.5);var style={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(100*k/E,"%")};Object.keys(style).forEach((function(t){e.root.style[t]=style[t]}))}else["width","height"].forEach((function(t){e.config[t]&&("number"!=typeof e.config[t]?e.root.style[t]=e.config[t]:e.root.style[t]="".concat(e.config[t],"px"))}));var _=this.root.getBoundingClientRect(),L=_.width,C=_.height,A=_.left,R=_.top;return this.sizeInfo.width=L,this.sizeInfo.height=C,this.sizeInfo.left=A,this.sizeInfo.top=R,!0}},{key:"_initBaseDoms",value:function(){this.topBar=null,this.leftBar=null,this.rightBar=null,this.config.marginControls&&(this.innerContainer=c.b.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer))}},{key:"_bindEvents",value:function(){var t=this;["focus","blur"].forEach((function(e){t.on(e,t["on"+e.charAt(0).toUpperCase()+e.slice(1)])})),T.forEach((function(e){document&&document.addEventListener(e,t.onFullscreenChange)})),h.a.os.isIos&&(this.media.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(f.LOADED_DATA,this.resize),this.playFunc=function(){t.config.closeFocusVideoFocus||t.media.focus()},this.once(f.PLAY,this.playFunc)}},{key:"_unbindEvents",value:function(){var t=this;this.root.removeEventListener("mousemove",this.mousemoveFunc),T.forEach((function(e){document.removeEventListener(e,t.onFullscreenChange)})),this.playFunc&&this.off(f.PLAY,this.playFunc),this.off(f.CANPLAY,this.canPlayFunc),this.media.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}},{key:"_clearUserTimer",value:function(){this.userTimer&&(c.b.clearTimeout(this,this.userTimer),this.userTimer=null)}},{key:"_startInit",value:function(t){var e=this;if(this.media&&(t&&""!==t&&("Array"!==c.b.typeOf(t)||0!==t.length)||(t="",this.emit(f.URL_NULL),x.b.logWarn("config.url is null, please get url and run player._startInit(url)"),!this.config.nullUrlStart))){this.handleSource&&(this._detachSourceEvents(this.media),"Array"===c.b.typeOf(t)&&t.length>0?this._attachSourceEvents(this.media,t):this.media.src&&this.media.src===t?t||this.media.removeAttribute("src"):this.media.src=t),"Number"===c.b.typeOf(this.config.volume)&&(this.volume=this.config.volume);var n=this.innerContainer?this.innerContainer:this.root;this.media instanceof window.Element&&!n.contains(this.media)&&n.insertBefore(this.media,n.firstChild);var r=this.media.readyState;x.b.logInfo("_startInit readyState",r),this.config.autoplay&&(!c.b.isMSE(this.media)&&this.load(),(h.a.os.isIpad||h.a.os.isPhone)&&this.mediaPlay());var o=this.config.startTime;this.__startTime=o>0?o:-1,this.config.startTime=0,r>=2&&this.duration>0?this.canPlayFunc():this.on(f.CANPLAY,this.canPlayFunc),(!this.hasStart||this.state<F.a.ATTACHED)&&w.afterInit(this),this.hasStart=!0,this.setState(F.a.ATTACHED),c.b.setTimeout(this,(function(){e.emit(f.COMPLETE)}),0)}}},{key:"_registerPlugins",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._loadingPlugins=[];var n=this.config.ignores||[],r=this.config.plugins||[],o=this.config.i18n||[];e&&P.a.extend(o,this.__i18n);var l=n.join("||").toLowerCase().split("||"),c=this.plugins;r.forEach((function(n){try{var r=n.plugin?n.plugin.pluginName:n.pluginName;if(r&&l.indexOf(r.toLowerCase())>-1)return null;if(!e&&c[r.toLowerCase()])return;if(n.lazy&&n.loader){var o=w.lazyRegister(t,n);return void(n.forceBeforeInit&&(o.then((function(){t._loadingPlugins.splice(t._loadingPlugins.indexOf(o),1)})).catch((function(e){x.b.logError("_registerPlugins:loadingPlugin",e),t._loadingPlugins.splice(t._loadingPlugins.indexOf(o),1)})),t._loadingPlugins.push(o)))}return t.registerPlugin(n)}catch(t){x.b.logError("_registerPlugins:",t)}}))}},{key:"_registerPresets",value:function(){var t=this;this.config.presets.forEach((function(e){!function(t,e){var n,o,l=e.preset&&e.options?new e.preset(e.options,t.config):new e({},t.config),c=l.plugins,h=void 0===c?[]:c,d=l.ignores,f=void 0===d?[]:d,m=l.icons,v=void 0===m?{}:m,y=l.i18n,T=void 0===y?[]:y;t.config.plugins||(t.config.plugins=[]),t.config.ignores||(t.config.ignores=[]),(n=t.config.plugins).push.apply(n,Object(r.k)(h)),(o=t.config.ignores).push.apply(o,Object(r.k)(f)),Object.keys(v).map((function(e){t.config.icons[e]||(t.config.icons[e]=v[e])}));var E=t.config.i18n||[];T.push.apply(T,Object(r.k)(E)),t.config.i18n=T}(t,e)}))}},{key:"_getRootByPosition",value:function(t){var e=null;switch(t){case _.a.ROOT_RIGHT:this.rightBar||(this.rightBar=c.b.createPositionBar("xg-right-bar",this.root)),e=this.rightBar;break;case _.a.ROOT_LEFT:this.leftBar||(this.leftBar=c.b.createPositionBar("xg-left-bar",this.root)),e=this.leftBar;break;case _.a.ROOT_TOP:this.topBar||(this.topBar=c.b.createPositionBar("xg-top-bar",this.root),this.config.topBarAutoHide&&c.b.addClass(this.topBar,O.a.TOP_BAR_AUTOHIDE)),e=this.topBar;break;default:e=this.innerContainer||this.root}return e}},{key:"registerPlugin",value:function(t,e){var n=w.formatPluginInfo(t,e),r=n.PLUFGIN,o=n.options,l=this.config.plugins;!w.checkPluginIfExits(r.pluginName,l)&&l.push(r);var c=w.getRootByConfig(r.pluginName,this.config);c.root&&(o.root=c.root),c.position&&(o.position=c.position);var h=o.position?o.position:o.config&&o.config.position||r.defaultConfig&&r.defaultConfig.position;return!o.root&&"string"==typeof h&&h.indexOf("controls")>-1?this.controls&&this.controls.registerPlugin(r,o,r.pluginName):(o.root||(o.root=this._getRootByPosition(h)),w.register(this,r,o))}},{key:"deregister",value:function(t){"string"==typeof t?w.unRegister(this,t):t instanceof L.a&&w.unRegister(this,t.pluginName)}},{key:"unRegisterPlugin",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.deregister(t),e&&this.removePluginFromConfig(t)}},{key:"removePluginFromConfig",value:function(t){var e;if("string"==typeof t?e=t:t instanceof L.a&&(e=t.pluginName),e)for(var i=this.config.plugins.length-1;i>-1;i--){if(this.config.plugins[i].pluginName.toLowerCase()===e.toLowerCase()){this.config.plugins.splice(i,1);break}}}},{key:"plugins",get:function(){return w.getPlugins(this)}},{key:"getPlugin",value:function(t){var e=w.findPlugin(this,t);return e&&e.pluginName?e:null}},{key:"addClass",value:function(t){this.root&&(c.b.hasClass(this.root,t)||c.b.addClass(this.root,t))}},{key:"removeClass",value:function(t){this.root&&c.b.removeClass(this.root,t)}},{key:"hasClass",value:function(t){if(this.root)return c.b.hasClass(this.root,t)}},{key:"setAttribute",value:function(t,e){this.root&&this.root.setAttribute(t,e)}},{key:"removeAttribute",value:function(t,e){this.root&&this.root.removeAttribute(t,e)}},{key:"start",value:function(t){var e=this;if(!(this.state>F.a.ATTACHING))return t||this.config.url||this.getInitDefinition(),this.hasStart=!0,this.setState(F.a.ATTACHING),this._registerPlugins(!1),w.beforeInit(this).then((function(){if(e.config){t||(t=e.url||e.config.url);var n=e._preProcessUrl(t);return e._startInit(n.url)}})).catch((function(t){throw t.fileName="player",t.lineNumber="236",x.b.logError("start:beforeInit:",t),t}))}},{key:"switchURL",value:function(t,e){var n=this,r=t;"Object"===c.b.typeOf(t)&&(r=t.url),r=this._preProcessUrl(r).url;var o=this.currentTime;this.__startTime=o;var l=this.paused&&!this.isError;return this.src=r,new Promise((function(t,e){var o=function(t){n.off("timeupdate",c),n.off("canplay",c),e(t)},c=function(){n._seekToStartTime(),l&&n.pause(),n.off("error",o),t(!0)};n.once("error",o),r?(h.a.os.isAndroid?n.once("timeupdate",c):n.once("canplay",c),n.play()):n.errorHandler("error",{code:6,message:"empty_src"})}))}},{key:"videoPlay",value:function(){this.mediaPlay()}},{key:"mediaPlay",value:function(){var t=this;if(!this.hasStart&&this.state<F.a.ATTACHED)return this.removeClass(O.a.NO_START),this.addClass(O.a.ENTER),this.start(),void(this._useAutoplay=!0);this.state<F.a.RUNNING&&(this.removeClass(O.a.NO_START),!this.isCanplay&&this.addClass(O.a.ENTER));var e=Object(r.f)(Object(r.g)(n.prototype),"play",this).call(this);return void 0!==e&&e&&e.then?e.then((function(){t.removeClass(O.a.NOT_ALLOW_AUTOPLAY),t.addClass(O.a.PLAYING),t.state<F.a.RUNNING&&(x.b.logInfo(">>>>playPromise.then"),t.setState(F.a.RUNNING),t.emit(f.AUTOPLAY_STARTED))})).catch((function(e){if(x.b.logWarn(">>>>playPromise.catch",e.name),t.media&&t.media.error)return t.onError(),void t.removeClass(O.a.ENTER);"NotAllowedError"===e.name&&(t._errorTimer=c.b.setTimeout(t,(function(){t._errorTimer=null,t.emit(f.AUTOPLAY_PREVENTED),t.addClass(O.a.NOT_ALLOW_AUTOPLAY),t.removeClass(O.a.ENTER),t.pause(),t.setState(F.a.NOTALLOW)}),0))})):(x.b.logWarn("video.play not return promise"),this.state<F.a.RUNNING&&(this.setState(F.a.RUNNING),this.removeClass(O.a.NOT_ALLOW_AUTOPLAY),this.removeClass(O.a.NO_START),this.removeClass(O.a.ENTER),this.addClass(O.a.PLAYING),this.emit(f.AUTOPLAY_STARTED))),e}},{key:"mediaPause",value:function(){Object(r.f)(Object(r.g)(n.prototype),"pause",this).call(this)}},{key:"videoPause",value:function(){Object(r.f)(Object(r.g)(n.prototype),"pause",this).call(this)}},{key:"play",value:function(){var t=this;return this.removeClass(O.a.PAUSED),Object(D.f)(this,"play",(function(){return t.mediaPlay()}))}},{key:"pause",value:function(){var t=this;Object(D.f)(this,"pause",(function(){Object(r.f)(Object(r.g)(n.prototype),"pause",t).call(t)}))}},{key:"seek",value:function(time,t){var e=this;if(this.media&&!Number.isNaN(Number(time))&&this.hasStart){var n=this.config,r=n.isSeekedPlay,o=n.seekedStatus,l=t||(r?"play":o);time=time<0?0:time>this.duration?parseInt(this.duration,10):time,!this._isPauseBeforeSeek&&(this._isPauseBeforeSeek=this.paused?2:1),this._onceSeekCanplay&&this.off(f.SEEKED,this._onceSeekCanplay),this._onceSeekCanplay=function(){switch(e.removeClass(O.a.ENTER),e.isSeeking=!1,l){case"play":e.play();break;case"pause":e.pause();break;default:e._isPauseBeforeSeek>1||e.paused?e.pause():e.play()}e._isPauseBeforeSeek=0,e._onceSeekCanplay=null},this.once(f.SEEKED,this._onceSeekCanplay),this.state<F.a.RUNNING?(this.removeClass(O.a.NO_START),this.currentTime=time,this.play()):this.currentTime=time}}},{key:"getInitDefinition",value:function(){var t=this,e=this.config,n=e.definition;!e.url&&n&&n.list&&n.list.length>0&&n.defaultDefinition&&n.list.map((function(e){e.definition===n.defaultDefinition&&(t.config.url=e.url,t.curDefinition=e)}))}},{key:"changeDefinition",value:function(t,e){var n=this,o=this.config.definition;if(Array.isArray(null==o?void 0:o.list)&&o.list.forEach((function(e){(null==t?void 0:t.definition)===e.definition&&(n.curDefinition=e)})),null!=t&&t.bitrate&&"number"!=typeof t.bitrate&&(t.bitrate=parseInt(t.bitrate,10)||0),this.emit(f.DEFINITION_CHANGE,{from:e,to:t}),this.hasStart){var l=this.switchURL(t.url,Object(r.i)({seamless:!1!==o.seamless&&"undefined"!=typeof MediaSource&&"function"==typeof MediaSource.isTypeSupported},t));l&&l.then?l.then((function(){n.emit(f.AFTER_DEFINITION_CHANGE,{from:e,to:t})})):this.emit(f.AFTER_DEFINITION_CHANGE,{from:e,to:t})}else this.config.url=t.url}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(f.LOADED_DATA,this.reloadFunc)}},{key:"resetState",value:function(){var t=this,e=[O.a.NOT_ALLOW_AUTOPLAY,O.a.PLAYING,O.a.NO_START,O.a.PAUSED,O.a.REPLAY,O.a.ENTER,O.a.ENDED,O.a.ERROR,O.a.LOADING];this.hasStart=!1,this.isError=!1,this._useAutoplay=!1,this.mediaPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,e.forEach((function(e){t.removeClass(e)})),this.addClass(O.a.NO_START),this.emit(f.RESET)}},{key:"reset",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;if(this.resetState(),this.plugins&&(e.map((function(e){t.deregister(e)})),n)){var r=R();Object.keys(this.config).keys((function(e){"undefined"===t.config[e]||"plugins"!==e&&"presets"!==e&&"el"!==e&&"id"!==e||(t.config[e]=r[e])}))}}},{key:"destroy",value:function(){var t,e=this,o=this.innerContainer,l=this.root,h=this.media;if(l&&h){if(this.hasStart=!1,this._useAutoplay=!1,l.removeAttribute(S),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.media),c.b.clearAllTimers(this),this.emit(f.DESTROY),null===(t=$)||void 0===t||t.remove(this),w.destroy(this),Object(D.b)(this),Object(r.f)(Object(r.g)(n.prototype),"destroy",this).call(this),this.fullscreen&&this._fullscreenEl===this.root&&this.exitFullscreen(),o)for(var d=o.children,i=0;i<d.length;i++)o.removeChild(d[i]);!o&&h instanceof window.Node&&l.contains(h)&&l.removeChild(h),["topBar","leftBar","rightBar","innerContainer"].map((function(t){e[t]&&l.removeChild(e[t]),e[t]=null}));var m=l.className.split(" ");m.length>0?l.className=m.filter((function(t){return t.indexOf("xgplayer")<0})).join(" "):l.className="",this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach((function(t){e[t]=!1}))}}},{key:"replay",value:function(){var t=this;this.removeClass(O.a.ENDED),this.currentTime=0,this.isSeeking=!1,Object(D.f)(this,"replay",(function(){t.once(f.SEEKED,(function(){var e=t.mediaPlay();e&&e.catch&&e.catch((function(t){console.log(t)}))})),t.emit(f.REPLAY),t.onPlay()}))}},{key:"retry",value:function(){var t=this;this.removeClass(O.a.ERROR),this.addClass(O.a.LOADING),Object(D.f)(this,"retry",(function(){var e=t.currentTime,n=t.config.url,r=c.b.isMSE(t.media)?{url:n}:t._preProcessUrl(n);t.src=r.url,!t.config.isLive&&(t.currentTime=e),t.once(f.CANPLAY,(function(){t.mediaPlay()}))}))}},{key:"changeFullStyle",value:function(t,e,n,r){t&&(r||(r=O.a.PARENT_FULLSCREEN),this._orgCss||(this._orgCss=c.b.filterStyleFromText(t)),c.b.addClass(t,n),e&&e!==t&&!this._orgPCss&&(this._orgPCss=c.b.filterStyleFromText(e),c.b.addClass(e,r),e.setAttribute(S,this.playerId)))}},{key:"recoverFullStyle",value:function(t,e,n,r){r||(r=O.a.PARENT_FULLSCREEN),this._orgCss&&(c.b.setStyleFromCsstext(t,this._orgCss),this._orgCss=""),c.b.removeClass(t,n),e&&e!==t&&this._orgPCss&&(c.b.setStyleFromCsstext(e,this._orgPCss),this._orgPCss="",c.b.removeClass(e,r),e.removeAttribute(S))}},{key:"getFullscreen",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget,e=this.root,n=this.media;if("video"!==t&&"media"!==t||(t=this[t]),t||(t=e),this._fullScreenOffset={top:c.b.scrollTop(),left:c.b.scrollLeft()},this._fullscreenEl=t,this._fullActionFrom="get",c.b.getFullScreenEl()===this._fullscreenEl)return this.onFullscreenChange(),Promise.resolve();try{for(var i=0;i<E.length;i++){var r=E[i];if(t[r]){var o="webkitRequestFullscreen"===r?t.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):t[r]();return o&&o.then?o:Promise.resolve()}}return n.fullscreenEnabled||n.webkitSupportsFullscreen?(n.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch(t){return Promise.reject(new Error("call getFullscreen fail"))}}},{key:"exitFullscreen",value:function(t){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),this._fullscreenEl||c.b.getFullScreenEl()){this.root;var e=this.media;this._fullActionFrom="exit";try{for(var i=0;i<k.length;i++){var n=k[i];if(document[n]){var r=document[n]();return r&&r.then?r:Promise.resolve()}}return e&&e.webkitSupportsFullscreen?(e.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch(t){return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var e=t?"".concat(O.a.INNER_FULLSCREEN," ").concat(O.a.CSS_FULLSCREEN):O.a.CSS_FULLSCREEN;this.changeFullStyle(this.root,t,e);var n=this.config.fullscreen,r=void 0===n?{}:n;(!0===r.useCssFullscreen||"function"==typeof r.useCssFullscreen&&r.useCssFullscreen())&&(this.fullscreen=!0,this.emit(f.FULLSCREEN_CHANGE,!0)),this._cssfullscreenEl=t,this.cssfullscreen=!0,this.emit(f.CSS_FULLSCREEN_CHANGE,!0)}},{key:"exitCssFullscreen",value:function(){var t=this._cssfullscreenEl?"".concat(O.a.INNER_FULLSCREEN," ").concat(O.a.CSS_FULLSCREEN):O.a.CSS_FULLSCREEN;if(this.fullscreen){var e=this.config.fullscreen,n=void 0===e?{}:e;!0===n.useCssFullscreen||"function"==typeof n.useCssFullscreen&&n.useCssFullscreen()?(this.recoverFullStyle(this.root,this._cssfullscreenEl,t),this.fullscreen=!1,this.emit(f.FULLSCREEN_CHANGE,!1)):this.removeClass(t)}else this.recoverFullStyle(this.root,this._cssfullscreenEl,t);this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(f.CSS_FULLSCREEN_CHANGE,!1)}},{key:"getRotateFullscreen",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget;this.cssfullscreen&&this.exitCssFullscreen(t);var e=t?"".concat(O.a.INNER_FULLSCREEN," ").concat(O.a.ROTATE_FULLSCREEN):O.a.ROTATE_FULLSCREEN;this._fullscreenEl=t||this.root,this.changeFullStyle(this.root,t,e,O.a.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this._rootStyle=this.root.getAttribute("style"),this.root.style.width="".concat(window.innerHeight,"px"),this.emit(f.FULLSCREEN_CHANGE,!0)}},{key:"exitRotateFullscreen",value:function(t){var e=this._fullscreenEl!==this.root?"".concat(O.a.INNER_FULLSCREEN," ").concat(O.a.ROTATE_FULLSCREEN):O.a.ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,e,O.a.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(f.FULLSCREEN_CHANGE,!1),this._rootStyle&&(this.root.style.style=this._rootStyle,this._rootStyle=!1)}},{key:"setRotateDeg",value:function(t){90===window.orientation||-90===window.orientation?this.rotateDeg=0:this.rotateDeg=t}},{key:"focus",value:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autoHide:!this.config.closeDelayBlur,delay:this.config.inactive};this.isActive?this.onFocus(data):this.emit(f.PLAYER_FOCUS,Object(r.i)({paused:this.paused,ended:this.ended},data))}},{key:"blur",value:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{ignorePaused:!1};this.isActive?(this._clearUserTimer(),this.emit(f.PLAYER_BLUR,Object(r.i)({paused:this.paused,ended:this.ended},data))):this.onBlur(data)}},{key:"onFocus",value:function(){var t=this,data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autoHide:!0,delay:3e3},e=this.innerStates;if(this.isActive=!0,this.removeClass(O.a.INACTIVE),this._clearUserTimer(),void 0!==data.isLock&&(e.isActiveLocked=data.isLock),!1===data.autoHide||!0===data.isLock||e.isActiveLocked)this._clearUserTimer();else{var time=data&&data.delay?data.delay:this.config.inactive;this.userTimer=c.b.setTimeout(this,(function(){t.userTimer=null,t.blur()}),time)}}},{key:"onBlur",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).ignorePaused,e=void 0!==t&&t;if(!this.innerStates.isActiveLocked){var n=this.config.closePauseVideoFocus;this.isActive=!1,(e||n||!this.paused&&!this.ended)&&this.addClass(O.a.INACTIVE)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.removeClass(O.a.ENTER),this.removeClass(O.a.ERROR),this.removeClass(O.a.LOADING),this.isCanplay=!0,this.waitTimer&&c.b.clearTimeout(this,this.waitTimer)}},{key:"onLoadeddata",value:function(){var t=this;this.isError=!1,this.isSeeking=!1,this.__startTime>0&&(this.duration>0?this._seekToStartTime():this.once(f.DURATION_CHANGE,(function(){t._seekToStartTime()})))}},{key:"onLoadstart",value:function(){this.removeClass(O.a.ERROR),this.isCanplay=!1}},{key:"onPlay",value:function(){this.state===F.a.ENDED&&this.setState(F.a.RUNNING),this.removeClass(O.a.PAUSED),this.ended&&this.removeClass(O.a.ENDED),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(O.a.PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this._clearUserTimer(),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(O.a.ENDED),this.setState(F.a.ENDED)}},{key:"onError",value:function(){this.isError=!0,this.updateAcc("error"),this.removeClass(O.a.NOT_ALLOW_AUTOPLAY),this.removeClass(O.a.NO_START),this.removeClass(O.a.ENTER),this.removeClass(O.a.LOADING),this.addClass(O.a.ERROR)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(O.a.SEEKING)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&c.b.clearTimeout(this,this.waitTimer),this.removeClass(O.a.LOADING),this.removeClass(O.a.SEEKING)}},{key:"onWaiting",value:function(){var t=this;this.waitTimer&&c.b.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=c.b.setTimeout(this,(function(){t.addClass(O.a.LOADING),t.emit(f.LOADING),c.b.clearTimeout(t,t.waitTimer),t.waitTimer=null}),this.config.minWaitDelay)}},{key:"onPlaying",value:function(){var t=this;this.isError=!1,[O.a.NO_START,O.a.PAUSED,O.a.ENDED,O.a.ERROR,O.a.REPLAY,O.a.LOADING].forEach((function(e){t.removeClass(e)})),this._accPlayed.t||this.paused||this.ended||(this._accPlayed.t=(new Date).getTime())}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.media.videoHeight&&this.resize(),(this.waitTimer||this.hasClass(O.a.LOADING))&&this.media.readyState>2&&(this.removeClass(O.a.LOADING),c.b.clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&this.state===F.a.NOTALLOW&&this.duration&&(this.setState(F.a.RUNNING),this.emit(f.AUTOPLAY_STARTED)),this._accPlayed.t||this.paused||this.ended||(this._accPlayed.t=(new Date).getTime())}},{key:"onVolumechange",value:function(){"Number"===c.b.typeOf(this.config.volume)&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(t,e,n){if(this.media&&e&&t){var o="String"===c.b.typeOf(t)?t:t.type||"";n.props&&"Array"!==c.b.typeOf(n.props)&&(n.props=[n.props]),this.emit(f.USER_ACTION,Object(r.i)({eventType:o,action:e,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:t},n))}}},{key:"updateAcc",value:function(t){if(this._accPlayed.t){var e=(new Date).getTime()-this._accPlayed.t;this._accPlayed.acc+=e,this._accPlayed.t=0,("ended"===t||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(time){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{startDiff:0,endDiff:0})||{},e=t.startDiff,n=void 0===e?0:e,r=t.endDiff,o=void 0===r?0:r,l=this.media.buffered;if(!l||0===l.length||!this.duration)return!0;for(var c=time||this.media.currentTime||.2,h=l.length,i=0;i<h;i++)if(l.start(i)+n<=c&&l.end(i)-o>c)return!0;return!1}},{key:"resizePosition",value:function(){var t=this.videoPos,e=t.vy,n=t.vx,r=t.h,o=t.w,l=this.videoPos.rotate;if(!(l<0&&r<0&&o<0)){var h=this.videoPos._pi;if(!h&&this.media.videoHeight&&(h=this.media.videoWidth/this.media.videoHeight*100),h){this.videoPos.pi=h;var d={rotate:l=l<0?0:l},f=0,m=0,v=1,y=Math.abs(l/90),T=this.root,E=this.innerContainer,k=T.offsetWidth,S=E?E.offsetHeight:T.offsetHeight,_=S,L=k;if(y%2==0)v=r>0?100/r:o>0?100/o:1,d.scale=v,f=e>0?(100-r)/2-e:0,d.y=2===y?0-f:f,m=n>0?(100-o)/2-n:0,d.x=2===y?0-m:m,this.media.style.width="".concat(L,"px"),this.media.style.height="".concat(_,"px");else if(y%2==1){_=k;var C=S-k;m=-C/2/(L=S)*100,d.x=3===y?m+e/2:m-e/2,f=C/2/_*100,d.y=3===y?f+n/2:f-n/2,d.scale=v,this.media.style.width="".concat(L,"px"),this.media.style.height="".concat(_,"px")}var A=c.b.getTransformStyle(d,this.media.style.transform||this.media.style.webkitTransform);this.media.style.transform=A,this.media.style.webkitTransform=A}}}},{key:"position",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{h:0,y:0,x:0,w:0};if(this.media&&t&&t.h){var e=this.videoPos;e.h=100*t.h||0,e.w=100*t.w||0,e.vx=100*t.x||0,e.vy=100*t.y||0,this.resizePosition()}}},{key:"setConfig",value:function(t){var e=this;t&&Object.keys(t).map((function(n){if("plugins"!==n){e.config[n]=t[n];var r=e.plugins[n.toLowerCase()];r&&"Function"===c.b.typeOf(r.setConfig)&&r.setConfig(t[n])}}))}},{key:"playNext",value:function(t){var e=this;this.resetState(),this.setConfig(t),this._currentTime=0,this._duration=0,Object(D.f)(this,"playnext",(function(){e.start(),e.emit(f.PLAYNEXT,t)}))}},{key:"resize",value:function(){var t=this;if(this.media){var e=this.root.getBoundingClientRect();this.sizeInfo.width=e.width,this.sizeInfo.height=e.height,this.sizeInfo.left=e.left,this.sizeInfo.top=e.top;var n=this.media,r=n.videoWidth,o=n.videoHeight,l=this.config,c=l.fitVideoSize,h=l.videoFillMode;if("fill"!==h&&"cover"!==h&&"contain"!==h||this.setAttribute("data-xgfill",h),o&&r){this._videoHeight=o,this._videoWidth=r;var d=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,m=e.width,v=e.height-d,y=parseInt(r/o*1e3,10),T=parseInt(m/v*1e3,10),E=m,k=v,S={};"auto"===c&&T>y||"fixWidth"===c?(k=m/y*1e3,this.config.fluid?S.paddingTop="".concat(100*k/E,"%"):S.height="".concat(k+d,"px")):("auto"===c&&T<y||"fixHeight"===c)&&(E=y*v/1e3,S.width="".concat(E,"px")),this.fullscreen||this.cssfullscreen||Object.keys(S).forEach((function(e){t.root.style[e]=S[e]})),("fillHeight"===h&&T<y||"fillWidth"===h&&T>y)&&this.setAttribute("data-xgfill","cover");var data={videoScale:y,vWidth:E,vHeight:k,cWidth:E,cHeight:k+d};this.resizePosition(),this.emit(f.VIDEO_RESIZE,data)}}}},{key:"updateObjectPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.media.updateObjectPosition?this.media.updateObjectPosition(t,e):this.media.style.objectPosition="".concat(100*t,"% ").concat(100*e,"%")}},{key:"setState",value:function(t){x.b.logInfo("setState","state from:".concat(F.b[this.state]," to:").concat(F.b[t])),this._state=t}},{key:"_preProcessUrl",value:function(t,e){var n=this.config,r=n.preProcessUrl,o=n.preProcessUrlOptions,l=Object.assign({},o,e);return c.b.isBlob(t)||"function"!=typeof r?{url:t}:r(t,l)}},{key:"_seekToStartTime",value:function(){this.__startTime>0&&this.duration>0&&(this.currentTime=this.__startTime>this.duration?this.duration:this.__startTime,this.__startTime=-1)}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(t){"boolean"==typeof t&&(this._hasStart=t,!1===t&&this.setState(F.a.READY),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return this._state===F.a.RUNNING||this._state===F.a.ENDED},set:function(t){t?this.setState(F.a.RUNNING):this._state>=F.a.RUNNING&&this.setState(F.a.ATTACHED)}},{key:"definitionList",get:function(){return this.config&&this.config.definition&&this.config.definition.list||[]},set:function(t){var e=this,n=this.config.definition,r=null,o=null;n.list=t,this.emit("resourceReady",t),t.forEach((function(t){var l;(null===(l=e.curDefinition)||void 0===l?void 0:l.definition)===t.definition&&(r=t),n.defaultDefinition===t.definition&&(o=t)})),!o&&t.length>0&&(o=t[0]),r?this.changeDefinition(r):o&&this.changeDefinition(o)}},{key:"videoFrameInfo",get:function(){var t={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.media||!this.media.getVideoPlaybackQuality)return t;var e=this.media.getVideoPlaybackQuality();return t.dropped=e.droppedVideoFrames||0,t.total=e.totalVideoFrames||0,t.corrupted=e.corruptedVideoFrames||0,t.total>0&&(t.droppedRate=t.dropped/t.total*100,t.droppedDuration=parseInt(this.cumulateTime/t.total*t.dropped,0)),t}},{key:"lang",get:function(){return this.config.lang},set:function(t){0!==P.a.langKeys.filter((function(e){return e===t})).length||"zh"===t?(this.config.lang=t,w.setLang(t,this)):console.error("Sorry, set lang fail, because the language [".concat(t,"] is not supported now, list of all supported languages is [").concat(P.a.langKeys.join(),"] "))}},{key:"i18n",get:function(){var t=this.config.lang;return"zh"===t&&(t="zh-cn"),this.__i18n.lang[t]||this.__i18n.lang.en}},{key:"i18nKeys",get:function(){return this.__i18n.textKeys||{}}},{key:"version",get:function(){return M.a}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(t){this.__url=t}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(t){this.plugins.poster&&this.plugins.poster.update(t)}},{key:"readyState",get:function(){return Object(r.f)(Object(r.g)(n.prototype),"readyState",this)}},{key:"error",get:function(){var t=Object(r.f)(Object(r.g)(n.prototype),"error",this);return this.i18n[t]||t}},{key:"networkState",get:function(){return Object(r.f)(Object(r.g)(n.prototype),"networkState",this)}},{key:"fullscreenChanging",get:function(){return!(null===this._fullScreenOffset)}},{key:"cumulateTime",get:function(){var t=this._accPlayed,e=t.acc,n=t.t;return n?(new Date).getTime()-n+e:e}},{key:"zoom",get:function(){return this.config.zoom},set:function(t){this.config.zoom=t}},{key:"videoRotateDeg",get:function(){return this.videoPos.rotate},set:function(t){(t=c.b.convertDeg(t))%90==0&&t!==this.videoPos.rotate&&(this.videoPos.rotate=t,this.resizePosition())}},{key:"avgSpeed",get:function(){return B},set:function(t){B=t}},{key:"realTimeSpeed",get:function(){return U},set:function(t){U=t}},{key:"offsetCurrentTime",get:function(){return this._offsetInfo.currentTime||0},set:function(t){this._offsetInfo.currentTime=t}},{key:"offsetDuration",get:function(){return this._offsetInfo.duration||0},set:function(t){this._offsetInfo.duration=t||0}},{key:"hook",value:function(t,e){return D.c.call.apply(D.c,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(t,e){return D.g.call.apply(D.g,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(t,e){return D.d.call.apply(D.d,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(t,e,n){for(var r=arguments.length,o=new Array(r>3?r-3:0),l=3;l<r;l++)o[l-3]=arguments[l];return D.h.call.apply(D.h,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removePluginHooks",value:function(t,e,n){for(var r=arguments.length,o=new Array(r>3?r-3:0),l=3;l<r;l++)o[l-3]=arguments[l];return D.e.call.apply(D.e,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(t,e){var n;"boolean"==typeof e&&e!==this.muted&&(this.addInnerOP("volumechange"),c.b.typeOf(e)===Boolean&&(this.muted=e)),null===(n=$)||void 0===n||n.setActive(this.playerId,t)}}],[{key:"debugger",get:function(){return x.b.config.debug},set:function(t){x.b.config.debug=t}},{key:"instManager",get:function(){return $},set:function(t){$=t}},{key:"getCurrentUserActivePlayerId",value:function(){var t;return null===(t=$)||void 0===t?void 0:t.getActiveId()}},{key:"setCurrentUserActive",value:function(t,e){var n;null===(n=$)||void 0===n||n.setActive(t,e)}},{key:"isHevcSupported",value:function(){return h.a.isHevcSupported()}},{key:"probeConfigSupported",value:function(t){return h.a.probeConfigSupported(t)}},{key:"install",value:function(t,e){n.plugins||(n.plugins={}),n.plugins[t]||(n.plugins[t]=e)}},{key:"use",value:function(t,e){n.plugins||(n.plugins={}),n.plugins[t]=e}}]),n}(v);Object(r.e)(H,"defaultPreset",null),Object(r.e)(H,"XgVideoProxy",null),H.instManager=N.a.getInstance()},3567:function(t,e,n){"use strict";var r=n(725),o=n(1935);r("toPrimitive"),o()},3568:function(t,e,n){"use strict";var r=n(102),o=n(141),l=n(3680),c=n(83)("toPrimitive"),h=Date.prototype;r(h,c)||o(h,c,l)},3569:function(t,e,n){"use strict";var r=n(46),o=n(62),l=n(146),c=n(391),h=n(1934);r({target:"Object",stat:!0,forced:o((function(){c(1)})),sham:!h},{getPrototypeOf:function(t){return c(l(t))}})},3570:function(t,e,n){"use strict";n(46)({target:"Object",stat:!0},{setPrototypeOf:n(316)})},3571:function(t,e,n){"use strict";n.d(e,"a",(function(){return k}));var r=n(3358),o=n(3536),l=n(3369),c=n(3437),h=n(3372),d=n(3445),f=n(3455),m=n(3451),v=n(3421),y=n(3359),T=n(3494),E=n(3535),k=function(t){Object(r.h)(n,t);var e=Object(r.d)(n);function n(){return Object(r.b)(this,n),e.apply(this,arguments)}return Object(r.c)(n)}(o.a);Object(r.e)(k,"defaultPreset",E.a),Object(r.e)(k,"Util",y.b),Object(r.e)(k,"Sniffer",v.a),Object(r.e)(k,"Errors",m.b),Object(r.e)(k,"Events",h),Object(r.e)(k,"Plugin",l.b),Object(r.e)(k,"BasePlugin",c.a),Object(r.e)(k,"I18N",f.a),Object(r.e)(k,"STATE_CLASS",d.a),Object(r.e)(k,"InstManager",T.a)},3572:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r="3.0.19"},3680:function(t,e,n){"use strict";var r=n(111),o=n(1933),l=TypeError;t.exports=function(t){if(r(this),"string"===t||"default"===t)t="string";else if("number"!==t)throw new l("Incorrect hint");return o(this,t)}},3681:function(t,e,n){"use strict";var r=n(58),o=n(158),l=n(100),c=n(102),h=n(198),d=n(443),f=Function,m=r([].concat),v=r([].join),y={};t.exports=d?f.bind:function(t){var e=o(this),n=e.prototype,r=h(arguments,1),d=function(){var n=m(r,h(arguments));return this instanceof d?function(t,e,n){if(!c(y,e)){for(var r=[],i=0;i<e;i++)r[i]="a["+i+"]";y[e]=f("C,a","return new C("+v(r,",")+")")}return y[e](t,n)}(e,n.length,n):e.apply(t,n)};return l(n)&&(d.prototype=n),d}},3682:function(t,e){if("undefined"!=typeof Element&&!Element.prototype.matches){var n=Element.prototype;n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector}t.exports=function(element,t){for(;element&&9!==element.nodeType;){if("function"==typeof element.matches&&element.matches(t))return element;element=element.parentNode}}},3683:function(t,e,n){var r,o,l;o=[],void 0===(l="function"==typeof(r=function(){return function t(data,e,n){var r,o,l=window,c="application/octet-stream",h=n||c,d=data,f=!e&&!n&&d,m=document.createElement("a"),v=function(a){return String(a)},y=l.Blob||l.MozBlob||l.WebKitBlob||v,T=e||"download";if(y=y.call?y.bind(l):Blob,"true"===String(this)&&(h=(d=[d,h])[0],d=d[1]),f&&f.length<2048&&(T=f.split("/").pop().split("?")[0],m.href=f,-1!==m.href.indexOf(f))){var E=new XMLHttpRequest;return E.open("GET",f,!0),E.responseType="blob",E.onload=function(e){t(e.target.response,T,c)},setTimeout((function(){E.send()}),0),E}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(d)){if(!(d.length>2096103.424&&y!==v))return navigator.msSaveBlob?navigator.msSaveBlob(_(d),T):L(d);h=(d=_(d)).type||c}else if(/([\x80-\xff])/.test(d)){for(var i=0,k=new Uint8Array(d.length),S=k.length;i<S;++i)k[i]=d.charCodeAt(i);d=new y([k],{type:h})}function _(t){for(var e=t.split(/[:;,]/),n=e[1],r=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),o=r.length,i=0,l=new Uint8Array(o);i<o;++i)l[i]=r.charCodeAt(i);return new y([l],{type:n})}function L(t,e){if("download"in m)return m.href=t,m.setAttribute("download",T),m.className="download-js-link",m.innerHTML="downloading...",m.style.display="none",document.body.appendChild(m),setTimeout((function(){m.click(),document.body.removeChild(m),!0===e&&setTimeout((function(){l.URL.revokeObjectURL(m.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,c)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var n=document.createElement("iframe");document.body.appendChild(n),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,c)),n.src=t,setTimeout((function(){document.body.removeChild(n)}),333)}if(r=d instanceof y?d:new y([d],{type:h}),navigator.msSaveBlob)return navigator.msSaveBlob(r,T);if(l.URL)L(l.URL.createObjectURL(r),!0);else{if("string"==typeof r||r.constructor===v)try{return L("data:"+h+";base64,"+l.btoa(r))}catch(t){return L("data:"+h+","+encodeURIComponent(r))}(o=new FileReader).onload=function(t){L(this.result)},o.readAsDataURL(r)}return!0}})?r.apply(e,o):r)||(t.exports=l)},387:function(t,e,n){"use strict";var r=n(2),o=n(3),l=(n(20),n(9),n(16),n(7),n(75),n(70),n(19),n(300),n(11),n(12),n(8),n(4),n(50),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(312),n(313),n(6),n(48),n(29),n(30)),c=n(77);function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}e.a={data:function(){return{visibleItems:new Map,collectionInterval:null}},methods:{startCollection:function(){var t=this;this.collectionInterval=setInterval((function(){t.sendData()}),5e3)},stopCollection:function(){clearInterval(this.collectionInterval)},handleVisibility:function(t,e){var n=t.type,r=t.id,o=t.pt,l="".concat(n,"-").concat(r,"-").concat(o);this.getRouteBaseName();e?(this.$logEvent("log_actions",{operation:"goods_exposure",behavior_info:r,obj_type:n,behavior_info_sub:o,NoServer:!0}),this.visibleItems.set(l,t)):this.visibleItems.delete(l)},sendData:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.visibleItems.size>0)){e.next=6;break}return data=(data=Array.from(t.visibleItems.values())).map((function(t){var e=t.id,n=t.type,r=t.pt;return"".concat(n,".").concat(e,".").concat(r)})),e.next=5,Object(l.t)({data:[d({},Object(c.i)("log_actions",{operation:"goods_exposure",behavior_info:data.join(",")}))]});case 5:t.visibleItems.clear();case 6:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.startCollection()},beforeDestroy:function(){this.stopCollection()}}},438:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var r={hoverLeftUpArea:{show:!0},hoverRightUpArea:{show:!0,text:"Remix"},statList:[{type:"like"},{type:"collection"}]},o={isInward:!0,hoverLeftUpArea:{show:!1},hoverRightUpArea:{show:!0,text:"Try"},statList:[{type:"task"},{type:"collection"}]},l={t_artwork:r,t_portfolio:r,t_aiapp:{isInward:!0,hoverLeftUpArea:{show:!1},hoverRightUpArea:{show:!0,text:"Try"},statList:[{type:"task"},{type:"collection"}]},t_workflow:o,t_comfyUIApp:o,t_character:{isInward:!1,hoverLeftUpArea:{show:!1},hoverRightUpArea:{show:!0,text:"gpt_tab_chat"},statList:[{type:"token"},{type:"collection"}]},t_post:{hoverLeftUpArea:{show:!1},hoverRightUpArea:{show:!1},statList:[{type:"like"},{type:"collection"}]},t_aiVideo:{isInward:!1,hoverLeftUpArea:{show:!1},hoverRightUpArea:{show:!1},statList:[{type:"play"},{type:"like"}]},t_lookBook:{isInward:!1,hoverLeftUpArea:{show:!1},hoverRightUpArea:{show:!1},statList:[{type:"play"},{type:"like"}]},t_model:{isInward:!0,hoverLeftUpArea:{show:!0},hoverRightUpArea:{show:!0,text:"Remix"},statList:[{type:"task"},{type:"collection"}]},t_lora_train:{isInward:!0,hoverLeftUpArea:{show:!0},hoverRightUpArea:{show:!0,text:"navModel"},statList:[{type:"task"},{type:"collection"}]},t_aiAudio:{isInward:!0,hoverLeftUpArea:{show:!1},hoverRightUpArea:{show:!0,text:"Try"},statList:[{type:"task"},{type:"collection"}]},t_paletteTemplate:{isInward:!0,hoverLeftUpArea:{show:!0},hoverRightUpArea:{show:!0,text:"Remix"},statList:[{type:"task"},{type:"collection"}]}}},47:function(t,e,n){"use strict";var r=n(46),o=n(164).findIndex,l=n(568),c="findIndex",h=!0;c in[]&&Array(1)[c]((function(){h=!1})),r({target:"Array",proto:!0,forced:h},{findIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),l(c)},677:function(t,e,n){"use strict";var r,o=n(233),l=n(234),c=n(25),h=n(3206),d=function(){return Object(l.a)((function t(component){Object(o.a)(this,t),this.component=component,this.defaultOptions={value:!0,destroy:this.destroy}}),[{key:"isInDoucment",value:function(t){return document.body.contains(t)}},{key:"init",value:function(){(r=new(c.default.extend(this.component))).$mount(),document.body.appendChild(r.$el)}},{key:"open",value:function(t){r&&this.isInDoucment(r.$el)||this.init(),Object.assign(r,this.defaultOptions,t)}},{key:"close",value:function(){try{Object.assign(r.$props,{value:!1})}catch(t){console.log(t)}}},{key:"destroy",value:function(){try{document.body.removeChild(r.$el),r.$destroy(),r=null}catch(t){r=null}}}])}();e.a=new d(h.default)},79:function(t,e,n){"use strict";n.d(e,"j",(function(){return l})),n.d(e,"f",(function(){return c})),n.d(e,"s",(function(){return h})),n.d(e,"r",(function(){return d})),n.d(e,"t",(function(){return f})),n.d(e,"v",(function(){return m})),n.d(e,"q",(function(){return v})),n.d(e,"g",(function(){return y})),n.d(e,"e",(function(){return T})),n.d(e,"h",(function(){return E})),n.d(e,"o",(function(){return k})),n.d(e,"d",(function(){return S})),n.d(e,"i",(function(){return _})),n.d(e,"k",(function(){return L})),n.d(e,"a",(function(){return C})),n.d(e,"p",(function(){return A})),n.d(e,"l",(function(){return w})),n.d(e,"m",(function(){return O})),n.d(e,"n",(function(){return R})),n.d(e,"u",(function(){return D})),n.d(e,"c",(function(){return I})),n.d(e,"b",(function(){return x}));var r=n(17),o="/api/v1/square";function l(data){return Object(r.a)({url:"/api/v1/tag/suggest",method:"POST",data:data})}function c(data){return Object(r.a)({url:"/api/v1/tag/v2/hot",method:"POST",data:data})}function h(data){return Object(r.a)({url:"/api/v1/model/tag/edit",method:"post",data:data})}function d(data){return Object(r.a)({url:"/api/v1/artwork/tag/edit",method:"post",data:data})}function f(data){return Object(r.a)({url:"/api/v1/portfolio/tag/edit",method:"post",data:data})}function m(data){return Object(r.a)({url:"/api/v1/lookbook/tag/edit",method:"post",data:data})}function v(data){return Object(r.a)({url:"/api/v1/ai-video/tag/edit",method:"post",data:data})}function y(data){return Object(r.a)({url:"/api/v1/model/tag",method:"post",data:data})}function T(data){return Object(r.a)({url:"/api/v1/artwork/tag",method:"post",data:data})}function E(data){return Object(r.a)({url:"/api/v1/portfolio/tag",method:"post",data:data})}function k(data){return Object(r.a)({url:"/api/v1/lookbook/tag",method:"post",data:data})}function S(data){return Object(r.a)({url:"/api/v1/ai-video/tag",method:"post",data:data})}function _(data){return Object(r.a)({url:"/api/v1/square/model/list",method:"post",data:data})}function L(data){return Object(r.a)({url:"/api/v1/tag/detail",method:"post",data:data})}function C(data){return Object(r.a)({url:"/api/v1/collect-v2/add",method:"post",data:data})}function A(data){return Object(r.a)({url:"/api/v1/collect-v2/remove",method:"post",data:data})}function w(data){return Object(r.a)({url:o+"/tag/explore",method:"post",data:data})}function O(data){return Object(r.a)({url:o+"/tag/model",method:"post",data:data})}function R(data){return Object(r.a)({url:o+"/tag/post",method:"post",data:data})}function D(data){return Object(r.a)({url:o+"/post/tag/audit",method:"post",data:data})}function I(data){return Object(r.a)({url:o+"/tag/ai-video",method:"post",data:data})}function x(data){return Object(r.a)({url:o+"/timbre/list",method:"post",data:data})}}}]);